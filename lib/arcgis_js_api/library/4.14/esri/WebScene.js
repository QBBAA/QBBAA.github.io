// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var c=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&n.isMultiOriginJSONMixin(c)&&c.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(q,
c,n){Object.defineProperty(c,"__esModule",{value:!0});c.createCopyError=function(){return new n("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};c.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};c.createSchemaValidationError=function(f){return new n("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:f})};c.isSchemaValidationError=
function(f){return f&&"webscene:schema-validation"===f.name}})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,c,n,f,m,g,l,h,p,a,b,e,d,k){function P(a,b,d,e){2===a.length?(t[0]=a[0],t[1]=a[1],t[2]=0,a=t):a===d&&(l.vec3.copy(t,a),a=t);return r(a,b,0,d,e,0,1)}function r(a,b,d,e,k,B,r){void 0===r&&(r=1);b=G(b,k,W);if(f.isNone(b))return!1;if(b===w){if(a===e&&d===B)return!0;for(b=d+3*r;d<b;d++,B++)e[B]=a[d];return!0}for(r=d+3*r;d<r;d+=3,B+=3)b(a,d,e,B);return!0}function R(a,b){if(b.spatialReference===a)return b.spatialReferenceId;b.spatialReference=a;"metersPerUnit"in b&&(b.metersPerUnit=m.getMetersPerUnitForSR(a,
1));return a.wkt===c.SphericalECEFSpatialReference.wkt?b.spatialReferenceId=1:a.isWGS84?b.spatialReferenceId=2:a.isWebMercator?b.spatialReferenceId=3:a.wkt===c.WGS84ECEFSpatialReference.wkt?b.spatialReferenceId=4:4490===a.wkid?b.spatialReferenceId=5:b.spatialReferenceId=0}function w(a,b,d,e){d[e++]=a[b++];d[e++]=a[b++];d[e]=a[b]}function T(a,b,e,k){e[k++]=S*(a[b++]/d.earthRadius);e[k++]=S*(Math.PI/2-2*Math.atan(Math.exp(-1*a[b++]/d.earthRadius)));e[k]=a[b]}function V(a,b,e,k){var H=.4999999*Math.PI,
H=n.clamp(Q*a[b+1],-H,H),H=Math.sin(H);e[k++]=Q*a[b]*d.earthRadius;e[k++]=d.halfEarthRadius*Math.log((1+H)/(1-H));e[k]=a[b+2]}function X(a,b,d){b=R(b,I);b=O[b][6];if(f.isNone(b))return!1;b(a,0,t,0);d!==t&&(d[0]=t[0],d[1]=t[1],2<d.length&&(d[2]=t[2]));return!0}function D(a,b){t[0]=a.x;t[1]=a.y;t[2]=a.hasZ?a.z:0;return X(t,a.spatialReference,b)}function E(a,b,e,k){var B=d.earthRadius+a[b+2],H=Q*a[b+1];a=Q*a[b];b=Math.cos(H);e[k++]=Math.cos(a)*b*B;e[k++]=Math.sin(a)*b*B;e[k]=Math.sin(H)*B}function u(a,
b,e,B){var H=k.Vec3Compact.length(a,b),f=n.asinClamped(a[b+2]/(0===H?1:H)),r=Math.cos(f)*H;a=(0<a[b+1]?1:-1)*n.acosClamped(a[b]/(0===r?1:r));e[B++]=S*a;e[B++]=S*f;e[B]=H-d.earthRadius}function C(a,b,d,e){var k=da,B=Q*a[b],f=Q*a[b+1];a=a[b+2];b=Math.sin(f);var f=Math.cos(f),H=k.a/Math.sqrt(1-k.e2*b*b);d[e++]=(H+a)*f*Math.cos(B);d[e++]=(H+a)*f*Math.sin(B);d[e++]=(H*(1-k.e2)+a)*b}function v(a,b,d,e){var k=da,B=a[b],f=a[b+1];a=a[b+2];var H,r,c,t,P,ca;b=Math.abs(a);H=B*B+f*f;r=Math.sqrt(H);c=H+a*a;t=Math.sqrt(c);
B=Math.atan2(f,B);P=a*a/c;c=H/c;f=k.a2/t;H=k.a3-k.a4/t;.3<c?(P=b/t*(1+c*(k.a1+f+P*H)/t),t=Math.asin(P),f=P*P,c=Math.sqrt(1-f)):(c=r/t*(1-P*(k.a5-f-c*H)/t),t=Math.acos(c),f=1-c*c,P=Math.sqrt(f));ca=1-k.e2*f;f=k.a/Math.sqrt(ca);k=k.a6*f;f=r-f*c;H=b-k*P;b=c*f+P*H;r=c*H-P*f;k=r/(k/ca+b);t+=k;0>a&&(t=-t);d[e++]=S*B;d[e++]=S*t;d[e]=b+r*k/2}function G(a,b,d){void 0===d&&(d=y());return A(a,b,d).projector}function A(a,b,d){if(d.source.spatialReference===a&&d.dest.spatialReference===b)return d;var e=R(a,d.source),
k=R(b,d.dest);0===e&&0===k?a.equals(b)?d.projector=w:d.projector=null:d.projector=O[e][k];return d}function y(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:w}}Object.defineProperty(c,"__esModule",{value:!0});var x,z,F,L,M,J,N,K;c.SphericalECEFSpatialReference=new a({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
c.WGS84ECEFSpatialReference=new a({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});c.canProject=function(a,b){return!!G(a,b,W)};c.vectorToVector=P;c.pointToPoint=
function(a,b,d,e){void 0===d&&(d=b.spatialReference);void 0===e&&(e=0);t[0]=a.x;t[1]=a.y;var k=a.z;t[2]=void 0!==k?k:e;if(!r(t,a.spatialReference,0,t,d,0,1))return!1;b.x=t[0];b.y=t[1];b.spatialReference=d;void 0!==k?(b.z=t[2],b.hasZ=!0):(b.z=void 0,b.hasZ=!1);return!0};c.pointToVector=function(a,b,d,e){void 0===e&&(e=0);t[0]=a.x;t[1]=a.y;var k=a.z;t[2]=void 0!==k?k:e;return r(t,a.spatialReference,0,b,d,0,1)};c.vectorToPoint=function(a,b,d,k){d instanceof p?k=k||d.spatialReference:e.isPoint(d)?(d.hasZ=
!0,k=k||d.spatialReference):(k=d,d=new p({spatialReference:k}));return r(a,b,0,t,k,0,1)?(d.x=t[0],d.y=t[1],d.z=t[2],d.spatialReference=k,d):null};c.xyzToVector=function(a,b,d,e,k,f){t[0]=a;t[1]=b;t[2]=d;return r(t,e,0,k,f,0,1)};c.bufferToBuffer=r;c.computeLinearTransformation=function(a,b,d,e){var k=R(a,I),r=R(e,U);if(k===r&&1!==r&&(0!==k||a.equals(e)))return g.mat4.identity(d),g.mat4.translate(d,d,b),!0;if(1===r){a=O[k][6];r=O[6][r];if(f.isNone(a)||f.isNone(r))return!1;a(b,0,B,0);r(B,0,Y,0);a=Q*
B[0];r=Q*B[1];b=Math.sin(a);a=Math.cos(a);e=Math.sin(r);r=Math.cos(r);d[0]=-b;d[4]=-e*a;d[8]=r*a;d[12]=Y[0];d[1]=a;d[5]=-e*b;d[9]=r*b;d[13]=Y[1];d[2]=0;d[6]=r;d[10]=e;d[14]=Y[2];d[3]=0;d[7]=0;d[11]=0;d[15]=1;return!0}if(3===r&&(2===k||1===k)){a=O[k][6];if(f.isNone(a))return!1;a(b,0,B,0);b=Q*B[1];V(B,0,Y,0);g.mat4.identity(d);g.mat4.translate(d,d,Y);b=1/Math.cos(b);g.mat4.scale(d,d,[b,b,1]);return!0}return!1};c.transformDirection=function(a,b,d,e,k){l.vec3.copy(Z,a);l.vec3.add(ba,a,b);P(Z,d,Z,k);P(ba,
d,ba,k);l.vec3.subtract(e,ba,Z);l.vec3.normalize(e,e)};c.mbsToMbs=function(a,b,e,k){b=A(b,k,aa);if(b.projector===w)return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],!0;if(f.isNone(b.projector))return!1;k=b.source;var r=b.dest;if(3===r.spatialReferenceId){b=O[k.spatialReferenceId][2];if(f.isNone(b))return!1;b(a,0,B,0);b=Math.abs(Q*B[1])+Math.asin(a[3]/(d.earthRadius+a[2]));V(B,0,e,0);e[3]=b>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(b)*a[3];return!0}b.projector(a,0,e,0);e[3]=a[3]*k.metersPerUnit/r.metersPerUnit;
return!0};c.extentToBoundingBox=function(a,b,d){if(null==a)return!1;var e;t[0]=null!=a.xmin?a.xmin:0;t[1]=null!=a.ymin?a.ymin:0;t[2]=null!=a.zmin?a.zmin:0;e=r(t,a.spatialReference,0,b,d,0,1);t[0]=null!=a.xmax?a.xmax:0;t[1]=null!=a.ymax?a.ymax:0;t[2]=null!=a.zmax?a.zmax:0;e=e&&r(t,a.spatialReference,0,b,d,3,1);null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.zmin&&(b[2]=-Infinity);null==a.xmax&&(b[3]=Infinity);null==a.ymax&&(b[4]=Infinity);null==a.zmax&&(b[5]=Infinity);return e};
c.extentToBoundingRect=function(a,b,d){if(null==a)return!1;var e;t[0]=null!=a.xmin?a.xmin:0;t[1]=null!=a.ymin?a.ymin:0;t[2]=null!=a.zmin?a.zmin:0;e=r(t,a.spatialReference,0,t,d,0,1);b[0]=t[0];b[1]=t[1];t[0]=null!=a.xmax?a.xmax:0;t[1]=null!=a.ymax?a.ymax:0;t[2]=null!=a.zmax?a.zmax:0;e=e&&r(t,a.spatialReference,0,t,d,0,1);b[2]=t[0];b[3]=t[1];null==a.xmin&&(b[0]=-Infinity);null==a.ymin&&(b[1]=-Infinity);null==a.xmax&&(b[2]=Infinity);null==a.ymax&&(b[3]=Infinity);return e};c.boundingRectToBoundingRect=
function(a,d,e,k){if(null==a)return!1;if(d.equals(k))return b.set(e,a),!0;var f;t[0]=a[0];t[1]=a[1];t[2]=0;f=r(t,d,0,t,k,0,1);e[0]=t[0];e[1]=t[1];t[0]=a[2];t[1]=a[3];t[2]=0;f=f&&r(t,d,0,t,k,0,1);e[2]=t[0];e[3]=t[1];return f};(function(a){a.x2lon=function(a){return a/d.earthRadius};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/d.earthRadius))};a.lon2x=function(a){return a*d.earthRadius};a.lat2y=function(a){a=Math.sin(a);return d.earthRadius/2*Math.log((1+a)/(1-a))}})(c.webMercator||
(c.webMercator={}));c.canProjectToWGS84ComparableLonLat=function(a){a=R(a,I);return!!O[a][6]};c.vectorToWGS84ComparableLonLat=X;c.pointToWGS84ComparableLonLat=D;c.pointToWGS84ComparableLonLatPoint=function(a,b){var d=R(b.spatialReference,U);return f.isNone(O[6][d])?!1:D(a,t)?(b.x=t[0],b.y=t[1],b.z=t[2],!0):!1};c.wgs84ComparableLonLatToECEF=function(a,b,e,k){void 0===k&&(k=0);k=d.earthRadius+k;var f=Math.cos(e);a[0]=Math.cos(b)*f*k;a[1]=Math.sin(b)*f*k;a[2]=Math.sin(e)*k};var O=(x={},x[2]=(z={},z[5]=
null,z[6]=w,z[1]=E,z[0]=null,z[3]=V,z[2]=w,z[4]=C,z),x[5]=(F={},F[5]=w,F[6]=w,F[1]=E,F[0]=null,F[3]=null,F[2]=null,F[4]=C,F),x[3]=(L={},L[5]=null,L[6]=T,L[1]=function(a,b,d,e){T(a,b,d,e);E(d,e,d,e)},L[0]=null,L[3]=w,L[2]=T,L[4]=function(a,b,d,e){T(a,b,d,e);C(d,e,d,e)},L),x[4]=(M={},M[5]=v,M[6]=v,M[1]=function(a,b,d,e){v(a,b,d,e);E(d,e,d,e)},M[0]=null,M[3]=function(a,b,d,e){v(a,b,d,e);V(d,e,d,e)},M[2]=v,M[4]=w,M),x[1]=(J={},J[5]=u,J[6]=u,J[1]=w,J[0]=null,J[3]=function(a,b,d,e){u(a,b,d,e);V(d,e,d,e)},
J[2]=u,J[4]=function(a,b,d,e){u(a,b,d,e);C(d,e,d,e)},J),x[0]=(N={},N[5]=null,N[6]=null,N[1]=null,N[0]=w,N[3]=null,N[2]=null,N[4]=null,N),x[6]=(K={},K[5]=null,K[6]=w,K[1]=E,K[0]=null,K[3]=null,K[2]=w,K[4]=C,K),x);c.getProjector=G;var I={spatialReference:null,spatialReferenceId:0},U={spatialReference:null,spatialReferenceId:0},W=y(),aa=y(),Q=n.deg2rad(1),S=n.rad2deg(1),da={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,
a6:.9933056200098622},t=h.vec3f64.create(),B=h.vec3f64.create(),Y=h.vec3f64.create(),Z=h.vec3f64.create(),ba=h.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});c.mat4=n})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,c,n,f){function m(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=
0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function g(a,b,e){var d=b[0],k=b[1],f=b[2],r=b[3],c=b[4],w=b[5],g=b[6],l=b[7],h=b[8],m=b[9],p=b[10],u=b[11],n=b[12],v=b[13],q=b[14];b=b[15];var A=e[0],y=e[1],x=e[2],z=e[3];a[0]=A*d+y*c+x*h+z*n;a[1]=A*k+y*w+x*m+z*v;a[2]=A*f+y*g+x*p+z*q;a[3]=A*r+y*l+x*u+z*b;A=e[4];y=e[5];x=e[6];z=e[7];a[4]=A*d+y*c+x*h+z*n;a[5]=A*k+y*w+x*m+z*v;a[6]=A*f+y*g+x*p+z*q;a[7]=A*r+y*l+x*u+z*b;A=e[8];y=e[9];x=e[10];z=e[11];a[8]=A*d+y*c+x*h+z*n;a[9]=A*k+y*w+x*m+
z*v;a[10]=A*f+y*g+x*p+z*q;a[11]=A*r+y*l+x*u+z*b;A=e[12];y=e[13];x=e[14];z=e[15];a[12]=A*d+y*c+x*h+z*n;a[13]=A*k+y*w+x*m+z*v;a[14]=A*f+y*g+x*p+z*q;a[15]=A*r+y*l+x*u+z*b;return a}function l(a,b,e){var d=b[0],k=b[1],f=b[2],r=b[3],c=d+d,w=k+k,g=f+f;b=d*c;var l=d*w,d=d*g,h=k*w,k=k*g,f=f*g,c=r*c,w=r*w,r=r*g;a[0]=1-(h+f);a[1]=l+r;a[2]=d-w;a[3]=0;a[4]=l-r;a[5]=1-(b+f);a[6]=k+c;a[7]=0;a[8]=d+w;a[9]=k-c;a[10]=1-(b+h);a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a}function h(a,b,e){a[0]=b[0]-e[0];
a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];a[6]=b[6]-e[6];a[7]=b[7]-e[7];a[8]=b[8]-e[8];a[9]=b[9]-e[9];a[10]=b[10]-e[10];a[11]=b[11]-e[11];a[12]=b[12]-e[12];a[13]=b[13]-e[13];a[14]=b[14]-e[14];a[15]=b[15]-e[15];return a}Object.defineProperty(c,"__esModule",{value:!0});c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};
c.set=function(a,b,e,d,k,f,r,c,w,g,l,h,m,p,u,n,v){a[0]=b;a[1]=e;a[2]=d;a[3]=k;a[4]=f;a[5]=r;a[6]=c;a[7]=w;a[8]=g;a[9]=l;a[10]=h;a[11]=m;a[12]=p;a[13]=u;a[14]=n;a[15]=v;return a};c.identity=m;c.transpose=function(a,b){if(a===b){var e=b[1],d=b[2],k=b[3],f=b[6],r=b[7],c=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=e;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];a[12]=k;a[13]=r;a[14]=c}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],
a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};c.invert=function(a,b){var e=b[0],d=b[1],k=b[2],f=b[3],r=b[4],c=b[5],w=b[6],g=b[7],l=b[8],h=b[9],m=b[10],p=b[11],n=b[12],q=b[13],v=b[14];b=b[15];var G=e*c-d*r,A=e*w-k*r,y=e*g-f*r,x=d*w-k*c,z=d*g-f*c,F=k*g-f*w,L=l*q-h*n,M=l*v-m*n,J=l*b-p*n,N=h*v-m*q,K=h*b-p*q,O=m*b-p*v,I=G*O-A*K+y*N+x*J-z*M+F*L;if(!I)return null;I=1/I;a[0]=(c*O-w*K+g*N)*I;a[1]=(k*K-d*O-f*N)*I;a[2]=(q*F-v*z+b*x)*I;a[3]=(m*z-h*F-p*x)*I;a[4]=(w*J-r*O-g*M)*I;a[5]=(e*O-
k*J+f*M)*I;a[6]=(v*y-n*F-b*A)*I;a[7]=(l*F-m*y+p*A)*I;a[8]=(r*K-c*J+g*L)*I;a[9]=(d*J-e*K-f*L)*I;a[10]=(n*z-q*y+b*G)*I;a[11]=(h*y-l*z-p*G)*I;a[12]=(c*M-r*N-w*L)*I;a[13]=(e*N-d*M+k*L)*I;a[14]=(q*A-n*x-v*G)*I;a[15]=(l*x-h*A+m*G)*I;return a};c.adjoint=function(a,b){var e=b[0],d=b[1],k=b[2],f=b[3],r=b[4],c=b[5],w=b[6],g=b[7],l=b[8],h=b[9],m=b[10],p=b[11],n=b[12],q=b[13],v=b[14];b=b[15];a[0]=c*(m*b-p*v)-h*(w*b-g*v)+q*(w*p-g*m);a[1]=-(d*(m*b-p*v)-h*(k*b-f*v)+q*(k*p-f*m));a[2]=d*(w*b-g*v)-c*(k*b-f*v)+q*(k*
g-f*w);a[3]=-(d*(w*p-g*m)-c*(k*p-f*m)+h*(k*g-f*w));a[4]=-(r*(m*b-p*v)-l*(w*b-g*v)+n*(w*p-g*m));a[5]=e*(m*b-p*v)-l*(k*b-f*v)+n*(k*p-f*m);a[6]=-(e*(w*b-g*v)-r*(k*b-f*v)+n*(k*g-f*w));a[7]=e*(w*p-g*m)-r*(k*p-f*m)+l*(k*g-f*w);a[8]=r*(h*b-p*q)-l*(c*b-g*q)+n*(c*p-g*h);a[9]=-(e*(h*b-p*q)-l*(d*b-f*q)+n*(d*p-f*h));a[10]=e*(c*b-g*q)-r*(d*b-f*q)+n*(d*g-f*c);a[11]=-(e*(c*p-g*h)-r*(d*p-f*h)+l*(d*g-f*c));a[12]=-(r*(h*v-m*q)-l*(c*v-w*q)+n*(c*m-w*h));a[13]=e*(h*v-m*q)-l*(d*v-k*q)+n*(d*m-k*h);a[14]=-(e*(c*v-w*q)-r*
(d*v-k*q)+n*(d*w-k*c));a[15]=e*(c*m-w*h)-r*(d*m-k*h)+l*(d*w-k*c);return a};c.determinant=function(a){var b=a[0],e=a[1],d=a[2],k=a[3],f=a[4],c=a[5],g=a[6],l=a[7],h=a[8],m=a[9],p=a[10],n=a[11],q=a[12],u=a[13],C=a[14];a=a[15];return(b*c-e*f)*(p*a-n*C)-(b*g-d*f)*(m*a-n*u)+(b*l-k*f)*(m*C-p*u)+(e*g-d*c)*(h*a-n*q)-(e*l-k*c)*(h*C-p*q)+(d*l-k*g)*(h*u-m*q)};c.multiply=g;c.translate=function(a,b,e){var d=e[0],k=e[1];e=e[2];var f=void 0,c=void 0,g=void 0,l=void 0,h=void 0,m=void 0,p=void 0,n=void 0,q=void 0,
u=void 0,C=void 0,v=void 0;b===a?(a[12]=b[0]*d+b[4]*k+b[8]*e+b[12],a[13]=b[1]*d+b[5]*k+b[9]*e+b[13],a[14]=b[2]*d+b[6]*k+b[10]*e+b[14],a[15]=b[3]*d+b[7]*k+b[11]*e+b[15]):(f=b[0],c=b[1],g=b[2],l=b[3],h=b[4],m=b[5],p=b[6],n=b[7],q=b[8],u=b[9],C=b[10],v=b[11],a[0]=f,a[1]=c,a[2]=g,a[3]=l,a[4]=h,a[5]=m,a[6]=p,a[7]=n,a[8]=q,a[9]=u,a[10]=C,a[11]=v,a[12]=f*d+h*k+q*e+b[12],a[13]=c*d+m*k+u*e+b[13],a[14]=g*d+p*k+C*e+b[14],a[15]=l*d+n*k+v*e+b[15]);return a};c.scale=function(a,b,e){var d=e[0],k=e[1];e=e[2];a[0]=
b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*k;a[5]=b[5]*k;a[6]=b[6]*k;a[7]=b[7]*k;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*e;a[11]=b[11]*e;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.rotate=function(a,b,e,d){var k=d[0],c=d[1];d=d[2];var r=Math.sqrt(k*k+c*c+d*d),g=void 0,l=void 0,h=void 0,m=void 0,p=void 0,n=void 0,q=void 0,u=void 0,C=void 0,v=void 0,G=void 0,A=void 0,y=void 0,x=void 0,z=void 0,F=void 0,L=void 0,M=void 0,J=void 0,N=void 0,K=void 0,O=void 0,l=g=void 0;if(r<f.EPSILON)return null;
r=1/r;k*=r;c*=r;d*=r;g=Math.sin(e);l=Math.cos(e);h=1-l;m=b[0];p=b[1];n=b[2];q=b[3];u=b[4];C=b[5];v=b[6];G=b[7];A=b[8];y=b[9];x=b[10];z=b[11];F=k*k*h+l;L=c*k*h+d*g;M=d*k*h-c*g;J=k*c*h-d*g;N=c*c*h+l;K=d*c*h+k*g;O=k*d*h+c*g;g=c*d*h-k*g;l=d*d*h+l;a[0]=m*F+u*L+A*M;a[1]=p*F+C*L+y*M;a[2]=n*F+v*L+x*M;a[3]=q*F+G*L+z*M;a[4]=m*J+u*N+A*K;a[5]=p*J+C*N+y*K;a[6]=n*J+v*N+x*K;a[7]=q*J+G*N+z*K;a[8]=m*O+u*g+A*l;a[9]=p*O+C*g+y*l;a[10]=n*O+v*g+x*l;a[11]=q*O+G*g+z*l;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);
return a};c.rotateX=function(a,b,e){var d=Math.sin(e);e=Math.cos(e);var k=b[4],f=b[5],c=b[6],g=b[7],l=b[8],h=b[9],m=b[10],p=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=k*e+l*d;a[5]=f*e+h*d;a[6]=c*e+m*d;a[7]=g*e+p*d;a[8]=l*e-k*d;a[9]=h*e-f*d;a[10]=m*e-c*d;a[11]=p*e-g*d;return a};c.rotateY=function(a,b,e){var d=Math.sin(e);e=Math.cos(e);var k=b[0],f=b[1],c=b[2],g=b[3],l=b[8],h=b[9],m=b[10],p=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],
a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=k*e-l*d;a[1]=f*e-h*d;a[2]=c*e-m*d;a[3]=g*e-p*d;a[8]=k*d+l*e;a[9]=f*d+h*e;a[10]=c*d+m*e;a[11]=g*d+p*e;return a};c.rotateZ=function(a,b,e){var d=Math.sin(e);e=Math.cos(e);var k=b[0],f=b[1],c=b[2],g=b[3],l=b[4],h=b[5],m=b[6],p=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=k*e+l*d;a[1]=f*e+h*d;a[2]=c*e+m*d;a[3]=g*e+p*d;a[4]=l*e-k*d;a[5]=h*e-f*d;a[6]=m*e-c*d;a[7]=p*e-g*d;return a};
c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};c.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotation=function(a,b,e){var d=e[0],k=e[1];e=e[2];var c=Math.sqrt(d*d+k*k+e*e),g=void 0,l=void 0,h=void 0;if(c<f.EPSILON)return null;c=1/c;d*=c;k*=c;e*=c;g=Math.sin(b);
l=Math.cos(b);h=1-l;a[0]=d*d*h+l;a[1]=k*d*h+e*g;a[2]=e*d*h-k*g;a[3]=0;a[4]=d*k*h-e*g;a[5]=k*k*h+l;a[6]=e*k*h+d*g;a[7]=0;a[8]=d*e*h+k*g;a[9]=k*e*h-d*g;a[10]=e*e*h+l;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromXRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=e;a[7]=0;a[8]=0;a[9]=-e;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromYRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-e;a[3]=0;a[4]=
0;a[5]=1;a[6]=0;a[7]=0;a[8]=e;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromZRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=0;a[3]=0;a[4]=-e;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotationTranslation=l;c.fromQuat2=function(a,b){var e=p,d=-b[0],k=-b[1],f=-b[2],c=b[3],g=b[4],h=b[5],m=b[6],n=b[7],q=d*d+k*k+f*f+c*c;0<q?(e[0]=2*(g*c+n*d+h*f-m*k)/q,e[1]=2*(h*c+n*k+m*d-g*f)/q,e[2]=2*(m*c+n*f+g*
k-h*d)/q):(e[0]=2*(g*c+n*d+h*f-m*k),e[1]=2*(h*c+n*k+m*d-g*f),e[2]=2*(m*c+n*f+g*k-h*d));l(a,b,e);return a};var p=n.create();c.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};c.getScaling=function(a,b){var e=b[0],d=b[1],k=b[2],f=b[4],c=b[5],g=b[6],h=b[8],l=b[9];b=b[10];a[0]=Math.sqrt(e*e+d*d+k*k);a[1]=Math.sqrt(f*f+c*c+g*g);a[2]=Math.sqrt(h*h+l*l+b*b);return a};c.getRotation=function(a,b){var e=b[0]+b[5]+b[10],d=0;0<e?(d=2*Math.sqrt(e+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-
b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d);return a};c.fromRotationTranslationScale=function(a,b,e,d){var k=b[0],f=b[1],c=b[2],g=b[3],h=k+k,l=f+f,m=c+c;b=k*h;var p=k*l,k=k*m,
n=f*l,f=f*m,c=c*m,h=g*h,l=g*l,g=g*m,m=d[0],q=d[1];d=d[2];a[0]=(1-(n+c))*m;a[1]=(p+g)*m;a[2]=(k-l)*m;a[3]=0;a[4]=(p-g)*q;a[5]=(1-(b+c))*q;a[6]=(f+h)*q;a[7]=0;a[8]=(k+l)*d;a[9]=(f-h)*d;a[10]=(1-(b+n))*d;a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a};c.fromRotationTranslationScaleOrigin=function(a,b,e,d,k){var f=b[0],c=b[1],g=b[2],h=b[3],l=f+f,m=c+c,p=g+g;b=f*l;var n=f*m,q=f*p,f=c*m,c=c*p,u=g*p,g=h*l,m=h*m,C=h*p,v=d[0],G=d[1],p=d[2];d=k[0];h=k[1];k=k[2];var l=(1-(f+u))*v,A=(n+C)*v,v=(q-m)*
v,n=(n-C)*G,u=(1-(b+u))*G,G=(c+g)*G,q=(q+m)*p,c=(c-g)*p;b=(1-(b+f))*p;a[0]=l;a[1]=A;a[2]=v;a[3]=0;a[4]=n;a[5]=u;a[6]=G;a[7]=0;a[8]=q;a[9]=c;a[10]=b;a[11]=0;a[12]=e[0]+d-(l*d+n*h+q*k);a[13]=e[1]+h-(A*d+u*h+c*k);a[14]=e[2]+k-(v*d+G*h+b*k);a[15]=1;return a};c.fromQuat=function(a,b){var e=b[0],d=b[1],k=b[2];b=b[3];var f=e+e,c=d+d,g=k+k,e=e*f,h=d*f,d=d*c,l=k*f,m=k*c,k=k*g,f=b*f,c=b*c;b*=g;a[0]=1-d-k;a[1]=h+b;a[2]=l-c;a[3]=0;a[4]=h-b;a[5]=1-e-k;a[6]=m+f;a[7]=0;a[8]=l+c;a[9]=m-f;a[10]=1-e-d;a[11]=0;a[12]=
0;a[13]=0;a[14]=0;a[15]=1;return a};c.frustum=function(a,b,e,d,k,f,c){var g=1/(e-b),h=1/(k-d),l=1/(f-c);a[0]=2*f*g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*f*h;a[6]=0;a[7]=0;a[8]=(e+b)*g;a[9]=(k+d)*h;a[10]=(c+f)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=c*f*2*l;a[15]=0;return a};c.perspective=function(a,b,e,d,k){b=1/Math.tan(b/2);var f=void 0;a[0]=b/e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=k&&Infinity!==k?(f=1/(d-k),a[10]=(k+d)*f,a[14]=2*k*d*f):(a[10]=
-1,a[14]=-2*d);return a};c.perspectiveFromFieldOfView=function(a,b,e,d){var k=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),c=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var g=2/(c+b),h=2/(k+f);a[0]=g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=h;a[6]=0;a[7]=0;a[8]=-((c-b)*g*.5);a[9]=(k-f)*h*.5;a[10]=d/(e-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*e/(e-d);a[15]=0;return a};c.ortho=function(a,b,e,d,k,f,c){var g=1/(b-e),h=1/(d-k),l=1/(f-c);a[0]=-2*g;a[1]=0;a[2]=
0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*l;a[11]=0;a[12]=(b+e)*g;a[13]=(k+d)*h;a[14]=(c+f)*l;a[15]=1;return a};c.lookAt=function(a,b,e,d){var k=void 0,c=void 0,g=void 0,h=void 0,l=void 0,p=void 0,n=void 0,q=void 0,D=void 0,E=void 0,u=b[0],C=b[1];b=b[2];g=d[0];h=d[1];d=d[2];n=e[0];q=e[1];e=e[2];if(Math.abs(u-n)<f.EPSILON&&Math.abs(C-q)<f.EPSILON&&Math.abs(b-e)<f.EPSILON)return m(a);n=u-n;q=C-q;D=b-e;E=1/Math.sqrt(n*n+q*q+D*D);n*=E;q*=E;D*=E;k=h*D-d*q;c=d*n-g*D;g=g*q-h*n;(E=Math.sqrt(k*
k+c*c+g*g))?(E=1/E,k*=E,c*=E,g*=E):g=c=k=0;h=q*g-D*c;l=D*k-n*g;p=n*c-q*k;(E=Math.sqrt(h*h+l*l+p*p))?(E=1/E,h*=E,l*=E,p*=E):p=l=h=0;a[0]=k;a[1]=h;a[2]=n;a[3]=0;a[4]=c;a[5]=l;a[6]=q;a[7]=0;a[8]=g;a[9]=p;a[10]=D;a[11]=0;a[12]=-(k*u+c*C+g*b);a[13]=-(h*u+l*C+p*b);a[14]=-(n*u+q*C+D*b);a[15]=1;return a};c.targetTo=function(a,b,e,d){var f=b[0],c=b[1];b=b[2];var g=d[0],h=d[1],l=d[2];d=f-e[0];var m=c-e[1];e=b-e[2];var p=d*d+m*m+e*e;0<p&&(p=1/Math.sqrt(p),d*=p,m*=p,e*=p);var n=h*e-l*m,l=l*d-g*e,g=g*m-h*d,p=
n*n+l*l+g*g;0<p&&(p=1/Math.sqrt(p),n*=p,l*=p,g*=p);a[0]=n;a[1]=l;a[2]=g;a[3]=0;a[4]=m*g-e*l;a[5]=e*n-d*g;a[6]=d*l-m*n;a[7]=0;a[8]=d;a[9]=m;a[10]=e;a[11]=0;a[12]=f;a[13]=c;a[14]=b;a[15]=1;return a};c.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],
2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};c.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];a[6]=b[6]+e[6];a[7]=b[7]+e[7];a[8]=b[8]+e[8];a[9]=b[9]+e[9];a[10]=b[10]+e[10];a[11]=b[11]+e[11];a[12]=b[12]+e[12];a[13]=b[13]+e[13];a[14]=b[14]+e[14];a[15]=b[15]+e[15];return a};c.subtract=h;
c.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*e;a[9]=b[9]*e;a[10]=b[10]*e;a[11]=b[11]*e;a[12]=b[12]*e;a[13]=b[13]*e;a[14]=b[14]*e;a[15]=b[15]*e;return a};c.multiplyScalarAndAdd=function(a,b,e,d){a[0]=b[0]+e[0]*d;a[1]=b[1]+e[1]*d;a[2]=b[2]+e[2]*d;a[3]=b[3]+e[3]*d;a[4]=b[4]+e[4]*d;a[5]=b[5]+e[5]*d;a[6]=b[6]+e[6]*d;a[7]=b[7]+e[7]*d;a[8]=b[8]+e[8]*d;a[9]=b[9]+e[9]*d;a[10]=b[10]+e[10]*d;a[11]=b[11]+e[11]*d;a[12]=
b[12]+e[12]*d;a[13]=b[13]+e[13]*d;a[14]=b[14]+e[14]*d;a[15]=b[15]+e[15]*d;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};c.equals=function(a,b){var e=a[0],d=a[1],k=a[2],c=a[3],g=a[4],h=a[5],l=a[6],m=a[7],p=a[8],n=a[9],q=a[10],E=a[11],u=a[12],C=a[13],v=a[14];a=a[15];var G=b[0],A=b[1],
y=b[2],x=b[3],z=b[4],F=b[5],L=b[6],M=b[7],J=b[8],N=b[9],K=b[10],O=b[11],I=b[12],U=b[13],W=b[14];b=b[15];return Math.abs(e-G)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(G))&&Math.abs(d-A)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(k-y)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(y))&&Math.abs(c-x)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(x))&&Math.abs(g-z)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(h-F)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(l-L)<=f.EPSILON*
Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(m-M)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-J)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(n-N)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(N))&&Math.abs(q-K)<=f.EPSILON*Math.max(1,Math.abs(q),Math.abs(K))&&Math.abs(E-O)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(u-I)<=f.EPSILON*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(C-U)<=f.EPSILON*Math.max(1,Math.abs(C),Math.abs(U))&&Math.abs(v-W)<=f.EPSILON*Math.max(1,
Math.abs(v),Math.abs(W))&&Math.abs(a-b)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.mul=g;c.sub=h})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),function(q,c,n,f,m,g,l,h){function p(a,b,e,f){var d,k;a instanceof l&&b instanceof l&&(e=b.longitude,f=b.latitude,k=a.latitude,d=a.longitude);
a=n.deg2rad(k);f=n.deg2rad(f);d=n.deg2rad(d);b=n.deg2rad(e);e=Math.sin((a-f)/2);d=Math.sin((d-b)/2);e=2*n.asinClamped(Math.sqrt(e*e+Math.cos(a)*Math.cos(f)*d*d))*c.earthRadius;return Math.round(1E4*e)/1E4}function a(a,b){a/=15;b||(a=Math.round(a));return a}Object.defineProperty(c,"__esModule",{value:!0});c.earthRadius=f.wgs84Radius;c.halfEarthRadius=c.earthRadius/2;c.halfEarthCircumference=Math.PI*c.earthRadius;c.earthCircumference=2*c.halfEarthCircumference;c.metersPerDegree=c.halfEarthCircumference/
180;c.getGreatCircleDistance=p;c.getGreatCircleSpanAt=function(a,b,e){var d=b.spatialReference,f=new l(b.x,a.y,d),k=new l(e.x,a.y,d);b=new l(a.x,b.y,d);a=new l(a.x,e.y,d);return{lon:p(f,k),lat:p(b,a)}};c.getLonDeltaForDistance=function(a,b){b/=c.earthRadius;a=n.deg2rad(a);b=Math.sin(b/2);a=Math.cos(a);a=2*n.asinClamped(Math.sqrt(b*b/(a*a)));return n.rad2deg(a)};c.getLatDeltaForDistance=function(a){return n.rad2deg(a/c.earthRadius)};c.getMaxCameraAltitude=function(a){a=n.deg2rad(a/2);return(1-Math.sin(a))*
c.earthRadius/Math.sin(a)};c.getViewExtentDistance=function(a,b){b=n.deg2rad(b/2);return 2*n.acosClamped((Math.pow(a+c.earthRadius,2)+Math.pow(c.earthRadius,2)-Math.pow((a+c.earthRadius)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+c.earthRadius),2)-a*a-2*a*c.earthRadius),2))/(2*(a+c.earthRadius)*c.earthRadius))*c.earthRadius};c.computeCartesianDistance=function(a,f){a=h.wgs84ComparableLonLatToECEF(b,a.longitude,a.latitude,a.z||0);f=h.wgs84ComparableLonLatToECEF(e,f.longitude,f.latitude,f.z||0);
f=[f[0]-a[0],f[1]-a[1],f[2]-a[2]];return Math.sqrt(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])};c.longitudeToTimezone=a;c.positionToTimezone=function(b,e){e||(e={hours:0,minutes:0,seconds:0});e.hours=a(b[0],!0);b=e.hours%1;e.hours-=b;e.minutes=60*b;b=e.minutes%1;e.minutes-=b;e.seconds=Math.round(60*b);return e};c.distanceToIdealHorizon=function(a,b){b=b||c.earthRadius;a=m.vec3.dot(a,a);return Math.sqrt(Math.abs(a-b*b))};var b=g.vec3f64.create(),e=g.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require",
"exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});(function(c){c.length=function(f,c){var g=f[c],l=f[c+1];f=f[c+2];return Math.sqrt(g*g+l*l+f*f)};c.normalize=function(f,c){var g=f[c],l=f[c+1],h=f[c+2],g=1/Math.sqrt(g*g+l*l+h*h);f[c]*=g;f[c+1]*=g;f[c+2]*=g};c.scale=function(f,c,g){f[c]*=g;f[c+1]*=g;f[c+2]*=g};c.add=function(f,c,g,l,h,p){void 0===p&&(p=c);h=h||f;h[p]=f[c]+g[l];h[p+1]=f[c+1]+g[l+1];h[p+2]=f[c+2]+g[l+2]};c.subtract=function(f,c,g,l,h,p){void 0===p&&(p=c);h=h||
f;h[p]=f[c]-g[l];h[p+1]=f[c+1]-g[l+1];h[p+2]=f[c+2]-g[l+2]}})(c.Vec3Compact||(c.Vec3Compact={}))})},"esri/views/support/spatialReferenceSupport":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,"__esModule",{value:!0});c.isSpatialReferenceSupported=function(c,f){return null==c?!1:"2d"===f?!0:"local"===f?!c.isGeographic:c.isWebMercator||c.isWGS84||4490===c.wkid}})},"esri/webdoc/support/thumbnailUtils":function(){define(["require","exports"],function(q,c){Object.defineProperty(c,
"__esModule",{value:!0});var n={width:600,height:400};c.getOptimalThumbnailSize=function(f,c){c=c||n;var g=c.width;c=c.height;var l=g/c;1.5>l?c=g/1.5:1.5<l&&(g=1.5*c);g>f.width&&(c*=f.width/g,g=f.width);c>f.height&&(g*=f.height/c,c=f.height);return{width:Math.round(g),height:Math.round(c)}}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ../webdoc/applicationProperties/Viewing".split(" "),
function(q,c,n,f,m,g,l){return function(c){function h(a){a=c.call(this,a)||this;a.viewing=null;return a}n(h,c);a=h;h.prototype.clone=function(){return new a({viewing:this.viewing?this.viewing.clone():null})};var a;f([g.property({type:l,json:{write:!0}})],h.prototype,"viewing",void 0);return h=a=f([g.subclass("esri.webscene.ApplicationProperties")],h)}(g.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./Search".split(" "),
function(q,c,n,f,m,g,l,h){return function(c){function a(a){a=c.call(this,a)||this;a.search=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b(g.clone({search:this.search}))};var b;f([l.property({type:h,json:{write:!0}})],a.prototype,"search",void 0);return a=b=f([l.subclass("esri.webdoc.applicationProperties.Viewing")],a)}(l.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,c,n,f,m,g,l,h,p){var a=m.ofType(p);return function(b){function e(d){d=b.call(this,d)||this;d.addressSearchEnabled=!0;d.enabled=!0;d.hintText=null;d.layers=new a;return d}n(e,b);d=e;e.prototype.readAddressSearchEnabled=function(a){return!a};e.prototype.writeAddressSearchEnabled=function(a,b,d){b[d]=!a};e.prototype.clone=function(){return new d(l.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers}))};var d;f([h.property({type:Boolean,
json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder"},default:!0,origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"addressSearchEnabled",void 0);f([h.reader("addressSearchEnabled")],e.prototype,"readAddressSearchEnabled",null);f([h.writer("addressSearchEnabled")],e.prototype,"writeAddressSearchEnabled",null);f([h.property({type:Boolean,json:{write:!0,default:!0}})],e.prototype,"enabled",void 0);f([h.property({type:String,json:{write:!0}})],e.prototype,"hintText",void 0);
f([h.property({type:a,json:{write:{enabled:!0,isRequired:!0}}})],e.prototype,"layers",void 0);return e=d=f([h.subclass("esri.webdoc.applicationProperties.Search")],e)}(h.declared(g.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),
function(q,c,n,f,m,g,l,h,p){return function(a){function b(b){b=a.call(this,b)||this;b.field=null;b.id=null;b.subLayer=null;return b}n(b,a);e=b;b.prototype.clone=function(){return new e(g.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};var e;f([l.property({type:p,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);f([l.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);f([l.property({type:h.Integer,json:{write:!0}})],b.prototype,
"subLayer",void 0);return b=e=f([l.subclass("esri.webdoc.applicationProperties.SearchLayer")],b)}(l.declared(m.JSONSupport))})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,c,n,f,m,g,l){return function(c){function h(a){a=c.call(this,a)||this;a.exactMatch=!1;a.name=
null;a.type=null;return a}n(h,c);a=h;h.prototype.clone=function(){return new a({exactMatch:this.exactMatch,type:this.type,name:this.name})};var a;f([g.property({type:Boolean,json:{write:!0}})],h.prototype,"exactMatch",void 0);f([g.property({type:String,json:{write:!0}})],h.prototype,"name",void 0);f([g.enumeration.serializable()(l.kebabDict)],h.prototype,"type",void 0);return h=a=f([g.subclass("esri.webdoc.applicationProperties.SearchLayerField")],h)}(g.declared(m.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,c,n,f,m,g,l,h,p){var a=function(a,e,d){return{enabled:!d||!d.isPresentation}};return function(b){function e(a){a=b.call(this,a)||this;a.lighting=new h;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}n(e,b);d=e;e.prototype.clone=function(){return new d(this.cloneConstructProperties())};e.prototype.cloneConstructProperties=function(){return{lighting:h.prototype.clone.call(this.lighting),background:g.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var d;f([l.property({type:h,json:{write:!0}})],e.prototype,"lighting",void 0);f([l.property(p.backgroundProperty)],e.prototype,"background",void 0);f([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],e.prototype,"atmosphereEnabled",void 0);f([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],e.prototype,"starsEnabled",void 0);return e=d=f([l.subclass("esri.webscene.Environment")],e)}(l.declared(m.JSONSupport))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,c,n,f,m,g){return function(c){function h(a){a=c.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}n(h,c);l=h;h.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};h.prototype.writeDate=function(a,b,e){b[e]=a.getTime()};h.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};h.prototype.writedirectShadowsEnabled=function(a,b,e){a&&(b[e]=a)};h.prototype.writeDisplayUTCOffset=function(a,b){null!=
a&&(b.displayUTCOffset=a)};h.prototype.clone=function(){return new l(this.cloneConstructProperties())};h.prototype.cloneConstructProperties=function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var l;f([g.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],h.prototype,"date",void 0);f([g.reader("date",["datetime"])],h.prototype,"readDate",
null);f([g.writer("date")],h.prototype,"writeDate",null);f([g.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],h.prototype,"directShadowsEnabled",void 0);f([g.reader("directShadowsEnabled",["directShadows"])],h.prototype,"readDirectShadowsEnabled",null);f([g.writer("directShadowsEnabled")],h.prototype,"writedirectShadowsEnabled",null);f([g.property({type:Number,json:{write:!0}})],h.prototype,"displayUTCOffset",void 0);f([g.writer("displayUTCOffset")],h.prototype,"writeDisplayUTCOffset",
null);return h=l=f([g.subclass("esri.webscene.Lighting")],h)}(g.declared(m.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q={base:n,key:"type",typeMap:{color:f}};c.backgroundProperty={types:q,json:{read:function(c){return function(f,l,h){if(!f)return f;for(var g in c.typeMap)if(f.type===g)return l=new c.typeMap[g],l.read(f,h),l}}(q),write:{overridePolicy:function(c,
f,l){return{enabled:!l||!l.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,g,l,h){var p=g.strict()({color:"color"});return function(a){function b(b){return a.call(this,b)||this}n(b,a);b.prototype.normalizeCtorArgs=function(a){a&&a.type&&
(a=m({},a),delete a.type);return a};b.prototype.clone=function(){};f([h.property({type:p.apiValues,readOnly:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],b.prototype,"type",void 0);return b=f([h.subclass("esri.webscene.background.Background")],b)}(h.declared(l.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,c,n,f,m,g,l,h,p){var a=m({},h.colorAndTransparencyProperty,{nonNullable:!0});return function(b){function e(a){a=b.call(this,a)||this;a.type="color";a.color=new g([0,0,0,1]);return a}n(e,b);d=e;e.prototype.clone=function(){return new d(this.cloneProperties())};e.prototype.cloneProperties=function(){return{color:this.color.clone()}};var d;f([l.enumeration.serializable()({color:"color"})],e.prototype,"type",void 0);f([l.property(a)],e.prototype,"color",void 0);return e=d=f([l.subclass("esri.webscene.background.ColorBackground")],
e)}(l.declared(p))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,c,n,f,m,g,l,h,p){return function(a){function b(b){b=a.call(this,b)||this;b.environment=new p;b.spatialReference=null;b.viewpoint=null;return b}n(b,a);e=b;Object.defineProperty(b.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new e({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var e;f([l.property({type:p,json:{write:{isRequired:!0}}})],b.prototype,"environment",void 0);f([l.property({type:h})],b.prototype,"spatialReference",void 0);f([l.property({type:["local","global"]})],b.prototype,"viewingMode",
null);f([l.property({type:m,json:{write:{isRequired:!0}}})],b.prototype,"viewpoint",void 0);return b=e=f([l.subclass("esri.webscene.InitialViewProperties")],b)}(l.declared(g))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,c,n,f,m,g,l,h,p){var a=m.ofType(p);return function(b){function e(d){d=
b.call(this,d)||this;d.slides=new a;return d}n(e,b);Object.defineProperty(e.prototype,"slides",{set:function(b){b&&(b=b.filter(function(a){return!!a.viewpoint}));this._set("slides",g.referenceSetter(b,this._get("slides"),a))},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([h.property({type:a,nonNullable:!0,json:{write:!0}}),h.cast(g.castForReferenceSetter)],e.prototype,"slides",null);return e=f([h.subclass("esri.webscene.Presentation")],
e)}(h.declared(l.JSONSupport))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/environment/SceneViewLighting ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(q,c,n,f,m,g,l,h,p,a,b,e,d,k,P,r,R,w,T,V,X,D,E,u,C,v,G,A,y,x){function z(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function F(a){if(a=z(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function L(a,b){a=b-a;a>O&&(a-=K);a<-O&&(a+=K);return a}var M=0,J=b.ofType(y.default),N=k.getLogger("esri.webscene.Slide"),K=86400,O=43200;return function(d){function c(a){a=d.call(this,a)||this;a._applyToController=null;a.id=Date.now().toString(16)+
"-slide-"+M++;a.title=new x.default;a.description=new G.default;a.thumbnail=new u.default;a.viewpoint=null;a.basemap=null;a.ground=null;a.environment=new C;a.visibleLayers=new J;return a}f(c,d);c.prototype.castTitle=function(a){return"string"===typeof a?new x.default({text:a}):R.ensureType(x.default,a)};c.prototype.castDescription=function(a){return"string"===typeof a?new G.default({text:a}):R.ensureType(G.default,a)};c.prototype.castThumbnail=function(a){return"string"===typeof a?new u.default({url:a}):
R.ensureType(u.default,a)};c.prototype.castBasemap=function(a){return X.ensureType(a)};Object.defineProperty(c.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",e.referenceSetter(a,this._get("visibleLayers"),J))},enumerable:!0,configurable:!0});c.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof V){var b=F(a);return{id:a.id,sublayerIds:b}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};
N.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):null};c.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};c.prototype._updateVisibleLayersFrom=function(a){var b=this,d=[];return P.eachAlways(this._allLayers(a.map).map(function(b){return a.whenLayerView(b).then(function(a){if(a.visible){var e=F(b);d.push(new y.default({id:a.layer.id,sublayerIds:e}))}})}).toArray()).then(function(){b.visibleLayers.removeAll();b.visibleLayers.addMany(d)})};c.prototype.updateFrom=function(a,b){var d=this;b={screenshot:n({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},b&&b.screenshot)};return a.when(function(){d.viewpoint=
a.viewpoint.clone();d.environment.lighting=v.prototype.clone.apply(a.environment.lighting);d.basemap=a.map.basemap&&a.map.basemap.clone()||null;d.ground=a.map.ground?A.default.fromGround(a.map.ground):null;return d._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){d.thumbnail=new u.default({url:a.dataUrl});return d})};c.prototype.applyTo=function(a,b){return l(this,void 0,void 0,function(){var d,e,c;return g(this,function(f){this._applyToController&&
this._applyToController.abort();this._applyToController=d=P.createAbortController();P.onAbortOrThrow(b,function(){return d.abort()});e=n({animate:!0},b,{signal:this._applyToController.signal});c=P.createDeferred(function(){return d.abort()});this._applyTo(a,e,d).then(c.resolve,c.reject);return[2,c.promise]})})};c.prototype._applyTo=function(b,d,e){return l(this,void 0,void 0,function(){var c,f=this;return g(this,function(k){switch(k.label){case 0:return[4,a.result(function(){return l(f,void 0,void 0,
function(){return g(this,function(a){switch(a.label){case 0:return[4,this._applyBasemap(b,d)];case 1:return a.sent(),this._applyLayerVisibility(b),this._applyGround(b),[4,this._applyViewpoint(b,d)];case 2:return a.sent(),[2]}})})}())];case 1:c=k.sent();this._applyToController===e&&(this._applyToController=null);if(!1===c.ok)throw c.error;return[2,this]}})})};c.prototype._applyBasemap=function(a,b){return l(this,void 0,void 0,function(){var d;return g(this,function(e){switch(e.label){case 0:if(!this.basemap)return[3,
5];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.basemap.load(b)];case 2:return e.sent(),[3,4];case 3:d=e.sent();if(P.isAbortError(d))throw d;return[3,4];case 4:a.map.basemap=X.clonePreservingTiledLayers(this.basemap,a.map.basemap),e.label=5;case 5:return[2]}})})};c.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground))};c.prototype._allLayers=function(a){var d=new b;this._collectLayers(a,d);this._collectLayers(a.ground,d);return d};c.prototype._collectLayers=
function(a,b){var d=this;a.layers.forEach(function(a){b.add(a);a.layers&&d._collectLayers(a,b)})};c.prototype._applyLayerVisibility=function(a){var b=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var d=b.visibleLayers.find(function(b){return b.id===a.id});a.visible=null!=d;var e=d&&d.sublayerIds,d=z(a);e&&d&&d.forEach(function(a){return a.visible=0<=e.indexOf(a.id)})})};c.prototype._applyViewpoint=function(a,b){return l(this,void 0,void 0,function(){return g(this,function(d){switch(d.label){case 0:if(!this.viewpoint||
b.ignoreViewpoint)return[3,5];this.viewpoint.camera.fov=a.camera.fov;return b.animate?this.get("environment.lighting.date")?[4,this._animateToLighting(a,b)]:[3,2]:[3,4];case 1:return d.sent(),[2];case 2:return a.environment.lighting=this.environment.lighting.clone(),[4,a.goTo(this.viewpoint,b)];case 3:d.sent(),d.label=4;case 4:return a.viewpoint=this.viewpoint,a.environment.lighting=this.environment.lighting.clone(),[3,6];case 5:a.environment.lighting=this.environment.lighting.clone(),d.label=6;case 6:return[2]}})})};
c.prototype._animateToLighting=function(a,b){return l(this,void 0,void 0,function(){var d,e,c,f=this;return g(this,function(k){d=null;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);e=a.goTo(this.viewpoint,b);e.then(function(){a.environment.lighting=
f.environment.lighting.clone()});c=function(){d&&d.remove();a.environment.lighting.cameraTrackingEnabled=!0};return[2,e.then(function(){a.environment.lighting=D.default.fromWebsceneLighting(f.environment.lighting);c()},function(a){c();throw a;})]})})};c.prototype._getTime=function(a){var b=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[b,a]};c.prototype._setTime=function(a,b,d){a.setTime(b);a.setUTCHours(d/3600);a.setUTCMinutes(d%3600/60);a.setUTCSeconds(d%3600%60);
return a};c.prototype._animateLightingWithCamera=function(a){var b=this,d=this._getTime(new Date(a.environment.lighting.date.toString())),e=d[0],c=d[1],d=this._getTime(this.environment.lighting.date),f=d[0],k=L(c,d[1]),g=a.renderCoordsHelper,h=T.vec3f64.create();g.toRenderCoords(a.camera.position,h);var l=T.vec3f64.create();g.toRenderCoords(this.viewpoint.camera.position,l);var m=T.vec3f64.create(),p=new Date;return a.watch("camera",function(d){g.toRenderCoords(d.position,m);var B=w.vec3.squaredDistance(h,
m),t=w.vec3.squaredDistance(l,m);d=0;0!==B+t&&(d=B/(B+t));B=e+(f-e)*d;d=E.moduloPositive(c+k*d,K);a.environment.lighting.date=b._setTime(p,B,d)})};c.createFrom=function(a,b){return(new this).updateFrom(a,b)};m([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);m([r.property({type:x.default,json:{default:function(){return new x.default({text:""})},write:{isRequired:!0}}})],c.prototype,"title",void 0);m([r.cast("title")],c.prototype,"castTitle",null);m([r.property({type:G.default,
json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],c.prototype,"description",void 0);m([r.cast("description")],c.prototype,"castDescription",null);m([r.property({type:u.default,json:{default:function(){return new u.default({url:""})},write:{isRequired:!0}}})],c.prototype,"thumbnail",void 0);m([r.cast("thumbnail")],c.prototype,"castThumbnail",null);m([r.property({type:p,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);m([r.property({type:h,json:{read:{source:"baseMap"},
write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);m([r.cast("basemap")],c.prototype,"castBasemap",null);m([r.property({type:A.default,json:{write:!0}})],c.prototype,"ground",void 0);m([r.property({type:J,json:{write:{isRequired:!0}}})],c.prototype,"visibleLayers",null);m([r.cast("visibleLayers")],c.prototype,"castVisibleLayers",null);m([r.property({type:C,json:{write:!0}})],c.prototype,"environment",void 0);return c=m([r.subclass("esri.webscene.Slide")],c)}(r.declared(d.JSONSupport))})},
"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(q,c,n,f,m,g,l,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(b){b=a.call(this,b)||this;b.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};b.cameraTrackingEnabled=
!0;b.ambientOcclusionEnabled=!1;var d=(new Date).getFullYear(),d=new Date("March 15, "+d+" 12:00:00 UTC");b._set("defaultDate",d);b._set("date",d);return b}n(b,a);e=b;b.fromWebsceneLighting=function(a){return new e(m({},a.cloneConstructProperties()))};Object.defineProperty(b.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});b.prototype.autoUpdate=function(a,b){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=
!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(p.target=this,p.timezoneOffset=e,this.emit("timezone-will-change",p));if(null!=a)return b!==a.getTime()};b.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),b=new e(m({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));
a&&b._set("date",b._get("defaultDate"));b.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;b.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;b.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;b.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return b};b.prototype.cloneWithWebsceneLighting=function(a){var b=this.clone();null!=a.date&&(b.date=a.date);b.directShadowsEnabled=a.directShadowsEnabled;b.displayUTCOffset=a.displayUTCOffset;return b};
b.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var e;f([l.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);f([l.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);f([l.property({type:Date})],b.prototype,"defaultDate",null);f([l.property({type:Date})],b.prototype,"date",null);return b=e=f([l.subclass("esri.views.3d.environment.SceneViewLighting")],b)}(l.declared(g.EventedMixin(h)));c.SceneViewLighting=
q;var p={target:null,timezoneOffset:0};c.default=q})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,g){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.url="";return a}n(h,c);l=h;h.prototype.clone=function(){return new l({url:this.url})};
var l;f([g.property({type:String,json:{write:{isRequired:!0}}})],h.prototype,"url",void 0);return h=l=f([g.subclass("esri.webdoc.support.Thumbnail")],h)}(g.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,g){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function h(){var a=
null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(h,c);l=h;h.prototype.clone=function(){return new l({text:this.text})};var l;f([g.property({type:String,json:{write:!0}})],h.prototype,"text",void 0);return h=l=f([g.subclass("esri.webscene.support.Description")],h)}(g.declared(m.JSONSupport));c.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../webdoc/support/opacityUtils".split(" "),
function(q,c,n,f,m,g,l,h,p){Object.defineProperty(c,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.opacity=null;return b}n(b,a);e=b;b.prototype.clone=function(){return new e({opacity:this.opacity})};b.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new m;a.opacity=this.opacity;return a};b.fromGround=function(a){return new e({opacity:a.opacity})};var e;f([l.property({type:Number,json:{type:h.Integer,read:{reader:p.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,b){b.transparency=p.opacityToTransparency(a)},target:"transparency"}}})],b.prototype,"opacity",void 0);return b=e=f([l.subclass("esri.webscene.support.SlideGround")],b)}(l.declared(g.JSONSupport));c.default=q})},"esri/webscene/support/SlideVisibleLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),
function(q,c,n,f,m,g,l,h){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this,a)||this;a.id="";a.sublayerIds=null;return a}n(a,c);b=a;a.prototype.clone=function(){return new b({id:this.id,sublayerIds:g.clone(this.sublayerIds)})};var b;f([l.property({type:String,json:{write:!0}})],a.prototype,"id",void 0);f([l.property({type:[h.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.prototype,"sublayerIds",void 0);return a=b=f([l.subclass("esri.webscene.support.SlideVisibleLayer")],
a)}(l.declared(m.JSONSupport));c.SlideVisibleLayer=q;c.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,c,n,f,m,g){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function h(){var a=null!==c&&c.apply(this,arguments)||this;a.text="";return a}n(h,c);l=h;h.prototype.clone=function(){return new l({text:this.text})};
var l;f([g.property({type:String,json:{write:{isRequired:!0}}})],h.prototype,"text",void 0);return h=l=f([g.subclass("esri.webscene.support.Title")],h)}(g.declared(m.JSONSupport));c.default=q})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,c,n,f){Object.defineProperty(c,"__esModule",{value:!0});q=function(c){function f(f,g){return c.call(this,f,g,"webscene")||this}n(f,c);Object.defineProperty(f.prototype,"supportsGround",
{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(f.Version);c.Version=q;c.default=q})},"esri/core/Version":function(){define(["require","exports","./Error"],function(q,c,n){Object.defineProperty(c,"__esModule",{value:!0});q=function(){function c(c,f,l){void 0===l&&(l="");this.major=c;this.minor=f;this._context=l}c.prototype.lessThan=
function(c,f){return this.major<c||c===this.major&&this.minor<f};c.prototype.since=function(c,f){return!this.lessThan(c,f)};c.prototype.validate=function(c){if(this.major!==c.major)throw new n((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:c});};c.prototype.clone=function(){return new c(this.major,this.minor,this._context)};c.parse=function(f,g){void 0===
g&&(g="");var l=f.split("."),h=l[0],l=l[1],m=/^\s*\d+\s*$/;if(!h||!h.match||!h.match(m))throw new n((g&&g+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!l||!l.match||!l.match(m))throw new n((g&&g+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:f});f=parseInt(h,10);h=parseInt(l,10);return new c(f,h,g)};return c}();c.Version=q})},"*noref":1}});
define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./views/3d/support/projectionUtils ./views/support/spatialReferenceSupport ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),function(q,
c,n,f,m,g,l,h,p,a,b,e,d,k,P,r,R,w,T,V,X,D,E,u,C,v,G,A,y,x,z,F,L,M,J,N,K,O,I,U,W,aa){var Q=V.getLogger("esri.WebScene"),S=new aa.default(1,18);return function(a){function c(b){b=a.call(this,b)||this;b._handles=new k;b.applicationProperties=null;b.clippingArea=null;b.clippingEnabled=!1;b.heightModelInfo=null;b.sourceVersion=null;b.supportsHeightModelInfo=!0;b.presentation=new W;b.initialViewProperties=new U;b.portalItem=null;b.resourceInfo=null;b.authoringApp=null;b.authoringAppVersion=null;b._isAuthoringAppSetByUser=
!1;b._isAuthoringAppVersionSetByUser=!1;return b}n(c,a);c.prototype.initialize=function(){var a=this;this.when().catch(function(a){Q.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var b=void 0;try{b=this._validateJSON(this.resourceInfo)}catch(Z){this.addResolvingPromise(D.reject(Z));return}this.read(b);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",function(){return a._scheduleLayersIdGC()}))};
c.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};c.prototype.writeClippingArea=function(a,b){b.clippingArea||(b.clippingArea={});b.clippingArea.geometry=a.toJSON()};c.prototype.readClippingEnabled=function(a,b){return b.clippingArea?!!b.clippingArea.clip:!1};c.prototype.writeClippingEnabled=function(a,b){this.clippingArea&&(b.clippingArea||(b.clippingArea={}),b.clippingArea.clip=a)};c.prototype.writeLayers=function(a,b,c,d){var e=this,f=g({},d,{layerContainerType:"operational-layers"});
a=a.map(function(a){return e.verifyWriteLayer(a,d)?a.write(null,f):null}).filter(function(a){return!!a});b[c]=a.toArray()};c.prototype.verifyWriteLayer=function(a,b){return"write"in a?!0:(b&&b.messages&&b.messages.push(new d("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};c.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return new aa.default(parseInt(a[0],10),parseInt(b,10))};c.prototype.writeSourceVersion=
function(a,b,c){b[c]=S.major+"."+S.minor};Object.defineProperty(c.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringApp=function(a,b){b.authoringApp=
a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(c.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});c.prototype.writeAuthoringAppVersion=function(a,b){b.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:p.version};c.prototype.writeGround=function(a,b,c,d){b[c]=a?a.write(null,d):{transparency:0,layers:[]}};c.prototype.readInitialViewProperties=
function(a,c){a={};c.initialState&&c.initialState.environment&&(a.environment=I.fromJSON(c.initialState.environment));a.spatialReference=c.spatialReference?y.fromJSON(c.spatialReference):y.WebMercator;a.viewingMode=c.viewingMode||"global";c.initialState&&c.initialState.viewpoint&&(a.viewpoint=b.fromJSON(c.initialState.viewpoint));return new U(a)};c.prototype.writeInitialViewProperties=function(a,b,c,d){a&&(c={},a.environment&&(c.environment=a.environment.write({},d)),a.viewpoint&&(c.viewpoint=a.viewpoint.write({},
d)),0!==Object.keys(c).length&&(b.initialState=c),b.spatialReference=a.spatialReference?a.spatialReference.write({},d):y.WebMercator.toJSON(),b.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};c.prototype.load=function(a){this.addResolvingPromise(this._loadFromSource());return this.when()};c.prototype.loadAll=function(){var a=this;return T.default(this,function(b){var c=a.presentation&&a.presentation.slides;b(a.ground,a.basemap,a.layers,c&&c.map(function(a){return a.basemap}))})};c.prototype.read=
function(a,b){var c=this;b=g({},b,{origin:"web-scene"});var d=this._isAuthoringAppVersionSetByUser,e=this._isAuthoringAppSetByUser,f=arguments;v.readLoadable(this,a,function(b){return c.inherited(f,[a,b])},b);e||(this._isAuthoringAppSetByUser=!1);d||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var d=a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),h=this.presentation.slides,k=
function(a,b){return a.visibleLayers.some(function(a){return a.id===b})},l=d.filter(function(a){return!h.some(function(b){return k(b,a.id)})});h.forEach(function(a){a.visibleLayers.addMany(l)})}};c.prototype._writeBasemapElevationLayers=function(a){var b=a.ground&&a.ground.layers;!a.baseMap&&b&&b.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=R.clone(b))};c.prototype.write=function(a,b){if("loaded"!==this.loadStatus){var c=new d("webscene:not-loaded",
"Web scene must be loaded before it can be serialized");Q.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw c;}this._runLayersIdGC();b=g({},b,{origin:"web-scene"});c=this.inherited(arguments,[a,b]);this._writeBasemapElevationLayers(c);return c};c.prototype.save=function(a){return h(this,void 0,void 0,function(){var b,c,e;return l(this,function(f){switch(f.label){case 0:if(this.portalItem)return[3,2];Q.error("save(): requires the .portalItem property to be set");
return[4,D.reject(new d("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:f.sent(),f.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,D.reject(new d("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:f.sent(),f.label=4;case 4:return b=this._updateFromPromise,[4,this.load()];case 5:return f.sent(),[4,this._loadObjectsWithLayers()];case 6:return f.sent(),c=this._enableVerifyItemRelativeUrls({origin:"web-scene",
url:this.portalItem.itemUrl&&E.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||F.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),e=this.write(null,c),[4,this._verifySave(e,c,a)];case 7:return f.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:e})];case 8:return f.sent(),C.updateOrigins(c),b?[4,b]:[3,10];case 9:f.sent(),f.label=10;case 10:return[4,this._saveThumbnail()];case 11:return f.sent(),[2,this.portalItem]}})})};c.prototype.saveAs=
function(a,b){return h(this,void 0,void 0,function(){var c,e,f,g,h,k;return l(this,function(l){switch(l.label){case 0:if(c=L.from(a))return[3,2];Q.error("saveAs(portalItem): requires a portal item parameter");return[4,D.reject(new d("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:l.sent(),l.label=2;case 2:return c.id&&(c=c.clone(),c.id=null),e=c.portal||F.getDefault(),[4,this.load()];case 3:return l.sent(),[4,this._loadObjectsWithLayers()];case 4:return l.sent(),
f=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:e,writtenProperties:[],blockedRelativeUrls:[]}),g=this.write(null,f),[4,this._verifySaveAs(g,f,b)];case 5:return l.sent(),[4,e._signIn()];case 6:return l.sent(),h=this.thumbnailUrl,k=!this._isOverridden("thumbnailUrl"),c.type="Web Scene",c.portal=e,this._updateTypeKeywords(c),[4,e.user.addItem({item:c,folder:b&&b.folder,data:g})];case 7:return l.sent(),this.portalItem=c,r.JSONSupport.prototype.read.call(this,{version:g.version,
authoringApp:g.authoringApp,authoringAppVersion:g.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:c.itemUrl&&E.urlToObject(c.itemUrl)}),C.updateOrigins(f),h&&(this.thumbnailUrl=k?E.addQueryParameter(h,"w","8192"):h),[4,this._saveThumbnail()];case 8:return l.sent(),[2,c]}})})};c.prototype._saveThumbnail=function(){return h(this,void 0,void 0,function(){return l(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:
[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};c.prototype._verifySave=function(a,b,c,e){void 0===e&&(e=!1);var f=b.messages.filter(function(a){return"error"===a.type}).map(function(a){return new d(a.name,a.message,a.details)});b.blockedRelativeUrls&&(f=f.concat(b.blockedRelativeUrls.map(function(a){return new d("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));c&&c.ignoreUnsupported&&(f=f.filter(function(a){return"layer:unsupported"!==
a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));c&&c.strictSchemaValidationEnabled||(f=f.filter(function(a){return"web-document-write:property-required"!==a.name}));var g=c&&c.strictSchemaValidationEnabled;return(g?D.create(function(a){return q(["./webscene/validator"],a)}).then(function(b){b=b.validate(a);if(0<b.length){var c="webscene did not validate:\n"+b.join("\n");Q.error((e?"saveAs":"save")+"(): "+c)}return b.map(function(a){return new d("webscene:schema-validation",
a)})}).then(function(a){if(g&&0<a.length)throw M.createSchemaValidationError(a.concat(f));return f}):D.resolve(f)).then(function(a){if(0<a.length)return D.reject(new d("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:a}))})};c.prototype._verifySaveAs=function(a,b,c){return this.canSaveAs(b)?D.reject(M.createCopyError()):this._verifySave(a,b,c,!0)};c.prototype.verifySaveAs=function(a){var b=this._enableVerifyItemRelativeUrls({origin:"web-scene",
messages:[]}),c=this.write(null,b);return this._verifySaveAs(c,b,a)};c.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};c.prototype.updateFrom=function(a,b){void 0===b&&(b={});return h(this,void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return this._updateFromPromise=c=this._updateFromInternal(a,b),[4,c];case 1:e.sent();
if(d=this._updateFromPromise===c)this._updateFromPromise=null;return[2]}})})};c.prototype._updateFromInternal=function(a,b){void 0===b&&(b={});return h(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:return[4,a.whenReady()];case 1:return c.sent(),!b.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=I.prototype.clone.apply(a.environment)),!b.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=
a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===b.thumbnailExcluded||null==b.thumbnailExcluded&&!b.viewpointExcluded?[4,this._updateFromThumbnail(a,b.thumbnailSize||void 0)]:[3,
3];case 2:c.sent(),c.label=3;case 3:return[2]}})})};c.prototype._updateFromThumbnail=function(a,b){return h(this,void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return c=K.getOptimalThumbnailSize(a,b),[4,a.takeScreenshot({format:"jpg",width:c.width,height:c.height,disableSlice:!0})];case 1:return d=e.sent(),this.thumbnailUrl=d.dataUrl,[2]}})})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):
this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};c.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};c.prototype._extractOperationalLayers=function(a){var b=this,c=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,e=a.baseMap.elevationLayers;d<e.length;d++)c.push(e[d]);var f=[],g=function(a){a.layers&&(a.layers=a.layers.filter(g));
return"ArcGISTiledElevationServiceLayer"===a.layerType?(b.sourceVersion.supportsGround||f.push(a),!1):!0};return{operationalLayers:a.operationalLayers?a.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:c}};c.prototype._loadFromJSON=function(a,b){var c=this,d=new e;return this._validateSpatialReference().then(function(){return c._validateHeightModelInfo()}).then(function(){return D.create(function(a){return q(["./portal/support/layersCreator"],a)})}).then(function(e){var f=
c._extractOperationalLayers(a),h=f.operationalLayers,k=f.operationalElevationLayers,f=f.basemapElevationLayers,l=[],m={context:g({},b,{layerContainerType:"operational-layers"})};c.portalItem&&(m.context.portal=c.portalItem.portal||F.getDefault());if(0<f.length){var n=g({},m,{context:g({},m.context,{layerContainerType:"ground"})});n.defaultLayerType="ArcGISTiledElevationServiceLayer";l.push(e.populateOperationalLayers(c.ground.layers,f,n))}0<k.length&&(n=g({},m,{context:g({},m.context,{layerContainerType:"ground"})}),
n.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(e.populateOperationalLayers(d,k,n)));h&&0<h.length&&l.push(e.populateOperationalLayers(c.layers,h,m));return D.eachAlways(l).then(function(){})}).then(function(){return c._loadObjectsWithLayers()}).then(function(){c.ground.layers.addMany(d)})};c.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(b){b.basemap&&a.push(b.basemap.load())});
return D.eachAlways(a).then(function(){})};c.prototype._loadFromItem=function(a){var b=this;return a.load().catch(function(a){throw new d("webscene:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new d("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(c){b.resourceInfo=c;return b._readAndLoadFromJSON(c,{origin:"web-scene",url:E.urlToObject(a.itemUrl),
portal:a.portal||F.getDefault()})})};c.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,b=this._sceneSpatialReference,c;if("local"!==a.viewingMode){if(!N.isSpatialReferenceSupported(b,"global"))return D.reject(new d("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||J.canProject(a,
b)}}else{if(!N.isSpatialReferenceSupported(b,"local"))return D.reject(new d("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:b,viewingMode:a.viewingMode}));c=function(a){return!a||a.equals(b)}}var e=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},f=e(a.viewpoint);return f&&!c(f)?
D.reject(new d("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode})):(f=this.presentation.slides.find(function(a){return!c(e(a.viewpoint))}))?(f=e(f.viewpoint),D.reject(new d("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:f,sceneSpatialReference:b,viewingMode:a.viewingMode}))):D.resolve()};c.prototype._validateHeightModelInfo=function(){var a=x.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return a?D.reject(a):D.resolve()};c.prototype._validateJSON=function(a){var b=aa.default.parse(a.version||"","webscene");S.validate(b);a.version=b.major+"."+b.minor;1===b.major&&2>=b.minor&&(a.spatialReference=y.WebMercator.toJSON());return a};c.prototype._updateTypeKeywords=function(a){"local"===
this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,b,c){return c.indexOf(a)===b}))};Object.defineProperty(c.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||
y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?E.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});c.prototype._enableVerifyItemRelativeUrls=function(a){var b=this._verifyItemRelativeRootPath;b&&(a.verifyItemRelativeUrls={rootPath:b,writtenUrls:[]});return a};c.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),
this._layersIdGCTimeoutId=0)};c.prototype._scheduleLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};c.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var b=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,c=function(b){return!!a.allLayers.find(function(a){return a.id===b})};b&&b.layers&&(b.layers=b.layers.filter(function(a){return c(a.id)}));
(b=this.presentation&&this.presentation.slides)&&b.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return c(a.id)}))})};c.fromJSON=function(a){if(!a)throw new d("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};c.VERSION=S;f([u.property({type:O,json:{write:!0}})],c.prototype,"applicationProperties",void 0);f([u.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);
f([u.property({type:G,json:{read:{source:"clippingArea.geometry",reader:z.fromJSON},write:{target:"clippingArea.geometry"}}})],c.prototype,"clippingArea",void 0);f([u.writer("clippingArea")],c.prototype,"writeClippingArea",null);f([u.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],c.prototype,"clippingEnabled",void 0);f([u.reader("clippingEnabled",["clippingArea"])],c.prototype,"readClippingEnabled",null);f([u.writer("clippingEnabled")],c.prototype,"writeClippingEnabled",null);
f([u.property({type:A,json:{write:!0}})],c.prototype,"heightModelInfo",void 0);f([u.property({json:{write:{target:"operationalLayers"}}})],c.prototype,"layers",void 0);f([u.writer("layers")],c.prototype,"writeLayers",null);f([u.property({readOnly:!0,type:aa.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],c.prototype,"sourceVersion",void 0);f([u.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);f([u.writer("sourceVersion")],c.prototype,"writeSourceVersion",
null);f([u.property({dependsOn:["portalItem.thumbnailUrl"]})],c.prototype,"thumbnailUrl",null);f([u.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringApp",null);f([u.writer("authoringApp")],c.prototype,"writeAuthoringApp",null);f([u.property({type:String,json:{write:{allowNull:!0}}})],c.prototype,"authoringAppVersion",null);f([u.writer("authoringAppVersion")],c.prototype,"writeAuthoringAppVersion",null);f([u.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],
c.prototype,"ground",void 0);f([u.writer("ground")],c.prototype,"writeGround",null);f([u.property({type:W,nonNullable:!0,json:{write:function(a,b,c,d){a.slides&&0<a.slides.length&&(c=g({},d,{isPresentation:!0}),b.presentation=a.write(null,c))}}})],c.prototype,"presentation",void 0);f([u.property({type:U,nonNullable:!0,json:{default:function(){return new U({viewingMode:"global",spatialReference:y.WebMercator})}}})],c.prototype,"initialViewProperties",void 0);f([u.reader("initialViewProperties",["initialState.environment",
"spatialReference","viewingMode","initialState.viewpoint"])],c.prototype,"readInitialViewProperties",null);f([u.writer("initialViewProperties",{"initialState.environment":{type:I},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],c.prototype,"writeInitialViewProperties",null);f([u.property({type:L})],c.prototype,"portalItem",void 0);f([u.property()],c.prototype,"resourceInfo",void 0);f([u.property()],c.prototype,"_sceneSpatialReference",null);f([u.property()],
c.prototype,"_verifyItemRelativeRootPath",null);return c=f([u.subclass("esri.WebScene")],c)}(u.declared(w.LoadableMixin(X.EsriPromiseMixin(r.JSONSupportMixin(a)))))});