// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define(["require","exports","../PixelBlock"],function(O,x,F){function M(a,c){a=Math.min(Math.max(a,-100),100);c=Math.min(Math.max(c,-100),100);var e,h,d=new Uint8Array(256);for(e=0;256>e;e++)0<a&&100>a?h=(200*e-25500+510*c)/(2*(100-a))+128:0>=a&&-100<a?h=(200*e-25500+510*c)*(100+a)/2E4+128:100===a?(h=200*e-25500+256*(100-a)+510*c,h=0<h?255:0):-100===a&&(h=128),d[e]=255<h?255:0>h?0:h;return d}function L(a,c,e,h,d,n,g,k){return{xmin:d<=e*a?0:d<e*a+a?d-e*a:a,ymin:n<=h*c?0:n<h*c+c?n-h*c:c,xmax:d+g<=e*
a?0:d+g<e*a+a?d+g-e*a:a,ymax:n+k<=h*c?0:n+k<h*c+c?n+k-h*c:c}}function N(a,c,e,h){var d=a.filter(function(a){return E(a)})[0];if(null==d)return null;var n=h?h.width:c.width;h=h?h.height:c.height;var g=d.width,k=d.height,f=c.width/g;c=c.height/k;var l=e?e.x:0;e=e?e.y:0;var b=d.pixelType,m=F.getPixelArrayConstructor(b),p=d.pixels.length,d=[],q,r,t,v,w,u,z,y,B,A;for(w=0;w<p;w++){r=new m(n*h);for(u=0;u<c;u++)for(z=0;z<f;z++)if(t=a[u*f+z])for(q=t.pixels[w],A=L(g,k,z,u,l,e,n,h),y=A.ymin;y<A.ymax;y++)for(t=
(u*k+y-e)*n+(z*g-l),v=y*g,B=A.xmin;B<A.xmax;B++)r[t+B]=q[v+B];d.push(r)}var x;if(a.some(function(a){return null==a||a.mask&&0<a.mask.length}))for(x=new Uint8Array(n*h),u=0;u<c;u++)for(z=0;z<f;z++)if(m=(t=a[u*f+z])?t.mask:null,A=L(g,k,z,u,l,e,n,h),m)for(y=A.ymin;y<A.ymax;y++)for(t=(u*k+y-e)*n+(z*g-l),v=y*g,B=A.xmin;B<A.xmax;B++)x[t+B]=m[v+B];else if(t)for(y=A.ymin;y<A.ymax;y++)for(t=(u*k+y-e)*n+(z*g-l),v=y*g,B=A.xmin;B<A.xmax;B++)x[t+B]=1;else for(y=A.ymin;y<A.ymax;y++)for(t=(u*k+y-e)*n+(z*g-l),v=
y*g,B=A.xmin;B<A.xmax;B++)x[t+B]=0;a=new F({width:n,height:h,pixels:d,pixelType:b,mask:x});a.updateStatistics();return a}Object.defineProperty(x,"__esModule",{value:!0});var E=function(a){return a&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length};x.extractBands=function(a,c){if(!c||!E(a))return a;var e=a.pixels.length;return c&&c.some(function(a){return a>=e})||1===e&&1===c.length&&0===c[0]||e===c.length&&!c.some(function(a,c){return a!==c})?a:new F({pixelType:a.pixelType,
width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:c.map(function(c){return a.pixels[c]}),statistics:a.statistics&&c.map(function(c){return a.statistics[c]})})};x.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){var c=c.sort(function(a,b){return a[0]-b[0]}),e=0;0>c[0][0]&&(e=c[0][0]);var h=Math.max(256,c[c.length-1][0]-e+1),d=new Uint8Array(4*h),n=[],g=0,k=0,f=5===c[0].length;if(65536<h)return c.forEach(function(a){n[a[0]-
e]=f?a.slice(1):a.slice(1).concat([255])}),{indexed2DColormap:n,offset:e,alphaSpecified:f};if(a.fillUnspecified)for(a=c[k],g=a[0]-e;g<h;g++)d[4*g]=a[1],d[4*g+1]=a[2],d[4*g+2]=a[3],d[4*g+3]=f?a[4]:255,g===a[0]-e&&(a=k===c.length-1?a:c[++k]);else for(g=0;g<c.length;g++)a=c[g],k=4*(a[0]-e),d[k]=a[1],d[k+1]=a[2],d[k+2]=a[3],d[k+3]=f?a[4]:255;return{indexedColormap:d,offset:e,alphaSpecified:f}}}};x.colorize=function(a,c){if(!E(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;var e=a.clone(),h=
e.pixels,d=e.mask,n=e.width*e.height;if(1!==h.length)return a;var g=c.indexedColormap;a=c.indexed2DColormap;var k=c.offset;c=c.alphaSpecified;var f=g.length-1,l=0,h=h[0],b=new Uint8Array(h.length),m=new Uint8Array(h.length),p=new Uint8Array(h.length),q=0;if(g)if(d)for(l=0;l<n;l++)d[l]&&(q=4*(h[l]-k),q<k||q>f?d[l]=0:(b[l]=g[q],m[l]=g[q+1],p[l]=g[q+2],d[l]=g[q+3]));else{d=new Uint8Array(n);for(l=0;l<n;l++)q=4*(h[l]-k),q<k||q>f?d[l]=0:(b[l]=g[q],m[l]=g[q+1],p[l]=g[q+2],d[l]=g[q+3]);e.mask=d}else if(d)for(l=
0;l<n;l++)d[l]&&(g=a[h[l]],b[l]=g[0],m[l]=g[1],p[l]=g[2],d[l]=g[3]);else{d=new Uint8Array(n);for(l=0;l<n;l++)g=a[h[l]],b[l]=g[0],m[l]=g[1],p[l]=g[2],d[l]=g[3];e.mask=d}e.pixels=[b,m,p];e.statistics=null;e.pixelType="u8";e.maskIsAlpha=c;return e};x.estimateStatisticsHistograms=function(a){if(!E(a))return null;var c=a.pixels,e=a.mask,h=a.pixelType,d=a.statistics;a=a.width*a.height;var n=c.length,g,k,f,l,b,m=[],p=[],q,r,t;for(l=0;l<n;l++){q=new Uint32Array(256);t=c[l];if("u8"===h)if(g=-.5,k=255.5,e)for(b=
0;b<a;b++)e[b]&&q[t[b]]++;else for(b=0;b<a;b++)q[t[b]]++;else{g=d[l].minValue;k=d[l].maxValue;f=(k-g)/256;r=new Uint32Array(257);if(e)for(b=0;b<a;b++)e[b]&&r[Math.floor((t[b]-g)/f)]++;else for(b=0;b<a;b++)r[Math.floor((t[b]-g)/f)]++;for(b=0;255>b;b++)q[b]=r[b];q[255]=r[255]+r[256]}m.push({min:g,max:k,size:256,counts:q});for(b=t=r=f=0;256>b;b++)f+=q[b],r+=b*q[b];r/=f;for(b=0;256>b;b++)t+=q[b]*Math.pow(b-r,2);q=Math.sqrt(t/(f-1));f=(k-g)/256;b=(r+.5)*f+g;q*=f;p.push({min:g,max:k,avg:b,stddev:q})}return{statistics:p,
histograms:m}};x.createStretchLUT=function(a){var c=a.minCutOff,e=a.maxCutOff,h=a.gamma,d=a.pixelType,n=a.outMin||0,g=a.outMax||255;if(-1===["u8","u16","s8","s16"].indexOf(d))return null;var k=c.length,f,l=0;"s8"===d?l=-127:"s16"===d&&(l=-32767);var b=256;-1<["u16","s16"].indexOf(d)&&(b=65536);for(var m=[],p=g-n,d=0;d<k;d++)m[d]=e[d]-c[d];f=h&&h.length>=k;var q=[];if(f)for(d=0;d<k;d++)q[d]=1<h[d]?2<h[d]?6.5+Math.pow(h[d]-2,2.5):6.5+100*Math.pow(2-h[d],4):1;var r,t=[],v,w,u;if(f)for(d=0;d<k;d++){u=
[];for(f=0;f<b;f++)v=f+l,r=(v-c[d])/m[d],w=1,1<h[d]&&(w-=Math.pow(1/p,r*q[d])),u[f]=v<e[d]&&v>c[d]?Math.floor(w*p*Math.pow(r,1/h[d]))+n:v>=e[d]?g:n;t[d]=u}else for(d=0;d<k;d++){u=[];for(f=0;f<b;f++)v=f+l,u[f]=v<=c[d]?n:v>=e[d]?g:Math.floor((v-c[d])/m[d]*p)+n;t[d]=u}if(null!=a.contrastOffset)for(a=M(a.contrastOffset,a.brightnessOffset),d=0;d<k;d++)for(u=t[d],f=0;f<b;f++)u[f]=a[u[f]];return{lut:t,offset:l}};x.createContrastBrightnessLUT=M;x.stretch=function(a,c){if(!E(a))return null;a=a.clone();var e=
a.pixels,h=a.mask,d=c.minCutOff,n=c.maxCutOff,g=c.gamma,k=c.outMin||0;c=c.outMax||255;var f=a.width*a.height,l=e.length,b,m,p,q,r,t=c-k,v=[];for(b=0;b<l;b++)v[b]=n[b]-d[b];m=g&&g.length>=l;var w=[];if(m)for(b=0;b<l;b++)w[b]=1<g[b]?2<g[b]?6.5+Math.pow(g[b]-2,2.5):6.5+100*Math.pow(2-g[b],4):1;if(m)if(null!=h)for(m=0;m<f;m++){if(h[m])for(b=0;b<l;b++)p=e[b][m],r=(p-d[b])/v[b],q=1,1<g[b]&&(q-=Math.pow(1/t,r*w[b])),e[b][m]=p<n[b]&&p>d[b]?Math.floor(q*t*Math.pow(r,1/g[b]))+k:p>=n[b]?c:k}else for(m=0;m<f;m++)for(b=
0;b<l;b++)p=e[b][m],r=(p-d[b])/v[b],q=1,1<g[b]&&(q-=Math.pow(1/t,r*w[b])),e[b][m]=p<n[b]&&p>d[b]?Math.floor(q*t*Math.pow(r,1/g[b]))+k:p>=n[b]?c:k;else if(null!=h)for(m=0;m<f;m++){if(h[m])for(b=0;b<l;b++)p=e[b][m],e[b][m]=p<n[b]&&p>d[b]?Math.floor((p-d[b])/v[b]*t)+k:p>=n[b]?c:k}else for(m=0;m<f;m++)for(b=0;b<l;b++)p=e[b][m],e[b][m]=p<n[b]&&p>d[b]?Math.floor((p-d[b])/v[b]*t)+k:p>=n[b]?c:k;a.pixelType="u8";a.updateStatistics();return a};x.lookupPixels=function(a,c){if(!E(a))return null;var e=a.pixels,
h=a.mask,d=a.width*a.height,n=e.length,g=c.lut;c=c.offset;var k,f;g&&1===g[0].length&&(g=e.map(function(){return g}));var l=[],b,m,p;if(c)if(null==h)for(k=0;k<n;k++){b=e[k];m=g[k];p=new Uint8Array(d);for(f=0;f<d;f++)p[f]=m[b[f]-c];l.push(p)}else for(k=0;k<n;k++){b=e[k];m=g[k];p=new Uint8Array(d);for(f=0;f<d;f++)h[f]&&(p[f]=m[b[f]-c]);l.push(p)}else if(null==h)for(k=0;k<n;k++){b=e[k];m=g[k];p=new Uint8Array(d);for(f=0;f<d;f++)p[f]=m[b[f]];l.push(p)}else for(k=0;k<n;k++){b=e[k];m=g[k];p=new Uint8Array(d);
for(f=0;f<d;f++)h[f]&&(p[f]=m[b[f]]);l.push(p)}a=new F({width:a.width,height:a.height,pixels:l,mask:h,pixelType:"u8"});a.updateStatistics();return a};x.remapColor=function(a,c){if(!E(a))return null;a=a.clone();var e=a.width*a.height,h=c.length,d=Math.floor(h/2),n=c[Math.floor(d)],g=a.pixels[0],k,f,l,b,m,p,q=!1,r=new Uint8Array(e),t=new Uint8Array(e),v=new Uint8Array(e),w=a.mask,u=4===c[0].mappedColor.length;w||(w=new Uint8Array(e),w.fill(u?255:1),a.mask=w);for(m=0;m<e;m++)if(w[m]){k=g[m];q=!1;p=d;
f=n;l=0;for(b=h-1;1<b-l;){if(k===f.value){q=!0;break}k>f.value?l=p:b=p;p=Math.floor((l+b)/2);f=c[Math.floor(p)]}q||(k===c[l].value?(f=c[l],q=!0):k===c[b].value?(f=c[b],q=!0):k<c[l].value?(q=!1,f=null):k>c[l].value&&(k<c[b].value?(f=c[l],q=!0):b===h-1?(q=!1,f=null):(f=c[b],q=!0)));q?(r[m]=f.mappedColor[0],t[m]=f.mappedColor[1],v[m]=f.mappedColor[2],w[m]=f.mappedColor[3]):r[m]=t[m]=v[m]=w[m]=0}a.pixels=[r,t,v];a.mask=w;a.pixelType="u8";a.maskIsAlpha=u;return a};x.getClipBounds=L;x.mosaicPixelData=function(a,
c){if(!a||0===a.length)return null;var e=a.filter(function(a){return a.pixelBlock})[0];if(!e)return null;var h=(e.extent.xmax-e.extent.xmin)/e.pixelBlock.width,d=(e.extent.ymax-e.extent.ymin)/e.pixelBlock.height,n=.01*Math.min(h,d),g=a.sort(function(a,b){return Math.abs(a.extent.ymax-b.extent.ymax)>n?b.extent.ymax-a.extent.ymax:Math.abs(a.extent.xmin-b.extent.xmin)>n?a.extent.xmin-b.extent.xmin:0}),k=Math.min.apply(null,g.map(function(a){return a.extent.xmin})),f=Math.min.apply(null,g.map(function(a){return a.extent.ymin})),
l=Math.max.apply(null,g.map(function(a){return a.extent.xmax})),b=Math.max.apply(null,g.map(function(a){return a.extent.ymax}));a={x:Math.round((c.xmin-k)/h),y:Math.round((b-c.ymax)/d)};k={width:Math.round((l-k)/h),height:Math.round((b-f)/d)};h={width:Math.round((c.xmax-c.xmin)/h),height:Math.round((c.ymax-c.ymin)/d)};if(Math.round(k.width/e.pixelBlock.width)*Math.round(k.height/e.pixelBlock.height)!==g.length||0>a.x||0>a.y||k.width<h.width||k.height<h.height)return null;e=g.map(function(a){return a.pixelBlock});
e=N(e,k,a,h);return{extent:c,pixelBlock:e}};x.mosaic=N;x.setValidBoundary=function(a,c,e){if(!E(a))return null;var h=a.width,d=a.height,n=c.x;c=c.y;var g=e.width+n;e=e.height+c;if(0>n||0>c||g>h||e>d||0===n&&0===c&&g===h&&e===d)return a;a.mask||(a.mask=new Uint8Array(h*d));for(var k=a.mask,f=0;f<d;f++)for(var l=f*h,b=0;b<h;b++)k[l+b]=f<c||f>=e||b<n||b>=g?0:1;a.updateStatistics();return a};x.clip=function(a,c,e){if(!E(a))return null;var h=c.x,d=c.y,n=c.x+e.width;c=c.x+e.height;if(c===a.height&&n===
a.width)return a;for(var g=a.pixels,k=a.mask,f=a.width,l=f*a.height,b=g.length,m=[],p=0;p<b;p++){for(var q=g[p],r=F.createEmptyBand(a.pixelType,l),t=0,v=d;v<=c;v++)for(var w=v*f,u=h;u<=n;u++)r[t++]=q[w+u];m.push(r)}var z;if(k)for(z=new Uint8Array(e.width*e.height),t=0,v=d;v<=c;v++)for(w=v*f,u=h;u<=n;u++)z[t++]=k[w+u];a=new F({width:e.width,height:e.height,pixels:m,mask:z});a.updateStatistics();return a};x.approximateTransform=function(a,c,e,h){if(!E(a))return null;var d=a.pixels,n=a.mask,g=a.pixelType,
k=a.width,f=a.height;a=F.getPixelArrayConstructor(g);var l=d.length,b=c.width,m=c.height;c=h.cols;h=h.rows;for(var p=Math.ceil(b/c),q=Math.ceil(m/h),r,t,v,w,u,z,y,x=new Uint16Array(b*m),A=new Uint16Array(b*m),H=0,G,I,J=0;J<q;J++)for(var K=0;K<p;K++){r=12*(J*p+K);t=e[r];v=e[r+1];w=e[r+2];u=e[r+3];z=e[r+4];y=e[r+5];for(var C=0;C<h;C++){H=(J*h+C)*b+K*c;I=(C+.5)/h;for(var D=0;D<C;D++)G=(D+.5)/c,x[H+D]=Math.round((t*G+v*I+w)*k-.5),A[H+D]=Math.round((u*G+z*I+y)*f-.5)}r+=6;t=e[r];v=e[r+1];w=e[r+2];u=e[r+
3];z=e[r+4];y=e[r+5];for(C=0;C<h;C++)for(H=(J*h+C)*b+K*c,I=(C+.5)/h,D=C;D<c;D++)G=(D+.5)/c,x[H+D]=Math.round((t*G+v*I+w)*k-.5),A[H+D]=Math.round((u*G+z*I+y)*f-.5)}e=function(a,c){for(var d=0;d<m;d++){r=d*b;for(var e=0;e<b;e++)a[r]=c[x[r]+A[r]*k],r++}};f=[];for(h=0;h<l;h++)c=new a(b*m),e(c,d[h]),f.push(c);d=new F({width:b,height:m,pixelType:g,pixels:f});n&&(d.mask=new Uint8Array(b*m),e(d.mask,n));d.updateStatistics();return d}});