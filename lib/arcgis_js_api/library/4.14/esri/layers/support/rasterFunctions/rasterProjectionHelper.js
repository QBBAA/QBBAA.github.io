// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../core/Error ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(K,n,L,M,H,I,N,F,y,l,J,z){Object.defineProperty(n,"__esModule",{value:!0});var A=function(a,c){var b=
(a.isWGS84||a.isWebMercator)&&(c.isWGS84||c.isWebMercator);return!(a.equals(c)||b)};n.defaultGridSpacing=32;n.load=function(){return I(this,void 0,void 0,function(){return H(this,function(a){switch(a.label){case 0:return l.isLoaded()||!l.isSupported()?[2,null]:[4,l.load()];case 1:return a.sent(),[2]}})})};n.projectResolution=function(a,c,b,d){void 0===d&&(d=null);if(a.spatialReference.equals(c))return a;var h=A(a.spatialReference,c);if(h&&!l.isLoaded())throw new y("rasterprojectionhelper-projectResolution",
"projection engine is not loaded");b=b.center;a=new F.Extent({xmin:b.x-a.x/2,xmax:b.x+a.x/2,ymin:b.y-a.y/2,ymax:b.y+a.y/2,spatialReference:a.spatialReference});d=h?l.project(a,c,d):z.project(a,c);return null==d?null:new F.Point(d.xmax-d.xmin,d.ymax-d.ymin,c)};n.projectPoint=function(a,c,b){void 0===b&&(b=null);if(a.spatialReference.equals(c))return a;var d=A(a.spatialReference,c);if(d&&!l.isLoaded())throw new y("rasterprojectionhelper-projectResolution","projection engine is not loaded");return d?
l.project(a,c,b):z.project(a,c)};n.projectExtent=function(a,c,b){void 0===b&&(b=null);if(a.spatialReference.equals(c))return a;var d=A(a.spatialReference,c);if(d&&!l.isLoaded())throw new y("rasterprojectionhelper-projectExtent","projection engine is not loaded");return d?l.project(a,c,b):z.project(a,c)};n.getProjectionOffsetGrid=function(a,c,b,d,h,v){void 0===d&&(d=null);void 0===h&&(h=!1);void 0===v&&(v=[n.defaultGridSpacing,n.defaultGridSpacing]);var r=c.spatialReference.equals(a.spatialReference),
w=A(a.spatialReference,c.spatialReference);if(w&&!l.isLoaded())throw new y("rasterprojectionhelper-projectResolution","projection engine is not loaded");if(!(a&&c&&b))return null;var x=a.xmin,k=a.ymin,p=a.xmax,B=a.ymax,C=a.spatialReference,D=c.spatialReference,t=J.getInfo(C),f=t&&t.valid[0],e=t&&t.valid[1],u=v[0]*b.x,g=v[1]*b.y,p=Math.ceil((p-x)/u-.1)+1,k=Math.ceil((B-k)/g-.1)+1,m;b=[];var E;for(a=0;a<p;a++){for(var G=[],q=0;q<k;q++)m=new F.Point({x:x+u*a,y:B-g*q,spatialReference:C}),m=r?m:w?l.project(m,
D,d):z.project(m,D),G.push(m),0<a&&h&&t&&m.x<E[q].x&&(m.x+=e-f),b.push((m.x-c.xmin)/(c.xmax-c.xmin)),b.push((c.ymax-m.y)/(c.ymax-c.ymin));E=G}c=[Math.abs((b[0]+b[4]+b[4*p]+b[4*p+4])/4-b[2*k+2]),Math.abs((b[1]+b[5]+b[4*k+1]+b[4*k+5])/4-b[2*k+3])];d=new Float32Array((p-1)*(k-1)*12);h=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);r=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(a=0;a<p-1;a++)for(q=0;q<k-1;q++){f=a*k*2+2*q;w=b[f];x=b[f+1];B=b[f+2];E=b[f+3];f+=2*k;C=b[f];D=b[f+1];t=b[f+2];f=b[f+3];e=0;u=12*
(q*(p-1)+a);for(g=0;3>g;g++)d[u++]=h[e++]*w+h[e++]*B+h[e++]*t;for(g=e=0;3>g;g++)d[u++]=h[e++]*x+h[e++]*E+h[e++]*f;for(g=e=0;3>g;g++)d[u++]=r[e++]*w+r[e++]*C+r[e++]*t;for(g=e=0;3>g;g++)d[u++]=r[e++]*x+r[e++]*D+r[e++]*f}return{offsets:b,error:c,coefficients:d,spacing:v,size:[p-1,k-1]}}});