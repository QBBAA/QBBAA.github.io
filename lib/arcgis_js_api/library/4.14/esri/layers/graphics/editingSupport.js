// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Graphic ../../core/Collection ../../core/Error ../../core/lang ../../core/promiseUtils ../../core/urlUtils ../../geometry/support/normalizeUtils".split(" "),function(E,p,n,m,w,x,q,e,y,t,z,A){function B(a,b,d){return m(this,void 0,void 0,function(){var h,g,c;return n(this,function(f){switch(f.label){case 0:return[4,a.load()];case 1:f.sent();h=a.source;if(!h||null==
h.applyEdits)return[2,t.reject(new e(a.type+"-layer:no-editing-support","Layer source does not support applyEdits capability",{layer:a}))];if(!a.editingEnabled)throw new e(a.type+"-layer:editing-disabled","Editing is disabled for layer",{layer:a});c=(g=h).applyEdits;return[4,C(a,b,d)];case 2:return[2,c.apply(g,[f.sent(),d])]}})})}function C(a,b,d){return m(this,void 0,void 0,function(){var h,g,c,f;return n(this,function(k){h=b.addFeatures&&b.addFeatures.length||b.updateFeatures&&b.updateFeatures.length||
b.deleteFeatures&&b.deleteFeatures.length;g=b.addAttachments&&b.addAttachments.length||b.updateAttachments&&b.updateAttachments.length||b.deleteAttachments&&b.deleteAttachments.length;if(!b||!h&&!g)throw new e(a.type+"-layer:missing-parameters","'addFeatures', 'updateFeatures', 'deleteFeatures', 'addAttachments', 'updateAttachments' or 'deleteAttachments' parameter is required");if(!a.capabilities.data.isVersioned&&d&&d.gdbVersion)throw new e(a.type+"-layer:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isVersioned'");
if(!a.capabilities.editing.supportsRollbackOnFailure&&d&&d.rollbackOnFailureEnabled)throw new e(a.type+"-layer:invalid-parameter","This layer does not support 'rollbackOnFailureEnabled' parameter. See: 'capabilities.editing.supportsRollbackOnFailure'");if(!a.capabilities.editing.supportsGlobalId&&d&&d.globalIdUsed)throw new e(a.type+"-layer:invalid-parameter","This layer does not support 'globalIdUsed' parameter. See: 'capabilities.editing.supportsGlobalId'");if(!a.capabilities.editing.supportsGlobalId&&
g)throw new e(a.type+"-layer:invalid-parameter","'addAttachments', 'updateAttachments' and 'deleteAttachments' are applicable only if the layer supports global ids. See: 'capabilities.editing.supportsGlobalId'");if((!d||!d.globalIdUsed)&&g)throw new e(a.type+"-layer:invalid-parameter","When 'addAttachments', 'updateAttachments' or 'deleteAttachments' is specified, globalIdUsed should be set to true");c=w({},b);c.addFeatures=q.isCollection(c.addFeatures)?c.addFeatures.toArray():c.addFeatures||[];c.updateFeatures=
q.isCollection(c.updateFeatures)?c.updateFeatures.toArray():c.updateFeatures||[];c.deleteFeatures=q.isCollection(c.deleteFeatures)?c.deleteFeatures.toArray():c.deleteFeatures||[];c.addAttachments=c.addAttachments||[];c.updateAttachments=c.updateAttachments||[];c.deleteAttachments=c.deleteAttachments||[];c.addFeatures=c.addFeatures.map(u);c.updateFeatures=c.updateFeatures.map(u);f=d&&d.globalIdUsed;c.addFeatures.forEach(function(b){return r(b,a,f)});c.updateFeatures.forEach(function(b){return r(b,
a,f)});c.deleteFeatures.forEach(function(b){return r(b,a,f)});c.addAttachments.forEach(function(b){return v(b,a)});c.updateAttachments.forEach(function(b){return v(b,a)});return[2,D(c)]})})}function r(a,b,d){if(d){if("attributes"in a&&!a.attributes[b.globalIdField])throw new e(b.type+"-layer:invalid-parameter","Feature should have 'globalId' when 'globalIdUsed' is true");if(!("attributes"in a||a.globalId))throw new e(b.type+"-layer:invalid-parameter","'globalId' of the feature should be passed when 'globalIdUsed' is true");
}}function v(a,b){var d=a.feature;a=a.attachment;if(!d||"attributes"in d&&!d.attributes[b.globalIdField])throw new e(b.type+"-layer:invalid-parameter","Attachment should have reference to a feature with 'globalId'");if(!("attributes"in d||d.globalId))throw new e(b.type+"-layer:invalid-parameter","Attachment should have reference to 'globalId' of the parent feature");if(!a.globalId)throw new e(b.type+"-layer:invalid-parameter","Attachment should have 'globalId'");if(!a.data&&!a.uploadId)throw new e(b.type+
"-layer:invalid-parameter","Attachment should have 'data' or 'uploadId'");if(!(a.data instanceof File&&a.data.name||a.name))throw new e(b.type+"-layer:invalid-parameter","'name' is required when attachment is specified as Base64 encoded string using 'data'");if(!b.capabilities.editing.supportsUploadWithItemId&&a.uploadId)throw new e(b.type+"-layer:invalid-parameter","This layer does not support 'uploadId' parameter. See: 'capabilities.editing.supportsUploadWithItemId'");if("string"===typeof a.data&&
(d=z.dataComponents(a.data))&&!d.isBase64)throw new e(b.type+"-layer:invalid-parameter","Attachment 'data' should be a Blob, File or Base64 encoded string");}function D(a){return m(this,void 0,void 0,function(){var b,d,e,g,c,f;return n(this,function(k){switch(k.label){case 0:return b=a.addFeatures,d=a.updateFeatures,e=b.concat(d).map(function(a){return a.geometry}),[4,A.normalizeCentralMeridian(e)];case 1:return g=k.sent(),c=b.length,f=d.length,g.slice(0,c).forEach(function(b,c){a.addFeatures[c].geometry=
b}),g.slice(c,c+f).forEach(function(b,c){a.updateFeatures[c].geometry=b}),[2,a]}})})}function u(a){var b=new x;a.attributes||(a.attributes={});b.geometry=a.geometry;b.attributes=a.attributes;return b}Object.defineProperty(p,"__esModule",{value:!0});p.isEditableLayer=function(a){return!0===a.get("capabilities.operations.supportsEditing")};p.applyEdits=function(a,b,d){return m(this,void 0,void 0,function(){var e,g,c,f,k,l,m;return n(this,function(h){switch(h.label){case 0:c={edits:b,result:t.create(function(a,
b){e=a;g=b})},a.emit("apply-edits",c),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,B(a,b,d)];case 2:return f=h.sent(),k=function(a){return a.filter(function(a){return!a.error}).map(y.clone)},l={addedFeatures:k(f.addFeatureResults),updatedFeatures:k(f.updateFeatureResults),deletedFeatures:k(f.deleteFeatureResults),addedAttachments:k(f.addAttachmentResults),updatedAttachments:k(f.updateAttachmentResults),deletedAttachments:k(f.deleteAttachmentResults)},(l.addedFeatures.length||l.updatedFeatures.length||
l.deletedFeatures.length||l.addedAttachments.length||l.updatedAttachments.length||l.deletedAttachments.length)&&a.emit("edits",l),e(l),[2,f];case 3:throw m=h.sent(),g(m),m;case 4:return[2]}})})}});