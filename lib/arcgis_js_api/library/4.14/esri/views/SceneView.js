// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["require","exports","../../core/unitUtils"],function(q,b,l){function f(b,a){a=l.getMetersPerUnitForSR(a);return b/(a*l.inchesPerMeter*96)}Object.defineProperty(b,"__esModule",{value:!0});b.getScale=function(b,a){a=a||b.extent;b=b.width;var e=l.getMetersPerUnitForSR(a&&a.spatialReference);return a&&b?a.width/b*e*l.inchesPerMeter*96:0};b.getResolutionForScale=f;b.getScaleForResolution=function(b,a){a=l.getMetersPerUnitForSR(a);return b*
a*l.inchesPerMeter*96};b.getExtentForScale=function(b,a){var e=b.extent;b=b.width;a=f(a,e.spatialReference);return e.clone().expand(a*b/e.width)}})},"esri/layers/support/layerUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.isTiledLayer=function(b){return b&&"base-tile"===b.type||"tile"===b.type||"elevation"===b.type||"base-elevation"===b.type||"open-street-map"===b.type||"web-tile"===b.type||"wmts"===b.type||"vector-tile"===b.type};b.serializeLayerDefinitions=
function(b){var f=/[:;]/,h=[],a=!1;if(b&&(b.forEach(function(d,n){h.push([n,d]);!a&&f.test(d)&&(a=!0)}),0<h.length)){b=void 0;if(a){var e={};h.forEach(function(a){e[a[0]]=a[1]});b=JSON.stringify(e)}else{var d=[];h.forEach(function(a){d.push(a[0]+":"+a[1])});b=d.join(";")}return b}return null};b.serializeTimeOptions=function(b){if(b){var f=[];b.forEach(function(b,a){f.push('"'+a+'":'+JSON.stringify(b))});if(f.length)return"{"+f.join(",")+"}"}};b.getLayersForScale=function(b,f){var h=[];if(0<b&&f)for(var a=
function(a){if(0<=f[a].parentLayerId&&-1===h.indexOf(f[a].parentLayerId)&&f.some(function(c){return c.id===f[a].parentLayerId}))return"continue";if(0<=f[a].id){var d=!0,n=f[a].maxScale,c=f[a].minScale;if(0<n||0<c)0<n&&0<c?d=n<=b&&b<=c:0<n?d=n<=b:0<c&&(d=b<=c);d&&h.push(f[a].id)}},e=0;e<f.length;e++)a(e);return h};b.areLabelsVisible=function(b){return!0===b.labelsVisible&&null!=b.labelingInfo&&0<b.labelingInfo.length}})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e,d,k){function n(g,a){return a?c[g].valueToClassName[a].split(" "):[]}Object.defineProperty(b,"__esModule",{value:!0});var c={widthBreakpoint:{getValue:function(c){var g=c.viewSize[0];c=c.breakpoints;var a=this.values;return g<=c.xsmall?a.xsmall:g<=c.small?a.small:g<=c.medium?a.medium:g<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(c){var g=c.viewSize[1];c=c.breakpoints;var a=this.values;return g<=c.xsmall?a.xsmall:g<=c.small?a.small:g<=c.medium?a.medium:g<=c.large?a.large:a.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(c){c=c.viewSize;var g=this.values;return c[1]>=c[0]?g.portrait:g.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},g={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=
function(r){return function(r){function p(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];c=r.apply(this,c)||this;c._breakpointsHandles=new e;c.orientation=null;c.widthBreakpoint=null;c.heightBreakpoint=null;c.breakpoints=g;return c}l(p,r);p.prototype.initialize=function(){this._breakpointsHandles.add(d.init(this,["breakpoints","size"],this._updateClassNames))};p.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=
null)};Object.defineProperty(p.prototype,"breakpoints",{set:function(c){var a=this._get("breakpoints");if(c!==a){a=(a=c)&&a.xsmall<a.small&&a.small<a.medium&&a.medium<a.large;if(!a){var d=JSON.stringify(g,null,2);console.warn("provided breakpoints are not valid, using defaults:"+d)}c=a?c:g;this._set("breakpoints",h({},c))}},enumerable:!0,configurable:!0});p.prototype._updateClassNames=function(){if(this.container){var g=a.acquire(),d=a.acquire(),k=!1,e;for(e in c){var m=this[e],p=c[e].getValue({viewSize:this.size,
breakpoints:this.breakpoints});m!==p&&(k=!0,this[e]=p,n(e,m).forEach(function(c){return d.push(c)}),n(e,p).forEach(function(c){return g.push(c)}))}k&&(this._applyClassNameChanges(g,d),a.release(g),a.release(d))}};p.prototype._applyClassNameChanges=function(c,g){var a=this.container;a&&(g.forEach(function(c){return a.classList.remove(c)}),c.forEach(function(c){return a.classList.add(c)}))};p.prototype._removeActiveClassNames=function(){var g=this.container;if(g)for(var a in c)n(a,this[a]).forEach(function(c){return g.classList.remove(c)})};
f([k.property()],p.prototype,"breakpoints",null);f([k.property()],p.prototype,"orientation",void 0);f([k.property()],p.prototype,"widthBreakpoint",void 0);f([k.property()],p.prototype,"heightBreakpoint",void 0);return p=f([k.subclass("esri.views.BreakpointsOwner")],p)}(k.declared(r))}})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),
function(q,b,l,f,h,a,e,d,k,n){return function(c){function g(g){g=c.call(this,g)||this;g.handles=new e;g.view=null;g.layerViews=new a;return g}l(g,c);g.prototype.initialize=function(){var c=this;this.handles.add(d.when(this,"view.map.ground",function(c){return c.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return c.layerViewsAfterChangesHandler()}))};g.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(g.prototype,
"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new n({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(c){return c.updating})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});
g.prototype.layerViewsAfterChangesHandler=function(){var c=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(g){return g.watch("updating",function(){return c.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};g.prototype.updateUpdating=function(){this.notifyChange("updating")};f([k.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],g.prototype,"elevationSampler",null);f([k.property({type:Boolean,dependsOn:["suspended"],
readOnly:!0})],g.prototype,"updating",null);f([k.property({constructOnly:!0})],g.prototype,"view",void 0);f([k.property({type:a,readOnly:!0})],g.prototype,"layerViews",void 0);f([k.property({readOnly:!0,dependsOn:["view.suspended"]})],g.prototype,"suspended",null);return g=f([k.subclass("esri.views.GroundView")],g)}(k.declared(h))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){var p=a.getLogger("esri.views.support.GroundViewElevationSampler");return function(a){function b(c){c=a.call(this,c)||this;c.demResolution={min:-1,max:-1};c.noDataValue=r.ELEVATION_NODATA_VALUE;return c}l(b,a);b.prototype.initialize=function(){var c=this;this.view.basemapTerrain.on("elevation-change",function(){return c.emit("changed",{})})};Object.defineProperty(b.prototype,"extent",{get:function(){var c=this.view.basemapTerrain;return c.extent&&c.spatialReference?
d.toExtent(c.extent,c.spatialReference):null},enumerable:!0,configurable:!0});b.prototype.elevationAt=function(c){var a=c.spatialReference,d=this.spatialReference;if(!n.canProject(a,d))return p.error("Cannot sample elevation at a location with spatial reference ("+(a?a.wkid:"unknown")+") different from the view ("+d.wkid+")"),null;k.extentContainsPoint(this.extent,c)||(a=this.extent,p.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(a.xmin+
", "+a.ymin+", "+a.xmax+", "+a.ymax)+")"));return g.getElevationAtPoint(this.view.basemapTerrain,c)};b.prototype.queryElevation=function(g){return c.updateGeometryElevation(g.clone(),this)};f([e.property({readOnly:!0})],b.prototype,"demResolution",void 0);f([e.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],b.prototype,"extent",null);f([e.property({readOnly:!0})],b.prototype,"noDataValue",void 0);f([e.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
b.prototype,"spatialReference",void 0);f([e.property({constructOnly:!0})],b.prototype,"view",void 0);return b=f([e.subclass("esri.views.support.GroundViewElevationSampler")],b)}(e.declared(h.EventedAccessor))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n){function c(c,a){var d=g(c,a.spatialReference);if(!d)return null;switch(c.type){case "point":c.z=a.elevationAt(d)||0;break;case "polyline":u.spatialReference=d.spatialReference;for(var m=c.hasM&&!c.hasZ,n=0;n<c.paths.length;n++)for(var k=c.paths[n],e=d.paths[n],p=0;p<k.length;p++){var r=k[p],b=e[p];u.x=b[0];u.y=b[1];b=a.elevationAt(u)||0;m&&(r[3]=r[2]);r[2]=b}c.hasZ=!0;break;case "multipoint":u.spatialReference=d.spatialReference;m=c.hasM&&!c.hasZ;for(n=0;n<c.points.length;n++)k=
c.points[n],e=d.points[n],u.x=e[0],u.y=e[1],e=a.elevationAt(u)||0,m&&(k[3]=k[2]),k[2]=e;c.hasZ=!0;break;default:h.neverReached(c)}return c}function g(c,g){var a=c.spatialReference;return a.equals(g)?c:n.canProject(a,g)?n.project(c,g):(r.error("Cannot project geometry spatial reference (wkid:"+a.wkid+") to elevation sampler spatial reference (wkid:"+g.wkid+")"),null)}Object.defineProperty(b,"__esModule",{value:!0});var r=a.getLogger("esri.layers.support.ElevationSampler");q=function(){function a(){}
a.prototype.queryElevation=function(g){return c(g.clone(),this)};a.prototype.on=function(){return t};a.prototype.projectIfRequired=function(c,a){return g(c,a)};return a}();b.ElevationSamplerBase=q;var p=function(c){function g(g,a,n){var m=c.call(this)||this;m.tile=g;m.noDataValue=n;m.extent=d.toExtent(g.tile.extent,a.spatialReference);n=e.getMetersPerUnitForSR(a.spatialReference);g=a.lodAt(g.tile.level).resolution*n;m.demResolution={min:g,max:g};return m}l(g,c);Object.defineProperty(g.prototype,"spatialReference",
{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});g.prototype.contains=function(c){c=this.projectIfRequired(c,this.spatialReference);return k.extentContainsPoint(this.extent,c)};g.prototype.elevationAt=function(c){var g=this.projectIfRequired(c,this.spatialReference);if(!g)return null;if(!this.contains(c)){var a=this.extent;r.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(a.xmin+", "+a.ymin+", "+a.xmax+
", "+a.ymax)+")")}return this.tile.sample(g.x,g.y)};return g}(q);b.TileElevationSampler=p;q=function(c){function g(g,a,n){var m=c.call(this)||this,k;"number"===typeof a?(m.noDataValue=a,k=null):(k=a,m.noDataValue=n);m.samplers=k?g.map(function(c){return new p(c,k,m.noDataValue)}):g;if(g=m.samplers[0])for(m.extent=g.extent.clone(),g=g.demResolution,m.demResolution={min:g.min,max:g.max},g=1;g<m.samplers.length;g++)a=m.samplers[g],m.extent.union(a.extent),m.demResolution.min=Math.min(m.demResolution.min,
a.demResolution.min),m.demResolution.max=Math.max(m.demResolution.max,a.demResolution.max);else m.extent=d.toExtent(d.create(),k.spatialReference),m.demResolution={min:0,max:0};return m}l(g,c);Object.defineProperty(g.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});g.prototype.elevationAt=function(c){var g=this.projectIfRequired(c,this.spatialReference);if(!g)return null;for(var a=0,d=this.samplers;a<d.length;a++){var n=d[a];if(n.contains(g))return n.elevationAt(g)}r.warn("#elevationAt()",
"Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler");return null};return g}(q);b.MultiTileElevationSampler=q;b.updateGeometryElevation=c;var u=new f.Point,t={remove:function(){}}})},"esri/views/3d/support/ElevationProvider":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.getElevationAtPoint=function(b,f,h){return b.getElevation(f.x,f.y,f.z||0,f.spatialReference,h)}})},"esri/views/3d/terrain/TerrainConst":function(){define("require exports ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/TilemapCache ./TilingScheme".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.TILE_LOADING_DEBUGLOG=!1;b.MAX_ROOT_TILES=64;b.MAX_PATCH_TESSELATION=512;b.MAX_MEMORY_LOD_BIAS=2.5;b.ELEVATION_NODATA_VALUE=l.clampFloat32(l.NUMBER_MAX_FLOAT32/10);b.LOADING_LEVEL_MODULO=2;b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.TILEMAP_SIZE=1<<h.TILEMAP_SIZE_EXP;b.WEBMERCATOR_WORLD_EXTENT=f.create();a.WebMercatorAuxiliarySphere.getExtent(0,0,0,b.WEBMERCATOR_WORLD_EXTENT);b.GEOGRAPHIC_WORLD_EXTENT=f.create([-180,-90,180,90]);
b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.GEOMETRY_VERTEX_STRIDE=5})},"esri/layers/support/TilemapCache":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Accessor ../../core/Error ../../core/Handles ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/urlUtils ../../core/watchUtils ../../core/accessorSupport/decorators ./Tilemap".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m){Object.defineProperty(b,"__esModule",{value:!0});b.TILEMAP_SIZE_EXP=5;var w=g.getLogger("esri.layers.support.TilemapCache");q=function(g){function k(a){a=g.call(this,a)||this;a._handles=new c;a._pendingTilemapRequests={};a._availableLevels={};a.levels=5;a.cacheByteSize=2097152;a.request=d;a._prefetchingEnabled=!0;return a}f(k,g);A=k;k.prototype.initialize=function(){var c=this;this._tilemapCache=new r(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl",
"layer.tileServers?"],function(){return c._initializeTilemapDefinition()}),v.init(this,"layer.tileInfo.lods",function(g){return c._initializeAvailableLevels(g)},!0)]);this._initializeTilemapDefinition()};k.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};k.prototype.castLevels=function(c){return 2>=c?(w.error("Minimum levels for Tilemap is 3, but got ",c),3):c};Object.defineProperty(k.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0});
k.prototype.fetchTilemap=function(c,g,a,d){var k=this;if(!this._availableLevels[c])return u.reject(new n("tilemap-cache:level-unavailable","Level "+c+" is unavailable in the service"));var e=this._tmpTilemapDefinition;if(c=this._tilemapFromCache(c,g,a,e))return u.resolve(c);var p=d&&d.signal;d=l({},d,{signal:null});return u.create(function(c,g){u.onAbort(p,function(){return g(u.createAbortError())});var a=m.tilemapDefinitionId(e),n=k._pendingTilemapRequests[a];if(!n){var n=m.Tilemap.fromDefinition(e,
d).then(function(c){k._tilemapCache.put(a,c,c.byteSize);return c}),r=function(){return delete k._pendingTilemapRequests[a]};k._pendingTilemapRequests[a]=n;n.then(r,r)}n.then(c,g)})};k.prototype.getAvailability=function(c,g,a){return this._availableLevels[c]?(c=this._tilemapFromCache(c,g,a,this._tmpTilemapDefinition))?c.getAvailability(g,a):"unknown":"unavailable"};k.prototype.getAvailabilityUpsample=function(c,g,a,m){m.level=c;m.row=g;m.col=a;c=this.layer.tileInfo;for(c.updateTileInfo(m);;)if(g=this.getAvailability(m.level,
m.row,m.col),"unavailable"===g){if(!c.upsampleTile(m))return"unavailable"}else return g};k.prototype.fetchAvailability=function(c,g,a,d){return this._availableLevels[c]?this.fetchTilemap(c,g,a,d).catch(function(c){return c}).then(function(d){if(d instanceof m.Tilemap)return d=d.getAvailability(g,a),"unavailable"===d?u.reject(new n("tile-map:tile-unavailable","Tile is not available",{level:c,row:g,col:a})):d;if(u.isAbortError(d))throw d;return"unknown"}):u.reject(new n("tilemap-cache:level-unavailable",
"Level "+c+" is unavailable in the service"))};k.prototype.fetchAvailabilityUpsample=function(c,g,a,m,d){var k=this;m.level=c;m.row=g;m.col=a;var n=this.layer.tileInfo;n.updateTileInfo(m);var e=this.fetchAvailability(c,g,a,d).catch(function(c){if(u.isAbortError(c))throw c;if(n.upsampleTile(m))return k.fetchAvailabilityUpsample(m.level,m.row,m.col,m);throw c;});this._fetchAvailabilityUpsamplePrefetch(m.id,c,g,a,d,e);return e};k.prototype._fetchAvailabilityUpsamplePrefetch=function(c,g,m,d,k,n){return e(this,
void 0,void 0,function(){var e,p,r,b,f,h,w,v,x,y;return a(this,function(a){switch(a.label){case 0:if(!this._prefetchingEnabled)return[2];e="prefetch-"+c;if(this._handles.has(e))return[2];p=u.createAbortController();n.then(function(){return p.abort()},function(){return p.abort()});r=!1;b={remove:function(){r||(r=!0,p.abort())}};this._handles.add(b,e);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.waitTicks(10,p.signal)];case 2:return a.sent(),[3,4];case 3:return a.sent(),[3,4];case 4:r||(r=!0,
this._handles.remove(e));if(u.isAborted(p))return[2];f={id:c,level:g,row:m,col:d};h=l({},k,{signal:p.signal});w=this.layer.tileInfo;v=function(c){var g=x.fetchAvailability(f.level,f.row,f.col,h);A._prefetches.push(g);c=function(){A._prefetches.removeUnordered(g)};g.then(c,c)};x=this;for(y=0;A._prefetches.length<A._maxPrefetch&&w.upsampleTile(f);++y)v(y);return[2]}})})};k.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var c=this.layer.parsedUrl,g=c.query;this._tilemapCache.clear();
this._tmpTilemapDefinition={service:{url:c.path,query:g?x.objectToQuery(g):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};k.prototype._tilemapFromCache=function(c,g,a,d){c=this._getTilemapDefinition(c,g,a,d);c=m.tilemapDefinitionId(c);return this._tilemapCache.get(c)};k.prototype._getTilemapDefinition=function(c,g,a,m){m.level=c;c=c>b.TILEMAP_SIZE_EXP;m.row=c?g-g%this.size:g;m.col=c?a-a%this.size:a;return m};
k.prototype._initializeAvailableLevels=function(c){var g=this;this._availableLevels={};c&&c.forEach(function(c){return g._availableLevels[c.level]=!0})};Object.defineProperty(k.prototype,"test",{get:function(){var c=this;return{get prefetchingEnabled(){return c._prefetchingEnabled},set prefetchingEnabled(g){c._prefetchingEnabled=g},hasTilemap:function(g,a,m){return!!c._tilemapFromCache(g,a,m,c._tmpTilemapDefinition)}}},enumerable:!0,configurable:!0});var A;k._maxPrefetch=4;k._prefetches=new p({initialSize:A._maxPrefetch});
h([y.property({constructOnly:!0,type:Number})],k.prototype,"levels",void 0);h([y.cast("levels")],k.prototype,"castLevels",null);h([y.property({readOnly:!0,dependsOn:["levels"],type:Number})],k.prototype,"size",null);h([y.property({constructOnly:!0,type:Number})],k.prototype,"cacheByteSize",void 0);h([y.property({constructOnly:!0})],k.prototype,"layer",void 0);h([y.property({constructOnly:!0})],k.prototype,"request",void 0);return k=A=h([y.subclass("esri.layers.support.TilemapCache")],k)}(y.declared(k));
b.TilemapCache=q})},"esri/layers/support/Tilemap":function(){define("require exports ../../core/tsSupport/assignHelper ../../request ../../core/arrayUtils ../../core/Error ../../core/lang".split(" "),function(q,b,l,f,h,a,e){function d(a){var d;"vector-tile"===a.service.type?d=a.service.url+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height:(d=a.service.tileServers,d=(d&&d.length?d[a.row%d.length]:a.service.url)+"/tilemap/"+a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height);(a=a.service.query)&&
(d=d+"?"+a);return d}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function k(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}k.prototype.getAvailability=function(a,c){if("unknown"!==this._allAvailability)return this._allAvailability;a=(a-this.location.top)*this.location.width+(c-this.location.left);c=a>>3;var g=this._tileAvailabilityBitSet;return 0>c||c>g.length?"unknown":g[c]&1<<a%8?"available":"unavailable"};k.prototype._updateFromData=
function(a){for(var c=!0,g=!0,d=new Uint8Array(Math.ceil(this.location.width*this.location.height/8)),k=0,n=0;n<a.length;n++){var e=n%8;a[n]?(g=!1,d[k]|=1<<e):c=!1;7===e&&++k}g?this._allAvailability="unavailable":c?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=d,this.byteSize+=d.length)};k.fromDefinition=function(n,c){var g=n.service.request||f,e=n.row,p=n.col,b=n.width,t=n.height,x={query:{f:"json"}};c=c?l({},x,c):x;return g(d(n),c).then(function(c){return c.data}).catch(function(c){if(c&&
c.details&&422===c.details.httpStatus)return{location:{top:e,left:p,width:b,height:t},valid:!0,data:h.constant(b*t,0)};throw c;}).then(function(c){if(c.location&&(c.location.top!==e||c.location.left!==p||c.location.width!==b||c.location.height!==t))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:c,definition:{top:e,left:p,width:b,height:t}});return k.fromJSON(c)})};k.fromJSON=function(a){k.validateJSON(a);var c=new k;c.location=Object.freeze(e.clone(a.location));
c._updateFromData(a.data);return Object.freeze(c)};k.validateJSON=function(d){if(!d||!d.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===d.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!d.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(d.data))throw new a("tilemap:data-mismatch","Data must be an array of numbers");if(d.data.length!==d.location.width*d.location.height)throw new a("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return k}();b.Tilemap=q;b.tilemapDefinitionId=function(a){return a.level+"/"+a.row+"/"+a.col+"/"+a.width+"/"+a.height};b.tilemapDefinitionUrl=d;b.default=q})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n){var c=n.webMercator.x2lon,g=n.webMercator.y2lat;q=function(){function p(c){var g=p.checkUnsupported(c);if(g)throw g;this.spatialReference=c.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84Comparable=n.canProjectToWGS84ComparableLonLat(this.spatialReference);this.origin=[c.origin.x,c.origin.y];this.pixelSize=c.size[0];this.dpi=c.dpi;var a=c.lods.reduce(function(c,g,a){g.level<c.min&&(c.min=g.level,c.minIndex=a);c.max=Math.max(c.max,
g.level);return c},{min:Infinity,minIndex:0,max:-Infinity}),d=c.lods[a.minIndex],k=Math.pow(2,d.level),g=d.resolution*k,d=d.scale*k;this.levels=Array(a.max+1);for(a=0;a<this.levels.length;a++)this.levels[a]={resolution:g,scale:d,tileSize:[g*c.size[0],g*c.size[1]]},g/=2,d/=2}p.prototype.clone=function(){return new p(this.toTileInfo())};p.prototype.toTileInfo=function(){return new k({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,
this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map(function(c,g){return{level:g,scale:c.scale,resolution:c.resolution}})})};p.prototype.getExtent=function(a,k,n,e,p){void 0===e&&(e=d.create());var m=this.levels[a];a=m.tileSize[0];m=m.tileSize[1];e[0]=this.origin[0]+n*a;e[2]=e[0]+a;e[3]=this.origin[1]-k*m;e[1]=e[3]-m;p&&(this._isWebMercator?(p[0]=c(e[0]),p[1]=g(e[1]),p[2]=c(e[2]),p[3]=g(e[3])):this._isWGS84Comparable&&(p[0]=h.deg2rad(e[0]),p[1]=h.deg2rad(e[1]),p[2]=h.deg2rad(e[2]),
p[3]=h.deg2rad(e[3])));return e};p.prototype.getExtentGeometry=function(c,g,a,d){void 0===d&&(d=new l.Extent);this.getExtent(c,g,a,r);d.spatialReference=this.spatialReference;d.xmin=r[0];d.ymin=r[1];d.xmax=r[2];d.ymax=r[3];d.zmin=void 0;d.zmax=void 0;return d};p.prototype.ensureMaxLod=function(c){if(null==c)return!1;for(var g=!1;this.levels.length<=c;){var g=this.levels[this.levels.length-1],a=g.resolution/2;this.levels.push({resolution:a,scale:g.scale/2,tileSize:[a*this.pixelSize,a*this.pixelSize]});
g=!0}return g};p.prototype.capMaxLod=function(c){this.levels.length>c+1&&(this.levels.length=c+1)};p.prototype.getMaxLod=function(){return this.levels.length-1};p.prototype.scaleAtLevel=function(c){return this.levels[0].scale/Math.pow(2,c)};p.prototype.levelAtScale=function(c){var g=this.levels[0].scale;return c>=g?0:Math.log(g/c)*Math.LOG2E};p.prototype.resolutionAtLevel=function(c){return this.levels[0].resolution/Math.pow(2,c)};p.prototype.compatibleWith=function(c){if(!(c instanceof p)){if(p.checkUnsupported(c))return!1;
c=new p(c)}if(!c.spatialReference.equals(this.spatialReference)||c.pixelSize!==this.pixelSize)return!1;var g=Math.min(this.levels.length,c.levels.length)-1,a=this.levels[g].resolution,d=.5*a;if(!h.floatEqualAbsolute(c.origin[0],this.origin[0],d)||!h.floatEqualAbsolute(c.origin[1],this.origin[1],d))return!1;d=.5*a/Math.pow(2,g)/this.pixelSize*12;return h.floatEqualAbsolute(a,c.levels[g].resolution,d)};p.prototype.rootTilesInExtent=function(c,g,a){var d=this.levels[0].tileSize;if(0===d[0]||0===d[1])return[];
p.computeRowColExtent(c,d,this.origin,r);c=r[1];var k=r[3],m=r[0],n=r[2],e=n-m,b=k-c;e*b>a&&(a=Math.floor(Math.sqrt(a)),b>a&&(c=c+Math.floor(.5*b)-Math.floor(.5*a),k=c+a),e>a&&(m=m+Math.floor(.5*e)-Math.floor(.5*a),n=m+a));a=[];for(e=c;e<k;e++)for(b=m;b<n;b++)a.push([0,e,b]);g&&(g[0]=this.origin[0]+m*d[0],g[1]=this.origin[1]-k*d[1],g[2]=this.origin[0]+n*d[0],g[3]=this.origin[1]-c*d[1]);return a};p.computeRowColExtent=function(c,g,a,d){var k=.001*(c[2]-c[0]+(c[3]-c[1]));d[0]=Math.floor((c[0]+k-a[0])/
g[0]);d[2]=Math.ceil((c[2]-k-a[0])/g[0]);d[1]=Math.floor((a[1]-c[3]+k)/g[1]);d[3]=Math.ceil((a[1]-c[1]-k)/g[1])};p.isPowerOfTwo=function(c){c=c.lods;var g=c[0].resolution*Math.pow(2,c[0].level);return!c.some(function(c){return!h.floatEqualRelative(c.resolution,g/Math.pow(2,c.level))})};p.hasGapInLevels=function(c){c=c.lods.map(function(c){return c.level});c.sort(function(c,g){return c-g});for(var g=1;g<c.length;g++)if(c[g]!==c[0]+g)return!0;return!1};p.tileSizeSupported=function(c){var g=c.size[1];
return g===c.size[0]&&0===(g&g-1)&&128<=g&&512>=g};p.checkUnsupported=function(c){return c?1>c.lods.length?new f("tilingscheme:generic","Tiling scheme must have at least one level"):p.isPowerOfTwo(c)?p.hasGapInLevels(c)?new f("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):p.tileSizeSupported(c)?null:new f("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new f("tilingscheme:power-of-two","Tiling scheme must be power of two"):
new f("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};p.fromExtent=function(c,g){var d=c[2]-c[0],n=c[3]-c[1],e=a.getMetersPerUnitForSR(g),m=1.2*Math.max(d,n);c=new p(new k({size:[256,256],origin:{x:c[0]-.5*(m-d),y:c[3]+.5*(m-n)},lods:[{level:0,resolution:m/256,scale:1/(256/96*.0254/(m*e))}],spatialReference:g}));c.ensureMaxLod(20);return c};p.makeWebMercatorAuxiliarySphere=function(c){var g=new p(p.WebMercatorAuxiliarySphereTileInfo);g.ensureMaxLod(c);return g};p.makeGCSWithTileSize=
function(c,g,a){void 0===g&&(g=256);void 0===a&&(a=16);var d=256/g;c=new p(new k({size:[g,g],origin:{x:-180,y:90,spatialReference:c},spatialReference:c,lods:[{level:0,resolution:.703125*d,scale:2.95497598570834E8*d}]}));c.ensureMaxLod(a);return c};Object.defineProperty(p.prototype,"test",{get:function(){return{isWebMercator:this._isWebMercator,isWGS84:this._isWGS84Comparable}},enumerable:!0,configurable:!0});p.WebMercatorAuxiliarySphereTileInfo=new k({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:e.WebMercator},spatialReference:e.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});p.WebMercatorAuxiliarySphere=p.makeWebMercatorAuxiliarySphere(19);return p}();var r=d.create();return q})},"esri/layers/support/TileInfo":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/jsonMap ../../core/JSONSupport ../../core/unitUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){var t=new e.default({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return function(d){function e(c){c=d.call(this,c)||this;c.dpi=96;c.format=null;c.origin=null;c.minScale=0;c.maxScale=0;c.size=null;c.spatialReference=null;return c}f(e,d);b=e;e.create=function(c){void 0===c&&(c=
{size:256,spatialReference:a.SpatialReference.WebMercator});var g=c.resolutionFactor||1,d=c.scales,m=c.size||256;c=c.spatialReference||a.SpatialReference.WebMercator;if(!r.isValid(c)){g=[];if(d)for(var e=0;e<d.length;e++){var n=d[e];g.push({level:e,scale:n,resolution:n})}else for(var p=5E-4,e=23;0<=e;e--)g.unshift({level:e,scale:p,resolution:p}),p*=2;return new b({dpi:96,lods:g,origin:new a.Point(0,0,c),size:[m,m],spatialReference:c})}var f=(e=r.getInfo(c))?new a.Point(e.origin[0],e.origin[1],c):
new a.Point(0,0,c),h=1/(39.37*k.getMetersPerUnitForSR(c)*96),t=[];if(d)for(e=0;e<d.length;e++)n=d[e],p=n*h,t.push({level:e,scale:n,resolution:p});else for(n=r.isGeographic(c)?512/m*5.916575275917094E8:256/m*5.91657527591555E8,d=Math.ceil(24/g),t.push({level:0,scale:n,resolution:n*h}),e=1;e<d;e++)n/=Math.pow(2,g),p=n*h,t.push({level:e,scale:n,resolution:p});return new b({dpi:96,lods:t,origin:f,size:[m,m],spatialReference:c})};Object.defineProperty(e.prototype,"isWrappable",{get:function(){var c=this.spatialReference,
g=this.origin;if(c&&g){var a=r.getInfo(c);return c.isWrappable&&Math.abs(a.origin[0]-g.x)<=a.dx}return!1},enumerable:!0,configurable:!0});e.prototype.readOrigin=function(c,g){return a.Point.fromJSON(l({spatialReference:g.spatialReference},c))};Object.defineProperty(e.prototype,"lods",{set:function(c){var g=this,a=0,d=0,m=[];this._levelToLOD={};c&&(a=-Infinity,d=Infinity,c.forEach(function(c){m.push(c.scale);a=c.scale>a?c.scale:a;d=c.scale<d?c.scale:d;g._levelToLOD[c.level]=c}));this._set("scales",
m);this._set("minScale",a);this._set("maxScale",d);this._set("lods",c);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});e.prototype.readSize=function(c,g){return[g.cols,g.rows]};e.prototype.writeSize=function(c,g){g.cols=c[0];g.rows=c[0]};e.prototype.zoomToScale=function(c){var g=this.scales;if(0>=c)return g[0];if(c>=g.length)return g[g.length-1];var a=Math.round(c);return g[a]+(a-c)*(g[Math.round(c-.5)]-g[a])};e.prototype.scaleToZoom=function(c){for(var g=this.scales,a=g.length-
1,d=0;d<a;d++){var m=g[d],e=g[d+1];if(m<=c)break;if(e===c)return d+1;if(m>c&&e<c)return d+1-(c-e)/(m-e)}return d};e.prototype.snapScale=function(c,g){void 0===g&&(g=.95);c=this.scaleToZoom(c);return c%Math.floor(c)>=g?this.zoomToScale(Math.ceil(c)):this.zoomToScale(Math.floor(c))};e.prototype.tileAt=function(c,a,d,e){var m=this.lodAt(c);if(!m)return null;var k;if("number"===typeof a)k=a,a=d;else{if(r.equals(a.spatialReference,this.spatialReference))k=a.x,a=a.y;else{e=p.project(a,this.spatialReference);
if(!e)return null;k=e.x;a=e.y}e=d}d=m.resolution*this.size[0];m=m.resolution*this.size[1];e||(e={id:null,level:0,row:0,col:0,extent:g.create()});e.level=c;e.row=Math.floor((this.origin.y-a)/m+.001);e.col=Math.floor((k-this.origin.x)/d+.001);this.updateTileInfo(e);return e};e.prototype.updateTileInfo=function(c){var a=this.lodAt(c.level);if(a){var d=a.resolution*this.size[0],a=a.resolution*this.size[1];c.id=c.level+"/"+c.row+"/"+c.col;c.extent||(c.extent=g.create());c.extent[0]=this.origin.x+c.col*
d;c.extent[1]=this.origin.y-(c.row+1)*a;c.extent[2]=c.extent[0]+d;c.extent[3]=c.extent[1]+a}};e.prototype.upsampleTile=function(c){var g=this._upsampleLevels[c.level];if(!g||-1===g.parentLevel)return!1;c.level=g.parentLevel;c.row=Math.floor(c.row/g.factor+.001);c.col=Math.floor(c.col/g.factor+.001);this.updateTileInfo(c);return!0};e.prototype.getTileBounds=function(c,g){var a=this.lodAt(g.level).resolution,d=a*this.size[0],a=a*this.size[1];c[0]=this.origin.x+g.col*d;c[1]=this.origin.y-(g.row+1)*a;
c[2]=c[0]+d;c[3]=c[1]+a;return c};e.prototype.lodAt=function(c){return this._levelToLOD&&this._levelToLOD[c]||null};e.prototype.clone=function(){return b.fromJSON(this.write({}))};e.prototype._initializeUpsampleLevels=function(){var c=this.lods;this._upsampleLevels=[];for(var g=null,a=0;a<c.length;a++){var d=c[a];this._upsampleLevels[d.level]={parentLevel:g?g.level:-1,factor:g?g.resolution/d.resolution:0};g=d}};var b;h([n.property({type:Number,json:{write:!0}})],e.prototype,"compressionQuality",void 0);
h([n.property({type:Number,json:{write:!0}})],e.prototype,"dpi",void 0);h([n.property({type:String,json:{read:t.read,write:t.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"format",void 0);h([n.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],e.prototype,"isWrappable",null);h([n.property({type:a.Point,json:{write:!0}})],e.prototype,"origin",void 0);h([n.reader("origin")],e.prototype,"readOrigin",null);h([n.property({type:[u],value:null,json:{write:!0}})],e.prototype,
"lods",null);h([n.property({readOnly:!0})],e.prototype,"minScale",void 0);h([n.property({readOnly:!0})],e.prototype,"maxScale",void 0);h([n.property({readOnly:!0})],e.prototype,"scales",void 0);h([n.property({cast:function(c){return Array.isArray(c)?c:"number"===typeof c?[c,c]:[256,256]}})],e.prototype,"size",void 0);h([n.reader("size",["rows","cols"])],e.prototype,"readSize",null);h([n.writer("size",{cols:{type:c.Integer},rows:{type:c.Integer}})],e.prototype,"writeSize",null);h([n.property({type:a.SpatialReference,
json:{write:!0}})],e.prototype,"spatialReference",void 0);return e=b=h([n.subclass("esri.layers.support.TileInfo")],e)}(n.declared(d.JSONSupport))})},"esri/layers/support/LOD":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType".split(" "),function(q,b,l,f,h,a,e){return function(d){function k(c){c=d.call(this,c)||this;c.level=0;c.levelValue=
null;c.resolution=0;c.scale=0;return c}l(k,d);n=k;k.prototype.clone=function(){return new n({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};var n;f([a.property({type:e.Integer,json:{write:!0}})],k.prototype,"level",void 0);f([a.property({type:String,json:{write:!0}})],k.prototype,"levelValue",void 0);f([a.property({type:Number,json:{write:!0}})],k.prototype,"resolution",void 0);f([a.property({type:Number,json:{write:!0}})],k.prototype,"scale",void 0);return k=
n=f([a.subclass("esri.layers.support.LOD")],k)}(a.declared(h.JSONSupport))})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ../webgl-engine/lib/BufferVectorMath".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(c,g,a,d){2===c.length?(U[0]=c[0],U[1]=c[1],U[2]=0,c=U):c===a&&(e.vec3.copy(U,c),c=U);return t(c,g,0,a,d,0,1)}function t(c,g,a,d,e,m,k){void 0===k&&(k=1);g=J(g,e,W);if(f.isNone(g))return!1;if(g===v){if(c===d&&a===m)return!0;for(g=a+3*k;a<g;a++,m++)d[m]=c[a];return!0}for(k=a+3*k;a<k;a+=3,m+=3)g(c,a,d,m);return!0}function x(c,g){if(g.spatialReference===c)return g.spatialReferenceId;g.spatialReference=c;"metersPerUnit"in g&&(g.metersPerUnit=h.getMetersPerUnitForSR(c,
1));return c.wkt===b.SphericalECEFSpatialReference.wkt?g.spatialReferenceId=1:c.isWGS84?g.spatialReferenceId=2:c.isWebMercator?g.spatialReferenceId=3:c.wkt===b.WGS84ECEFSpatialReference.wkt?g.spatialReferenceId=4:4490===c.wkid?g.spatialReferenceId=5:g.spatialReferenceId=0}function v(c,g,a,d){a[d++]=c[g++];a[d++]=c[g++];a[d]=c[g]}function y(c,g,a,d){a[d++]=F*(c[g++]/r.earthRadius);a[d++]=F*(Math.PI/2-2*Math.atan(Math.exp(-1*c[g++]/r.earthRadius)));a[d]=c[g]}function m(c,g,a,d){var m=.4999999*Math.PI,
m=l.clamp(V*c[g+1],-m,m),m=Math.sin(m);a[d++]=V*c[g]*r.earthRadius;a[d++]=r.halfEarthRadius*Math.log((1+m)/(1-m));a[d]=c[g+2]}function w(c,g,a){g=x(g,N);g=Y[g][6];if(f.isNone(g))return!1;g(c,0,U,0);a!==U&&(a[0]=U[0],a[1]=U[1],2<a.length&&(a[2]=U[2]));return!0}function A(c,g){U[0]=c.x;U[1]=c.y;U[2]=c.hasZ?c.z:0;return w(U,c.spatialReference,g)}function B(c,g,a,d){var m=r.earthRadius+c[g+2],e=V*c[g+1];c=V*c[g];g=Math.cos(e);a[d++]=Math.cos(c)*g*m;a[d++]=Math.sin(c)*g*m;a[d]=Math.sin(e)*m}function C(c,
g,a,d){var m=p.Vec3Compact.length(c,g),e=l.asinClamped(c[g+2]/(0===m?1:m)),k=Math.cos(e)*m;c=(0<c[g+1]?1:-1)*l.acosClamped(c[g]/(0===k?1:k));a[d++]=F*c;a[d++]=F*e;a[d]=m-r.earthRadius}function E(c,g,a,d){var m=ca,e=V*c[g],k=V*c[g+1];c=c[g+2];g=Math.sin(k);var k=Math.cos(k),n=m.a/Math.sqrt(1-m.e2*g*g);a[d++]=(n+c)*k*Math.cos(e);a[d++]=(n+c)*k*Math.sin(e);a[d++]=(n*(1-m.e2)+c)*g}function G(c,g,a,d){var m=ca,e=c[g],k=c[g+1];c=c[g+2];var n,p,r,b,f,h;g=Math.abs(c);n=e*e+k*k;p=Math.sqrt(n);r=n+c*c;b=Math.sqrt(r);
e=Math.atan2(k,e);f=c*c/r;r=n/r;k=m.a2/b;n=m.a3-m.a4/b;.3<r?(f=g/b*(1+r*(m.a1+k+f*n)/b),b=Math.asin(f),k=f*f,r=Math.sqrt(1-k)):(r=p/b*(1-f*(m.a5-k-r*n)/b),b=Math.acos(r),k=1-r*r,f=Math.sqrt(k));h=1-m.e2*k;k=m.a/Math.sqrt(h);m=m.a6*k;k=p-k*r;n=g-m*f;g=r*k+f*n;p=r*n-f*k;m=p/(m/h+g);b+=m;0>c&&(b=-b);a[d++]=F*e;a[d++]=F*b;a[d]=g+p*m/2}function J(c,g,a){void 0===a&&(a=K());return I(c,g,a).projector}function I(c,g,a){if(a.source.spatialReference===c&&a.dest.spatialReference===g)return a;var d=x(c,a.source),
m=x(g,a.dest);0===d&&0===m?c.equals(g)?a.projector=v:a.projector=null:a.projector=Y[d][m];return a}function K(){return{source:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:v}}Object.defineProperty(b,"__esModule",{value:!0});var H,L,P,S,R,O,Q,T;b.SphericalECEFSpatialReference=new n({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
b.WGS84ECEFSpatialReference=new n({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});b.canProject=function(c,g){return!!J(c,g,W)};b.vectorToVector=u;b.pointToPoint=
function(c,g,a,d){void 0===a&&(a=g.spatialReference);void 0===d&&(d=0);U[0]=c.x;U[1]=c.y;var m=c.z;U[2]=void 0!==m?m:d;if(!t(U,c.spatialReference,0,U,a,0,1))return!1;g.x=U[0];g.y=U[1];g.spatialReference=a;void 0!==m?(g.z=U[2],g.hasZ=!0):(g.z=void 0,g.hasZ=!1);return!0};b.pointToVector=function(c,g,a,d){void 0===d&&(d=0);U[0]=c.x;U[1]=c.y;var m=c.z;U[2]=void 0!==m?m:d;return t(U,c.spatialReference,0,g,a,0,1)};b.vectorToPoint=function(c,a,d,m){d instanceof k?m=m||d.spatialReference:g.isPoint(d)?(d.hasZ=
!0,m=m||d.spatialReference):(m=d,d=new k({spatialReference:m}));return t(c,a,0,U,m,0,1)?(d.x=U[0],d.y=U[1],d.z=U[2],d.spatialReference=m,d):null};b.xyzToVector=function(c,g,a,d,m,e){U[0]=c;U[1]=g;U[2]=a;return t(U,d,0,m,e,0,1)};b.bufferToBuffer=t;b.computeLinearTransformation=function(c,g,d,e){var k=x(c,N),n=x(e,Z);if(k===n&&1!==n&&(0!==k||c.equals(e)))return a.mat4.identity(d),a.mat4.translate(d,d,g),!0;if(1===n){c=Y[k][6];n=Y[6][n];if(f.isNone(c)||f.isNone(n))return!1;c(g,0,ea,0);n(ea,0,ha,0);c=
V*ea[0];n=V*ea[1];g=Math.sin(c);c=Math.cos(c);e=Math.sin(n);n=Math.cos(n);d[0]=-g;d[4]=-e*c;d[8]=n*c;d[12]=ha[0];d[1]=c;d[5]=-e*g;d[9]=n*g;d[13]=ha[1];d[2]=0;d[6]=n;d[10]=e;d[14]=ha[2];d[3]=0;d[7]=0;d[11]=0;d[15]=1;return!0}if(3===n&&(2===k||1===k)){c=Y[k][6];if(f.isNone(c))return!1;c(g,0,ea,0);g=V*ea[1];m(ea,0,ha,0);a.mat4.identity(d);a.mat4.translate(d,d,ha);g=1/Math.cos(g);a.mat4.scale(d,d,[g,g,1]);return!0}return!1};b.transformDirection=function(c,g,a,d,m){e.vec3.copy(ka,c);e.vec3.add(ba,c,g);
u(ka,a,ka,m);u(ba,a,ba,m);e.vec3.subtract(d,ba,ka);e.vec3.normalize(d,d)};b.mbsToMbs=function(c,g,a,d){g=I(g,d,aa);if(g.projector===v)return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],!0;if(f.isNone(g.projector))return!1;d=g.source;var e=g.dest;if(3===e.spatialReferenceId){g=Y[d.spatialReferenceId][2];if(f.isNone(g))return!1;g(c,0,ea,0);g=Math.abs(V*ea[1])+Math.asin(c[3]/(r.earthRadius+c[2]));m(ea,0,a,0);a[3]=g>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(g)*c[3];return!0}g.projector(c,0,a,0);a[3]=c[3]*
d.metersPerUnit/e.metersPerUnit;return!0};b.extentToBoundingBox=function(c,g,a){if(null==c)return!1;var d;U[0]=null!=c.xmin?c.xmin:0;U[1]=null!=c.ymin?c.ymin:0;U[2]=null!=c.zmin?c.zmin:0;d=t(U,c.spatialReference,0,g,a,0,1);U[0]=null!=c.xmax?c.xmax:0;U[1]=null!=c.ymax?c.ymax:0;U[2]=null!=c.zmax?c.zmax:0;d=d&&t(U,c.spatialReference,0,g,a,3,1);null==c.xmin&&(g[0]=-Infinity);null==c.ymin&&(g[1]=-Infinity);null==c.zmin&&(g[2]=-Infinity);null==c.xmax&&(g[3]=Infinity);null==c.ymax&&(g[4]=Infinity);null==
c.zmax&&(g[5]=Infinity);return d};b.extentToBoundingRect=function(c,g,a){if(null==c)return!1;var d;U[0]=null!=c.xmin?c.xmin:0;U[1]=null!=c.ymin?c.ymin:0;U[2]=null!=c.zmin?c.zmin:0;d=t(U,c.spatialReference,0,U,a,0,1);g[0]=U[0];g[1]=U[1];U[0]=null!=c.xmax?c.xmax:0;U[1]=null!=c.ymax?c.ymax:0;U[2]=null!=c.zmax?c.zmax:0;d=d&&t(U,c.spatialReference,0,U,a,0,1);g[2]=U[0];g[3]=U[1];null==c.xmin&&(g[0]=-Infinity);null==c.ymin&&(g[1]=-Infinity);null==c.xmax&&(g[2]=Infinity);null==c.ymax&&(g[3]=Infinity);return d};
b.boundingRectToBoundingRect=function(g,a,d,m){if(null==g)return!1;if(a.equals(m))return c.set(d,g),!0;var e;U[0]=g[0];U[1]=g[1];U[2]=0;e=t(U,a,0,U,m,0,1);d[0]=U[0];d[1]=U[1];U[0]=g[2];U[1]=g[3];U[2]=0;e=e&&t(U,a,0,U,m,0,1);d[2]=U[0];d[3]=U[1];return e};(function(c){c.x2lon=function(c){return c/r.earthRadius};c.y2lat=function(c){return Math.PI/2-2*Math.atan(Math.exp(-1*c/r.earthRadius))};c.lon2x=function(c){return c*r.earthRadius};c.lat2y=function(c){c=Math.sin(c);return r.earthRadius/2*Math.log((1+
c)/(1-c))}})(b.webMercator||(b.webMercator={}));b.canProjectToWGS84ComparableLonLat=function(c){c=x(c,N);return!!Y[c][6]};b.vectorToWGS84ComparableLonLat=w;b.pointToWGS84ComparableLonLat=A;b.pointToWGS84ComparableLonLatPoint=function(c,g){var a=x(g.spatialReference,Z);return f.isNone(Y[6][a])?!1:A(c,U)?(g.x=U[0],g.y=U[1],g.z=U[2],!0):!1};b.wgs84ComparableLonLatToECEF=function(c,g,a,d){void 0===d&&(d=0);d=r.earthRadius+d;var m=Math.cos(a);c[0]=Math.cos(g)*m*d;c[1]=Math.sin(g)*m*d;c[2]=Math.sin(a)*
d};var Y=(H={},H[2]=(L={},L[5]=null,L[6]=v,L[1]=B,L[0]=null,L[3]=m,L[2]=v,L[4]=E,L),H[5]=(P={},P[5]=v,P[6]=v,P[1]=B,P[0]=null,P[3]=null,P[2]=null,P[4]=E,P),H[3]=(S={},S[5]=null,S[6]=y,S[1]=function(c,g,a,d){y(c,g,a,d);B(a,d,a,d)},S[0]=null,S[3]=v,S[2]=y,S[4]=function(c,g,a,d){y(c,g,a,d);E(a,d,a,d)},S),H[4]=(R={},R[5]=G,R[6]=G,R[1]=function(c,g,a,d){G(c,g,a,d);B(a,d,a,d)},R[0]=null,R[3]=function(c,g,a,d){G(c,g,a,d);m(a,d,a,d)},R[2]=G,R[4]=v,R),H[1]=(O={},O[5]=C,O[6]=C,O[1]=v,O[0]=null,O[3]=function(c,
g,a,d){C(c,g,a,d);m(a,d,a,d)},O[2]=C,O[4]=function(c,g,a,d){C(c,g,a,d);E(a,d,a,d)},O),H[0]=(Q={},Q[5]=null,Q[6]=null,Q[1]=null,Q[0]=v,Q[3]=null,Q[2]=null,Q[4]=null,Q),H[6]=(T={},T[5]=null,T[6]=v,T[1]=B,T[0]=null,T[3]=null,T[2]=v,T[4]=E,T),H);b.getProjector=J;var N={spatialReference:null,spatialReferenceId:0},Z={spatialReference:null,spatialReferenceId:0},W=K(),aa=K(),V=l.deg2rad(1),F=l.rad2deg(1),ca={a:6378137,e2:.006694379990137799,a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,
a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},U=d.vec3f64.create(),ea=d.vec3f64.create(),ha=d.vec3f64.create(),ka=d.vec3f64.create(),ba=d.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=l})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64","./common"],function(q,b,l,f){function h(a){a[0]=1;a[1]=
0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function a(a,c,g){var d=c[0],e=c[1],k=c[2],n=c[3],b=c[4],f=c[5],h=c[6],m=c[7],w=c[8],A=c[9],B=c[10],l=c[11],E=c[12],G=c[13],J=c[14];c=c[15];var I=g[0],K=g[1],H=g[2],L=g[3];a[0]=I*d+K*b+H*w+L*E;a[1]=I*e+K*f+H*A+L*G;a[2]=I*k+K*h+H*B+L*J;a[3]=I*n+K*m+H*l+L*c;I=g[4];K=g[5];H=g[6];L=g[7];a[4]=I*d+K*b+H*w+L*E;a[5]=I*e+K*f+H*A+L*G;a[6]=I*k+K*h+H*B+L*J;a[7]=I*n+K*m+H*l+L*c;I=g[8];K=g[9];H=g[10];
L=g[11];a[8]=I*d+K*b+H*w+L*E;a[9]=I*e+K*f+H*A+L*G;a[10]=I*k+K*h+H*B+L*J;a[11]=I*n+K*m+H*l+L*c;I=g[12];K=g[13];H=g[14];L=g[15];a[12]=I*d+K*b+H*w+L*E;a[13]=I*e+K*f+H*A+L*G;a[14]=I*k+K*h+H*B+L*J;a[15]=I*n+K*m+H*l+L*c;return a}function e(a,c,g){var d=c[0],e=c[1],k=c[2],n=c[3],b=d+d,f=e+e,h=k+k;c=d*b;var m=d*f,d=d*h,w=e*f,e=e*h,k=k*h,b=n*b,f=n*f,n=n*h;a[0]=1-(w+k);a[1]=m+n;a[2]=d-f;a[3]=0;a[4]=m-n;a[5]=1-(c+k);a[6]=e+b;a[7]=0;a[8]=d+f;a[9]=e-b;a[10]=1-(c+w);a[11]=0;a[12]=g[0];a[13]=g[1];a[14]=g[2];a[15]=
1;return a}function d(a,c,g){a[0]=c[0]-g[0];a[1]=c[1]-g[1];a[2]=c[2]-g[2];a[3]=c[3]-g[3];a[4]=c[4]-g[4];a[5]=c[5]-g[5];a[6]=c[6]-g[6];a[7]=c[7]-g[7];a[8]=c[8]-g[8];a[9]=c[9]-g[9];a[10]=c[10]-g[10];a[11]=c[11]-g[11];a[12]=c[12]-g[12];a[13]=c[13]-g[13];a[14]=c[14]-g[14];a[15]=c[15]-g[15];return a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];
a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.set=function(a,c,g,d,e,k,b,f,h,y,m,w,A,B,l,E,G){a[0]=c;a[1]=g;a[2]=d;a[3]=e;a[4]=k;a[5]=b;a[6]=f;a[7]=h;a[8]=y;a[9]=m;a[10]=w;a[11]=A;a[12]=B;a[13]=l;a[14]=E;a[15]=G;return a};b.identity=h;b.transpose=function(a,c){if(a===c){var g=c[1],d=c[2],e=c[3],k=c[6],n=c[7],b=c[11];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=g;a[6]=c[9];a[7]=c[13];a[8]=d;a[9]=k;a[11]=c[14];a[12]=e;a[13]=n;a[14]=b}else a[0]=c[0],a[1]=c[4],a[2]=c[8],a[3]=c[12],a[4]=c[1],a[5]=c[5],a[6]=c[9],
a[7]=c[13],a[8]=c[2],a[9]=c[6],a[10]=c[10],a[11]=c[14],a[12]=c[3],a[13]=c[7],a[14]=c[11],a[15]=c[15];return a};b.invert=function(a,c){var g=c[0],d=c[1],e=c[2],k=c[3],n=c[4],b=c[5],f=c[6],h=c[7],m=c[8],w=c[9],A=c[10],B=c[11],l=c[12],E=c[13],G=c[14];c=c[15];var J=g*b-d*n,I=g*f-e*n,K=g*h-k*n,H=d*f-e*b,L=d*h-k*b,P=e*h-k*f,S=m*E-w*l,R=m*G-A*l,O=m*c-B*l,Q=w*G-A*E,T=w*c-B*E,q=A*c-B*G,N=J*q-I*T+K*Q+H*O-L*R+P*S;if(!N)return null;N=1/N;a[0]=(b*q-f*T+h*Q)*N;a[1]=(e*T-d*q-k*Q)*N;a[2]=(E*P-G*L+c*H)*N;a[3]=(A*
L-w*P-B*H)*N;a[4]=(f*O-n*q-h*R)*N;a[5]=(g*q-e*O+k*R)*N;a[6]=(G*K-l*P-c*I)*N;a[7]=(m*P-A*K+B*I)*N;a[8]=(n*T-b*O+h*S)*N;a[9]=(d*O-g*T-k*S)*N;a[10]=(l*L-E*K+c*J)*N;a[11]=(w*K-m*L-B*J)*N;a[12]=(b*R-n*Q-f*S)*N;a[13]=(g*Q-d*R+e*S)*N;a[14]=(E*I-l*H-G*J)*N;a[15]=(m*H-w*I+A*J)*N;return a};b.adjoint=function(a,c){var g=c[0],d=c[1],e=c[2],k=c[3],n=c[4],b=c[5],f=c[6],h=c[7],m=c[8],w=c[9],A=c[10],B=c[11],l=c[12],E=c[13],G=c[14];c=c[15];a[0]=b*(A*c-B*G)-w*(f*c-h*G)+E*(f*B-h*A);a[1]=-(d*(A*c-B*G)-w*(e*c-k*G)+E*
(e*B-k*A));a[2]=d*(f*c-h*G)-b*(e*c-k*G)+E*(e*h-k*f);a[3]=-(d*(f*B-h*A)-b*(e*B-k*A)+w*(e*h-k*f));a[4]=-(n*(A*c-B*G)-m*(f*c-h*G)+l*(f*B-h*A));a[5]=g*(A*c-B*G)-m*(e*c-k*G)+l*(e*B-k*A);a[6]=-(g*(f*c-h*G)-n*(e*c-k*G)+l*(e*h-k*f));a[7]=g*(f*B-h*A)-n*(e*B-k*A)+m*(e*h-k*f);a[8]=n*(w*c-B*E)-m*(b*c-h*E)+l*(b*B-h*w);a[9]=-(g*(w*c-B*E)-m*(d*c-k*E)+l*(d*B-k*w));a[10]=g*(b*c-h*E)-n*(d*c-k*E)+l*(d*h-k*b);a[11]=-(g*(b*B-h*w)-n*(d*B-k*w)+m*(d*h-k*b));a[12]=-(n*(w*G-A*E)-m*(b*G-f*E)+l*(b*A-f*w));a[13]=g*(w*G-A*E)-
m*(d*G-e*E)+l*(d*A-e*w);a[14]=-(g*(b*G-f*E)-n*(d*G-e*E)+l*(d*f-e*b));a[15]=g*(b*A-f*w)-n*(d*A-e*w)+m*(d*f-e*b);return a};b.determinant=function(a){var c=a[0],g=a[1],d=a[2],e=a[3],k=a[4],n=a[5],b=a[6],f=a[7],h=a[8],m=a[9],w=a[10],A=a[11],B=a[12],l=a[13],E=a[14];a=a[15];return(c*n-g*k)*(w*a-A*E)-(c*b-d*k)*(m*a-A*l)+(c*f-e*k)*(m*E-w*l)+(g*b-d*n)*(h*a-A*B)-(g*f-e*n)*(h*E-w*B)+(d*f-e*b)*(h*l-m*B)};b.multiply=a;b.translate=function(a,c,g){var d=g[0],e=g[1];g=g[2];var k=void 0,n=void 0,b=void 0,f=void 0,
h=void 0,m=void 0,w=void 0,A=void 0,B=void 0,l=void 0,E=void 0,G=void 0;c===a?(a[12]=c[0]*d+c[4]*e+c[8]*g+c[12],a[13]=c[1]*d+c[5]*e+c[9]*g+c[13],a[14]=c[2]*d+c[6]*e+c[10]*g+c[14],a[15]=c[3]*d+c[7]*e+c[11]*g+c[15]):(k=c[0],n=c[1],b=c[2],f=c[3],h=c[4],m=c[5],w=c[6],A=c[7],B=c[8],l=c[9],E=c[10],G=c[11],a[0]=k,a[1]=n,a[2]=b,a[3]=f,a[4]=h,a[5]=m,a[6]=w,a[7]=A,a[8]=B,a[9]=l,a[10]=E,a[11]=G,a[12]=k*d+h*e+B*g+c[12],a[13]=n*d+m*e+l*g+c[13],a[14]=b*d+w*e+E*g+c[14],a[15]=f*d+A*e+G*g+c[15]);return a};b.scale=
function(a,c,g){var d=g[0],e=g[1];g=g[2];a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=c[3]*d;a[4]=c[4]*e;a[5]=c[5]*e;a[6]=c[6]*e;a[7]=c[7]*e;a[8]=c[8]*g;a[9]=c[9]*g;a[10]=c[10]*g;a[11]=c[11]*g;a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};b.rotate=function(a,c,g,d){var e=d[0],k=d[1];d=d[2];var n=Math.sqrt(e*e+k*k+d*d),r=void 0,b=void 0,h=void 0,m=void 0,w=void 0,A=void 0,B=void 0,l=void 0,E=void 0,G=void 0,J=void 0,I=void 0,K=void 0,H=void 0,L=void 0,P=void 0,S=void 0,R=void 0,O=void 0,Q=
void 0,T=void 0,q=void 0,b=r=void 0;if(n<f.EPSILON)return null;n=1/n;e*=n;k*=n;d*=n;r=Math.sin(g);b=Math.cos(g);h=1-b;m=c[0];w=c[1];A=c[2];B=c[3];l=c[4];E=c[5];G=c[6];J=c[7];I=c[8];K=c[9];H=c[10];L=c[11];P=e*e*h+b;S=k*e*h+d*r;R=d*e*h-k*r;O=e*k*h-d*r;Q=k*k*h+b;T=d*k*h+e*r;q=e*d*h+k*r;r=k*d*h-e*r;b=d*d*h+b;a[0]=m*P+l*S+I*R;a[1]=w*P+E*S+K*R;a[2]=A*P+G*S+H*R;a[3]=B*P+J*S+L*R;a[4]=m*O+l*Q+I*T;a[5]=w*O+E*Q+K*T;a[6]=A*O+G*Q+H*T;a[7]=B*O+J*Q+L*T;a[8]=m*q+l*r+I*b;a[9]=w*q+E*r+K*b;a[10]=A*q+G*r+H*b;a[11]=B*
q+J*r+L*b;c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);return a};b.rotateX=function(a,c,g){var d=Math.sin(g);g=Math.cos(g);var e=c[4],k=c[5],n=c[6],b=c[7],f=c[8],h=c[9],m=c[10],w=c[11];c!==a&&(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[4]=e*g+f*d;a[5]=k*g+h*d;a[6]=n*g+m*d;a[7]=b*g+w*d;a[8]=f*g-e*d;a[9]=h*g-k*d;a[10]=m*g-n*d;a[11]=w*g-b*d;return a};b.rotateY=function(a,c,g){var d=Math.sin(g);g=Math.cos(g);var e=c[0],k=c[1],n=c[2],b=c[3],f=
c[8],h=c[9],m=c[10],w=c[11];c!==a&&(a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=e*g-f*d;a[1]=k*g-h*d;a[2]=n*g-m*d;a[3]=b*g-w*d;a[8]=e*d+f*g;a[9]=k*d+h*g;a[10]=n*d+m*g;a[11]=b*d+w*g;return a};b.rotateZ=function(a,c,g){var d=Math.sin(g);g=Math.cos(g);var e=c[0],k=c[1],n=c[2],b=c[3],f=c[4],h=c[5],m=c[6],w=c[7];c!==a&&(a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]);a[0]=e*g+f*d;a[1]=k*g+h*d;a[2]=n*g+m*d;a[3]=
b*g+w*d;a[4]=f*g-e*d;a[5]=h*g-k*d;a[6]=m*g-n*d;a[7]=w*g-b*d;return a};b.fromTranslation=function(a,c){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};b.fromScaling=function(a,c){a[0]=c[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotation=function(a,c,g){var d=g[0],e=g[1];g=g[2];var k=Math.sqrt(d*d+e*e+g*g),n=void 0,b=void 0,
h=void 0;if(k<f.EPSILON)return null;k=1/k;d*=k;e*=k;g*=k;n=Math.sin(c);b=Math.cos(c);h=1-b;a[0]=d*d*h+b;a[1]=e*d*h+g*n;a[2]=g*d*h-e*n;a[3]=0;a[4]=d*e*h-g*n;a[5]=e*e*h+b;a[6]=g*e*h+d*n;a[7]=0;a[8]=d*g*h+e*n;a[9]=e*g*h-d*n;a[10]=g*g*h+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromXRotation=function(a,c){var g=Math.sin(c);c=Math.cos(c);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=g;a[7]=0;a[8]=0;a[9]=-g;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromYRotation=function(a,
c){var g=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=0;a[2]=-g;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=g;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromZRotation=function(a,c){var g=Math.sin(c);c=Math.cos(c);a[0]=c;a[1]=g;a[2]=0;a[3]=0;a[4]=-g;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.fromRotationTranslation=e;b.fromQuat2=function(a,c){var g=k,d=-c[0],n=-c[1],b=-c[2],f=c[3],h=c[4],v=c[5],y=c[6],m=c[7],w=d*d+n*n+b*b+f*f;0<w?(g[0]=
2*(h*f+m*d+v*b-y*n)/w,g[1]=2*(v*f+m*n+y*d-h*b)/w,g[2]=2*(y*f+m*b+h*n-v*d)/w):(g[0]=2*(h*f+m*d+v*b-y*n),g[1]=2*(v*f+m*n+y*d-h*b),g[2]=2*(y*f+m*b+h*n-v*d));e(a,c,g);return a};var k=l.create();b.getTranslation=function(a,c){a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};b.getScaling=function(a,c){var g=c[0],d=c[1],e=c[2],k=c[4],n=c[5],b=c[6],f=c[8],h=c[9];c=c[10];a[0]=Math.sqrt(g*g+d*d+e*e);a[1]=Math.sqrt(k*k+n*n+b*b);a[2]=Math.sqrt(f*f+h*h+c*c);return a};b.getRotation=function(a,c){var g=c[0]+c[5]+c[10],
d=0;0<g?(d=2*Math.sqrt(g+1),a[3]=.25*d,a[0]=(c[6]-c[9])/d,a[1]=(c[8]-c[2])/d,a[2]=(c[1]-c[4])/d):c[0]>c[5]&&c[0]>c[10]?(d=2*Math.sqrt(1+c[0]-c[5]-c[10]),a[3]=(c[6]-c[9])/d,a[0]=.25*d,a[1]=(c[1]+c[4])/d,a[2]=(c[8]+c[2])/d):c[5]>c[10]?(d=2*Math.sqrt(1+c[5]-c[0]-c[10]),a[3]=(c[8]-c[2])/d,a[0]=(c[1]+c[4])/d,a[1]=.25*d,a[2]=(c[6]+c[9])/d):(d=2*Math.sqrt(1+c[10]-c[0]-c[5]),a[3]=(c[1]-c[4])/d,a[0]=(c[8]+c[2])/d,a[1]=(c[6]+c[9])/d,a[2]=.25*d);return a};b.fromRotationTranslationScale=function(a,c,g,d){var e=
c[0],k=c[1],b=c[2],n=c[3],r=e+e,f=k+k,m=b+b;c=e*r;var h=e*f,e=e*m,A=k*f,k=k*m,b=b*m,r=n*r,f=n*f,n=n*m,m=d[0],B=d[1];d=d[2];a[0]=(1-(A+b))*m;a[1]=(h+n)*m;a[2]=(e-f)*m;a[3]=0;a[4]=(h-n)*B;a[5]=(1-(c+b))*B;a[6]=(k+r)*B;a[7]=0;a[8]=(e+f)*d;a[9]=(k-r)*d;a[10]=(1-(c+A))*d;a[11]=0;a[12]=g[0];a[13]=g[1];a[14]=g[2];a[15]=1;return a};b.fromRotationTranslationScaleOrigin=function(a,c,g,d,e){var k=c[0],b=c[1],n=c[2],p=c[3],r=k+k,m=b+b,f=n+n;c=k*r;var h=k*m,B=k*f,k=b*m,b=b*f,l=n*f,n=p*r,m=p*m,E=p*f,G=d[0],J=d[1],
f=d[2];d=e[0];p=e[1];e=e[2];var r=(1-(k+l))*G,I=(h+E)*G,G=(B-m)*G,h=(h-E)*J,l=(1-(c+l))*J,J=(b+n)*J,B=(B+m)*f,b=(b-n)*f;c=(1-(c+k))*f;a[0]=r;a[1]=I;a[2]=G;a[3]=0;a[4]=h;a[5]=l;a[6]=J;a[7]=0;a[8]=B;a[9]=b;a[10]=c;a[11]=0;a[12]=g[0]+d-(r*d+h*p+B*e);a[13]=g[1]+p-(I*d+l*p+b*e);a[14]=g[2]+e-(G*d+J*p+c*e);a[15]=1;return a};b.fromQuat=function(a,c){var g=c[0],d=c[1],e=c[2];c=c[3];var k=g+g,b=d+d,n=e+e,g=g*k,f=d*k,d=d*b,h=e*k,m=e*b,e=e*n,k=c*k,b=c*b;c*=n;a[0]=1-d-e;a[1]=f+c;a[2]=h-b;a[3]=0;a[4]=f-c;a[5]=
1-g-e;a[6]=m+k;a[7]=0;a[8]=h+b;a[9]=m-k;a[10]=1-g-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};b.frustum=function(a,c,g,d,e,k,b){var p=1/(g-c),n=1/(e-d),f=1/(k-b);a[0]=2*k*p;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*k*n;a[6]=0;a[7]=0;a[8]=(g+c)*p;a[9]=(e+d)*n;a[10]=(b+k)*f;a[11]=-1;a[12]=0;a[13]=0;a[14]=b*k*2*f;a[15]=0;return a};b.perspective=function(a,c,g,d,e){c=1/Math.tan(c/2);var k=void 0;a[0]=c/g;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;
null!=e&&Infinity!==e?(k=1/(d-e),a[10]=(e+d)*k,a[14]=2*e*d*k):(a[10]=-1,a[14]=-2*d);return a};b.perspectiveFromFieldOfView=function(a,c,g,d){var e=Math.tan(c.upDegrees*Math.PI/180),k=Math.tan(c.downDegrees*Math.PI/180),b=Math.tan(c.leftDegrees*Math.PI/180);c=Math.tan(c.rightDegrees*Math.PI/180);var f=2/(b+c),n=2/(e+k);a[0]=f;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=n;a[6]=0;a[7]=0;a[8]=-((b-c)*f*.5);a[9]=(e-k)*n*.5;a[10]=d/(g-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*g/(g-d);a[15]=0;return a};b.ortho=function(a,
c,g,d,e,k,b){var p=1/(c-g),f=1/(d-e),n=1/(k-b);a[0]=-2*p;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*f;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*n;a[11]=0;a[12]=(c+g)*p;a[13]=(e+d)*f;a[14]=(b+k)*n;a[15]=1;return a};b.lookAt=function(a,c,g,d){var e=void 0,k=void 0,b=void 0,r=void 0,n=void 0,y=void 0,m=void 0,w=void 0,A=void 0,B=void 0,l=c[0],E=c[1];c=c[2];b=d[0];r=d[1];d=d[2];m=g[0];w=g[1];g=g[2];if(Math.abs(l-m)<f.EPSILON&&Math.abs(E-w)<f.EPSILON&&Math.abs(c-g)<f.EPSILON)return h(a);m=l-m;w=E-w;A=c-g;B=1/Math.sqrt(m*
m+w*w+A*A);m*=B;w*=B;A*=B;e=r*A-d*w;k=d*m-b*A;b=b*w-r*m;(B=Math.sqrt(e*e+k*k+b*b))?(B=1/B,e*=B,k*=B,b*=B):b=k=e=0;r=w*b-A*k;n=A*e-m*b;y=m*k-w*e;(B=Math.sqrt(r*r+n*n+y*y))?(B=1/B,r*=B,n*=B,y*=B):y=n=r=0;a[0]=e;a[1]=r;a[2]=m;a[3]=0;a[4]=k;a[5]=n;a[6]=w;a[7]=0;a[8]=b;a[9]=y;a[10]=A;a[11]=0;a[12]=-(e*l+k*E+b*c);a[13]=-(r*l+n*E+y*c);a[14]=-(m*l+w*E+A*c);a[15]=1;return a};b.targetTo=function(a,c,g,d){var e=c[0],k=c[1];c=c[2];var b=d[0],f=d[1],r=d[2];d=e-g[0];var n=k-g[1];g=c-g[2];var m=d*d+n*n+g*g;0<m&&
(m=1/Math.sqrt(m),d*=m,n*=m,g*=m);var h=f*g-r*n,r=r*d-b*g,b=b*n-f*d,m=h*h+r*r+b*b;0<m&&(m=1/Math.sqrt(m),h*=m,r*=m,b*=m);a[0]=h;a[1]=r;a[2]=b;a[3]=0;a[4]=n*b-g*r;a[5]=g*h-d*b;a[6]=d*r-n*h;a[7]=0;a[8]=d;a[9]=n;a[10]=g;a[11]=0;a[12]=e;a[13]=k;a[14]=c;a[15]=1;return a};b.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],
2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};b.add=function(a,c,g){a[0]=c[0]+g[0];a[1]=c[1]+g[1];a[2]=c[2]+g[2];a[3]=c[3]+g[3];a[4]=c[4]+g[4];a[5]=c[5]+g[5];a[6]=c[6]+g[6];a[7]=c[7]+g[7];a[8]=c[8]+g[8];a[9]=c[9]+g[9];a[10]=c[10]+g[10];a[11]=c[11]+g[11];a[12]=c[12]+g[12];a[13]=c[13]+
g[13];a[14]=c[14]+g[14];a[15]=c[15]+g[15];return a};b.subtract=d;b.multiplyScalar=function(a,c,g){a[0]=c[0]*g;a[1]=c[1]*g;a[2]=c[2]*g;a[3]=c[3]*g;a[4]=c[4]*g;a[5]=c[5]*g;a[6]=c[6]*g;a[7]=c[7]*g;a[8]=c[8]*g;a[9]=c[9]*g;a[10]=c[10]*g;a[11]=c[11]*g;a[12]=c[12]*g;a[13]=c[13]*g;a[14]=c[14]*g;a[15]=c[15]*g;return a};b.multiplyScalarAndAdd=function(a,c,g,d){a[0]=c[0]+g[0]*d;a[1]=c[1]+g[1]*d;a[2]=c[2]+g[2]*d;a[3]=c[3]+g[3]*d;a[4]=c[4]+g[4]*d;a[5]=c[5]+g[5]*d;a[6]=c[6]+g[6]*d;a[7]=c[7]+g[7]*d;a[8]=c[8]+g[8]*
d;a[9]=c[9]+g[9]*d;a[10]=c[10]+g[10]*d;a[11]=c[11]+g[11]*d;a[12]=c[12]+g[12]*d;a[13]=c[13]+g[13]*d;a[14]=c[14]+g[14]*d;a[15]=c[15]+g[15]*d;return a};b.exactEquals=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};b.equals=function(a,c){var g=a[0],d=a[1],e=a[2],k=a[3],b=a[4],h=a[5],n=a[6],y=a[7],m=a[8],w=a[9],
A=a[10],B=a[11],l=a[12],E=a[13],G=a[14];a=a[15];var J=c[0],I=c[1],K=c[2],H=c[3],L=c[4],P=c[5],S=c[6],R=c[7],O=c[8],Q=c[9],T=c[10],q=c[11],N=c[12],Z=c[13],W=c[14];c=c[15];return Math.abs(g-J)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(J))&&Math.abs(d-I)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(e-K)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(K))&&Math.abs(k-H)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(H))&&Math.abs(b-L)<=f.EPSILON*Math.max(1,Math.abs(b),Math.abs(L))&&Math.abs(h-P)<=
f.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(n-S)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(y-R)<=f.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(m-O)<=f.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(w-Q)<=f.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))&&Math.abs(A-T)<=f.EPSILON*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(B-q)<=f.EPSILON*Math.max(1,Math.abs(B),Math.abs(q))&&Math.abs(l-N)<=f.EPSILON*Math.max(1,Math.abs(l),Math.abs(N))&&Math.abs(E-Z)<=f.EPSILON*
Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(G-W)<=f.EPSILON*Math.max(1,Math.abs(G),Math.abs(W))&&Math.abs(a-c)<=f.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};b.mul=a;b.sub=d})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/mathUtils ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ./projectionUtils".split(" "),function(q,b,l,f,h,a,e,d){function k(c,a,g,d){var k,p;c instanceof e&&
a instanceof e&&(g=a.longitude,d=a.latitude,p=c.latitude,k=c.longitude);c=l.deg2rad(p);d=l.deg2rad(d);k=l.deg2rad(k);a=l.deg2rad(g);g=Math.sin((c-d)/2);k=Math.sin((k-a)/2);g=2*l.asinClamped(Math.sqrt(g*g+Math.cos(c)*Math.cos(d)*k*k))*b.earthRadius;return Math.round(1E4*g)/1E4}function n(c,a){c/=15;a||(c=Math.round(c));return c}Object.defineProperty(b,"__esModule",{value:!0});b.earthRadius=f.wgs84Radius;b.halfEarthRadius=b.earthRadius/2;b.halfEarthCircumference=Math.PI*b.earthRadius;b.earthCircumference=
2*b.halfEarthCircumference;b.metersPerDegree=b.halfEarthCircumference/180;b.getGreatCircleDistance=k;b.getGreatCircleSpanAt=function(c,a,g){var d=a.spatialReference,b=new e(a.x,c.y,d),p=new e(g.x,c.y,d);a=new e(c.x,a.y,d);c=new e(c.x,g.y,d);return{lon:k(b,p),lat:k(a,c)}};b.getLonDeltaForDistance=function(c,a){a/=b.earthRadius;c=l.deg2rad(c);a=Math.sin(a/2);c=Math.cos(c);c=2*l.asinClamped(Math.sqrt(a*a/(c*c)));return l.rad2deg(c)};b.getLatDeltaForDistance=function(c){return l.rad2deg(c/b.earthRadius)};
b.getMaxCameraAltitude=function(c){c=l.deg2rad(c/2);return(1-Math.sin(c))*b.earthRadius/Math.sin(c)};b.getViewExtentDistance=function(c,a){a=l.deg2rad(a/2);return 2*l.acosClamped((Math.pow(c+b.earthRadius,2)+Math.pow(b.earthRadius,2)-Math.pow((c+b.earthRadius)*Math.cos(a)-Math.sqrt(Math.pow(Math.cos(a)*(c+b.earthRadius),2)-c*c-2*c*b.earthRadius),2))/(2*(c+b.earthRadius)*b.earthRadius))*b.earthRadius};b.computeCartesianDistance=function(a,e){a=d.wgs84ComparableLonLatToECEF(c,a.longitude,a.latitude,
a.z||0);e=d.wgs84ComparableLonLatToECEF(g,e.longitude,e.latitude,e.z||0);e=[e[0]-a[0],e[1]-a[1],e[2]-a[2]];return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])};b.longitudeToTimezone=n;b.positionToTimezone=function(c,a){a||(a={hours:0,minutes:0,seconds:0});a.hours=n(c[0],!0);c=a.hours%1;a.hours-=c;a.minutes=60*c;c=a.minutes%1;a.minutes-=c;a.seconds=Math.round(60*c);return a};b.distanceToIdealHorizon=function(c,a){a=a||b.earthRadius;c=h.vec3.dot(c,c);return Math.sqrt(Math.abs(c-a*a))};var c=a.vec3f64.create(),
g=a.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b.length=function(b,h){var a=b[h],e=b[h+1];b=b[h+2];return Math.sqrt(a*a+e*e+b*b)};b.normalize=function(b,h){var a=b[h],e=b[h+1],d=b[h+2],a=1/Math.sqrt(a*a+e*e+d*d);b[h]*=a;b[h+1]*=a;b[h+2]*=a};b.scale=function(b,h,a){b[h]*=a;b[h+1]*=a;b[h+2]*=a};b.add=function(b,h,a,e,d,k){void 0===k&&(k=h);d=d||b;d[k]=b[h]+a[e];
d[k+1]=b[h+1]+a[e+1];d[k+2]=b[h+2]+a[e+2]};b.subtract=function(b,h,a,e,d,k){void 0===k&&(k=h);d=d||b;d[k]=b[h]-a[e];d[k+1]=b[h+1]-a[e+1];d[k+2]=b[h+2]-a[e+2]}})(b.Vec3Compact||(b.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/arrayUtils ../core/maybe ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});b.PopupView=function(g){return function(g){function b(){return null!==g&&g.apply(this,arguments)||this}f(b,g);b.prototype.fetchPopupFeatures=function(c,a){return this._fetchPopupFeaturesAsync(c,a)};b.prototype._fetchPopupFeaturesAsync=function(c,g){return a(this,void 0,void 0,function(){var a,k,b,m,f,p;return e(this,function(e){switch(e.label){case 0:return[4,this.when()];case 1:return e.sent(),[4,this._prepareFetchPopupFeatures(c,
g)];case 2:return a=e.sent(),k=a.location,b=this._queryLayerPopupFeatures(a,g),m=n.resolve(a.clientOnlyGraphics),f=[m].concat(b),p=n.eachAlwaysValues(f).then(d.flatten),[2,{promise:p,location:k,promises:f}]}})})};b.prototype._queryLayerPopupFeatures=function(c,a){var g=c.queryArea;return c.layerViewsAndGraphics.map(function(c){var d=c.layerView;c={clientGraphics:c.graphics,signal:k.isSome(a)?a.signal:null,defaultPopupTemplateEnabled:k.isSome(a)?!!a.defaultPopupTemplateEnabled:!1};return d.fetchPopupFeatures(g,
c)})};b.prototype._isValidPopupGraphic=function(c,a){return c&&!!c.getEffectivePopupTemplate(k.isSome(a)&&a.defaultPopupTemplateEnabled)};b.prototype._prepareFetchPopupFeatures=function(c,g){return a(this,void 0,void 0,function(){var a,d,k,m,b,f,p,r;return e(this,function(e){switch(e.label){case 0:return[4,this._popupHitTestGraphics(c,g)];case 1:return a=e.sent(),d=a.clientGraphics,k=a.queryArea,m=a.location,b=this._getFetchPopupLayerViews(),f=this._graphicsPerFetchPopupLayerView(d,b),p=f.layerViewsAndGraphics,
r=f.clientOnlyGraphics,[2,{clientOnlyGraphics:r,layerViewsAndGraphics:p,queryArea:k,location:m}]}})})};b.prototype._popupHitTestGraphics=function(c,g){return a(this,void 0,void 0,function(){var a,d,k,m,b,f,p=this;return e(this,function(e){switch(e.label){case 0:return[4,this.popupHitTest(c)];case 1:return a=e.sent(),d=a.results,k=a.mapPoint,m=d.filter(function(c){return p._isValidPopupGraphic(c.graphic,g)}),b=m.length?m[0].mapPoint:null,f=m.map(function(c){return c.graphic}),[2,{clientGraphics:f,
queryArea:k,location:k||b}]}})})};b.prototype._getFetchPopupLayerViews=function(){var c=this,a=[];this.allLayerViews.forEach(function(g){c._isValidPopupLayerView(g)&&a.push(g)});k.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&a.push(this.graphicsView);return a.reverse()};b.prototype._isValidPopupLayerView=function(c){return k.isSome(c)&&(!("layer"in c)||!c.suspended)&&"fetchPopupFeatures"in c};b.prototype._graphicsPerFetchPopupLayerView=function(c,a){var g=[],d=new Map;
a=a.map(function(c){var a=[];"layer"in c?d.set(c.layer,a):d.set(c.graphics,a);return{layerView:c,graphics:a}});for(var e=0;e<c.length;e++){var k=c[e],b=d.get(k.layer)||null;b?b.push(k):g.push(k)}return{layerViewsAndGraphics:a,clientOnlyGraphics:g}};return b=h([c.subclass("esri.views.PopupView")],b)}(c.declared(g))}})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe","@dojo/framework/shim/Promise"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});var h=function(){return new Promise(function(a,d){q(["./layers/TileLayerView3D"],a,d)})},a=function(){return new Promise(function(a,d){q(["./layers/FeatureLayerView3D"],a,d)})},e=function(){return new Promise(function(a,d){q(["./layers/ElevationLayerView3D"],a,d)})},d={"base-dynamic":function(){return new Promise(function(a,d){q(["./layers/DynamicLayerView3D"],a,d)})},"base-elevation":e,"base-tile":h,"bing-maps":h,"building-scene":function(){return new Promise(function(a,
d){q(["./layers/BuildingSceneLayerView3D"],a,d)})},csv:a,elevation:e,feature:a,geojson:a,graphics:function(){return new Promise(function(a,d){q(["./layers/GraphicsLayerView3D"],a,d)})},group:function(){return new Promise(function(a,d){q(["../layers/GroupLayerView"],a,d)})},imagery:function(){return new Promise(function(a,d){q(["./layers/ImageryLayerView3D"],a,d)})},"integrated-mesh":function(){return new Promise(function(a,d){q(["./layers/IntegratedMeshLayerView3D"],a,d)})},"map-image":function(){return new Promise(function(a,
d){q(["./layers/MapImageLayerView3D"],a,d)})},"open-street-map":h,"point-cloud":function(){return new Promise(function(a,d){q(["./layers/PointCloudLayerView3D"],a,d)})},scene:function(a){return null==a.profile||"mesh-pyramids"===a.profile?new Promise(function(a,c){q(["./layers/SceneLayerView3D"],a,c)}):new Promise(function(a,c){q(["./layers/SceneLayerGraphicsView3D"],a,c)})},stream:function(){return new Promise(function(a,d){q(["./layers/StreamLayerView3D"],a,d)})},tile:h,"vector-tile":function(){return new Promise(function(a,
d){q(["./layers/VectorTileLayerView3D"],a,d)})},"web-tile":h,wms:function(){return new Promise(function(a,d){q(["./layers/WMSLayerView3D"],a,d)})},wmts:function(){return new Promise(function(a,d){q(["./layers/WMTSLayerView3D"],a,d)})},"geo-rss":null,"imagery-tile":null,kml:null,"map-notes":null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:function(a){return f.isSome(d[a.type])},importLayerView:function(a){var e=d[a.type];if(!f.isSome(e))throw a=a.declaredClass?a.declaredClass.slice(a.declaredClass.lastIndexOf(".")+
1):"Unknown",e=a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new l(e+":view-not-supported",a+" is not supported in 3D");return e(a)}}})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,
"__esModule",{value:!0});q=function(c){function g(){var a=null!==c&&c.apply(this,arguments)||this;a.tilt=new n.default;a.altitude=new e.default;a.clipDistance=new d.default;a.collision=new k.default;return a}l(g,c);f([a.property({type:n.default})],g.prototype,"tilt",void 0);f([a.property({type:e.default})],g.prototype,"altitude",void 0);f([a.property({type:d.default})],g.prototype,"clipDistance",void 0);f([a.property({type:k.default})],g.prototype,"collision",void 0);return g=f([a.subclass("esri.views.3d.constraints.Constraints")],
g)}(a.declared(h));b.Constraints=q;b.default=q})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||
this;a.min=k.AltitudeDefault.min;a.max=k.AltitudeDefault.max;return a}l(c,b);Object.defineProperty(c.prototype,"mode",{get:function(){a.deprecated(e.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"},set:function(c){a.deprecated(e.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
{version:"4.6"})},enumerable:!0,configurable:!0});f([d.property({type:Number})],c.prototype,"min",void 0);f([d.property({type:Number})],c.prototype,"max",void 0);return c=f([d.subclass("esri.views.3d.constraints.AltitudeConstraint")],c)}(d.declared(h));b.AltitudeConstraint=q;b.default=q})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/mathUtils ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});var g=a.getLogger("esri.views.3d.state.Constraints");q=function(a){function h(c){c=a.call(this,c)||this;c.collision=new p;c.distance=Infinity;c.minimumPoiDistance=4;return c}l(h,a);Object.defineProperty(h.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?g.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},
enumerable:!0,configurable:!0});h.prototype.clampAltitude=function(a){return this.altitude?e.clamp(a,this.altitude.min,this.altitude.max):a};h.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return e.clamp(c,a.min,a.max)};h.prototype.clampDistance=function(a){return Math.min(a,this.distance)};h.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};h.prototype.createConstantMaxTilt=function(a){return function(c,
g){void 0===g&&(g=r);g.min=b.TiltDefault.min;g.max=a;return g}};h.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?c.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[1E4,d.deg2rad(88)],[6E6,d.deg2rad(88)]]):function(){return b.TiltDefault.max};return function(c,g){void 0===g&&(g=r);g.min=b.TiltDefault.min;g.max=a(c);return g}};h.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?c.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[5E4,d.deg2rad(88)],
[6E6,d.deg2rad(88)],[2E7,b.TiltDefault.min]]):c.makePiecewiseLinearFunction([[3E5,b.TiltDefault.max],[3E6,d.deg2rad(88)],[6E6,d.deg2rad(88)],[2E7,b.TiltDefault.min]]);return function(c,g){void 0===g&&(g=r);g.min=b.TiltDefault.min;g.max=a(c);return g}};f([k.property()],h.prototype,"altitude",null);f([k.property({readOnly:!0})],h.prototype,"collision",void 0);f([k.property()],h.prototype,"distance",void 0);f([k.property({readOnly:!0})],h.prototype,"minimumPoiDistance",void 0);f([k.property()],h.prototype,
"tilt",void 0);f([k.property({constructOnly:!0})],h.prototype,"mode",void 0);return h=f([k.subclass("esri.views.3d.state.Constraints")],h)}(k.declared(h));b.Constraints=q;b.AltitudeDefault={min:-2E5,max:4*n.earthRadius};b.TiltDefault={min:d.deg2rad(.5),max:d.deg2rad(179.5)};var r={min:0,max:0},p=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}l(c,a);f([k.property({type:Boolean})],c.prototype,"enabled",void 0);f([k.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=f([k.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(k.declared(h));b.default=q})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(e){function d(){var a=
null!==e&&e.apply(this,arguments)||this;a.mode="auto";return a}l(d,e);Object.defineProperty(d.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});d.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(d.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});d.prototype.castFar=function(a){return Math.max(1E-8,a)};d.prototype.autoUpdate=function(a,d){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==d&&this._set("far",d))};f([a.property({type:Number,value:1E-8})],d.prototype,"near",null);f([a.cast("near")],d.prototype,"castNear",null);f([a.property({type:Number,value:1E-8})],d.prototype,"far",null);f([a.cast("far")],d.prototype,"castFar",null);f([a.property({type:["auto","manual"]})],
d.prototype,"mode",void 0);return d=f([a.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],d)}(a.declared(h));b.ClipDistanceConstraint=q;b.default=q})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/deprecate ../../../core/Logger ../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,
"__esModule",{value:!0});q=function(k){function b(){return null!==k&&k.apply(this,arguments)||this}l(b,k);Object.defineProperty(b.prototype,"enabled",{set:function(c){a.deprecated(e.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"});this._set("enabled",c)},enumerable:!0,configurable:!0});f([d.property({value:!0})],b.prototype,"enabled",null);return b=f([d.subclass("esri.views.3d.constraints.CollisionConstraint")],b)}(d.declared(h));
b.CollisionConstraint=q;b.default=q})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=a.rad2deg(d.TiltDefault.min),n=a.rad2deg(d.TiltDefault.max);q=function(c){function g(){var a=null!==
c&&c.apply(this,arguments)||this;a.mode="auto";return a}l(g,c);Object.defineProperty(g.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});g.prototype.castMax=function(c){return a.clamp(c,k,n)};g.prototype.autoUpdate=function(a){"auto"===this.mode&&this._get("max")!==a&&this._set("max",a)};f([e.property({type:["auto","manual"]})],g.prototype,"mode",void 0);f([e.property({type:Number,value:n})],g.prototype,
"max",null);f([e.cast("max")],g.prototype,"castMax",null);return g=f([e.subclass("esri.views.3d.constraints.TiltConstraint")],g)}(e.declared(h));b.TiltConstraint=q;b.default=q})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){return function(c){function b(a){a=c.call(this,a)||this;a.atmosphere=new k.default;return a}l(b,c);r=b;b.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new r(h({},a,{lighting:n.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};b.prototype.castLighting=function(a){return a?a instanceof n.SceneViewLighting?a:a instanceof g?this.lighting?this.lighting.cloneWithWebsceneLighting(a):n.SceneViewLighting.fromWebsceneLighting(a):d.ensureType(n.SceneViewLighting,
a):new n.SceneViewLighting};b.prototype.clone=function(){return new r({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:a.clone(this.background)})};var r;f([e.property({type:k.default,json:{read:!1}})],b.prototype,"atmosphere",void 0);f([e.property()],b.prototype,"lighting",void 0);f([e.cast("lighting")],b.prototype,"castLighting",null);return b=r=f([e.subclass("esri.views.3d.environment.SceneViewEnvironment")],
b)}(e.declared(c))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}l(d,e);k=d;Object.defineProperty(d.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&
this._set("quality",a)},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new k({quality:this.quality})};var k;f([a.property({type:["low","high"],value:"low"})],d.prototype,"quality",null);return d=k=f([a.subclass("esri.views.3d.environment.SceneViewAtmosphere")],d)}(a.declared(h));b.SceneViewAtmosphere=q;b.default=q})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function c(c){c=a.call(this,c)||this;c.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};c.cameraTrackingEnabled=!0;c.ambientOcclusionEnabled=!1;var g=(new Date).getFullYear(),g=new Date("March 15, "+g+" 12:00:00 UTC");c._set("defaultDate",g);c._set("date",g);return c}l(c,a);g=c;c.fromWebsceneLighting=function(a){return new g(h({},a.cloneConstructProperties()))};Object.defineProperty(c.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var c=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);c&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});c.prototype.autoUpdate=function(a,c){var g=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);g!==d&&(k.target=this,k.timezoneOffset=d,this.emit("timezone-will-change",k));if(null!=a)return c!==a.getTime()};c.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),
c=new g(h({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));a&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};c.prototype.cloneWithWebsceneLighting=
function(a){var c=this.clone();null!=a.date&&(c.date=a.date);c.directShadowsEnabled=a.directShadowsEnabled;c.displayUTCOffset=a.displayUTCOffset;return c};c.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var g;f([e.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);f([e.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);f([e.property({type:Date})],c.prototype,"defaultDate",null);f([e.property({type:Date})],
c.prototype,"date",null);return c=g=f([e.subclass("esri.views.3d.environment.SceneViewLighting")],c)}(e.declared(a.EventedMixin(d)));b.SceneViewLighting=q;var k={target:null,timezoneOffset:0};b.default=q})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){return function(e){function d(a){a=e.call(this,a)||this;a.date=null;a.directShadowsEnabled=
!1;a.displayUTCOffset=null;return a}l(d,e);k=d;d.prototype.readDate=function(a,c){return null!=c.datetime&&new Date(c.datetime)||null};d.prototype.writeDate=function(a,c,g){c[g]=a.getTime()};d.prototype.readDirectShadowsEnabled=function(a,c){return!!c.directShadows};d.prototype.writedirectShadowsEnabled=function(a,c,g){a&&(c[g]=a)};d.prototype.writeDisplayUTCOffset=function(a,c){null!=a&&(c.displayUTCOffset=a)};d.prototype.clone=function(){return new k(this.cloneConstructProperties())};d.prototype.cloneConstructProperties=
function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var k;f([a.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],d.prototype,"date",void 0);f([a.reader("date",["datetime"])],d.prototype,"readDate",null);f([a.writer("date")],d.prototype,"writeDate",null);f([a.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],
d.prototype,"directShadowsEnabled",void 0);f([a.reader("directShadowsEnabled",["directShadows"])],d.prototype,"readDirectShadowsEnabled",null);f([a.writer("directShadowsEnabled")],d.prototype,"writedirectShadowsEnabled",null);f([a.property({type:Number,json:{write:!0}})],d.prototype,"displayUTCOffset",void 0);f([a.writer("displayUTCOffset")],d.prototype,"writeDisplayUTCOffset",null);return d=k=f([a.subclass("esri.webscene.Lighting")],d)}(a.declared(h.JSONSupport))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,b,l,f,h,a,e,d,k){var n=function(a,g,d){return{enabled:!d||!d.isPresentation}};return function(c){function g(a){a=c.call(this,a)||this;a.lighting=new d;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}l(g,c);b=g;g.prototype.clone=function(){return new b(this.cloneConstructProperties())};g.prototype.cloneConstructProperties=function(){return{lighting:d.prototype.clone.call(this.lighting),background:a.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var b;f([e.property({type:d,json:{write:!0}})],g.prototype,"lighting",void 0);f([e.property(k.backgroundProperty)],g.prototype,"background",void 0);f([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],g.prototype,"atmosphereEnabled",void 0);f([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],g.prototype,"starsEnabled",void 0);return g=b=f([e.subclass("esri.webscene.Environment")],g)}(e.declared(h.JSONSupport))})},"esri/webscene/background/utils":function(){define(["require",
"exports","./Background","./ColorBackground"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q={base:l,key:"type",typeMap:{color:f}};b.backgroundProperty={types:q,json:{read:function(b){return function(a,e,d){if(!a)return a;for(var k in b.typeMap)if(a.type===k)return e=new b.typeMap[k],e.read(a,d),e}}(q),write:{overridePolicy:function(b,a,e){return{enabled:!e||!e.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e,d){var k=a.strict()({color:"color"});return function(a){function c(c){return a.call(this,c)||this}l(c,a);c.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=h({},a),delete a.type);return a};c.prototype.clone=function(){};f([d.property({type:k.apiValues,readOnly:!0,json:{type:k.jsonValues,read:!1,write:k.write}})],c.prototype,"type",void 0);return c=f([d.subclass("esri.webscene.background.Background")],c)}(d.declared(e.JSONSupport))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,b,l,f,h,a,e,d,k){var n=h({},d.colorAndTransparencyProperty,{nonNullable:!0});return function(c){function g(g){g=c.call(this,g)||this;g.type="color";g.color=new a([0,0,0,1]);return g}l(g,c);d=g;g.prototype.clone=function(){return new d(this.cloneProperties())};g.prototype.cloneProperties=function(){return{color:this.color.clone()}};var d;f([e.enumeration.serializable()({color:"color"})],g.prototype,"type",void 0);f([e.property(n)],g.prototype,"color",void 0);return g=d=f([e.subclass("esri.webscene.background.ColorBackground")],
g)}(e.declared(k))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/projectionUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){Object.defineProperty(b,"__esModule",{value:!0});var B=u.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);q=function(d){function b(){var a=d.call(this)||this;a._referencePointUpdateDelay=200;a._referencePointUpdateInterval=3E3;a._referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new k;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a.referencePosUpdateTimer=null;a._referencePosWGS84Comparable=null;a._referencePosMapCoords=null;a._mainLight=new w.MainLight;a._ambientLight=new w.AmbientLight;a._moonLight=new w.FillLight;a._renderer=null;a._resetReferencePosition();return a}l(b,d);b.prototype.destroy=function(){this.disconnectView();this._viewHandles.destroy()};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&
this._renderer.updating)},enumerable:!0,configurable:!0});b.prototype.connectView=function(a){var c=this;this._renderer||(this._view=a,this._renderer=new x({view:a}),this._viewHandles.add([a.watch("environment.lighting.date",function(a){return c._lightingDateHandler(a)},!0),a.watch("stationary",function(){return c._interactingStationaryHandler()}),a.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],function(){return c._updateRenderParamsHandler()},
!0),a.watch("spatialReference",function(){return c._resetReferencePosition()},!0),g.init(a,"viewingMode",function(){return c._resetReferencePosition()},!0),g.init(a,"environment.lighting.cameraTrackingEnabled",function(a){return c._updateCameraTracking(a)},!0),g.init(a,"state.camera",function(){return c._cameraHandler(null)},!0),this.watch("disableQueries",function(){return c._cameraHandler(null)})]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};
b.prototype.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};b.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this._view.environment.lighting)a.positionTimezoneInfo.autoUpdated=!1};b.prototype._lightingDateHandler=function(a){if(a){var c=this._view.environment.lighting;if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=
!0;if(!y.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var g=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(g)){this._requestReferencePositionUpdate(g);return}}this._preupdateTracking(a);this._referencePosWGS84Comparable&&(g=v.positionToTimezone(this._referencePosWGS84Comparable,E),n.isSome(g)&&(c.autoUpdate(null,g),this._trackingEnabled&&(c.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(a)}};b.prototype._preupdateTracking=
function(a){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(a)};b.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this._view.ready){var c=this._view.camera;c&&(this._cameraHandlerClientSide(c,a)||this._cameraHandlerServerSide(c))}};b.prototype._cameraHandlerClientSide=function(a,c){if(!y.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;a=a.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=
u.vec3f64.create());y.pointToWGS84ComparableLonLat(a,this._referencePosWGS84Comparable);this._autoUpdateTimezone(this._referencePosWGS84Comparable,c)||this._updateLightParams(c);return!0};b.prototype._cameraHandlerServerSide=function(a){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=
a.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};b.prototype._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};b.prototype._updateLightParams=function(a){var c=this._view.environment.lighting;a=a||c.date;var c=this._view._stage,g;this._referencePosWGS84Comparable?(g=m.computeColorAndIntensity(a,this._referencePosWGS84Comparable),m.computeDirection(a,this._referencePosWGS84Comparable,this._view.viewingMode,g.diffuse.direction)):
g={diffuse:{color:[1,1,1],intensity:.55,direction:B},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};p.vec3.scale(this._mainLight.intensity,g.diffuse.color,g.diffuse.intensity*Math.PI);p.vec3.negate(this._mainLight.direction,g.diffuse.direction);p.vec3.scale(this._ambientLight.intensity,g.ambient.color,g.ambient.intensity);p.vec3.lerp(this._moonLight.intensity,G,J,g.globalFactor);p.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*g.globalFactor)*(1-.4*g.noonFactor*
(1-g.globalFactor)));p.vec3.copy(this._moonLight.direction,g.diffuse.direction);c.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:g.globalFactor,groundLightingFactor:1-g.noonFactor});this._updateRenderParamsHandler()};b.prototype._autoUpdateTimezone=function(a,c){void 0===c&&(c=null);if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;var g=C;g.setTime((c||this._view.environment.lighting.date).getTime());a=v.positionToTimezone(a,E);if(n.isNone(a))return!1;
var d=this._view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var e=g.getUTCHours()-(a.hours-d.hours),k=g.getUTCMinutes()-(a.minutes-d.minutes),d=g.getUTCSeconds()-(a.seconds-d.seconds);g.setUTCHours(e);g.setUTCMinutes(k);g.setUTCSeconds(d);return c?!1:this._view.environment.lighting.autoUpdate(g,a)};b.prototype._updateRenderParamsHandler=function(){var a=this._view._stage;if(a){var c=this._referencePosWGS84Comparable?
m.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,g=this._view.environment.background,g=g instanceof A?{type:"color",color:t.vec4f64.fromArray(e.toUnitRGBA(g.color))}:{type:"color",color:t.vec4f64.fromValues(0,0,0,1)};a.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&c,ssao:this._view.environment.lighting.ambientOcclusionEnabled,background:g})}};b.prototype._resetReferencePosition=function(){this._cancelReferencePosUpdates();
this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating")};b.prototype._requestReferencePositionUpdate=function(a,g){var d=this;void 0===g&&(g=!1);if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!g,!this._referencePosUpdateQuery&&
!this.referencePosUpdateTimer&&this._view.stationary)){var e=this._referencePosUpdateQuery=c.after(this._referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===e)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==e})}).catch(function(a){"mapcoordshelper:missing-geometry-service"===a.name&&(d.disableQueries=!0)}).then(function(){d._referencePosUpdateQuery===e&&(d._referencePosUpdateQuery=null,d.referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),
d.notifyChange("updating"))}),k=this.referencePosUpdateTimer=c.after(this._referencePointUpdateInterval).then(function(){d.referencePosUpdateTimer===k&&(d.referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};b.prototype._doReferencePositionUpdateQuery=function(c){return a(this,void 0,void 0,function(){var a,g;return h(this,function(d){switch(d.label){case 0:return this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=
!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null,[4,this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords)];case 1:return a=d.sent(),c()||isNaN(a[0])||isNaN(a[1])||(g=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=
a[0],this._referencePosWGS84Comparable[1]=a[1],this._referencePosWGS84Comparable[2]=g):this._referencePosWGS84Comparable=[a[0],a[1],g],this._referencePosChanged()),[2]}})})};b.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};b.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||
this._updateLightParams()};b.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this._view.mapCoordsHelper&&(a*=this._view.mapCoordsHelper.unitInMeters),a>this._referencePointUpdateDistThreshold):!0};b.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,set referencePointUpdateInterval(c){a._referencePointUpdateInterval=
c},set referencePointUpdateDistThreshold(c){a._referencePointUpdateDistThreshold=c},set referencePosUpdateTimer(c){a.referencePosUpdateTimer=c},set referencePointUpdateDelay(c){a._referencePointUpdateDelay=c}}},enumerable:!0,configurable:!0});b.FIXED_LIGHT_DIRECTION=B;f([r.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],b.prototype,"updating",null);f([r.property()],b.prototype,"disableQueries",void 0);f([r.property()],b.prototype,"_renderer",void 0);return b=
f([r.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],b)}(r.declared(d.EventedAccessor));b.SceneViewEnvironmentManager=q;var C=new Date,E={hours:0,minutes:0,seconds:0},G=u.vec3f64.fromValues(.22,.22,.33),J=u.vec3f64.fromValues(.22,.22,.22);b.default=q})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f64=l})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require",
"exports"],function(q,b){function l(){return[0,0,0,0]}function f(){return[1,1,1,1]}function h(){return[1,0,0,0]}function a(){return[0,1,0,0]}function e(){return[0,0,1,0]}function d(){return[0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){return[a[0],a[1],a[2],a[3]]};b.fromValues=function(a,d,c,g){return[a,d,c,g]};b.fromArray=function(a){for(var d=l(),c=Math.min(4,a.length),g=0;g<c;++g)d[g]=a[g];return d};b.createView=function(a,d){return new Float64Array(a,
d,4)};b.zeros=function(){return l()};b.ones=f;b.unitX=h;b.unitY=a;b.unitZ=e;b.unitW=d;b.ZEROS=l();b.ONES=f();b.UNIT_X=h();b.UNIT_Y=a();b.UNIT_Z=e();b.UNIT_W=d()})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){var p=[12,13];return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new e;a._initContext=null;a._pendingAtmosphere=null;a._atmosphere=null;a._stars=null;return a}l(h,b);Object.defineProperty(h.prototype,"canRender",{get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return null!=
this._pendingAtmosphere},enumerable:!0,configurable:!0});h.prototype.initialize=function(){this.view._stage.addRenderPlugin(p,this)};h.prototype.destroy=function(){this._pendingAtmosphere&&(this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};h.prototype.initializeRenderContext=
function(a){this._initContext=a;this._techniqueRepository=this._initContext.shaderTechniqueRep;this.setup()};h.prototype.setup=function(){var a=this;this._handles.add(d.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()},!0));this._handles.add([d.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()},!0),d.init(this.view,"environment.starsEnabled",function(){return a._updateStars()},!0)])};h.prototype.uninitializeRenderContext=
function(){this._stars&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};h.prototype.render=function(a){var c=!0;this._stars&&this._stars.canRender&&(c=this._stars.render(a)&&c);this._atmosphere&&this._atmosphere.canRender&&(c=this._atmosphere.render(a)&&c);return c};h.prototype._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()};
h.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new r(this.view),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};h.prototype._updateAtmosphere=function(){var a=this,c=this._getAtmosphereType();this.atmosphereType!==c&&(this.atmosphereType=c,this._pendingAtmosphere&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),
this._pendingAtmosphere=null),(c=this._getAtmosphereClass())?(c=new c(this.view,this._techniqueRepository),c.initializeRenderContext(this._initContext),null==this._atmosphere&&(this._atmosphere=c,this._setNeedsRender()),this._pendingAtmosphere=c,c.when(function(){a._pendingAtmosphere!==a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=a._pendingAtmosphere);a._pendingAtmosphere=null;a._setNeedsRender();a._updateBasemapTerrain()})):(this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=
null,this._setNeedsRender()),this._updateBasemapTerrain()))};h.prototype._getAtmosphereClass=function(){var d=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(d);switch(d){case "none":return null;case "realistic":return c.RealisticAtmosphere;case "panoramic":return n;case "simple":return g;default:a.neverReached(d)}};h.prototype._getAtmosphereType=function(){var a=this.view.get("environment.atmosphereEnabled"),g=this.view.get("environment.atmosphere.quality");
return a&&null!=g?"local"===this.view.viewingMode?"panoramic":"high"===g&&c.RealisticAtmosphere.isSupported(this._initContext)?"realistic":"simple":"none"};h.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};Object.defineProperty(h.prototype,"test",{get:function(){return{atmosphere:this._atmosphere}},enumerable:!0,configurable:!0});f([k.property({constructOnly:!0})],h.prototype,"view",void 0);f([k.property({constructOnly:!0})],
h.prototype,"atmosphereClassFromType",void 0);f([k.property({dependsOn:["_pendingAtmosphere"]})],h.prototype,"updating",null);f([k.property()],h.prototype,"_pendingAtmosphere",void 0);return h=f([k.subclass("esri.views.3d.environment.EnvironmentRenderer")],h)}(k.declared(h))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){q=function(){function g(a,c){this.slot=12;this._readyResolver=h.createResolver();this._readyController=h.createAbortController();this.view=a;this._techniqueRepository=c;this._atmosphereTechniqueConfig=new d.SimpleAtmosphereTechniqueConfiguration}Object.defineProperty(g.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});g.prototype.destroy=function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),
this._texture=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};g.prototype.when=function(a){return f(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:return[4,this._readyResolver.promise];case 1:return c.sent(),a(),[2]}})})};g.prototype.initializeRenderContext=function(a){var c=this,g=a.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(d.SimpleAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(g);this._vaoCount=v.vertexCount(this._vao,"geometry");n.requestImage(k,{signal:this._readyController.signal}).then(function(g){c._texture=new x(a.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},g);a.requestRender();c._readyController=null;c._readyResolver.resolve()})};g.prototype.uninitializeRenderContext=function(){this.destroy()};g.prototype.render=function(c){if(c.slot!==
this.slot||0!==c.pass)return!1;var g=c.rctx,d=this._atmosphereTechnique.program;g.bindProgram(d);this._atmosphereTechnique.bindPipelineState(g);g.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",c.camera.projectionMatrix);var e=m;a.mat4.copy(e,c.camera.viewMatrix);e[12]=0;e[13]=0;e[14]=0;e[15]=1;d.setUniformMatrix4fv("view",m);d.setUniform4f("color",1,1,1,1);c.scenelightingData.setLightDirectionUniform(d);g.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);
g.drawArrays(4,0,this._vaoCount);return!0};g.prototype._createVertexArrayObject=function(a){for(var g=p.createPolySphereGeometry(1,2,!1),d=g.indices[u.VertexAttrConstants.POSITION],e=0;e<d.length;e+=3){var k=d[e];d[e]=d[e+2];d[e+2]=k}for(var g=g.vertexAttributes[u.VertexAttrConstants.POSITION].data,k=w.createBuffer(d.length),m=k.position,e=0;e<d.length;++e){var b=3*d[e];m.set(e,0,g[b]);m.set(e,1,g[b+1]);m.set(e,2,g[b+2])}return new y(a,r.Default3D,{geometry:c.glLayout(w)},{geometry:t.createVertex(a,
35044,k.buffer)})};return g}();var m=e.mat4f64.create(),w=g.newLayout().vec3f("position");return q})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f64=l})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(q,b){function l(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=
function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]};b.fromValues=function(b,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){return[b,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y]};b.createView=function(b,h){return new Float64Array(b,h,16)};b.IDENTITY=l()})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(d){function k(){return null!==d&&d.apply(this,arguments)||this}l(k,d);k.prototype.initializeProgram=function(a){var g=k.shader.get().build({geometry:this.configuration.geometry});return new c(a.rctx,g.generateSource("vertex"),g.generateSource("fragment"),n.Default3D)};k.prototype.initializePipeline=function(){return 1===this.configuration.geometry?g.makePipelineState({blending:g.separateBlendingParams(770,
1,771,771),culling:g.backFaceCullingParams,depthTest:{func:515},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};k.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};k.shader=new e.ReloadableShaderModule(a,"../environment/SimpleAtmosphere.glsl",q);return k}(d.ShaderTechnique);b.SimpleAtmosphereTechnique=h;h=function(a){function c(){var c=null!==a&&a.apply(this,
arguments)||this;c.geometry=0;return c}l(c,a);f([k.parameter({count:3})],c.prototype,"geometry",void 0);return c}(k.ShaderTechniqueConfiguration);b.SimpleAtmosphereTechniqueConfiguration=h})},"esri/views/3d/environment/SimpleAtmosphere.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/Transform.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var m=new d.ShaderBuilder;2===b.geometry?(m.attributes.add("position","vec2"),m.varyings.add("color","vec4"),m.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),m.vertex.code.add(e.glsl(k||(k=l(["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "],
["\n      void main(void) {\n          float ndotl \x3d dot(normalize(cameraPosition), -lightingMainDirection);\n          float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n          color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\n\n          gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\n      }\n  "])))),m.fragment.code.add(e.glsl(n||(n=l(["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "],["\n      void main() {\n          gl_FragColor \x3d color;\n      }\n  "]))))):
(m.include(a.Transform,{linearDepth:!1}),m.attributes.add("position","vec3"),m.varyings.add("vtc","vec2"),m.varyings.add("falloff","float"),1!==b.geometry&&m.varyings.add("innerFactor","float"),m.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==b.geometry&&m.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==b.geometry&&m.vertex.code.add(e.glsl(c||(c=l(["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"],
["\n\t\t\tconst float TWICEPI \x3d 2.0*3.14159265;\n\t\t\tconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\n\t\t"])))),m.vertex.code.add(e.glsl(g||(g=l(["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"],["\n\t\tvoid main(void) {\n\t\t\tvec3 lightDirection \x3d -lightingMainDirection;\n\t"])))),1===b.geometry?m.vertex.code.add(e.glsl(r||(r=l(["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"],
["\n\t\t\tvec3 pos \x3d position;\n\t\t\tfloat ndotl \x3d lightDirection.z;\n\t\t\tvtc \x3d vec2(0.0, position.z+0.05);\n\t\t\t"])))):m.vertex.code.add(e.glsl(p||(p=l(["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"],
["\n\t\t\tinnerFactor \x3d clamp(-position.z, 0.0, 1.0);\n\t\t\tfloat scale \x3d position.y * (1.0 + innerFactor * innerScale);\n\t\t\tfloat phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\n\t\t\tvec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\n\t\t\tfloat ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\n\n\t\t\tvtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\n\t\t\tvtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\n\t\t"])))),
m.vertex.code.add(e.glsl(u||(u=l(["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"],["\n\t\tfalloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\n\n\t\tgl_Position \x3d transformPosition(proj, view, pos);\n\t\tgl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n\t\t\t}\n\t"])))),m.fragment.uniforms.add("tex",
"sampler2D"),1!==b.geometry&&m.fragment.uniforms.add("altitudeFade","float"),m.fragment.code.add(e.glsl(t||(t=l(["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"],["\n\t\tvoid main() {\n\t\t\tvec4 texColor \x3d texture2D(tex, vtc);\n\t"])))),1===b.geometry?m.fragment.code.add(e.glsl(x||(x=l(["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"],["\n\t\t\tgl_FragColor \x3d texColor * falloff;\n\t\t\t}\n\t\t"])))):m.fragment.code.add(e.glsl(v||(v=l(["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"],
["\n\t\t\tvec4 atmosphereColor \x3d texColor * falloff;\n\t\t\tvec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\n\t\t\tgl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\n\t\t}\n\t\t"])))));return m};var k,n,c,g,r,p,u,t,x,v})},"esri/core/tsSupport/makeTemplateObjectHelper":function(){define([],function(){return function(q,b){if(Object.defineProperty)return Object.defineProperty(q,"raw",{value:b});q.raw=b;return q}})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define("require exports ../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a){function e(c,g){g.linearDepth?c.vertex.code.add(a.glsl(k||(k=l(["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "],["\n    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\n      vec4 eye \x3d view * vec4(pos, 1.0);\n      depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\n      return proj * eye;\n    }\n    "])))):
c.vertex.code.add(a.glsl(n||(n=l(["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "],["\n    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\n      // Make sure the order of operations is the same as in transformPositionWithDepth.\n      return proj * (view * vec4(pos, 1.0));\n    }\n    "]))))}Object.defineProperty(b,"__esModule",
{value:!0});b.Transform=e;(function(a){function c(a,c,g){f.mat4.translate(d,g,c);a.setUniform3fv("localOrigin",c);a.setUniformMatrix4fv("view",d)}a.bindUniformsCustomOrigin=c;a.bindUniforms=function(a,g){c(a,g.origin,g.view)}})(e=b.Transform||(b.Transform={}));var d=h.mat4f32.create(),k,n})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f32=l})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require",
"exports"],function(q,b){function l(){var b=new Float32Array(16);b[0]=1;b[5]=1;b[10]=1;b[15]=1;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(b){var f=new Float32Array(16);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];f[9]=b[9];f[10]=b[10];f[11]=b[11];f[12]=b[12];f[13]=b[13];f[14]=b[14];f[15]=b[15];return f};b.fromValues=function(b,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){var m=new Float32Array(16);m[0]=b;m[1]=h;m[2]=a;m[3]=
e;m[4]=d;m[5]=k;m[6]=n;m[7]=c;m[8]=g;m[9]=r;m[10]=p;m[11]=u;m[12]=t;m[13]=x;m[14]=v;m[15]=y;return m};b.createView=function(b,h){return new Float32Array(b,h,16)};b.IDENTITY=l()})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["require","exports"],function(q,b){function l(b){for(var f=[],a=1;a<arguments.length;a++)f[a-1]=arguments[a];for(var a="",e=0;e<f.length;e++)a+=b[e]+f[e];return a+=b[b.length-1]}Object.defineProperty(b,"__esModule",{value:!0});b.glsl=l;(function(b){b.int=
function(b){return Math.round(b).toString()}})(l=b.glsl||(b.glsl={}))})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["require","exports","../../../../../core/iteratorUtils","../../../../../core/Logger"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=f.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");q=function(){function a(){this.vertex=new d;this.fragment=new d;this.attributes=new k;this.varyings=new n;this.extensions=
new c;this.defines=new g;this._includedModules=new Map}a.prototype.include=function(a,c){this._includedModules.has(a)?this._includedModules.get(a)!==c&&h.error("Trying to include shader module multiple times with different sets of options."):(this._includedModules.set(a,c),"shaderModule"in a?a.shaderModule(this,c):a(this,c))};a.prototype.generateSource=function(a){var c=this.extensions.generateSource(a),g=this.attributes.generateSource(a),d=this.varyings.generateSource(),e="vertex"===a?this.vertex:
this.fragment,k=e.uniforms.generateSource(),b=e.code.generateSource();a="vertex"===a?p:r;e=this.defines.generateSource().concat(e.defines.generateSource());return"\n"+c.join("\n")+"\n\n"+e.join("\n")+"\n\n"+a+"\n\n"+k.join("\n")+"\n\n"+g.join("\n")+"\n\n"+d.join("\n")+"\n\n"+b.join("\n")};return a}();b.ShaderBuilder=q;var a=function(){function a(){this._entries=[];this._set=new Set}a.prototype.add=function(a,c,g){var d=a+"_"+c+"_"+g;this._set.has(d)||(this._entries.push([a,c,g]),this._set.add(d));
return this};a.prototype.generateSource=function(){return this._entries.map(function(a){var c=a[2];return"uniform "+a[1]+" "+a[0]+(c?"["+c+"]":"")+";"})};return a}(),e=function(){function a(){this._entries=[]}a.prototype.add=function(a){this._entries.push(a)};a.prototype.generateSource=function(){return this._entries};return a}(),d=function(){return function(){this.uniforms=new a;this.code=new e;this.defines=new g}}(),k=function(){function a(){this._entries=[]}a.prototype.add=function(a,c){this._entries.push([a,
c])};a.prototype.generateSource=function(a){return"fragment"===a?[]:this._entries.map(function(a){return"attribute "+a[1]+" "+a[0]+";"})};return a}(),n=function(){function a(){this._entries=[]}a.prototype.add=function(a,c){this._entries.push([a,c])};a.prototype.generateSource=function(){return this._entries.map(function(a){return"varying "+a[1]+" "+a[0]+";"})};return a}(),c=function(){function a(){this._entries=new Set}a.prototype.add=function(a){this._entries.add(a)};a.prototype.generateSource=function(c){var g=
"vertex"===c?a.WHITELIST_VERTEX:a.WHITELIST_FRAGMENT;return l.valuesOfSet(this._entries).filter(function(a){return 0<=g.indexOf(a)}).map(function(a){return"#extension "+a+" : enable"})};a.WHITELIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];a.WHITELIST_VERTEX=[];return a}(),g=function(){function a(){this._entries=new Map}a.prototype.addInt=function(a,c){c=0===c%1?c.toFixed(0):c.toString();this._entries.set(a,c)};a.prototype.addFloat=function(a,c){c=0===c%1?c.toFixed(1):c.toString();
this._entries.set(a,c)};a.prototype.generateSource=function(){return l.pairsOfMap(this._entries).map(function(a){return"#define "+a[0]+" "+a[1]})};return a}(),r="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",p="precision highp float;\nprecision highp sampler2D;"})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["require","exports","../../../../../core/promiseUtils"],
function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e){this._relativePath=a;this._moduleRequire=e;this._module=b}b.prototype.get=function(){return this._module};b.prototype.reload=function(){var b=this,a=this._moduleRequire.toUrl(this._relativePath),a=a.slice(a.indexOf("esri/"));this._recursivelyInvalidateModuleCache(a);return l.create(function(a){b._moduleRequire([b._relativePath],function(d){b._module=d;a()})})};b.prototype._recursivelyInvalidateModuleCache=
function(b){if(-1!==b.search("shader")||-1!==b.search("shading")){var a=this._moduleRequire.modules,e=a[b];if(e)for(e=e.deps,delete a[b],b=0;b<e.length;b++)a=e[b],"esri"===a.pid&&this._recursivelyInvalidateModuleCache(a.mid)}};return b}();b.ReloadableShaderModule=q})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h){if(h){var a=h.__proto__.__configurationParameters||
[],e={};e.key=h.key;for(var d=0;d<a.length;d++){var k=a[d];e[k]=h[k]}this._config=e}this._program=this.initializeProgram(b);b.commonUniformStore&&(this._commonUniformStore=b.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(b)}b.prototype.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),this._program=null)};b.prototype.reload=function(b){this._program&&
(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(b);this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};Object.defineProperty(b.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pipeline",{get:function(){return this._pipeline},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"key",
{get:function(){return this._config.key},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"configuration",{get:function(){return this._config},enumerable:!0,configurable:!0});b.prototype.bindPass=function(b,h,a){};b.prototype.bindMaterial=function(b,h){};b.prototype.bindDraw=function(b){};b.prototype.ensureAttributeLocations=function(b){this.program.assertCompatibleVertexAttributeLocations(b)};Object.defineProperty(b.prototype,"primitiveType",{get:function(){return 4},enumerable:!0,
configurable:!0});return b}();b.ShaderTechnique=q})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["require","exports","../../../../../core/mathUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(){this.key=0}}();b.ShaderTechniqueConfiguration=q;b.parameter=function(b){void 0===b&&(b={});return function(f,a){f.__configurationParameters=f.__configurationParameters||[];f.__configurationParameters.push(a);
var e="_"+a;void 0===f.__configurationParameters__offset&&(f.__configurationParameters__offset=0);var d=f.__configurationParameters__offset,k=Math.ceil(l.log2(b.count||2)),h=(1<<k)-1<<d;f.__configurationParameters__offset+=k;if(32<=f.__configurationParameters__offset)throw Error("ShaderTechniqueConfiguration is too complex, requiring more than 32 bits to encode.\n      Either the configuration must be simplified, or this restriction must be relaxed.(Currently used: "+f.__configurationParameters__offset+
")");Object.defineProperty(f,a,{get:function(){return this[e]},set:function(a){this.key=this.key&~h|a<<d&h;this[e]=a}})}}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,tangent:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,
modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","../../core/maybe","./ShaderTranspiler"],function(q,b,l,f,h){function a(a,d){if(f.isNone(a)||a.length!==d.length)return!0;for(var e=0;e<a.length;++e)if(a[e]!==d[e])return!0;return!1}return function(){function e(a,k,b,c,g){void 0===g&&(g={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines=
{};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===k.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=k;this._fragmentShaderSource=b;if(Array.isArray(g))for(a=0;a<g.length;a++)this._defines[g[a]]=
"1";else this._defines=g;this._id=e._nextId++;this._locations=c}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});e.prototype.getDefine=function(a){return this._defines[a]};e.prototype.dispose=function(){if(this._context){var a=
this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};e.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,e=a.createProgram();a.attachShader(e,this._vShader);
a.attachShader(e,this._fShader);for(var b in this._locations)a.bindAttribLocation(e,this._locations[b],b);a.linkProgram(e);this._glName=e;this._initialized=!0}};e.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};e.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};e.prototype.getAttribLocation=function(a){this.initialize();
void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};e.prototype.setUniform1i=function(a,e){var d=this._nameToUniform1[a];if(void 0===d||e!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};e.prototype.setUniform1iv=function(d,k){var b=this._nameToUniform1v[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(d),
k),void 0===b?this._nameToUniform1v[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform2iv=function(d,k){var b=this._nameToUniform2[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform2[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform3iv=function(d,k){var b=this._nameToUniform3[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform3[d]=
e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform4iv=function(d,k){var b=this._nameToUniform4[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform4[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform1f=function(a,e){var d=this._nameToUniform1[a];if(void 0===d||e!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};e.prototype.setUniform1fv=
function(d,k){var b=this._nameToUniform1v[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform1v[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform2f=function(a,e,b){var c=this._nameToUniform2[a];if(void 0===c||e!==c[0]||b!==c[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),e,b),void 0===c?this._nameToUniform2[a]=[e,b]:(c[0]=e,c[1]=b)};e.prototype.setUniform2fv=function(d,
k){var b=this._nameToUniform2[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform2[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform3f=function(a,e,b,c){var g=this._nameToUniform3[a];if(void 0===g||e!==g[0]||b!==g[1]||c!==g[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),e,b,c),void 0===g?this._nameToUniform3[a]=[e,b,c]:(g[0]=e,g[1]=b,g[2]=c)};e.prototype.setUniform3fv=
function(d,k){var b=this._nameToUniform3[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform3[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniform4f=function(a,e,b,c,g){var d=this._nameToUniform4[a];if(void 0===d||e!==d[0]||b!==d[1]||c!==d[2]||g!==d[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),e,b,c,g),void 0===d?this._nameToUniform4[a]=[e,b,c,g]:(d[0]=e,d[1]=b,d[2]=
c,d[3]=g)};e.prototype.setUniform4fv=function(d,k){var b=this._nameToUniform4[d];a(b,k)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(d),k),void 0===b?this._nameToUniform4[d]=e._arrayCopy(k):e._arrayAssign(k,b))};e.prototype.setUniformMatrix3fv=function(d,k,b){void 0===b&&(b=!1);var c=this._nameToUniformMatrix3[d],g;g=f.isNone(c)?!0:9!==c.length?a(c,k):9!==c.length||c[0]!==k[0]||c[1]!==k[1]||c[2]!==k[2]||c[3]!==k[3]||c[4]!==k[4]||c[5]!==k[5]||c[6]!==k[6]||c[7]!==
k[7]||c[8]!==k[8];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),b,k),void 0===c?this._nameToUniformMatrix3[d]=e._arrayCopy(k):e._arrayAssign(k,c))};e.prototype.setUniformMatrix4fv=function(d,k,b){void 0===b&&(b=!1);var c=this._nameToUniformMatrix4[d],g;g=f.isNone(c)?!0:16!==c.length?a(c,k):16!==c.length||c[0]!==k[0]||c[1]!==k[1]||c[2]!==k[2]||c[3]!==k[3]||c[4]!==k[4]||c[5]!==k[5]||c[6]!==k[6]||c[7]!==k[7]||c[8]!==k[8]||c[9]!==k[9]||c[10]!==k[10]||
c[11]!==k[11]||c[12]!==k[12]||c[13]!==k[13]||c[14]!==k[14]||c[15]!==k[15];g&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),b,k),void 0===c?this._nameToUniformMatrix4[d]=e._arrayCopy(k):e._arrayAssign(k,c))};e.prototype.assertCompatibleVertexAttributeLocations=function(a){(a=a.locations===this.locations)||console.error("VertexAttributeLocations are incompatible");return a};e._padToThree=function(a){var d=a.toString();1E3>a&&(d=("  "+a).slice(-3));return d};
e.prototype._addLineNumbers=function(a){var d=2;return a.replace(/\n/g,function(){return"\n"+e._padToThree(d++)+":"})};e.prototype._loadShader=function(a){var d=35633===a,e=d?this._vertexShaderSource:this._fragmentShaderSource,c;c="";for(var g in this._defines)c+="#define "+g+" "+this._defines[g]+"\n";c+=e;"webgl2"===this._context.contextVersion&&(c=h.transpileShader(c,d?"vertex":"fragment"));g=this._context.gl;a=g.createShader(a);g.shaderSource(a,c);g.compileShader(a);g.getShaderParameter(a,g.COMPILE_STATUS)||
(console.error("Compile error in ".concat(d?"vertex":"fragment"," shader")),console.error(g.getShaderInfoLog(a)),console.error(this._addLineNumbers(c)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(e)));return a};e._arrayCopy=function(a){for(var d=[],e=0;e<a.length;++e)d.push(a[e]);return d};e._arrayAssign=function(a,e){for(var d=0;d<a.length;++d)e[d]=a[d]};e._nextId=0;return e}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require",
"exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(q,b,l,f){function h(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function a(d,e,c,g){g=g||c;for(var k=0;k<d.length;k++){var b=d[k];if("ident"===b.type&&b.data===c)return g in e?e[g]++:e[g]=0,a(d,e,g+"_"+e[g],g)}return c}function e(a,d,c){void 0===c&&(c="afterVersion");var g={data:"\n",type:"whitespace"},e=function(c){return c<a.length?/[^\r\n]$/.test(a[c].data):!1},k=function(a){for(var g=-1,d=0,e=-1,
k=0;k<a.length;k++){var b=a[k];"preprocessor"===b.type&&(b.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:b.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===b.type&&/^#version/.test(b.data)&&(e=Math.max(e,k));if("afterPrecision"===c&&"keyword"===b.type&&"precision"===b.data){a:{for(b=k;b<a.length;b++){var f=a[b];if("operator"===f.type&&";"===f.data)break a}b=null}if(null===b)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,b)}g<
e&&0===d&&(g=k)}return g+1}(a);e(k-1)&&a.splice(k++,0,g);for(var b=0;b<d.length;b++){var f=d[b];a.splice(k++,0,f)}e(k-1)&&e(k)&&a.splice(k,0,g)}Object.defineProperty(b,"__esModule",{value:!0});var d=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];b.transpileShader=function(k,b){k=f(k);var c;a:{c="100";var g="300 es";void 0===c&&(c="100");void 0===g&&(g="300 es");for(var r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,p=0;p<k.length;p++){var n=k[p];
if("preprocessor"===n.type){var t=r.exec(n.data);if(t){r=t[1].replace(/\s\s+/g," ");if(r===g){c=r;break a}if(r===c){n.data="#version "+g;break a}throw Error("unknown glsl version: "+r);}}}k.splice(0,0,{type:"preprocessor",data:"#version "+g},{type:"whitespace",data:"\n"});c=null}if("300 es"===c)throw Error("shader is already glsl 300 es");r=n=null;p={};t={};for(c=0;c<k.length;++c)switch(g=k[c],g.type){case "keyword":"vertex"===b&&"attribute"===g.data?g.data="in":"varying"===g.data&&(g.data="vertex"===
b?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(g.data.trim())&&(g.data=g.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===b&&"gl_FragColor"===g.data){if(!n){var n=a(k,p,"fragColor"),x=void 0;void 0===x&&(x="lowp");e(k,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:x},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:n},{type:"operator",data:";"}],"afterPrecision")}g.data=
n}else"fragment"===b&&"gl_FragDepthEXT"===g.data&&(r||(r=a(k,p,"gl_FragDepth")),g.data=r);break;case "ident":if(0<=l.indexOf(g.data)){if(x="vertex"===b)a:{for(x=c-1;0<=x;x--){var v=k[x];if("whitespace"!==v.type&&"block-comment"!==v.type)if("keyword"===v.type){if("attribute"===v.data||"in"===v.data){x=!0;break a}}else break}x=!1}if(x)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");g.data in t||(t[g.data]=a(k,p,g.data));g.data=t[g.data]}}for(c=k.length-1;0<=
c;--c)g=k[c],"preprocessor"===g.type&&((b=g.data.match(/\#extension\s+(.*)\:/))&&b[1]&&0<=d.indexOf(b[1].trim())&&(b=k[c+1],k.splice(c,b&&"whitespace"===b.type?2:1)),(b=g.data.match(/\#ifdef\s+(.*)/))&&b[1]&&0<=d.indexOf(b[1].trim())&&(g.data="#if 1"),(b=g.data.match(/\#ifndef\s+(.*)/))&&b[1]&&0<=d.indexOf(b[1].trim())&&(g.data="#if 0"));return h(k)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(q,b){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(q){"use strict;";return function(b){var l=q(),f=[],f=f.concat(l(b));return f=f.concat(l(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(q,b,l){"use strict;";var f="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function h(a){a.length&&v.push({type:f[p],
data:a,position:w,line:y,column:m})}function a(){x=x.length?[]:x;if("/"===t&&"*"===u)return w=r+g-1,p=0,t=u,g+1;if("/"===t&&"/"===u)return w=r+g-1,p=1,t=u,g+1;if("#"===u)return p=2,w=r+g,g;if(/\s/.test(u))return p=9,w=r+g,g;A=/\d/.test(u);B=/[^\w_]/.test(u);w=r+g;p=A?4:B?3:9999;return g}function e(){if(("\r"===u||"\n"===u)&&"\\"!==t)return h(x.join("")),p=999,g;x.push(u);t=u;return g+1}function d(){if("."===t&&/\d/.test(u))return p=5,g;if("/"===t&&"*"===u)return p=0,g;if("/"===t&&"/"===u)return p=
1,g;if("."===u&&x.length){for(;k(x););p=5;return g}if(";"===u||")"===u||"("===u){if(x.length)for(;k(x););h(u);p=999;return g+1}var a=2===x.length&&"\x3d"!==u;if(/[\w_\d\s]/.test(u)||a){for(;k(x););p=999;return g}x.push(u);t=u;return g+1}function k(a){var c=0,g,d;do{g=b.indexOf(a.slice(0,a.length+c).join(""));d=b[g];if(-1===g){if(0<c--+a.length)continue;d=a.slice(0,1).join("")}h(d);w+=d.length;x=x.slice(d.length);return x.length}while(1)}function n(){if("."===u||/[eE]/.test(u))return x.push(u),p=5,
t=u,g+1;if("x"===u&&1===x.length&&"0"===x[0])return p=11,x.push(u),t=u,g+1;if(/[^\d]/.test(u))return h(x.join("")),p=999,g;x.push(u);t=u;return g+1}function c(){"f"===u&&(x.push(u),t=u,g+=1);if(/[eE]/.test(u)||"-"===u&&/[eE]/.test(t))return x.push(u),t=u,g+1;if(/[^\d]/.test(u))return h(x.join("")),p=999,g;x.push(u);t=u;return g+1}var g=0,r=0,p=999,u,t,x=[],v=[],y=1,m=0,w=0,A=!1,B=!1,C="",E;return function(k){v=[];if(null!==k){k=k.replace?k.replace(/\r\n/g,"\n"):k;g=0;C+=k;for(E=C.length;u=C[g],g<
E;){k=g;switch(p){case 0:"/"===u&&"*"===t?(x.push(u),h(x.join("")),p=999):(x.push(u),t=u);g+=1;break;case 1:g=e();break;case 2:g=e();break;case 3:g=d();break;case 4:g=n();break;case 11:/[^a-fA-F0-9]/.test(u)?(h(x.join("")),p=999):(x.push(u),t=u,g+=1);break;case 5:g=c();break;case 9999:if(/[^\d\w_]/.test(u)){var b=x.join("");p=-1<q.indexOf(b)?8:-1<l.indexOf(b)?7:6;h(x.join(""));p=999}else x.push(u),t=u,g+=1;break;case 9:/[^\s]/g.test(u)?(h(x.join("")),p=999):(x.push(u),t=u,g+=1);break;case 999:g=a()}if(k!==
g)switch(C[k]){case "\n":m=0;++y;break;default:++m}}r+=g;C=C.slice(g);return v}x.length&&h(x.join(""));p=10;h("(eof)");return v}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(q,b,l){function f(a){return w.intern(a)}function h(a){return A.intern(a)}function a(a){return B.intern(a)}function e(a){return C.intern(a)}function d(a){return E.intern(a)}function k(a){return G.intern(a)}function n(a){return J.intern(a)}function c(a){return I.intern(a)}function g(a){return"["+a.join(",")+"]"}function r(a){return a?g([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,
a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function p(a){return a?g([a.face,a.mode]):null}function u(a){return a?g([a.factor,a.units]):null}function t(a){return a?g([a.func]):null}function x(a){return a?g([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):null}function v(a){return a?g([a.zNear,a.zFar]):null}function y(a){return a?g([a.r,a.g,a.b,a.a]):null}function m(a){return a?g([a.mask]):null}Object.defineProperty(b,"__esModule",
{value:!0});b.simpleBlendingParams=function(a,c,g,d){void 0===g&&(g=32774);void 0===d&&(d=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:c,dstAlpha:c,opRgb:g,opAlpha:g,color:{r:d[0],g:d[1],b:d[2],a:d[3]}}};b.separateBlendingParams=function(a,c,g,d,e,k,m){void 0===e&&(e=32774);void 0===k&&(k=32774);void 0===m&&(m=[0,0,0,0]);return{srcRgb:a,srcAlpha:c,dstRgb:g,dstAlpha:d,opRgb:e,opAlpha:k,color:{r:m[0],g:m[1],b:m[2],a:m[3]}}};b.backFaceCullingParams={face:1029,mode:2305};b.defaultDepthWriteParams={zNear:0,
zFar:1};b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};b.makeBlending=f;b.makeCulling=h;b.makePolygonOffset=a;b.makeDepthTest=e;b.makeStencilTest=d;b.makeDepthWrite=k;b.makeColorWrite=n;b.makeStencilWrite=c;b.makePipelineState=function(a){return K.intern(a)};q=function(){function a(a,c){this.makeKey=a;this.makeRef=c;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var c=this.makeKey(a),g=this.interns;g.has(c)||g.set(c,this.makeRef(a));return g.get(c)};return a}();var w=new q(r,
function(a){return l({__tag:"Blending"},a)}),A=new q(p,function(a){return l({__tag:"Culling"},a)}),B=new q(u,function(a){return l({__tag:"PolygonOffset"},a)}),C=new q(t,function(a){return l({__tag:"DepthTest"},a)}),E=new q(x,function(a){return l({__tag:"StencilTest"},a)}),G=new q(v,function(a){return l({__tag:"DepthWrite"},a)}),J=new q(y,function(a){return l({__tag:"ColorWrite"},a)}),I=new q(m,function(a){return l({__tag:"StencilWrite"},a)}),K=new q(function(a){return a?g([r(a.blending),p(a.culling),
u(a.polygonOffset),t(a.depthTest),x(a.stencilTest),v(a.depthWrite),y(a.colorWrite),m(a.stencilWrite)]):null},function(g){return{blending:f(g.blending),culling:h(g.culling),polygonOffset:a(g.polygonOffset),depthTest:e(g.depthTest),stencilTest:d(g.stencilTest),depthWrite:k(g.depthWrite),colorWrite:n(g.colorWrite),stencilWrite:c(g.stencilWrite)}});q=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=
this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=
function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=
this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);
this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,
this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,
this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,c,g,d){if(g||a!==c)d(a),this._pipelineInvalid=!0;return a};return a}();b.StateTracker=q})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(q,b){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../core/tsSupport/assignHelper","../../../request"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.dataURItoBlob=function(b){var a=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var e=new ArrayBuffer(a.length),d=new Uint8Array(e),k=0;k<a.length;k++)d[k]=a.charCodeAt(k);return new Blob([e],{type:b})};b.requestImage=function(b,a){return f(b,l({responseType:"image"},a)).then(function(a){return a.data})}})},
"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});var f={divisor:0};b.glLayout=function(a,e){void 0===e&&(e={});e=l({},f,e);var d=a.stride;return a.fieldNames.filter(function(d){d=a.fields.get(d).optional;return!(d&&d.glPadding)}).map(function(k){var b=a.fields.get(k),c=b.constructor.ElementCount;var g=h[b.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");
return{name:k,stride:d,count:c,type:g,offset:b.offset,normalized:!(!b.optional||!b.optional.glNormalized),divisor:e.divisor}})};var h={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=function(){function a(a,e){this.layout=a;this.buffer="number"===typeof e?new ArrayBuffer(e*a.stride):e;e=0;for(var d=
a.fieldNames;e<d.length;e++){var c=d[e],g=a.fields.get(c);this[c]=new g.constructor(this.buffer,g.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0});a.prototype.getField=
function(a,e){return(a=this[a])&&a.elementCount===e.ElementCount&&a.elementType===e.ElementType?a:null};a.prototype.slice=function(d,e){return new a(this.layout,this.buffer.slice(d*this.stride,e*this.stride))};a.prototype.copyFrom=function(a,e,b,c){var g=this.stride;0===g%4?(a=new Uint32Array(a.buffer,e*g,c*g/4),b=new Uint32Array(this.buffer,b*g,c*g/4)):(a=new Uint8Array(a.buffer,e*g,c*g),b=new Uint8Array(this.buffer,b*g,c*g));b.set(a)};return a}();b.InterleavedBuffer=h;var a=function(){function a(){this.stride=
0;this.fields=new Map;this.fieldNames=[]}a.prototype.vec2f=function(a,e){this.appendField(a,l.BufferViewVec2f,e);return this};a.prototype.vec2f64=function(a,e){this.appendField(a,l.BufferViewVec2f64,e);return this};a.prototype.vec3f=function(a,e){this.appendField(a,l.BufferViewVec3f,e);return this};a.prototype.vec3f64=function(a,e){this.appendField(a,l.BufferViewVec3f64,e);return this};a.prototype.vec4f=function(a,e){this.appendField(a,l.BufferViewVec4f,e);return this};a.prototype.vec4f64=function(a,
e){this.appendField(a,l.BufferViewVec4f64,e);return this};a.prototype.mat3f=function(a,e){this.appendField(a,l.BufferViewMat3f,e);return this};a.prototype.mat3f64=function(a,e){this.appendField(a,l.BufferViewMat3f64,e);return this};a.prototype.mat4f=function(a,e){this.appendField(a,l.BufferViewMat4f,e);return this};a.prototype.mat4f64=function(a,e){this.appendField(a,l.BufferViewMat4f64,e);return this};a.prototype.vec4u8=function(a,e){this.appendField(a,l.BufferViewVec4u8,e);return this};a.prototype.f32=
function(a,e){this.appendField(a,l.BufferViewFloat,e);return this};a.prototype.f64=function(a,e){this.appendField(a,l.BufferViewFloat64,e);return this};a.prototype.u8=function(a,e){this.appendField(a,l.BufferViewUint8,e);return this};a.prototype.u16=function(a,e){this.appendField(a,l.BufferViewUint16,e);return this};a.prototype.i8=function(a,e){this.appendField(a,l.BufferViewInt8,e);return this};a.prototype.vec2i8=function(a,e){this.appendField(a,l.BufferViewVec2i8,e);return this};a.prototype.vec2i16=
function(a,e){this.appendField(a,l.BufferViewVec2i16,e);return this};a.prototype.vec2u8=function(a,e){this.appendField(a,l.BufferViewVec2u8,e);return this};a.prototype.vec4u16=function(a,e){this.appendField(a,l.BufferViewVec4u16,e);return this};a.prototype.u32=function(a,e){this.appendField(a,l.BufferViewUint32,e);return this};a.prototype.appendField=function(a,e,b){var c=e.ElementCount*f.elementTypeSize(e.ElementType);this.fields.set(a,{size:c,constructor:e,offset:this.stride,optional:b});this.stride+=
c;this.fieldNames.push(a)};a.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};a.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};a.prototype.createBuffer=function(a){return new h(this,a)};a.prototype.createView=function(a){return new h(this,a)};a.prototype.clone=function(){var d=new a;d.stride=this.stride;d.fields=new Map;this.fields.forEach(function(a,e){return d.fields.set(e,a)});d.fieldNames=this.fieldNames.slice();d.BufferType=this.BufferType;
return d};return a}();b.InterleavedLayout=a;b.newLayout=function(){return new a}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType=
"f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(a.BufferViewScalarImpl);b.BufferViewFloat=q;q=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(e.BufferViewVec2Impl);b.BufferViewVec2f=q;q=function(a){function c(c,
d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(d.BufferViewVec3Impl);b.BufferViewVec3f=q;q=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType=
"f32";return c}(k.BufferViewVec4Impl);b.BufferViewVec4f=q;q=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(f.BufferViewMat3Impl);b.BufferViewMat3f=q;f=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=
function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(f.BufferViewMat3Impl);b.BufferViewMat3f64=f;f=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float32Array,c,d,e,b)||this;c.elementType="f32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f32";return c}(h.BufferViewMat4Impl);b.BufferViewMat4f=f;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);
c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(h.BufferViewMat4Impl);b.BufferViewMat4f64=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(a.BufferViewScalarImpl);
b.BufferViewFloat64=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(e.BufferViewVec2Impl);b.BufferViewVec2f64=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,
a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(d.BufferViewVec3Impl);b.BufferViewVec3f64=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Float64Array,c,d,e,b)||this;c.elementType="f64";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="f64";return c}(k.BufferViewVec4Impl);b.BufferViewVec4f64=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,e,b)||
this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(a.BufferViewScalarImpl);b.BufferViewUint8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,e,b)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(e.BufferViewVec2Impl);b.BufferViewVec2u8=
h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,e,b)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u8";return c}(d.BufferViewVec3Impl);b.BufferViewVec3u8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint8Array,c,d,e,b)||this;c.elementType="u8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+
a.byteLength)};c.ElementType="u8";return c}(k.BufferViewVec4Impl);b.BufferViewVec4u8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,e,b)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(a.BufferViewScalarImpl);b.BufferViewUint16=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,e,b)||this;c.elementType="u16";return c}
l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(e.BufferViewVec2Impl);b.BufferViewVec2u16=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,e,b)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(d.BufferViewVec3Impl);b.BufferViewVec3u16=h;h=function(a){function c(c,
d,e,b){void 0===d&&(d=0);c=a.call(this,Uint16Array,c,d,e,b)||this;c.elementType="u16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u16";return c}(k.BufferViewVec4Impl);b.BufferViewVec4u16=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,e,b)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType=
"u32";return c}(a.BufferViewScalarImpl);b.BufferViewUint32=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,e,b)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(e.BufferViewVec2Impl);b.BufferViewVec2u32=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,e,b)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=
function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(d.BufferViewVec3Impl);b.BufferViewVec3u32=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Uint32Array,c,d,e,b)||this;c.elementType="u32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="u32";return c}(k.BufferViewVec4Impl);b.BufferViewVec4u32=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=
0);c=a.call(this,Int8Array,c,d,e,b)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(a.BufferViewScalarImpl);b.BufferViewInt8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,e,b)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(e.BufferViewVec2Impl);
b.BufferViewVec2i8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,e,b)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(d.BufferViewVec3Impl);b.BufferViewVec3i8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int8Array,c,d,e,b)||this;c.elementType="i8";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,
d,a.byteOffset+a.byteLength)};c.ElementType="i8";return c}(k.BufferViewVec4Impl);b.BufferViewVec4i8=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,e,b)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(a.BufferViewScalarImpl);b.BufferViewInt16=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,e,b)||this;c.elementType=
"i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(e.BufferViewVec2Impl);b.BufferViewVec2i16=h;h=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,e,b)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(d.BufferViewVec3Impl);b.BufferViewVec3i16=h;h=function(a){function c(c,
d,e,b){void 0===d&&(d=0);c=a.call(this,Int16Array,c,d,e,b)||this;c.elementType="i16";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i16";return c}(k.BufferViewVec4Impl);b.BufferViewVec4i16=h;a=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,e,b)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType=
"i32";return c}(a.BufferViewScalarImpl);b.BufferViewInt32=a;e=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,e,b)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(e.BufferViewVec2Impl);b.BufferViewVec2i32=e;d=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,e,b)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=
function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(d.BufferViewVec3Impl);b.BufferViewVec3i32=d;k=function(a){function c(c,d,e,b){void 0===d&&(d=0);c=a.call(this,Int32Array,c,d,e,b)||this;c.elementType="i32";return c}l(c,a);c.fromTypedArray=function(a,d){return new c(a.buffer,a.byteOffset,d,a.byteOffset+a.byteLength)};c.ElementType="i32";return c}(k.BufferViewVec4Impl);b.BufferViewVec4i32=k})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h,a,e,d){void 0===a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=9;b=this.TypedArrayConstructor;void 0===e&&(e=9*b.BYTES_PER_ELEMENT);var k=0===h.byteLength?0:a;this.typedBuffer=null==d?new b(h,k):new b(h,k,(d-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
b.prototype.getMat=function(b,h){b*=this.typedBufferStride;for(var a=0;9>a;a++)h[a]=this.typedBuffer[b+a];return h};b.prototype.setMat=function(b,h){b*=this.typedBufferStride;for(var a=0;9>a;a++)this.typedBuffer[b+a]=h[a]};b.prototype.get=function(b,h){return this.typedBuffer[b*this.typedBufferStride+h]};b.prototype.set=function(b,h,a){this.typedBuffer[b*this.typedBufferStride+h]=a};b.prototype.copyFrom=function(b,h,a){var e=this.typedBuffer,d=h.typedBuffer;b*=this.typedBufferStride;h=a*h.typedBufferStride;
for(a=0;9>a;++a)e[b+a]=d[h+a]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=9;return b}();b.BufferViewMat3Impl=q})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h,a,e,d){void 0===a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=16;b=this.TypedArrayConstructor;void 0===e&&
(e=16*b.BYTES_PER_ELEMENT);var k=0===h.byteLength?0:a;this.typedBuffer=null==d?new b(h,k):new b(h,k,(d-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=function(b,h){b*=this.typedBufferStride;for(var a=0;16>a;a++)h[a]=this.typedBuffer[b+a];return h};b.prototype.setMat=function(b,h){b*=this.typedBufferStride;for(var a=
0;16>a;a++)this.typedBuffer[b+a]=h[a]};b.prototype.get=function(b,h){return this.typedBuffer[b*this.typedBufferStride+h]};b.prototype.set=function(b,h,a){this.typedBuffer[b*this.typedBufferStride+h]=a};b.prototype.copyFrom=function(b,h,a){var e=this.typedBuffer,d=h.typedBuffer;b*=this.typedBufferStride;h=a*h.typedBufferStride;for(a=0;16>a;++a)e[b+a]=d[h+a]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=16;
return b}();b.BufferViewMat4Impl=q})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h,a,e,d){void 0===a&&(a=0);this.TypedArrayConstructor=b;this.elementCount=1;b=this.TypedArrayConstructor;void 0===e&&(e=b.BYTES_PER_ELEMENT);var k=0===h.byteLength?0:a;this.typedBuffer=null==d?new b(h,k):new b(h,k,(d-a)/b.BYTES_PER_ELEMENT);this.typedBufferStride=e/b.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.get=function(b){return this.typedBuffer[b*this.typedBufferStride]};b.prototype.set=function(b,h){this.typedBuffer[b*this.typedBufferStride]=h};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=1;return b}();b.BufferViewScalarImpl=q})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec2"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e,d,k){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=2;b=this.TypedArrayConstructor;void 0===d&&(d=2*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:e;this.typedBuffer=null==k?new b(a,f):new b(a,f,(k-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=d/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);
this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,a){return l.vec2.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1])};b.prototype.setVec=function(b,a){this.typedBuffer[b*this.typedBufferStride]=a[0];this.typedBuffer[b*this.typedBufferStride+1]=a[1]};b.prototype.get=function(b,a){return this.typedBuffer[b*this.typedBufferStride+a]};b.prototype.set=function(b,a,e){this.typedBuffer[b*this.typedBufferStride+
a]=e};b.prototype.copyFrom=function(b,a,e){var d=this.typedBuffer,k=a.typedBuffer;b*=this.typedBufferStride;a=e*a.typedBufferStride;d[b]=k[a];d[b+1]=k[a+1]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=2;return b}();b.BufferViewVec2Impl=q})},"esri/core/libs/gl-matrix-2/vec2":function(){define(["require","exports","./math/vec2"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2=l})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["require",
"exports","./common"],function(q,b,l){function f(a,d,e){a[0]=d[0]-e[0];a[1]=d[1]-e[1];return a}function h(a,d,e){a[0]=d[0]*e[0];a[1]=d[1]*e[1];return a}function a(a,d,e){a[0]=d[0]/e[0];a[1]=d[1]/e[1];return a}function e(a,d){var c=d[0]-a[0];a=d[1]-a[1];return Math.sqrt(c*c+a*a)}function d(a,d){var c=d[0]-a[0];a=d[1]-a[1];return c*c+a*a}function k(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)}function n(a){var c=a[0];a=a[1];return c*c+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,
d){a[0]=d[0];a[1]=d[1];return a};b.set=function(a,d,e){a[0]=d;a[1]=e;return a};b.add=function(a,d,e){a[0]=d[0]+e[0];a[1]=d[1]+e[1];return a};b.subtract=f;b.multiply=h;b.divide=a;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);return a};b.min=function(a,d,e){a[0]=Math.min(d[0],e[0]);a[1]=Math.min(d[1],e[1]);return a};b.max=function(a,d,e){a[0]=Math.max(d[0],e[0]);a[1]=Math.max(d[1],e[1]);return a};b.round=function(a,
d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);return a};b.scale=function(a,d,e){a[0]=d[0]*e;a[1]=d[1]*e;return a};b.scaleAndAdd=function(a,d,e,b){a[0]=d[0]+e[0]*b;a[1]=d[1]+e[1]*b;return a};b.distance=e;b.squaredDistance=d;b.length=k;b.squaredLength=n;b.negate=function(a,d){a[0]=-d[0];a[1]=-d[1];return a};b.inverse=function(a,d){a[0]=1/d[0];a[1]=1/d[1];return a};b.normalize=function(a,d){var c=d[0],g=d[1],c=c*c+g*g;0<c&&(c=1/Math.sqrt(c),a[0]=d[0]*c,a[1]=d[1]*c);return a};b.dot=function(a,d){return a[0]*
d[0]+a[1]*d[1]};b.cross=function(a,d,e){d=d[0]*e[1]-d[1]*e[0];a[0]=a[1]=0;a[2]=d;return a};b.lerp=function(a,d,e,b){var c=d[0];d=d[1];a[0]=c+b*(e[0]-c);a[1]=d+b*(e[1]-d);return a};b.random=function(a,d){d=d||1;var c=2*l.RANDOM()*Math.PI;a[0]=Math.cos(c)*d;a[1]=Math.sin(c)*d;return a};b.transformMat2=function(a,d,e){var c=d[0];d=d[1];a[0]=e[0]*c+e[2]*d;a[1]=e[1]*c+e[3]*d;return a};b.transformMat2d=function(a,d,e){var c=d[0];d=d[1];a[0]=e[0]*c+e[2]*d+e[4];a[1]=e[1]*c+e[3]*d+e[5];return a};b.transformMat3=
function(a,d,e){var c=d[0];d=d[1];a[0]=e[0]*c+e[3]*d+e[6];a[1]=e[1]*c+e[4]*d+e[7];return a};b.transformMat4=function(a,d,e){var c=d[0];d=d[1];a[0]=e[0]*c+e[4]*d+e[12];a[1]=e[1]*c+e[5]*d+e[13];return a};b.rotate=function(a,d,e,b){var c=d[0]-e[0];d=d[1]-e[1];var g=Math.sin(b);b=Math.cos(b);a[0]=c*b-d*g+e[0];a[1]=c*g+d*b+e[1];return a};b.angle=function(a,d){var c=a[0];a=a[1];var e=d[0];d=d[1];var g=c*c+a*a;0<g&&(g=1/Math.sqrt(g));var b=e*e+d*d;0<b&&(b=1/Math.sqrt(b));c=(c*e+a*d)*g*b;return 1<c?0:-1>
c?Math.PI:Math.acos(c)};b.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]};b.equals=function(a,d){var c=a[0];a=a[1];var e=d[0];d=d[1];return Math.abs(c-e)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(a-d)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))};b.len=k;b.sub=f;b.mul=h;b.div=a;b.dist=e;b.sqrDist=d;b.sqrLen=n})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],
function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e,d,k){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=3;b=this.TypedArrayConstructor;void 0===d&&(d=3*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:e;this.typedBuffer=null==k?new b(a,f):new b(a,f,(k-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=d/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
b.prototype.getVec=function(b,a){return l.vec3.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2])};b.prototype.setVec=function(b,a){this.typedBuffer[b*this.typedBufferStride]=a[0];this.typedBuffer[b*this.typedBufferStride+1]=a[1];this.typedBuffer[b*this.typedBufferStride+2]=a[2]};b.prototype.get=function(b,a){return this.typedBuffer[b*this.typedBufferStride+a]};b.prototype.set=function(b,a,e){this.typedBuffer[b*
this.typedBufferStride+a]=e};b.prototype.copyFrom=function(b,a,e){var d=this.typedBuffer,k=a.typedBuffer;b*=this.typedBufferStride;a=e*a.typedBufferStride;d[b]=k[a];d[b+1]=k[a+1];d[b+2]=k[a+2]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=3;return b}();b.BufferViewVec3Impl=q})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],
function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e,d,k){void 0===e&&(e=0);this.TypedArrayConstructor=b;this.elementCount=4;b=this.TypedArrayConstructor;void 0===d&&(d=4*b.BYTES_PER_ELEMENT);var f=0===a.byteLength?0:e;this.typedBuffer=null==k?new b(a,f):new b(a,f,(k-e)/b.BYTES_PER_ELEMENT);this.typedBufferStride=d/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
b.prototype.getVec=function(b,a){return l.vec4.set(a,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2],this.typedBuffer[b*this.typedBufferStride+3])};b.prototype.setVec=function(b,a){this.typedBuffer[b*this.typedBufferStride]=a[0];this.typedBuffer[b*this.typedBufferStride+1]=a[1];this.typedBuffer[b*this.typedBufferStride+2]=a[2];this.typedBuffer[b*this.typedBufferStride+3]=a[3]};b.prototype.get=function(b,a){return this.typedBuffer[b*
this.typedBufferStride+a]};b.prototype.set=function(b,a,e){this.typedBuffer[b*this.typedBufferStride+a]=e};b.prototype.copyFrom=function(b,a,e){var d=this.typedBuffer,k=a.typedBuffer;b*=this.typedBufferStride;a=e*a.typedBufferStride;d[b]=k[a];d[b+1]=k[a+1];d[b+2]=k[a+2];d[b+3]=k[a+3]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=4;return b}();b.BufferViewVec4Impl=q})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require",
"exports","./math/vec4"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4=l})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(q,b,l){function f(a,d,e){a[0]=d[0]-e[0];a[1]=d[1]-e[1];a[2]=d[2]-e[2];a[3]=d[3]-e[3];return a}function h(a,d,e){a[0]=d[0]*e[0];a[1]=d[1]*e[1];a[2]=d[2]*e[2];a[3]=d[3]*e[3];return a}function a(a,d,e){a[0]=d[0]/e[0];a[1]=d[1]/e[1];a[2]=d[2]/e[2];a[3]=d[3]/e[3];return a}function e(a,d){var c=d[0]-a[0],
e=d[1]-a[1],g=d[2]-a[2];a=d[3]-a[3];return Math.sqrt(c*c+e*e+g*g+a*a)}function d(a,d){var c=d[0]-a[0],e=d[1]-a[1],g=d[2]-a[2];a=d[3]-a[3];return c*c+e*e+g*g+a*a}function k(a){var c=a[0],d=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+d*d+e*e+a*a)}function n(a){var c=a[0],d=a[1],e=a[2];a=a[3];return c*c+d*d+e*e+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];return a};b.set=function(a,d,e,b,k){a[0]=d;a[1]=e;a[2]=b;a[3]=k;return a};b.add=function(a,
d,e){a[0]=d[0]+e[0];a[1]=d[1]+e[1];a[2]=d[2]+e[2];a[3]=d[3]+e[3];return a};b.subtract=f;b.multiply=h;b.divide=a;b.ceil=function(a,d){a[0]=Math.ceil(d[0]);a[1]=Math.ceil(d[1]);a[2]=Math.ceil(d[2]);a[3]=Math.ceil(d[3]);return a};b.floor=function(a,d){a[0]=Math.floor(d[0]);a[1]=Math.floor(d[1]);a[2]=Math.floor(d[2]);a[3]=Math.floor(d[3]);return a};b.min=function(a,d,e){a[0]=Math.min(d[0],e[0]);a[1]=Math.min(d[1],e[1]);a[2]=Math.min(d[2],e[2]);a[3]=Math.min(d[3],e[3]);return a};b.max=function(a,d,e){a[0]=
Math.max(d[0],e[0]);a[1]=Math.max(d[1],e[1]);a[2]=Math.max(d[2],e[2]);a[3]=Math.max(d[3],e[3]);return a};b.round=function(a,d){a[0]=Math.round(d[0]);a[1]=Math.round(d[1]);a[2]=Math.round(d[2]);a[3]=Math.round(d[3]);return a};b.scale=function(a,d,e){a[0]=d[0]*e;a[1]=d[1]*e;a[2]=d[2]*e;a[3]=d[3]*e;return a};b.scaleAndAdd=function(a,d,e,b){a[0]=d[0]+e[0]*b;a[1]=d[1]+e[1]*b;a[2]=d[2]+e[2]*b;a[3]=d[3]+e[3]*b;return a};b.distance=e;b.squaredDistance=d;b.length=k;b.squaredLength=n;b.negate=function(a,d){a[0]=
-d[0];a[1]=-d[1];a[2]=-d[2];a[3]=-d[3];return a};b.inverse=function(a,d){a[0]=1/d[0];a[1]=1/d[1];a[2]=1/d[2];a[3]=1/d[3];return a};b.normalize=function(a,d){var c=d[0],e=d[1],g=d[2];d=d[3];var b=c*c+e*e+g*g+d*d;0<b&&(b=1/Math.sqrt(b),a[0]=c*b,a[1]=e*b,a[2]=g*b,a[3]=d*b);return a};b.dot=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]*d[3]};b.lerp=function(a,d,e,b){var c=d[0],g=d[1],k=d[2];d=d[3];a[0]=c+b*(e[0]-c);a[1]=g+b*(e[1]-g);a[2]=k+b*(e[2]-k);a[3]=d+b*(e[3]-d);return a};b.random=function(a,
d){d=d||1;var c,e,g,b,k,f;do c=2*l.RANDOM()-1,e=2*l.RANDOM()-1,k=c*c+e*e;while(1<=k);do g=2*l.RANDOM()-1,b=2*l.RANDOM()-1,f=g*g+b*b;while(1<=f);k=Math.sqrt((1-k)/f);a[0]=d*c;a[1]=d*e;a[2]=d*g*k;a[3]=d*b*k;return a};b.transformMat4=function(a,d,e){var c=d[0],b=d[1],g=d[2];d=d[3];a[0]=e[0]*c+e[4]*b+e[8]*g+e[12]*d;a[1]=e[1]*c+e[5]*b+e[9]*g+e[13]*d;a[2]=e[2]*c+e[6]*b+e[10]*g+e[14]*d;a[3]=e[3]*c+e[7]*b+e[11]*g+e[15]*d;return a};b.transformQuat=function(a,d,e){var c=d[0],b=d[1],g=d[2],k=e[0],f=e[1],h=e[2];
e=e[3];var m=e*c+f*g-h*b,w=e*b+h*c-k*g,n=e*g+k*b-f*c,c=-k*c-f*b-h*g;a[0]=m*e+c*-k+w*-h-n*-f;a[1]=w*e+c*-f+n*-k-m*-h;a[2]=n*e+c*-h+m*-f-w*-k;a[3]=d[3];return a};b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]};b.equals=function(a,d){var c=a[0],e=a[1],b=a[2];a=a[3];var g=d[0],k=d[1],f=d[2];d=d[3];return Math.abs(c-g)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(e-k)<=l.EPSILON*Math.max(1,
Math.abs(e),Math.abs(k))&&Math.abs(b-f)<=l.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))&&Math.abs(a-d)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))};b.sub=f;b.mul=h;b.div=a;b.dist=e;b.sqrDist=d;b.len=k;b.sqrLen=n})},"esri/views/3d/support/buffer/types":function(){define(["require","exports","../../../../core/compilerUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:l.neverReached(b)}};b.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:l.neverReached(b)}};b.isInteger=function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:l.neverReached(b)}};b.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;
case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:l.neverReached(b)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),function(q,b,l,f,h,a,e,
d,k){var n=e.Vec3Compact,c;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],e=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],b=[0,0,1,0,1,1,0,1],g=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36),h=0;6>h;h++)for(var p=0;6>p;p++)f[6*h+p]=h;for(var n=Array(36),h=0;6>h;h++)n[6*h+0]=0,n[6*h+1]=1,n[6*h+2]=2,n[6*h+3]=2,n[6*h+4]=3,n[6*h+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);
for(var m=new Float32Array(24),h=0;8>h;h++)m[3*h]=c[h][0]*a[0],m[3*h+1]=c[h][1]*a[1],m[3*h+2]=c[h][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=new Uint32Array(g);a[k.VertexAttrConstants.NORMAL]=new Uint32Array(f);a[k.VertexAttrConstants.UV0]=new Uint32Array(n);h={};h[k.VertexAttrConstants.POSITION]={size:3,data:m};h[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(e)};h[k.VertexAttrConstants.UV0]={size:2,data:new Float32Array(b)};return new d.GeometryData(h,a)}})(c||(c={}));var g;(function(a){var c=
[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],e=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],g=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(18),f=0;6>f;f++)m[3*f]=c[f][0]*a[0],m[3*f+1]=c[f][1]*a[1],m[3*f+2]=c[f][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=new Uint32Array(b);a[k.VertexAttrConstants.NORMAL]=new Uint32Array(g);
f={};f[k.VertexAttrConstants.POSITION]={size:3,data:m};f[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(e)};return new d.GeometryData(f,a)}})(g||(g={}));var r;(function(a){var c=f.vec3f32.fromValues(-.5,0,-.5),e=f.vec3f32.fromValues(.5,0,-.5),b=f.vec3f32.fromValues(0,0,.5),g=f.vec3f32.fromValues(0,.5,0),h=f.vec3f32.create(),p=f.vec3f32.create(),n=f.vec3f32.create(),v=f.vec3f32.create(),r=f.vec3f32.create();l.vec3.subtract(h,c,g);l.vec3.subtract(p,c,e);l.vec3.cross(n,h,p);l.vec3.normalize(n,
n);l.vec3.subtract(h,e,g);l.vec3.subtract(p,e,b);l.vec3.cross(v,h,p);l.vec3.normalize(v,v);l.vec3.subtract(h,b,g);l.vec3.subtract(p,b,c);l.vec3.cross(r,h,p);l.vec3.normalize(r,r);var t=[c,e,b,g],x=[0,-1,0,n[0],n[1],n[2],v[0],v[1],v[2],r[0],r[1],r[2]],u=[0,1,2,3,1,0,3,2,1,3,0,2],L=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),e=0;4>e;e++)c[3*e]=t[e][0]*a[0],c[3*e+1]=t[e][1]*a[1],c[3*e+2]=t[e][2]*a[2];a={};a[k.VertexAttrConstants.POSITION]=
new Uint32Array(u);a[k.VertexAttrConstants.NORMAL]=new Uint32Array(L);e={};e[k.VertexAttrConstants.POSITION]={size:3,data:c};e[k.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(x)};return new d.GeometryData(e,a)}})(r||(r={}));var p;(function(b){function p(a,c,d,e,b){if(Math.abs(l.vec3.dot(c,a))>b)return!1;l.vec3.cross(d,a,c);l.vec3.normalize(d,d);l.vec3.cross(e,d,a);l.vec3.normalize(e,e);return!0}function m(a,c,d,e,b,g,m){return p(a,c,b,g,m)||p(a,d,b,g,m)||p(a,e,b,g,m)}b.createBoxGeometry=
c.createGeometry;b.createDiamondGeometry=g.createGeometry;b.createTetrahedronGeometry=r.createGeometry;b.createSphereGeometry=function(a,c,e,b,g,m,f){a=a||50;b=void 0!==b?b:-Math.PI;g=void 0!==g?g:2*Math.PI;m=void 0!==m?m:.5*-Math.PI;f=void 0!==f?f:Math.PI;var h=Math.max(3,Math.floor(c)||8),p=Math.max(2,Math.floor(e)||6),w=(h+1)*(p+1);e=new Float32Array(3*w);c=new Float32Array(3*w);for(var w=new Float32Array(2*w),n=[],r=0,v=0;v<=p;v++){for(var t=[],A=v/p,x=m+A*f,y=Math.cos(x),u=0;u<=h;u++){var B=
u/h,l=b+B*g,C=Math.cos(l)*y,E=Math.sin(x),l=-Math.sin(l)*y;e[3*r]=C*a;e[3*r+1]=E*a;e[3*r+2]=l*a;c[3*r]=C;c[3*r+1]=E;c[3*r+2]=l;w[2*r]=B;w[2*r+1]=A;t.push(r);++r}n.push(t)}a=new Uint32Array(2*h*(p-1)*3);for(v=r=0;v<p;v++)for(u=0;u<h;u++)b=n[v][u],g=n[v][u+1],m=n[v+1][u+1],f=n[v+1][u],0===v?(a[r++]=b,a[r++]=m,a[r++]=f):v===p-1?(a[r++]=b,a[r++]=g,a[r++]=m):(a[r++]=b,a[r++]=g,a[r++]=m,a[r++]=m,a[r++]=f,a[r++]=b);k.assert(r===a.length);h={};h[k.VertexAttrConstants.POSITION]=a;h[k.VertexAttrConstants.NORMAL]=
a;h[k.VertexAttrConstants.UV0]=a;p={};p[k.VertexAttrConstants.POSITION]={size:3,data:e};p[k.VertexAttrConstants.NORMAL]={size:3,data:c};p[k.VertexAttrConstants.UV0]={size:2,data:w};return new d.GeometryData(p,h)};b.createPolySphereGeometry=function(a,c,e){function b(c,d){c>d&&(d=[d,c],c=d[0],d=d[1]);var e=c.toString()+"."+d.toString();if(f[e])return f[e];var b=g.length;g.length+=3;n.add(g,3*c,g,3*d,g,b);n.scale(g,b,a/n.length(g,b));b/=3;return f[e]=b}var g;e?(g=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,
1,0],e=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(e=a*(1+Math.sqrt(5))/2,g=[-a,e,0,a,e,0,-a,-e,0,a,-e,0,0,-a,e,0,a,e,0,-a,-e,0,a,-e,e,0,-a,e,0,a,-e,0,-a,-e,0,a],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var m=0;m<g.length;m+=3)n.scale(g,m,a/n.length(g,m));for(var f={},m=0;m<c;m++){for(var h=e.length,p=new Uint32Array(4*h),w=0;w<h;w+=3){var r=e[w],v=e[w+1],t=e[w+
2],A=b(r,v),x=b(v,t),y=b(t,r),u=4*w;p[u]=r;p[u+1]=A;p[u+2]=y;p[u+3]=v;p[u+4]=x;p[u+5]=A;p[u+6]=t;p[u+7]=y;p[u+8]=x;p[u+9]=A;p[u+10]=x;p[u+11]=y}e=p;f={}}c=new Float32Array(g);for(m=0;m<c.length;m+=3)n.normalize(c,m);m={};m[k.VertexAttrConstants.POSITION]=e;m[k.VertexAttrConstants.NORMAL]=e;e={};e[k.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(g)};e[k.VertexAttrConstants.NORMAL]={size:3,data:c};return new d.GeometryData(e,m)};b.createPointGeometry=function(a,c,e,b,g,m,f,h){c=c?new Float64Array([c[0],
c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);m=m?new Float32Array(m):new Float32Array([0,0]);e=e?new Uint8Array([255*e[0],255*e[1],255*e[2],3<e.length?255*e[3]:255]):new Uint8Array([255,255,255,255]);var p=null!=b&&2===b.length?new Float32Array(b):new Float32Array([1,1]);b={};b[k.VertexAttrConstants.POSITION]={size:3,data:c};b[k.VertexAttrConstants.NORMAL]={size:3,data:a};b[k.VertexAttrConstants.UV0]={size:m.length,data:m};b[k.VertexAttrConstants.COLOR]=
{size:4,data:e};b[k.VertexAttrConstants.SIZE]={size:2,data:p};null!=g&&(g=new Float32Array([g[0],g[1],g[2],g[3]]),b[k.VertexAttrConstants.AUXPOS1]={size:4,data:g});null!=f&&(f=new Float32Array([f[0],f[1],f[2],f[3]]),b[k.VertexAttrConstants.AUXPOS2]={size:4,data:f});return null!=h?(d.GeometryData.call(h,b,d.GeometryData.DefaultIndices,d.GeometryData.DefaultOffsets,"point"),h):new d.GeometryData(b,d.GeometryData.DefaultIndices,d.GeometryData.DefaultOffsets,"point")};b.updatePointGeometry=function(a,
c,d,e,b,g,m,f){var h=f.vertexAttributes;if(null!=a){var p=h[k.VertexAttrConstants.NORMAL].data;p[0]=a[0];p[1]=a[1];p[2]=a[2]}null!=c&&(p=h[k.VertexAttrConstants.POSITION].data,p[0]=c[0],p[1]=c[1],p[2]=c[2]);null!=d&&(p=h[k.VertexAttrConstants.COLOR].data,p[0]=d[0],p[1]=d[1],p[2]=d[2],p[3]=d[3]);null!=e&&(p=h[k.VertexAttrConstants.SIZE].data,p[0]=e[0],p[1]=e[1]);null!=b&&(p=h[k.VertexAttrConstants.AUXPOS1].data,p[0]=b[0],p[1]=b[1],p[2]=b[2],p[3]=b[3]);null!=g&&(p=h[k.VertexAttrConstants.UV0].data,
p[0]=g[0],p[1]=g[1]);null!=m&&(p=h[k.VertexAttrConstants.AUXPOS2].data,p[0]=m[0],p[1]=m[1],p[2]=m[2],p[3]=m[3]);return f};b.createPointArrayGeometry=function(a,c){for(var e=new Float32Array(3*a.length),b=new Float32Array(c?3*a.length:3),g=new Uint32Array(a.length),m=new Uint32Array(a.length),f=0;f<a.length;f++)e[3*f]=a[f][0],e[3*f+1]=a[f][1],e[3*f+2]=a[f][2],c&&(b[3*f]=c[f][0],b[3*f+1]=c[f][1],b[3*f+2]=c[f][2]),g[f]=f,m[f]=0;c||(b[0]=0,b[1]=1,b[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;f={};f[k.VertexAttrConstants.POSITION]=
g;f[k.VertexAttrConstants.NORMAL]=c?g:m;f[k.VertexAttrConstants.UV0]=m;c={};c[k.VertexAttrConstants.POSITION]={size:3,data:e};c[k.VertexAttrConstants.NORMAL]={size:3,data:b};c[k.VertexAttrConstants.UV0]={size:2,data:a};return new d.GeometryData(c,f,d.GeometryData.DefaultOffsets,"point")};b.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),e=new Float32Array([0,1,0]),b=new Uint32Array([0,0,0]),g=new Float32Array([0,0]),m=new Uint32Array([0,
0,0]),f={};f[k.VertexAttrConstants.POSITION]=c;f[k.VertexAttrConstants.NORMAL]=b;f[k.VertexAttrConstants.UV0]=m;c={};c[k.VertexAttrConstants.POSITION]={size:3,data:a};c[k.VertexAttrConstants.NORMAL]={size:3,data:e};c[k.VertexAttrConstants.UV0]={size:2,data:g};return new d.GeometryData(c,f)};b.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var e=0;4>e;e++)for(var b=0;3>b;b++)c[3*e+b]=a[e][b];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=
1,c[11]=0;var g=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var m=new Uint32Array([0,0,0,0,0,0]),e=new Float32Array([0,0,1,0,1,1,0,1]),b=new Uint8Array([255,255,255,255]),f={};f[k.VertexAttrConstants.POSITION]=g;f[k.VertexAttrConstants.NORMAL]=m;f[k.VertexAttrConstants.UV0]=g;f[k.VertexAttrConstants.COLOR]=m;g={};g[k.VertexAttrConstants.POSITION]={size:3,data:c};g[k.VertexAttrConstants.NORMAL]={size:3,data:a};g[k.VertexAttrConstants.UV0]={size:2,data:e};g[k.VertexAttrConstants.COLOR]=
{size:4,data:b};return new d.GeometryData(g,f)};b.createConeGeometry=function(a,c,e,b,g,m){void 0===g&&(g=!0);void 0===m&&(m=!0);var h=0,p=f.vec3f32.fromValues(0,h,0),w=f.vec3f32.fromValues(0,h+a,0),n=f.vec3f32.fromValues(0,-1,0),r=f.vec3f32.fromValues(0,1,0);b&&(h=a,w=f.vec3f32.fromValues(0,0,0),p=f.vec3f32.fromValues(0,h,0),n=f.vec3f32.fromValues(0,1,0),r=f.vec3f32.fromValues(0,-1,0));p=[w,p];n=[n,r];r=e+2;w=Math.sqrt(a*a+c*c);if(b)for(b=e-1;0<=b;b--)v=2*Math.PI/e*b,t=f.vec3f32.fromValues(Math.cos(v)*
c,h,Math.sin(v)*c),p.push(t),v=f.vec3f32.fromValues(a*Math.cos(v)/w,-c/w,a*Math.sin(v)/w),n.push(v);else for(b=0;b<e;b++){var v=2*Math.PI/e*b,t=f.vec3f32.fromValues(Math.cos(v)*c,h,Math.sin(v)*c);p.push(t);v=f.vec3f32.fromValues(a*Math.cos(v)/w,c/w,a*Math.sin(v)/w);n.push(v)}a=new Uint32Array(6*(e+2));e=new Uint32Array(6*(e+2));h=c=0;if(g){for(b=3;b<p.length;b++)a[c++]=1,a[c++]=b-1,a[c++]=b,e[h++]=0,e[h++]=0,e[h++]=0;a[c++]=p.length-1;a[c++]=2;a[c++]=1;e[h++]=0;e[h++]=0;e[h++]=0}if(m){for(b=3;b<p.length;b++)a[c++]=
b,a[c++]=b-1,a[c++]=0,e[h++]=b,e[h++]=b-1,e[h++]=1;a[c++]=0;a[c++]=2;a[c++]=p.length-1;e[h++]=1;e[h++]=2;e[h++]=n.length-1}g=new Float32Array(3*r);for(b=0;b<r;b++)g[3*b]=p[b][0],g[3*b+1]=p[b][1],g[3*b+2]=p[b][2];m=new Float32Array(3*r);for(b=0;b<r;b++)m[3*b]=n[b][0],m[3*b+1]=n[b][1],m[3*b+2]=n[b][2];p={};p[k.VertexAttrConstants.POSITION]=a;p[k.VertexAttrConstants.NORMAL]=e;n={};n[k.VertexAttrConstants.POSITION]={size:3,data:g};n[k.VertexAttrConstants.NORMAL]={size:3,data:m};return new d.GeometryData(n,
p)};b.createCylinderGeometry=function(a,c,e,b,g,m){b=b?f.vec3f32.clone(b):f.vec3f32.fromValues(1,0,0);g=g?f.vec3f32.clone(g):f.vec3f32.fromValues(0,0,0);m=void 0===m?!0:m;var h=f.vec3f32.create();l.vec3.normalize(h,b);b=f.vec3f32.create();l.vec3.scale(b,h,Math.abs(a));var p=f.vec3f32.create();l.vec3.scale(p,b,-.5);l.vec3.add(p,p,g);var n=f.vec3f32.fromValues(0,1,0);.2>Math.abs(1-l.vec3.dot(h,n))&&l.vec3.set(n,0,0,1);var w=f.vec3f32.create();l.vec3.cross(w,h,n);l.vec3.normalize(w,w);l.vec3.cross(n,
w,h);var r=2*e+(m?2:0),v=e+(m?2:0);a=new Float32Array(3*r);g=new Float32Array(3*v);var t=new Float32Array(2*r),x=new Uint32Array(3*e*(m?4:2)),A=new Uint32Array(3*e*(m?4:2));m&&(a[3*(r-2)+0]=p[0],a[3*(r-2)+1]=p[1],a[3*(r-2)+2]=p[2],t[2*(r-2)]=0,t[2*(r-2)+1]=0,a[3*(r-1)+0]=a[3*(r-2)+0]+b[0],a[3*(r-1)+1]=a[3*(r-2)+1]+b[1],a[3*(r-1)+2]=a[3*(r-2)+2]+b[2],t[2*(r-1)]=1,t[2*(r-1)+1]=1,g[3*(v-2)+0]=-h[0],g[3*(v-2)+1]=-h[1],g[3*(v-2)+2]=-h[2],g[3*(v-1)+0]=h[0],g[3*(v-1)+1]=h[1],g[3*(v-1)+2]=h[2]);for(var h=
function(a,c,d){x[a]=c;A[a]=d},u=0,y=f.vec3f32.create(),B=f.vec3f32.create(),C=0;C<e;C++){var E=2*Math.PI/e*C;l.vec3.scale(y,n,Math.sin(E));l.vec3.scale(B,w,Math.cos(E));l.vec3.add(y,y,B);g[3*C+0]=y[0];g[3*C+1]=y[1];g[3*C+2]=y[2];l.vec3.scale(y,y,c);l.vec3.add(y,y,p);a[3*C+0]=y[0];a[3*C+1]=y[1];a[3*C+2]=y[2];t[2*C+0]=C/e;t[2*C+1]=0;a[3*(C+e)+0]=a[3*C+0]+b[0];a[3*(C+e)+1]=a[3*C+1]+b[1];a[3*(C+e)+2]=a[3*C+2]+b[2];t[2*(C+e)+0]=C/e;t[2*C+1]=1;E=(C+1)%e;h(u++,C,C);h(u++,C+e,C);h(u++,E,E);h(u++,E,E);h(u++,
C+e,C);h(u++,E+e,E)}if(m){for(C=0;C<e;C++)E=(C+1)%e,h(u++,r-2,v-2),h(u++,C,v-2),h(u++,E,v-2);for(C=0;C<e;C++)E=(C+1)%e,h(u++,C+e,v-1),h(u++,r-1,v-1),h(u++,E+e,v-1)}c={};c[k.VertexAttrConstants.POSITION]=x;c[k.VertexAttrConstants.NORMAL]=A;c[k.VertexAttrConstants.UV0]=x;e={};e[k.VertexAttrConstants.POSITION]={size:3,data:a};e[k.VertexAttrConstants.NORMAL]={size:3,data:g};e[k.VertexAttrConstants.UV0]={size:2,data:t};return new d.GeometryData(e,c)};b.createTubeGeometry=function(a,c,d,e,g){d=d||10;e=
null!=e?e:!0;k.assert(1<a.length);for(var m=[],f=[],h=0;h<d;h++){m.push([0,-h-1,-((h+1)%d)-1]);var p=h/d*2*Math.PI;f.push([Math.cos(p)*c,Math.sin(p)*c])}return b.createPathExtrusionGeometry(f,a,[[0,0,0]],m,e,g)};b.createPathExtrusionGeometry=function(c,e,b,g,p,n){void 0===n&&(n=f.vec3f32.fromValues(0,0,0));var w=c.length,r=new Float32Array(e.length*w*3+(6*b.length||0)),v=new Float32Array(e.length*w+(2*b.length||0)),t=new Float32Array(e.length*w*3+(b?6:0)),x=(e.length-1)*w*6+6*g.length,y=new Uint32Array(x),
x=new Uint32Array(x),A=0,B=0,C=0,E=0,G=0,q=f.vec3f32.create(),N=f.vec3f32.create(),Z=f.vec3f32.create(),W=f.vec3f32.create(),aa=f.vec3f32.create(),V=f.vec3f32.create(),F=f.vec3f32.create(),ca=h.vec3f64.create(),U=f.vec3f32.create(),ea=f.vec3f32.create(),ha=f.vec3f32.create(),ka=f.vec3f32.create(),ba=f.vec3f32.create(),qa=a.plane.create();l.vec3.set(U,0,1,0);l.vec3.subtract(N,e[1],e[0]);l.vec3.normalize(N,N);p?(l.vec3.add(ca,e[0],n),l.vec3.normalize(Z,ca)):l.vec3.set(Z,0,0,1);m(N,Z,U,U,aa,Z,u);l.vec3.copy(W,
Z);l.vec3.copy(ka,aa);for(var ja=0;ja<b.length;ja++)l.vec3.scale(V,aa,b[ja][0]),l.vec3.scale(ca,Z,b[ja][2]),l.vec3.add(V,V,ca),l.vec3.add(V,V,e[0]),r[A++]=V[0],r[A++]=V[1],r[A++]=V[2],v[C++]=0;t[B++]=-N[0];t[B++]=-N[1];t[B++]=-N[2];for(ja=0;ja<g.length;ja++)y[E++]=0<g[ja][0]?g[ja][0]:-g[ja][0]-1+b.length,y[E++]=0<g[ja][1]?g[ja][1]:-g[ja][1]-1+b.length,y[E++]=0<g[ja][2]?g[ja][2]:-g[ja][2]-1+b.length,x[G++]=0,x[G++]=0,x[G++]=0;for(var la=b.length,ja=b.length-1,ma=0;ma<e.length;ma++){var ta=!1;0<ma&&
(l.vec3.copy(q,N),ma<e.length-1?(l.vec3.subtract(N,e[ma+1],e[ma]),l.vec3.normalize(N,N)):ta=!0,l.vec3.add(ea,q,N),l.vec3.normalize(ea,ea),l.vec3.add(ha,e[ma-1],W),a.plane.fromPositionAndNormal(e[ma],ea,qa),a.plane.intersectRay(qa,a.ray.wrap(ha,q),ca)?(l.vec3.subtract(ca,ca,e[ma]),l.vec3.normalize(Z,ca),l.vec3.cross(aa,ea,Z),l.vec3.normalize(aa,aa)):m(ea,W,ka,U,aa,Z,u),l.vec3.copy(W,Z),l.vec3.copy(ka,aa));p&&(l.vec3.add(ca,e[ma],n),l.vec3.normalize(ba,ca));for(var ua=0;ua<w;ua++)if(l.vec3.scale(V,
aa,c[ua][0]),l.vec3.scale(ca,Z,c[ua][1]),l.vec3.add(V,V,ca),l.vec3.normalize(F,V),t[B++]=F[0],t[B++]=F[1],t[B++]=F[2],p?v[C++]=l.vec3.dot(V,ba):v[C++]=V[2],l.vec3.add(V,V,e[ma]),r[A++]=V[0],r[A++]=V[1],r[A++]=V[2],!ta){var sa=(ua+1)%w;y[E++]=la+ua;y[E++]=la+w+ua;y[E++]=la+sa;y[E++]=la+sa;y[E++]=la+w+ua;y[E++]=la+w+sa;for(sa=0;6>sa;sa++)x[G++]=y[E-6+sa]-ja}la+=w}c=e[e.length-1];for(ja=0;ja<b.length;ja++)l.vec3.scale(V,aa,b[ja][0]),l.vec3.scale(ca,Z,b[ja][1]),l.vec3.add(V,V,ca),l.vec3.add(V,V,c),r[A++]=
V[0],r[A++]=V[1],r[A++]=V[2],v[C++]=0;b=B/3;t[B++]=N[0];t[B++]=N[1];t[B++]=N[2];w=la-w;for(ja=0;ja<g.length;ja++)y[E++]=0<=g[ja][0]?la+g[ja][0]:-g[ja][0]-1+w,y[E++]=0<=g[ja][2]?la+g[ja][2]:-g[ja][2]-1+w,y[E++]=0<=g[ja][1]?la+g[ja][1]:-g[ja][1]-1+w,x[G++]=b,x[G++]=b,x[G++]=b;g={};g[k.VertexAttrConstants.POSITION]=y;g[k.VertexAttrConstants.NORMAL]=x;y={};y[k.VertexAttrConstants.POSITION]={size:3,data:r};y.zOffset={size:1,data:v};y[k.VertexAttrConstants.NORMAL]={size:3,data:t};return new d.GeometryData(y,
g)};b.createPolylineGeometry=function(a,c){k.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");k.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");k.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");k.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var e=new Float32Array(3*a.length),b=new Uint32Array(2*(a.length-1)),g=0,m=0,f=0;f<a.length;f++){for(var h=0;3>
h;h++)e[g++]=a[f][h];0<f&&(b[m++]=f-1,b[m++]=f)}g={};m={};g[k.VertexAttrConstants.POSITION]=b;m[k.VertexAttrConstants.POSITION]={size:3,data:e};if(c){for(var e=new Float32Array(3*c.length),p=0,f=0;f<a.length;f++)for(h=0;3>h;h++)e[p++]=c[f][h];g[k.VertexAttrConstants.NORMAL]=b;m[k.VertexAttrConstants.NORMAL]={size:3,data:e}}return new d.GeometryData(m,g,d.GeometryData.DefaultOffsets,"line")};b.createExtrudedTriangle=function(a,c,e,b){var g,m,f=new Float32Array(18);a=[[-c,0,b/2],[e,0,b/2],[0,a,b/2],
[-c,0,-b/2],[e,0,-b/2],[0,a,-b/2]];for(c=0;6>c;c++)f[3*c]=a[c][0],f[3*c+1]=a[c][1],f[3*c+2]=a[c][2];a=(g={},g[k.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),g);g=(m={},m[k.VertexAttrConstants.POSITION]={size:3,data:f},m);return new d.GeometryData(g,a)};b.transformInPlace=function(a,c){a=a.vertexAttributes[k.VertexAttrConstants.POSITION].data;for(var d=0;d<a.length;d+=3)l.vec3.set(t,a[d],a[d+1],a[d+2]),l.vec3.transformMat4(t,t,c),a[d]=t[0],a[d+1]=
t[1],a[d+2]=t[2]};b.addVertexColors=function(a,c){var e=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*e[0];c[1]=255*e[1];c[2]=255*e[2];c[3]=255*(3<e.length?e[3]:1);var e={},b=a.getVertexAttr(),g;for(g in b)e[g]=b[g];e[k.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(g in a.indices)c[g]=a.indices[g];c[k.VertexAttrConstants.COLOR]=new Uint32Array(c[k.VertexAttrConstants.POSITION].length);return a=new d.GeometryData(e,c,a.componentOffsets,a.primitiveType)};b.addNormals=function(a){var c=a.getVertexAttr();
a=a.indices;for(var d=e.Vec3Compact.subtract,b=new Float32Array(a.position.length/3*3),g=c.position.data,m=0,f=a.position,h=new Uint32Array(f.length),p=0;p<f.length;p+=3){d(g,3*f[p],g,3*f[p+2],x,0);d(g,3*f[p],g,3*f[p+1],t,0);l.vec3.cross(t,t,x);l.vec3.normalize(t,t);var n=m/3;b[m++]=t[0];b[m++]=t[1];b[m++]=t[2];h[p]=n;h[p+1]=n;h[p+2]=n}c[k.VertexAttrConstants.NORMAL]={size:3,data:b,offsetIdx:0,strideIdx:3};a[k.VertexAttrConstants.NORMAL]=h};b.cgToGIS=function(a,c){void 0===c&&(c=a);var d=a.getVertexAttr();
a=d.position.data;var d=d.normal.data,e=c.getVertexAttr(),b=e.position.data,e=e.normal.data;if(d)for(var g=0;g<d.length;g+=3){var m=d[g+1];e[g+1]=-d[g+2];e[g+2]=m}if(a)for(g=0;g<a.length;g+=3)m=a[g+1],b[g+1]=-a[g+2],b[g+2]=m;return c};b.makeOrthoBasisDirUp=p;b.makeOrthoBasisDirUpFallback=m})(p||(p={}));var u=.99619469809,t=f.vec3f32.create(),x=f.vec3f32.create();return p})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require","exports","./factories/vec3f32"],function(q,b,l){Object.defineProperty(b,
"__esModule",{value:!0});b.vec3f32=l})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(q,b){function l(){return new Float32Array(3)}function f(a,d,c){var e=new Float32Array(3);e[0]=a;e[1]=d;e[2]=c;return e}function h(){return f(1,1,1)}function a(){return f(1,0,0)}function e(){return f(0,1,0)}function d(){return f(0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var d=new Float32Array(3);d[0]=a[0];d[1]=a[1];d[2]=
a[2];return d};b.fromValues=f;b.createView=function(a,d){return new Float32Array(a,d,3)};b.zeros=function(){return l()};b.ones=h;b.unitX=a;b.unitY=e;b.unitZ=d;b.ZEROS=l();b.ONES=h();b.UNIT_X=a();b.UNIT_Y=e();b.UNIT_Z=d()})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});b.plane=e;b.boundedPlane=f;b.triangle=n;b.lineSegment=a;b.ray=d;b.sphere=k;b.frustum=h;b.vector=c;b.axisAngle=l})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(q,b,l,f,h){function a(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function e(d,e,b,c,g){void 0===g&&(g=a());g[0]=d;g[1]=e;g[2]=b;g[3]=c;return g}
Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.wrap=function(a,b,h,c){return e(a,b,h,c,f.sv4d.get())};b.wrapAxisAngle=function(a,b){return e(a[0],a[1],a[2],b,f.sv4d.get())};b.copy=function(d,b){void 0===b&&(b=a());return e(d[0],d[1],d[2],d[3],b)};b.fromValues=e;b.fromAxisAndAngle=function(d,e,b){void 0===b&&(b=a());l.vec3.copy(b,d);b[3]=e;return b};b.fromPoints=function(d,e,b){void 0===b&&(b=a());l.vec3.cross(b,d,e);l.vec3.normalize(b,b);b[3]=h.angle(d,e);return b};b.UP=[0,0,1,0]})},
"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.sv2d=l.VectorStack.createVec2f64();b.sv3d=l.VectorStack.createVec3f64();b.sv4d=l.VectorStack.createVec4f64();b.sm3d=l.VectorStack.createMat3f64();b.sm4d=l.VectorStack.createMat4f64();b.sq4d=l.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function c(a,c,d){var e=this;this.itemByteSize=a;this.itemCreate=c;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(d/this.itemByteSize);this.tickHandle=l.before(function(){return e.reset()})}c.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};c.prototype.get=function(){0===
this.itemsPtr&&l(function(){});for(var a=Math.floor(this.itemsPtr/this.itemsPerBuffer);this.buffers.length<=a;){for(var c=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),d=0;d<this.itemsPerBuffer;++d)this.items.push(this.itemCreate(c,d*this.itemByteSize));this.buffers.push(c)}return this.items[this.itemsPtr++]};c.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;
this.itemsPtr=0};c.createVec2f64=function(a){void 0===a&&(a=n);return new c(16,e.vec2f64.createView,a)};c.createVec3f64=function(a){void 0===a&&(a=n);return new c(24,d.vec3f64.createView,a)};c.createVec4f64=function(a){void 0===a&&(a=n);return new c(32,k.vec4f64.createView,a)};c.createMat3f64=function(a){void 0===a&&(a=n);return new c(72,f.mat3f64.createView,a)};c.createMat4f64=function(a){void 0===a&&(a=n);return new c(128,h.mat4f64.createView,a)};c.createQuatf64=function(d){void 0===d&&(d=n);return new c(32,
a.quatf64.createView,d)};Object.defineProperty(c.prototype,"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return c}();b.VectorStack=q;var n=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f64=l})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(q,
b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,0,1,0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]};b.fromValues=function(b,f,h,a,e,d,k,n,c){return[b,f,h,a,e,d,k,n,c]};b.createView=function(b,f){return new Float64Array(b,f,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quatf64=l})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,f,h,a){return[b,f,h,a]};b.createView=function(b,f){return new Float64Array(b,f,4)}})},"esri/core/libs/gl-matrix-2/vec2f64":function(){define(["require","exports","./factories/vec2f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f64=l})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0]};b.clone=function(b){return[b[0],b[1]]};b.fromValues=function(b,f){return[b,f]};b.fromArray=function(b){for(var f=[0,0],h=Math.min(2,b.length),a=0;a<h;++a)f[a]=b[a];return f};b.createView=function(b,f){return new Float64Array(b,f,2)};b.zeros=function(){return[0,0]};b.ones=function(){return[1,1]};b.unitX=function(){return[1,0]};b.unitY=function(){return[0,1]};b.ZEROS=[0,0];b.ONES=[1,1];b.UNIT_X=
[1,0];b.UNIT_Y=[0,1]})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(q,b,l,f){function h(a,e){return f.vec3.dot(a,e)/f.vec3.length(a)}Object.defineProperty(b,"__esModule",{value:!0});b.projectPoint=function(a,e,d){e=h(a,e);return f.vec3.scale(d,a,e)};b.projectPointSignedLength=h;b.angle=function(a,e){a=f.vec3.dot(a,e)/(f.vec3.length(a)*f.vec3.length(e));return-l.acosClamped(a)}})},
"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a){void 0===a&&(a=
b.UP);return{plane:p.create(a.plane),origin:n.vec3f64.clone(a.origin),basis1:n.vec3f64.clone(a.basis1),basis2:n.vec3f64.clone(a.basis2)}}function v(a,c){void 0===c&&(c=x());return y(a.origin,a.basis1,a.basis2,c)}function y(a,c,d,e){void 0===e&&(e=x());k.vec3.copy(e.origin,a);k.vec3.copy(e.basis1,c);k.vec3.copy(e.basis2,d);p.fromVectorsAndPoint(d,c,a,e.plane);a=e;1E-6<Math.abs(k.vec3.dot(a.basis1,a.basis2)/(k.vec3.length(a.basis1)*k.vec3.length(a.basis2)))&&P.warn("fromValues()","Provided basis vectors are not perpendicular");
1E-6<Math.abs(k.vec3.dot(a.basis1,a.plane))&&P.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-k.vec3.dot(a.plane,a.origin)-a.plane[3])&&P.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function m(a,c,d){a!==d&&v(a,d);a=k.vec3.scale(g.sv3d.get(),a.plane,c);k.vec3.add(d.origin,d.origin,a);d.plane[3]-=c;return d}function w(a,c){void 0===c&&(c=x());var d=(a[2]-a[0])/2,e=(a[3]-a[1])/2;k.vec3.set(c.origin,a[0]+d,a[1]+e,0);k.vec3.set(c.basis1,
d,0,0);k.vec3.set(c.basis2,0,e,0);p.fromValues(0,0,1,0,c.plane);return c}function A(a,c,d){return p.intersectRay(a.plane,c,d)?I(a,d):!1}function B(a,d,e){var b=S.get(),m=S.get();L(a,d,b,m);for(var m=Number.POSITIVE_INFINITY,f=0,n=T;f<n.length;f++){var w=H(a,n[f],R.get()),r=g.sv3d.get();p.intersectLineSegment(b,w,r)&&(w=c.directionFromTo(g.sv3d.get(),d.origin,r),w=Math.abs(h.acosClamped(k.vec3.dot(d.direction,w))),w<m&&(m=w,k.vec3.copy(e,r)))}return m===Number.POSITIVE_INFINITY?C(a,d,e):e}function C(a,
c,d){if(A(a,c,d))return d;var e=S.get(),b=S.get();L(a,c,e,b);for(var m=Number.POSITIVE_INFINITY,f=0,h=T;f<h.length;f++){var n=H(a,h[f],R.get()),w=g.sv3d.get();p.intersectLineSegmentClamp(e,n,w)&&(n=u.distance2(c,w),p.isPointInside(b,w)&&n<m&&(m=n,k.vec3.copy(d,w)))}G(a,c.origin)<m&&k.vec3.copy(d,c.origin);return d}function E(a,c,d){var e=a.origin,b=a.basis1,m=a.basis2;c=k.vec3.subtract(g.sv3d.get(),c,e);b=t.projectPointSignedLength(b,c)/k.vec3.length(b);m=t.projectPointSignedLength(m,c)/k.vec3.length(m);
a=t.projectPointSignedLength(a.plane,c);return k.vec3.set(d,b,m,a)}function G(a,c){c=E(a,c,g.sv3d.get());var d=a.basis2;a=k.vec3.length(a.basis1);d=k.vec3.length(d);a=Math.max(Math.abs(c[0])-a,0);d=Math.max(Math.abs(c[1])-d,0);c=c[2];return a*a+d*d+c*c}function J(a,c){var d=-a.plane[3];return t.projectPointSignedLength(a.plane,c)-d}function I(a,c){var d=k.vec3.subtract(g.sv3d.get(),c,a.origin);c=k.vec3.squaredLength(a.basis1);var e=k.vec3.squaredLength(a.basis2),b=k.vec3.dot(a.basis1,d);a=k.vec3.dot(a.basis2,
d);return 0>-b-c&&0>b-c&&0>-a-e&&0>a-e}function K(a,c){var d=R.get();k.vec3.copy(d.origin,a.origin);k.vec3.copy(d.vector,c);return d}function H(a,c,d){var e=a.basis1,b=a.basis2;a=a.origin;var m=k.vec3.scale(g.sv3d.get(),e,c.origin[0]),f=k.vec3.scale(g.sv3d.get(),b,c.origin[1]);k.vec3.add(d.origin,m,f);k.vec3.add(d.origin,d.origin,a);e=k.vec3.scale(g.sv3d.get(),e,c.direction[0]);c=k.vec3.scale(g.sv3d.get(),b,c.direction[1]);k.vec3.scale(d.vector,k.vec3.add(e,e,c),2);return d}function L(a,c,d,e){a=
a.plane;p.fromVectorsAndPoint(a,c.direction,c.origin,d);p.fromVectorsAndPoint(d,a,c.origin,e)}Object.defineProperty(b,"__esModule",{value:!0});var P=f.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");q=function(){return function(){this.plane=p.create();this.origin=n.vec3f64.create();this.basis1=n.vec3f64.create();this.basis2=n.vec3f64.create()}}();b.BoundedPlaneClass=q;b.create=x;b.wrap=function(a,c,d){var e=Q.get();e.origin=a;e.basis1=c;e.basis2=d;e.plane=p.fromVectorsAndPoint(d,c,a,
p.wrap(0,0,0,0));return e};b.copy=v;b.fromValues=y;b.elevate=m;b.setExtent=function(a,c,d){w(c,d);m(d,J(a,a.origin),d);return d};b.fromAABoundingRect=w;b.intersectRay=A;b.intersectRayClosestSilhouette=function(a,c,d){if(A(a,c,d))return d;a=B(a,c,g.sv3d.get());k.vec3.add(d,c.origin,k.vec3.scale(g.sv3d.get(),c.direction,k.vec3.distance(c.origin,a)/k.vec3.length(c.direction)));return d};b.closestPointOnSilhouette=B;b.closestPoint=C;b.projectPoint=function(a,c,d){var e=p.projectPoint(a.plane,c,g.sv3d.get());
c=r.projectPointClamp(K(a,a.basis1),e,-1,1,g.sv3d.get());e=r.projectPointClamp(K(a,a.basis2),e,-1,1,g.sv3d.get());k.vec3.subtract(d,k.vec3.add(g.sv3d.get(),c,e),a.origin);return d};b.projectPointLocal=E;b.distance2=G;b.distance=function(a,c){return Math.sqrt(G(a,c))};b.distanceToSilhouette=function(a,c){for(var d=Number.NEGATIVE_INFINITY,e=0,b=T;e<b.length;e++){var g=H(a,b[e],R.get()),g=r.distance2(g,c);g>d&&(d=g)}return Math.sqrt(d)};b.extrusionContainsPoint=function(a,c){return p.isPointInside(a.plane,
c)&&I(a,c)};b.axisAt=function(a,c,d,e){switch(d){case 0:k.vec3.copy(e,a.basis1);k.vec3.normalize(e,e);break;case 1:k.vec3.copy(e,a.basis2);k.vec3.normalize(e,e);break;case 2:k.vec3.copy(e,a.plane);break;default:l.neverReached(d)}return e};b.altitudeAt=J;b.setAltitudeAt=function(a,c,d,e){var b=J(a,c);a=k.vec3.scale(O,a.plane,d-b);k.vec3.add(e,c,a);return e};b.transform=function(a,c,d){a!==d&&v(a,d);e.mat4.invert(Y,c);e.mat4.transpose(Y,Y);k.vec3.transformMat4(d.basis1,a.basis1,Y);k.vec3.transformMat4(d.basis2,
a.basis2,Y);k.vec3.transformMat4(d.plane,a.plane,Y);k.vec3.transformMat4(d.origin,a.origin,c);p.setOffsetFromPoint(d.plane,d.origin,d.plane);return d};b.UP={plane:p.create(),origin:n.vec3f64.fromValues(0,0,0),basis1:n.vec3f64.fromValues(1,0,0),basis2:n.vec3f64.fromValues(0,1,0)};var S=new a.ObjectStack(p.create),R=new a.ObjectStack(r.create),O=n.vec3f64.create(),Q=new a.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),T=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],
direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Y=d.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){var e=this;this.allocator=a;this.items=[];this.itemsPtr=0;this.tickHandle=l.before(function(){return e.reset()});this.grow()}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=
null};b.prototype.get=function(){0===this.itemsPtr&&l(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};b.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*f),this.items.length);this.itemsPtr=0};b.prototype.grow=function(){for(var a=0;a<Math.max(8,Math.min(this.items.length,f));a++)this.items.push(this.allocator())};return b}();b.ObjectStack=q;var f=1024;b.default=q})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(q,b,l,f,h,a,e){function d(c){return c?{origin:a.vec3f64.clone(c.origin),vector:a.vec3f64.clone(c.vector)}:{origin:a.vec3f64.create(),vector:a.vec3f64.create()}}function k(a,c){var d=u.get();d.origin=a;d.vector=c;return d}function n(a,c,e){void 0===e&&(e=d());h.vec3.copy(e.origin,a);h.vec3.copy(e.vector,c);return e}function c(a,c){c=h.vec3.subtract(e.sv3d.get(),c,a.origin);var d=h.vec3.dot(a.vector,c),b=h.vec3.dot(a.vector,a.vector),d=l.clamp(d/b,0,1);a=h.vec3.subtract(e.sv3d.get(),h.vec3.scale(e.sv3d.get(),
a.vector,d),c);return h.vec3.dot(a,a)}function g(a,c,d,b,g){var m=a.vector,k=a.origin;c=h.vec3.subtract(e.sv3d.get(),c,k);k=h.vec3.length(m);c=h.vec3.dot(m,c)/k;h.vec3.scale(g,m,l.clamp(c,d,b));return h.vec3.add(g,g,a.origin)}function r(a,c,d,b){var g=a.origin,k=h.vec3.add(e.sv3d.get(),g,a.vector);a=c.origin;var f=h.vec3.add(e.sv3d.get(),a,c.vector),p=e.sv3d.get();c=e.sv3d.get();p[0]=g[0]-a[0];p[1]=g[1]-a[1];p[2]=g[2]-a[2];c[0]=f[0]-a[0];c[1]=f[1]-a[1];c[2]=f[2]-a[2];if(1E-6>Math.abs(c[0])&&1E-6>
Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;f=e.sv3d.get();f[0]=k[0]-g[0];f[1]=k[1]-g[1];f[2]=k[2]-g[2];if(1E-6>Math.abs(f[0])&&1E-6>Math.abs(f[1])&&1E-6>Math.abs(f[2]))return!1;var k=p[0]*c[0]+p[1]*c[1]+p[2]*c[2],n=c[0]*f[0]+c[1]*f[1]+c[2]*f[2],r=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],v=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*r-n*n;if(1E-6>Math.abs(v))return!1;p=(k*n-(p[0]*f[0]+p[1]*f[1]+p[2]*f[2])*r)/v;k=(k+n*p)/r;d&&(p=l.clamp(p,0,1),k=l.clamp(k,0,1));d=e.sv3d.get();n=e.sv3d.get();d[0]=g[0]+p*f[0];d[1]=g[1]+p*
f[1];d[2]=g[2]+p*f[2];n[0]=a[0]+k*c[0];n[1]=a[1]+k*c[1];n[2]=a[2]+k*c[2];b.tA=p;b.tB=k;b.pA=d;b.pB=n;b.distance2=h.vec3.squaredDistance(d,n);return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=d;b.wrap=k;b.copy=function(a,c){void 0===c&&(c=d());return n(a.origin,a.vector,c)};b.fromValues=n;b.fromPoints=function(a,c,e){void 0===e&&(e=d());h.vec3.copy(e.origin,a);h.vec3.subtract(e.vector,c,a);return e};b.distance2=c;b.distance=function(a,d){return Math.sqrt(c(a,d))};b.projectPoint=function(a,
c,d){return g(a,c,0,1,d)};b.projectPointClamp=g;b.closestRayDistance2=function(a,c){if(r(a,k(c.origin,c.direction),!1,p)){c=p.tA;var d=p.pB,b=p.distance2;if(0<=c&&1>=c)return b;if(0>c)return h.vec3.squaredDistance(a.origin,d);if(1<c)return h.vec3.squaredDistance(h.vec3.add(e.sv3d.get(),a.origin,a.vector),d)}return null};b.closestLineSegmentPoint=function(a,c,d){return r(a,c,!0,p)?(h.vec3.copy(d,p.pA),!0):!1};b.closestLineSegmentDistance2=function(a,c){return r(a,c,!0,p)?p.distance2:null};var p={tA:0,
tB:0,pA:a.vec3f64.create(),pB:a.vec3f64.create(),distance2:0},u=new f.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../stack"],function(q,b,l,f,h){function a(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function e(c,e){void 0===e&&(e=a());return d(c[0],c[1],c[2],c[3],e)}function d(c,d,e,b,g){void 0===g&&(g=a());g[0]=c;g[1]=d;
g[2]=e;g[3]=b;return g}function k(c,d,e){void 0===e&&(e=a());f.vec3.copy(e,d);d=f.vec3.dot(d,d);1E-5<Math.abs(d-1)&&1E-12<d&&f.vec3.scale(e,e,1/Math.sqrt(d));n(e,c,e);return e}function n(a,c,d){a!==d&&e(a,d);d[3]=-f.vec3.dot(d,c);return d}function c(c,d,e,b){void 0===b&&(b=a());c=f.vec3.cross(h.sv3d.get(),d,c);return k(e,c,b)}function g(a,c,d){a=f.vec3.scale(h.sv3d.get(),a,f.vec3.dot(a,c));f.vec3.subtract(d,c,a);return d}function r(a,c){return f.vec3.dot(a,c)+a[3]}function p(a,c,d,e,b,g){var m=f.vec3.dot(a,
d);if(0===m)return!1;a=-(f.vec3.dot(a,c)+a[3])/m;b&&(a=e?Math.max(0,a):l.clamp(a,0,1));if(0>a||!e&&1<a)return!1;f.vec3.add(g,c,f.vec3.scale(g,d,a));return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=a;b.wrap=function(a,c,e,b){return d(a,c,e,b,h.sv4d.get())};b.copy=e;b.fromValues=d;b.fromNormalAndOffset=function(c,d,e){void 0===e&&(e=a());f.vec3.copy(e,c);e[3]=d;return e};b.fromPositionAndNormal=k;b.fromPoints=function(d,e,b,g){void 0===g&&(g=a());return c(f.vec3.subtract(h.sv3d.get(),
d,e),f.vec3.subtract(h.sv3d.get(),b,e),d,g)};b.setOffsetFromPoint=n;b.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};b.fromVectorsAndPoint=c;b.intersectRay=function(a,c,d){return p(a,c.origin,c.direction,!0,!1,d)};b.intersectLineSegment=function(a,c,d){return p(a,c.origin,c.vector,!1,!1,d)};b.intersectLineSegmentClamp=function(a,c,d){return p(a,c.origin,c.vector,!1,!0,d)};b.isSphereFullyInside=function(a,c){var d=c.radius;return 0<=r(a,c.center)-d};b.isSphereFullyOutside=
function(a,c){var d=c.radius;return 0>r(a,c.center)+d};b.isPointInside=function(a,c){return 0<=r(a,c)};b.isPointOutside=function(a,c){return 0>r(a,c)};b.isAABBFullyInside=function(a,c){var d=c[0],e=c[1],b=c[2],g=c[3],k=c[4];c=c[5];return 0<=a[0]*(0<a[0]?d:g)+a[1]*(0<a[1]?e:k)+a[2]*(0<a[2]?b:c)+a[3]};b.clip=function(a,c){var d=f.vec3.dot(a,c.ray.direction);a=-r(a,c.ray.origin);if(0>a&&0<=d)return!1;if(-1E-6<d&&1E-6>d)return 0<a;if((0>a||0>d)&&!(0>a&&0>d))return!0;a/=d;0<d?a<c.c1&&(c.c1=a):a>c.c0&&
(c.c0=a);return c.c0<=c.c1};b.projectPoint=function(a,c,d){var e=f.vec3.scale(h.sv3d.get(),a,-a[3]);c=f.vec3.subtract(h.sv3d.get(),c,e);a=g(a,c,h.sv3d.get());f.vec3.add(d,a,e);return d};b.projectVector=g;b.distance=function(a,c){return Math.abs(r(a,c))};b.signedDistance=r;b.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),
function(q,b,l,f,h,a,e,d){function k(a){return a?{origin:e.vec3f64.clone(a.origin),direction:e.vec3f64.clone(a.direction)}:{origin:e.vec3f64.create(),direction:e.vec3f64.create()}}function n(c,d,e){void 0===e&&(e=k());a.vec3.copy(e.origin,c);a.vec3.copy(e.direction,d);return e}function c(c,e,b){void 0===b&&(b=k());var g=f.castRenderScreenPointArray3(h.vec2.copy(d.sv3d.get(),e));g[2]=0;c.unprojectPoint(g,b.origin);e=f.castRenderScreenPointArray3(h.vec2.copy(d.sv3d.get(),e));e[2]=1;c=c.unprojectPoint(e,
d.sv3d.get());a.vec3.subtract(b.direction,c,b.origin);return b}function g(c,e,b){void 0===b&&(b=k());a.vec3.copy(b.origin,c.eye);e=a.vec3.set(d.sv3d.get(),e[0],e[1],1);c=c.unprojectPoint(e,d.sv3d.get());a.vec3.subtract(b.direction,c,b.origin);return b}function r(c,e){c=a.vec3.cross(d.sv3d.get(),a.vec3.normalize(d.sv3d.get(),c.direction),a.vec3.subtract(d.sv3d.get(),e,c.origin));return a.vec3.dot(c,c)}function p(){return{origin:null,direction:null}}Object.defineProperty(b,"__esModule",{value:!0});
b.create=k;b.wrap=function(a,c){var d=u.get();d.origin=a;d.direction=c;return d};b.copy=function(a,c){void 0===c&&(c=k());return n(a.origin,a.direction,c)};b.fromPoints=function(c,d,e){void 0===e&&(e=k());a.vec3.copy(e.origin,c);a.vec3.subtract(e.direction,d,c);return e};b.fromValues=n;b.fromScreen=function(a,e,b){void 0===b&&(b=k());return c(a,a.screenToRender(e,f.castRenderScreenPointArray3(d.sv3d.get())),b)};b.fromRender=c;b.fromScreenAtEye=function(a,c,e){void 0===e&&(e=k());return g(a,a.screenToRender(c,
f.castRenderScreenPointArray3(d.sv3d.get())),e)};b.fromRenderAtEye=g;b.distance2=r;b.distance=function(a,c){return Math.sqrt(r(a,c))};b.closestPoint=function(c,d,e){d=a.vec3.dot(c.direction,a.vec3.subtract(e,d,c.origin));a.vec3.add(e,c.origin,a.vec3.scale(e,c.direction,d));return e};b.createWrapper=p;var u=new l.ObjectStack(p)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){function g(d){if(d){var e=d.planes;d=d.points;return{planes:[c.create(e[0]),c.create(e[1]),c.create(e[2]),c.create(e[3]),c.create(e[4]),c.create(e[5])],points:[a.vec3f64.clone(d[0]),a.vec3f64.clone(d[1]),a.vec3f64.clone(d[2]),a.vec3f64.clone(d[3]),a.vec3f64.clone(d[4]),a.vec3f64.clone(d[5]),a.vec3f64.clone(d[6]),a.vec3f64.clone(d[7])]}}return{planes:[c.create(),c.create(),c.create(),c.create(),c.create(),c.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),
a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function r(a,d,e){void 0===e&&(e=g());for(var b=0;6>b;b++)c.copy(a[b],e.planes[b]);for(b=0;8>b;b++)h.vec3.copy(e.points[b],d[b]);return e}function p(a){var d=a.planes;a=a.points;c.fromPoints(a[4],a[0],a[3],d[0]);c.fromPoints(a[1],a[5],a[6],d[1]);c.fromPoints(a[4],a[5],a[1],d[2]);c.fromPoints(a[3],a[2],a[6],d[3]);c.fromPoints(a[0],a[1],a[2],d[4]);c.fromPoints(a[5],a[4],a[7],d[5])}function u(a,d){for(var e=
0;6>e;e++)if(!c.clip(a[e],d))return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=g;b.copy=function(a,c){void 0===c&&(c=g());return r(a.planes,a.points,c)};b.fromValues=r;b.fromMatrix=function(a,c,d){void 0===d&&(d=g());var b=d.points;a=f.mat4.multiply(k.sm4d.get(),c,a);f.mat4.invert(a,a);for(c=0;8>c;++c){var m=e.vec4.transformMat4(k.sv4d.get(),t[c],a);h.vec3.set(b[c],m[0]/m[3],m[1]/m[3],m[2]/m[3])}p(d);return d};b.recomputePlanes=p;b.intersectsSphere=function(a,d){for(var e=
0;6>e;e++)if(c.isSphereFullyInside(a[e],d))return!1;return!0};b.intersectsRay=function(a,c){return u(a,n.fromRay(c,x.get()))};b.intersectsLineSegment=function(a,c,d){return u(a,n.fromLineSegmentAndDirection(c,d,x.get()))};b.intersectsPoint=function(a,d){for(var e=0;6>e;e++)if(0<c.signedDistance(a[e],d))return!1;return!0};b.intersectsAABB=function(a,d){for(var e=0;6>e;e++)if(c.isAABBFullyInside(a[e],d))return!1;return!0};b.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,
6,2],left:[4,0,3,7],top:[7,3,2,6]};var t=[d.vec4f64.fromValues(-1,-1,-1,1),d.vec4f64.fromValues(1,-1,-1,1),d.vec4f64.fromValues(1,1,-1,1),d.vec4f64.fromValues(-1,1,-1,1),d.vec4f64.fromValues(-1,-1,1,1),d.vec4f64.fromValues(1,-1,1,1),d.vec4f64.fromValues(1,1,1,1),d.vec4f64.fromValues(-1,1,1,1)],x=new l.ObjectStack(n.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),
function(q,b,l,f,h,a){function e(c){return c?{ray:a.create(c.ray),c0:c.c0,c1:c.c1}:{ray:a.create(),c0:0,c1:Number.MAX_VALUE}}function d(c,d,b,k){void 0===k&&(k=e());a.copy(c,k.ray);k.c0=d;k.c1=b;return k}function k(c,d,b){void 0===b&&(b=e());var g=f.vec3.length(c.vector);a.fromValues(c.origin,d,b.ray);b.c0=0;b.c1=g;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=e;b.wrap=function(a,d,e){var c=n.get();c.ray=a;c.c0=d;c.c1=e;return c};b.copy=function(a,b){void 0===b&&(b=e());return d(a.ray,
a.c0,a.c1,b)};b.fromValues=d;b.fromRay=function(c,d){void 0===d&&(d=e());a.copy(c,d.ray);d.c0=0;d.c1=Number.MAX_VALUE;return d};b.fromLineSegment=function(a,d){void 0===d&&(d=e());var c=f.vec3.normalize(h.sv3d.get(),a.vector);return k(a,c,d)};b.fromLineSegmentAndDirection=k;var n=new l.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){function p(a){return a?{radius:a.radius,center:k.vec3f64.clone(a.center)}:{radius:1,center:k.vec3f64.create()}}function u(a,c){void 0===c&&(c=p());return t(a.radius,a.center,c)}function t(a,c,e){void 0===e&&(e=p());d.vec3.copy(e.center,c);e.radius=a;return e}function x(a,c,e){var b=d.vec3.subtract(g.sv3d.get(),c.origin,a.center),m=d.vec3.dot(c.direction,c.direction),k=2*d.vec3.dot(c.direction,b);a=d.vec3.dot(b,b)-a.radius*a.radius;a=k*k-4*m*a;if(0>a)return!1;b=
Math.sqrt(a);a=(-k-b)/(2*m);m=(-k+b)/(2*m);if(0>a||m<a&&0<m)a=m;if(0>a)return!1;e&&d.vec3.add(e,c.origin,d.vec3.scale(g.sv3d.get(),c.direction,a));return!0}function v(a,c,b){var k=g.sv3d.get(),f=g.sm4d.get();d.vec3.cross(k,c.origin,c.direction);d.vec3.cross(b,k,c.origin);d.vec3.scale(b,b,1/d.vec3.length(b)*a.radius);a=m(a,c.origin);c=n.vector.angle(c.origin,b);e.mat4.identity(f);e.mat4.rotate(f,f,c+a,k);d.vec3.transformMat4(b,b,f);return b}function y(a,c,e){c=d.vec3.subtract(g.sv3d.get(),c,a.center);
c=d.vec3.scale(g.sv3d.get(),c,a.radius/d.vec3.length(c));return d.vec3.add(e,c,a.center)}function m(a,c){c=d.vec3.subtract(g.sv3d.get(),c,a.center);c=d.vec3.length(c);return h.acosClamped(a.radius/(a.radius+Math.abs(a.radius-c)))}function w(a,e,b,g){a=d.vec3.subtract(C,e,a.center);switch(b){case 0:return a=c.cartesianToSpherical(a,C),a=a[2],d.vec3.set(g,-Math.sin(a),Math.cos(a),0);case 1:return a=c.cartesianToSpherical(a,C),b=a[1],a=a[2],e=Math.sin(b),d.vec3.set(g,-e*Math.cos(a),-e*Math.sin(a),Math.cos(b));
case 2:return d.vec3.normalize(g,a);default:l.neverReached(b)}}function A(a,c){c=d.vec3.subtract(I,c,a.center);return d.vec3.length(c)-a.radius}Object.defineProperty(b,"__esModule",{value:!0});var B=f.getLogger("esri.views.3d.support.geometryUtils.sphere");b.create=p;b.wrap=function(a,c){var d=E.get();d.radius=a;d.center=c||J;return d};b.copy=u;b.fromValues=t;b.elevate=function(a,c,e){a!==e&&d.vec3.copy(e.center,a.center);e.radius=a.radius+c;return e};b.setExtent=function(a,c,d){B.error("sphere.setExtent is not yet supported");
return a===d?d:u(a,d)};b.intersectRay=x;b.intersectScreen=function(a,c,d,e){c=r.fromScreenAtEye(c,d,G);return x(a,c,e)};b.intersectsRay=function(a,c){return x(a,c,null)};b.intersectRayClosestSilhouette=function(a,c,e){if(x(a,c,e))return e;a=v(a,c,g.sv3d.get());d.vec3.add(e,c.origin,d.vec3.scale(g.sv3d.get(),c.direction,d.vec3.distance(c.origin,a)/d.vec3.length(c.direction)));return e};b.closestPointOnSilhouette=v;b.closestPoint=function(a,c,d){if(x(a,c,d))return d;r.closestPoint(c,a.center,d);return y(a,
d,d)};b.projectPoint=y;b.distanceToSilhouette=function(a,c){c=d.vec3.subtract(g.sv3d.get(),c,a.center);c=d.vec3.squaredLength(c);return Math.sqrt(Math.abs(c-a.radius*a.radius))};b.angleToSilhouette=m;var C=k.vec3f64.create();b.axisAt=w;b.altitudeAt=A;b.setAltitudeAt=function(a,c,e,b){var g=A(a,c);a=w(a,c,2,I);e=d.vec3.scale(I,a,e-g);d.vec3.add(b,c,e);return b};var E=new a.ObjectStack(function(){return{center:null,radius:0}}),G=r.create(),J=k.vec3f64.create(),I=k.vec3f64.create();Object.freeze(J)})},
"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),function(q,b,l,f,h,a,e,d){function k(c){return c?{p0:a.vec3f64.clone(c.p0),p1:a.vec3f64.clone(c.p1),p2:a.vec3f64.clone(c.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function n(a,c,d,e){void 0===e&&(e=k());h.vec3.copy(e.p0,
a);h.vec3.copy(e.p1,c);h.vec3.copy(e.p2,d);return e}function c(a,c,d){var e=f.vec2.distance(a,c);c=f.vec2.distance(c,d);a=f.vec2.distance(d,a);d=(e+c+a)/2;e=d*(d-e)*(d-c)*(d-a);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(b,"__esModule",{value:!0});b.create=k;b.wrap=function(a,c,d){var e=r.get();e.p0=a;e.p1=c;e.p2=d;return e};b.copy=function(a,c){void 0===c&&(c=k());return n(a.p0,a.p1,a.p2,c)};b.fromValues=n;b.distance2=function(a,c){var b=a.p0,k=a.p1;a=a.p2;var m=h.vec3.subtract(e.sv3d.get(),
k,b),f=h.vec3.subtract(e.sv3d.get(),a,k),p=h.vec3.subtract(e.sv3d.get(),b,a),n=h.vec3.subtract(e.sv3d.get(),c,b),r=h.vec3.subtract(e.sv3d.get(),c,k),t=h.vec3.subtract(e.sv3d.get(),c,a),u=h.vec3.cross(m,m,p),x=h.vec3.dot(h.vec3.cross(e.sv3d.get(),m,u),n),r=h.vec3.dot(h.vec3.cross(e.sv3d.get(),f,u),r),t=h.vec3.dot(h.vec3.cross(e.sv3d.get(),p,u),t);if(0<x&&0<r&&0<t)return c=h.vec3.dot(u,n),c*c/h.vec3.dot(u,u);b=d.distance2(d.fromValues(b,m,g.get()),c);k=d.distance2(d.fromValues(k,f,g.get()),c);c=d.distance2(d.fromValues(a,
p,g.get()),c);return Math.min(b,k,c)};b.intersectRay=function(a,c,d){var e=c.direction;c=c.origin;var b=a.p0,g=a.p1,k=a.p2,f=g[0]-b[0],p=g[1]-b[1],n=g[2]-b[2],g=k[0]-b[0];a=k[1]-b[1];var k=k[2]-b[2],r=e[1]*k-a*e[2],v=e[2]*g-k*e[0],t=e[0]*a-g*e[1],u=f*r+p*v+n*t;if(-1E-5<u&&1E-5>u)return!1;var u=1/u,x=c[0]-b[0],l=c[1]-b[1],b=c[2]-b[2],r=u*(x*r+l*v+b*t);if(0>r||1<r)return!1;v=l*n-p*b;n=b*f-n*x;f=x*p-f*l;p=u*(e[0]*v+e[1]*n+e[2]*f);if(0>p||1<r+p)return!1;d&&(h.vec3.scale(d,e,u*(g*v+a*n+k*f)),h.vec3.add(d,
c,d));return!0};b.areaPoints2d=c;b.area2d=function(a){return c(a.p0,a.p1,a.p2)};b.areaPoints3d=function(a,c,d){h.vec3.subtract(p,c,a);h.vec3.subtract(u,d,a);return h.vec3.length(h.vec3.cross(p,p,u))/2};var g=new l.ObjectStack(d.create),r=new l.ObjectStack(function(){return{p0:null,p1:null,p2:null}}),p=a.vec3f64.create(),u=a.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(q,b,l,f,h){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function a(e,d,b,n){void 0===d&&(d=a.DefaultIndices);void 0===b&&(b=a.DefaultOffsets);void 0===n&&(n="triangle");this.preinterleaved=!1;var c={},g;for(g in e){var k=e[g],p=k.size;c[g]={data:k.data,size:p,offsetIdx:0,strideIdx:p}}if(d===a.DefaultIndices){d=h.getFirstObjectValue(c);d=null==d?0:d.data.length/d.size;e=f.generateDefaultIndexArray(d);d={};for(var u in c)d[u]=e}this._id=f.getNewId();this._vertexAttributes=c;this._indices=d;this._componentOffsets=l.createOffsets(b);
this._primitiveType=n}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"indexCount",{get:function(){var a=h.getFirstObjectValue(this._indices);return null==a?0:a.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});a.prototype.getVertexAttr=function(){return this.vertexAttributes};a.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};a.prototype.getIndices=
function(a){return this._indices[a]};a.prototype.getAttribute=function(a){return this._vertexAttributes[a]};a.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices[h.VertexAttrConstants.POSITION]&&(a+=12*this._indices[h.VertexAttrConstants.POSITION].length);this._indices[h.VertexAttrConstants.NORMAL]&&(a+=12*this._indices[h.VertexAttrConstants.NORMAL].length);this._indices[h.VertexAttrConstants.UV0]&&(a+=8*this._indices[h.VertexAttrConstants.UV0].length);this._indices[h.VertexAttrConstants.COLOR]&&
(a+=4*this._indices[h.VertexAttrConstants.COLOR].length);return a};a.DefaultIndices={};a.DefaultOffsets=new Uint32Array(0);return a}();b.GeometryData=q})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/maybe"],function(q,b,l,f){function h(a,c){if(null!=a){var d=a.isVisibleBit,e=a.data,b=8*e.BYTES_PER_ELEMENT;return c<e.length*b?p(d,e,c,b):!a.isVisibleBit}return!0}function a(a){return f.isSome(a.component)?a.component:
-1}function e(a,c,e,b,g){h(c,b)&&d(a,e[b],e[b+1]-1,g)}function d(a,c,d,e){var b=0<a.length?a[a.length-1]:null,g=b?b.range[1]:-1,m=b?b.options:null;g>=c||(g+1===c&&m===e?b.range[1]=d:a.push({range:[c,d],options:e}))}function k(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function n(a,c){return g(a,c,!0)}function c(a,c){return g(a,c,!1)}function g(a,c,d){var e=!1;a=a||t;e=a.isVisibleBit;a=a.data;c=u(c);var b=8*a.BYTES_PER_ELEMENT,g=a.length*b;d=d===e;if(0===a.length||0===c)e=
!d;else if(g<c&&!d)e=!0;else{for(var m=x[b],g=x[0],k=0;k<a.length-1;k++)if(e=!d&&a[k]!==m||d&&a[k]!==g)return e;e=a.length-1;c=x[(c-1)%b+1];e=!d&&(a[e]&c)!==c||d&&(a[e]&c)!==g}return e}function r(a){return 0<a.length}function p(a,c,d,e){var b=d/e|0;return 0!==(c[b]&1<<d-b*e)===a}function u(a){return Math.max(0,a.length-1)}Object.defineProperty(b,"__esModule",{value:!0});b.updateVisibility=function(a,c,d,e){if(d<u(c)){null==a&&(a=k());var b=a.isVisibleBit,g=a.data,m=8*g.BYTES_PER_ELEMENT,f=d/m|0,h=
d-m*f;c=(u(c)-1)/m|0;var p=g;e=e===b;d<p.length*m||!e||(d=Math.max(f+1,Math.ceil(1.5*p.length)),d=Math.min(d,c+1),g=new Uint32Array(d),g.set(p));f<g.length&&(g[f]=g[f]&~(1<<h)|(e?1:0)<<h);a.data=g}return a};b.updateVisibilityWithCount=function(a,c,d,e){if(d<c){null==a&&(a=k());var b=a.data,g=8*b.BYTES_PER_ELEMENT,m=d/g|0,f=d-g*m,h=b;e=e===a.isVisibleBit;d<h.length*g||!e||(d=Math.max(m+1,Math.ceil(1.5*h.length)),d=Math.min(d,((c-1)/g|0)+1),b=new Uint32Array(d),b.set(h));m<b.length&&(b[m]=b[m]&~(1<<
f)|(e?1:0)<<f);a.data=b}return a};b.getVisibility=h;b.hideAllComponents=function(a){if(null==a)a=k(!1);else{a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0}return a};b.unhideAllComponents=function(a){var c;if(null!=a)for(c=a,c.isVisibleBit=!1,a=0;a<c.data.length;a++)c.data[a]=0;return c};b.generateVisibleIndexRanges=function(a,c){var d;if(a)if(r(c))if(0===a.data.length)d=[],c=[[c[0],c[c.length-1]-1]],d=a.isVisibleBit?d:c;else{d=[];for(var e=a.isVisibleBit,b=a.data,g=8*b.BYTES_PER_ELEMENT,
k=b.length*g,f=u(c),h=!1,n=0;n<k&&n<f;n++){var t=p(e,b,n,g);if(t!==h){var v=c[n];t?d.push([v,0]):(h=d[d.length-1],h[1]=v-1);h=t}}a=!a.isVisibleBit;f>k&&a&&!h?d.push([c[k],c[f]-1]):h&&(h=d[d.length-1],h[1]=c[a?f:Math.min(f,k)]-1)}else d=[],d=a.isVisibleBit?d:null;else d=null;return d};b.addHighlight=function(c,d,e,b){c=c||[];d={component:d,options:e,id:b};c.push(d);e=a(d);for(b=c.length-1;0<b&&e<a(c[b-1]);)d=[c[b],c[b-1]],c[b-1]=d[0],c[b]=d[1],--b;return c};b.removeHighlight=function(a,c){if(!a)return a;
a=a.filter(function(a){return a.id!==c});return 0===a.length?null:a};b.generateHighlightedIndexRanges=function(a,b,g){if(!b)return null;if(!r(g))return a&&a.isVisibleBit?null:b.map(function(a){return{range:null,options:a.options}});for(var m=g[0],k=g[g.length-1]-1,h=[],p=!c(a,g),n=0;n<b.length;++n){var t=b[n].options,v=b[n].component;if(f.isSome(v))e(h,a,g,v,t);else if(p)d(h,m,k,t);else for(v=0;v<u(g);++v)e(h,a,g,v,t)}return 0<h.length?h:null};b.hasHighlights=function(a,d,e){if(!d)return!1;if(!r(e))return a&&
a.isVisibleBit?!1:0<d.length;a=!c(a,e);for(var b=0;b<d.length;b++)if(f.isSome(d[b].component)||a||0<u(e))return!0;return!1};b.defaultVisibilities=k;b.isAllVisible=function(a,d){return!c(a,d)};b.isAllHidden=function(a,c){return!n(a,c)};b.hasVisible=n;b.hasHidden=c;var t=k();b.createOffsets=function(a){return a instanceof Uint32Array?a:new Uint32Array(a)};b.hasComponent=function(a,c){return c<u(a)};b.hasComponents=r;var x=[];for(q=0;65>q;q++)x.push(Math.pow(2,q)-1);b.componentCount=u;b.componentFind=
function(a,c){a=l.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../../support/geometryUtils/triangle"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=1,e=null,d=new Uint32Array([0]);b.generateDefaultIndexArray=function(c){if(1===c)return d;if(c>a||null==e){for(;c>a;)a*=2;e=new Uint32Array(a);for(var b=
0;b<a;b++)e[b]=b}return new Uint32Array(e.buffer,0,c)};b.computeAttachmentOriginTriangles=function(a,d,e){if(!a)return!1;var b=a.strideIdx,k=a.offsetIdx;a=a.data;l.vec3.set(e,0,0,0);l.vec3.set(r,0,0,0);for(var f=0,m=0,p=0;p<d.length-2;p+=3){var t=d[p+0]*b+k,u=d[p+1]*b+k,C=d[p+2]*b+k;l.vec3.set(n,a[t+0],a[t+1],a[t+2]);l.vec3.set(c,a[u+0],a[u+1],a[u+2]);l.vec3.set(g,a[C+0],a[C+1],a[C+2]);(t=h.areaPoints3d(n,c,g))?(l.vec3.add(n,n,c),l.vec3.add(n,n,g),l.vec3.scale(n,n,1/3*t),l.vec3.add(e,e,n),f+=t):(l.vec3.add(r,
r,n),l.vec3.add(r,r,c),l.vec3.add(r,r,g),m+=3)}return 0===m&&0===f?!1:0!==f?(l.vec3.scale(e,e,1/f),!0):0!==m?(l.vec3.scale(e,r,1/m),!0):!1};b.computeAttachmentOriginPoints=function(a,c,d){if(!a||!c)return!1;var e=a.strideIdx,b=a.offsetIdx;a=a.data;l.vec3.set(d,0,0,0);for(var g=-1,m=0,k=0;k<c.length;k++){var f=c[k]*e+b;g!==f&&(d[0]+=a[f+0],d[1]+=a[f+1],d[2]+=a[f+2],m++);g=f}1<m&&l.vec3.scale(d,d,1/m);return 0<m};b.computeAttachmentOriginLines=function(a,d,e){if(!a)return!1;var b=a.strideIdx,g=a.offsetIdx;
a=a.data;l.vec3.set(e,0,0,0);l.vec3.set(r,0,0,0);for(var k=0,m=0,f=d?d.length-1:a.length/b-1,h=0;h<f;h+=2){var p=(d?d[h+0]:h+0)*b+g,t=(d?d[h+1]:h+1)*b+g;n[0]=a[p+0];n[1]=a[p+1];n[2]=a[p+2];c[0]=a[t+0];c[1]=a[t+1];c[2]=a[t+2];l.vec3.scale(n,l.vec3.add(n,n,c),.5);p=l.vec3.dist(n,c);0<p?(l.vec3.add(e,e,l.vec3.scale(n,n,p)),k+=p):(l.vec3.add(r,r,n),m++)}return 0!==k?(l.vec3.scale(e,e,1/k),!0):0!==m?(l.vec3.scale(e,r,1/m),!0):!1};var k=0;b.getNewId=function(){return k++};var n=f.vec3f64.create(),c=f.vec3f64.create(),
g=f.vec3f64.create(),r=f.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(q,b,l,f,h,a,e,d,k){function n(a,c){if(!a)throw c=c||"assert",a=Error(c),a.stack&&console.log(a.stack),
new t(c);}function c(a){for(var c in a)return c}function g(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function r(a,c){void 0===c&&(c=0);for(var d=0,e=0;4>e;e++)d+=a[c+e]*v[e];return d}function p(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var u=k.vec4f64.create(),t=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();b.AssertException=t;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",
UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"tangent"};b.assert=n;b.verify=function(a,c){a||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};b.encodeInt16=function(a){return l.clamp(Math.round(32767*a),-32767,32767)};b.encodeNormal=function(a,c){var d=Math.abs(a[0]),e=Math.abs(a[1]),b=1/(d+e+Math.abs(a[2])),g=Math.min(a[2]*b,0);c[0]=(0>a[0]?-1:1)*(d*b-g);c[1]=(0>a[1]?-1:
1)*(e*b-g)};b.fallbackIfUndefined=function(a,c){return void 0===a?c:a};b.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};b.rgb2hex=function(a){var c=l.clamp(Math.round(255*a[0]),0,255),d=l.clamp(Math.round(255*a[1]),0,255);a=l.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};b.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};b.rayTriangle3D=function(a,c,d,b,g,k,f,h,p){void 0===p&&(p=e.vec3f64.create());
var m=b[f]-d[k],n=b[f+1]-d[k+1],r=b[f+2]-d[k+2];b=g[h]-d[k];f=g[h+1]-d[k+1];g=g[h+2]-d[k+2];var w=c[1]*g-f*c[2],t=c[2]*b-g*c[0],u=c[0]*f-b*c[1];h=m*w+n*t+r*u;if(-1E-5<h&&1E-5>h)return!1;h=1/h;var v=a[0]-d[k],x=a[1]-d[k+1];a=a[2]-d[k+2];p[1]=h*(v*w+x*t+a*u);if(0>p[1]||1<p[1])return!1;d=x*r-n*a;a=a*m-r*v;m=v*n-m*x;p[2]=h*(c[0]*d+c[1]*a+c[2]*m);if(0>p[2]||1<p[1]+p[2])return!1;p[0]=h*(b*d+f*a+g*m);return!0};b.rayBoxTest=function(a,c,d,e){var b,g=(d[0]-a[0])/c[0],k=(e[0]-a[0])/c[0];g>k&&(b=g,g=k,k=b);
var m=(d[1]-a[1])/c[1],f=(e[1]-a[1])/c[1];m>f&&(b=m,m=f,f=b);if(g>f||m>k)return!1;m>g&&(g=m);f<k&&(k=f);d=(d[2]-a[2])/c[2];a=(e[2]-a[2])/c[2];d>a&&(b=d,d=a,a=b);if(g>a||d>k)return!1;a<k&&(k=a);return 0>k?!1:!0};b.rayRay2D=function(c,d,e,b,g,k){void 0===k&&(k=a.vec2f64.create());var m=(b[g]-e[g])*(d[0]-c[0])-(b[0]-e[0])*(d[g]-c[g]);if(0===m)return!1;e=((b[0]-e[0])*(c[g]-e[g])-(b[g]-e[g])*(c[0]-e[0]))/m;k[0]=c[0]+e*(d[0]-c[0]);k[1]=c[g]+e*(d[g]-c[g]);return!0};b.project=function(a,c,e,b,g){g||(g=a);
u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=1;d.vec4.transformMat4(u,u,c);2<g.length&&(g[2]=-u[2]);d.vec4.transformMat4(u,u,e);n(0!==u[3]);g[0]=u[0]/u[3];g[1]=u[1]/u[3];g[2]=u[2]/u[3];g[0]=(.5*g[0]+.5)*b[2]+b[0];g[1]=(.5*g[1]+.5)*b[3]+b[1]};b.getFirstObjectKey=c;b.getFirstObjectValue=function(a){return a[c(a)]};b.objectEmpty=function(a){for(var c in a)return!1;return!0};b.logWithBase=function(a,c){return Math.log(a)/Math.log(c)};b.setMatrixTranslation=g;b.setMatrixTranslation3=function(a,c,d,e){a[12]=c;a[13]=
d;a[14]=e};b.getMatrixTranslation=function(a,c){void 0===c&&(c=e.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};b.createTranslationMatrix=function(a,c){a=f.mat4.identity(a);g(a,c);return a};b.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};b.fovx2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/c)};b.fovy2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*
a)/d)};b.fovx2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/c)};b.fovy2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/d)};b.fovd2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovd2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.packFloatRGBA=function(a,c,d){void 0===d&&(d=0);a=l.clamp(a,0,y);for(var e=0;4>e;e++)c[d+e]=Math.floor(256*p(a*x[e]))};b.unpackFloatRGBA=r;var x=[1,256,
65536,16777216],v=[1/256,1/65536,1/16777216,1/4294967296],y=r(new Uint8ClampedArray([255,255,255,255]));b.inverseProjectionInfo=function(a,c,d,e,b){0===a[11]?(e[0]=2/(c*a[0]),e[1]=2/(d*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],h.vec2.set(b,0,1)):(e[0]=-2/(c*a[0]),e[1]=-2/(d*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],h.vec2.set(b,1,0))}})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(q,b,l,f){return function(){function b(a,
e,d,k,f){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=e;this._usage=d;this._id=b._nextId++;this._glName=this._context.gl.createBuffer();k&&this.setData(k,f)}b.createIndex=function(a,e,d,k){return new b(a,34963,e,d,k)};b.createVertex=function(a,e,d){return new b(a,34962,e,d)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexType",{get:function(){return this._indexType},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};b.prototype.setData=function(a,e){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&
e)switch(this._indexType=e,this._size=a,e){case 5123:a*=2;break;case 5125:a*=4}}else e=a.byteLength,f.isUint16Array(a)&&(e/=2,this._indexType=5123),f.isUint32Array(a)&&(e/=4,this._indexType=5125),this._size=e;e=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(e)}};b.prototype.setSubData=function(a,e,d,b){void 0===e&&(e=0);void 0===d&&(d=0);if(a){(0>e||e>=this._size)&&console.error("offset is out of range!");
var k=e,c=d,g=b,h=a.byteLength;f.isUint16Array(a)&&(h/=2,k*=2,c*=2,g*=2);f.isUint32Array(a)&&(h/=4,k*=4,c*=4,g*=4);void 0===b&&(b=h-1);d>=b&&console.error("end must be bigger than start!");e+d-b>this._size&&console.error("An attempt to write beyond the end of the buffer!");e=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);d=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;d.bufferSubData(this._bufferType,k,a.slice(c,g));this._context.bindVAO(e)}};b._nextId=
0;return b}()})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/has","../../core/mathUtils"],function(q,b,l,f,h){return function(){function a(e,d,b){this._glName=this._context=null;this._id=-1;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=e;this._descriptor=l({target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1},
d);this._id=++a._nextId;this.setData(b)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._descriptor},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context&&this._context.gl){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(d){a._context.bindTexture(null,
d)});d.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.release=function(){this.dispose()};a.prototype.resize=function(a,d){var e=this._descriptor;if(e.width!==a||e.height!==d)e.width=a,e.height=d,this.setData(null)};a.prototype.setData=function(e){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===e&&(e=null);null===e&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=this._descriptor.height||4);var b=this._context.getBoundTexture(0);
this._context.bindTexture(this,0);var f=this._descriptor;a._validateTexture(f);d.pixelStorei(d.UNPACK_ALIGNMENT,f.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,f.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.preMultiplyAlpha?1:0);var c=f.pixelFormat,g=f.internalFormat?f.internalFormat:c;if(e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){var h=e.width,p=e.height;e instanceof HTMLVideoElement&&(h=e.videoWidth,
p=e.videoHeight);f.width&&f.height&&console.assert(h===f.width&&p===f.height);d.texImage2D(d.TEXTURE_2D,0,g,c,f.dataType,e);f.hasMipmap&&this.generateMipmap();void 0===this._descriptor.width&&(this._descriptor.width=h);void 0===this._descriptor.height&&(this._descriptor.height=p)}else if(null!=f.width&&null!=f.height||console.error("Width and height must be specified!"),d.DEPTH24_STENCIL8&&g===d.DEPTH_STENCIL&&(g=d.DEPTH24_STENCIL8),h=f.width,p=f.height,null!=e&&"type"in e&&"compressed"===e.type){c=
Math.round(Math.log(Math.max(h,p))/Math.LN2)+1;f.hasMipmap=f.hasMipmap&&c===e.levels.length;for(var u=0;;++u){d.compressedTexImage2D(d.TEXTURE_2D,u,g,h,p,0,e.levels[Math.min(u,e.levels.length-1)]);if(1===h&&1===p||!f.hasMipmap)break;h=Math.max(1,h>>1);p=Math.max(1,p>>1)}}else if(e)d.texImage2D(d.TEXTURE_2D,0,g,h,p,0,c,f.dataType,e),f.hasMipmap&&this.generateMipmap();else for(u=0;;++u){d.texImage2D(d.TEXTURE_2D,u,g,h,p,0,c,f.dataType,null);if(1===h&&1===p||!f.hasMipmap)break;h=Math.max(1,h>>1);p=Math.max(1,
p>>1)}a._applySamplingMode(d,this._descriptor);a._applyWrapMode(d,this._descriptor);a._applyAnisotropicFilteringParameters(this._context,this._descriptor);this._context.bindTexture(b,0)};a.prototype.updateData=function(a,d,b,f,c,g){g||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var e=this._context.gl,k=this._descriptor,h=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>b||f>k.width||c>k.height||
d+f>k.width||b+c>k.height)&&console.error("An attempt to update out of bounds of the texture!");e.pixelStorei(e.UNPACK_ALIGNMENT,k.unpackAlignment);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,k.flipped?1:0);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.preMultiplyAlpha?1:0);g instanceof ImageData||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement?(console.assert(g.width===f&&g.height===c),e.texSubImage2D(e.TEXTURE_2D,a,d,b,k.pixelFormat,k.dataType,g)):e.texSubImage2D(e.TEXTURE_2D,
a,d,b,f,c,k.pixelFormat,k.dataType,g);this._context.bindTexture(h,0)};a.prototype.generateMipmap=function(){var e=this._descriptor;e.hasMipmap||(e.hasMipmap=!0,a._validateTexture(e));9729===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9985):9728===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9984);e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(e,0)};a.prototype.setSamplingMode=
function(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,a._validateTexture(this._descriptor),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,a._validateTexture(this._descriptor),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var e=this._context.gl,d=this._descriptor;this._samplingModeDirty&&(a._applySamplingMode(e,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(e,
d),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,d){d?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");h.isPowerOfTwo(a.width)&&h.isPowerOfTwo(a.height)||("number"===typeof a.wrapMode?33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):33071===a.wrapMode.s&&33071===a.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,d){var e=d.samplingMode,b=d.samplingMode;if(9985===e||9987===e)e=9729,d.hasMipmap||(b=9729);else if(9984===e||9986===e)e=9728,d.hasMipmap||(b=9728);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b)};a._applyWrapMode=function(a,d){"number"===typeof d.wrapMode?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_T,d.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode.t))};a._applyAnisotropicFilteringParameters=function(a,d){if(null!=d.maxAnisotropy){var e=a.capabilities.textureFilterAnisotropic;e&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],
function(q,b,l,f){function h(a){return a[0].stride}function a(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function e(a){switch(a){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;
case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:f.neverReached(a)}return 0}function d(a){if(!a)return 0;if("colorAttachment"in a)return a.glName?d(a.colorAttachment)+d(a.depthStencilAttachment):0;if("descriptor"in a)return a.glName?d(a.descriptor):0;var b=a.internalFormat||"pixelFormat"in a&&a.pixelFormat;if(!b)return 0;var c="hasMipmap"in a&&a.hasMipmap?1.3:1;a=a.width*a.height;return e(b)*a*c}Object.defineProperty(b,"__esModule",{value:!0});
b.vertexCount=function(a,d){return a.vertexBuffers[d].size/h(a.layout[d])};b.getStride=h;b.getBytesPerElement=a;b.addDescriptor=function(d,e,c,b,f,h){var g=a(b);if(0<d.length){var k=d[0].stride,p=k+g*c;d.forEach(function(a){return a.stride=p});d.push({name:e,count:c,type:b,offset:k,stride:p,normalized:f,divisor:h})}else d.push({name:e,count:c,type:b,offset:0,stride:g*c,normalized:f,divisor:h})};b.hasAttribute=function(a,d){for(var c=0;c<a.length;c++)if(a[c].name===d)return!0;return!1};b.findAttribute=
function(a,d){for(var c=0;c<a.length;c++)if(a[c].name===d)return a[c];return null};b.copyFramebufferToTexture=function(a,d,c,e,b){void 0===b&&(b=0);var g=a.getBoundFramebufferObject(),k=a.getBoundTexture(0);a.bindFramebuffer(d);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,b,c.descriptor.pixelFormat,e[0],e[1],e[2],e[3],0);a.gl.flush();a.bindFramebuffer(g);a.bindTexture(k,0)};b.setBaseInstanceOffset=function(a,d){var c={},e;for(e in a)c[e]=a[e].map(function(a){return a.divisor?l({},a,{baseInstance:d}):
a});return c};b.bindVertexBufferLayout=function(a,d,c,e,b){var g=a.gl,k=a.capabilities.instancing;a.bindBuffer(c);for(a=0;a<e.length;a++){c=e[a];var f=d[c.name],h=(b?b:0+c.baseInstance?c.baseInstance:0)*c.stride;void 0===f&&console.error("There is no location for vertex attribute '"+c.name+"' defined.");c.baseInstance&&!c.divisor&&console.error("Vertex attribute '"+c.name+"' uses baseInstanceOffset without divisor.");if(4>=c.count)g.vertexAttribPointer(f,c.count,c.type,c.normalized,c.stride,c.offset+
h),g.enableVertexAttribArray(f),c.divisor&&0<c.divisor&&k&&k.vertexAttribDivisor(f,c.divisor);else if(9===c.count)for(var n=0;3>n;n++)g.vertexAttribPointer(f+n,3,c.type,c.normalized,c.stride,c.offset+12*n+h),g.enableVertexAttribArray(f+n),c.divisor&&0<c.divisor&&k&&k.vertexAttribDivisor(f+n,c.divisor);else if(16===c.count)for(n=0;4>n;n++)g.vertexAttribPointer(f+n,4,c.type,c.normalized,c.stride,c.offset+16*n+h),g.enableVertexAttribArray(f+n),c.divisor&&0<c.divisor&&k&&k.vertexAttribDivisor(f+n,c.divisor);
else console.error("Unsupported vertex attribute element count: "+c.count)}};b.unbindVertexBufferLayout=function(a,d,c,e){var b=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);for(c=0;c<e.length;c++){var k=e[c],f=d[k.name];if(4>=k.count)b.disableVertexAttribArray(f),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(f,0);else if(9===k.count)for(var h=0;3>h;h++)b.disableVertexAttribArray(f+h),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(f+h,0);else if(16===k.count)for(h=0;4>h;h++)b.disableVertexAttribArray(f+
h),k.divisor&&0<k.divisor&&g&&g.vertexAttribDivisor(f+h,0);else console.error("Unsupported vertex attribute element count: "+k.count)}a.unbindBuffer(34962)};b.getBytesPerElementFormat=e;b.getGpuMemoryUsage=d})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(q,b,l,f){return function(){function b(a,e,d,k,f){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=
a;this._layout=d;this._buffers=k;this._locations=e;f&&(this._indexBuffer=f);this._id=b._nextId++}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(e,d){return e+a._buffers[d].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.dispose=
function(a){void 0===a&&(a=!0);if(this._context){var e=this._context.capabilities.vao;e&&this._glName&&(e.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var d in this._buffers)this._buffers[d].dispose(),delete this._buffers[d];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};b.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var e=
a.createVertexArray();a.bindVertexArray(e);this._bindLayout();a.bindVertexArray(null);this._glName=e}this._initialized=!0}};b.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=function(){var a=this._buffers,e=!!this._context.capabilities.vao,d=this._layout,b=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var h=this._context.gl,c;for(c in a){var g=
a[c];g||console.error("Vertex buffer is uninitialized!");var r=d[c];r||console.error("Vertex element descriptor is empty!");f.bindVertexBufferLayout(this._context,this._locations,g,r)}b&&(e?h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,b.glName):this._context.bindBuffer(b))};b.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};b.prototype._unbindLayout=function(){var a=this._buffers,e=this._layout;a||console.error("Vertex buffer dictionary is empty!");
for(var d in a){var b=a[d];b||console.error("Vertex buffer is uninitialized!");f.unbindVertexBufferLayout(this._context,this._locations,b,e[d])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};b._nextId=0;return b}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Handles ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ./RealisticAtmosphereTechnique ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,c){this._view=a;this.canRender=!0;this._skyslot=12;this._undergroundSlot=13;this._renderData={texDepth:d.vec2f64.create(),cameraPosition:n.vec3f64.create(),cameraUp:n.vec3f64.create(),cameraRight:n.vec3f64.create(),cameraDir:n.vec3f64.create(),halfSizeNearPlane:d.vec2f64.create(),cameraCenterOffset:d.vec2f64.create(),heightParameters:g.vec4f64.create(),atmosphereParameters1:g.vec4f64.create(),
atmosphereParameters2:g.vec4f64.create(),atmosphereParameters3:n.vec3f64.create(),invWavelength:w,invWavelengthScaled:A,radii:d.vec2f64.create(),scale:0,scaleDepth:B,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,oneOverScaleDepth:0,scaleDepthBlue:C,oneOverScaleDepthBlue:G,scaleOverScaleDepthBlue:0,g:J,g2:J*J,miePhaseCoefficients:I,nearFar:d.vec2f64.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=u.earthRadius;
this._updateRadius(u.earthRadius);this._techniqueRepository=c;this._atmosphereTechniqueConfig=new p.RealisticAtmosphereTechniqueConfiguration}b.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.when=function(a){return f(this,void 0,void 0,function(){return l(this,function(c){a();return[2]})})};b.prototype.initializeRenderContext=function(c){var d=this;c=c.rctx;this._handles=new h;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,
tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(a.on(this._view,"basemapTerrain","elevation-change",function(a){return d._updateElevation(a)},function(){return d._updateElevation()}));this._handles.add(a.on(this._view,"basemapTerrain","elevation-bounds-change",function(){return d._updateVisibleElevationBounds()},function(){return d._updateVisibleElevationBounds()}));this._atmosphereTechniqueConfig.underground=!1;
this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(p.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.underground=!0;this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(p.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=this._createVertexArrayObject(c)};b.prototype.uninitializeRenderContext=function(){this.destroy()};
b.prototype.render=function(a){if(a.slot!==this._undergroundSlot&&a.slot!==this._skyslot||0!==a.pass)return!1;this._update(a.camera);a.slot===this._skyslot&&this._renderSky(a);a.slot===this._undergroundSlot&&this._renderUnderground(a);return!0};b.prototype._renderSky=function(a){var c=a.rctx,d=this._atmosphereTechnique.program;c.bindProgram(d);this._atmosphereTechnique.bindPipelineState(c);d.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(d,a)};b.prototype._renderUnderground=
function(a){var c=this,d=a.rctx,e=a.offscreenRenderingHelper,b=this._atmosphereUndergroundTechnique.program;d.bindProgram(b);this._atmosphereUndergroundTechnique.bindPipelineState(d);e.renderDepthDetached(function(){d.bindTexture(e.depthTexture,0);b.setUniform1i("depthTex",0);c._renderCommon(b,a)})};b.prototype._renderCommon=function(a,c){var d=c.rctx;a.setUniform3fv("invWavelength",this._renderData.invWavelength);a.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);c.scenelightingData.setLightDirectionUniform(a);
a.setUniform4fv("heightParameters",this._renderData.heightParameters);a.setUniform3fv("cameraPosition",this._renderData.cameraPosition);a.setUniform3fv("cameraUp",this._renderData.cameraUp);a.setUniform3fv("cameraRight",this._renderData.cameraRight);a.setUniform3fv("cameraDir",this._renderData.cameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("cameraCenterOffset",this._renderData.cameraCenterOffset);
a.setUniform2fv("radii",this._renderData.radii);a.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);a.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);a.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);a.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);d.drawArrays(5,0,4)};b.prototype._createVertexArrayObject=function(a){var c=K.createBuffer(4);
c.position.setVec(0,[-1,-1,1]);c.position.setVec(1,[1,-1,1]);c.position.setVec(2,[-1,1,1]);c.position.setVec(3,[1,1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,[0,1]);c.uv0.setVec(3,[1,1]);return new m(a,v.Default3D,{geometry:t.glLayout(K)},{geometry:y.createVertex(a,35044,c.buffer)})};b.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};b.prototype._updateElevation=function(a){a=a?a.tile:this._view.basemapTerrain.rootTiles[0];0===a.lij[0]&&
(a=this._adjustRadiusForTesselation(u.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};b.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(u.earthRadius+this._view.basemapTerrain.elevationBounds.min);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};b.prototype._updateRadius=function(a){this._earthRadius=a;var d=a/10*10.25,b=
1/(d-a),g=b/B,m=b/C,f=.3*(d-a)+a,h=this._renderData;c.vec4.set(h.atmosphereParameters1,b,B,g,E);c.vec4.set(h.atmosphereParameters2,J,C,m,G);k.vec3.set(h.atmosphereParameters3,J*J,I,f);e.vec2.set(h.radii,a,d);h.scale=b;h.lowerAlphaBlendBound=f;h.scaleOverScaleDepth=g;h.scaleOverScaleDepthBlue=m;d=r.INNER_ATMOSPHERE_DEPTH;h.innerFadeDistance=2*Math.sqrt((2*a-d)*d)};b.prototype._update=function(a){a&&(k.vec3.negate(this._renderData.cameraDir,a.viewForward),k.vec3.copy(this._renderData.cameraUp,a.viewUp),
k.vec3.copy(this._renderData.cameraRight,a.viewRight),this._renderData.cameraHeight=k.vec3.length(a.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=g.vec4f64.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,
this._renderData.C,this._renderData.CSur),k.vec3.copy(this._renderData.cameraPosition,a.eye),e.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight)),e.vec2.set(this._renderData.cameraCenterOffset,(a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5),e.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.altitudeFade=r.computeInnerAltitudeFade(this._renderData.cameraHeight-this._earthRadius))};
b.isSupported=function(a){return a.rctx.capabilities.depthTexture};return b}();b.RealisticAtmosphere=q;b=.02*Math.PI;q=.004*Math.PI;var w=n.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),A=n.vec3f64.clone(w);k.vec3.scale(A,A,b);k.vec3.add(A,A,n.vec3f64.fromValues(q,q,q));var B=.25,C=.05,E=1/B,G=1/C,J=-.99999,I=(1-J*J)/(2+J*J)*1.5,K=x.newLayout().vec3f("position").vec2f("uv0")})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(q,
b){Object.defineProperty(b,"__esModule",{value:!0});b.computeInnerAltitudeFade=function(b){return Math.min(1,Math.max(0,(b-1E5)/9E5))};b.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/RealisticAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(d){function b(){return null!==d&&d.apply(this,arguments)||this}l(b,d);b.prototype.initializeProgram=function(a){var d=b.shader.get().build({underground:this.configuration.underground});return new c(a.rctx,d.generateSource("vertex"),d.generateSource("fragment"),n.Default3D)};b.prototype.initializePipeline=function(){return this.configuration.underground?g.makePipelineState({blending:g.separateBlendingParams(1,
0,769,1),colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};b.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};b.shader=new e.ReloadableShaderModule(a,"../environment/RealisticAtmosphere.glsl",q);return b}(d.ShaderTechnique);b.RealisticAtmosphereTechnique=h;h=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.underground=!1;return c}
l(c,a);f([k.parameter()],c.prototype,"underground",void 0);return c}(k.ShaderTechniqueConfiguration);b.RealisticAtmosphereTechniqueConfiguration=h})},"esri/views/3d/environment/RealisticAtmosphere.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var f=new k.ShaderBuilder;f.attributes.add("position","vec3");f.attributes.add("uv0","vec2");f.varyings.add("worldRay","vec3");f.varyings.add("vtc","vec2");b.underground&&f.varyings.add("eyeDir","vec3");f.vertex.uniforms.add("halfSizeNearPlane","vec2").add("cameraUp","vec3").add("cameraRight","vec3").add("cameraDir","vec3").add("cameraCenterOffset","vec2");f.vertex.code.add(d.glsl(n||(n=l(["\n    void main(void) {\n      vec3 v3Pos \x3d position;\n      vtc \x3d uv0;\n      vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n      ",
"\n      worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n      gl_Position \x3d vec4(v3Pos, 1.0);\n    }\n  "],["\n    void main(void) {\n      vec3 v3Pos \x3d position;\n      vtc \x3d uv0;\n      vec2 rayvtc \x3d uv0 - cameraCenterOffset;\n      ","\n      worldRay \x3d eyeDir.z * cameraDir + eyeDir.y * cameraUp + eyeDir.x * cameraRight;\n      gl_Position \x3d vec4(v3Pos, 1.0);\n    }\n  "])),b.underground?"eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);":
"vec3 eyeDir \x3d vec3((2.0 * halfSizeNearPlane * rayvtc) - halfSizeNearPlane, -1.0);"));f.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");b.underground?f.fragment.uniforms.add("depthTex","sampler2D"):f.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance",
"float").add("altitudeFade","float");f.include(e.RgbaFloatEncoding);f.include(a.ColorConversion,{stages:1});f.fragment.code.add(d.glsl(c||(c=l(["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "],
["\n  // Atmosphere\n  const float krESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\n  const float kmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\n\n  // The inner (planetary) radius\n  #define innerRadius radii[0]\n  // The outer (atmosphere) radius\n  #define outerRadius radii[1]\n\n  // Atmosphere parameters:\n\n  // shellScale:               1.0 / (outerRadius - innerRadius)\n  #define shellScale atmosphereParameters1.x\n\n  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\n  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)\n\n  // scaleOverScaleDepth:      scale / shellDepth\n  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue\n  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)\n\n  // oneOverScaleDepth:        1.0 / shellDepth\n  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue\n  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)\n  "]))));
b.underground||f.fragment.code.add(d.glsl(g||(g=l(["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "],["\n      #define g atmosphereParameters2.x\n      #define gSq atmosphereParameters3.x\n      #define miePhaseCoefficients atmosphereParameters3.y\n      #define lowerAlphaBlendBound atmosphereParameters3.z\n    "]))));f.fragment.code.add(d.glsl(r||
(r=l(["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "],
["\n  // The camera's current height\n  #define cameraHeight heightParameters[0]\n  // cameraHeight^2\n  #define cameraHeightSq heightParameters[1]\n  // cameraHeightSq - outerRadiusSq; // C \x3d ||o-c||^2 - r^2\n  #define C heightParameters[2]\n  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C \x3d ||o-c||^2 - r^2\n  #define CSur heightParameters[3]\n\n  ","\n    // Loop constants for integral approximation\n    const float samples \x3d 5.0;\n    const int maxSamples \x3d 5;\n\n    // ToneMapping operators\n    vec3 expTM(vec3 inputColor,float _exposure) {\n        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);\n    }\n\n    // Approximation for inner integral based on a radii ratio of 10.25:10\n    float scale(float _cos) {\n      float x \x3d 1.0 - _cos;\n      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));\n    }\n\n    void main() {\n      // Obtain ray from Camera\n      vec3 worldSpaceRay \x3d normalize(worldRay);\n\n      // Compute Atmosphere intersection; i.e. ray/sphere intersection\n      float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\n      float det \x3d B * B - 4.0 * C; // det \x3d B^2 - 4.0* C\n\n      // idealized sphere intersection to discard early some pixels\n      float detSur \x3d B * B - 4.0 * CSur; // det \x3d B^2 - 4.0* C\n\n      // the minimal sample start position:\n      // at the camera by default, on the earth radius surface if the camera is underground.\n      float minRayStart \x3d 0.0;\n  "])),
b.underground?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "));b.underground||
f.fragment.code.add(d.glsl(p||(p=l(["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "],
["\n      float surfaceBlend \x3d 0.0;\n      vec4 surfaceColor \x3d vec4(0.0);\n      if (detSur \x3e\x3d 0.0) {\n        float nearSurface \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\n        float farSurface \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\n\n        if (nearSurface \x3d\x3d 0.0) {\n          minRayStart \x3d farSurface;\n        }\n\n        // Compute lighting at the point where the ray enters the earth surface\n        // Lighting computation is copied from the terrain shader.\n        vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurface;\n        float lightAngle \x3d dot(-lightingMainDirection, normalize(vPos));\n        float brightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));\n\n        // Make the surface transparent based on altitude\n        surfaceColor \x3d vec4(brightness, brightness, brightness, 1.0 - altitudeFade);\n\n        // Fade based on the distance the ray travels below the earth surface\n        float relDist \x3d (farSurface - nearSurface) / innerFadeDistance;\n\n        // early exit\n        if (relDist \x3e 1.0) {\n          gl_FragColor \x3d surfaceColor;\n          return;\n        }\n\n        surfaceBlend \x3d smoothstep(0.0, 1.0, relDist * relDist);\n      }\n    "]))));
f.fragment.code.add(d.glsl(u||(u=l(["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "],
["\n    if (det \x3e\x3d 0.0) {\n    ","\n    float rayStart \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\n    ","\n\n    float scatterDistance; // calculate its scattering offset\n    // Calculate the ray's starting position\n    if (rayStart \x3c minRayStart)\n    { // ray starts from camera or inner radius sphere to far\n      rayStart \x3d minRayStart;\n      ","\n    }\n    ","\n    // Initialize the scattering loop variables\n    vec3 start \x3d cameraPosition + worldSpaceRay * rayStart;\n  "])),
b.underground?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
"",b.underground?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere",b.underground?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);",b.underground?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"));b.underground&&f.fragment.code.add(d.glsl(t||(t=l(["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "],
["\n      vec3 end \x3d cameraPosition + worldSpaceRay * rayEnd;\n\n      float endLength \x3d length(end);\n      //altitudeStart, altitudeEnd\n      vec2 altitudeInterval \x3d vec2(length(start) - innerRadius, endLength - innerRadius);\n\n      // for camera positions below altitude 0, invert the altitudes, to achieve\n      // a similar haze as above ground. Note that there is a small but visible change\n      // when the camera passes altitude 0.\n      if (altitudeInterval.x \x3c 0.0) {\n        altitudeInterval \x3d -altitudeInterval;\n      }\n\n      // computed for the original end point to get consistent light angles after possible inversions\n      float lightAngle \x3d dot(-lightingMainDirection, end) / endLength;\n\n      if (near \x3e far)\n      {\n        if (altitudeInterval.x \x3c altitudeInterval.y)\n        {\n          // Switch positive slopes for flipped rays\n          end \x3d cameraPosition + worldSpaceRay * rayStart;\n          start \x3d cameraPosition + worldSpaceRay * rayEnd;\n          worldSpaceRay *\x3d -1.0;\n          float tmp \x3d altitudeInterval.x;\n          altitudeInterval.x \x3d altitudeInterval.y;\n          altitudeInterval.y \x3d tmp;\n        }\n        else if (altitudeInterval.x \x3d\x3d altitudeInterval.y)\n        { // create minuscule fake slope for integration if the slope is zero\n          altitudeInterval.x +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\n          // slope for the camera function\n        }\n      }\n\n      // Calculate its scattering offset\n      // Assumes camera constrains of WSV 3.8\n      if (altitudeInterval.x \x3e outerRadius - innerRadius)\n      { // outside atmosphere\n        scatterDistance \x3d innerRadius - outerRadius;\n      } else\n      {\n        scatterDistance \x3d altitudeInterval.y - altitudeInterval.x;\n      }\n    "]))));
f.fragment.code.add(d.glsl(x||(x=l(["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "],["\n    vec2 opticalStartDepth \x3d exp(scatterDistance * oneOverScaleDepth);\n\n    float rayLength \x3d rayEnd - rayStart;\n    float sampleLength \x3d rayLength / samples;\n    float scaledLength \x3d sampleLength * shellScale;\n    vec3 sampleRay \x3d worldSpaceRay * sampleLength;\n    vec3 samplePoint \x3d start + sampleRay * 0.5;\n  "]))));
b.underground?f.fragment.code.add(d.glsl(v||(v=l(["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(-worldSpaceRay, end) / length(end);\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth;\n\n      float scaledValues \x3d scale(lightAngle) + scaleCameraAngle;\n      vec2 scaledValuesDepth \x3d scaledValues * shellDepth;\n    "])))):
f.fragment.code.add(d.glsl(y||(y=l(["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "],["\n      float cameraAngle \x3d dot(worldSpaceRay, start / length(start));\n      float angleMultiplier \x3d cameraAngle \x3e 0.0 ? cameraAngle : 0.0;\n\n      float scaleCameraAngle \x3d scale(cameraAngle);\n      vec2 cameraOffset \x3d scaleCameraAngle * opticalStartDepth * shellDepth;\n    "]))));
f.fragment.code.add(d.glsl(m||(m=l(["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "],["\n    // Loop variables\n    vec3 frontColor \x3d vec3(0.0);\n    vec3 frontColorBlue \x3d vec3(0.0);\n    vec3 attenuate \x3d vec3(0.0);\n    vec3 attenuateBlue \x3d vec3(0.0);\n\n    // Now loop through the sample rays\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\n      float height \x3d length(samplePoint);\n      float altitude \x3d abs(height - innerRadius);\n\n      vec2 depth \x3d exp(-altitude * scaleOverScaleDepth);\n  "]))));
b.underground?f.fragment.code.add(d.glsl(w||(w=l(["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "],["\n      vec2 scatter \x3d depth * scaledValuesDepth - cameraOffset;\n    "])))):f.fragment.code.add(d.glsl(A||(A=l(["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "],
["\n      float lightAngle \x3d dot(-lightingMainDirection, samplePoint) / height;\n      float cameraAngle \x3d dot(worldSpaceRay, samplePoint) / height;\n      float tmpScaledValues \x3d scale(lightAngle) - scale(cameraAngle);\n      vec2 scatter \x3d cameraOffset + tmpScaledValues * depth * shellDepth;\n    "]))));f.fragment.code.add(d.glsl(B||(B=l(["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "],
["\n      attenuate \x3d exp(-scatter.x * invWavelengthScaled);\n      attenuateBlue \x3d exp(-scatter.y * invWavelengthScaled);\n\n      frontColor +\x3d attenuate * depth.x;\n      frontColorBlue +\x3d attenuateBlue * depth.y;\n\n      samplePoint +\x3d sampleRay;\n    }\n\n    // Phase computation\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\n    float LdotR \x3d clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);\n    float LdotRSq \x3d LdotR * LdotR + 1.0;\n  "]))));
b.underground?f.fragment.code.add(d.glsl(C||(C=l(["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "],["\n      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\n      vec3 colorCoefficients \x3d (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );\n\n      // Scaled Length is only applied afterwards to save multiplications\n      vec3 color \x3d colorCoefficients * frontColor;\n      vec3 colorBlue \x3d colorCoefficients * frontColorBlue;\n    "])))):
f.fragment.code.add(d.glsl(E||(E=l(["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "],
["\n      vec3 rayleighCoefficients \x3d (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;\n      float mieCoefficients \x3d scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);\n\n      // Calculate the attenuation factor for the ground\n      vec3 color \x3d rayleighCoefficients * frontColor + mieCoefficients * frontColor;\n      vec3 colorBlue \x3d rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;\n    "]))));f.fragment.code.add(d.glsl(G||
(G=l(["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "],["\n    // HDR to LDR conversion\n    vec3 ldrBlue \x3d expTM(colorBlue, 2.0 * exposure);\n    vec3 ldrRed \x3d expTM(color, exposure);\n\n    // mix reddish and blueish atmosphere\n    vec3 LDR \x3d mix(ldrBlue, ldrRed, 0.2);\n  "]))));b.underground?f.fragment.code.add(d.glsl(J||
(J=l(["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "],["\n      LDR *\x3d (1.0 - cameraAngle);\n      vec3 hsv \x3d rgb2hsv(LDR);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%\n      LDR \x3d hsv2rgb(hsv);\n      vec3 finalColor \x3d LDR;\n      // when rendering we specify the blend functions such that\n      // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\n    "])))):
f.fragment.code.add(d.glsl(I||(I=l(["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "],
["\n      // reinhard tonemapper for looking upwards\n      vec3 ldrReinhard \x3d reinhardTM(color, exposure);\n      LDR +\x3d angleMultiplier * ldrReinhard;\n\n      // height dependent parameter to smooth out reddish atmosphere\n      float side \x3d (rayEnd + rayStart) * 0.5;\n      float atmoHeight \x3d sqrt(cameraHeightSq - side * side);\n      float h2 \x3d clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);\n\n      vec3 finalColor \x3d LDR * h2;\n      vec3 hsv \x3d rgb2hsv(finalColor);\n      hsv.y \x3d clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%\n      finalColor \x3d hsv2rgb(hsv);\n    "]))));
f.fragment.code.add(d.glsl(K||(K=l(["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "],["\n    ","\n      } else { // Outside Atmosphere\n        gl_FragColor \x3d vec4(0.0);\n      }\n    }\n  "])),b.underground?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"));
return f};var n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.ColorConversion=function(b,n){var c=[f.glsl(h||(h=l(["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "],["\n      vec4 premultiplyAlpha(vec4 v) {\n        return vec4(v.rgb * v.a, v.a);\n      }\n    "]))),
f.glsl(a||(a=l(["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "],["\n      vec3 rgb2hsv(vec3 c) {\n        vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n        vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n        vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n\n        float d \x3d q.x - min(q.w, q.y);\n        float e \x3d 1.0e-10;\n        return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n      }\n    "]))),
f.glsl(e||(e=l(["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "],["\n      vec3 hsv2rgb(vec3 c) {\n        vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n        vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n      }\n    "]))),f.glsl(d||
(d=l(["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "],["\n      float rgb2v(vec3 c) {\n        return max(c.x, max(c.y, c.z));\n      }\n    "])))];switch(n.stages){case 0:c.forEach(function(a){return b.vertex.code.add(a)});break;case 1:c.forEach(function(a){return b.fragment.code.add(a)});break;default:c.forEach(function(a){return b.vertex.code.add(a)}),c.forEach(function(a){return b.fragment.code.add(a)})}};var h,a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.RgbaFloatEncoding=function(a){var e=f.glsl(h||(h=l(["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "],
["\n    // This is the maximum float value representable as 32bit fixed point,\n    // it is rgba2float(vec4(1)) inlined.\n    const float MAX_RGBA_FLOAT \x3d\n      255.0 / 256.0 +\n      255.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 +\n      255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\n    const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n    vec4 float2rgba(const float value) {\n      // Make sure value is in the domain we can represent\n      float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n      // Decompose value in 32bit fixed point parts represented as\n      // uint8 rgba components. Decomposition uses the fractional part after multiplying\n      // by a power of 256 (this removes the bits that are represented in the previous\n      // component) and then converts the fractional part to 8bits.\n      vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n      // Convert uint8 values (from 0 to 255) to floating point representation for\n      // the shader\n      const float toU8AsFloat \x3d 1.0 / 255.0;\n\n      return fixedPointU8 * toU8AsFloat;\n    }\n\n    // Factors to convert rgba back to float\n    const vec4 RGBA_2_FLOAT_FACTORS \x3d vec4(\n      255.0 / (256.0),\n      255.0 / (256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0),\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n    );\n\n    float rgba2float(vec4 rgba) {\n      // Convert components from 0-\x3e1 back to 0-\x3e255 and then\n      // add the components together with their corresponding\n      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\n      return dot(rgba, RGBA_2_FLOAT_FACTORS);\n    }\n  "])));
a.fragment.code.add(e);a.vertex.code.add(e)};var h})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/mathUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K){function H(a,c,d,e,b){var g=r.vec3.length(a),k=e*Math.sqrt(g*g-e*e)/g,m=b.silCircleV1,f=b.silCircleV2;r.vec3.scale(b.silCircleCenter,a,Math.sqrt(e*e-k*k)/g);r.vec3.cross(m,a,c);1>r.vec3.squaredLength(m)&&r.vec3.cross(m,a,d);r.vec3.scale(m,m,k/r.vec3.length(m));r.vec3.cross(f,m,a);r.vec3.scale(f,f,k/r.vec3.length(f));return k}function L(a,c,d,e){r.vec3.add(Y,e.silCircleCenter,e.silCircleV2);r.vec3.scale(N,Y,O);k.mat4.lookAt(T,c,Y,
d);E.project(Y,T,a.projectionMatrix,a.viewport);E.project(N,T,a.projectionMatrix,a.viewport);return r.vec3.distance(Y,N)/a.height}var P=-u.INNER_ATMOSPHERE_DEPTH,S=(v.earthRadius+P)/v.earthRadius,R=(v.earthRadius+0)/v.earthRadius,O=(v.earthRadius+3E5)/v.earthRadius,Q=m.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);q=function(){function b(a,c){this.slot=12;this._renderData={texV:g.vec2f64.create(),silCircleCenter:p.vec3f64.create(),silCircleV1:p.vec3f64.create(),
silCircleV2:p.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=e.createResolver();this._readyController=e.createAbortController();this._techniqueRepository=c;this._atmosphereTechniqueConfig=new t.SimpleAtmosphereTechniqueConfiguration;this.view=a}Object.defineProperty(b.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});b.prototype.when=function(a){return f(this,void 0,void 0,function(){return l(this,
function(c){switch(c.label){case 0:return[4,this._readyResolver.promise];case 1:return c.sent(),a(),[2]}})})};b.prototype.initializeRenderContext=function(a){var c=this,e=a.rctx;this._cameraChangeHandle=d.init(this.view,"state.camera",function(){return a.requestRender()},!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=
2;this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(t.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);this._vao=this._createRibbon(e);this._vaoCount=I.vertexCount(this._vao,"geometry");this._fadeVao=C.createQuadVAO(e);this._fadeVaoCount=I.vertexCount(this._fadeVao,"geometry");y.requestImage(x,{signal:this._readyController.signal}).then(function(d){c._texture=new J(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,
samplingMode:9729,flipped:!0},d);a.requestRender();c._readyController=null;c._readyResolver.resolve()})};b.prototype.uninitializeRenderContext=function(){this.destroy()};b.prototype.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyController&&(this._readyController.abort(),this._readyController=
null)};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);var c=a.rctx;this._atmosphereConeTechnique.bindPipelineState(c);if(1>this._renderData.undergroundFadeAlpha){var d=this._atmosphereConeTechnique.program;c.bindProgram(d);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);
d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);c.bindTexture(this._texture,0);d.setUniform1i("tex",0);a.scenelightingData.setLightDirectionUniform(d);d.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.setUniform1f("innerScale",this._renderData.innerScale);c.bindVAO(this._vao);c.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(d=this._atmosphereUndergroundTechnique.program,c.bindProgram(d),d.setUniform1f("undergroundFadeAlpha",
this._renderData.undergroundFadeAlpha),a.scenelightingData.setLightDirectionUniform(d),d.setUniform3fv("cameraPosition",a.camera.eye),c.bindVAO(this._fadeVao),c.drawArrays(5,0,this._fadeVaoCount));return!0};b.prototype._update=function(d){var e=p.vec3f64.create(),b=v.earthRadius,g=r.vec3.length(d.eye),k=g-b;this._renderData.undergroundFadeAlpha=0>k?Math.min(-k/5E3,1):0;var m=b+P,f=b+Math.max(50,k);this._renderData.innerScale=f*f/(Math.sqrt(f*f-b*b)*Math.sqrt(f*f-m*m)+b*m)-1;this._renderData.altitudeFade=
u.computeInnerAltitudeFade(k);r.vec3.scale(e,d.eye,(b+50)/g);H(e,d.center,d.up,b,this._renderData);e=L(d,e,d.up,this._renderData);g=Q(k);m=.001953125;f=0+e*g*1;50<k&&(H(d.eye,d.center,d.up,b,this._renderData),d=L(d,d.eye,d.up,this._renderData),d=h.clamp((d-1.5)/(e-1.5),0,1),m=0+.001953125*d,f=0+1*a.lerp(1,e*g,d));c.vec2.set(this._renderData.texV,m,f)};b.prototype._createRibbon=function(a){var c=new Float32Array(1155),d=new Uint32Array(1920);c[0]=0;c[1]=0;c[2]=-1;for(var e=0;128>e;e++){var b=9*e+3;
c[b+0]=e;c[b+1]=S;c[b+2]=-1;c[b+3]=e;c[b+4]=R;c[b+5]=0;c[b+6]=e;c[b+7]=O;c[b+8]=1;var b=3*e+1,g=127===e?1:b+3,k=15*e;d[k+0]=b;d[k+1]=b+1;d[k+2]=g+1;d[k+3]=g+1;d[k+4]=g;d[k+5]=b;d[k+6]=b+1;d[k+7]=b+2;d[k+8]=g+2;d[k+9]=g+2;d[k+10]=g+1;d[k+11]=b+1;d[k+12]=b;d[k+13]=g;d[k+14]=0}b=Z.createBuffer(d.length);g=b.position;for(e=0;e<d.length;++e)k=3*d[e],g.set(e,0,c[k]),g.set(e,1,c[k+1]),g.set(e,2,c[k+2]);return new K(a,B.Default3D,{geometry:w.glLayout(Z)},{geometry:G.createVertex(a,35044,b.buffer)})};return b}();
var T=n.mat4f64.create(),Y=p.vec3f64.create(),N=p.vec3f64.create(),Z=A.newLayout().vec3f("position");return q})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});b.createQuadVAO=function(a,b,n){void 0===b&&(b=f.Pos2);void 0===n&&(n=l.Default3D);
var c=null;switch(b){case f.Pos3Tex:c=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case f.Pos3:c=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case f.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new e(a,n,{geometry:b},{geometry:h.createVertex(a,35044,c)})};b.createEmptyTexture=function(d,e){void 0===e&&(e=4);return new a(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,
width:e,height:e})};b.createColorTexture=function(d,e,b){void 0===b&&(b=4);for(var c=new Uint8Array(b*b*4),g=0;g<c.length;g+=4)c[g+0]=255*e[0],c[g+1]=255*e[1],c[g+2]=255*e[2],c[g+3]=255*e[3];return new a(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:b,height:b},c)};b.createEmptyDepthTexture=function(d){return new a(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,
normalized:!1}];b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){var y=d.getLogger("esri.views.3d.environment.Stars");b=function(){function d(a){this.slot=12;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this._loadDataController=k.createAbortController();this._numStars=0;this._modelMatrix=g.mat4f64.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}Object.defineProperty(d.prototype,"canRender",{get:function(){return null!=this._vao},enumerable:!0,configurable:!0});d.prototype.destroy=
function(){this._loadDataController&&(this._loadDataController.abort(),this._loadDataController=null);this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._vao&&(this._vao.dispose(),this._vao=null)};d.prototype.initializeRenderContext=function(a){var c=this;this._initContext=a;var d=a.rctx;this._starsTechnique=new r.StarsTechnique({rctx:d,viewingMode:"local"===this.view.viewingMode?1:0},null);this._dateHandle=n.init(this.view,"environment.lighting.date",function(a){return c._update(a)});
this._loadDataPromise.then(function(){c._numStars=c._starData.byteLength/c.bytesPerStar;var e=new Float32Array(c._starData,0,c._numStars*c.numBinaryFloats),b=new Uint8Array(c._starData,c._numStars*c.numBinaryFloats*4,c._numStars*c.numBinaryUInt8);c._vao=c._createVertexArrayObject(d,e,b);a.requestRender()})};d.prototype.uninitializeRenderContext=function(){this.destroy()};d.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass)return!1;var c=a.rctx,d=this._starsTechnique.program;c.bindProgram(d);
this._starsTechnique.bindPass(c,a.camera);d.setUniformMatrix4fv("model",this._modelMatrix);this._starsTechnique.bindPipelineState(c);c.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(0,0,this._numStars);return!0};d.prototype._computeDayDuration=function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),d=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+c)/(+d-+c)};d.prototype._update=function(a){if(a){var d=a.getHours()/12,e=a.getMinutes()/60*(2/24),b=a.getSeconds()/
60*(2/1440),d=(d+e+b-.9972222)%2;a=2*this._computeDayDuration(a);e=this._modelMatrix;c.mat4.copy(e,A);c.mat4.rotateZ(e,e,-a*Math.PI);c.mat4.multiply(e,w,e);c.mat4.rotateZ(e,e,-d*Math.PI);this._initContext.requestRender()}};d.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};d.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=
a?[.7,a-32]:[.4,a]};d.prototype._createVertexArrayObject=function(a,c,d){for(var e=B.createBuffer(this._numStars),b=e.position,g=e.color,k=e.size,f=0;f<this._numStars;f++){var h=c[2*f+0],n=c[2*f+1];b.set(f,0,-Math.cos(h)*Math.sin(n));b.set(f,1,-Math.sin(h)*Math.sin(n));b.set(f,2,-Math.cos(n));h=this._unpackUint8Attributes(d[f]);n=this._hexToRGB(m[h[1]]);g.set(f,0,255*n[0]);g.set(f,1,255*n[1]);g.set(f,2,255*n[2]);g.set(f,3,255);k.set(f,h[0])}return new v(a,t.Default3D,{geometry:p.glLayout(B)},{geometry:x.createVertex(a,
35044,e.buffer)})};d.prototype._verifyStartData=function(a){if(!a)throw new e("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new e("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};d.prototype._loadBrightStarCatalogue=function(){return f(this,void 0,void 0,function(){var c,d,e;return l(this,function(b){switch(b.label){case 0:return C?(this._starData=C,[2]):[4,
a.result(h(q.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",signal:this._loadDataController.signal}))];case 1:c=b.sent();this._loadDataController=null;if(!1===c.ok){if(k.isAbortError(c.error))throw c.error;y.error("loadBrightStarCatalogue",c.error.message);return[2]}d=c.value;e=d.data;try{this._verifyStartData(e)}catch(H){throw y.error("loadBrightStarCatalogue",H),H;}this._starData=C=e;return[2]}})})};return d}();var m="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
w=g.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),A=g.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),B=u.newLayout().vec3f("position").vec4u8("color").f32("size"),C=null;return b})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../environment/Stars.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});f=function(d){function b(){return null!==d&&d.apply(this,arguments)||this}l(b,d);b.prototype.initializeProgram=function(a){var c=b.shader.get().build();return new n(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),k.Default3D)};b.prototype.initializePipeline=function(){return c.makePipelineState({blending:c.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:c.defaultColorWriteParams})};
b.prototype.bindPass=function(a,c){this.program.setUniformMatrix4fv("view",c.viewMatrix);this.program.setUniformMatrix4fv("proj",c.projectionMatrix);this.program.setUniform4fv("viewport",c.fullViewport);this.program.setUniform1f("pixelRatio",c.pixelRatio)};b.prototype.setUniforms=function(a){this.program.setUniformMatrix4fv("view",a.camera.viewMatrix);this.program.setUniformMatrix4fv("proj",a.camera.projectionMatrix);this.program.setUniform4fv("viewport",a.camera.fullViewport);this.program.setUniform1f("pixelRatio",
a.camera.pixelRatio)};b.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};b.shader=new e.ReloadableShaderModule(a,"../shaders/Stars.glsl",q);return b}(d.ShaderTechnique);b.StarsTechnique=f})},"esri/views/3d/environment/Stars.glsl":function(){define("require exports ../../../core/tsSupport/makeTemplateObjectHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var c=new d.ShaderBuilder;c.attributes.add("position","vec3");c.attributes.add("color","vec4");c.attributes.add("size","float");c.varyings.add("vcolor","vec4");c.varyings.add("vsize","float");c.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("viewport","vec4").add("pixelRatio","float");c.include(a.AlignPixel);c.vertex.code.add(e.glsl(k||(k=l(["\n    void main(void) {\n      vec4 posProj \x3d proj * view * model * vec4(position * 1.0e25, 1.0); // move infinitely far away\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); // pixel align position\n      gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "],
["\n    void main(void) {\n      vec4 posProj \x3d proj * view * model * vec4(position * 1.0e25, 1.0); // move infinitely far away\n      gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); // pixel align position\n      gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\n      vcolor \x3d color / 1.2;\n      vsize \x3d size * 5.0 * pixelRatio;\n      gl_PointSize \x3d vsize;\n    }\n  "]))));c.fragment.code.add(e.glsl(n||(n=l(["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(1.0, 1.0, 1.0, intensity);\n      gl_FragColor.xyz *\x3d vcolor.xyz;\n    }\n  "],
["\n    void main() {\n      float cap \x3d 0.7;\n      float scale \x3d 1.0 / cap;\n      float helper \x3d clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);\n      float alpha \x3d clamp((cap - helper) * scale, 0.0, 1.0);\n      float intensity \x3d alpha * alpha * alpha;\n      if (vsize \x3c 3.0) {\n        intensity *\x3d 0.5;\n      }\n      gl_FragColor \x3d vec4(1.0, 1.0, 1.0, intensity);\n      gl_FragColor.xyz *\x3d vcolor.xyz;\n    }\n  "]))));return c};var k,n})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.AlignPixel=function(e){var d=f.glsl(h||(h=l(["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "]))),b=f.glsl(a||(a=l(["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "],
["\n\n    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\n      vec2 xy \x3d vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\n      vec2 pixelSz \x3d vec2(1.0) / widthHeight;\n      vec2 ij \x3d floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\n      vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\n      return vec4(result, clipCoord.zw);\n    }\n  "])));e.vertex.code.add(d);e.vertex.code.add(b);e.fragment.code.add(d);e.fragment.code.add(b)};var h,a})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,c,d,e){for(var b=[],g=0;g<d.length;g++)b[g]=(e[g]-d[g])*a/c+d[g];return b}Object.defineProperty(b,"__esModule",{value:!0});b.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};b.computeColorAndIntensity=function(c,f){var h,p,n,
r,y=f[2],m=g;a.vec3.set(m.ambient.color,1,1,1);m.ambient.intensity=b.settings.global.ambient;a.vec3.set(m.diffuse.color,1,1,1);m.diffuse.intensity=b.settings.global.diffuse;y=(Math.abs(y)-b.settings.local.altitude)/(b.settings.global.altitude-b.settings.local.altitude);y=l.clamp(y,0,1);m.globalFactor=y;f=d.getTimes(c,f[1],f[0]);if(1>y){n=c.valueOf();var w,A;f.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?(w=n-36E5*(c.getHours()+48)-6E4*c.getMinutes(),A=w+432E6):f.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?
(w=n-2,A=n-1):(w=f.sunrise.valueOf(),A=f.sunset.valueOf());var B=A-w;r=w+B/2;p=B/4;h=r-p;p=r+p;var C=.06*B,B=w-C/2;w+=C/2;var E=A-C/2,G=A+C/2;A=b.settings.local;var J=[.01,A.ambientAtNight],I=[.8,.8,1],K=[.01,.01,.01],H=[A.diffuseAtTwilight,A.ambientAtTwilight],L=[1,.75,.75],P=[.8,.8,1],S=[.9*A.diffuseAtNoon,A.ambientAtNoon],R=[1,.98,.98],O=[.98,.98,1],Q=[A.diffuseAtNoon,A.ambientAtNoon],T=[1,1,1],q=[1,1,1];A=[0,0];var N=[0,0,0],C=[0,0,0];n<B||n>G?(A=J,N=K,C=I):n<w?(C=w-B,A=k(n-B,C,J,H),N=k(n-B,C,
K,L),C=k(n-B,C,I,P)):n<h?(C=h-w,A=k(n-w,C,H,S),N=k(n-w,C,L,R),C=k(n-w,C,P,O)):n<r?(C=r-h,A=k(n-h,C,S,Q),N=k(n-h,C,R,T),C=k(n-h,C,O,q)):n<p?(C=p-r,A=k(n-r,C,Q,S),N=k(n-r,C,T,R),C=k(n-r,C,q,O)):n<E?(C=E-p,A=k(n-p,C,S,H),N=k(n-p,C,R,L),C=k(n-p,C,O,P)):n<G&&(C=G-E,A=k(n-E,C,H,J),N=k(n-E,C,L,K),C=k(n-E,C,P,I));n=A[0];r=e.vec3f64.fromValues(N[0],N[1],N[2]);h=A[1];p=e.vec3f64.fromValues(C[0],C[1],C[2]);a.vec3.lerp(m.ambient.color,p,m.ambient.color,y);m.ambient.intensity=l.lerp(h,m.ambient.intensity,y);a.vec3.lerp(m.diffuse.color,
r,m.diffuse.color,y);m.diffuse.intensity=l.lerp(n,m.diffuse.intensity,y)}y=c.valueOf();f.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?(c=y-36E5*(c.getHours()+48)-6E4*c.getMinutes(),f=c+432E6):f.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?(c=y-2,f=y-1):(c=f.sunrise.valueOf(),f=f.sunset.valueOf());c=1-l.clamp(Math.abs(y-(c+(f-c)/2))/432E5,0,1);m.noonFactor=c;return m};b.computeDirection=function(g,k,h,t){t||(t=e.vec3f64.create());var p=c,r=f.mat4.identity(n);if("global"===h)d.getPosition(g,0,
0,p),a.vec3.set(t,0,0,-1),f.mat4.rotateX(r,r,-p.azimuth),f.mat4.rotateY(r,r,-p.altitude);else{var u=b.settings.planarDirection;h=u.globalAngles;u=(Math.abs(k[2])-u.localAltitude)/(u.globalAltitude-u.localAltitude);u=l.clamp(u,0,1);1>u?(d.getPosition(g,k[1],k[0],p),p.azimuth=(1-u)*p.azimuth+u*h.azimuth,p.altitude=(1-u)*p.altitude+u*h.altitude):(p.azimuth=h.azimuth,p.altitude=h.altitude);a.vec3.set(t,0,-1,0);f.mat4.rotateZ(r,r,-p.azimuth);f.mat4.rotateX(r,r,-p.altitude)}a.vec3.transformMat4(t,t,r);
return t};b.computeShadowsEnabled=function(a,c){return"global"===c?!0:Math.abs(a[2])<b.settings.planarDirection.localAltitude};var n=h.mat4f64.create(),c={azimuth:0,altitude:0},g={ambient:{color:e.vec3f64.create(),intensity:0},diffuse:{color:e.vec3f64.create(),intensity:0,direction:e.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function q(a){return new Date(864E5*(a+.5-2440588))}function b(a,d){return u(c(a)*g(y)-r(d)*c(y),g(a))}function l(a,
d){return p(c(d)*g(y)+g(d)*c(y)*c(a))}function f(a,d,e){return u(c(a),g(a)*c(d)-r(e)*g(d))}function h(a,d,e){return p(c(d)*c(e)+g(d)*g(e)*g(a))}function a(a){return x*(1.9148*c(a)+.02*c(2*a)+3E-4*c(3*a))}function e(c,d){c=x*(357.5291+.98560028*c);var e=a(c);c=c+e+102.9372*x+n;d||(d={dec:0,ra:0});d.dec=l(c,0);d.ra=b(c,0);return d}function d(a,d,e){return 2451545+a+.0053*c(d)-.0069*c(2*e)}function k(a){var d=x*(134.963+13.064993*a),e=x*(93.272+13.22935*a);a=x*(218.316+13.176396*a)+6.289*x*c(d);e=5.128*
x*c(e);d=385001-20905*g(d);return{ra:b(a,e),dec:l(a,e),dist:d}}var n=Math.PI,c=Math.sin,g=Math.cos,r=Math.tan,p=Math.asin,u=Math.atan2,t=Math.acos,x=n/180,v={dec:0,ra:0},y=23.4397*x,m={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,d,b){d=x*-d;c*=x;var g=a.valueOf()/864E5-.5+2440588-2451545;a=e(g,v);d=x*(280.16+360.9856235*g)-d-a.ra;b||(b={azimuth:0,altitude:0});b.azimuth=f(d,c,a.dec);b.altitude=h(d,c,a.dec);return b}},w=[[-.83,"sunrise","sunset"]];m.addTime=function(a,
c,d){w.push([a,c,d])};m.getTimes=function(e,b,k){function f(a){var e=p,b=y;a=t((c(a)-c(e)*c(b))/(g(e)*g(b)));return d(9E-4+(a+h)/(2*n)+r,v,u)}var h=x*-k,p=x*b,r=Math.round(e.valueOf()/864E5-.5+2440588-2451545-9E-4-h/(2*n));e=9E-4+(0+h)/(2*n)+r;var v=x*(357.5291+.98560028*e);b=a(v);var u=v+b+102.9372*x+n,y=l(u,0);e=d(e,v,u);b={solarNoon:q(e),nadir:q(e-.5),polarException:m.POLAR_EXCEPTION.NORMAL};var A,B,C,O;k=0;for(A=w.length;k<A;k+=1)B=w[k],C=f(B[0]*x),O=e-(C-e),b[B[1]]=q(O),b[B[2]]=q(C);b.polarException=
function(a){a=(c(a)-c(p)*c(y))/(g(p)*g(y));return-1>a?m.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?m.POLAR_EXCEPTION.POLAR_NIGHT:m.POLAR_EXCEPTION.NORMAL}(w[0][0]*x);return b};m.getMoonPosition=function(a,c,d){d=x*-d;c*=x;var e=a.valueOf()/864E5-.5+2440588-2451545;a=k(e);d=x*(280.16+360.9856235*e)-d-a.ra;e=h(d,c,a.dec);e+=.017*x/r(e+10.26*x/(e+5.1*x));return{azimuth:f(d,c,a.dec),altitude:e,distance:a.dist}};m.getMoonFraction=function(a){var d=a.valueOf()/864E5-.5+2440588-2451545;a=e(d);d=k(d);a=t(c(a.dec)*
c(d.dec)+g(a.dec)*g(d.dec)*g(a.ra-d.ra));a=u(149598E3*c(a),d.dist-149598E3*g(a));return(1+g(a))/2};return m})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(b,h,a){void 0===b&&(b=l.vec3f64.create());void 0===h&&(h=l.vec3f64.fromValues(.57735,.57735,.57735));void 0===a&&(a=!0);this.intensity=b;this.direction=h;this.castShadows=
a}}();b.MainLight=q;q=function(){return function(b,h){void 0===b&&(b=l.vec3f64.create());void 0===h&&(h=l.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=l.vec3f64.create();this.direction=l.vec3f64.create();this.intensity=b;this.direction=h}}();b.FillLight=q;q=function(){return function(b){void 0===b&&(b=l.vec3f64.create());this.intensity=b}}();b.AmbientLight=q;q=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();b.SphericalHarmonicsLight=q})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G){q=function(b){function h(){var c=null!==b&&b.apply(this,arguments)||this;c._handles=new a;return c}l(h,b);h.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(h.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});h.prototype.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};h.prototype.connect=function(){var a=this,d=this.view;
this._source=new m.BrowserEventSource(this.view.surface,d.input);var b=[new C.PointerClickHoldAndDrag,new E.SingleAndDoubleClick,new B.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=b=new w.InputManager({eventSource:this._source,recognizers:b});b.installHandlers("prevent-context-menu",[new A.PreventContextMenu],w.ViewEventPriorities.INTERNAL);this._modeDragPan=new u.PinchAndPanNavigation(d,"primary");this._modeDragRotate=new n.DragRotate(d,"secondary","center");this._modeDragZoom=
new c.DragZoom(d,"tertiary");b.installHandlers("navigation",[new t.PointerDownCancelAnimation(d),new k.DoubleClickZoom(d),new g.GamepadNavigation(d),new r.KeyboardNavigation(d,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s"}),new p.MouseWheelZoom(d),new v.SingleKeyResetTilt(d,"p"),new x.SingleKeyResetHeading(d,"n"),new n.DragRotate(d,"primary","eye",["b"]),new n.DragRotate(d,"secondary","center",["b"]),
new u.PinchAndPanNavigation(d,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new y.TwoFingerTilt(d)],w.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(b);this._updateMode();e.init(this.view.navigation,"browserTouchPanEnabled",function(c){a._source.browserTouchPanningEnabled=!c})};h.prototype._updateMode=function(){var a=this.primaryDragAction,a=J.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=
a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(h.prototype,"test",{get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}},enumerable:!0,configurable:!0});f([d.property()],h.prototype,"view",void 0);f([d.property({value:"pan"})],h.prototype,"primaryDragAction",null);f([d.property({value:"default"})],h.prototype,"mode",null);f([d.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],
h.prototype,"hasPendingInputs",void 0);f([d.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],h.prototype,"latestPointerType",void 0);f([d.property()],h.prototype,"_inputManager",void 0);return h=f([d.subclass("esri.views.3d.input.SceneInputManager")],h)}(d.declared(h));var J=new Map;b=new Map;h=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});h.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});
h.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});J.set("default",b);J.set("pro",h);return q})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});
q=function(e){function b(a,d){var c=e.call(this,!0)||this;c.view=a;c.registerIncoming("double-click",d,function(a){return c.handleDoubleClick(a)});return c}l(b,e);b.prototype.handleDoubleClick=function(c){var e=c.data;if(d.eventMatchesPointerAction(e,"primary")){var b=this.view.state.isGlobal?new h.ZoomStepController(this.view,"animation"):new a.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(b);b.zoomStep(Math.log(.5)/Math.log(.6),f.createScreenPointArray(e.x,e.y));
c.stopPropagation()}};return b}(e.InputHandler);b.DoubleClickZoom=q})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(e){function b(a,d){d=e.call(this,a.state,a.sceneIntersectionHelper,d)||this;d.view=a;d.zoomLocation=h.vec3f64.create();d.tmpCamera=new n.default;d.tmpViewDir=h.vec3f64.create();d.targetOnSphere=h.vec3f64.create();d.tmpCenter=h.vec3f64.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new n.default,interactionDirection:null,tiltMode:0};d.sphere=k.sphere.create();
d.intersector=new c(a.viewingMode);return d}l(b,e);b.prototype.zoomStep=function(a,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:f.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:g.outExpo}};b.prototype.updateCamera=function(c,e,b,g){this.sphere.radius=f.vec3.length(b);f.vec3.subtract(this.tmpViewDir,c.center,c.eye);var h=f.vec3.length(this.tmpViewDir),m=h*e;1>=e&&4>m&&(m=4,
e=m/h);1E-6>Math.abs(h-m)||(h=f.vec3.length(c.center),this.sphere.radius!==h&&f.vec3.scale(c.center,c.center,(this.sphere.radius+e*(h-this.sphere.radius))/h),f.vec3.scale(this.tmpViewDir,this.tmpViewDir,-e),f.vec3.add(c.eye,c.center,this.tmpViewDir),a.applyAll(this.view,c,this.constraintOptions),1E-12<f.vec3.squaredDistance(b,c.center)&&k.sphere.intersectScreen(this.sphere,c,g,this.targetOnSphere)&&d.panToPosition(this.sphere,c,b,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,
!0),a.applySurfaceCollisionConstraint(this.view,c))};return b}(e.PointToPointAnimationController);b.ZoomStepController=q})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=n.applyTiltConstraint;b.getTiltConstraintError=n.getTiltConstraintError;b.applyAltitudeConstraint=c.applyAltitudeConstraint;b.getAltitudeConstraintError=c.getAltitudeConstraintError;b.applyDistanceConstraint=g.applyDistanceConstraint;b.getDistanceConstraintError=g.getDistanceConstraintError;b.applySurfaceCollisionConstraint=r.applySurfaceCollisionConstraint;b.applyAll=function(a,c,d,b){void 0===
d&&(d=u);void 0===b&&(b=c);var g=!1;b!==c&&b.copyFrom(c);b.markViewDirty();b.computeUp(a.state.mode);for(c=0;c<t;c++){for(var k=0,m=0,f=p;m<f.length;m++){var n=f[m];if(h.hasConstraintType(d.selection,n.type)){var r=Math.abs(n.error(a,b,d));n.apply(a,b,d)&&(g=!0,k+=r)}}if(0===k)break}c=h.hasConstraintType(d.selection,8);a:switch(d.interactionType){case 4:d=1;break a;case 5:d=a.state.isGlobal?2:1;break a;default:d=0}c&&e.applySurfaceCollisionConstraint(a,b,d)&&(g=!0);g&&b.computeUp(a.state.mode);return g};
b.pixelDistanceToInteractionFactor=function(a,c){a="number"===typeof a?a:l.vec2.distance(a,c);return k.inOutCubic(Math.min(1,a/150))};var p=[{type:1,error:function(a,c,e){return d.getTiltConstraintError(a,c,e)*c.distance},apply:d.applyTiltConstraint},{type:2,error:f.getAltitudeConstraintError,apply:f.applyAltitudeConstraint},{type:4,error:a.getDistanceConstraintError,apply:a.applyDistanceConstraint}],u={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0},t=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils".split(" "),function(q,b,l,f,h,a,e,d){function k(d,e,b){void 0===b&&(b=a.defaultApplyOptions);var g;g=d.state.constraints.altitude;g=d.state.isGlobal&&g?2===b.interactionType&&a.hasConstraintType(b.selection,1)?!1:!0:!1;if(!g)return 0;
var f=d.state.constraints.altitude;g=c;g.min=f.min;g.max=f.max;var m=b.interactionType;if(0!==m){var f=g.min,h=g.max,p=b.interactionStartCamera;b=b.interactionFactor;var m=2===m||1===m,n=k(d,p),p=0===n?0:d.renderCoordsHelper.getAltitude(p.eye);g.min=f;g.max=h;a.adjustRangeForInteraction(n,p,m,b,.05*p,g)}d=d.renderCoordsHelper.getAltitude(e.eye);d=l.clamp(d,g.min,g.max)-d;return 1E-6>=Math.abs(d)?0:d}function n(a,c,d,e){a.renderCoordsHelper.worldUpAtPosition(c.eye,e);f.vec3.scale(e,e,d);return e}Object.defineProperty(b,
"__esModule",{value:!0});b.applyAltitudeConstraint=function(c,b,h){void 0===h&&(h=a.defaultApplyOptions);var t=k(c,b,h);if(0===t)return!1;var u=c.renderCoordsHelper,m=u.getAltitude(b.eye)+t;c=a.interactionDirectionTowardsConstraintMinimization(b,h.interactionDirection,n(c,b,l.sign(t),r),g);h=f.vec3.copy(p,b.viewForward);u.intersectInfiniteManifold(e.ray.wrap(b.eye,c),m,b.eye)||u.setAltitude(m,b.eye);d.closestPointOnRay(b.eye,h,b.center,b.center);b.markViewDirty();return!0};b.getAltitudeConstraintError=
k;var c={min:0,max:0},g=h.vec3f64.create(),r=h.vec3f64.create(),p=h.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.hasConstraintType=function(b,a){return 0!==(b&a)};b.adjustRangeForInteraction=function(b,a,e,d,k,f){0!==b&&(e?(f.min=Math.min(f.min,a),f.max=Math.max(f.max,a)):null!=d?(f.min-=Math.max(0,(a-
f.min)*(1-d)),f.max+=Math.max(0,(a-f.max)*(1-d))):k&&(f.min-=Math.max(0,a-f.min-k),f.max+=Math.max(0,a-f.max-k)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.interactionDirectionTowardsConstraintMinimization=function(b,a,e,d){a=a||b.viewForward;f.vec3.copy(d,a);f.vec3.scale(d,d,l.sign(f.vec3.dot(a,e)));return d}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64",
"../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l,f,h){function a(a,c,d,e){var b=k;a?(d&&e&&(b.len=f.vec3.distance(c,d)),f.vec3.copy(b.dir,a)):e?(b.len=f.vec3.distance(c,d),f.vec3.subtract(b.dir,d,c),f.vec3.scale(b.dir,b.dir,1/b.len)):(f.vec3.subtract(b.dir,d,c),f.vec3.normalize(b.dir,b.dir));return b}function e(a,c){return-f.vec3.dot(c,a)-a[3]}function d(a,c,d,b){b.clip[0]=0;b.clip[1]=d?b.len:Number.MAX_VALUE;for(d=0;d<a.length;d++){var g;var k=a[d],h=
c;g=b;var n=f.vec3.dot(k,g.dir),k=e(k,h);0>k&&0<=n?g=!1:-1E-6<n&&1E-6>n?g=0<k:!(0>k||0>n)||0>k&&0>n?(k/=n,0<n?k<g.clip[1]&&(g.clip[1]=k):k>g.clip[0]&&(g.clip[0]=k),g=g.clip[0]<=g.clip[1]):g=!0;if(!g)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.planeSphere=function(a,c,d){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]<d};b.frustumSphere=function(a,c,d){var e=c[0],b=c[1];c=c[2];return a[0][0]*e+a[0][1]*b+a[0][2]*c+a[0][3]>d||a[1][0]*e+a[1][1]*b+a[1][2]*c+a[1][3]>d||a[2][0]*e+a[2][1]*
b+a[2][2]*c+a[2][3]>d||a[3][0]*e+a[3][1]*b+a[3][2]*c+a[3][3]>d||a[4][0]*e+a[4][1]*b+a[4][2]*c+a[4][3]>d||a[5][0]*e+a[5][1]*b+a[5][2]*c+a[5][3]>d?!1:!0};b.frustumRay=function(e,c,b,k){b=a(k,c,b,!1);return d(e,c,null,b)};b.frustumPoint=function(a,c){for(var d=0;6>d;d++)if(0>e(a[d],c))return!1;return!0};b.frustumLineSegment=function(e,c,b,k){k=a(k,c,b,!0);return d(e,c,b,k)};b.closestPointOnRay=function(a,c,d,e){d=f.vec3.dot(c,f.vec3.subtract(e,d,a));f.vec3.add(e,a,f.vec3.scale(e,c,d));return e};var k=
{dir:h.vec3f64.create(),len:0,clip:l.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(q,b,l,f,h,a,e){function d(a,c,e){void 0===e&&(e=h.defaultApplyOptions);if(!a.state.isLocal)return 0;var b=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===
b)return 0;k.min=0;k.max=b;var b=k,g=e.interactionType;if(0!==g){var f=b.min,m=b.max,p=e.interactionStartCamera;e=e.interactionFactor;var g=1===g||4===g,n=d(a,p),p=0===n?0:l.vec3.distance(p.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);b.min=f;b.max=m;h.adjustRangeForInteraction(n,p,g,e,.05*p,b)}a=l.vec3.distance(c.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);a=k.max-a;return-1E-6<=a?0:a}Object.defineProperty(b,"__esModule",{value:!0});b.getDistanceConstraintError=d;b.applyDistanceConstraint=
function(b,k,f){void 0===f&&(f=h.defaultApplyOptions);var p=d(b,k,f);if(0===p)return!1;var t=b.pointsOfInterest.surfaceOrigin,p=l.vec3.distance(k.eye,b.pointsOfInterest.surfaceOrigin.renderLocation)+p,u=l.vec3.copy(n,k.eye);f=h.interactionDirectionTowardsConstraintMinimization(k,f.interactionDirection,e.directionFromTo(r,k.eye,b.pointsOfInterest.surfaceOrigin.renderLocation),g);return a.sphere.intersectRay(a.sphere.wrap(p,t.renderLocation),a.ray.wrap(k.eye,f),k.eye)?(t=l.vec3.subtract(c,k.eye,u),
l.vec3.add(k.center,k.center,t),k.markViewDirty(),t=b.renderCoordsHelper.getAltitude(k.center),b.renderCoordsHelper.intersectInfiniteManifold(k.ray,t,k.center),k.markViewDirty(),!0):!1};var k={min:0,max:0},n=f.vec3f64.create(),c=f.vec3f64.create(),g=f.vec3f64.create(),r=f.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(q,
b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.applySurfaceCollisionConstraint=function(e,d,b){void 0===b&&(b=0);var k=e.state.constraints;if(!k.collision.enabled)return!1;var c=h.surfaceElevationBelowEye(e,d),g=e.renderCoordsHelper.getAltitude(d.eye),k=c+k.collision.elevationMargin;if(g>=k)return!1;c=l.vec3.length(d.eye);l.vec3.subtract(a,d.center,d.eye);e.renderCoordsHelper.setAltitude(k,d.eye);1===b?l.vec3.add(d.center,d.eye,a):2===b&&l.vec3.scale(d.center,d.center,(c-g+k)/c);d.markViewDirty();
return!0};var a=f.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(q,b,l,f,h,a,e){function d(a,c){return a.basemapTerrain?a.basemapTerrain.getElevation(c[0],c[1],c[2],a.renderCoordsHelper.spatialReference)||0:0}function k(a,c,e){if(!a.state.isGlobal)return!1;var b=
d(a,c);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(c,e,a.dataExtent,b,u).far;a*=a;return l.vec3.squaredDistance(c,e)>a}function n(d,b,g){void 0===g&&(g=f.vec3f64.create());var h=c[d.viewingMode];h||(h=new e(d.viewingMode),h.options.backfacesTerrain=!d.state.isGlobal,h.options.invisibleTerrain=!0,c[d.viewingMode]=h);var m=d.state.isGlobal;return d.sceneIntersectionHelper.intersectRay(b,h,g)&&!k(d,b.origin,g)?!0:!d.renderCoordsHelper.intersectManifold(b,0,g)||k(d,b.origin,g)?m?(d=g,
g=l.vec3.dot(b.origin,b.origin)-a.earthRadius*a.earthRadius,l.vec3.scale(d,b.direction,(0<g?Math.sqrt(g)/3:1)/l.vec3.length(b.direction)),l.vec3.add(d,d,b.origin),!0):!1:!0}Object.defineProperty(b,"__esModule",{value:!0});b.eyeWithinExtent=function(a,c,d,e){return a.renderCoordsHelper.fromRenderCoords(c.eye,g,e)&&h.containsPoint(d,g)};b.surfaceElevationBelowEye=function(a,c){return d(a,c.eye)};b.cameraOnContentAlongViewDirection=function(a,c,d,e){var b=a.state.camera.clone();c&&(b.eye=c);d&&(b.center=
d);e&&(b.up=e);n(a,b.ray,r)||l.vec3.copy(r,b.center);d=a.state.constraints;e=d.minimumPoiDistance;l.vec3.squaredDistance(b.eye,r)<e&&(c=d.collision.enabled,l.vec3.copy(p,b.viewForward),l.vec3.scale(p,p,e),c?l.vec3.subtract(b.eye,r,p):l.vec3.add(r,b.eye,p),a=a.renderCoordsHelper,e=a.getAltitude(b.eye),d=d.collision.elevationMargin,c&&e<d&&(l.vec3.subtract(p,r,b.eye),a.setAltitude(d,b.eye),l.vec3.add(r,b.eye,p)));b.center=r;return b};var c={},g=f.vec3f64.create(),r=f.vec3f64.create(),p=f.vec3f64.create(),
u={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/maybe ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),function(q,b,l,f,h,a,e,d,k,n){return function(){function c(a){this.options=new n.IntersectorOptions;this.results=new n.IntersectorResults;this.transform=new n.IntersectorTransform;
this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this._ray={origin:d.vec3f64.create(),direction:d.vec3f64.create()};this._rayEndPoint=d.vec3f64.create();this._rayStartPointTransformed=d.vec3f64.create();this._rayEndPointTransformed=d.vec3f64.create();this.viewingMode=a||"global"}Object.defineProperty(c.prototype,"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});c.prototype.reset=function(a,c){this.resetWithRay(k.ray.fromPoints(a,c,this._ray))};c.prototype.resetWithRay=function(a){a!==this._ray&&k.ray.copy(a,this._ray);e.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};c.prototype.intersect=function(a,c,d,e,b,k){var g=this;this.point=
c;this.camera=d;this.filterPredicate=b;this.tolerance=null==e?1E-5:e;c=f.isSome(this.options.verticalOffset)?this.options.verticalOffset.object3D:null;d=k?function(a){k(a)&&g.intersectObject(a)}:function(a){g.intersectObject(a)};if(a&&0<a.length)for(e=0;e<a.length;e++){b=a[e];var h=b.getSpatialQueryAccelerator?b.getSpatialQueryAccelerator():void 0;if(h)c?h.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,d,c):h.forEachAlongRay(this._ray.origin,this._ray.direction,d),this.options.selectionMode&&
this.options.hud&&h.forEachDegenerateObject(d);else for(h=0,b=b.getObjects();h<b.length;h++)d(b[h])}this.sortResults()};c.prototype.intersectObject=function(c){var d=this;this._numObjectsTested++;var b=c.geometryRecords;if(b)for(var g=c.id,k=c.objectTransformation,h,v=f.isSome(this.options.verticalOffset)?this.options.verticalOffset.object3D:null,y=function(b){var p=b.geometry,r=b.material,w=b.instanceParameters;if(w.hidden)return"continue";h=p.id;m.transform.setAndInvalidateLazyTransforms(k,b.getShaderTransformation());
e.vec3.transformMat4(m._rayStartPointTransformed,m._ray.origin,m.transform.inverse);e.vec3.transformMat4(m._rayEndPointTransformed,m._rayEndPoint,m.transform.inverse);var t=m.transform.transform;f.isSome(v)&&(v.objectTransform=m.transform);r.intersect(p,w,m.transform.transform,m,m._rayStartPointTransformed,m._rayEndPointTransformed,function(e,b,k,m,f,p){0<=e&&(null==d.filterPredicate||d.filterPredicate(d._ray.origin,d._rayEndPoint,e))&&(f?(null==d.results.hud.dist||e<d.results.hud.dist)&&d.results.hud.set(c,
g,e,b,a.mat4f64.IDENTITY,m,p,h,k):(f=function(a){return a.set(c,g,e,b,t,m,null,h,k)},(null==d.results.min.drapedLayerOrder||m>=d.results.min.drapedLayerOrder)&&(null==d.results.min.dist||e<d.results.min.dist)&&f(d.results.min),0!==d.options.store&&(null==d.results.max.drapedLayerOrder||m<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||e>d.results.max.dist)&&f(d.results.max),2===d.options.store&&(p=new n.IntersectorResult(d._ray),f(p),d.results.all.push(p))))},b.shaderTransformation)},
m=this,w=0;w<b.length;w++)y(b[w])};c.prototype.sortResults=function(){this.results.all.sort(function(a,c){return a.dist!==c.dist?a.dist-c.dist:a.drapedLayerOrder!==c.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:Number.MAX_VALUE):(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};c.DEFAULT_TOLERANCE=1E-5;
return c}()})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ../../support/geometryUtils/sphere ./Object3D".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){function y(a,c){return l.isNone(a)||null==a.layerUid?null:l.isSome(c.graphicsView)&&a.layerUid===c.graphicsView.mockLayerId?c.graphics:c.map.findLayerByUid(a.layerUid)}function m(a,c){if(l.isNone(a))return null;var d=y(a,c);return l.isNone(d)?null:d===c.graphics?l.isSome(c.graphicsView)?l.expect(c.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(c=c.allLayerViews.find(function(a){return a.layer===d}))?w(c,a):null}function w(a,c){return!a||a.suspended?
null:"getGraphicFromIntersectorMetadata"in a&&c?a.getGraphicFromIntersectorMetadata(c):"getGraphicFromGraphicUid"in a&&null!=c.graphicUid?a.getGraphicFromGraphicUid(c.graphicUid):null}Object.defineProperty(b,"__esModule",{value:!0});b.sliceFilterPredicate=function(a){return function(c,d,e){n.vec3.lerp(J,c,d,e);return!t.extrusionContainsPoint(a,J)}};q=function(){return function(){this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeTerrainResults=this.backfacesTerrain=
!0;this.store=2}}();b.IntersectorOptions=q;q=function(){function c(){this._transform=e.mat4f64.create();this._transformInverse=new A({value:this._transform},a.mat4.invert,e.mat4f64.create);this._transformInverseTranspose=new A(this._transformInverse,a.mat4.transpose,e.mat4f64.create);this._transformTranspose=new A({value:this._transform},a.mat4.transpose,e.mat4f64.create);this._transformInverseRotation=new A({value:this._transform},f.mat3.normalFromMat4Legacy,h.mat3f64.create)}c.prototype.invalidateLazyTransforms=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(c.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});c.prototype.setTransformMatrix=function(c){a.mat4.copy(this._transform,c)};c.prototype.multiplyTransform=function(c){a.mat4.multiply(this._transform,this._transform,c)};c.prototype.set=function(c){a.mat4.copy(this._transform,
c);this.invalidateLazyTransforms()};c.prototype.setAndInvalidateLazyTransforms=function(a,c){this.setTransformMatrix(a);this.multiplyTransform(c);this.invalidateLazyTransforms()};return c}();b.IntersectorTransform=q;var A=function(){function a(a,c,d){this.original=a;this.update=c;this.dirty=!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},
enumerable:!0,configurable:!0});return a}();q=function(){function a(){this.min=new B;this.max=new B;this.hud=new B;this.terrain=new B}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.terrain.init(a);this.all=[]};return a}();b.IntersectorResults=q;var B=function(){function c(a){this.normal=g.vec3f64.create();this.transformation=e.mat4f64.create();this._ray=u.ray.create();this.init(a)}Object.defineProperty(c.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return n.vec3.scale(I,this.ray.direction,this.dist),n.vec3.length(I)},enumerable:!0,configurable:!0});c.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;n.vec3.scale(I,this.ray.direction,this.dist);n.vec3.add(a,this.ray.origin,I);
return!0};c.prototype.getTransformedNormal=function(a){n.vec3.copy(K,this.normal);K[3]=0;r.vec4.transformMat4(K,K,this.transformation);n.vec3.copy(a,K);n.vec3.normalize(a,a);return a};c.prototype.set=function(c,d,e,b,k,m,f,h,p,r){c instanceof v&&(c={type:"stage",obj:c});this.dist=e;n.vec3.copy(this.normal,b);a.mat4.copy(this.transformation,k);this.target=c;this.name=d;this.drapedLayerOrder=m;this.center=f?g.vec3f64.clone(f):null;this.geometryId=h;this.triangleNr=p;this.drapedLayerGraphicOrder=r};
c.prototype.copyFrom=function(c){u.ray.copy(c._ray,this._ray);this.dist=c.dist;this.target=c.target;this.name=c.name;this.drapedLayerOrder=c.drapedLayerOrder;this.center=c.center?g.vec3f64.clone(c.center):null;this.geometryId=c.geometryId;this.triangleNr=c.triangleNr;this.intersector=c.intersector;this.drapedLayerGraphicOrder=c.drapedLayerGraphicOrder;n.vec3.copy(this.normal,c.normal);a.mat4.copy(this.transformation,c.transformation)};c.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?u.ray.copy(a,this._ray):this._ray=u.ray.create()};c.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj.getMetadata();return y(c,a);case "external":switch(this.intersector){case "PointRenderer":return c=this.target.metadata.layerUid,null!=c?a.map.findLayerByUid(c):null;case "I3S":case "LodRenderer":case "OverlayRenderer":return y(this.target.metadata,
a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};c.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj.getMetadata();return m(c,a);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "LodRenderer":case "OverlayRenderer":return m(this.target.metadata,a)}}return null};return c}();b.IntersectorResult=B;var C=function(){function a(a){this.offset=a;
this.tmpVertex=g.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=a+this.localOrigin[0],b=c+this.localOrigin[1],g=d+this.localOrigin[2],k=this.offset/Math.sqrt(e*e+b*b+g*g);this.tmpVertex[0]=a+e*k;this.tmpVertex[1]=c+b*k;this.tmpVertex[2]=d+g*k;return this.tmpVertex};a.prototype.applyToAABB=function(a){var c=a[0]+this.localOrigin[0],d=a[1]+this.localOrigin[1],e=a[2]+this.localOrigin[2],b=a[3]+this.localOrigin[0],g=a[4]+this.localOrigin[1],k=a[5]+this.localOrigin[2],m=this.offset/Math.sqrt(c*
c+d*d+e*e);a[0]+=c*m;a[1]+=d*m;a[2]+=e*m;c=this.offset/Math.sqrt(b*b+g*g+k*k);a[3]+=b*c;a[4]+=g*c;a[5]+=k*c;return a};return a}();b.TerrainVerticalOffsetGlobalViewingMode=C;var E=function(){function a(a){this.offset=a;this.componentLocalOriginLength=0;this.tmpVertex=g.vec3f64.create();this.mbs=p.vec4f64.create();this.obb={center:g.vec3f64.create(),halfSize:c.vec3f32.create(),quaternion:null}}Object.defineProperty(a.prototype,"localOrigin",{set:function(a){this.componentLocalOriginLength=Math.sqrt(a[0]*
a[0]+a[1]*a[1]+a[2]*a[2])},enumerable:!0,configurable:!0});a.prototype.applyToVertex=function(a,c,d){var e=d+this.componentLocalOriginLength,b=this.offset/Math.sqrt(a*a+c*c+e*e);this.tmpVertex[0]=a+a*b;this.tmpVertex[1]=c+c*b;this.tmpVertex[2]=d+e*b;return this.tmpVertex};a.prototype.applyToAABB=function(a){var c=a[0],d=a[1],e=a[2]+this.componentLocalOriginLength,b=a[3],g=a[4],k=a[5]+this.componentLocalOriginLength,m=this.offset/Math.sqrt(c*c+d*d+e*e);a[0]+=c*m;a[1]+=d*m;a[2]+=e*m;c=this.offset/Math.sqrt(b*
b+g*g+k*k);a[3]+=b*c;a[4]+=g*c;a[5]+=k*c;return a};a.prototype.applyToMbs=function(a){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),d=this.offset/c;this.mbs[0]=a[0]+a[0]*d;this.mbs[1]=a[1]+a[1]*d;this.mbs[2]=a[2]+a[2]*d;this.mbs[3]=a[3]+a[3]*this.offset/c;return this.mbs};a.prototype.applyToObb=function(a){var c=a.center,e=this.offset/Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);this.obb.center[0]=c[0]+c[0]*e;this.obb.center[1]=c[1]+c[1]*e;this.obb.center[2]=c[2]+c[2]*e;n.vec3.transformQuat(this.obb.halfSize,
a.halfSize,a.quaternion);n.vec3.add(this.obb.halfSize,this.obb.halfSize,a.center);c=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*c;this.obb.halfSize[1]+=this.obb.halfSize[1]*c;this.obb.halfSize[2]+=this.obb.halfSize[2]*c;n.vec3.subtract(this.obb.halfSize,this.obb.halfSize,a.center);d.quat.conjugate(H,a.quaternion);n.vec3.transformQuat(this.obb.halfSize,
this.obb.halfSize,H);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=a.quaternion;return this.obb};return a}();b.I3SVerticalOffsetGlobalViewingMode=E;var G=function(){function a(a){this.offset=a;this.sphere=x.create();this.tmpVertex=g.vec3f64.create()}a.prototype.applyToVertex=function(a,c,d){var e=this.objectTransform.transform,b=e[0]*a+e[4]*c+e[8]*d+e[12],g=e[1]*a+e[5]*c+e[9]*
d+e[13];a=e[2]*a+e[6]*c+e[10]*d+e[14];c=this.offset/Math.sqrt(b*b+g*g+a*a);b+=b*c;g+=g*c;a+=a*c;c=this.objectTransform.inverse;this.tmpVertex[0]=c[0]*b+c[4]*g+c[8]*a+c[12];this.tmpVertex[1]=c[1]*b+c[5]*g+c[9]*a+c[13];this.tmpVertex[2]=c[2]*b+c[6]*g+c[10]*a+c[14];return this.tmpVertex};a.prototype.applyToMinMax=function(a,c){var d=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*d;a[1]+=a[1]*d;a[2]+=a[2]*d;a=this.offset/Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]);c[0]+=c[0]*a;c[1]+=c[1]*
a;c[2]+=c[2]*a};a.prototype.applyToAABB=function(a){var c=this.offset/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]+=a[0]*c;a[1]+=a[1]*c;a[2]+=a[2]*c;c=this.offset/Math.sqrt(a[3]*a[3]+a[4]*a[4]+a[5]*a[5]);a[3]+=a[3]*c;a[4]+=a[4]*c;a[5]+=a[5]*c;return a};a.prototype.applyToBoundingSphere=function(a,c){var d=Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),e=this.offset/d;this.sphere.center[0]=c[0]+c[0]*e;this.sphere.center[1]=c[1]+c[1]*e;this.sphere.center[2]=c[2]+c[2]*e;this.sphere.radius=a+a*this.offset/
d;return this.sphere};return a}();b.Object3DVerticalOffsetGlobalViewingMode=G;q=function(){return function(a){this.terrain=new C(a);this.i3s=new E(a);this.object3D=new G(a)}}();b.VerticalOffsetForGlobalViewingMode=q;b.TERRAIN_ID="terrain";var J=g.vec3f64.create(),I=g.vec3f64.create(),K=p.vec4f64.create(),H=k.quatf64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=l})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require",
"exports","./common"],function(q,b,l){function f(a,e,d){var b=e[0],f=e[1],c=e[2],g=e[3],h=e[4],p=e[5],u=e[6],t=e[7];e=e[8];var x=d[0],v=d[1],y=d[2],m=d[3],w=d[4],A=d[5],B=d[6],l=d[7];d=d[8];a[0]=x*b+v*g+y*u;a[1]=x*f+v*h+y*t;a[2]=x*c+v*p+y*e;a[3]=m*b+w*g+A*u;a[4]=m*f+w*h+A*t;a[5]=m*c+w*p+A*e;a[6]=B*b+l*g+d*u;a[7]=B*f+l*h+d*t;a[8]=B*c+l*p+d*e;return a}function h(a,e,d){a[0]=e[0]-d[0];a[1]=e[1]-d[1];a[2]=e[2]-d[2];a[3]=e[3]-d[3];a[4]=e[4]-d[4];a[5]=e[5]-d[5];a[6]=e[6]-d[6];a[7]=e[7]-d[7];a[8]=e[8]-d[8];
return a}Object.defineProperty(b,"__esModule",{value:!0});b.fromMat4=function(a,e){a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[4];a[4]=e[5];a[5]=e[6];a[6]=e[8];a[7]=e[9];a[8]=e[10];return a};b.copy=function(a,e){a[0]=e[0];a[1]=e[1];a[2]=e[2];a[3]=e[3];a[4]=e[4];a[5]=e[5];a[6]=e[6];a[7]=e[7];a[8]=e[8];return a};b.set=function(a,e,d,b,f,c,g,h,p,u){a[0]=e;a[1]=d;a[2]=b;a[3]=f;a[4]=c;a[5]=g;a[6]=h;a[7]=p;a[8]=u;return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};
b.transpose=function(a,e){if(a===e){var d=e[1],b=e[2],f=e[5];a[1]=e[3];a[2]=e[6];a[3]=d;a[5]=e[7];a[6]=b;a[7]=f}else a[0]=e[0],a[1]=e[3],a[2]=e[6],a[3]=e[1],a[4]=e[4],a[5]=e[7],a[6]=e[2],a[7]=e[5],a[8]=e[8];return a};b.invert=function(a,e){var d=e[0],b=e[1],f=e[2],c=e[3],g=e[4],h=e[5],p=e[6],u=e[7];e=e[8];var t=e*g-h*u,x=-e*c+h*p,v=u*c-g*p,y=d*t+b*x+f*v;if(!y)return null;y=1/y;a[0]=t*y;a[1]=(-e*b+f*u)*y;a[2]=(h*b-f*g)*y;a[3]=x*y;a[4]=(e*d-f*p)*y;a[5]=(-h*d+f*c)*y;a[6]=v*y;a[7]=(-u*d+b*p)*y;a[8]=(g*
d-b*c)*y;return a};b.adjoint=function(a,e){var d=e[0],b=e[1],f=e[2],c=e[3],g=e[4],h=e[5],p=e[6],u=e[7];e=e[8];a[0]=g*e-h*u;a[1]=f*u-b*e;a[2]=b*h-f*g;a[3]=h*p-c*e;a[4]=d*e-f*p;a[5]=f*c-d*h;a[6]=c*u-g*p;a[7]=b*p-d*u;a[8]=d*g-b*c;return a};b.determinant=function(a){var e=a[3],d=a[4],b=a[5],f=a[6],c=a[7],g=a[8];return a[0]*(g*d-b*c)+a[1]*(-g*e+b*f)+a[2]*(c*e-d*f)};b.multiply=f;b.translate=function(a,e,d){var b=e[0],f=e[1],c=e[2],g=e[3],h=e[4],p=e[5],u=e[6],t=e[7];e=e[8];var x=d[0];d=d[1];a[0]=b;a[1]=
f;a[2]=c;a[3]=g;a[4]=h;a[5]=p;a[6]=x*b+d*g+u;a[7]=x*f+d*h+t;a[8]=x*c+d*p+e;return a};b.rotate=function(a,e,d){var b=e[0],f=e[1],c=e[2],g=e[3],h=e[4],p=e[5],u=e[6],t=e[7];e=e[8];var x=Math.sin(d);d=Math.cos(d);a[0]=d*b+x*g;a[1]=d*f+x*h;a[2]=d*c+x*p;a[3]=d*g-x*b;a[4]=d*h-x*f;a[5]=d*p-x*c;a[6]=u;a[7]=t;a[8]=e;return a};b.scale=function(a,e,d){var b=d[0],f=d[1];d=d[2];a[0]=b*e[0];a[1]=b*e[1];a[2]=b*e[2];a[3]=f*e[3];a[4]=f*e[4];a[5]=f*e[5];a[6]=d*e[6];a[7]=d*e[7];a[8]=d*e[8];return a};b.scaleByVec2=function(a,
b,d){var e=d[0];d=d[1];a[0]=e*b[0];a[1]=e*b[1];a[2]=e*b[2];a[3]=d*b[3];a[4]=d*b[4];a[5]=d*b[5];return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};b.fromRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=0;a[3]=-d;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};b.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];
a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};b.fromQuat=function(a,b){var d=b[0],e=b[1],f=b[2];b=b[3];var c=d+d,g=e+e,h=f+f,d=d*c,p=e*c,e=e*g,u=f*c,t=f*g,f=f*h,c=b*c,g=b*g;b*=h;a[0]=1-e-f;a[3]=p-b;a[6]=u+g;a[1]=p+b;a[4]=1-d-f;a[7]=t-c;a[2]=u-g;a[5]=t+c;a[8]=1-d-e;return a};b.normalFromMat4Legacy=function(a,b){var d=b[0],e=b[1],f=b[2],c=b[4],g=b[5],h=b[6],p=b[8],u=b[9];b=b[10];var t=b*g-h*u,x=-b*c+h*p,v=u*c-g*p,y=d*t+e*x+f*v;if(!y)return null;y=1/y;a[0]=t*y;a[1]=(-b*e+f*u)*
y;a[2]=(h*e-f*g)*y;a[3]=x*y;a[4]=(b*d-f*p)*y;a[5]=(-h*d+f*c)*y;a[6]=v*y;a[7]=(-u*d+e*p)*y;a[8]=(g*d-e*c)*y;return a};b.normalFromMat4=function(a,b){var d=b[0],e=b[1],f=b[2],c=b[3],g=b[4],h=b[5],p=b[6],u=b[7],t=b[8],x=b[9],v=b[10],y=b[11],m=b[12],w=b[13],A=b[14];b=b[15];var B=d*h-e*g,l=d*p-f*g,E=d*u-c*g,G=e*p-f*h,J=e*u-c*h,I=f*u-c*p,K=t*w-x*m,H=t*A-v*m,t=t*b-y*m,L=x*A-v*w,x=x*b-y*w,v=v*b-y*A,y=B*v-l*x+E*L+G*t-J*H+I*K;if(!y)return null;y=1/y;a[0]=(h*v-p*x+u*L)*y;a[1]=(p*t-g*v-u*H)*y;a[2]=(g*x-h*t+u*
K)*y;a[3]=(f*x-e*v-c*L)*y;a[4]=(d*v-f*t+c*H)*y;a[5]=(e*t-d*x-c*K)*y;a[6]=(w*I-A*J+b*G)*y;a[7]=(A*E-m*I-b*l)*y;a[8]=(m*J-w*E+b*B)*y;return a};b.projection=function(a,b,d){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/d;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};b.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],
2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};b.add=function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];a[4]=b[4]+d[4];a[5]=b[5]+d[5];a[6]=b[6]+d[6];a[7]=b[7]+d[7];a[8]=b[8]+d[8];return a};b.subtract=h;b.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*d;a[5]=b[5]*d;a[6]=b[6]*d;a[7]=b[7]*d;a[8]=b[8]*d;return a};b.multiplyScalarAndAdd=function(a,b,d,k){a[0]=b[0]+d[0]*k;a[1]=b[1]+d[1]*k;a[2]=b[2]+d[2]*k;a[3]=b[3]+d[3]*k;a[4]=
b[4]+d[4]*k;a[5]=b[5]+d[5]*k;a[6]=b[6]+d[6]*k;a[7]=b[7]+d[7]*k;a[8]=b[8]+d[8]*k;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};b.equals=function(a,b){var d=a[0],e=a[1],f=a[2],c=a[3],g=a[4],h=a[5],p=a[6],u=a[7];a=a[8];var t=b[0],x=b[1],v=b[2],y=b[3],m=b[4],w=b[5],A=b[6],B=b[7];b=b[8];return Math.abs(d-t)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(e-x)<=l.EPSILON*Math.max(1,
Math.abs(e),Math.abs(x))&&Math.abs(f-v)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(c-y)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(g-m)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(h-w)<=l.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-A)<=l.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(u-B)<=l.EPSILON*Math.max(1,Math.abs(u),Math.abs(B))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.mul=f;b.sub=h})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require",
"exports","./math/quat"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quat=l})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),function(q,b,l,f,h,a,e,d){function k(a,c,d){d*=.5;var b=Math.sin(d);a[0]=b*c[0];a[1]=b*c[1];a[2]=b*c[2];a[3]=Math.cos(d);return a}function n(a,c,d){var b=c[0],e=c[1],g=c[2];c=c[3];var k=d[0],m=d[1],f=d[2];d=d[3];a[0]=b*d+c*k+e*
f-g*m;a[1]=e*d+c*m+g*k-b*f;a[2]=g*d+c*f+b*m-e*k;a[3]=c*d-b*k-e*m-g*f;return a}function c(c,d,b,e){var g=d[0],k=d[1],m=d[2];d=d[3];var f=b[0],h=b[1],p=b[2];b=b[3];var n,r,w;r=g*f+k*h+m*p+d*b;0>r&&(r=-r,f=-f,h=-h,p=-p,b=-b);1-r>a.EPSILON?(n=Math.acos(r),w=Math.sin(n),r=Math.sin((1-e)*n)/w,e=Math.sin(e*n)/w):r=1-e;c[0]=r*g+e*f;c[1]=r*k+e*h;c[2]=r*m+e*p;c[3]=r*d+e*b;return c}function g(a,c){var d=c[0]+c[4]+c[8];if(0<d)d=Math.sqrt(d+1),a[3]=.5*d,d=.5/d,a[0]=(c[5]-c[7])*d,a[1]=(c[6]-c[2])*d,a[2]=(c[1]-
c[3])*d;else{var b=0;c[4]>c[0]&&(b=1);c[8]>c[3*b+b]&&(b=2);var e=(b+1)%3,g=(b+2)%3,d=Math.sqrt(c[3*b+b]-c[3*e+e]-c[3*g+g]+1);a[b]=.5*d;d=.5/d;a[3]=(c[3*e+g]-c[3*g+e])*d;a[e]=(c[3*e+b]+c[3*b+e])*d;a[g]=(c[3*g+b]+c[3*b+g])*d}return a}Object.defineProperty(b,"__esModule",{value:!0});b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=k;b.getAxisAngle=function(c,d){var b=2*Math.acos(d[3]),e=Math.sin(b/2);e>a.EPSILON?(c[0]=d[0]/e,c[1]=d[1]/e,c[2]=d[2]/e):(c[0]=1,c[1]=0,c[2]=0);
return b};b.multiply=n;b.rotateX=function(a,c,d){d*=.5;var b=c[0],e=c[1],g=c[2];c=c[3];var k=Math.sin(d);d=Math.cos(d);a[0]=b*d+c*k;a[1]=e*d+g*k;a[2]=g*d-e*k;a[3]=c*d-b*k;return a};b.rotateY=function(a,c,d){d*=.5;var b=c[0],e=c[1],g=c[2];c=c[3];var k=Math.sin(d);d=Math.cos(d);a[0]=b*d-g*k;a[1]=e*d+c*k;a[2]=g*d+b*k;a[3]=c*d-e*k;return a};b.rotateZ=function(a,c,d){d*=.5;var b=c[0],e=c[1],g=c[2];c=c[3];var k=Math.sin(d);d=Math.cos(d);a[0]=b*d+e*k;a[1]=e*d-b*k;a[2]=g*d+c*k;a[3]=c*d-g*k;return a};b.calculateW=
function(a,c){var d=c[0],b=c[1];c=c[2];a[0]=d;a[1]=b;a[2]=c;a[3]=Math.sqrt(Math.abs(1-d*d-b*b-c*c));return a};b.slerp=c;b.random=function(c){var d=a.RANDOM(),b=a.RANDOM(),e=a.RANDOM(),g=Math.sqrt(1-d),d=Math.sqrt(d);c[0]=g*Math.sin(2*Math.PI*b);c[1]=g*Math.cos(2*Math.PI*b);c[2]=d*Math.sin(2*Math.PI*e);c[3]=d*Math.cos(2*Math.PI*e);return c};b.invert=function(a,c){var d=c[0],b=c[1],e=c[2];c=c[3];var g=d*d+b*b+e*e+c*c,g=g?1/g:0;a[0]=-d*g;a[1]=-b*g;a[2]=-e*g;a[3]=c*g;return a};b.conjugate=function(a,
c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};b.fromMat3=g;b.fromEuler=function(a,c,d,b){var e=.5*Math.PI/180;c*=e;d*=e;b*=e;e=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);var k=Math.sin(b);b=Math.cos(b);a[0]=e*d*b-c*g*k;a[1]=c*g*b+e*d*k;a[2]=c*d*k-e*g*b;a[3]=c*d*b+e*g*k;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.copy=d.copy;b.set=d.set;b.add=d.add;b.mul=n;b.scale=d.scale;b.dot=d.dot;b.lerp=d.lerp;b.length=d.length;b.len=b.length;b.squaredLength=
d.squaredLength;b.sqrLen=b.squaredLength;b.normalize=d.normalize;b.exactEquals=d.exactEquals;b.equals=d.equals;b.rotationTo=function(a,c,d){var g=e.dot(c,d);if(-.999999>g)return e.cross(r,p,c),1E-6>e.len(r)&&e.cross(r,u,c),e.normalize(r,r),k(a,r,Math.PI),a;if(.999999<g)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;e.cross(r,c,d);a[0]=r[0];a[1]=r[1];a[2]=r[2];a[3]=1+g;return b.normalize(a,a)};var r=h.create(),p=h.fromValues(1,0,0),u=h.fromValues(0,1,0);b.sqlerp=function(a,d,b,e,g,k){c(t,d,g,k);c(x,b,e,k);c(a,
t,x,2*k*(1-k));return a};var t=f.create(),x=f.create();b.setAxes=function(a,c,d,e){var k=v;k[0]=d[0];k[3]=d[1];k[6]=d[2];k[1]=e[0];k[4]=e[1];k[7]=e[2];k[2]=-c[0];k[5]=-c[1];k[8]=-c[2];return b.normalize(a,g(a,k))};var v=l.create()})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){var p=r.assert;q=function(){function b(a){void 0===a&&(a={});this._objectTransformation=h.mat4f64.create();this._bvObjectSpace=new t;this._bvWorldSpace=new t;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=b._idGen.gen(a.idHint);this.castShadow=null!=a.castShadow?a.castShadow:!0;(this.metadata=a.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new u);this.objectTransformation=
h.mat4f64.create();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}Object.defineProperty(b.prototype,"geometryRecords",{get:function(){return this._geometryRecords},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometries",{get:function(){return this._geometries},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){f.mat4.copy(this._objectTransformation,
a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});b.prototype.dispose=function(){for(var a=0,c=this._geometryRecords;a<c.length;a++)n.pool.release(c[a]);this._geometries=this._geometryRecords=null};b.prototype._initializeGeometryRecords=function(a,c,d,b){if(Array.isArray(a)){p(c.length===a.length,"Object3D: materials don't match geometries");p(d.length===a.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(a.length);
this._geometries=a.slice();for(var e=0;e<a.length;e++)this._geometryRecords[e]=n.pool.acquire(a[e],c[e],h.mat4f64.clone(d[e]),{},b&&b[e]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};Object.defineProperty(b.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){p(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});b.prototype.getNumGeometryRecords=function(){return this._geometryRecords.length};
b.prototype.findGeometryRecords=function(a){for(var c=[],d=0;d<this._geometries.length;d++)this._geometries[d]===a&&c.push(this._geometryRecords[d]);return c};b.prototype.getGeometryRecord=function(a){p(0<=a&&a<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[a]};b.prototype.addGeometry=function(a,c,d,b,e,g){d=d?h.mat4f64.clone(d):h.mat4f64.IDENTITY;this._geometries.push(a);a=n.pool.acquire(a,c,d,b||{},e,g);this._geometryRecords.push(a);
this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return a};b.prototype.removeGeometry=function(a){var c=this._geometryRecords.splice(a,1)[0];n.pool.release(c);this._hasVolatileTransformation=this._geometryRecords.some(function(a){return!!a.shaderTransformation});this._geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",
c);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return c};b.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};b.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[a]);this._invalidateBoundingVolume()};b.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=
!0;for(var a=0,c=this._geometryRecords;a<c.length;a++){var d=c[a];if(!k.isAllHidden(d.instanceParameters.componentVisibilities,d.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};b.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var a=0,c=this._geometryRecords;a<c.length;a++){var d=c[a];if(!k.isAllVisible(d.instanceParameters.componentVisibilities,
d.geometry.data.componentOffsets)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible};b.prototype.hasComponents=function(){for(var a=!1,c=0;c<this._geometries.length&&!(a=k.hasComponents(this._geometries[c].data.componentOffsets));c++);return a};b.prototype.setComponentVisibility=function(a,c,d){c=k.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,c,d);a.instanceParameters.componentVisibilities=c;this._notifyDirty("visibilityChanged",
a);this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0};b.prototype.setHidden=function(a,c){a.instanceParameters.hidden=!!c;this._notifyDirty("visibilityChanged",a)};b.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};b.prototype.getComponentVisibility=function(a,c){return k.getVisibility(a.instanceParameters.componentVisibilities,c)};b.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var a=0,c=this._geometryRecords;a<
c.length;a++){var d=c[a],b=k.hideAllComponents(d.instanceParameters.componentVisibilities);d.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;this._allComponentsVisible=!1}};b.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var a=0,c=this._geometryRecords;a<c.length;a++){var d=c[a],b=k.unhideAllComponents(d.instanceParameters.componentVisibilities);
d.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!1;this._allComponentsVisible=!0}};b.prototype._setComponentHighlight=function(a,c,d,b){c=k.addHighlight(a.instanceParameters.componentHighlights,c,d,b);a.instanceParameters.componentHighlights=c};b.prototype.setComponentHighlight=function(a,d,b){var e=c.generateHighlightId();this._setComponentHighlight(a,d,b,e);this._notifyDirty("componentHighlightChanged");
return e};b.prototype.highlightAllComponents=function(a){for(var d=c.generateHighlightId(),b=0,e=this._geometryRecords;b<e.length;b++)this._setComponentHighlight(e[b],null,a,d);this._notifyDirty("componentHighlightChanged");return d};b.prototype.removeHighlights=function(a){for(var c=0,d=this._geometryRecords;c<d.length;c++){var b=d[c].instanceParameters,e=k.removeHighlight(b.componentHighlights,a);b.componentHighlights=e}this._notifyDirty("componentHighlightChanged")};b.prototype.getComponentFromTriangleNr=
function(a,c){p(0<=a&&a<this._geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return k.componentFind(this._geometryRecords[a].geometry.data.componentOffsets,3*c)};b.prototype.setGeometryTransformation=function(a,c){p(0<=a&&a<this._geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this._geometryRecords[a];n.pool.release(d);c=n.pool.acquire(d.geometry,d.material,h.mat4f64.clone(c),d.instanceParameters);this._geometryRecords[a]=c;
this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};b.prototype.getCombinedStaticTransformation=function(a,c){c=c||h.mat4f64.create();f.mat4.multiply(c,this.objectTransformation,a.getStaticTransformation());return c};b.prototype.getCombinedShaderTransformation=function(a,c){c=c||h.mat4f64.create();f.mat4.multiply(c,this.objectTransformation,a.getShaderTransformation());return c};b.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};b.prototype.getMetadata=
function(){return this.metadata};b.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};b.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};b.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};b.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:
this._bvWorldSpace.bsRadius};b.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var c=0;c<this._geometryRecords.length;++c){var b=this._geometries[c],g=this._geometryRecords[c],b=b.boundingInfo;this._calculateTransformedBoundingVolume(b,this._bvObjectSpace,g.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(g))}a.vec3.lerp(this._bvObjectSpace.center,
this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);a.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var g=e.vec3f64.create(),k=e.vec3f64.create(),f=d.maxScale(this.objectTransformation),c=0;c<this._geometryRecords.length;++c){var b=this._geometries[c],h=this._geometryRecords[c].getShaderTransformation(),p=d.maxScale(h),b=b.boundingInfo;a.vec3.transformMat4(g,b.getCenter(),h);h=a.vec3.distance(g,this._bvObjectSpace.center);b=b.getBSRadius()*p;this._bvObjectSpace.bsRadius=
Math.max(this._bvObjectSpace.bsRadius,h+b);a.vec3.transformMat4(k,g,this.objectTransformation);p=a.vec3.distance(k,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,p+b*f)}this._bvDirty=!1}};b.prototype._calculateTransformedBoundingVolume=function(c,d,b){var g=c.getBBMin();c=c.getBBMax();var k=e.vec3f64.clone(g),f=e.vec3f64.clone(c);a.vec3.transformMat4(k,k,b);a.vec3.transformMat4(f,f,b);for(var m=0;3>m;++m)d.bbMin[m]=Math.min(d.bbMin[m],k[m],f[m]),d.bbMax[m]=
Math.max(d.bbMax[m],k[m],f[m]);for(m=0;3>m;++m){a.vec3.copy(k,g);a.vec3.copy(f,c);k[m]=c[m];f[m]=g[m];a.vec3.transformMat4(k,k,b);a.vec3.transformMat4(f,f,b);for(var h=0;3>h;++h)d.bbMin[h]=Math.min(d.bbMin[h],k[h],f[h]),d.bbMax[h]=Math.max(d.bbMax[h],k[h],f[h])}};b.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};b.prototype._notifyDirty=function(a,
c,d,b){this._parentLayer&&this._parentLayer.notifyDirty(a,c,d||1,b||this)};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{hasGeometry:function(c){return-1<a._geometries.indexOf(c)},getGeometryIndex:function(c){return a._geometries.indexOf(c)}}},enumerable:!0,configurable:!0});b._idGen=new g.IdGen;return b}();var u=function(){function a(){this.bbMin=e.vec3f64.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=e.vec3f64.fromValues(-Number.MAX_VALUE,
-Number.MAX_VALUE,-Number.MAX_VALUE)}a.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<this.bbMin[2]};return a}(),t=function(c){function d(){var a=c.call(this)||this;a.center=e.vec3f64.create();a.bsRadius=0;return a}l(d,c);d.prototype.init=function(){a.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);a.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);a.vec3.set(this.center,0,0,0);this.bsRadius=
0};d.prototype.getCenter=function(){return this.center};d.prototype.getBSRadius=function(){return this.bsRadius};return d}(u);return q})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/libs/gl-matrix-2/vec3","./IdGen"],function(q,b,l,f,h){return function(){function a(b,d,k,f,c,g){this.id=a._idGen.gen(b&&b.id);this.geometry=b;this.material=d;this.transformation=k;this.instanceParameters=f;this.origin=c;this.shaderTransformation=
g}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};a.prototype.computeAttachmentOrigin=function(a){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,a):this.geometry.computeAttachmentOrigin(a))?(f.vec3.transformMat4(a,a,this.getStaticTransformation()),!0):!1};a._idGen=new h.IdGen;
a.pool=new l(a,!0);return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this._count=0}b.prototype.gen=function(b){null==b&&(b="a");return b+"_"+this._count++};return b}();b.IdGen=q})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});var f=new l.IdGen;b.generateHighlightId=
function(){return f.gen("highlight")}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils".split(" "),function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a,c,d,b){void 0===
d&&(d=k.defaultApplyOptions);void 0===b&&(b=!0);B.eyeCenterDistance=0;B.requiresTwoSteps=!1;var g=p(a,c,d,void 0,B);if(0===g)return!1;h.mat4.identity(v);h.mat4.rotate(v,v,-g,c.viewRight);switch(d.tiltMode){case 1:e.vec3.transformMat4(x,c.viewForward,v);e.vec3.scale(x,x,B.eyeCenterDistance);e.vec3.add(c.center,c.eye,x);break;case 0:e.vec3.subtract(x,c.center,c.eye);e.vec3.transformMat4(x,x,v);e.vec3.subtract(c.eye,c.center,x);break;default:l.neverReached(d.tiltMode)}e.vec3.transformMat4(c.up,c.up,
v);c.markViewDirty();return B.requiresTwoSteps&&b?r(a,c,d,!1):!0}function p(a,d,b,h,r){void 0===b&&(b=k.defaultApplyOptions);void 0===h&&(h=k.defaultApplyOptions);if(!a.state.constraints.tilt)return 0;var v=a.state.constraints.tilt(d.distance,w);var x=b;if(0!==x.interactionType){var B=x.interactionStartCamera,C=x.interactionFactor,E=v.min,G=v.max,O=p(a,B,k.defaultApplyOptions,x),Q=0===O?0:n.viewAngle(a.renderCoordsHelper,B.center,B.eye);v.min=E;v.max=G;2===x.interactionType?(k.hasConstraintType(x.selection,
2)&&t(a,B,v),k.adjustRangeForInteraction(O,Q,!0,C,m,v)):k.adjustRangeForInteraction(O,Q,!1,C,m,v)}2===h.interactionType&&k.hasConstraintType(h.selection,2)&&t(a,h.interactionStartCamera,v);if(1===b.tiltMode||1===h.tiltMode){a:switch(r&&(r.requiresTwoSteps=!1),a.viewingMode){case "global":b=A;x=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;h=x+c.earthRadius;x=a.renderCoordsHelper.intersectManifold(d.ray,x,y);b.eyeCenterDistance=d.distance;x?(b.eyeCenterDistance=e.vec3.distance(d.eye,
y),b.tiltAtCenter=n.viewAngle(a.renderCoordsHelper,y,d.eye)):a.state.isLocal?b.tiltAtCenter=n.viewAngle(a.renderCoordsHelper,d.center,d.eye):(g.sphere.closestPointOnSilhouette(g.sphere.wrap(h),d.ray,y),b.eyeCenterDistance=e.vec3.distance(d.eye,y),b.tiltAtCenter=f.acosClamped(-e.vec3.dot(d.viewForward,e.vec3.normalize(y,y))));b.radius=h;b.eyeRadius=e.vec3.length(d.eye);b.constraints=a.state.constraints;b.centerIsOnSurface=x;d=f.clamp(b.tiltAtCenter,v.min,v.max);if(1E-9<Math.abs(b.tiltAtCenter-d)){if(b.centerIsOnSurface){d=
b.constraints;a=h=b.tiltAtCenter;v=d.clampTilt(b.eyeCenterDistance,h);x=u(b,v);if(d.clampTilt(x,h)!==v)for(h=0;10>h&&1E-9<Math.abs(v-a);)x=(a+v)/2,B=u(b,x),B=d.clampTilt(B,x),1E-9<Math.abs(B-x)?a=x:v=x,h++;d=v;v=d;a=f.asinClamped(b.radius/b.eyeRadius*Math.sin(b.tiltAtCenter));v=f.asinClamped(b.radius/b.eyeRadius*Math.sin(v));a=b.eyeRadius>b.radius?a-v:v-a}else d=b.constraints.clampTilt(b.eyeCenterDistance,b.tiltAtCenter),r&&d<Math.PI/2&&(r.requiresTwoSteps=!0,d=Math.PI/2-1E-5),a=b.tiltAtCenter-Math.PI/
2-(d-Math.PI/2);r&&(r.eyeCenterDistance=u(b,d));r=a}else r=0;break a;case "local":h=n.viewAngle(a.renderCoordsHelper,d.center,d.eye);b=f.clamp(h,v.min,v.max);v=h-b;1E-9<Math.abs(v)?(r&&(h=a.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a=a.renderCoordsHelper.getAltitude(d.eye)-h,b=Math.cos(b),r.eyeCenterDistance=1E-4<Math.abs(b)?a/b:d.distance),r=v):r=0;break a;default:l.neverReached(a.viewingMode),r=void 0}return r}r=n.viewAngle(a.renderCoordsHelper,d.center,d.eye);d=f.clamp(r,
v.min,v.max);r-=d;r=1E-9<Math.abs(r)?r:0;return r}function u(a,c){if(!a.centerIsOnSurface)return a.eyeCenterDistance;c=Math.PI-f.clamp(c,0,Math.PI);var d=f.asinClamped(a.radius/a.eyeRadius*Math.sin(c)),b=Math.sin(Math.PI-c-d)/Math.sin(c);return a.eyeRadius<a.radius&&1<b?Math.sin(Math.PI-c-(Math.PI-d))/Math.sin(c)*a.eyeRadius:b*a.eyeRadius}function t(a,d,b){if(!a.state.isLocal){var g=a.state.constraints;if(g.altitude){a=e.vec3.squaredLength(d.center);var k=Math.sqrt(a);d=d.distance;var m=g.altitude.min+
c.earthRadius,g=g.altitude.max+c.earthRadius,m=(m*m-d*d-a)/(-2*k*d);b.min=Math.max(b.min,Math.min(Math.PI-f.acosClamped((g*g-d*d-a)/(-2*k*d)),b.max));b.max=Math.min(b.max,Math.PI-f.acosClamped(m))}}}Object.defineProperty(b,"__esModule",{value:!0});b.applyTiltConstraint=r;b.getTiltConstraintError=p;var x=d.vec3f64.create(),v=a.mat4f64.create(),y=d.vec3f64.create(),m=f.deg2rad(5),w={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},B={eyeCenterDistance:0,
requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.viewAngle=function(d,b,h){d.worldUpAtPosition(b,a);f.vec3.subtract(e,h,b);d=f.vec3.length(e);return 0===d?0:l.acosClamped(f.vec3.dot(e,a)/d)};var a=h.vec3f64.create(),e=h.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(q,b){function l(a){return a}function f(a){var b=2*(a-Math.sqrt((a-1)*a)),d=b/2/a;return function(e){return e<d?a*e*e:b*e-b+1}}function h(a,b){return function(d){return d<b?b*a(d/b):1-a((1-d)/(1-b))*(1-b)}}Object.defineProperty(b,"__esModule",{value:!0});b.linear=l;b.inQuad=function(a){return a*a};b.outQuad=function(a){return 1-b.inQuad(1-a)};b.inOutQuad=function(a){return.5>a?b.inQuad(2*a)/2:(b.outQuad(2*(a-.5))+1)/2};b.inCubic=function(a){return a*a*a};b.outCubic=function(a){return 1-
b.inCubic(1-a)};b.inOutCubic=function(a){return.5>a?b.inCubic(2*a)/2:(b.outCubic(2*(a-.5))+1)/2};b.inQuart=function(a){return a*a*a*a};b.outQuart=function(a){return 1-b.inQuart(1-a)};b.inOutQuart=function(a){return.5>a?b.inQuart(2*a)/2:(b.outQuart(2*(a-.5))+1)/2};b.inQuint=function(a){return a*a*a*a*a};b.outQuint=function(a){return 1-b.inQuint(1-a)};b.inOutQuint=function(a){return.5>a?b.inQuint(2*a)/2:(b.outQuint(2*(a-.5))+1)/2};b.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};b.outSine=function(a){return 1-
b.inSine(1-a)};b.inOutSine=function(a){return.5>a?b.inSine(2*a)/2:(b.outSine(2*(a-.5))+1)/2};b.inExpo=function(a){return Math.pow(2,10*(a-1))};b.outExpo=function(a){return 1-b.inExpo(1-a)};b.inOutExpo=function(a){return.5>a?b.inExpo(2*a)/2:(b.outExpo(2*(a-.5))+1)/2};b.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};b.outCirc=function(a){return 1-b.inCirc(1-a)};b.inOutCirc=function(a){return.5>a?b.inCirc(2*a)/2:(b.outCirc(2*(a-.5))+1)/2};b.inCoastQuad=h(f(1),1);b.outCoastQuad=h(f(1),0);b.inOutCoastQuad=
h(f(1),.5);b.inCoastCubic=h(f(2),1);b.outCoastCubic=h(f(2),0);b.inOutCoastCubic=h(f(2),.5);b.inCoastQuart=h(f(3),1);b.outCoastQuart=h(f(3),0);b.inOutCoastQuart=h(f(3),.5);b.inCoastQuint=h(f(4),1);b.outCoastQuint=h(f(4),0);b.inOutCoastQuint=h(f(4),.5);b.named={linear:l,"in-quad":b.inQuad,"out-quad":b.outQuad,"in-out-quad":b.inOutQuad,"in-coast-quad":b.inCoastQuad,"out-coast-quad":b.outCoastQuad,"in-out-coast-quad":b.inOutCoastQuad,"in-cubic":b.inCubic,"out-cubic":b.outCubic,"in-out-cubic":b.inOutCubic,
"in-coast-cubic":b.inCoastCubic,"out-coast-cubic":b.outCoastCubic,"in-out-coast-cubic":b.inOutCoastCubic,"in-quart":b.inQuart,"out-quart":b.outQuart,"in-out-quart":b.inOutQuart,"in-coast-quart":b.inCoastQuart,"out-coast-quart":b.outCoastQuart,"in-out-coast-quart":b.inOutCoastQuart,"in-quint":b.inQuint,"out-quint":b.outQuint,"in-out-quint":b.inOutQuint,"in-coast-quint":b.inCoastQuint,"out-coast-quint":b.outCoastQuint,"in-out-coast-quint":b.inOutCoastQuint,"in-sine":b.inSine,"out-sine":b.outSine,"in-out-sine":b.inOutSine,
"in-expo":b.inExpo,"out-expo":b.outExpo,"in-out-expo":b.inOutExpo,"in-circ":b.inCirc,"out-circ":b.outCirc,"in-out-circ":b.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector".split(" "),function(q,b,l,f,h,a,
e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(c,b,e){var g=d.call(this,"interaction"===e?null:new h)||this;g.viewState=c;g.intersectionHelper=b;g.mode=e;g.hasTarget=!1;g.animation=new a.default(g.viewState.mode);return g}l(b,d);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});b.prototype.begin=function(a,d){this.hasTarget=!0;d=this.animationSettings(d);n.copyFrom(this.viewState.camera);
var b=new k(this.viewState.mode);this.intersectionHelper.intersectRay(n.ray,b,c)&&(n.center=c);this.animation.update(n,a,d);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=this.animation.time;d.prototype.finish.call(this)};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(a,c){this.hasTarget&&this.animation.step(a,c)};
b.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);d.prototype.onControllerEnd.call(this,a)};b.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};
return b}(e.AnimationController);b.PointToPointAnimationController=q;var n=new d.default,c=f.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=h.vec3f64.create();
q=function(){function b(c){this.currentTime=0;this.animation=new d.Animation(function(){return new a.default(c)});this._current=new a.default(c)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});b.prototype.update=function(a,d,b){var c=this.animation.definition.source,e=this.animation.definition.target,
g=f.vec3.subtract(k,d.center,a.center),h=f.vec3.length(g);1E-5<=h?(g[0]/=h,g[1]/=h,g[2]/=h):(g[0]=0,g[1]=1,g[0]=0);f.vec3.copy(c.lookAtDirection,g);f.vec3.copy(e.lookAtDirection,g);c.copyFromRenderCamera(a);e.copyFromRenderCamera(d);this._current.copyFrom(c);this.animation.update(c,e,b);this.currentTime=0;a.almostEquals(d,5E-4,!0)&&(this.currentTime=this.animation.time)};b.prototype.cameraAt=function(a,d){this.animation.cameraAt(a,this._current);d=d||new e.default;this._current.copyToRenderCamera(d);
return d};b.prototype.step=function(a,d){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,d)};return b}();b.Animation=q;b.default=q})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=e.vec3f64.create(),n=e.vec3f64.create(),c=e.vec3f64.create(),g=e.vec3f64.create(),r=e.vec3f64.create(),p=e.vec3f64.create(),u=e.vec3f64.fromValues(0,0,1),t=e.vec3f64.fromValues(0,1,0),x=e.vec3f64.fromValues(1,0,0),v=h.mat3f64.create();q=function(){function b(a){void 0===a&&(a="global");this.viewingMode=a;this.center=e.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=e.vec3f64.clone(t)}b.prototype.pixelsPerPanAtZoom=
function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};b.prototype.compareTo=function(c,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var e=a.vec3.length(this.center),g=a.vec3.length(c.center),e=(e+g)/2;b.pan=d.angle(this.center,c.center)*e}else b.pan=a.vec3.distance(this.center,
c.center);e=Math.abs(c.yaw-this.yaw);e>=Math.PI&&(e=2*Math.PI-e);b.rotate=Math.max(e,Math.abs(c.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=c.distance;return b};b.prototype.interpolate=function(c,b,e){"global"===this.viewingMode?d.slerp(c.center,b.center,e.pan,this.center):a.vec3.lerp(this.center,c.center,b.center,e.pan);this.distance=l.lerp(c.distance,b.distance,e.zoom);this.pitch=l.lerp(c.pitch,b.pitch,e.rotate);c=c.yaw;b=b.yaw;Math.abs(b-c)>=Math.PI&&(c+=2*(c<b?1:-1)*Math.PI);this.yaw=
l.lerp(c,b,e.rotate)};b.prototype.copyFrom=function(c){a.vec3.copy(this.center,c.center);this.pitch=c.pitch;this.yaw=c.yaw;this.distance=c.distance;a.vec3.copy(this.lookAtDirection,c.lookAtDirection);this.size=c.size;this.copyFromCommon(c);this.viewingMode=c.viewingMode};b.prototype.copyFromRenderCamera=function(c){var d=this._lookAtOrientation(c.center,v);a.vec3.copy(this.center,c.center);a.vec3.subtract(g,c.center,c.eye);a.vec3.transformMat3(g,g,d);a.vec3.transformMat3(r,c.up,d);this.distance=a.vec3.length(g);
g[0]/=this.distance;g[1]/=this.distance;g[2]/=this.distance;this.pitch=this._eyeUpToPitch(g);this.yaw=this._eyeUpToYaw(g,r);this.size=Math.sqrt(c.width*c.width+c.height*c.height);this.copyFromCommon(c)};b.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};b.prototype.copyToRenderCamera=function(c){var d=this._lookAtOrientation(this.center,v);f.mat3.transpose(d,d);this._axisAngleVec3(x,this.pitch-Math.PI/2,t,g);this._axisAngleVec3(u,this.yaw,g);this._axisAngleVec3(x,
this.pitch-Math.PI/2,u,r);this._axisAngleVec3(u,this.yaw,r);a.vec3.scale(g,g,this.distance);a.vec3.transformMat3(g,g,d);a.vec3.transformMat3(r,r,d);c.center=this.center;c.eye=a.vec3.subtract(g,this.center,g);c.up=r};b.prototype._axisAngleVec3=function(d,b,e,g){void 0===g&&(g=e);var f=Math.cos(b);b=Math.sin(b);a.vec3.scale(k,e,f);a.vec3.cross(n,d,e);a.vec3.scale(n,n,b);a.vec3.scale(c,d,(1-f)*a.vec3.dot(d,e));return a.vec3.add(g,a.vec3.add(g,k,n),c)};b.prototype._lookAtOrientation=function(d,b){this._upAtLookAt(d,
c);a.vec3.cross(k,this.lookAtDirection,c);a.vec3.normalize(k,k);0===k[0]&&0===k[1]&&0===k[2]&&a.vec3.copy(k,x);a.vec3.cross(n,c,k);a.vec3.normalize(n,n);b||(b=h.mat3f64.create());b[0]=k[0];b[1]=n[0];b[2]=c[0];b[3]=k[1];b[4]=n[1];b[5]=c[1];b[6]=k[2];b[7]=n[2];b[8]=c[2];return b};b.prototype._upAtLookAt=function(c,d){return"local"===this.viewingMode?a.vec3.copy(d,u):a.vec3.normalize(d,c)};b.prototype._eyeUpToPitch=function(a){return Math.PI-d.angle(u,a)};b.prototype._eyeUpToYaw=function(c,b){.5>Math.abs(b[2])?
(a.vec3.copy(p,b),0<c[2]&&a.vec3.scale(p,p,-1)):a.vec3.copy(p,c);a.vec3.cross(n,p,u);a.vec3.normalize(n,n);return d.angle(x,n,u)};return b}();b.default=q})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a,c){var d=c[0]-a[0],b=c[1]-a[1],e=c[2]-a[2];a=c[3]-a[3];return d*d+b*b+e*e+a*a}function t(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function x(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,e,g){void 0===b&&(b=d.vec3f64.create());void 0===e&&(e=d.vec3f64.create());void 0===g&&(g=d.vec3f64.fromValues(0,0,1));this._viewUp=d.vec3f64.create();this._viewForward=
d.vec3f64.create();this._viewRight=d.vec3f64.create();this._ray=c.ray.createWrapper();this._viewport=n.vec4f64.fromValues(0,0,1,1);this._padding=n.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=a.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=a.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=a.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=a.mat4f64.create();
this._frustumDirty=!0;this._frustum=c.frustum.create();this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=d.vec3f64.clone(b);this._center=d.vec3f64.clone(e);this._up=d.vec3f64.clone(g);this._padding=n.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,
this._center)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=d.vec3f64.create());e.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",
{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){h.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==
a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=n.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=
this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],
this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),k.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(h.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),b=d*this.aspect;h.mat4.frustum(this._projectionMatrix,-b*(1+2*this._padding[3]/a),b*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){h.mat4.copy(this._projectionMatrix,a);this._projectionDirty=
!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return p.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=
this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return p.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=p.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return e.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=a.mat4f64.create()),h.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});
b.prototype.copyFrom=function(d){e.vec3.copy(this._eye,d._eye);e.vec3.copy(this._center,d._center);e.vec3.copy(this._up,d._up);k.vec4.copy(this._viewport,d._viewport);k.vec4.copy(this._padding,d._padding);this._near=d._near;this._far=d._far;this._fov=d._fov;this.relativeElevation=d.relativeElevation;this._viewDirty=d._viewDirty;this._viewDirty||(h.mat4.copy(this._viewMatrix,d._viewMatrix),e.vec3.copy(this._viewRight,d._viewRight),e.vec3.copy(this._viewUp,d._viewUp),e.vec3.copy(this._viewForward,d._viewForward));
d._projectionDirty?this._projectionDirty=!0:(h.mat4.copy(this._projectionMatrix,d._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=d._frustumDirty;this._frustumDirty||(c.frustum.copy(d._frustum,this._frustum),this._frustumDirty=!1);d._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?h.mat4.copy(this._viewInverseTransposeMatrix,d._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=a.mat4f64.clone(d._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);d._fullViewport?this._fullViewport?k.vec4.copy(this._fullViewport,d._fullViewport):this._fullViewport=n.vec4f64.clone(d._fullViewport):this._fullViewport=null;this.pixelRatio=d.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.clone=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return t(this._eye,a._eye)&&t(this._center,a._center)&&t(this._up,a._up)&&
x(this._viewport,a._viewport)&&x(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===a.pixelRatio&&this.relativeElevation===a.relativeElevation};b.prototype.almostEquals=function(a,c,d){void 0===d&&(d=!1);c=e.vec3.distance(this._eye,this._center)*(c||5E-4);c*=c;d?(g.directionFromTo(m,a._eye,a._center),g.directionFromTo(w,this._eye,this._center),d=1E-10):(e.vec3.copy(m,a._center),e.vec3.copy(w,this._center),d=c);return e.vec3.squaredDistance(a._eye,
this._eye)<c&&e.vec3.squaredDistance(m,w)<d&&.001>Math.abs(a._fov-this._fov)&&.5>u(a._padding,this._padding)&&.5>u(a._viewport,this._viewport)&&this.pixelRatio===a.pixelRatio};b.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=
function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.viewDirectionDistance=function(a){return Math.abs(r.projectPointSignedLength(this.viewForward,e.vec3.subtract(m,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};b.prototype.getScreenCenter=function(a){void 0===a&&(a=f.createScreenPointArray());
a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a||(a=f.createRenderScreenPointArray3());a[0]=this.padding[3]+this.width*c;a[1]=this.padding[2]+this.height*d;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])};b.prototype.applyProjection=
function(a,c,d){void 0===d&&(d=!1);a!==v&&e.vec3.copy(v,a);v[3]=1;d&&(c[2]=-v[2]);k.vec4.transformMat4(v,v,this.projectionMatrix);e.vec3.scale(v,v,1/Math.abs(v[3]));a=this.fullViewport;c[0]=l.lerp(0,a[0]+a[2],.5+.5*v[0]);c[1]=l.lerp(0,a[1]+a[3],.5+.5*v[1]);d||(c[2]=.5*(v[2]+1));return c};b.prototype.projectPoint=function(a,c){v[0]=a[0];v[1]=a[1];v[2]=a[2];v[3]=1;k.vec4.transformMat4(v,v,this.viewProjectionMatrix);if(0===v[3])return null;e.vec3.scale(v,v,1/Math.abs(v[3]));a=this.fullViewport;"x"in
c?(c.x=l.lerp(0,a[0]+a[2],.5+.5*v[0]),c.y=l.lerp(0,a[1]+a[3],.5+.5*v[1])):(c[0]=l.lerp(0,a[0]+a[2],.5+.5*v[0]),c[1]=l.lerp(0,a[1]+a[3],.5+.5*v[1]),2<c.length&&(c[2]=.5*(v[2]+1)));return c};b.prototype.unprojectPoint=function(a,c){h.mat4.multiply(y,this.projectionMatrix,this.viewMatrix);if(!h.mat4.invert(y,y))return null;var d=this.fullViewport;v[0]=2*(a[0]-d[0])/d[2]-1;v[1]=2*(a[1]-d[1])/d[3]-1;v[2]=2*a[2]-1;v[3]=1;k.vec4.transformMat4(v,v,y);if(0===v[3])return null;c[0]=v[0]/v[3];c[1]=v[1]/v[3];
c[2]=v[2]/v[3];return c};b.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};b.prototype.screenToRender=function(a,c){var d=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=d;return c};b.prototype.renderToScreen=function(a,c){var d=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=d;return c};b.prototype.computeUpGlobal=function(){e.vec3.subtract(m,this.center,this.eye);var a=e.vec3.length(this.center);1>a?(e.vec3.set(this.up,
0,0,1),this.markViewDirty()):Math.abs(e.vec3.dot(m,this.center))>.9999*e.vec3.length(m)*a||(e.vec3.cross(this.up,m,this.center),e.vec3.cross(this.up,this.up,m),e.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){g.directionFromTo(m,this.eye,this.center);.9999>=Math.abs(m[2])&&(e.vec3.scale(m,m,m[2]),e.vec3.set(this.up,-m[0],-m[1],1-m[2]),e.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=function(a,c){t(a,c)||(e.vec3.copy(c,
a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&(h.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),e.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),e.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],
this._viewMatrix[9]),e.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();b.default=q;var v=n.vec4f64.create(),y=a.mat4f64.create(),m=d.vec3f64.create(),w=d.vec3f64.create()})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});var e=
{zoom:0,pan:0,rotate:0};q=function(){function d(d){this.createCamera=d;this.time=0;this.definition=new f.Definition(d);this.path=new a.Path}d.prototype.update=function(a,d,c){this.definition.update(a,d,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,c);this.settings=c};d.prototype.cameraAt=function(a,d){d=d||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a):1<=this.time?this.normalizedEasing(l.inOutCoastQuad,
a):this.normalizedEasing(l.outExpo,a);a=this.path.interpolateComponentsAt(a,e);d.interpolate(this.definition.source,this.definition.target,a);return d};d.prototype.normalizedEasing=function(a,d){var c=a(0),b=a(1);return(a(d)-c)/(b-c)};d.prototype._applyTimeSettings=function(a,d){var c=null!=d.speedFactor?d.speedFactor:1;null!=d.duration?a=d.duration:null!=d.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=d.minDuration?d.minDuration:h.defaultSettings.minDuration/c,a),null!=d.maxDuration?d.maxDuration:
h.defaultSettings.maxDuration/c)};return d}();b.Animation=q;b.default=q})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.createCamera=b;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:l.defaultSettings.desiredScreenFlow};this.source=b();this.target=b()}b.prototype.clone=function(){var f=new b(this.createCamera);
f.copyFrom(this);return f};b.prototype.copyFrom=function(b){this.update(b.source,b.target,b.settings)};b.prototype.update=function(b,a,e){this.source!==b&&this.source.copyFrom(b);this.target!==a&&this.target.copyFrom(a);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=e.desiredScreenFlow?e.desiredScreenFlow:l.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/
2};b.prototype.halfWindowPanAtZoom=function(b){b=this.target.pixelsPerPanAtZoom(b);return this.halfWindowSize/b};Object.defineProperty(b.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,
configurable:!0});return b}();b.Definition=q;b.default=q})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,
"__esModule",{value:!0});q=function(d){function b(b,c){var e=d.call(this)||this;e._preallocSegments=[new a.default,new a.default,new a.default];e.update(b,c);return e}l(b,d);b.prototype.update=function(a,c){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var d=null;c&&c.apex&&(d=e.optimalDistance(a,c.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,c.apex)}};b.prototype.segmentInterpolateComponentsAt=
function(a,c,d){d=a.interpolateComponentsAt(c,d);a===this._ascensionSegment?d.zoom=f.outQuad(d.zoom):a===this._descensionSegment&&(d.zoom=f.inQuad(d.zoom));return d};b.prototype._updateWithApex=function(a,c){var d=this._preallocSegments,b=d[0],e=d[1],d=d[2],k=null!=c.ascensionFactor?c.ascensionFactor:.5;c=Math.min(1-k,null!=c.ascensionFactor?c.descensionFactor:.5);var f=1-k-c;b.definition?b.definition.copyFrom(this.definition):b.definition=this.definition.clone();b.definition.compared.targetZoom=
a;b.definition.compared.pan=this.definition.compared.pan*k;b.definition.compared.rotate=this.definition.compared.rotate*k;b.update();this._ascensionSegment=b;this.segments.push(b);0<f&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*f,e.definition.compared.rotate=this.definition.compared.rotate*
f,e.update(),this.segments.push(e));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=a;d.definition.compared.pan=this.definition.compared.pan*c;d.definition.compared.rotate=this.definition.compared.rotate*c;d.update();this._descensionSegment=d;this.segments.push(d)};b.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return b}(h.default);b.Path=q;b.default=
q})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.segments=[]}Object.defineProperty(b.prototype,"time",{get:function(){return this.segments.reduce(function(b,h){return b+h.time},0)},enumerable:!0,configurable:!0});b.prototype.interpolateComponentsAt=function(b,h){b=Math.min(Math.max(b,0),1);b*=this.time;for(var a=0,e=0,d=this.definition,k=0;k<this.segments.length;k++){var f=
this.segments[k],c=f.definition;if(b<=f.time||k===this.segments.length-1)return h=this.segmentInterpolateComponentsAt(f,b/f.time,h),h.pan=d.hasPan?(a+c.compared.pan*h.pan)/d.compared.pan:1,h.rotate=d.hasRotate?(e+c.compared.rotate*h.rotate)/d.compared.rotate:1,b=h.zoom*(c.compared.targetZoom-c.compared.sourceZoom)+c.compared.sourceZoom,a=this.segments[0].definition.compared.sourceZoom,e=this.segments[this.segments.length-1].definition.compared.targetZoom,h.zoom=d.hasZoom?(b-a)/(e-a):1,h;b-=f.time;
a+=c.compared.pan;e+=c.compared.rotate}};b.prototype.segmentInterpolateComponentsAt=function(b,h,a){return b.interpolateComponentsAt(h,a)};return b}();b.Path=q;b.default=q})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){b&&this.update(b)}b.prototype.update=function(b){b&&(this.definition?this.definition.copyFrom(b):this.definition=b.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};b.prototype._updatePrecomputedVariables=function(){var b=this.definition,h=b.compared,a=h.sourceZoom,e=h.targetZoom;this._zoomSign=a>e?1:-1;this._panPixelsAtSource=h.pan*b.source.pixelsPerPanAtZoom(a);b=(b.source.pixelsPerRotateAtZoom(a)+b.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=h.rotate*b};b.prototype._updatePixelFlow=function(){var b=this.definition.compared.sourceZoom,h=this.definition.compared.targetZoom,a=this.definition,e=a.hasZoom,d=a.hasPan,a=a.hasRotate,
k=0,n=0;e&&(d&&(k=(h/b-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),a&&(n=Math.log(b/h)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;b=this.definition.desiredPixelFlow;e&&d&&a?(h=k+n+k*n,this._zoomPixelFlow=k*n/h*b,this._panPixelFlow=n/h*b,this._rotatePixelFlow=k/h*b):e&&d?(h=1+k,this._zoomPixelFlow=k/h*b,this._panPixelFlow=1/h*b):e&&a?(h=1+n,this._zoomPixelFlow=
n/h*b,this._rotatePixelFlow=1/h*b):d&&a?(k=this._panPixelsAtSource/this._rotatePixels,h=1+k,this._panPixelFlow=k/h*b,this._rotatePixelFlow=1/h*b):d?this._panPixelFlow=b:e?this._zoomPixelFlow=b:a&&(this._rotatePixelFlow=b);this.time=a?this.rotateTime:e?this.zoomTime:d?this.panTime:0};Object.defineProperty(b.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var b=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*b+1)/(b*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});b.prototype._interpolateComponentsZoom=function(b){if(0===b||1===b)return b;if(this.definition.hasZoom){var f=this.definition.compared.sourceZoom,a=this.definition.compared.targetZoom;return(f*Math.pow(f/a,-b)-f)/(a-f)}return b};b.prototype._interpolateComponentsPan=function(b){if(0===b||1===b)return b;if(this.definition.hasPan&&this.definition.hasZoom){var f=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,f*b*this.time)-1)/(f*Math.LN2)}return b};b.prototype._interpolateComponentsRotate=function(b){return b};b.prototype.interpolateComponentsAt=function(b,h){b=Math.min(Math.max(b,0),1);var a=this._interpolateComponentsZoom(b),e=this._interpolateComponentsPan(b);b=this._interpolateComponentsRotate(b);h?(h.zoom=a,h.pan=e,h.rotate=b):h={zoom:a,pan:e,rotate:b};return h};return b}();b.Segment=q;b.default=q})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(q,b,l){function f(b,a){var e=Math.max(b.compared.sourceZoom,b.compared.targetZoom);b=b.source.zoomAtPixelsPerPan(b.desiredPixelFlow/b.compared.pan)/2;return b<e?null!=a.maximumDistance?e+(a.maximumDistance-e)/2:1.5*e:a.maximumDistance?Math.min(a.maximumDistance,b):b}Object.defineProperty(b,"__esModule",{value:!0});b.optimalDistance=function(b,a){var e=f(b,a),d={ascensionFactor:null!=a.ascensionFactor?a.ascensionFactor:.5,descensionFactor:null!=a.descensionFactor?
a.descensionFactor:.5},k=0===d.ascensionFactor,h=0===d.descensionFactor,c=k?l.tAscensionZoomOnly:l.tAscensionZoomPan,g=k?l.dtAscensionZoomOnly:l.dtAscensionZoomPan,r=k?l.ddtAscensionZoomOnly:l.ddtAscensionZoomPan,p=h?l.tDescensionZoomOnly:l.tDescensionZoomPan,u=h?l.dtDescensionZoomOnly:l.dtDescensionZoomPan,t=h?l.ddtDescensionZoomOnly:l.ddtDescensionZoomPan,k=function(a){return c(b,a,d)+l.tPanion(b,a,d)+p(b,a,d)},h=function(a){return g(b,a,d)+l.dtPanion(b,a,d)+u(b,a,d)},x=function(a){return r(b,a,
d)+l.ddtPanion(b,a,d)+t(b,a,d)},v=k(e),y=l.tBaseLine(b),m=a.maximumIterations||20,w=null!=a.maximumDistance?a.maximumDistance:Infinity;for(a=0;a<m;a++){var A=(h(e)+1E-6)/x(e);if(isNaN(A)||e>=w&&0>A){if(!isFinite(w))return null;e=w;v=k(e);break}e-=A;if(e<b.compared.sourceZoom||e<b.compared.targetZoom)return null;A=k(e);if(.005>=Math.abs(A-v)/v)break;v=A}return v>.7*y||e<b.compared.sourceZoom||e<b.compared.targetZoom?null:e}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.tAscensionZoomPan=function(b,f,h){var a=b.halfWindowPanAtZoom(f-b.compared.sourceZoom);return-b.halfWindowSize*(h.ascensionFactor*Math.LN2*b.compared.pan+a)*Math.log(b.compared.sourceZoom/f)/(b.desiredPixelFlow*Math.LN2*a)};b.dtAscensionZoomPan=function(b,f,h){var a=1/f,e=Math.log(b.compared.sourceZoom*a),d=1/b.desiredPixelFlow,k=1/Math.LN2;f-=b.compared.sourceZoom;var n=1/f;h=(h.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(f))/
b.halfWindowPanAtZoom(1);return b.halfWindowSize*a*d*k*n*h-b.halfWindowSize*e*d*k*n+b.halfWindowSize*e*d*k*h/(f*f)};b.ddtAscensionZoomPan=function(b,f,h){var a=f-b.compared.sourceZoom,e=1/a,d=1/f,k=Math.log(b.compared.sourceZoom*d);h=(h.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(a))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*e*(-2*e*d*h+2*e*k+2*d-2*k*h/(a*a)-h/(f*f))/(b.desiredPixelFlow*Math.LN2)};b.tAscensionZoomOnly=function(b,f){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/
f)/(b.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomOnly=function(b,f){return b.halfWindowSize/(f*b.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomOnly=function(b,f){return-b.halfWindowSize/(f*f*b.desiredPixelFlow*Math.LN2)};b.tPanion=function(b,f,h){return-b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(f))};b.dtPanion=function(b,f,h){return b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(f*f))};b.ddtPanion=function(b,f,h){return-2*b.compared.pan*b.halfWindowSize*(h.ascensionFactor+h.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(f*f*f))};b.tDescensionZoomPan=function(b,f,h){return b.halfWindowSize*(-b.halfWindowPanAtZoom(f)-h.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(f/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-f+b.compared.targetZoom))};b.dtDescensionZoomPan=
function(b,f,h){var a=Math.log(f/b.compared.targetZoom),e=1/b.desiredPixelFlow,d=1/Math.LN2,k=-f+b.compared.targetZoom,n=1/k;h=(-b.halfWindowPanAtZoom(f)-h.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*a*e*d*n+b.halfWindowSize*a*e*d*h/(k*k)+b.halfWindowSize*e*d*n*h/f};b.ddtDescensionZoomPan=function(b,f,h){var a=f-b.compared.targetZoom,e=1/a,d=1/f,k=Math.log(f/b.compared.targetZoom);h=(b.halfWindowPanAtZoom(f)+
h.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*e*(-2*e*d*h-2*e*k+2*d+2*k*h/(a*a)-h/(f*f))/(b.desiredPixelFlow*Math.LN2)};b.tDescensionZoomOnly=function(b,f){return b.halfWindowSize*Math.log(f/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomOnly=function(b,f){return b.halfWindowSize/(f*b.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(b,f){return-b.halfWindowSize/(f*f*b.desiredPixelFlow*
Math.LN2)};b.tBaseLine=function(b){var f=Math.LN2*b.compared.pan,h=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),a=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*h);return b.compared.sourceZoom<=b.compared.targetZoom?a*(f-h):a*(f+h)}})},"esri/views/3d/state/controllers/AnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(a){var c=d.call(this)||this;c.viewAnimation=a;return c}l(b,d);Object.defineProperty(b.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&(this._asyncResult.reject(h.createAbortError()),this._asyncResult=null);this.state===e.State.Finished||this.state===
e.State.Stopped?this.state===e.State.Finished?a.resolve():a.reject(h.createAbortError()):this._asyncResult=a},enumerable:!0,configurable:!0});b.prototype.onControllerStart=function(){var a=this;this.state=e.State.Running;f.isSome(this.viewAnimation)&&this.viewAnimation.when(function(){return a.updateStateFromViewAnimation()},function(){return a.updateStateFromViewAnimation()})};b.prototype.updateStateFromViewAnimation=function(){!f.isSome(this.viewAnimation)||this.state!==e.State.Ready&&this.state!==
e.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&(this.state=e.State.Stopped))};b.prototype.onControllerEnd=function(){f.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===e.State.Finished?this.viewAnimation.finish():this.state===e.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===e.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(h.createAbortError()))};b.prototype.finish=
function(){this.finishController()};return b}(e.CameraController);b.AnimationController=q})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});var e;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped=
"stopped";a.Finished="finished"})(e=b.State||(b.State={}));q=function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.state=e.Ready;return a}l(b,d);Object.defineProperty(b.prototype,"active",{get:function(){return this.state===e.Running},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});b.prototype.stopController=
function(){return this.canStop?(this.state=e.Stopped,!0):!1};b.prototype.finishController=function(){this.state=e.Finished};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});f([a.property({readOnly:!0,dependsOn:["state"]})],b.prototype,"active",null);f([a.property()],b.prototype,"state",void 0);return b=f([a.subclass("esri.views.3d.state.controllers.CameraController")],b)}(a.declared(h));b.CameraController=q})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a,c,d){var b=p.sm4d.get();h.mat4.identity(b);h.mat4.rotate(b,b,d[3],d);k.vec3.subtract(a.eye,a.eye,c);k.vec3.transformMat4(a.eye,a.eye,b);k.vec3.add(a.eye,a.eye,c);k.vec3.subtract(a.center,a.center,c);k.vec3.transformMat4(a.center,a.center,b);k.vec3.add(a.center,a.center,c);k.vec3.transformMat4(a.up,a.up,b);a.markViewDirty()}function v(a,c){k.vec3.set(c,0,0,0);for(var d=0;d<a.length;d++)k.vec3.add(c,c,a[d]);k.vec3.scale(c,c,1/a.length)}function y(a,
d,b){return Math.sin(a/k.vec3.length(d))*(b+c.earthRadius)}function m(a,c,d,b){d=g.ray.fromScreenAtEye(c,d,sa);g.sphere.closestPointOnSilhouette(a,d,R);return g.sphere.intersectRay(a,d,b)?k.vec3.squaredDistance(R,d.origin)<k.vec3.squaredDistance(b,d.origin)?(k.vec3.copy(b,R),!1):!0:(k.vec3.subtract(O,c.eye,c.center),k.vec3.normalize(O,O),g.plane.fromNormalAndOffset(O,-k.vec3.dot(k.vec3.normalize(O,O),R),Q),g.plane.intersectRay(Q,d,b),!1)}function w(a,c,d,e,g,f){k.vec3.cross(ta,a,c);k.vec3.subtract(la,
a,c);k.vec3.length(a)<=g||!e.aboveGround?(k.vec3.cross(d,la,e.eye),a=k.vec3.dot(a,c)/(k.vec3.length(a)*k.vec3.length(c)),f=Math.cos(l.clamp(r.cyclicalPI.normalize(l.deg2rad(f)),0,b.TiltThresholdPanningSpeed)),c=-l.acosClamped(a)-Math.max(0,k.vec3.length(c)-g)/(f*g)):(k.vec3.subtract(T,e.eye,e.center),k.vec3.cross(d,la,T),c=-k.vec3.length(la)/g);k.vec3.normalize(d,d);k.vec3.scale(d,d,k.vec3.length(ta));return c}function A(a,c,d,e){e=Math.cos(l.clamp(r.cyclicalPI.normalize(l.deg2rad(e)),0,b.TiltThresholdPanningSpeed));
c=c>d?-(c-d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):l.acosClamped(c/d);return((a>d?-(a-d)/(e*d):a<-d?Math.PI-(a+d)/(e*d):l.acosClamped(a/d))-c)*d}function B(a,c,d,b,g,f,m,h,p,n){p=A(a[2],c[2],m.radius,p);c=n?A(a[0],c[0],m.radius,180):c[0]-a[0];a=Math.sin(h)*c-Math.cos(h)*p;h=Math.cos(h)*c+Math.sin(h)*p;k.vec3.normalize(ja,g);g=n?a/Math.sqrt(Math.abs(Math.pow(m.radius,2)-Math.pow(k.vec3.dot(d,ja),2))):a/m.radius;d=h/Math.sqrt(Math.abs(Math.pow(m.radius,2)-Math.pow(k.vec3.dot(d,b),2)));e.vec2.set(f,g,d)}function C(a,
c,d,b,e,g,f,m,h,p){k.vec3.cross(ta,a,c);u.coordinateSystemFromOneAxisAndNormalVector(g.up,g.eye,W,aa,V);u.coordinateSystemFromOneAxisAndNormalVector([0,0,1],g.eye,Y,N,Z);k.vec3.copy(d,N);k.vec3.copy(b,Y);k.vec3.normalize(d,d);k.vec3.scale(d,d,k.vec3.length(ta));u.vectorCoordinates(a,k.vec3.normalize(aa,aa),k.vec3.normalize(V,V),k.vec3.normalize(W,W),F);u.vectorCoordinates(c,aa,V,W,ca);B(F,ca,a,Y,N,e,f,m,h,p)}function E(a,c,d,b,e,g,f){h.mat4.identity(ha);h.mat4.identity(ka);h.mat4.identity(ba);h.mat4.rotate(ha,
ha,e,b);h.mat4.rotate(ka,ka,f,g);h.mat4.multiply(ba,ha,ka);k.vec3.subtract(c,a,d);k.vec3.transformMat4(c,c,ba);k.vec3.add(c,c,d)}function G(a,c,d,b,e,g){h.mat4.identity(ha);h.mat4.identity(ka);h.mat4.identity(ba);h.mat4.rotate(ha,ha,b,d);h.mat4.rotate(ka,ka,g,e);h.mat4.multiply(ba,ha,ka);k.vec3.subtract(a.eye,a.eye,c);k.vec3.transformMat4(a.eye,a.eye,ba);k.vec3.add(a.eye,a.eye,c);k.vec3.subtract(a.center,a.center,c);k.vec3.transformMat4(a.center,a.center,ba);k.vec3.add(a.center,a.center,c);k.vec3.subtract(a.up,
a.up,c);k.vec3.transformMat4(a.up,a.up,ba);k.vec3.add(a.up,a.up,c);a.markViewDirty()}function J(a,c,d,e,g,k,f,m){void 0===f&&(f=b.PreservingHeadingThreshold.Pole);void 0===m&&(m=b.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<d*f||Math.abs(c)>d;return(Math.abs(e)>Math.PI-m||Math.abs(e)<m)&&a&&k.aboveGround&&g<b.PreservingHeadingThreshold.Tilt?!0:!1}function I(a,c,d,b,e,k){k?(g.axisAngle.fromPoints(d,b,ea),x(c,a.center,ea)):(d=w(d,b,ua,c,a.radius,e),x(c,a.center,g.axisAngle.wrapAxisAngle(ua,d)))}
function K(a,c,d,b,e,g,f){var m=f?20:1;k.vec3.copy(qa,b);ma.copyFrom(c);for(var h,p=0;p<m&&1E-12<k.vec3.squaredDistance(d,qa);p++)if(b=k.vec3.squaredDistance(d,qa),C(d,qa,N,Y,U,ma,a,e,g,f),G(ma,a.center,Y,U[1],N,U[0]),E(qa,qa,a.center,Y,U[1],N,U[0]),h=k.vec3.squaredDistance(d,qa),h<b||0===p)c.copyFrom(ma);else break}Object.defineProperty(b,"__esModule",{value:!0});b.Earth=g.sphere.fromValues(c.earthRadius,n.vec3f64.create());b.normalizeCoordinate=function(a,c,d){d[0]=c[0]/(a.fullWidth/a.pixelRatio);
d[1]=c[1]/(a.fullHeight/a.pixelRatio);return d};b.rotationFromPointsAroundAxis=function(a,c,d){var b=p.sv3d.get(),e=p.sv3d.get(),g=p.sv3d.get();k.vec3.copy(e,a);k.vec3.copy(g,c);a=k.vec3.dot(e,d);c=k.vec3.dot(g,d);k.vec3.scale(b,d,a);k.vec3.subtract(e,e,b);k.vec3.normalize(e,e);k.vec3.scale(b,d,c);k.vec3.subtract(g,g,b);k.vec3.normalize(g,g);a=k.vec3.dot(e,g);k.vec3.cross(b,d,e);d=k.vec3.dot(g,b);return Math.atan2(d,a)};b.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};b.applyRotation=x;b.intersectPlaneFromScreenPoint=function(a,c,d,b){return g.plane.intersectRay(a,g.ray.fromScreen(c,d,sa),b)};b.applyZoomToPoint=function(a,c,d,b){var e=p.sv3d.get();d=1-d;k.vec3.subtract(e,c,a.eye);var g=k.vec3.length(e),f=g*(1-d);0<=d&&f<b&&(f=b,d=-(f-g)/g);1E-6>Math.abs(g-f)||(k.vec3.scale(e,e,d),k.vec3.add(a.eye,a.eye,e),k.vec3.lerp(a.center,a.center,c,d))};b.applyZoomOnSphere=function(a,c,d){c.getScreenCenter(H);g.sphere.intersectScreen(a,c,H,c.center);c.markViewDirty();
a=c.distance;d*=a;1E-6>Math.abs(a-d)||(d=k.vec3.scale(p.sv3d.get(),c.viewForward,d),k.vec3.subtract(c.eye,c.center,d),c.markViewDirty())};var H=f.createScreenPointArray();b.centroidOnSphere=function(a,c,d){v(c,d);k.vec3.normalize(d,d);k.vec3.scale(d,d,a)};b.centroid=v;b.onSurfaceTiltToEyeTiltGlobal=y;b.offSurfaceTiltToEyeTiltGlobal=function(a,c,d){return y(Math.PI/2,c,d)+(a-Math.PI/2)};var L;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(L=b.PanMode||(b.PanMode={}));b.VerticalPanTresholds=
{Elevation:3E4,Angle:l.deg2rad(8)};b.PreservingHeadingThreshold={Pole:.95,Angle:l.deg2rad(18),Tilt:45};b.TiltThresholdPanningSpeed=l.deg2rad(80);b.pickPointAndInitSphere=function(a,c,d,e){var f=n.vec3f64.create(),h=g.sphere.create(),p=!0;a.intersectScreen(d,f)?h.radius=k.vec3.length(f):(h.radius=c.aboveGround?Math.max(k.vec3.length(c.center),.9*b.Earth.radius):k.vec3.length(c.eye)-c.relativeElevation,e?m(h,c,d,f):p=g.sphere.intersectScreen(h,c,d,f));return{sphere:h,scenePickPoint:p?f:null}};b.decidePanMode=
function(a,c,d){var e=k.vec3.length(a.eye);if(Math.abs(e-b.Earth.radius)>b.VerticalPanTresholds.Elevation)return L.Horizontal;if(a.aboveGround===c.radius>e)return L.Vertical;k.vec3.subtract(P,a.eye,d);k.vec3.normalize(P,P);return Math.abs(.5*Math.PI-l.acosClamped(k.vec3.dot(d,P)/k.vec3.length(d)))<b.VerticalPanTresholds.Angle?L.Vertical:L.Horizontal};var P=n.vec3f64.create();b.applyPanPlanar=function(a,c,d){k.vec3.subtract(S,d,c);k.vec3.subtract(a.eye,a.eye,S);k.vec3.subtract(a.center,a.center,S);
a.markViewDirty()};var S=n.vec3f64.create();b.sphereOrPlanePointFromScreenPoint=m;var R=n.vec3f64.create(),O=n.vec3f64.create(),Q=g.plane.create();b.rotationAngleAndAxisDirectRotation=w;var T=n.vec3f64.create();b.lengthFromPoints=A;b.rotationAnglesHeadingPreserving=B;b.rotationAnglesAndAxesHeadingPreserving=C;b.rotatePointAroundTwoAxes=E;b.applyRotationWithTwoAxes=G;b.preserveHeadingThreshold=J;b.applyPanSphericalDirectRotation=I;b.applyPanSphericalPreserveHeading=K;b.panToPosition=function(a,c,d,
e,g,f,m){J(d,k.vec3.dot(c.up,d),a.radius,-r.cyclicalPI.normalize(l.deg2rad(g)),f,c,b.PreservingHeadingThreshold.Pole,b.PreservingHeadingThreshold.Angle)?K(a,c,d,e,-r.cyclicalPI.normalize(l.deg2rad(g)),f,m):I(a,c,d,e,f,m)};b.panMotionToRotationMatrix=function(a,c,d,b,e,g,f,m,n){if(J(a.center,k.vec3.dot(a.up,a.center),k.vec3.length(a.center),-r.cyclicalPI.normalize(l.deg2rad(g)),f,c))switch(a=-r.cyclicalPI.normalize(l.deg2rad(e)),u.coordinateSystemFromOneAxisAndNormalVector([0,0,1],c.eye,Y,N,Z),e=d.translation[0]*
b.pan,g=d.translation[1]*b.pan,c=Math.max(Math.sqrt(Math.abs(1-Math.pow(k.vec3.dot(c.center,Y),2)/Math.pow(k.vec3.length(c.center),2))),.5),f=-Math.cos(a)*g+Math.sin(a)*e,h.mat4.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(a)*g+Math.cos(a)*e)/c,Y),m.pan.enabled=!0,n.mode){case "pan":h.mat4.rotate(m.pan.matrix,m.pan.matrix,f,N);m.pan.enabled=!0;break;case "zoom":m.zoom=-d.translation[1]*b.zoom}else switch(a=c.eye,c=c.viewRight,a=k.vec3.cross(p.sv3d.get(),c,a),e=d.translation[0]*b.pan,0!==e&&(h.mat4.rotate(m.pan.matrix,
m.pan.matrix,-e,a),m.pan.enabled=!0),n.mode){case "pan":d=d.translation[1]*b.pan;0!==d&&(h.mat4.rotate(m.pan.matrix,m.pan.matrix,d,c),m.pan.enabled=!0);break;case "zoom":m.zoom=-d.translation[1]*b.zoom}};var Y=n.vec3f64.create(),N=n.vec3f64.create(),Z=n.vec3f64.create(),W=n.vec3f64.create(),aa=n.vec3f64.create(),V=n.vec3f64.create(),F=n.vec3f64.create(),ca=n.vec3f64.create(),U=d.vec2f64.create(),ea=g.axisAngle.create(),ha=a.mat4f64.create(),ka=a.mat4f64.create(),ba=a.mat4f64.create(),qa=n.vec3f64.create(),
ja=n.vec3f64.create(),la=n.vec3f64.create(),ma=new t.default,ta=n.vec3f64.create(),ua=n.vec3f64.create(),sa={origin:n.vec3f64.create(),direction:n.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l,f,h){function a(a){return{operations:a,value:a.create()}}function e(a,d,b,e){return a.operations.setAltitudeAt(a.value,
d,b,e)}Object.defineProperty(b,"__esModule",{value:!0});b.create=function(a){var c=a.operations;return{operations:c,value:c.create(a.value)}};b.setExtent=function(a,d,b){a.operations.setExtent(a.value,d,b.value);return b};b.createFromOperations=a;b.fromValues=function(c,d,b){void 0===b&&(b=a(c));b.operations=c;c.copy(d,b.value);return b};b.wrap=function(a,d){k.operations=a;k.value=d;return k};b.normalAt=function(a,d,b){return a.operations.axisAt(a.value,d,2,b)};b.axisAt=function(a,d,b,e){return a.operations.axisAt(a.value,
d,b,e)};b.intersectRay=function(a,d,b){return a.operations.intersectRay(a.value,d,b)};b.intersectsRay=function(a,d){return a.operations.intersectRay(a.value,d,null)};b.closestPoint=function(a,d,b){return a.operations.closestPoint(a.value,d,b)};b.intersectRayClosestSilhouette=function(a,d,b){return a.operations.intersectRayClosestSilhouette(a.value,d,b)};b.closestPointOnSilhouette=function(a,d,b){return a.operations.closestPointOnSilhouette(a.value,d,b)};b.distanceToSilhouette=function(a,d){return a.operations.distanceToSilhouette(a.value,
d)};b.altitudeAt=function(a,d){return a.operations.altitudeAt(a.value,d)};b.setAltitudeAt=e;b.setAltitudeOfTransformation=function(a,b,k,h){b!==h&&l.mat4.copy(h,b);f.vec3.set(d,h[12],h[13],h[14]);e(a,d,k,d);h[12]=d[0];h[13]=d[1];h[14]=d[2];return h};b.elevate=function(a,d,b){return a.operations.elevate(a.value,d,b.value)};var d=h.vec3f64.create(),k={operations:null,value:null};b.vectorCoordinates=function(a,d,b,e,k){k[0]=f.vec3.dot(a,d);k[1]=f.vec3.dot(a,b);k[2]=f.vec3.dot(a,e);return k};b.coordinateSystemFromOneAxisAndNormalVector=
function(a,d,b,e,k){f.vec3.copy(b,a);f.vec3.copy(n,d);f.vec3.normalize(n,n);f.vec3.cross(e,n,b);f.vec3.cross(k,e,b)};var n=h.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function b(a,b){b=c.call(this,a.state,a.sceneIntersectionHelper,b)||this;b.view=a;b.zoomLocation=h.vec3f64.create();b.tmpCamera=new d.default;b.tmpRayDir=h.vec3f64.create();b.tmpCenter=h.vec3f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new d.default,interactionDirection:null,tiltMode:0};return b}l(b,c);b.prototype.zoomStep=function(a,c){if(this.active){var d=
this.view.state,b=this.constraintOptions.interactionStartCamera;this.animation.finished?b.copyFrom(d.camera):this.animation.cameraAt(1,b);this.tmpCamera.copyFrom(d.camera);d=new k(this.view.viewingMode);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,d,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,d,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:
f.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:n.outExpo}};b.prototype.updateCamera=function(c,d,b){f.vec3.subtract(this.tmpRayDir,b,c.eye);var e=f.vec3.length(this.tmpRayDir),g=e*d;1>=d&&4>g&&(g=4,d=g/e);1E-6>Math.abs(e-g)||(f.vec3.scale(this.tmpRayDir,this.tmpRayDir,d),f.vec3.subtract(c.eye,b,this.tmpRayDir),f.vec3.lerp(c.center,
c.center,b,1-d),a.applyAll(this.view,c,this.constraintOptions))};return b}(e.PointToPointAnimationController);b.ZoomStepController=q})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.eventMatchesPointerAction=function(b,f){switch(f){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};
b.eventMatchesMousePointerAction=function(b,f){if("touch"===b.pointerType)return!1;switch(f){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,
"__esModule",{value:!0});q=function(a){function d(d,c,b,e){var g=a.call(this,!0)||this;g.view=d;g.pointerAction=c;g.pivotPoint=b;g.registerIncoming("drag",e,function(a){return g.handleDrag(a)});return g}l(d,a);d.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&e.eventMatchesMousePointerAction(a.data,this.pointerAction)){var d=f.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=
null);this.cameraController=new h.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return d}(a.InputHandler);b.DragRotate=q})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function r(c,e,g){var k=b.call(this)||this;k.view=c;k.intersectionHelper=e;k.pivot=g;k.lastPoint=d.vec2f64.create();k.tmpWorldUp=n.vec3f64.create();k.tmpViewDir=n.vec3f64.create();k.tmpRotCurPoint=d.vec2f64.create();k.tmpTransf=a.mat4f64.create();k.tmpAxis=n.vec3f64.create();k.pivotPos=n.vec3f64.create();k.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};k.rotScale="center"===g?3:1.5;return k}l(r,b);r.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":k.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||k.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;p.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};r.prototype.update=function(a){if(this.active){var d;switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,d,this.pivotPos);c.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};r.prototype.end=function(){this.active&&this.finishController()};r.prototype.applyRotation=function(a,c,d,b){this.view.renderCoordsHelper.worldUpAtPosition(b,this.tmpWorldUp);p.normalizeCoordinate(a,c,this.tmpRotCurPoint);c=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var m=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;k.vec3.subtract(this.tmpViewDir,d,b);var n=k.vec3.length(this.tmpViewDir),n=f.acosClamped(k.vec3.dot(this.tmpViewDir,
this.tmpWorldUp)/n);if("eye"===this.pivot){var r=.5*Math.PI-n,t=.495*Math.PI;c=r-Math.max(-t,Math.min(t,r+-.5*c))}c=f.clamp(c+n,g.TiltDefault.min,g.TiltDefault.max)-n;h.mat4.identity(this.tmpTransf);k.vec3.cross(this.tmpAxis,a.up,this.tmpViewDir);"center"===this.pivot&&(m=-m);h.mat4.rotate(this.tmpTransf,this.tmpTransf,m,this.tmpWorldUp);h.mat4.rotate(this.tmpTransf,this.tmpTransf,c,this.tmpAxis);k.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);k.vec3.add(d,b,this.tmpViewDir);
k.vec3.transformMat4(a.up,a.up,this.tmpTransf);e.vec2.copy(this.lastPoint,this.tmpRotCurPoint);a.markViewDirty()};return r}(r.InteractiveController);b.RotateController=q})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var d=null!==a&&a.apply(this,arguments)||
this;d.beginCamera=new h.default;d.currentCamera=new h.default;return d}l(b,a);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(a,b){b.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(b)};b.prototype.onControllerStart=function(a){this.state=f.State.Running;this.beginCamera.copyFrom(a);this.currentCamera.copyFrom(a)};b.prototype.onControllerEnd=function(a){a.copyViewFrom(this.currentCamera)};
return b}(f.CameraController);b.InteractiveController=q})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(a,d,e){var c=b.call(this,!0)||this;
c.view=a;c.pointerAction=d;c.registerIncoming("drag",e,function(a){return c.handleDrag(a)});return c}l(e,b);e.prototype.handleDrag=function(c){var b=c.data;if(!(1<b.pointers.size)&&d.eventMatchesMousePointerAction(c.data,this.pointerAction)){var e=f.createScreenPointArray(b.center.x,b.center.y);switch(b.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=this.view.state.isGlobal?new h.ZoomController(this.view,this.view.sceneIntersectionHelper):
new a.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}c.stopPropagation()}};return e}(e.InputHandler);b.DragZoom=q})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function p(c,e){var k=b.call(this)||this;k.view=c;k.intersectionHelper=e;k.pickPoint=d.vec3f64.create();k.tmpP0=a.vec2f64.create();k.panAxisAngle=g.axisAngle.create();k.tmpRayDir=d.vec3f64.create();k.targetOnSphere=d.vec3f64.create();k.dragBeginPoint=f.createScreenPointArray();k.normalizedAnchorPoint=a.vec2f64.create();k.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};k.sphere=g.sphere.create();k.hasPickPoint=!1;return k}l(p,b);p.prototype.begin=function(a){this.active&&(h.vec2.copy(this.dragBeginPoint,a),c.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=c.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};p.prototype.update=function(a){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;e.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var d=e.vec3.length(this.tmpRayDir);c.normalizeCoordinate(this.currentCamera,a,this.tmpP0);var b=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),f=d*Math.pow(2,b),h=this.view.state.constraints.minimumPoiDistance;0>b&&f<h&&(f=h);1E-6>Math.abs(d-f)||(this.hasPickPoint&&f<d&&(b=1-(1-f/d)*(1-this.sphere.radius/
e.vec3.length(this.currentCamera.center)),e.vec3.scale(this.currentCamera.center,this.currentCamera.center,b)),e.vec3.scale(this.tmpRayDir,this.tmpRayDir,-f/d),e.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,a),k.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(c.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),g.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),c.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),k.applySurfaceCollisionConstraint(this.view,this.currentCamera))}};p.prototype.end=function(){this.active&&this.finishController()};return p}(n.InteractiveController);b.ZoomController=q})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function b(a,d){var b=c.call(this)||this;b.view=a;b.intersectionHelper=d;b.tmpP=k.vec3f64.create();b.tmpN=k.vec3f64.create();b.tmpP0=e.vec2f64.create();b.tmpPoi=k.vec3f64.create();b.tmpRayDir=k.vec3f64.create();b.dragBeginPoint=h.createScreenPointArray();b.normalizedAnchorPoint=e.vec2f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:k.vec3f64.create(),
tiltMode:0};b.plane=r.plane.create();return b}l(b,c);b.prototype.begin=function(c){this.active&&(a.vec2.copy(this.dragBeginPoint,c),g.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(c,this.tmpP),d.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),d.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&d.vec3.negate(this.tmpN,this.tmpN),r.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};b.prototype.update=function(c){if(this.active){g.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||d.vec3.copy(this.tmpPoi,this.currentCamera.center);g.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var b=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);a.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);d.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var e=d.vec3.length(this.tmpRayDir),k=e*(1-b);d.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);d.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,f.sign(b)/e);var m=this.view.state.constraints.minimumPoiDistance;0<=b&&k<m&&(k=m,b=-(k-e)/e);1E-6>Math.abs(e-k)||(d.vec3.scale(this.tmpRayDir,this.tmpRayDir,b),d.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),d.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,b),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=n.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),n.applyAll(this.view,this.currentCamera,this.constraintOptions))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(c.InteractiveController);b.ZoomController=q})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(a){var c=d.call(this,!0)||this;c.view=a;c.watchHandles=new f;c.handle=c.registerIncoming("gamepad",function(a){return c.handleEventGamepad(a)});c.handle.pause();return c}l(b,d);b.prototype.onInstall=function(a){var c=this;d.prototype.onInstall.call(this,a);this.watchHandles.add([h.init(this.view.navigation.gamepad,"enabled",function(a){a?c.handle.resume():(c.handle.pause(),c.cameraControllerGamepad&&
(c.cameraControllerGamepad.finishController(),c.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(a){c.cameraControllerGamepad&&a&&c.cameraControllerGamepad.gamepadDevice!==a&&(c.cameraControllerGamepad.finishController(),c.cameraControllerGamepad=null)})])};b.prototype.onUninstall=function(){this.watchHandles.removeAll();d.prototype.onUninstall.call(this)};b.prototype.handleEventGamepad=function(d){var c=this.view.navigation.gamepad.device;if(!c||d.data.device===
c)if((c=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||a.GamepadKeyboardController.activatesFor(this.view,d.data))c||(c=new a.GamepadKeyboardController(this.view,d.data.device),this.view.state.switchCameraController(c)&&(this.cameraControllerGamepad=c)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===d.data.device&&this.cameraControllerGamepad.handleEventGamepad(d.data)};return b}(e.InputHandler);b.GamepadNavigation=
q})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(a,c,d){var e=b.call(this)||this;e.view=a;e.gamepadDevice=c;e.disableMovements=d;e.transformation={translation:[0,0,0],heading:0,tilt:0};e.keysButtonState=[0,0,0,0,0,0,0,0,0,0];e.tmpCamera=new A.default;e.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new A.default,interactionFactor:0,interactionDirection:null,tiltMode:1};return e}l(e,b);e.prototype.handleEventGamepad=
function(a){var c=B.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||B.isZeroTransformation(c))&&this.finishController()};e.prototype.activateDirection=function(a){this.keysButtonState[a]=1;B.extractTransformationKeyboard(this.keysButtonState,this.transformation)};e.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=B.extractTransformationKeyboard(this.keysButtonState,this.transformation);B.isZeroTransformation(a)&&this.finishController()};
e.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;b.prototype.onControllerStart.call(this,a)};e.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};e.prototype.stepController=function(a,c){this.updateStartHeading();this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(c);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,L);this.applyDisabledMovementTypes(L);this.applyPan(L.pan);this.applyRotate(L.rotate);this.applyZoom(L.zoom);this.applyAscend(L.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;n.applyAll(this.view,this.currentCamera,this.constraintOptions);b.prototype.stepController.call(this,a,c)};e.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};e.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,b=c.center,e=c.up,g=c.eye;d.vec3.subtract(b,b,g);d.vec3.transformMat4(b,b,a.matrix);d.vec3.add(b,b,g);d.vec3.transformMat4(e,e,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;n.applyAll(this.view,c,this.constraintOptions)}};e.prototype.applyPan=function(a,c){void 0===c&&(c=this.currentCamera);
if(a.enabled){var b=c.center,e=c.eye,g=c.up;d.vec3.transformMat4(e,e,a.matrix);d.vec3.transformMat4(b,b,a.matrix);this.view.state.isGlobal&&d.vec3.transformMat4(g,g,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;n.applyAll(this.view,c,this.constraintOptions)}};e.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,b=c.eye,c=c.viewForward;d.vec3.add(b,b,d.vec3.scale(w.sv3d.get(),c,a));this.currentCamera.markViewDirty();d.vec3.copy(P,
c);d.vec3.negate(P,P);this.constraintOptions.interactionDirection=P;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;n.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};e.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,b=c.center,c=c.eye,e=this.view.renderCoordsHelper.worldUpAtPosition(c,w.sv3d.get());this.constraintOptions.interactionDirection=d.vec3.copy(P,e);this.view.state.isGlobal?(e=d.vec3.length(c),
a=(e+a)/e,d.vec3.scale(c,c,a),d.vec3.scale(b,b,a)):(a=d.vec3.scale(w.sv3d.get(),e,a),d.vec3.add(c,c,a),d.vec3.add(b,b,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;n.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;n.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};e.prototype.calculateControlTransformation=
function(c,d,b){b.zoom=0;b.ascend=0;b.pan.enabled=!1;a.mat4.identity(b.pan.matrix);b.rotate.enabled=!1;a.mat4.identity(b.rotate.matrix);c=this.computeVelocities(c);this.view.state.isLocal?this.calculateControlTransformationLocal(c,d,b):this.calculateControlTransformationGlobal(c,d,b)};e.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);
this.currentCamera.markViewDirty()};e.prototype.calculateControlTransformationLocal=function(b,e,g){var k=e.viewRight,m=e.viewForward,p=this.transformation,n=this.view.navigation.gamepad,m=d.vec3.set(w.sv3d.get(),m[0],m[1],0);d.vec3.normalize(m,m);var r=p.translation[0]*b.pan;0!==r&&(r=d.vec3.scale(w.sv3d.get(),k,r),a.mat4.translate(g.pan.matrix,g.pan.matrix,r),g.pan.enabled=!0);switch(n.mode){case "pan":n=-p.translation[1]*b.pan;0!==n&&(n=d.vec3.scale(w.sv3d.get(),m,n),a.mat4.translate(g.pan.matrix,
g.pan.matrix,n),g.pan.enabled=!0);break;case "zoom":g.zoom=-p.translation[1]*b.zoom;break;default:f.neverReached(n.mode)}g.ascend=p.translation[2]*b.ascend;n=-p.heading*b.rotate;0!==n&&(a.mat4.rotate(g.rotate.matrix,g.rotate.matrix,n,this.view.renderCoordsHelper.worldUpAtPosition(e.eye,w.sv3d.get())),g.rotate.enabled=!0);b=p.tilt*b.rotate;e=u.viewAngle(this.view.renderCoordsHelper,e.center,e.eye);if(e=h.clamp(e+b,c.TiltDefault.min,c.TiltDefault.max)-e)a.mat4.rotate(g.rotate.matrix,g.rotate.matrix,
e,k),g.rotate.enabled=!0};e.prototype.calculateControlTransformationGlobal=function(c,b,e){var g=b.eye,k=b.viewRight,f=this.transformation,m=this.view.navigation.gamepad,g=d.vec3.cross(w.sv3d.get(),k,g);d.vec3.normalize(g,g);d.vec3.negate(g,g);r.panMotionToRotationMatrix(this.beginCamera,b,f,c,this.view.camera.heading,this.headingStart,this.view.camera.tilt,e,m);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(L.pan,this.tmpCamera);m=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
e.ascend=f.translation[2]*c.ascend;g=-f.heading*c.rotate;0!==g&&(a.mat4.rotate(e.rotate.matrix,e.rotate.matrix,g,this.tmpCamera.eye),e.rotate.enabled=!0);c=this.clampTiltDeltaGlobalToValidRange(f.tilt*c.rotate,b.ray,m);0!==c&&(a.mat4.rotate(e.rotate.matrix,e.rotate.matrix,c,this.tmpCamera.viewRight),e.rotate.enabled=!0)};e.prototype.clampTiltDeltaGlobalToValidRange=function(a,b,e){var g=p.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.min,b.origin,e),k=0,f=0,k=w.sv3d.get();this.view.renderCoordsHelper.intersectManifold(b,
e,k)?(k=u.viewAngle(this.view.renderCoordsHelper,k,b.origin),k=p.onSurfaceTiltToEyeTiltGlobal(k,b.origin,e),f=p.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,e)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(e+v.earthRadius),b,k),k=h.acosClamped(-d.vec3.dot(b.direction,d.vec3.normalize(k,k))),k=p.offSurfaceTiltToEyeTiltGlobal(k,b.origin,e),f=p.offSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,b.origin,e));return h.clamp(k+a,g,f)-k};e.prototype.getPointAbsoluteSurfaceElevation=function(a,
c,b){var e=this.view.renderCoordsHelper,g=e.getAltitude(a);c+=Math.abs(g-c);d.vec3.copy(b,a);e.setAltitude(c,b);return c};e.prototype.clampedDistanceToSurface=function(a,c){var b=this.view.renderCoordsHelper,e=this.view.state.camera,g=t.headingTiltToDirectionUp(this.view,c,0,E,S).direction,g=b.intersectManifoldClosestSilhouette(y.ray.wrap(c,g),a,w.sv3d.get()),g=d.vec3.distance(c,g);a=b.intersectManifoldClosestSilhouette(y.ray.wrap(c,m.directionFromTo(w.sv3d.get(),c,e.center)),a,w.sv3d.get());c=d.vec3.distance(c,
a);return Math.min(g,c)};e.prototype.computeHeadingRotateRadius=function(a){var c=this.view,b=c.renderCoordsHelper,e=c.state,c=e.isGlobal,e=b.intersectManifoldClosestSilhouette(e.camera.ray,this.filteredSurfaceElevation,w.sv3d.get());if(c)return c=d.vec3.subtract(w.sv3d.get(),a,e),b=d.vec3.length(c),d.vec3.scale(c,c,1/b),a=d.vec3.normalize(w.sv3d.get(),a),a=h.acosClamped(d.vec3.dot(a,c)),b*Math.sin(Math.min(G,a));a=d.vec3.copy(w.sv3d.get(),a);b.setAltitude(this.filteredSurfaceElevation,a);return d.vec3.distance(e,
a)};e.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:I};e.prototype.computeVelocities=function(a){var c=this.filteredSurfaceElevation,d=c+v.earthRadius,b=this.view.state,e=b.camera,g=b.isGlobal,k=w.sv3d.get(),f=this.getPointAbsoluteSurfaceElevation(e.eye,c,k),m=this.clampedDistanceToSurface(c,k),p=e.width/2,n=J*e.width,b=J*e.width,e=m*Math.tan(.5*e.fovX)/p,r=e/d,d=e/this.computeHeadingRotateRadius(k),g=(g?r:e)*n*a,c=f-c,c=Math.max(this.minimumAscendVelocity()*
a,Math.pow(2,n*a/p)*c-c),m=Math.pow(2,n*a/p)*m-m;a*=h.clamp(d*b,K,H);return{pan:g,ascend:c,zoom:m,rotate:a}};e.prototype.applyDisabledMovementTypes=function(c){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(c.zoom=this.disableMovements.zoom?0:c.zoom,c.ascend=this.disableMovements.ascend?0:c.ascend,c.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&a.mat4.identity(c.pan.matrix),c.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&a.mat4.identity(c.rotate.matrix))};e.activatesFor=function(a,c){a=B.extractTransformation(c,a.navigation.gamepad,C);return!("end"===c.action||B.isZeroTransformation(a))};return e}(g.InteractiveController);b.GamepadKeyboardController=q;var C={translation:[0,0,0],heading:0,tilt:0},E=80,G=h.deg2rad(E),J=.75,I=5,K=h.deg2rad(30),H=h.deg2rad(80),L={zoom:0,ascend:0,pan:{enabled:!1,matrix:e.mat4f64.create()},rotate:{enabled:!1,matrix:e.mat4f64.create()}},P=k.vec3f64.create(),
S=x.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../core/Logger ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./ElevationProvider ./mathUtils ./projectionUtils ../../support/spatialReferenceSupport".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){function B(a){return"global"===a.viewingMode?x:t}function C(a,c,b){var e=a.state.camera,g=e.fovX,e=e.width/2/e.pixelRatio;"global"===a.viewingMode&&null!=b&&(c*=Math.cos(d.deg2rad(b)));c/=a.renderCoordsHelper.unitInMeters;return e/(96*39.37/c)/Math.tan(g/2)}function E(a,c,b){var e=a.state.camera;c=96*39.37/(e.width/2/e.pixelRatio/(c*Math.tan(e.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(d.deg2rad(b)));return c*=a.renderCoordsHelper.unitInMeters}
function G(a,c,d,b,e,g){if(T(g)){var k=Q(g.signal);P(a,b.heading,b.tilt,c,d,e,k);k.resolver.promise.then(function(c){return g.resolver.resolve(O(a,c,b.fov))},function(a){return g.resolver.reject(a)})}else return c=P(a,b.heading,b.tilt,c,d,e),O(a,c,b.fov,g)}function J(a,c,d,b,e){return B(a).directionToHeadingTilt(c,d,b,e)}function I(a,c){return!!(a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(c,V,a.spatialReference)&&y.getElevationAtPoint(a.basemapTerrain,V)>V.z-1)}function K(a,c,d){return h(this,
void 0,void 0,function(){var b;return f(this,function(e){switch(e.label){case 0:return a.renderCoordsHelper.fromRenderCoords(c,V,a.spatialReference)?[4,a.elevationProvider.queryElevation(V,d)]:[2,!1];case 1:return b=e.sent(),[2,b>V.z-1]}})})}function H(a,d,b){return h(this,void 0,void 0,function(){var e,k;return f(this,function(f){switch(f.label){case 0:e=c.vec3f64.create();if(d)return[3,1];n.vec3.copy(e,a.state.camera.center);return[3,5];case 1:if(!(d instanceof g))return[3,4];w.pointToVector(d,
e,a.renderSpatialReference);return null!=d.z||null==a.basemapTerrain?[3,3]:[4,a.elevationProvider.queryElevation(d,b)];case 2:return k=f.sent(),null!=k&&a.renderCoordsHelper.setAltitude(k,e),[2,e];case 3:return[3,5];case 4:n.vec3.copy(e,d),f.label=5;case 5:return[2,e]}})})}function L(a,d){var b=c.vec3f64.create();d&&d instanceof g?(w.pointToVector(d,b,a.renderSpatialReference),null==d.z&&null!=a.basemapTerrain&&(d=y.getElevationAtPoint(a.elevationProvider,d),null!=d&&a.renderCoordsHelper.setAltitude(d,
b))):d?n.vec3.copy(b,d):n.vec3.copy(b,a.state.camera.center);return b}function P(a,c,d,b,e,k,f){var m=b&&b instanceof g?b:null;if(T(f))H(a,b,f.signal).then(function(b){S(a,c,d,m,b,e,k,f)},function(a){return f.resolver.reject(a)});else return b=L(a,b),S(a,c,d,m,b,e,k,f)}function S(a,d,b,e,g,k,f,m){e||(e=w.vectorToPoint(g,a.renderSpatialReference,a.spatialReference||r.WGS84));k=Math.max(k,a.state.constraints.minimumPoiDistance);var h=R(a,d,b,g,k,f),p=B(a).eyeForCenterWithHeadingTilt,n=p(g,k,h.heading,
h.tilt);if(f===U.ADJUST&&"global"===a.viewingMode&&0<b){var t=function(){var c=k,h=k,p=a.state.constraints.tilt(h),h=B(a).eyeTiltToLookAtTilt(b,g,h),h=Math.min(h,.5*Math.PI),p=p.min*(1-ea)+h*ea,c=B(a).lookAtTiltToEyeTilt(p,g,c);f=1>b-c?U.LOCKED:U.ADJUST;return S(a,d,c,e,g,k,f,m)};if(I(a,n.eye))return t();if(T(m)){K(a,n.eye,m.signal).then(function(a){if(a)return t();m.resolver.resolve({eye:n.eye,up:n.up,center:c.vec3f64.clone(g),heading:n.heading,tilt:n.tilt})});return}}h=!m||T(m)?{center:c.vec3f64.create(),
eye:c.vec3f64.create(),up:c.vec3f64.create(),tilt:0,heading:0}:m;h.eye=n.eye;h.up=n.up;h.center=c.vec3f64.clone(g);h.heading=n.heading;h.tilt=n.tilt;T(m)&&m.resolver.resolve(h);return h}function R(a,c,d,b,e,g){var k=0;if(g=g===U.ADJUST)if(k=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(e/k)/Math.LN2)g=!0;else{var f=a.renderSpatialReference,m=a.spatialReference||r.WGS84;g=w.vectorToPoint(b,f,m);f=w.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f,m);k*=Math.tan(.5*
a.state.camera.fov);g=5<f.distance(g)/k}g?(c=0,g=a.state.constraints.tilt(e),g.max=Math.min(g.max,.5*Math.PI),g=g.min*(1-ea)+g.max*ea,d=B(a).eyeTiltToLookAtTilt(d,b,e),k=Math.min(d,g)):k=B(a).eyeTiltToLookAtTilt(d,b,e);d=k=a.state.constraints.clampTilt(e,k);d=B(a).lookAtTiltToEyeTilt(d,b,e);return{heading:c,tilt:d}}function O(c,d,b,e){c=w.vectorToPoint(d.eye,c.renderSpatialReference,c.spatialReference||r.WGS84);return c?e?(e.position=c,e.heading=d.heading,e.tilt=d.tilt,e.fov=b,e):new a(c,d.heading,
d.tilt,b):null}function Q(a){return{resolver:k.createResolver(),signal:a}}function T(a){return a&&"resolver"in a}Object.defineProperty(b,"__esModule",{value:!0});var Y=e.getLogger("esri.views.3d.support.cameraUtils"),N=c.vec3f64.create(),Z=c.vec3f64.create(),W=c.vec3f64.create(),aa={heading:0,tilt:0},V=new g,F=new m.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),ca=new m.Cyclical(-180,180),U;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(U=b.OrientationMode||(b.OrientationMode=
{}));b.headingTiltToDirectionUp=function(a,c,d,b,e){return B(a).headingTiltToDirectionUp(c,d,b,e)};b.externalToInternal=function(a,b){var e=a.renderSpatialReference,g=B(a).headingTiltToDirectionUp,k=c.vec3f64.create();if(!w.pointToVector(b.position,k,e))return null;e=g(k,b.heading,b.tilt);n.vec3.scale(e.direction,e.direction,a.state.camera.distance);n.vec3.add(e.direction,e.direction,k);a=u.cameraOnContentAlongViewDirection(a,k,e.direction,e.up);a.fov=d.deg2rad(b.fov);return a};b.internalToExternal=
function(c,b,e){var k=c.renderSpatialReference,f=n.vec3.copy(W,b.viewForward),f=J(c,b.eye,f,b.up,aa);c=c.spatialReference||r.WGS84;w.vectorToVector(b.eye,k,N,c)||(c=r.WGS84,w.vectorToVector(b.eye,k,N,c));if(!e)return new a(new g(N,c),f.heading,f.tilt,d.rad2deg(b.fov));e.position.x=N[0];e.position.y=N[1];e.position.z=N[2];e.position.spatialReference=c;e.heading=f.heading;e.tilt=f.tilt;e.fov=d.rad2deg(b.fov);return e};b.scaleToDistance=C;b.distanceToScale=E;b.fromCenterScale=function(a,c,d,b,e,g){d=
C(a,d,c.latitude);return G(a,c,d,b,e,g)};b.fromCenterDistance=G;b.directionToHeadingTilt=J;b.getObserverForPointAtDistance=P;b.fromExtent=function(a,c,d,b,e,k){var f,m=0;null!=c.zmax&&null!=c.zmin&&(f=(c.zmax+c.zmin)/2,m=c.zmax-c.zmin);var h,p;if("global"===a.viewingMode){if(!A.isSpatialReferenceSupported(c.spatialReference,"global"))return T(k)&&k.resolver.reject(),null;var n=new g(c.xmin,c.ymin,c.spatialReference),w=new g(c.xmax,c.ymax,c.spatialReference),t=c.spatialReference.isGeographic?ca:F;
c=new g(t.center(n.x,w.x),(w.y+n.y)/2,c.spatialReference);null!=f&&(c.z=f);p=v.getGreatCircleSpanAt(c,n,w);h=p.lon;p=p.lat;t.diff(n.x,w.x)>t.range/2&&(h+=v.halfEarthCircumference);h=Math.min(h,v.halfEarthCircumference);p=Math.min(p,v.halfEarthCircumference)}else n=a.spatialReference||r.WGS84,h=c.xmax-c.xmin,p=c.ymax-c.ymin,c=new g({x:c.xmin+.5*h,y:c.ymin+.5*p,z:f,spatialReference:n});f=a.state.camera;m=Math.max(1/Math.tan(f.fovX/2)*h*.5,1/Math.tan(f.fovY/2)*p*.5,1/Math.tan(f.fov/2)*m*.5)/1;if(T(k))h=
Q(k.signal),P(a,d,b,c,m,e,h),h.resolver.promise.then(function(c){return k.resolver.resolve(O(a,c,a.camera.fov))},function(a){return k.resolver.reject(a)});else return d=P(a,d,b,c,m,e),O(a,d,a.camera.fov,k)};b.toExtent=function(a,c,d){var b=a.renderSpatialReference,e=n.vec3.dist(c.eye,d);d=w.vectorToPoint(d,b,a.spatialReference||r.WGS84);b=2*e*Math.tan(c.fovX/2)*1;c=2*e*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?x.toExtent(a,d,b,c):t.toExtent(a,d,b,c)};var ea=.7;b.observerToCamera=O;b.scaleToZoom=
function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(c);Y.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.zoomToScale=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(c);Y.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};b.scaleToResolution=function(a,c){return a.spatialReference?p.getResolutionForScale(c,a.spatialReference):void 0};b.computeScale=function(c,
d,b){var e=c.renderSpatialReference;d||(d=c.state.camera);var g;g=r.WGS84;d instanceof a?(g=d.position.latitude,w.pointToVector(d.position,N,e),w.pointToVector(b,Z,e),d=n.vec3.distance(N,Z)):(w.vectorToVector(d.center,e,Z,g),g=Z[1],d=d.distance);return E(c,d,g)};b.createAsyncContext=Q;b.isAsyncContext=T})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n){function c(c,d,b,e){void 0===e&&(e=k.createDirectionUp());f.mat4.identity(p);c=e.direction;var m=e.up;f.mat4.rotateZ(p,p,-l.deg2rad(d));f.mat4.rotateX(p,p,l.deg2rad(b));a.vec3.transformMat4(c,r,p);a.vec3.scale(c,c,-1);a.vec3.transformMat4(m,g,p);return e}Object.defineProperty(b,"__esModule",{value:!0});var g=e.vec3f64.fromValues(0,1,0),r=e.vec3f64.fromValues(0,0,1),p=h.mat4f64.create(),u=e.vec3f64.create(),t=e.vec3f64.create();b.headingTiltToDirectionUp=c;b.directionToHeadingTilt=
function(a,c,d,b){return k.directionToHeadingTilt(c,d,b,r,g)};b.eyeForCenterWithHeadingTilt=function(d,b,g,k){var f=c(d,g,k),m=e.vec3f64.create();a.vec3.scale(m,f.direction,-b);a.vec3.add(m,m,d);return{up:f.up,eye:m,heading:g,tilt:k}};b.lookAtTiltToEyeTilt=function(a){return l.rad2deg(a)};b.eyeTiltToLookAtTilt=function(a){return l.deg2rad(a)};b.toExtent=function(a,c,b,e,g){var k=a.renderSpatialReference;a=a.map&&a.spatialReference||c.spatialReference;n.pointToVector(c,u,k);n.pointToVector(c,t,k);
u[0]-=b/2;t[0]+=b/2;u[1]-=e/2;t[1]+=e/2;n.vectorToVector(u,k,u,a);n.vectorToVector(t,k,t,a);g?(g.xmin=u[0],g.ymin=u[1],g.xmax=t[0],g.ymax=t[1],g.spatialReference=a):g=new d(u[0],u[1],t[0],t[1],a);return g}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=h.vec3f64.create(),e=h.vec3f64.create();
b.createDirectionUp=function(){return{direction:h.vec3f64.create(),up:h.vec3f64.create()}};b.directionToHeadingTilt=function(d,b,h,c,g){var k=a;f.vec3.normalize(k,d);var p=f.vec3.dot(k,c),n=0<p,p=Math.abs(p);.99<p&&(p=Math.abs(f.vec3.dot(b,c)),.99>p?(f.vec3.copy(k,b),n&&f.vec3.scale(k,k,-1)):k=null);b=0;k&&(f.vec3.scale(e,c,f.vec3.dot(c,k)),f.vec3.subtract(k,k,e),b=f.vec3.dot(k,g)/(f.vec3.length(k)*f.vec3.length(g)),f.vec3.cross(e,k,g),b=(0<f.vec3.dot(e,c)?1:-1)*l.rad2deg(l.acosClamped(b)));d=l.rad2deg(l.acosClamped(-f.vec3.dot(c,
d)/f.vec3.length(d)));if(!h)return{heading:b,tilt:d};h.heading=b;h.tilt=d;return h}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){function p(d,b,e,g){void 0===g&&(g=c.createDirectionUp());a.vec3.cross(w,d,x);0===a.vec3.dot(w,w)&&a.vec3.cross(w,d,v);f.mat4.identity(m);f.mat4.rotate(m,m,-l.deg2rad(b),d);f.mat4.rotate(m,m,-l.deg2rad(e),w);b=g.up;e=g.direction;a.vec3.cross(b,w,d);a.vec3.normalize(b,b);a.vec3.transformMat4(b,b,m);a.vec3.normalize(e,d);a.vec3.negate(e,e);a.vec3.transformMat4(e,e,m);return g}function u(a){var c=a[1];a[1]=-a[2];a[2]=c}function t(a,c){c=p(c,a.heading,a.tilt);a.up=
c.up;return a}Object.defineProperty(b,"__esModule",{value:!0});var x=e.vec3f64.fromValues(0,0,1),v=a.vec3.normalize(e.vec3f64.create(),e.vec3f64.fromValues(1,1,1)),y=new r.Cyclical(-180,180),m=h.mat4f64.create(),w=e.vec3f64.create(),A=e.vec3f64.create();b.headingTiltToDirectionUp=p;b.directionToHeadingTilt=function(d,b,e,g){var k=w;a.vec3.normalize(k,d);a.vec3.cross(A,k,x);0===a.vec3.dot(A,A)&&a.vec3.cross(A,k,v);a.vec3.cross(A,A,k);return c.directionToHeadingTilt(b,e,g,k,A)};b.eyeForCenterWithHeadingTilt=
function(c,d,b,g){var k={eye:e.vec3f64.create(),up:null,tilt:g,heading:b},f=w;f[0]=c[0];f[1]=c[2];f[2]=-c[1];b=l.deg2rad(b);var m=l.deg2rad(g);g=Math.sin(b);b=Math.cos(b);var h=Math.sin(m),p=Math.cos(m),n=a.vec3.length(f);if(1E-8>Math.abs(m))m=d+n;else var r=n/h,v=l.asinClamped(d/r),m=r*Math.sin(Math.PI-m-v);var r=h*d,p=p*d,v=b*r,x=m-p,y=x*x,A=d*d*h*h,h=b*b*A,A=g*g*A,B=f[1]*x,C=h*(h+y-f[1]*f[1]);if(0>C)return a.vec3.scale(k.eye,f,m/n),k.tilt=0,k;var E=Math.sqrt(C),C=h+y,B=0<b?-E+B:E+B;if(1E-8>Math.abs(C))return 1E-8>
n?(k.eye[0]=0,k.eye[1]=0,k.eye[2]=d):a.vec3.scale(k.eye,f,m/n),k.tilt=0,u(k.eye),t(k,c);k.eye[1]=B/C;C=k.eye[1]*k.eye[1];d=1-C;B=Math.sqrt(d);v=h*C+A-2*v*k.eye[1]*B*x+d*y;if(1E-8>Math.abs(v))return a.vec3.scale(k.eye,f,m/n),k.tilt=0,u(k.eye),t(k,c);k.eye[0]=(d*(m*f[0]-p*f[0])-r*B*(f[0]*k.eye[1]*b+f[2]*g))/v;k.eye[2]=(d*(m*f[2]-p*f[2])-r*B*(f[2]*k.eye[1]*b-f[0]*g))/v;a.vec3.scale(k.eye,k.eye,m);u(k.eye);return t(k,c)};b.lookAtTiltToEyeTilt=function(c,d,b){d=a.vec3.length(d);b=l.asinClamped(b/(Math.sqrt(b*
b+d*d-2*b*d*Math.cos(Math.PI-c))/Math.sin(c)));return l.rad2deg(c-b)};b.eyeTiltToLookAtTilt=function(c,d,b){c=l.deg2rad(c);d=a.vec3.length(d);return l.asinClamped(b/(d/Math.sin(c)))+c};b.toExtent=function(a,c,b,e,f){function m(a){var c=Math.PI/2;a=r.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var h;h=c.latitude;c=c.longitude;var p=g.getLonDeltaForDistance(h,b)/2;b=c-p;c+=p;h=l.deg2rad(h);p=g.earthRadius;h=(1+Math.sin(h))/(1-Math.sin(h));var w=(h+1)*Math.tan(e/p/2);h=1.5*Math.PI-2*Math.atan(.5*
(w+Math.sqrt(4*h+w*w)));e=h+e/p;h=m(h);e=m(e);e<h&&(p=e,e=h,h=p);h=Math.max(l.rad2deg(h),-90);e=Math.min(l.rad2deg(e),90);c=y.monotonic(b,c);180<c-b&&(p=(c-b-180)/2,b+=p,c-=p);p=a.spatialReference&&a.spatialReference.isGeographic?a.spatialReference:k.WGS84;f?(f.xmin=b,f.ymin=h,f.xmax=c,f.ymax=e,f.spatialReference=p):f=new d(b,h,c,e,p);a.spatialReference&&a.spatialReference.isWebMercator&&n.geographicToWebMercator(f,!1,f);return f}})},"esri/views/support/spatialReferenceSupport":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.isSpatialReferenceSupported=function(b,f){return null==b?!1:"2d"===f?!0:"local"===f?!b.isGeographic:b.isWebMercator||b.isWGS84||4490===b.wkid}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],function(q,b,l){function f(b){var a=b*b;0>b&&(a*=-1);return a}Object.defineProperty(b,"__esModule",{value:!0});b.quadraticAccentuation=f;b.resetTransformation=
function(b){b.translation[0]=0;b.translation[1]=0;b.translation[2]=0;b.heading=0;b.tilt=0;return b};b.extractTransformation=function(b,a,e){var d=b.state;b=b.device;a="forward-down"===a.tiltDirection?1:-1;"standard"===b.deviceType?(e.translation[0]=f(d.axes[0]),e.translation[1]=f(d.axes[1]),e.translation[2]=f(d.buttons[7])-f(d.buttons[6]),e.heading=f(d.axes[2]),e.tilt=f(d.axes[3])):"spacemouse"===b.deviceType&&(e.translation[0]=1.2*f(d.axes[0]),e.translation[1]=1.2*f(d.axes[1]),e.translation[2]=2*
-f(d.axes[2]),e.heading=1.2*f(d.axes[5]),e.tilt=1.2*f(d.axes[3]));e.tilt*=a;l.vec3.scale(e.translation,e.translation,1);return e};b.extractTransformationKeyboard=function(b,a){a.translation[0]=b[1]-b[0];a.translation[1]=b[3]-b[2];a.translation[2]=b[4]-b[5];a.heading=b[7]-b[6];a.tilt=b[8]-b[9];return a};b.isZeroTransformation=function(b){return 0===b.translation[0]&&0===b.translation[1]&&0===b.translation[2]&&0===b.heading&&0===b.tilt}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(d,b,e){var c,g=a.call(this,!0)||this;g.view=d;g.disableMovements={pan:!0,zoom:!0,ascend:!0,rotate:!1,mode:"local"};g.keyToNumber=(c={},c[b.left]=0,c[b.right]=1,c[b.forward]=2,c[b.backward]=3,c[b.up]=4,c[b.down]=5,c[b.headingLeft]=6,c[b.headingRight]=7,c[b.tiltUp]=8,c[b.tiltDown]=
9,c);g.registerIncoming("key-down",e,function(a){return g.handleKeyDown(a)});g.registerIncoming("key-up",e,function(a){return g.handleKeyUp(a)});g.registerIncoming("blur",e,function(){return g.handleBlur()});return g}l(b,a);b.prototype.handleKeyDown=function(a){var d=this.keyToNumber[a.data.key];null!=d&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new f.GamepadKeyboardController(this.view,void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(d),a.stopPropagation()))};b.prototype.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};b.prototype.handleKeyUp=function(a){var d=this.keyToNumber[a.data.key];null!=d&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(d),
a.stopPropagation())};return b}(h.InputHandler);b.KeyboardNavigation=q})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(a,c){var b=d.call(this,!0)||this;b.view=
a;b.registerIncoming("mouse-wheel",c,function(a){return b.handleMouseWheel(a)});return b}l(b,d);b.prototype.handleMouseWheel=function(b){if(this.view.navigation.mouseWheelZoomEnabled){var c=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new h.ZoomStepController(this.view,"interaction"):new a.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*c.deltaY,
f.createScreenPointArray(c.x,c.y));b.preventDefault();b.stopPropagation()}};return b}(e.InputHandler);b.MouseWheelZoom=q})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});
q=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.view=b;e.pointerAction=c;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}l(b,a);b.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||e.eventMatchesMousePointerAction(a.data,this.pointerAction)){var c=a.timestamp-this.lastEndTimestamp,c=this.momentum&&this.momentum.active&&40>c;switch(a.data.action){case "start":case "update":if(c)break;this.controller&&this.controller.active?
2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};b.prototype.endController=function(a,c){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),c&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));this.controller=
null};b.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new f.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new h.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return b}(a.InputHandler);b.PinchAndPanNavigation=q})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function r(a,c){var d=b.call(this)||this;d.view=a;d.intersectionHelper=c;d.smoothRotation=new g.ExponentialFalloff(.05);d.rotationAxis=n.vec3f64.create();d.panningPlane=w.plane.create();d.smoothScaling=new g.ExponentialFalloff(.05);d.zoomCenterScreen=h.createScreenPointArray();d.zoomMomentumEstimator=new J.ZoomMomentumEstimator;d.rotationMomentumEstimator=new G.RotationMomentumEstimator;
d.panSphericalMomentumEstimator=new E.PanSphericalMomentumEstimator;d.panPlanarMomentumEstimator=new C.PanPlanarMomentumEstimator;d.adjustedSphere=w.sphere.create();d.tmp3d=n.vec3f64.create();d.tmpMat=e.mat4f64.create();d.tmpAxisAngle=w.axisAngle.create();d.tmpScreenPointArray=h.createScreenPointArray();d.beginScreenPoint=h.createScreenPointArray();d.beginScenePoint=n.vec3f64.create();d.screenPickPoint=h.createScreenPointArray();d.panMode=m.PanMode.Horizontal;d.tmpInteractionDirection=n.vec3f64.create();
d.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new B.default,interactionDirection:null,tiltMode:0};return d}l(r,b);r.prototype.begin=function(a){if(this.active){var c=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=c;this.rotationMomentumEstimator.enabled=c;this.panPlanarMomentumEstimator.enabled=c;this.panSphericalMomentumEstimator.enabled=c;this.beginHeading=-A.cyclicalPI.normalize(f.deg2rad(this.view.camera.heading));this.beginRadius=
a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();h.screenPointObjectToArray(a.center,this.screenPickPoint);d.vec2.copy(this.beginScreenPoint,this.screenPickPoint);c=y.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;k.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=y.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===
m.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};r.prototype.preparePlanarPanModeOverground=function(a){var c=k.vec3.negate(this.tmp3d,this.beginCamera.viewForward);w.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var d=h.createScreenPointArray(this.screenPickPoint[0],0),c=n.vec3f64.create(),b=k.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=
b<this.sphere.radius?b-100:this.sphere.radius;y.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,c);d=h.createRenderScreenPointArray3();this.beginCamera.projectPoint(c,d);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*d[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&w.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);a=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,
this.beginCamera,a,this.beginScenePoint)};r.prototype.preparePlanarPanMode=function(c){var d=k.vec3.negate(this.tmp3d,this.beginCamera.viewForward);w.plane.fromPositionAndNormal(this.scenePickPoint,d,this.panningPlane);var b=w.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),d=w.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),b=-d[3]-(this.currentCamera.aboveGround?.25:.025)*b;if(0<b){var e=a.mat4.identity(this.tmpMat);a.mat4.rotate(e,e,-b,d);k.vec3.subtract(this.scenePickPoint,
this.scenePickPoint,this.sphere.center);k.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,e);k.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);w.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);c=h.screenPointObjectToArray(c.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,c,this.beginScenePoint)}};r.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var c=1<a.pointers.size;this.panMode===m.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};r.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===m.PanMode.Horizontal?new v.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,
this.beginScenePoint,this.sphere.radius):new x.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new t.RotationMomentumController(this.view,a,this.sphere.center,this.rotationAxis);if(this.panMode===m.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new u.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new p.PanPlanarMomentumController(this.view,
a);return null};r.prototype.zoomSpherical=function(a){var d=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(d);y.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);h.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-
this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.panningSpherical=function(a){var d=h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,d,this.tmp3d);y.preserveHeadingThreshold(this.beginScenePoint,k.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(y.applyPanSphericalPreserveHeading(this.sphere,
this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(d,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(y.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(d,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,
this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.screenPickPoint,d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.rotateSpherical=function(a){k.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||k.vec3.negate(this.rotationAxis,this.rotationAxis);var d=this.smoothRotation.value,b=y.normalizeRotationDelta(a.angle-d),d=d+b;this.smoothRotation.gain=
.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(d);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,w.axisAngle.wrapAxisAngle(this.rotationAxis,b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.panningPlanar=function(a){var d=
h.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,d,this.tmp3d)&&(y.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(d,this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.beginScreenPoint,d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
this.tmpInteractionDirection),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};r.prototype.zoomPlanar=function(a){var d=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(d);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);y.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};r.prototype.rotatePlanar=function(a){k.vec3.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||k.vec3.negate(this.rotationAxis,this.rotationAxis);var d=this.smoothRotation.value,b=a.angle-d,b=y.normalizeRotationDelta(b);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,
40),120);this.smoothRotation.update(d+b);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,w.axisAngle.wrapAxisAngle(this.rotationAxis,d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};return r}(r.InteractiveController);b.PinchAndPanController=q})},"esri/views/3d/input/util":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._gain=b}b.prototype.reset=function(b){this._value=b};Object.defineProperty(b.prototype,"gain",{set:function(b){this._gain=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});b.prototype.update=function(b){this._value=void 0===this._value?b:this._gain*b+(1-this._gain)*this._value};
return b}();b.ExponentialFalloff=q})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function d(d,b){d=a.call(this,d,4)||this;d.momentum=b;d.tmpPan=h.vec3f64.create();return d}l(d,a);d.prototype.momentumStep=
function(a,d){a=this.momentum.value(a);f.vec3.scale(this.tmpPan,this.momentum.direction,a);f.vec3.subtract(d.eye,d.eye,this.tmpPan);f.vec3.subtract(d.center,d.center,this.tmpPan);d.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return d}(a.MomentumController);b.PanPlanarMomentumController=q})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../ViewAnimation ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function d(d,c){var b=a.call(this,new f)||this;b.view=d;b.beginCamera=new e.default;b.elapsedTimeSec=0;b.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new e.default,interactionDirection:null,tiltMode:0};b.constraintOptions.interactionType=c;return b}l(d,a);Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},
enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(d){this.beginCamera.copyFrom(d);this.constraintOptions.interactionStartCamera=this.beginCamera;a.prototype.onControllerStart.call(this,d)};d.prototype.stepController=function(a,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=a;this.momentumStep(this.elapsedTimeSec,c);h.applyAll(this.view,c,this.constraintOptions)};return d}(a.AnimationController);b.MomentumController=q})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});var d=h.vec3f64.create(),k=h.vec3f64.create();q=function(a){function c(c,d){c=a.call(this,c,4)||this;c.momentum=d;return c}l(c,a);c.prototype.momentumStep=function(a,c){var b=this.momentum.value1(a);a=this.momentum.value2(a);f.vec3.copy(k,c.eye);f.vec3.normalize(k,k);f.vec3.cross(this.momentum.axis2,k,this.momentum.axis1);e.applyRotationWithTwoAxes(c,d,this.momentum.axis1,b,this.momentum.axis2,a)};return c}(a.MomentumController);
b.PanSphericalMomentumController=q})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(c,d,b,e){c=a.call(this,c,2)||this;c.momentum=
d;c.axis=h.vec3f64.create();c.center=h.vec3f64.create();f.vec3.copy(c.axis,e);f.vec3.copy(c.center,b);return c}l(b,a);b.prototype.momentumStep=function(a,b){a=this.momentum.value(a);e.applyRotation(b,this.center,d.axisAngle.wrapAxisAngle(this.axis,a))};return b}(a.MomentumController);b.RotationMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(c,d,b){c=a.call(this,c,1)||this;c.momentum=d;c.zoomCenter=h.vec3f64.create();f.vec3.copy(c.zoomCenter,b);c.constraintOptions.interactionDirection=h.vec3f64.create();return c}l(b,a);b.prototype.momentumStep=function(a,b){f.vec3.copy(this.constraintOptions.interactionDirection,b.eye);a=this.momentum.valueDelta(0,a);e.applyZoomToPoint(b,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=d.directionFromTo(this.constraintOptions.interactionDirection,b.eye,this.constraintOptions.interactionDirection)};return b}(a.MomentumController);b.ZoomPlanarMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(d,g,k,n,r){d=b.call(this,d,1)||this;d.momentum=g;d.screenCenter=f.createScreenPointArray();d.sceneCenter=e.vec3f64.create();d.tmpSceneCenter=e.vec3f64.create();d.tmpZoomAxisAngle=c.axisAngle.create();d.sphere=c.sphere.create();h.vec2.copy(d.screenCenter,k);a.vec3.copy(d.sceneCenter,n);d.sphere.radius=r;return d}l(g,b);g.prototype.momentumStep=function(a,b){a=this.momentum.valueDelta(0,a);n.applyZoomOnSphere(this.sphere,
b,a);this.constraintOptions.interactionType=1;d.applyAll(this.view,b,this.constraintOptions);n.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);c.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);n.applyRotation(b,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return g}(k.MomentumController);b.ZoomSphericalMomentumController=q})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});var d=function(a){function d(c,d,b,e,k){c=a.call(this,c,d,b)||this;c.sceneVelocity=e;c.direction=k;return c}l(d,a);d.prototype.value=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,c)};return d}(e.Momentum);b.PanPlanarMomentum=d;q=function(){function b(d,c,b){void 0===d&&(d=300);void 0===c&&(c=12);void 0===b&&(b=.84);this.minimumInitialVelocity=d;this.stopVelocity=c;this.friction=b;this.enabled=
!0;this.time=new a.FilteredFiniteDifference(.6);this.screen=[new a.FilteredFiniteDifference(.4),new a.FilteredFiniteDifference(.4)];this.scene=[new a.FilteredFiniteDifference(.6),new a.FilteredFiniteDifference(.6),new a.FilteredFiniteDifference(.6)];this.tmpDirection=h.vec3f64.create()}b.prototype.add=function(a,c,d){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(c[0]),this.scene[1].update(c[1]),
this.scene[2].update(c[2]),this.time.update(d))};b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,
this.friction)};b.prototype.createMomentum=function(a,c,b){f.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var e=f.vec3.length(this.tmpDirection);0<e&&f.vec3.scale(this.tmpDirection,this.tmpDirection,1/e);return new d(a,c,b,e/this.time.filteredDelta,this.tmpDirection)};return b}();b.PanPlanarMomentumEstimator=q})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(b){this.gain=b}b.prototype.update=function(b){if(this.hasLastValue){var f=this.computeDelta(b);this.updateDelta(f)}this.lastValue=b};b.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(b.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,
configurable:!0});b.prototype.computeDelta=function(b){return b-this.lastValue};b.prototype.updateDelta=function(b){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*b:b};return b}();b.FilteredFiniteDifference=q})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e){this._initialVelocity=b;this._stopVelocity=a;this._friction=
e;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(b.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});b.prototype.isFinished=function(b){return b>this.duration};Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});b.prototype.value=function(b){return this.valueFromInitialVelocity(this._initialVelocity,b)};b.prototype.valueDelta=
function(b,a){var e=this.value(b);return this.value(b+a)-e};b.prototype.valueFromInitialVelocity=function(b,a){a=Math.min(a,this.duration);var e=1-this.friction;return b*(Math.pow(e,a)-1)/Math.log(e)};return b}();b.Momentum=q})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});var c=function(a){function c(c,b,d,e,g,k,f){void 0===k&&(k=0);c=a.call(this,c,b,d)||this;c.angularVelocity1=e;c.axis1=g;c.angularVelocity2=k;c.axis2=f;return c}l(c,a);c.prototype.value1=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,c)};c.prototype.value2=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,c)};return c}(n.Momentum);b.PanSphericalMomentum=
c;q=function(){function b(c,b,e){void 0===c&&(c=300);void 0===b&&(b=12);void 0===e&&(e=.84);this.minimumInitialVelocity=c;this.stopVelocity=b;this.friction=e;this.enabled=!0;this.tmpAxis1=a.vec3f64.create();this.tmpAxis2=a.vec3f64.create();this.tmpAngles=f.vec2f64.create();this.time=new d.FilteredFiniteDifference(.3);this.screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this.angle1=new k.FilteredValue(.6);this.angle2=new k.FilteredValue(.6);this.axis1=a.vec3f64.create();
this.axis2=a.vec3f64.create();this.lastScene=a.vec3f64.create()}b.prototype.addMomentumDirectRotation=function(a,c,b,d,g,k){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;d=e.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,d,g,k);this.angle2.update(0);1E-5>h.vec3.squaredLength(this.tmpAxis2)?d=0:h.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(d);h.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);
this.time.update(b)}};b.prototype.addMomentumPreserveHeading=function(a,c,b,d,g,k,f){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;e.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,d,g,k,f,!1);1E-5>h.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),h.vec3.normalize(this.axis1,this.tmpAxis1),h.vec3.normalize(this.axis2,
this.tmpAxis2));h.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(b)}};b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?
null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(a,b,d){return new c(a,b,d,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return b}();b.PanSphericalMomentumEstimator=q})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.gain=b}b.prototype.update=function(b){this.filteredValue=
this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*b:b};b.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(b.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return b}();b.FilteredValue=q})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});
q=function(b){function a(a,d,k,f){void 0===a&&(a=3);void 0===d&&(d=.01);void 0===k&&(k=.95);void 0===f&&(f=12);return b.call(this,a,d,k,f)||this}l(a,b);a.prototype.add=function(a,d){if(this.value.hasLastValue){var e=this.value.lastValue;for(a-=e;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;a=e+a}b.prototype.add.call(this,a,d)};return a}(f.MomentumEstimator);b.RotationMomentumEstimator=q})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,e,c){void 0===a&&(a=2.5);void 0===b&&(b=.01);void 0===e&&(e=.95);void 0===c&&(c=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=e;this.maxVelocity=c;this.enabled=!0;this.value=new h.FilteredFiniteDifference(.8);this.time=new h.FilteredFiniteDifference(.3)}b.prototype.add=function(a,b){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var d=
this.value.computeDelta(a);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(b);this.value.update(a)}};b.prototype.reset=function(){this.value.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,a=f.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=
function(b,e,f){return new a.Momentum(b,e,f)};return b}();b.MomentumEstimator=q})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){function b(b,d,c){return a.call(this,b,d,c)||this}l(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,
d){var c=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+d);return Math.exp(b-c)};return b}(f.Momentum);b.ZoomMomentum=a;q=function(b){function d(a,d,c,e){void 0===a&&(a=2.5);void 0===d&&(d=.01);void 0===c&&(c=.95);void 0===e&&(e=12);return b.call(this,a,d,c,e)||this}l(d,b);d.prototype.add=function(a,d){b.prototype.add.call(this,Math.log(a),d)};d.prototype.createMomentum=function(b,d,c){return new a(b,d,c)};return d}(h.MomentumEstimator);b.ZoomMomentumEstimator=q})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){Object.defineProperty(b,"__esModule",{value:!0});var m;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(m=b.PanMode||(b.PanMode={}));var w=e.vec3f64.fromValues(0,0,1),A=16/180*Math.PI;q=function(b){function n(a,c){var d=b.call(this)||this;d.view=a;d.intersectionHelper=c;d.rotationValueSmooth=new k.ExponentialFalloff(.05);d.scalingValueSmooth=new k.ExponentialFalloff(.05);d.planeHorizontal=u.plane.create();d.planeVertical=u.plane.create();
d.rotationMomentumEstimator=new v.RotationMomentumEstimator;d.panMomentumEstimator=new x.PanPlanarMomentumEstimator(300,12,.9);d.zoomMomentumEstimator=new y.ZoomMomentumEstimator;d.beginCenter=e.vec3f64.create();d.tmpPoints=[];d.beginCenterScreen=h.createScreenPointArray();d.tmpCentroid3d=e.vec3f64.create();d.tmpCentroid2d=h.createScreenPointArray();d.tmp2d=h.createScreenPointArray();d.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new t.default,interactionDirection:null,
tiltMode:0};return d}l(n,b);n.prototype.begin=function(c){if(this.active){var b=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=b;this.rotationMomentumEstimator.enabled=b;this.panMomentumEstimator.enabled=b;this.beginRadius=c.radius;this.pointerCount=c.pointers.size;this.beginAngle=c.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();h.screenPointObjectToArray(c.center,this.beginCenterScreen);u.plane.fromNormalAndOffset(w,0,this.planeHorizontal);b=e.vec3f64.create();
this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,b);var d=e.vec3f64.create();a.vec3.negate(d,this.beginCamera.viewForward);var g=e.vec3f64.create();a.vec3.copy(g,w);var k=a.vec3.dot(d,g);this.panMode=f.asinClamped(0>k?-k:k)>=A?m.Horizontal:m.Vertical;u.plane.setOffsetFromPoint(this.planeHorizontal,b,this.planeHorizontal);this.beginCamera.aboveGround||u.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===m.Vertical?(a.vec3.scale(g,g,k),a.vec3.subtract(this.planeVertical,
d,g),a.vec3.normalize(this.planeVertical,this.planeVertical),u.plane.setOffsetFromPoint(this.planeVertical,b,this.planeVertical),this.computePlanePoints(c.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(c.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};n.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var c=1<a.pointers.size,b=this.panMode===m.Horizontal?this.planeHorizontal:this.planeVertical,e=this.beginCenter;if(c){var g=this.beginRadius/a.radius,k=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=k;this.scalingValueSmooth.update(g);p.applyZoomToPoint(this.currentCamera,e,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=
d.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));d.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,b,this.currentCamera,this.tmpPoints);p.centroid(this.tmpPoints,this.tmpCentroid3d);h.screenPointObjectToArray(a.center,this.tmpCentroid2d);p.applyPanPlanar(this.currentCamera,e,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=
d.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);d.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal,b=this.rotationValueSmooth.value,g=p.normalizeRotationDelta(a.angle-b),k=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=k,this.rotationValueSmooth.update(b+g),k=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(k,.001*a.timestamp),p.applyRotation(this.currentCamera,e,u.axisAngle.wrapAxisAngle(c,
k)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=d.pixelDistanceToInteractionFactor(Math.abs(a.radius*k)),d.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};n.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new r.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?
new g.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal):(a=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,a):null};n.prototype.computePlanePoints=function(a,c,b,d){d.length=a.size;var g=this.tmp2d,k=0;a.forEach(function(a){g[0]=a.x;g[1]=a.y;void 0===d[k]&&(d[k]=e.vec3f64.create());p.intersectPlaneFromScreenPoint(c,b,g,d[k]);k+=1});return d};return n}(n.InteractiveController);b.PinchAndPanController=q})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function a(a,d){var e=b.call(this,!0)||this;e.view=a;e.registerIncoming("pointer-down",d,function(){return e.view.state.stopActiveCameraController()});return e}l(a,b);return a}(f.InputHandler);b.PointerDownCancelAnimation=q})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function a(a,d,k){k=b.call(this,d,k)||this;k.view=a;k.key=d;return k}l(a,b);a.prototype.activate=function(){this.view.goTo({heading:0})};return a}(f.SingleKey);b.SingleKeyResetHeading=q})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});
q=function(b){function a(a,d){var e=b.call(this,!0)||this;e.key=a;e.registerIncoming("key-down",d,function(a){return e._handleKeyDown(a)});return e}l(a,b);a.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return a}(f.InputHandler);b.SingleKey=q})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],function(q,b,l,f){Object.defineProperty(b,"__esModule",
{value:!0});q=function(b){function a(a,d,k){k=b.call(this,d,k)||this;k.view=a;k.key=d;return k}l(a,b);a.prototype.activate=function(){this.view.goTo({tilt:0})};return a}(f.SingleKey);b.SingleKeyResetTilt=q})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});
q=function(a){function b(b,d){void 0===d&&(d=!1);var c=a.call(this,!0)||this;c.view=b;c.invert=d;c.registerIncoming("vertical-two-finger-drag",function(a){return c.handleTwoFinger(a)});return c}l(b,a);b.prototype.handleTwoFinger=function(a){var b=f.createScreenPointArray(0,a.data.delta*(this.invert?-1:1));switch(a.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new h.RotateController(this.view,this.view.sceneIntersectionHelper,
"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(b);break;case "update":this.cameraController&&this.cameraController.update(b);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return b}(a.InputHandler);b.TwoFingerTilt=q})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});var d=l("trident"),k=l("edge"),n=l("chrome"),c=l("ff"),g=l("safari");q=function(){function b(a,c){var b=this;this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=a;h.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,
"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new e.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return b._callback("gamepad",
a)}}b.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._releasePointerCaptureSafe(c)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(b.prototype,"browserTouchPanningEnabled",{get:function(){return this._browserTouchPanningEnabled},set:function(a){this._browserTouchPanningEnabled=
a;this._updateTouchAction();this._updateTouchEventHandling()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"activeEvents",{set:function(a){var c=this,b;for(b in this._active)a&&a.has(b)||(this._element.removeEventListener(r[b],this._active[b]),delete this._active[b]);a&&a.forEach(function(a){if(!c._active[a]&&r[a]){var b=(c._eventHandlers[a]||c._handleDefault).bind(c,
a);c._element.addEventListener(r[a],b);c._active[a]=b}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});b.prototype.setPointerCapture=function(a,c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};b.prototype._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":
"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};b.prototype._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};b.prototype._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};b.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(t){}};b.prototype._updateNormalizedPointerLikeEvent=function(a,c){a=f.createScreenPointFromNativeEvent(this._element,a);b.test.disableSubpixelCoordinates&&(a.x=Math.round(a.x),a.y=Math.round(a.y));c.x=a.x;c.y=a.y;return c};b.prototype._handleKey=function(c,
b){var d=a.eventKey(b);d&&"key-up"===c&&this._keyDownState.delete(d);b={native:b,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===c&&this._keyDownState.add(b.key);this._callback(c,b)};b.prototype._handlePointer=function(a,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(a,c)};b.prototype._handlePointerPreventDefault=function(a,c){var b=this._updateNormalizedPointerLikeEvent(c,
{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(a,b)};b.prototype._handleMouseWheel=function(a,b){var e=b.deltaY;switch(b.deltaMode){case 0:if(d||k)e=e/document.documentElement.clientHeight*600;break;case 1:e*=30;break;case 2:e*=900}d||k?e*=.7:n||g?e*=.6:c&&(e*=1.375);var f=Math.abs(e);100<f&&(e=e/f*200/(1+Math.exp(-.02*(f-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:e});this._callback(a,
b)};b.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(a,c)};b.prototype._handleDefault=function(a,c){var b={native:c};c.preventDefault();this._callback(a,b)};b.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};b.prototype._preventMultiTouchPanning=function(a){1<a.touches.length&&a.preventDefault()};b.test={disableSubpixelCoordinates:!1};return b}();b.BrowserEventSource=q;var r={"key-down":"keydown",
"key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function q(a,b){b=b||Object.create(null);var d=document.createEvent("Event");d.initEvent(a,
b.bubbles||!1,b.cancelable||!1);a=2;for(var e;a<n.length;a++)e=n[a],d[e]=b[e]||c[a];d.buttons=b.buttons||0;a=0;a=b.pressure&&d.buttons?b.pressure:d.buttons?.5:0;d.x=d.clientX;d.y=d.clientY;d.pointerId=b.pointerId||0;d.width=b.width||0;d.height=b.height||0;d.pressure=a;d.tiltX=b.tiltX||0;d.tiltY=b.tiltY||0;d.twist=b.twist||0;d.tangentialPressure=b.tangentialPressure||0;d.pointerType=b.pointerType||"";d.hwTimestamp=b.hwTimestamp||0;d.isPrimary=b.isPrimary||!1;return d}function b(){this.array=[];this.size=
0}function l(a,c,b,d){this.addCallback=a.bind(d);this.removeCallback=c.bind(d);this.changedCallback=b.bind(d);B&&(this.observer=new B(this.mutationWatcher.bind(this)))}function f(a){return"body /shadow-deep/ "+h(a)}function h(a){return'[touch-action\x3d"'+a+'"]'}function a(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function e(){if(J){E.forEach(function(c){String(c)===c?(G+=h(c)+a(c)+"\n",I&&(G+=f(c)+a(c)+"\n")):(G+=c.selectors.map(h)+a(c.rule)+"\n",I&&(G+=c.selectors.map(f)+a(c.rule)+
"\n"))});var c=document.createElement("style");c.textContent=G;document.head.appendChild(c)}}function d(a){if(!x.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function k(a){for(var c=a.parentNode;c&&c!==a.ownerDocument;)c=c.parentNode;if(!c)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var n="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),c=[!1,!1,null,null,
0,0,0,0,!1,!1,!1,!1,0,null,0,0],g=window.Map&&window.Map.prototype.forEach?Map:b;b.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(b,d){a.call(c,b,d,this)},this)}};var r="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},t="undefined"!==typeof SVGElementInstance,x={pointermap:new g,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var b=c.events;b&&(b.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,b=0,d;b<c&&(d=this.eventSourceList[b]);b++)d.register.call(d,a)},unregister:function(a){for(var c=this.eventSourceList.length,b=0,d;b<c&&(d=this.eventSourceList[b]);b++)d.unregister.call(d,a)},contains:function(a,c){try{return a.contains(c)}catch(ha){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new q(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),b,d=0;d<r.length;d++)b=r[d],c[b]=a[b]||p[d],t&&("target"===b||"relatedTarget"===b)&&c[b]instanceof SVGElementInstance&&(c[b]=c[b].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in u))return c},propagate:function(a,
c,b){for(var d=a.target,e=[];null!=d&&d!==document&&!d.contains(a.relatedTarget);)if(e.push(d),d=d.parentNode,!d)return;b&&e.reverse();e.forEach(function(b){a.target=b;c.call(this,a)},this)},setCapture:function(a,c,b){this.captureInfo[a]&&this.releaseCapture(a,b);this.captureInfo[a]=c;this.implicitRelease=this.releaseCapture.bind(this,a,b);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var d=new q("gotpointercapture");d.pointerId=
a;d._target=c;b||this.asyncDispatchEvent(d)},releaseCapture:function(a,c){var b=this.captureInfo[a];if(b){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var d=new q("lostpointercapture");d.pointerId=a;d._target=b;c||this.asyncDispatchEvent(d)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};x.boundHandler=x.eventHandler.bind(x);var v={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,b){if(a){var d=a.elementFromPoint(c,
b),e;for(e=this.targetingShadow(d);e;){if(a=e.elementFromPoint(c,b))return d=this.targetingShadow(a),this.searchRoot(d,c,b)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,b=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,b)||(a=document);return this.searchRoot(a,c,b)}},y=Array.prototype.forEach.call.bind(Array.prototype.forEach),
m=Array.prototype.map.call.bind(Array.prototype.map),w=Array.prototype.slice.call.bind(Array.prototype.slice),A=Array.prototype.filter.call.bind(Array.prototype.filter),B=window.MutationObserver||window.WebKitMutationObserver,C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};l.prototype={watchSubtree:function(a){this.observer&&v.canTarget(a)&&this.observer.observe(a,C)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){y(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(w(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=m(a,this.findElements,this);c.push(A(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],G="",J=window.PointerEvent||window.MSPointerEvent,I=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,K=x.pointermap,H=[1,4,2,8,16],L=!1;try{L=1===(new MouseEvent("test",{buttons:1})).buttons}catch(U){}var P={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){x.listen(a,
this.events)},unregister:function(a){x.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,b=a.clientX;a=a.clientY;for(var d=0,e=c.length,g;d<e&&(g=c[d]);d++){var k=Math.abs(a-g.y);if(25>=Math.abs(b-g.x)&&25>=k)return!0}},prepareEvent:function(a){var c=x.cloneEvent(a),b=c.preventDefault;c.preventDefault=function(){a.preventDefault();b()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,
c){var b=K.get(this.POINTER_ID);a.buttons=0!==c.which&&b?b.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=K.get(this.POINTER_ID),b=this.prepareEvent(a);L||(b.buttons=H[b.button],c&&(b.buttons|=c.buttons),a.buttons=b.buttons);K.set(this.POINTER_ID,a);c&&0!==c.buttons?x.move(b):x.down(b)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;K.set(this.POINTER_ID,a);x.move(c)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=K.get(this.POINTER_ID),b=this.prepareEvent(a);if(!L){var d=H[b.button];b.buttons=c?c.buttons&~d:0;a.buttons=b.buttons}K.set(this.POINTER_ID,a);b.buttons&=~H[b.button];0===b.buttons?x.up(b):x.move(b)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;K.set(this.POINTER_ID,a);x.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
this.prepareEvent(a);L||this.prepareButtonsForMove(c,a);c.button=-1;x.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);x.cancel(a);this.deactivateMouse()},deactivateMouse:function(){K.delete(this.POINTER_ID)}},S=x.captureInfo,R=v.findTarget.bind(v),O=v.allShadows.bind(v),Q=x.pointermap,T,Y={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){T.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var c=a.getAttribute("touch-action"),b=this.touchActionToScrollType(c);
b&&(a._scrollType=b,x.listen(a,this.events),O(a).forEach(function(a){a._scrollType=b;x.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;x.unlisten(a,this.events);O(a).forEach(function(a){a._scrollType=void 0;x.unlisten(a,this.events)},this)},elementChanged:function(a,c){var b=a.getAttribute("touch-action"),d=this.touchActionToScrollType(b);c=this.touchActionToScrollType(c);d&&c?(a._scrollType=d,O(a).forEach(function(a){a._scrollType=d},this)):c?this.elementRemoved(a):
d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===Q.size||1===Q.size&&Q.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=
1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,b=x.cloneEvent(a),d=b.pointerId=a.identifier+2;b.target=S[d]||R(b);b.bubbles=!0;b.cancelable=!0;b.detail=this.clickCount;b.button=0;b.buttons=this.typeToButtons(c.type);b.width=2*(a.radiusX||a.webkitRadiusX||0);b.height=2*(a.radiusY||a.webkitRadiusY||0);b.pressure=a.force||a.webkitForce||.5;b.isPrimary=this.isPrimaryTouch(a);b.pointerType=this.POINTER_TYPE;b.altKey=c.altKey;b.ctrlKey=c.ctrlKey;b.metaKey=c.metaKey;b.shiftKey=c.shiftKey;
var e=this;b.preventDefault=function(){e.scrolling=!1;e.firstXY=null;c.preventDefault()};return b},processTouches:function(a,c){var b=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<b.length;a++)d=b[a],c.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var b="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+b]-this.firstXY[b])}this.firstXY=
null;return c}},findTouch:function(a,c){for(var b=0,d=a.length,e;b<d&&(e=a[b]);b++)if(e.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(Q.size>=c.length){var b=[];Q.forEach(function(a,d){1===d||this.findTouch(c,d-2)||b.push(a.out)},this);b.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){Q.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});x.enterOver(a);x.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=Q.get(a.pointerId);if(c){var b=c.out,d=c.outTarget;x.move(a);b&&d!==a.target&&(b.relatedTarget=a.target,a.relatedTarget=d,b.target=d,a.target?(x.leaveOut(b),x.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(x.up(a),x.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){x.cancel(a);x.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){Q.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=P.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};T=new l(Y.elementAdded,Y.elementRemoved,Y.elementChanged,Y);var N=x.pointermap,Z=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,W={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){x.listen(a,this.events)},unregister:function(a){x.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;Z&&(c=x.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){N.delete(a)},MSPointerDown:function(a){N.set(a.pointerId,a);a=this.prepareEvent(a);x.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);x.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);x.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);x.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);x.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);x.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=x.makeEvent("lostpointercapture",a);x.dispatchEvent(a)},MSGotPointerCapture:function(a){a=x.makeEvent("gotpointercapture",a);x.dispatchEvent(a)}},aa,V,F;window.navigator.msPointerEnabled?(aa=function(a){d(a);k(this);0!==x.pointermap.get(a).buttons&&(x.setCapture(a,this,!0),this.msSetPointerCapture(a))},V=function(a){d(a);x.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(aa=function(a){d(a);k(this);0!==x.pointermap.get(a).buttons&&x.setCapture(a,this)},V=function(a){d(a);x.releaseCapture(a)});F=function(a){return!!x.captureInfo[a]};var ca=window.PointerEvent||window.MSPointerEvent;return{dispatcher:x,Installer:l,PointerEvent:q,PointerMap:g,targetFinding:v,applyGlobal:function(){e();window.PointerEvent||(window.PointerEvent=q,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),x.registerSource("ms",W)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),x.registerSource("mouse",P),void 0!==window.ontouchstart&&x.registerSource("touch",Y)),x.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:aa},releasePointerCapture:{value:V},hasPointerCapture:{value:F}})},applyLocal:function(a){ca||(window.PointerEvent||(window.navigator.msPointerEnabled?
x.registerSource("ms",W):(x.registerSource("mouse",P),void 0!==window.ontouchstart&&x.registerSource("touch",Y)),x.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=aa.bind(a),a.releasePointerCapture=V.bind(a),a.hasPointerCapture=F.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,e){var d=this;this.element=b;this.input=e;this.handleGamepadConnectedEvent=function(a){d.handleGamepadConnected(a.gamepad)};this.handleGamepadDisconnectedEvent=function(c){c=c.gamepad;var b=d.inputDevices[c.index];b&&(d.emitGamepadEvent(c,a.extractState(b),!1),d.inputDevices[c.index]=void 0,d.latestUpdate[c.index]=void 0,d.input.gamepad.devices.remove(b))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=
[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return d.handleGamepadConnected(a)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}b.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",
this.handleGamepadDisconnectedEvent))};Object.defineProperty(b.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"pollingEnabled",{set:function(a){this.supported&&(a?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});b.prototype.handleGamepadConnected=function(a){var b=new h(a);"unknown"!==b.deviceType&&(this.inputDevices[a.index]=b,this.input.gamepad.devices.add(b))};b.prototype.startPolling=function(){var a=
this;null==this.frameTask&&(this.frameTask=f.addFrameTask({update:function(){return a.readGamepadState()}}))};b.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};b.prototype.readGamepadState=function(){var b=this,e=document.hasFocus(),f=this.element.contains(document.activeElement),c="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!f;this.forEachGamepad(function(d){var e=b.inputDevices[d.index];
if(e){var g=b.latestUpdate[d.index],e=a.extractState(e),k=c||a.stateIdle(e);g&&(g.timestamp===d.timestamp||!g.active&&k||a.stateEqual(g.state,e))||b.emitGamepadEvent(d,e,!k)}})};b.prototype.forEachGamepad=function(a){for(var b=window.navigator.getGamepads(),d=0;d<b.length;d++){var c=b[d];this.validate(c)&&a(c)}};b.prototype.emitGamepadEvent=function(a,b,e){var c=this.latestUpdate[a.index];if((c=c&&c.active)||e)this.latestUpdate[a.index]={timestamp:a.timestamp,state:b,active:e},this.callback&&this.callback({device:this.inputDevices[a.index],
state:b,action:!c&&e?"start":c&&e?"update":"end"})};b.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var b=0;b<a.axes.length;b++)if(isNaN(a.axes[b]))return!1;return!0};return b}();b.GamepadSource=q})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../../core/mathUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.extractState=function(b){var f=b.native;return{buttons:f.buttons.map(function(a){return a.pressed?a.value?a.value:
1:0}),axes:f.axes.map(function(a){var e=b.axisThreshold,d=Math.abs(a);a=d<e?0:l.sign(a)*(d-e)/(1-e);return a})}};b.stateEqual=function(b,h){if(b.axes.length!==h.axes.length||b.buttons.length!==h.buttons.length)return!1;for(var a=0;a<b.axes.length;a++)if(b.axes[a]!==h.axes[a])return!1;for(a=0;a<b.buttons.length;a++)if(b.buttons[a]!==h.buttons[a])return!1;return!0};b.stateIdle=function(b){for(var f=0;f<b.axes.length;f++)if(0!==b.axes[f])return!1;for(f=0;f<b.buttons.length;f++)if(0!==b.buttons[f])return!1;
return!0}})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function a(){var a=b.call(this,!0)||this;a.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return a}l(a,b);return a}(f.InputHandler);b.PreventContextMenu=q;b.default=q})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),
function(q,b,l,f,h,a,e){function d(a){var c=[];a.forEach(function(a){c.push(f.createScreenPoint(a.event.x,a.event.y))});return e.fitCircleLSQ(c)}function k(a){var b=d(a),e=0;a.forEach(function(a){for(var d=c(a,b),d=d-a.lastAngle;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=a.lastAngle+d;a.lastAngle=d;e+=d-a.initialAngle});e/=a.size||1;return{angle:e,radius:b.radius,center:b.center}}function n(a){var c=new Map;a.forEach(function(a,b){return c.set(b,a.event)});return c}function c(a,c){a=
a.event;return Math.atan2(a.y-c.center.y,a.x-c.center.x)}Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(c){var b=a.call(this,!1)||this;b.navigationTouch=c;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.isCurrentDragSuppressed=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));
b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}l(b,a);b.prototype.createPayload=function(a,c,b,d){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:c.buttons,timestamp:d,pointers:n(this.activePointerMap),pointer:c,angle:b.angle,radius:b.radius,center:b.center}};b.prototype.addPointer=function(a){var b=a.native.pointerId,e=k(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(b,a);b=c(a,d(this.activePointerMap));
a.initialAngle=b;a.lastAngle=b;this.updatePointerAngles(e)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var c=this.activePointerMap.get(a.native.pointerId);c?c.event=a:this.addPointer(a)}};b.prototype.removePointer=function(a){var c=k(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(c)};b.prototype.updatePointerAngles=function(a){var b=k(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=c(d,b)-a;d.lastAngle=
c(d,b)-a})};b.prototype.emitEvent=function(a,c,b){var d=k(this.activePointerMap);this.drag.emit(this.createPayload(a,c,d,b),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var c=a.data.native.pointerId,b=h.Milliseconds(a.timestamp);this.activePointerMap.get(c)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",a.data,b),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(c)):(this.removePointer(c),
this.emitEvent("removed",a.data,h.Milliseconds(a.timestamp))))};b.prototype.handlePointerDrag=function(a){var c=a.data,b=c.currentEvent,d=h.Milliseconds(a.timestamp);switch(c.action){case "start":case "update":this.isDragging?this.activePointerMap.has(b.native.pointerId)?(this.updatePointer(b),!this.isCurrentDragSuppressed&&this.emitEvent("update",b,d)):(this.addPointer(b),this.emitEvent("added",b,d),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(b),this.pointerType=a.data.startEvent.pointerType,
this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",b,d))}};Object.defineProperty(b.prototype,"isSuppressed",{get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size},enumerable:!0,configurable:!0});return b}(a.InputHandler);b.Drag=q;(function(a){a[a.Left=0]="Left";
a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(b.Button||(b.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.manhattanDistance=function(b,h){return Math.abs(h.x-b.x)+Math.abs(h.y-b.y)};b.euclideanDistance=function(b,h){var a=h.x-b.x;b=h.y-b.y;return Math.sqrt(a*a+b*b)};b.fitCircleLSQ=function(b,
h){h?(h.radius=0,h.center.x=0,h.center.y=0):h={radius:0,center:l.createScreenPoint()};if(0===b.length)return h;if(1===b.length)return h.center.x=b[0].x,h.center.y=b[0].y,h;if(2===b.length){var a=b[0];b=b[1];var e=[b.x-a.x,b.y-a.y],d=e[0],e=e[1];h.radius=Math.sqrt(d*d+e*e)/2;h.center.x=(a.x+b.x)/2;h.center.y=(a.y+b.y)/2;return h}for(var k=0,f=0,c=0;c<b.length;c++)k+=b[c].x,f+=b[c].y;for(var k=k/b.length,f=f/b.length,g=b.map(function(a){return a.x-k}),r=b.map(function(a){return a.y-f}),p=a=h=0,u=0,
t=d=0,c=e=0;c<g.length;c++){var x=g[c],v=r[c],y=x*x,m=v*v;h+=y;a+=m;p+=x*v;u+=y*x;d+=m*v;t+=x*m;e+=v*y}c=h;g=p;r=a;u=.5*(u+t);d=.5*(d+e);e=c*r-p*g;t=(u*r-d*g)/e;d=(c*d-p*u)/e;e=l.createScreenPoint(t+k,d+f);return{radius:Math.sqrt(t*t+d*d+(h+a)/b.length),center:e}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",
{value:!0});b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};q=function(e){function d(a,d,c,g,h){void 0===a&&(a=b.DefaultParameters.maximumClickDelay);void 0===d&&(d=b.DefaultParameters.movementUntilMouseDrag);void 0===c&&(c=b.DefaultParameters.movementUntilTouchDrag);void 0===g&&(g=b.DefaultParameters.holdDelay);void 0===h&&(h=f.default);var k=e.call(this,!1)||this;k.maximumClickDelay=a;k.movementUntilMouseDrag=d;k.movementUntilTouchDrag=
c;k.holdDelay=g;k._clock=h;k._pointerState=new Map;k._pointerDrag=k.registerOutgoing("pointer-drag");k._immediateClick=k.registerOutgoing("immediate-click");k._pointerHold=k.registerOutgoing("hold");k.registerIncoming("pointer-down",k._handlePointerDown.bind(k));k.registerIncoming("pointer-up",function(a){k._handlePointerLoss(a,"pointer-up")});k.registerIncoming("pointer-capture-lost",function(a){k._handlePointerLoss(a,"pointer-capture-lost")});k.registerIncoming("pointer-cancel",function(a){k._handlePointerLoss(a,
"pointer-cancel")});k._moveHandle=k.registerIncoming("pointer-move",k._handlePointerMove.bind(k));k._moveHandle.pause();return k}l(d,e);d.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});e.prototype.onUninstall.call(this)};d.prototype._handlePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerId,e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(function(){var c=b._pointerState.get(d);c&&
(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),c.holdEmitted=!0),c.holdTimeout=null)},this.holdDelay));e={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(d,e);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};d.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,
currentEvent:c}};d.prototype._handlePointerMove=function(b){var d=b.data,c=this._pointerState.get(d.native.pointerId);c&&(c.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",c,d),void 0,c.modifiers):a.euclideanDistance(d,c.startEvent)>("touch"===d.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(b),c.previousEvent=d)};d.prototype.startDragging=function(a){var b=this,c=a.data,d=c.native.pointerId;this._pointerState.forEach(function(e){null!=
e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);e.isDragging||(e.modifiers=a.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",e,c)):b._pointerDrag.emit(b._createPointerDragData("start",e,e.previousEvent),a.timestamp))})};d.prototype._handlePointerLoss=function(a,b){var c=a.data,d=c.native.pointerId,e=this._pointerState.get(d);e&&(null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
e,"pointer-up"===b?c:e.previousEvent),void 0,e.modifiers):"pointer-up"===b&&e.downButton===c.native.button&&a.timestamp-e.startTimestamp<=this.maximumClickDelay&&!e.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(d),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return d}(h.InputHandler);b.PointerClickHoldAndDrag=q})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};q=function(a){function d(d,c,e,k,h){void 0===d&&(d=b.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=b.DefaultParameters.maximumDoubleClickDistance);void 0===e&&(e=b.DefaultParameters.maximumDoubleTouchDelay);void 0===k&&(k=b.DefaultParameters.maximumDoubleTouchDistance);void 0===
h&&(h=f.default);var g=a.call(this,!1)||this;g.maximumDoubleClickDelay=d;g.maximumDoubleClickDistance=c;g.maximumDoubleTouchDelay=e;g.maximumDoubleTouchDistance=k;g._clock=h;g._pointerState=new Map;g._click=g.registerOutgoing("click");g._doubleClick=g.registerOutgoing("double-click");g.registerIncoming("immediate-click",g._handleImmediateClick.bind(g));g.registerIncoming("pointer-drag",g._handlePointerDrag.bind(g));g.registerIncoming("drag",g._handleDrag.bind(g));return g}l(d,a);d.prototype.onUninstall=
function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(d.prototype,"hasPendingInputs",{get:function(){return h.someMap(this._pointerState,function(a){return null!=a.doubleClickTimeout})},enumerable:!0,configurable:!0});d.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};d.prototype._handleImmediateClick=function(a){var c=a.data,
b=this._pointerId(c),d=this._pointerState.get(b);if(d){var k="touch"===c.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;e.manhattanDistance(d.event.data,c)>k?(this._clearDoubleClickTimeout(b,!0),this._startClick(a)):(this._clearDoubleClickTimeout(b,!1),this._doubleClick.emit(d.event.data,void 0,d.event.modifiers))}else this._startClick(a)};d.prototype._startClick=function(a){var c=this,b=this._pointerId(a.data);this._pointerState.set(b,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return c._doubleClickTimeoutExceeded(b)},
"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};d.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);this._clearDoubleClickTimeout(a,!0)};d.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};d.prototype._clearDoubleClickTimeout=function(a,c){var b=this._pointerState.get(a);b&&(b.doubleClickTimeout.remove(),b.doubleClickTimeout=null,c&&
this._doubleClickTimeoutExceeded(a),this._pointerState.delete(a),this.refreshHasPendingInputs())};d.prototype._doubleClickTimeoutExceeded=function(a){var c=this._pointerState.get(a);this._click.emit(c.event.data,void 0,c.event.modifiers);c.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return d}(a.InputHandler);b.SingleAndDoubleClick=q})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../DragEventSeparator","../InputHandler"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b,e){void 0===b&&(b=20);void 0===e&&(e=40);var d=a.call(this,!1)||this;d._threshold=b;d._maxDelta=e;d.state="ready";d.emittedArtificalEnd2=!1;d._vertical=d.registerOutgoing("vertical-two-finger-drag");d._artificalDrag=d.registerOutgoing("drag");d.dragEventSeparator=new f.DragEventSeparator({start:function(a,b){return d.observeStart(a,b)},update:function(a,b,e){return d.observeUpdate(a,
b,e)},end:function(a,b){return d.observeEnd(b)}});d.registerIncoming("drag",function(a){return d.dragEventSeparator.handle(a)});return d}l(b,a);Object.defineProperty(b.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});b.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,
pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===a?"ready":"failed"};b.prototype.observeUpdate=function(a,b,e){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,e.data)?this.checkVerticalThresholdReached(b.data,e.data)&&(this.state="active",
this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};b.prototype.observeEnd=function(a){"active"===
this.state&&(this._vertical.emit({delta:a.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",a.stopPropagation())};b.prototype.checkMovementWithinLimits=function(a,b){var d=-Infinity,c=Infinity,e=-Infinity,k=Infinity;b.pointers.forEach(function(a){d=Math.max(d,a.x);c=Math.min(c,a.x);e=Math.max(e,a.y);k=Math.min(k,a.y)});var f=-Infinity,h=Infinity,t=-Infinity,x=Infinity;a.pointers.forEach(function(a){f=Math.max(f,a.x);h=Math.min(h,a.x);t=Math.max(t,a.y);x=Math.min(x,a.y)});
return Math.abs(a.center.x-b.center.x)<this._threshold&&Math.abs(f-h-(d-c))<=this._maxDelta&&Math.abs(t-x-(e-k))<=this._maxDelta};b.prototype.checkVerticalThresholdReached=function(a,b){var d=Math.abs(a.center.y-b.center.y);a.pointers.forEach(function(a,e){e=b.pointers.get(e);d=Math.min(d,Math.abs(a.y-e.y))});return d>=this._threshold};return b}(h.InputHandler);b.VerticalTwoFingerDrag=q})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(b){this.callbacks=b;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}b.prototype.handle=function(b){var f=b.data,a=f.pointers.size;switch(f.action){case "start":this.currentCount=a;this.emitStart(b);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=a;this.emitStart(b);break;case "update":this.emitUpdate(b);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=
a;this.emitStart(b);break;case "end":this.emitEnd(b),this.currentCount=0}this.previousEvent=b};b.prototype.emitStart=function(b){this.startEvent=b;this.callbacks.condition(this.currentCount,b)&&this.callbacks.start(this.currentCount,b,this.startEvent)};b.prototype.emitUpdate=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.update(this.currentCount,b,this.startEvent)};b.prototype.emitEnd=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.end(this.currentCount,
b,this.startEvent);this.startEvent=null};return b}();b.DragEventSeparator=q})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){function I(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)}function K(a){(a=a.graphics3DCore.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})}function H(a){var c,b,d,e,g,k;return f(this,function(f){switch(f.label){case 0:if(!Map.prototype.entries)return[3,5];c=a.entries();b=c.next();f.label=1;case 1:return b.done?[3,4]:[4,b.value[1]];case 2:f.sent(),f.label=3;case 3:return b=
c.next(),[3,1];case 4:return[3,9];case 5:d=Array(a.size),e=0,a.forEach(function(a){return d[e++]=a}),g=0,k=d,f.label=6;case 6:if(!(g<k.length))return[3,9];b=k[g];return[4,b];case 7:f.sent(),f.label=8;case 8:return g++,[3,6];case 9:return[2]}})}Object.defineProperty(b,"__esModule",{value:!0});var L=t.vec4f64.create(),P=t.vec4f64.create(),S=t.vec4f64.create(),R=t.vec4f64.create(),O=w.sphere.create(),Q=w.ray.create(),T=u.vec3f64.create(),Y=x.create(),N=x.create(),Z=function(){return function(){this.posView=
this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),W=function(){return function(a,c,b){void 0===b&&(b={});this.graphics3DGraphic=a;this.slicePlaneEnabled=c;this.info=b}}(),aa=function(){return function(a,c){void 0===c&&(c=new Map);this.graphics3DCore=a;this.graphics=c}}();q=function(a){function b(){var c,b,d=null!==a&&a.apply(this,arguments)||this;d.handles=new e;d.dirty=!1;d.state=0;d.contexts=[];d.graphics=(c={},c[0]={active:new Map,visible:new n,remove:new n},
c[1]={active:new Map,visible:new n,remove:new n},c);d.iterators=(b={},b[0]={active:null,visible:null,remove:null,sort:null},b[1]={active:null,visible:null,remove:null,sort:null},b);d.accBinsNumX=15;d.accBinsNumY=20;d.accBinsSizeX=0;d.accBinsSizeY=0;d.accBins=null;d.accNumTests=0;d._iconMarginFactor=-.1;d.slicePlaneViewSpace=null;return d}l(b,a);Object.defineProperty(b.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(a){this._iconMarginFactor=a;this.setDirty()},
enumerable:!0,configurable:!0});b.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(){a.updateSlicePlane();a.setDirtyUrgent()}),this.view.watch("map.ground.opacity",function(c,b){1!==c&&1!==b||a.setDirtyUrgent()}),c.init(this.view,"slicePlane",function(){return a.updateSlicePlane()})]);this.frameWorker=this.view.resourceController.scheduler.registerTask(J.Task.DECONFLICTOR_DELAYED,function(c){return a.update(c)},function(){return a.needsUpdate()})};
b.prototype.updateSlicePlane=function(){var a=this.view&&this.view.slicePlane;a?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=w.boundedPlane.create()),w.boundedPlane.transform(a,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};b.prototype.slicePlaneChanged=function(){for(var a=0,c=this.contexts;a<c.length;a++)if(c[a].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();
break}};b.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.iterators=this.graphics=null};b.prototype.addGraphicsOwner=function(a){var c=this,b=this.findDeconflictionContext(a),d;-1!==b?d=this.contexts[b]:(d=new aa(a),this.contexts.push(d),this.setDirtyUrgent());return{addGraphic:function(a){return c.addGraphic(d,a)},removeGraphic:function(a){return c.removeGraphic(d,a)},labelingInfoChange:function(){return c.globalLabelingInfoChanged(d)},
visibilityInfoChange:function(){},featureReductionChange:function(){return c.globalFeatureReductionChanged(d)},slicePlaneEnabledChange:function(){return c.globalSlicePlaneEnabledChanged(d)},clear:function(){return d.graphics.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)})}}};b.prototype.removeGraphicsOwner=function(a){var c=this;a=this.findDeconflictionContext(a);if(-1!==a){var b=this.contexts.splice(a,1)[0];b.graphics.forEach(function(a){return c.removeGraphic(b,a.graphics3DGraphic)});
this.setDirtyUrgent()}};b.prototype.setInitialIconVisibilityFlag=function(a,c){a=!(this.graphicSupportsDeconfliction(c)&&I(a));c.setVisibilityFlag(3,a,0)};b.prototype.setDirtyUrgent=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=!0,this.notifyChange("updating"));this.frameWorker.task=J.Task.DECONFLICTOR_IMMEDIATE};b.prototype.setDirty=function(){!this.dirty&&0<this.contexts.length&&(this.dirty=!0,this.notifyChange("updating"),this.frameWorker.task=J.Task.DECONFLICTOR_DELAYED)};Object.defineProperty(b.prototype,
"updating",{get:function(){return 0!==this.state||this.dirty},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updatingProgress",{get:function(){if(!this.updating)return 1;var a=this.state/9;return this.dirty?.5*a:a},enumerable:!0,configurable:!0});b.prototype.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};b.prototype.update=function(a){switch(this.state){case 0:this.startUpdate(),a.madeProgress();case 1:if(this.state=1,!this.processActiveGraphics(0,
a))break;case 2:if(this.state=2,!this.cleanVisibleGraphics(0,a))break;case 3:if(this.state=3,!this.sortVisibleGraphics(0,a))break;case 4:this.state=4;if(!this.deconflictVisibleGraphics(0,a))break;v.drawAccelerationStruct(this,this.graphics[0].visible);case 5:if(this.state=5,!this.processActiveGraphics(1,a))break;case 6:if(this.state=6,!this.cleanVisibleGraphics(1,a))break;case 7:if(this.state=7,!this.sortVisibleGraphics(1,a))break;case 8:this.state=8;if(!this.deconflictVisibleGraphics(1,a))break;
v.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=0,this.notifyChange("updating")}};b.prototype.findDeconflictionContext=function(a){for(var c=0;c<this.contexts.length;c++)if(this.contexts[c].graphics3DCore===a)return c;return-1};b.prototype.globalFeatureReductionChanged=function(a){var c=I(a.graphics3DCore);c||K(a);this.modifyGraphics(a,c,0)};b.prototype.globalLabelingInfoChanged=function(a){this.modifyGraphics(a,a.graphics3DCore.labelsEnabled,1)};b.prototype.globalSlicePlaneEnabledChanged=
function(a){var c=a.graphics3DCore.symbolCreationContext.slicePlaneEnabled;a.graphics.forEach(function(a){a.slicePlaneEnabled=c});this.setDirtyUrgent()};b.prototype.modifyGraphics=function(a,c,b){var d=this;c?a.graphics.forEach(function(a){return d.addToActiveGraphics(a,b)}):a.graphics.forEach(function(a){return d.removeFromActiveGraphics(a,b)});this.setDirtyUrgent()};b.prototype.graphicSupportsDeconfliction=function(a){var c=a._graphics;if(!c||!c.length||a.isDraped())return!1;for(a=0;a<c.length;a++)if(this.graphics3DGraphicsLayerSupportsDeconfliction(c[a]))return!0;
return!1};b.prototype.graphics3DGraphicsLayerSupportsDeconfliction=function(a){if(k.isNone(a)||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof E?!0:!1};b.prototype.addGraphic=function(a,c){var b=c.graphic.uid;c=new W(c,a.graphics3DCore.symbolCreationContext.slicePlaneEnabled);a.graphics.set(b,c);I(a.graphics3DCore)&&this.addToActiveGraphics(c,0);a.graphics3DCore.labelsEnabled&&this.addToActiveGraphics(c,1);this.setDirty()};
b.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var b=a.graphics.get(c);b&&(this.removeFromActiveGraphics(b,0),this.removeFromActiveGraphics(b,1),a.graphics.delete(c),this.setDirty())};b.prototype.startUpdate=function(){v.prepare(this.view);this.dirty=!1;this.camera=this.view.state.camera;this.initBins(this.camera.fullWidth,this.camera.fullHeight);this.resetIterators()};b.prototype.addToActiveGraphics=function(a,c){a.info[c]=new Z;this.graphics[c].active.set(a.graphics3DGraphic.graphic.uid,
a)};b.prototype.removeFromActiveGraphics=function(a,c){this.removeFromVisibleGraphics(a,c);var b=a.graphics3DGraphic;b.destroyed||b.clearVisibilityFlag(3,c);delete a.info[c];this.graphics[c].active.delete(a.graphics3DGraphic.graphic.uid)};b.prototype.addToVisibleGraphics=function(a,c){var b=a.info[c];b&&!b.pooled&&(this.graphics[c].visible.push(a),b.pooled=!0)};b.prototype.removeFromVisibleGraphics=function(a,c){var b=a.info[c];b&&b.pooled&&(this.graphics[c].remove.push(a),b.pooled=!1)};b.prototype.processActiveGraphics=
function(a,c){for(var b=this.ensureActiveGraphicsIterator(a),d="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!c.done;){c.madeProgress();var e=b.next();if(e.done)return this.resetActiveGraphicsIterator(a),!0;var g=(e=e.value)&&e.info[a];g&&(this.collectGraphics3DGraphics(e,a,d),g.culled?this.removeFromVisibleGraphics(e,a):this.addToVisibleGraphics(e,a))}return!1};b.prototype.cleanVisibleGraphics=function(a,c){for(var b=this.graphics[a],
d=this.ensureRemoveGraphicsIterator(a);!c.done;){var e=d.next();c.madeProgress();if(e.done)return b.remove.clear(),this.resetRemoveGraphicsIterator(a),!0}return!1};b.prototype.sortVisibleGraphics=function(a,c){for(var b=this.ensureSortGraphicsIterator(a);!c.done;){var d=b.next();c.madeProgress();if(d.done)return this.resetSortGraphicsIterator(a),!0}return!1};b.prototype.deconflictVisibleGraphics=function(a,c){for(var b=this.ensureVisibleGraphicsIterator(a),d=1===a;!c.done;){c.madeProgress();var e=
b.next();if(e.done)return this.resetVisibleGraphicsIterator(a),!0;var e=e.value,g=e.info[a];if(g&&!g.culled){var k=e.graphics3DGraphic,k=!(d&&!k.isVisible())&&!this.doesIntersectExistingPoly(e,a);(g.visible=k)&&this.addToBins(e,a);this.setGraphicVisibility(e,a,k);v.drawPoly(g,k)}}return!1};b.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=null;this.iterators[1].active=null;this.iterators[1].visible=
null;this.iterators[1].remove=null;this.iterators[1].sort=null};b.prototype.ensureActiveGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.active||(a.active=H(c.active));return a.active};b.prototype.resetActiveGraphicsIterator=function(a){this.iterators[a].active=null};b.prototype.ensureVisibleGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.visible||(a.visible=c.visible.iterableForEach());return a.visible};b.prototype.resetVisibleGraphicsIterator=function(a){this.iterators[a].visible=
null};b.prototype.ensureRemoveGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.remove||(a.remove=c.visible.iterableRemoveMany(c.remove));return a.remove};b.prototype.resetRemoveGraphicsIterator=function(a){this.iterators[a].remove=null};b.prototype.ensureSortGraphicsIterator=function(a){var c=this.graphics[a],b=this.iterators[a];b.sort||(b.sort=c.visible.iterableSort(function(c,b){return c.info[a]&&b.info[a]?b.info[a].posView-c.info[a].posView:Number.MAX_VALUE}));return b.sort};
b.prototype.resetSortGraphicsIterator=function(a){this.iterators[a].sort=null};b.prototype.collectGraphics3DGraphics=function(a,c,b){var e=a.graphics3DGraphic;if(!e.destroyed){var g=a.info[c];if(e.isVisible(0,3)){e=(c=1===c)?e._labelGraphics:e._graphics;c=c?0:this.iconMarginFactor;for(var k=x.empty(Y),f,h,n=0;n<e.length;n++){var r=e[n];if(this.graphics3DGraphicsLayerSupportsDeconfliction(r)){var t=r.stageObject,v=t.getGeometryRecord(0),l=v.material,E=this.camera,H=v.geometry.data.getVertexAttr();
if(b&&(O.radius=m.earthRadius,p.vec3.sub(Q.direction,t.getCenter(),this.camera.eye),p.vec3.copy(Q.origin,this.camera.eye),A.intersectRay(O,Q,T))){var U=1-Math.abs(Math.tan(p.vec3.angle(t.getCenter(),Q.direction)))/this.view.width,U=Math.pow(U,4),I=p.vec3.sqrDist(this.camera.eye,T),J=p.vec3.sqrDist(this.camera.eye,t.getCenter());if(U*J>I){g.culled=!0;return}}if(!h){h=t.getCenter();v=v.origin.vec3;G.transformToWorld(h,v,L);G.transformToView(L,v,E.viewMatrix,P);l.applyVerticalOffsetTransformation(P,
H[C.VertexAttrConstants.NORMAL].data,t.objectTransformation,E,V);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&w.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,P)){g.culled=!0;return}t=H[C.VertexAttrConstants.AUXPOS1].data;H="screen"!==l.getParameters().centerOffsetUnits;G.transformToProjection(P,E.projectionMatrix,H?t:u.vec3f64.ZEROS,S);h=G.transformToNDC(S,R);H||(h[0]+=t[0]/E.fullWidth*2,h[1]+=t[1]/E.fullHeight*2);if(-1>h[0]||-1>h[1]||-1>h[2]||1<=h[0]||1<=h[1])break;f=P[2];!y.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&
g.visible&&(f*=.7)}r=r.getScreenSize(F);r[0]*=E.pixelRatio;r[1]*=E.pixelRatio;B.applyPrecomputedScaleFactorVec2(r,V.factor,r);l=x.offset(l.calculateRelativeScreenBounds(r,V.factorAlignment.scale,N),d.lerp(0,E.fullWidth,.5+.5*h[0]),d.lerp(0,E.fullHeight,.5+.5*h[1]));0!==c&&(E=c*Math.min(x.width(l),x.height(l)),l[0]-=E,l[1]-=E,l[2]+=E,l[3]+=E);x.expand(k,l)}}null==f?g.culled=!0:(g.xMin=k[0],g.yMin=k[1],g.xMax=k[2],g.yMax=k[3],g.posView=f,g.culled=!1)}else g.culled=!0}};b.prototype.doesIntersectExistingPoly=
function(a,c){var b=a.graphics3DGraphic.graphic.uid;a=a.info[c];for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var g=this.accBins[d][e],k=0;k<g.length;k++){var f=g.data[k],m=f.info[c];if(m&&m.visible&&f.graphics3DGraphic.graphic.uid!==b&&(this.accNumTests++,!(m.xMin>a.xMax||m.xMax<a.xMin||m.yMin>a.yMax||
m.yMax<a.yMin)))return!0}return!1};b.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var b=0;b<this.accBinsNumX;b++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],e=0;e<this.accBinsNumY;e++)d.push(new n)}}for(b=0;b<this.accBinsNumX;b++)for(e=0;e<this.accBinsNumY;e++)this.accBins[b][e].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a,c){var b=a.info[c];c=Math.floor(b.xMax/
this.accBinsSizeX);for(var d=Math.floor(b.yMin/this.accBinsSizeY),e=Math.floor(b.yMax/this.accBinsSizeY),b=Math.floor(b.xMin/this.accBinsSizeX);b<=c;b++)if(!(0>b||b>=this.accBinsNumX))for(var g=d;g<=e;g++)0>g||g>=this.accBinsNumY||this.accBins[b][g].push(a)};b.prototype.setGraphicVisibility=function(a,c,b){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,b,c),1===c&&this.view.labeler.setLabelGraphicVisibility(a,b))};h([g.property({constructOnly:!0})],b.prototype,"view",void 0);h([g.property({type:Boolean,
readOnly:!0})],b.prototype,"updating",null);return b=h([g.subclass("esri.views.3d.layers.graphics.Deconflictor")],b)}(g.declared(a));b.Deconflictor=q;var V={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},F=r.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(q,b,l,f){function h(a,b,d,e,
k){n&&(n(),n=null);var f=c.height,h=g;h.beginPath();h.lineWidth=1;h.strokeStyle=k;h.moveTo(a,f-d);h.lineTo(b,f-d);h.stroke();h.lineTo(b,f-e);h.stroke();h.lineTo(b,f-d);h.stroke();h.lineTo(a,f-d);h.stroke();h.lineTo(a,f-d);h.stroke();h.closePath()}Object.defineProperty(b,"__esModule",{value:!0});var a=!1,e=!1,d=!1,k=!1,n=null,c,g;b.drawAccelerationStruct=function(a,c){if(e&&g){n&&(n(),n=null);for(var b=g,d=0,k=0;k<a.accBinsNumX;k++)for(var f=0;f<a.accBinsNumY;f++){var p=a.accBins[k][a.accBinsNumY-
1-f],d=d+p.length,m=k*a.accBinsSizeX,r=(k+1)*a.accBinsSizeX,A=f*a.accBinsSizeY,l=(f+1)*a.accBinsSizeY;b.fillText(p.length.toFixed(),m+5,A+15);h(m,r,A,l,"blue")}b.fillText("total totalShownLabels: "+d,70,40);b.fillText("total visible labels: "+c.length,70,50);b.fillText("total numTests: "+a.accNumTests,70,30)}};b.prepare=function(b){d=f.DECONFLICTOR_SHOW_OUTLINES;k=f.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE;a=d||k;e=f.DECONFLICTOR_SHOW_GRID;n=null;a||e?n=function(){null==c&&(c=document.createElement("canvas"),
c.setAttribute("id","canvas2d"),b.surface.parentElement.style.position="relative",b.surface.parentElement.appendChild(c));var a=b.height*b.pixelRatio;c.setAttribute("width",b.width*b.pixelRatio+"px");c.setAttribute("height",a+"px");c.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+b.width+"px;height:"+b.height+"px");g=c.getContext("2d");g.clearRect(0,0,b.width,b.height);g.font="12px Arial"}:c&&(c.parentElement.removeChild(c),c=null)};b.drawPoly=function(c,
b){a&&(b&&d||!b&&k)&&h(c.xMin,c.xMax,c.yMin,c.yMax,b?"green":"red")}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){return new (function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=
!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_OUTLINES_INVISIBLE=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_DEBUG_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TERRAIN_DEBUG_POPUP=!1;a.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.I3S_TREE_SHOW_TILES=!1;
a.ENABLE_PROFILE_DEPTH_RANGE=!1;a.DISABLE_FAST_UPDATES=!1;a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;a.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return a}l(d,b);f([a.property()],d.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);f([a.property()],d.prototype,"SCENEVIEW_LOCKING_LOG",void 0);f([a.property()],d.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);f([a.property()],d.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);f([a.property()],
d.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);f([a.property()],d.prototype,"DECONFLICTOR_SHOW_OUTLINES_INVISIBLE",void 0);f([a.property()],d.prototype,"DECONFLICTOR_SHOW_GRID",void 0);f([a.property()],d.prototype,"LABELS_SHOW_BORDER",void 0);f([a.property()],d.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);f([a.property()],d.prototype,"OVERLAY_SHOW_CENTER",void 0);f([a.property()],d.prototype,"TERRAIN_DEBUG_POPUP",void 0);f([a.property()],d.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);f([a.property()],
d.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);f([a.property()],d.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);f([a.property()],d.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);f([a.property()],d.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);f([a.property()],d.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);f([a.property()],d.prototype,"I3S_TREE_SHOW_TILES",void 0);f([a.property()],d.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);f([a.property()],d.prototype,
"DISABLE_FAST_UPDATES",void 0);f([a.property()],d.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);f([a.property()],d.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);f([a.property()],d.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);return d=f([a.subclass("esri.views.3d.support.DebugFlags")],d)}(a.declared(h)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../../../core/mathUtils","../../support/earthUtils"],
function(q,b,l,f){function h(a){return Math.abs(a*a*a)}function a(a,c,b,d){void 0===d&&(d=g);var e=b.parameters;b=b.paddingPixelsOverride;d.scale=Math.min(e.divisor/(c-e.offset),1);d.factor=h(a);d.minPixelSize=e.minPixelSize;d.paddingPixels=b;return d}function e(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function d(a,c){return Math.max(l.lerp(a*c.scale,a,c.factor),e(a,c))}function k(c,b,e){c=a(c,b,e);c.minPixelSize=0;c.paddingPixels=0;return d(1,c)}Object.defineProperty(b,
"__esModule",{value:!0});b.getSettings=function(a){return new n(a,b.defaultDescription)};b.getLabelSettings=function(a){var d=b.defaultDescription.curvatureDependent;return new n(a,{curvatureDependent:{min:{curvature:d.min.curvature,tiltAngle:d.min.tiltAngle,scaleFallOffFactor:c.curvatureDependent.min.scaleFallOffFactor},max:{curvature:d.max.curvature,tiltAngle:d.max.tiltAngle,scaleFallOffFactor:c.curvatureDependent.max.scaleFallOffFactor}},scaleStart:b.defaultDescription.scaleStart,scaleFallOffRange:b.defaultDescription.scaleFallOffRange,
minPixelSize:c.minPixelSize})};b.perspectiveFactor=h;b.scaleFactor=a;b.applyScaleFactor=d;b.applyScaleFactorVec2=function(a,c,b){void 0===b&&(b=[0,0]);var d=Math.min(Math.max(c.scale,e(a[1],c)/a[1]),1);b[0]=l.lerp(a[0]*d,a[0],c.factor);b[1]=l.lerp(a[1]*d,a[1],c.factor);return b};b.precomputeScale=k;b.precomputeScaleFactor=function(a,c,b,d){d.scale=k(a,c,b);d.factor=0;d.minPixelSize=b.parameters.minPixelSize;d.paddingPixels=b.paddingPixelsOverride;return d};b.applyPrecomputedScaleFactorVec2=function(a,
c,b){void 0===b&&(b=[0,0]);c=Math.min(Math.max(c.scale,e(a[1],c)/a[1]),1);b[0]=a[0]*c;b[1]=a[1]*c;return b};b.scale=function(c,b,e,g){return d(c,a(b,e,g))};var n=function(){function a(a,c,b,d){void 0===b&&(b={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=c;this.parameters=b;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===
a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(c){return c!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,c):this};a.prototype.calculateParameters=function(a,c){var b=this.description,d=b.scaleStart,e=b.scaleFallOffRange,b=b.minPixelSize,g=a.fovY,k=a.distance,f=this.calculateCurvatureDependentParameters(a),h=this.coverageCompensation(a,f),p=f.tiltAngle,f=f.scaleFallOffFactor,k=Math.sin(p)*k,p=.5*
Math.PI-p-g*(.5-d*h),d=k/Math.cos(p),e=(d-k/Math.cos(p+g*e*h)*f)/(1-f);c.camera.fovY=a.fovY;c.camera.distance=a.distance;c.offset=e;c.divisor=d-e;c.minPixelSize=b;return c};a.prototype.calculateCurvatureDependentParametersLocal=function(a,c){void 0===c&&(c=r);c.tiltAngle=this.description.curvatureDependent.min.tiltAngle;c.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return c};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,c){void 0===c&&(c=r);var b=
this.description.curvatureDependent;a=1+a.distance/f.earthRadius;var d=[b.min.curvature,b.max.curvature],e=d[0];a=l.clamp((Math.sqrt(a*a-1)-e)/(d[1]-e),0,1);d=[b.min,b.max];b=d[0];d=d[1];c.tiltAngle=l.lerp(b.tiltAngle,d.tiltAngle,a);c.scaleFallOffFactor=l.lerp(b.scaleFallOffFactor,d.scaleFallOffFactor,a);return c};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,c){var b=f.earthRadius*f.earthRadius;
c=c.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+b-2*Math.cos(c)*a*f.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-b)/e)-Math.asin(f.earthRadius/(e/Math.sin(c)))+.5*d)/d};return a}();b.defaultDescription={curvatureDependent:{min:{curvature:l.deg2rad(10),tiltAngle:l.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:l.deg2rad(70),tiltAngle:l.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var c={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14};b.copyParameters=function(a,c){c.camera.distance=a.camera.distance;c.camera.fovY=a.camera.fovY;c.divisor=a.divisor;c.offset=a.offset;c.minPixelSize=a.minPixelSize;return c};var g={scale:0,factor:0,minPixelSize:0,paddingPixels:0},r={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){q=function(c){function b(a,b){b=c.call(this,b)||this;b.techniqueConfig=new J.HUDMaterialTechniqueConfiguration;b.params=C.copyParameters(a,U);return b}l(b,c);b.prototype.dispose=function(){};b.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&A.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.parametersChanged()};b.prototype.getParameters=
function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.occlusionTestEnabled=
this.params.occlusionTest;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===a&&(this.techniqueConfig.debugDrawBorder=!!this.params.debugDrawBorder);4===a&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);return this.techniqueConfig};b.prototype.intersect=function(a,c,b,d,e,g,k,f,m){m?this.intersectDrapedRenderHudGeometry(a,g,k,f):
this.intersectHudGeometry(a,c,b,d,k,f)};b.prototype.intersectDrapedRenderHudGeometry=function(a,c,b,d){var e=a.getAttribute(A.VertexAttrConstants.POSITION),k=a.getAttribute(A.VertexAttrConstants.SIZE),f=this.params,m=G.calculateAnchorPosForRendering(f),h=1,p=1;d&&(p=d(W),h=p[0],p=p[5]);h*=a.pixelRatio;p*=a.pixelRatio;d=V*a.pixelRatio;for(var n=0;n<e.data.length/e.size;n++){var r=n*e.size;g.vec3.set(P,e.data[r],e.data[r+1],e.data[r+2]);r=n*k.size;F[0]=k.data[r]*h;F[1]=k.data[r+1]*p;var r=P[0],w=P[1],
t=void 0;f.textureIsSignedDistanceField&&(t=f.outlineSize*a.pixelRatio/2);this._isInsideIconBoundaries(c,r,w,d,t,f,m)&&b()}};b.prototype.intersectHudGeometry=function(c,b,e,k,f,m){if(k.options.selectionMode&&k.options.hud&&!x.isAllHidden(b.componentVisibilities,c.componentOffsets)){var h=c.data;c=this.params;var p=b=1;a.mat3.fromMat4(T,e);if(m){p=m(W);b=p[0];p=p[5];m=T;var n=m[0],t=m[1],v=m[2],u=m[3],y=m[4],l=m[5],B=m[6],C=m[7],E=m[8],L=1/Math.sqrt(n*n+t*t+v*v),O=1/Math.sqrt(u*u+y*y+l*l),U=1/Math.sqrt(B*
B+C*C+E*E);m[0]=n*L;m[1]=t*L;m[2]=v*L;m[3]=u*O;m[4]=y*O;m[5]=l*O;m[6]=B*U;m[7]=C*U;m[8]=E*U}m=h.getVertexAttr()[A.VertexAttrConstants.POSITION];n=h.getVertexAttr()[A.VertexAttrConstants.SIZE];t=h.getVertexAttr()[A.VertexAttrConstants.NORMAL];h=h.getVertexAttr()[A.VertexAttrConstants.AUXPOS1];A.assert(3<=m.size);v=k.point;u=k.camera;y=G.calculateAnchorPosForRendering(c);b*=u.pixelRatio;p*=u.pixelRatio;l="screen"===this.params.centerOffsetUnits;for(B=0;B<m.data.length/m.size;B++)C=B*m.size,g.vec3.set(P,
m.data[C],m.data[C+1],m.data[C+2]),g.vec3.transformMat4(P,P,e),C=B*n.size,F[0]=n.data[C]*b,F[1]=n.data[C+1]*p,g.vec3.transformMat4(P,P,u.viewMatrix),C=B*h.size,g.vec3.set(N,h.data[C+0],h.data[C+1],h.data[C+2]),l||(P[0]+=N[0],P[1]+=N[1],0!==N[2]&&(C=N[2],g.vec3.normalize(N,P),g.vec3.subtract(P,P,g.vec3.scale(N,N,C)))),C=B*t.size,g.vec3.set(S,t.data[C],t.data[C+1],t.data[C+2]),this.applyVerticalOffsetTransformation(P,S,T,u,H),u.applyProjection(P,R),-1<R[0]&&(C=Math.floor(R[0])+this.params.screenOffset[0],
E=Math.floor(R[1])+this.params.screenOffset[1],l&&(C+=N[0],0!==N[1]&&(E+=w.applyScaleFactor(N[1],H.factorAlignment))),w.applyPrecomputedScaleFactorVec2(F,H.factor,F),L=aa*u.pixelRatio,O=void 0,c.textureIsSignedDistanceField&&(O=c.outlineSize*u.pixelRatio/2),this._isInsideIconBoundaries(v,C,E,L,O,c,y)&&(E=k.ray,g.vec3.transformMat4(Q,P,d.mat4.invert(Y,u.viewMatrix)),R[0]=v[0],R[1]=v[1],u.unprojectPoint(R,P),C=r.vec3f64.create(),g.vec3.copy(C,E.direction),L=1/g.vec3.length(C),g.vec3.scale(C,C,L),E=
g.vec3.distance(E.origin,P)*L,f(E,C,-1,1,!0,Q)))}};b.prototype.computeAttachmentOrigin=function(a,c){a=a.data;var b="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null;if(!b)return null;var d=A.VertexAttrConstants.POSITION,b=b[d];a="getIndices"in a?a.getIndices(d):"indices"in a?a.indices[d]:null;return v.computeAttachmentOriginPoints(b,a,c)};b.prototype._isInsideIconBoundaries=function(a,c,b,d,e,g,k){c=c-d-(0<k[0]?F[0]*k[0]:0);var f=c+F[0]+2*d;b=b-d-(0<k[1]?F[1]*k[1]:0);d=b+F[1]+
2*d;g.textureIsSignedDistanceField&&(g=g.distanceFieldBoundingBox,c+=F[0]*g[0],b+=F[1]*g[1],f-=F[0]*(1-g[2]),d-=F[1]*(1-g[3]),c-=e,f+=e,b-=e,d+=e);return a[0]>c&&a[0]<f&&a[1]>b&&a[1]<d};b.prototype.createBufferWriter=function(){return new ha(this)};b.prototype.createRenderer=function(a,c){return new E(a,c,this)};b.prototype.normalAndViewAngle=function(a,c,b,d){void 0===d&&(d=Z);g.vec3.transformMat3(d.normal,a,c);g.vec3.transformMat4(d.normal,d.normal,b.viewInverseTransposeMatrix);d.cosAngle=g.vec3.dot(O,
ca);return d};b.prototype.updateScaleInfo=function(a,c){var b=this.params;b.screenSizePerspective?a.factor=w.precomputeScaleFactor(Z.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?a.factorAlignment=w.precomputeScaleFactor(Z.cosAngle,c,b.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=
a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};b.prototype.applyVerticalOffsetTransformation=function(c,b,d,e,k,f){var m=this.params;p.isMat4(d)&&(d=a.mat3.fromMat4(T,d));if(!m.verticalOffset||!m.verticalOffset.screenLength)return k&&(m.screenSizePerspective||m.screenSizePerspectiveAlignment)?(e=g.vec3.length(c),this.updateScaleInfo(k,e)):k&&(k.factor.scale=1,k.factorAlignment.scale=1),f?g.vec3.copy(f,c):c;b=this.normalAndViewAngle(b,d,e);d=g.vec3.length(c);e=C.verticalOffsetAtDistance(e,
d,m.verticalOffset,b.cosAngle,m.screenSizePerspectiveAlignment||m.screenSizePerspective);k&&this.updateScaleInfo(k,d);return g.vec3.add(f||c,c,g.vec3.scale(b.normal,b.normal,e))};b.prototype.getGLMaterial=function(a){if(0===a.output)return new I(a);if(4===a.output)return new K(a)};b.prototype.calculateRelativeScreenBounds=function(a,c,b){void 0===b&&(b=u.create());var d=this.params,e=b;void 0===e&&(e=L);n.vec2.copy(e,d.anchorPos);e[0]*=-a[0];e[1]*=-a[1];e[0]+=d.screenOffset[0]*c;e[1]+=d.screenOffset[1]*
c;b[2]=b[0]+a[0];b[3]=b[1]+a[1];return b};b.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return b}(m.Material);b=function(a){function c(c){c=a.call(this,y.makeCtorParameters(c,c.material.getParameters()))||this;c.updateParameters();return c}l(c,a);c.prototype.beginSlot=function(a){return a===(this.params.drawInSecondSlot?16:15)};c.prototype.updateParameters=function(){this.params=C.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram()};
c.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(J.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};c.prototype.bind=function(a,c){var b=this.technique.program;a.bindProgram(b);this.technique.bindPipelineState(a);this.bindTexture(a,b);this.bindTextureScale(a,b);this.technique.bindPass(a,this.params,c);C.bindHighlightRendering(a,c,this.technique.program)};return c}(y);var I=function(a){function c(c){c=a.call(this,f({},
c,{output:0}))||this;c.isOcclusionSlot=!1;return c}l(c,a);c.prototype.beginSlot=function(a){var c=this.params.drawInSecondSlot?16:15;if(this.params.occlusionTest)return this.isOcclusionSlot=10===a,10===a||a===c;this.isOcclusionSlot=!1;return a===c};c.prototype.getTechnique=function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};c.prototype.selectProgram=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(J.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output),
this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(J.HUDMaterialTechnique,this.material.getTechniqueConfig(6),this.occlusionTechnique)};c.prototype.bind=function(a,c){if(this.isOcclusionSlot)a.bindProgram(this.occlusionTechnique.program),this.occlusionTechnique.bindPipelineState(a),this.occlusionTechnique.bindPass(a,this.params,c);else{var b=this.technique.program;a.bindProgram(b);this.technique.bindPipelineState(a);this.bindTexture(a,b);this.bindTextureScale(a,b);
this.technique.bindPass(a,this.params,c)}};c.prototype.bindView=function(a){(this.isOcclusionSlot?this.occlusionTechnique:this.technique).bindDraw(a)};return c}(b),K=function(a){function c(c){return a.call(this,f({},c,{output:4}))||this}l(c,a);return c}(b),H={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=c.vec2f64.create(),P=r.vec3f64.create(),S=r.vec3f64.create(),R=h.createRenderScreenPointArray3(),O=r.vec3f64.create(),
Q=r.vec3f64.create(),T=e.mat3f64.create(),Y=k.mat4f64.create(),N=r.vec3f64.create(),Z={normal:O,cosAngle:0},W=k.mat4f64.create(),aa=1,V=2,F=[0,0],ca=r.vec3f64.fromValues(0,0,1),U={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,
vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},ea=t.newLayout().vec3f(A.VertexAttrConstants.POSITION).vec3f(A.VertexAttrConstants.NORMAL).vec2f(A.VertexAttrConstants.UV0).vec4u8(A.VertexAttrConstants.COLOR).vec2f(A.VertexAttrConstants.SIZE).vec4f(A.VertexAttrConstants.AUXPOS1).vec4f(A.VertexAttrConstants.AUXPOS2),
ha=function(){function a(a){this.material=a;this.vertexBufferLayout=ea}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[A.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d){B.writePosition(c.indices[A.VertexAttrConstants.POSITION],c.vertexAttr[A.VertexAttrConstants.POSITION].data,a.transformation,b.position,d,6);B.writeNormal(c.indices[A.VertexAttrConstants.NORMAL],c.vertexAttr[A.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,b.normal,d,6);a=c.vertexAttr[A.VertexAttrConstants.UV0].data;var e=void 0,g=void 0,k=void 0,f=void 0;null==a||4>a.length?(a=this.material.getParameters(),g=e=0,k=a.texCoordScale[0],f=a.texCoordScale[1]):(e=a[0],g=a[1],k=a[2],f=a[3]);var k=Math.min(1.99999,k+1),f=Math.min(1.99999,f+1),m=c.indices[A.VertexAttrConstants.POSITION].length,h=b.uv0;a=d;for(var p=0;p<m;++p)h.set(a,0,e),h.set(a,1,g),a+=1,h.set(a,0,k),h.set(a,1,g),a+=1,h.set(a,0,k),h.set(a,1,f),a+=1,h.set(a,0,k),h.set(a,
1,f),a+=1,h.set(a,0,e),h.set(a,1,f),a+=1,h.set(a,0,e),h.set(a,1,g),a+=1;B.writeColor(c.indices[A.VertexAttrConstants.COLOR],c.vertexAttr[A.VertexAttrConstants.COLOR].data,4,b.color,d,6);e=c.indices[A.VertexAttrConstants.SIZE];g=c.vertexAttr[A.VertexAttrConstants.SIZE].data;k=e.length;f=b.size;a=d;for(p=0;p<k;++p)for(var m=g[2*e[p]],h=g[2*e[p]+1],n=0;6>n;++n)f.set(a,0,m),f.set(a,1,h),a+=1;c.indices[A.VertexAttrConstants.AUXPOS1]&&c.vertexAttr[A.VertexAttrConstants.AUXPOS1]&&B.writeBufferVec4(c.indices[A.VertexAttrConstants.AUXPOS1],
c.vertexAttr[A.VertexAttrConstants.AUXPOS1].data,b.auxpos1,d,6);c.indices[A.VertexAttrConstants.AUXPOS2]&&c.vertexAttr[A.VertexAttrConstants.AUXPOS2]&&B.writeBufferVec4(c.indices[A.VertexAttrConstants.AUXPOS2],c.vertexAttr[A.VertexAttrConstants.AUXPOS2].data,b.auxpos2,d,6)};return a}();return q})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(q,b){function l(b){return b instanceof Float32Array&&16<=b.length}function f(b){return Array.isArray(b)&&16<=b.length}
Object.defineProperty(b,"__esModule",{value:!0});b.isMat4f32=l;b.isMat4f64=f;b.isMat4=function(b){return l(b)||f(b)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(q,b,l,f,h,a,e){q=function(a){function b(b){var c=a.call(this,b)||this,d=b.textureRep;c.textureRep=d;c.textureId=b.textureId;
c.initTransparent=!!b.initTextureTransparent;var k=function(a){return e.acquireIfNotUndefined(a,d,c.initTransparent)};c.glTextureRef=k(c.textureId);b.normalTextureId&&(c.glTextureRefNormal=k(b.normalTextureId));b.emissiveTextureId&&(c.glTextureRefEmission=k(b.emissiveTextureId));b.occlusionTextureId&&(c.glTextureRefOcclusion=k(b.occlusionTextureId));b.metallicRoughnessTextureId&&(c.glTextureRefRoughnessMetallness=k(b.metallicRoughnessTextureId));return c}f(b,a);b.prototype.dispose=function(){e.releaseIfNotUndefined(this.textureId,
this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(e.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=e.acquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};b.prototype.bindTexture=function(a,c){null!=this.glTextureRef&&(c.setUniform1i("tex",h.DefaultTextureUnits.DIFFUSE),a.bindTexture(this.glTextureRef.glTexture,h.DefaultTextureUnits.DIFFUSE));this.glTextureRefNormal&&(c.setUniform1i("normalTexture",h.DefaultTextureUnits.NORMAL),
a.bindTexture(this.glTextureRefNormal.glTexture,h.DefaultTextureUnits.NORMAL));this.glTextureRefEmission&&(c.setUniform1i("texEmission",h.DefaultTextureUnits.EMISSION),a.bindTexture(this.glTextureRefEmission.glTexture,h.DefaultTextureUnits.EMISSION));this.glTextureRefOcclusion&&(c.setUniform1i("texOcclusion",h.DefaultTextureUnits.OCCLUSION),a.bindTexture(this.glTextureRefOcclusion.glTexture,h.DefaultTextureUnits.OCCLUSION));this.glTextureRefRoughnessMetallness&&(c.setUniform1i("texMetallicRoughness",
h.DefaultTextureUnits.METALLIC_ROUGHNESS),a.bindTexture(this.glTextureRefRoughnessMetallness.glTexture,h.DefaultTextureUnits.METALLIC_ROUGHNESS))};b.prototype.bindTextureScale=function(a,c){(a=this.glTextureRef&&this.glTextureRef.glTexture)&&a.descriptor.textureCoordinateScaleFactor?c.setUniform2fv("textureCoordinateScaleFactor",a.descriptor.textureCoordinateScaleFactor):c.setUniform2f("textureCoordinateScaleFactor",1,1)};return b}(a.GLMaterial);(function(a){a.makeCtorParameters=function(a,b){return l({},
a,b)}})(q||(q={}));return q})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ./AutoDisposable".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b){var d=a.call(this)||this;d.material=b.material;d.techniqueRep=b.techniqueRep;d.output=b.output;return d}l(b,a);b.prototype.getTechnique=function(){return this.technique};b.prototype.ensureResources=function(a){return 0};b.prototype.bindView=function(a){this.technique.bindDraw(a)};b.prototype.bindInstance=function(a){};return b=f([h.subclass("esri.views.3d.webgl-engine.lib.GLMaterial")],b)}(h.declared(a.AutoDisposable));
b.GLMaterial=q})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../../core/tsSupport/decorateHelper","../../../../core/accessorSupport/decorators"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.AutoDisposableMixin=function(a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._isDisposed=!1;return b}l(b,a);b.prototype.dispose=function(){for(var a=
this.__proto__.__managedDisposables__||[],b=a.length-1;0<=b;b--){var c=a[b];this[c]&&"function"===typeof this[c].dispose&&this[c].dispose();this[c]=null}this._isDisposed=!0};Object.defineProperty(b.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0});return b=f([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposableMixin")],b)}(h.declared(a))};q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);return b=f([h.subclass("esri.views.3d.webgl-engine.lib.AutoDisposable")],
b)}(h.declared(b.AutoDisposableMixin(function(){return function(){}}())));b.AutoDisposable=q;b.autoDispose=function(){return function(a,b){a.__managedDisposables__=a.__managedDisposables__||[];a.__managedDisposables__.push(b)}}})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../lib/ComponentUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a,b,d,e,g,k){var f=v(b,d,G);c.setMin(C,a.getBBMin());c.setMax(C,a.getBBMax());h.isSome(g)&&g.applyToAABB(C);if(y(C,b,f,e)){var f=a.getPrimitiveIndices(),m=a.getIndices(),p=a.getPosition(),n=f?f.length:m.length/3;if(n>P&&(a=a.getChildren(),void 0!==a)){for(f=0;8>f;++f)void 0!==a[f]&&u(a[f],b,d,e,g,k);return}t(b,d,0,n,m,p,f,g,k)}}function t(a,c,b,d,e,g,k,f,m){var p,n,r;if(k){var w,t,v=g.data,u=g.offsetIdx;g=g.strideIdx;var A=a[0],y=a[1];a=a[2];var l=
c[0]-A,B=c[1]-y;for(c=c[2]-a;b<d;++b){var C=k[b],E=3*C;t=u+g*e[E++];var L=v[t++],G=v[t++];p=v[t];t=u+g*e[E++];var R=v[t++];n=v[t++];w=v[t];t=u+g*e[E];E=v[t++];r=v[t++];t=v[t];h.isSome(f)&&(p=f.applyToVertex(L,G,p),L=p[0],G=p[1],p=p[2],w=f.applyToVertex(R,n,w),R=w[0],n=w[1],w=w[2],t=f.applyToVertex(E,r,t),E=t[0],r=t[1],t=t[2]);R-=L;n-=G;w-=p;E-=L;r-=G;t-=p;var O=B*t-r*c,H=c*E-t*l,P=l*r-E*B,S=R*O+n*H+w*P;if(!(Math.abs(S)<=J)){L=A-L;G=y-G;p=a-p;O=L*O+G*H+p*P;if(0<S){if(0>O||O>S)continue}else if(0<O||
O<S)continue;H=G*w-n*p;p=p*R-w*L;G=L*n-R*G;L=l*H+B*p+c*G;if(0<S){if(0>L||O+L>S)continue}else if(0<L||O+L<S)continue;G=(E*H+r*p+t*G)/S;0<=G&&(R=x(R,n,w,E,r,t,I),m(G,R,C))}}}else for(k=g.data,v=g.offsetIdx,u=g.strideIdx,g=a[0],A=a[1],y=a[2],a=c[0]-g,l=c[1]-A,B=c[2]-y,c=b,b*=3;c<d;++c)if(r=v+u*e[b++],L=k[r++],G=k[r++],p=k[r],r=v+u*e[b++],C=k[r++],R=k[r++],n=k[r],r=v+u*e[b++],w=k[r++],E=k[r++],r=k[r],h.isSome(f)&&(p=f.applyToVertex(L,G,p),L=p[0],G=p[1],p=p[2],n=f.applyToVertex(C,R,n),C=n[0],R=n[1],n=
n[2],r=f.applyToVertex(w,E,r),w=r[0],E=r[1],r=r[2]),C-=L,R-=G,n-=p,w-=L,E-=G,r-=p,S=l*r-E*B,O=B*w-r*a,H=a*E-w*l,t=C*S+R*O+n*H,!(Math.abs(t)<=J)){L=g-L;G=A-G;p=y-p;S=L*S+G*O+p*H;if(0<t){if(0>S||S>t)continue}else if(0<S||S<t)continue;O=G*n-R*p;p=p*C-n*L;G=L*R-C*G;L=a*O+l*p+B*G;if(0<t){if(0>L||S+L>t)continue}else if(0<L||S+L<t)continue;G=(w*O+E*p+r*G)/t;0<=G&&(C=x(C,R,n,w,E,r,I),m(G,C,c))}}function x(a,c,b,e,g,k,f){d.vec3.set(K,a,c,b);d.vec3.set(H,e,g,k);d.vec3.cross(f,K,H);d.vec3.normalize(f,f);return f}
function v(a,c,b){return d.vec3.set(b,1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]))}function y(a,c,b,d){return m(a,c,b,d,Infinity)}function m(a,c,b,d,e){var g=(a[0]-d-c[0])*b[0],k=(a[3]+d-c[0])*b[0],f=Math.min(g,k),g=Math.max(g,k),k=(a[1]-d-c[1])*b[1],m=(a[4]+d-c[1])*b[1],g=Math.min(g,Math.max(k,m));if(0>g)return!1;f=Math.max(f,Math.min(k,m));if(f>g)return!1;k=(a[2]-d-c[2])*b[2];a=(a[5]+d-c[2])*b[2];g=Math.min(g,Math.max(k,a));if(0>g)return!1;f=Math.max(f,Math.min(k,a));return f>g?!1:f<e}function w(a,
c){c=c?w(c):{};for(var b in a){var d=a[b];d&&d.forEach&&(d=A(d));null==d&&b in c||(c[b]=d)}return c}function A(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(b,"__esModule",{value:!0});var B=e.mat4f64.create(),C=c.create(),E=p.VertexAttrConstants;b.intersectTriangleGeometry=function(a,b,d,e,k,f,m){b=b&&b.componentVisibilities;d=d.tolerance;if(1<a.componentCount)a:{var n=v(e,k,G),r=a.componentCount,w=a.componentOffsets,x=a.getIndices(E.POSITION),A=a.getAttribute(E.POSITION),
l=a.boundingInfo;if(l&&(c.setMin(C,l.getBBMin()),c.setMax(C,l.getBBMax()),h.isSome(f)&&f.applyToAABB(C),!y(C,e,n,d)))break a;for(l=0;l<r;l++)if(!b||g.getVisibility(b,l)){if(a.getComponentAABB){var B=a.getComponentAABB(l,C);h.isSome(f)&&f.applyToAABB(B);if(!y(B,e,n,d))continue}t(e,k,w[l]/3,w[l+1]/3,x,A,void 0,f,m)}}else if(!b||g.getVisibility(b,0))a.boundingInfo?(p.assert("triangle"===a.data.primitiveType),u(a.boundingInfo,e,k,d,f,m)):(b=a.getIndices(E.POSITION),a=a.getAttribute(E.POSITION),t(e,k,
0,b.length/3,b,a,void 0,f,m))};var G=k.vec3f64.create(),J=Math.pow(2,-52),I=k.vec3f64.create();b.intersectTriangles=t;var K=k.vec3f64.create(),H=k.vec3f64.create();b.computeNormal=x;b.computeInvDir=v;b.intersectAabbInvDir=y;b.intersectAabbInvDirBefore=m;b.transformToWorld=function(a,c,b){return n.vec4.set(b,a[0]-c[0],a[1]-c[1],a[2]-c[2],1)};b.transformToView=function(c,b,d,e){a.mat4.translate(B,d,b);return n.vec4.transformMat4(e,c,B)};b.transformToProjection=function(a,c,b,d){d[0]=a[0]+b[0];d[1]=
a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3];return n.vec4.transformMat4(d,d,c)};b.transformToNDC=function(a,c){return n.vec4.scale(c,a,1/Math.abs(a[3]))};b.verticalOffsetAtDistance=function(a,c,b,d,e){var g=(b.screenLength||0)*a.pixelRatio;e&&(g=r.scale(g,d,c,e));return f.glClamp(g*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*c,b.minWorldLength||0,null!=b.maxWorldLength?b.maxWorldLength:Infinity)};b.acquireIfNotUndefined=function(a,c,b){if(void 0!==a)return c.acquire(a,b)};b.releaseIfNotUndefined=function(a,c){void 0!==
a&&c.release(a)};var L=k.vec3f64.create();b.bindSlicePlane=function(a,c,b){h.isSome(c)?(d.vec3.subtract(L,c.origin,a),b.setUniform3fv("slicePlaneOrigin",L),b.setUniform3fv("slicePlaneBasis1",c.basis1),b.setUniform3fv("slicePlaneBasis2",c.basis2)):b.setUniform3fv("slicePlaneBasis1",k.vec3f64.ZEROS)};b.bindHighlightRendering=function(a,c,b){a.bindTexture(c.highlightDepthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3])};b.bindScreenSizePerspective=
function(a,c,b){void 0===b&&(b="screenSizePerspectiveAlignment");if(a){var d=a.parameters;c.setUniform4f(b,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};b.copyParameters=w;b.updateParameters=function(a,c){var b=!1,d;for(d in c){var e=c[d];void 0!==e&&(b=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return b};(function(a){function c(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,b){for(var d=[],e=0;2>e;e++)for(var g=0;2>g;g++){var k=c({shadowMappingEnabled:1===
e,ssaoEnabled:1===g}),f=c({shadowMappingEnabled:1===e,ssaoEnabled:1===g&&a.receiveSSAO});d[k]=d[f]||b({receiveShadows:1===e,receiveSSAO:1===g&&a.receiveSSAO})}return{programs:d.filter(function(a){return null!=a}),byParameter:d}};a.lookup=function(a,b){return a.byParameter[c(b)]};a.programs=function(a){return a.programs}})(b.BindParametersMap||(b.BindParametersMap={}));b.intersectDrapedRenderLineGeometry=function(a,c,b,d,e){if(c.options.selectionMode){c=a.getAttribute(E.POSITION).data;var g=a.getAttribute(E.SIZE),
k=b[0];b=b[1];a=(((g&&g.data[0])+d)/2+4)*a.pixelRatio;d=Number.MAX_VALUE;for(g=0;g<c.length-5;g+=3){var m=c[g],h=c[g+1],p=k-m,n=b-h,m=c[g+3]-m,h=c[g+4]-h,r=f.clamp((m*p+h*n)/(m*m+h*h),0,1),p=m*r-p,n=h*r-n,n=p*p+n*n;n<d&&(d=n)}d<a*a&&e()}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var P=1E3;b.defaultPBRMaterialParameters={roughnessFactor:.6,metallicFactor:0,reflectanceFactor:.2};b.defaultPBRTreeMaterialParameters={roughnessFactor:1,metallicFactor:0,reflectanceFactor:.2};b.getDefaultPBRMaterialParameters=
function(a,c){return l({usePBR:a},c?b.defaultPBRTreeMaterialParameters:b.defaultPBRMaterialParameters)}})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(f){this.supportsEdges=!1;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.materialRepositories=[];this.id=b._idGen.gen(f)}b.prototype.update=function(b){return!1};Object.defineProperty(b.prototype,
"visible",{get:function(){return this._visible},set:function(b){b!==this._visible&&(this._visible=b,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(b){b!==this._renderOccluded&&(this._renderOccluded=b,this.parametersChanged())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(b){b!==this._renderPriority&&
(this._renderPriority=b,this.parametersChanged())},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(b){return!0};b.prototype.isVisible=function(){return this._visible};b.prototype.parametersChanged=function(){for(var b=0,a=this.materialRepositories;b<a.length;b++)a[b].materialChanged(this)};b._idGen=new l.IdGen;return b}();b.Material=q})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["require","exports","../../../support/buffer/BufferView",
"../../lib/Util"],function(q,b,l,f){function h(a,b,d,e,k){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==k||1===k)for(var f=0;f<g;++f){var h=2*a[f];c[e]=b[h];c[e+1]=b[h+1];e+=d}else for(f=0;f<g;++f)for(var h=2*a[f],m=0;m<k;++m)c[e]=b[h],c[e+1]=b[h+1],e+=d}function a(a,b,d,e,k){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==k||1===k)for(var f=0;f<g;++f){var h=3*a[f];c[e]=b[h];c[e+1]=b[h+1];c[e+2]=b[h+2];e+=d}else for(f=0;f<g;++f)for(var h=3*a[f],m=0;m<
k;++m)c[e]=b[h],c[e+1]=b[h+1],c[e+2]=b[h+2],e+=d}function e(a,b,d,e,k){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;if(null==k||1===k)for(var f=0;f<g;++f){var h=4*a[f];c[e]=b[h];c[e+1]=b[h+1];c[e+2]=b[h+2];c[e+3]=b[h+3];e+=d}else for(f=0;f<g;++f)for(var h=4*a[f],m=0;m<k;++m)c[e]=b[h],c[e+1]=b[h+1],c[e+2]=b[h+2],c[e+3]=b[h+3],e+=d}function d(c,b,d,e,k,f){if(d){var g=e.typedBuffer;e=e.typedBufferStride;var h=c.length;k*=e;if(null==f||1===f)for(var p=0;p<h;++p){var m=3*c[p],n=b[m],r=
b[m+1],t=b[m+2];g[k]=d[0]*n+d[4]*r+d[8]*t+d[12];g[k+1]=d[1]*n+d[5]*r+d[9]*t+d[13];g[k+2]=d[2]*n+d[6]*r+d[10]*t+d[14];k+=e}else for(p=0;p<h;++p)for(var m=3*c[p],n=b[m],r=b[m+1],t=b[m+2],m=d[0]*n+d[4]*r+d[8]*t+d[12],u=d[1]*n+d[5]*r+d[9]*t+d[13],n=d[2]*n+d[6]*r+d[10]*t+d[14],r=0;r<f;++r)g[k]=m,g[k+1]=u,g[k+2]=n,k+=e}else a(c,b,e,k,f)}function k(c,b,d,e,k,f){if(d){var g=e.typedBuffer;e=e.typedBufferStride;var h=c.length;k*=e;if(null==f||1===f)for(var p=0;p<h;++p){var m=3*c[p],n=b[m],r=b[m+1],t=b[m+2];
g[k]=d[0]*n+d[4]*r+d[8]*t;g[k+1]=d[1]*n+d[5]*r+d[9]*t;g[k+2]=d[2]*n+d[6]*r+d[10]*t;k+=e}else for(p=0;p<h;++p)for(var m=3*c[p],n=b[m],r=b[m+1],t=b[m+2],m=d[0]*n+d[4]*r+d[8]*t,u=d[1]*n+d[5]*r+d[9]*t,n=d[2]*n+d[6]*r+d[10]*t,r=0;r<f;++r)g[k]=m,g[k+1]=u,g[k+2]=n,k+=e}else a(c,b,e,k,f)}function n(a,b,d,e,k,f){var c=e.typedBuffer;e=e.typedBufferStride;var g=a.length;k*=e;if(null==f||1===f)if(4===d)for(d=0;d<g;++d){var h=4*a[d];c[k]=b[h];c[k+1]=b[h+1];c[k+2]=b[h+2];c[k+3]=b[h+3];k+=e}else{if(3===d)for(d=
0;d<g;++d)h=3*a[d],c[k]=b[h],c[k+1]=b[h+1],c[k+2]=b[h+2],c[k+3]=255,k+=e}else if(4===d)for(d=0;d<g;++d)for(var h=4*a[d],m=0;m<f;++m)c[k]=b[h],c[k+1]=b[h+1],c[k+2]=b[h+2],c[k+3]=b[h+3],k+=e;else if(3===d)for(d=0;d<g;++d)for(h=3*a[d],m=0;m<f;++m)c[k]=b[h],c[k+1]=b[h+1],c[k+2]=b[h+2],c[k+3]=255,k+=e}Object.defineProperty(b,"__esModule",{value:!0});b.writeBufferVec2=h;b.writeBufferVec3=a;b.writeBufferVec4=e;b.writeBufferMat3f=function(a,b,d,e){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;
e*=d;for(var k=0;k<g;++k){for(var f=9*a[k],h=0;9>h;++h)c[e+h]=b[f+h];e+=d}};b.writeBufferMat4f=function(a,b,d,e){var c=d.typedBuffer;d=d.typedBufferStride;var g=a.length;e*=d;for(var k=0;k<g;++k){for(var f=16*a[k],h=0;16>h;++h)c[e+h]=b[f+h];e+=d}};b.writePosition=d;b.writeNormal=k;b.writeColor=n;b.writeMultipliedColor=function(a,b,d,e,k,f,h){var c=k.typedBuffer;k=k.typedBufferStride;var g=a.length;f*=k;if(null==h||1===h)if(4===d)for(d=0;d<g;++d){var m=4*a[d];c[f]=b[m]*e[0];c[f+1]=b[m+1]*e[1];c[f+
2]=b[m+2]*e[2];c[f+3]=b[m+3]*e[3];f+=k}else{if(3===d){var p=255*e[3];for(d=0;d<g;++d)m=3*a[d],c[f]=b[m]*e[0],c[f+1]=b[m+1]*e[1],c[f+2]=b[m+2]*e[2],c[f+3]=p,f+=k}}else if(4===d)for(d=0;d<g;++d)for(var m=4*a[d],n=0;n<h;++n)c[f]=b[m]*e[0],c[f+1]=b[m+1]*e[1],c[f+2]=b[m+2]*e[2],c[f+3]=b[m+3]*e[3],f+=k;else if(3===d)for(p=255*e[3],d=0;d<g;++d)for(m=3*a[d],n=0;n<h;++n)c[f]=b[m]*e[0],c[f+1]=b[m+1]*e[1],c[f+2]=b[m+2]*e[2],c[f+3]=p,f+=k};b.writeDefaultAttributes=function(a,b,r,p,u,t){var c=0;for(b=b.fieldNames;c<
b.length;c++){var g=b[c],y=a.vertexAttr[g],m=a.indices[g];if(y&&m)switch(g){case f.VertexAttrConstants.POSITION:f.assert(3===y.size);(g=u.getField(g,l.BufferViewVec3f))&&d(m,y.data,r,g,t);break;case f.VertexAttrConstants.NORMAL:f.assert(3===y.size);(g=u.getField(g,l.BufferViewVec3f))&&k(m,y.data,p,g,t);break;case f.VertexAttrConstants.UV0:f.assert(2===y.size);(g=u.getField(g,l.BufferViewVec2f))&&h(m,y.data,g,t);break;case f.VertexAttrConstants.REGION:f.assert(4===y.size);(g=u.getField(g,l.BufferViewVec4u16))&&
e(m,y.data,g,t);break;case f.VertexAttrConstants.COLOR:f.assert(3===y.size||4===y.size);(g=u.getField(g,l.BufferViewVec4u8))&&n(m,y.data,y.size,g,t);break;case f.VertexAttrConstants.SYMBOLCOLOR:f.assert(3===y.size||4===y.size);(g=u.getField(g,l.BufferViewVec4u8))&&n(m,y.data,y.size,g,t);break;case f.VertexAttrConstants.TANGENT:f.assert(4===y.size),(g=u.getField(g,l.BufferViewVec4f))&&e(m,y.data,g,t)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/iteratorUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/IntervalUtilities ../../lib/ResizableFloat32Array ../../lib/Util ../WaterGLMaterial ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a,c,b,d){for(var e=new Map,g=c.vertexBufferLayout.stride/4,k=function(b,d){var k=b.origin,f=a.get(k.id),m=e.get(k.id);null==m&&(m={optimalCount:null==f?0:f.optimalCount,sparseCount:null==f?0:f.buffer.size,toAdd:[],toRemove:[],origin:k.vec3},e.set(k.id,m));k=c.elementCount(b.data)*g;d?(m.optimalCount+=k,m.sparseCount+=k,m.toAdd.push(b)):(m.optimalCount-=k,m.toRemove.push(b))},f=0;f<b.length;f++){var m=b[f];k(m,!0)}for(b=0;b<d.length;b++)m=d[b],k(m,
!1);return e}q=function(){function b(a,c,b,d){void 0===d&&(d=e.Default3D);this.type="MergedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._vertexAttributeLocations=d;this._material=b;this._materialRep=c;this._glMaterials=r.acquireMaterials(this._material,this._materialRep);this._bufferWriter=b.createBufferWriter()}b.prototype.dispose=function(){r.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===
this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return l.someMap(this._glMaterials,function(a){return a instanceof c.WaterGLMaterial})},enumerable:!0,configurable:!0});b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){var c=this,b=A;b.clear();this.updateGeometries(a.toUpdate,
b);this.addAndRemoveGeometries(a.toAdd,a.toRemove,b);this.updateHighlightCount();b.forEach(function(a){return c.updateDisplayedIndexRanges(a)})};b.prototype.addAndRemoveGeometries=function(a,c,b){var d=this,e=this._bufferWriter,g=e.vertexBufferLayout,k=g.stride/4,f=this._dataByOrigin,m=x(f,e,a,c);m.forEach(function(a,c){m.delete(c);var e=a.optimalCount,h=a.sparseCount,p=f.get(c);null==p&&(n.assert(0<e),p=d.createData(g,e,a.origin),f.set(c,p));if(0===e)p.vao.dispose(!0),p.vao=null,f.delete(c);else{var w=
e<a.sparseCount/2;c=v;var r=p.buffer.size,t=p.buffer.array,e=p.buffer.resize(w?e:h,!1);w||e?d.removeAndRebuild(p,a.toRemove,k,t,c):0<a.toRemove.length?(d.removeByErasing(p,a.toRemove,k,c),0<a.toAdd.length&&(c.end=r)):(c.begin=r,c.end=r);e=y;n.setMatrixTranslation3(e,-a.origin[0],-a.origin[1],-a.origin[2]);d.append(p,a.toAdd,k,e,c);a=p.vao.vertexBuffers.geometry;a.byteSize!==p.buffer.array.buffer.byteLength?a.setData(p.buffer.array):(h=c.begin,e=c.end,h<e&&(h*=4,a.setSubData(p.buffer.array,h,h,4*e)));
(c.updatedDisplayedIndexRange||p.displayedIndexRanges)&&b.add(p)}})};b.prototype.updateGeometries=function(a,c){for(var b=this._bufferWriter,d=b.vertexBufferLayout.stride/4,e=0;e<a.length;e++){var g=a[e],k=g.updateType,g=g.renderGeometry,f=this._dataByOrigin.get(g.origin.id),h=f&&f.instances.get(g.uniqueName);if(!h)break;k&1&&(h.displayedIndexRange=r.generateRenderGeometryVisibleIndexRanges(g),c.add(f));k&17&&(h.highlightedIndexRanges=r.generateRenderGeometryHighlightRanges(g),f.highlightCount=null);
k&6&&(k=f.buffer.array,f=f.vao,r.calculateTransformRelToOrigin(g,m,w),b.write({transformation:m,invTranspTransformation:w},g.data,b.vertexBufferLayout.createView(k.buffer),h.from),n.assert(h.from+b.elementCount(g.data)===h.to,"material VBO layout has changed"),f.vertexBuffers.geometry.setSubData(k,h.from*d*4,h.from*d*4,h.to*d*4))}};b.prototype.updateDisplayedIndexRanges=function(a){a.displayedIndexRanges=[];var c=!0;a.instances.forEach(function(b){b.displayedIndexRange?(a.displayedIndexRanges.push.apply(a.displayedIndexRanges,
d.offsetIntervals(b.displayedIndexRange,b.from)),c=!1):a.displayedIndexRanges.push([b.from,b.to-1])});a.displayedIndexRanges=c?null:d.mergeIntervals(a.displayedIndexRanges)};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==c.highlightCount){var b=0;c.instances.forEach(function(a){a.highlightedIndexRanges&&++b});c.highlightCount=b}a._highlightCount+=c.highlightCount})};b.prototype.updateLogic=function(a){return this._material.update(a)};
b.prototype.render=function(a,c,b,d){var e=this,g=this._rctx,k=this._glMaterials.get(c.pass),f=4===c.pass;2===c.pass&&null===a&&(a=19);if(!k||1===k.ensureResources(g)||null!=a&&!k.beginSlot(a)||f&&0===this._highlightCount)return!1;k.bind(g,b);c=k.getTechnique().program;c.setUniformMatrix4fv("model",h.mat4f64.IDENTITY);c.hasUniform("modelNormal")&&c.setUniformMatrix4fv("modelNormal",h.mat4f64.IDENTITY);var m=!1;this._dataByOrigin.forEach(function(a){f&&0===a.highlightCount||(b.origin=a.origin,k.bindView(b),
m=f?e.renderHighlightPass(k,a,d)||m:e.renderDefaultPass(k,a,d)||m)});return m};b.prototype.renderDefaultPass=function(a,c,b){var d=this._rctx,e=c.displayedIndexRanges;if(e&&0===e.length)return!1;a=a.getTechnique();a.ensureAttributeLocations(c.vao);d.bindVAO(c.vao);e?r.drawArraysFaceRange(d,e,0,a.primitiveType,b):(c=4*c.buffer.size/u.getStride(c.vao.layout.geometry),r.drawArrays(d,a.primitiveType,0,c,b));return!0};b.prototype.renderHighlightPass=function(a,c,b){var d=this._rctx,e=c.vao,g=a.getTechnique();
g.ensureAttributeLocations(e);d.bindVAO(e);var k=!1;c.instances.forEach(function(a){var c=a.highlightedIndexRanges;if(c&&0!==c.length)for(var e=0;e<c.length;e++){var f=c[e];r.drawArrays(d,g.primitiveType,f.range?f.range[0]+a.from:a.from,f.range?f.range[1]-f.range[0]+1:a.to-a.from,b);k=!0}});return k};b.prototype.createData=function(c,b,d){return{instances:new Map,vao:new t(this._rctx,this._vertexAttributeLocations,{geometry:a.glLayout(c)},{geometry:p.createVertex(this._rctx,35044)}),buffer:new k.ResizableFloat32Array(b),
optimalCount:0,origin:d,highlightCount:0}};b.prototype.removeAndRebuild=function(a,c,b,d,e){for(var g=0;g<c.length;g++){var k=c[g].uniqueName,f=a.instances.get(k);a.optimalCount-=(f.to-f.from)*b;a.instances.delete(k)}var m=0,h=a.buffer.array;e.begin=0;e.end=0;var p=-1,n=-1,w=0;a.instances.forEach(function(a){var c=a.from*b,e=a.to*b,g=e-c;p!==n&&n!==c?(h.set(d.subarray(p,n),w),w+=n-p,p=c):-1===p&&(p=c);n=e;a.from=m/b;m+=g;a.to=m/b});p!==n&&h.set(d.subarray(p,n),w);e.end=m};b.prototype.removeByErasing=
function(a,c,b,d){d.begin=Infinity;d.end=-Infinity;for(var e=-1,g=-1,k=0;k<c.length;k++){var f=c[k].uniqueName,m=a.instances.get(f),h=m.from*b,m=m.to*b;e!==g&&g!==h?(a.buffer.erase(e,g),e=h):-1===e&&(e=h);g=m;a.instances.delete(f);a.optimalCount-=m-h;h<d.begin&&(d.begin=h);m>d.end&&(d.end=m)}e!==g&&a.buffer.erase(e,g)};b.prototype.append=function(a,c,b,d,e){e.updatedDisplayedIndexRange=!1;for(var k=this._bufferWriter,h=0;h<c.length;h++){var p=c[h],t=p.data;f.mat4.multiply(m,d,p.transformation);f.mat4.invert(w,
m);f.mat4.transpose(w,w);var v=e.end;k.write({transformation:m,invTranspTransformation:w},t,k.vertexBufferLayout.createView(a.buffer.array.buffer),e.end/b);var t=k.elementCount(t)*b,A=v+t;n.assert(null==a.instances.get(p.uniqueName));var x=r.generateRenderGeometryVisibleIndexRanges(p),u=r.generateRenderGeometryHighlightRanges(p);u&&(a.highlightCount=null);v=new g(p.name,v/b,A/b,x,u,void 0,void 0,p.idx);a.instances.set(p.uniqueName,v);x&&(e.updatedDisplayedIndexRange=!0);a.optimalCount+=t;e.end+=t}};
Object.defineProperty(b.prototype,"test",{get:function(){return{material:this._material}},enumerable:!0,configurable:!0});return b}();var v={updatedDisplayedIndexRange:!1,begin:0,end:0},y=h.mat4f64.create(),m=h.mat4f64.create(),w=h.mat4f64.create(),A=new Set;return q})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(q,b){return function(){function b(){}b.copyIntervals=function(b){for(var f=[],a=0;a<b.length;a++){var e=b[a];f.push([e[0],e[1]])}return f};
b.convertFaceToIndexRange=function(b,h){for(var a=0;a<b.length;a++){var e=b[a];e[0]*=h;e[1]=e[1]*h+(h-1)}};b.sortIntervals=function(b){return b.sort(function(b,a){return b[0]===a[0]?b[1]>a[1]?1:b[1]<a[1]?-1:0:b[0]>a[0]?1:b[0]<a[0]?-1:0})};b.intersectIntervals=function(b,h){if(0>=b.length)return[];for(var a=[],e=0;e<b.length;e++){var d=b[e];d[1]<h[0]||d[0]>h[1]||(d=[d[0],d[1]],d[0]<h[0]&&(d[0]=h[0]),d[1]>h[1]&&(d[1]=h[1]),a.push(d))}return a};b.mergeIntervals=function(b){if(0>=b.length)return[];var f=
[];b=this.sortIntervals(b);f.push(b[0]);for(var a=1;a<b.length;a++){var e=f[f.length-1];e[1]+1<b[a][0]?f.push(b[a]):e[1]<b[a][1]&&(e[1]=b[a][1],f.pop(),f.push(e))}return f};b.invertIntervals=function(b,h){for(var a=[],e=0,d=0;d<b.length;d++){var k=b[d];k[0]>e&&a.push([e,k[0]-1]);e=k[1]+1}e<=h&&a.push([e,h]);return a};b.offsetIntervals=function(b,h){for(var a=[],e=0;e<b.length;e++){var d=b[e];a.push([d[0]+h,d[1]+h])}return a};return b}()})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["require",
"exports","../../../../core/mathUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){null==b?b=16:65536>b&&(b=l.nextHighestPowerOfTwo(b));this._array=new Float32Array(b);this._size=0}b.prototype.resize=function(b,a){this._size=b;if(this._size>this._array.length){for(b=this._array.length||1;b<this._size;)b*=2;var e=new Float32Array(b);a&&e.set(this._array);this._array=e;return!0}e=2*this._size;if(e<=this._array.length){for(b=this._array.length;b>=e;)b=
Math.floor(b/2);e=new Float32Array(b);a&&e.set(this._array.subarray(0,b));this._array=e;return!0}return!1};b.prototype.append=function(b){var a=this._size;this.resize(this._size+b.length,!0);this._array.set(b,a)};b.prototype.erase=function(b,a){for(;b<a;++b)this._array[b]=0};Object.defineProperty(b.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});return b}();
b.ResizableFloat32Array=q})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/GLMaterial ./WaterTechnique ./internal/MaterialUtil ./internal/waterMaterialUtils".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function k(a){a=b.call(this,a)||this;a.updateParameters();return a}l(k,b);k.prototype.updateParameters=function(){this.params=
e.copyParameters(this.material.getParameters());this.technique=this.techniqueRep.acquireAndReleaseExisting(a.WaterTechnique,this.material.getTechniqueConfig(this.output),this.technique)};k.prototype.beginSlot=function(a){if(2===this.output)return 19===a;if(5===this.output)return null==a;var c=4;this.params.transparent&&(c=this.params.writeDepth?6:9);return a===c};k.prototype.setElapsedTimeUniform=function(a){a.setUniform1f("timeElapsed",.001*this.material.animation.time*this.params.animationSpeed)};
k.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.params.receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};k.prototype.ensureResources=function(a){d.waterTextureRepo.ready()||d.waterTextureRepo.loading()||(this.texturePaths=[this.params.waveTexture,this.params.perturbationTexture],d.waterTextureRepo.initialize(a,this.texturePaths));return d.waterTextureRepo.ready()?2:1};k.prototype.bind=function(a,b){d.waterTextureRepo.ready()&&
(0===this.output&&this._updateShadowState(b),a.bindProgram(this.technique.program),a.setPipelineState(this.technique.pipeline),this.technique.bindPass(a,this.params),2===this.output||0===this.output)&&(d.waterTextureRepo.bindRepo(a),this.setElapsedTimeUniform(this.technique.program))};return k}(h.GLMaterial);b.WaterGLMaterial=q})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../shaders/WaterSurface.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function g(){return null!==b&&b.apply(this,arguments)||this}l(g,b);g.prototype.initializeProgram=function(a){var c=g.shader.get(),b=this.configuration,c=c.build({output:b.output,viewingMode:a.viewingMode,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:b.receiveShadows,usePBR:!1,usePBRforWater:!0,useCustomDTRExponentForWater:!0});
return new t(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),p.Default3D)};g.prototype.bindPass=function(a,c){0!==this.configuration.output&&2!==this.configuration.output||k.WaterDistortion.bindUniforms(this.program,c);0!==this.configuration.output&&5!==this.configuration.output||this.program.setUniform4fv("waterColor",c.color)};g.prototype.bindDraw=function(c){e.Transform.bindUniforms(this.program,c);0===this.configuration.output&&(n.Camera.bindUniforms(this.program,c),a.Slice.bindUniformsWithOrigin(this.program,
this.configuration,c),d.ReadShadowMap.bindUniforms(this.program,c))};g.prototype.initializePipeline=function(){var a=this.configuration;return 2===a.output?x.makePipelineState({depthTest:{func:513},depthWrite:a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams}):x.makePipelineState({blending:a.transparent&&x.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};g.prototype.bindPipelineState=
function(a){a.setPipelineState(this.pipeline)};g.shader=new c.ReloadableShaderModule(u,"../shaders/WaterSurface.glsl",q);return g}(g.ShaderTechnique);b.WaterTechnique=h;h=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.output=0;c.receiveShadows=!1;c.slicePlaneEnabled=!1;c.transparent=!1;c.writeDepth=!1;return c}l(c,a);f([r.parameter({count:7})],c.prototype,"output",void 0);f([r.parameter()],c.prototype,"receiveShadows",void 0);f([r.parameter()],c.prototype,"slicePlaneEnabled",
void 0);f([r.parameter()],c.prototype,"transparent",void 0);f([r.parameter()],c.prototype,"writeDepth",void 0);return c}(r.ShaderTechniqueConfiguration);b.WaterTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("require exports ../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../shaderModules/interfaces".split(" "),function(q,
b,l,f,h,a,e){function d(a,b){if(b.slicePlaneEnabled){a.extensions.add("GL_OES_standard_derivatives");b.sliceEnabledForVertexPrograms&&(a.vertex.uniforms.add("slicePlaneOrigin","vec3"),a.vertex.uniforms.add("slicePlaneBasis1","vec3"),a.vertex.uniforms.add("slicePlaneBasis2","vec3"));a.fragment.uniforms.add("slicePlaneOrigin","vec3");a.fragment.uniforms.add("slicePlaneBasis1","vec3");a.fragment.uniforms.add("slicePlaneBasis2","vec3");var d=e.glsl(n||(n=l(["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "],
["\n      struct SliceFactors {\n        float front;\n        float side0;\n        float side1;\n        float side2;\n        float side3;\n      };\n\n      SliceFactors calculateSliceFactors(vec3 pos) {\n        vec3 rel \x3d pos - slicePlaneOrigin;\n\n        vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\n        float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\n\n        float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\n        float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\n\n        float basis1Dot \x3d dot(slicePlaneBasis1, rel);\n        float basis2Dot \x3d dot(slicePlaneBasis2, rel);\n\n        return SliceFactors(\n          dot(slicePlaneNormal, pos) + slicePlaneW,\n          -basis1Dot - basis1Len2,\n          basis1Dot - basis1Len2,\n          -basis2Dot - basis2Len2,\n          basis2Dot - basis2Len2\n        );\n      }\n\n      bool sliceByFactors(SliceFactors factors) {\n        return factors.front \x3c 0.0\n          \x26\x26 factors.side0 \x3c 0.0\n          \x26\x26 factors.side1 \x3c 0.0\n          \x26\x26 factors.side2 \x3c 0.0\n          \x26\x26 factors.side3 \x3c 0.0;\n      }\n      \n      bool sliceEnabled() {\n        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.\n        return dot(slicePlaneBasis1, slicePlaneBasis1) !\x3d 0.0;\n      }\n\n      bool sliceByPlane(vec3 pos) {\n        return sliceEnabled() \x26\x26 sliceByFactors(calculateSliceFactors(pos));\n      }\n\n      #define rejectBySlice(_pos_) sliceByPlane(_pos_)\n      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\n    "]))),
k=e.glsl(c||(c=l(["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "],
["\n      vec4 applySliceHighlight(vec4 color, vec3 pos) {\n        SliceFactors factors \x3d calculateSliceFactors(pos);\n\n        if (sliceByFactors(factors)) {\n          return color;\n        }\n\n        const float HIGHLIGHT_WIDTH \x3d 1.0;\n        const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\n\n        factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\n        factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\n        factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\n        factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\n        factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\n\n        float highlightFactor \x3d (1.0 - step(0.5, factors.front))\n          * (1.0 - step(0.5, factors.side0))\n          * (1.0 - step(0.5, factors.side1))\n          * (1.0 - step(0.5, factors.side2))\n          * (1.0 - step(0.5, factors.side3));\n\n        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\n      }\n    "]))),
k=b.sliceHighlightDisabled?e.glsl(g||(g=l(["#define highlightSlice(_color_, _pos_) (_color_)"],["#define highlightSlice(_color_, _pos_) (_color_)"]))):e.glsl(r||(r=l(["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "],["\n        "," \n        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))\n      "])),k);b.sliceEnabledForVertexPrograms&&a.vertex.code.add(d);
a.fragment.code.add(d);a.fragment.code.add(k)}else d=e.glsl(p||(p=l(["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "],["\n      #define rejectBySlice(_pos_) false\n      #define discardBySlice(_pos_) {}\n      #define highlightSlice(_color_, _pos_) (_color_)\n    "]))),b.sliceEnabledForVertexPrograms&&a.vertex.code.add(d),a.fragment.code.add(d)}Object.defineProperty(b,"__esModule",{value:!0});b.Slice=
d;(function(c){c.bindUniformsWithOrigin=function(a,b,d){c.bindUniforms(a,b,d.slicePlane,d.origin)};c.bindUniforms=function(c,b,d,e){b.slicePlaneEnabled&&(f.isSome(d)?(e?(h.vec3.subtract(k,d.origin,e),c.setUniform3fv("slicePlaneOrigin",k)):c.setUniform3fv("slicePlaneOrigin",d.origin),c.setUniform3fv("slicePlaneBasis1",d.basis1),c.setUniform3fv("slicePlaneBasis2",d.basis2)):(c.setUniform3fv("slicePlaneBasis1",a.vec3f64.ZEROS),c.setUniform3fv("slicePlaneBasis2",a.vec3f64.ZEROS),c.setUniform3fv("slicePlaneOrigin",
a.vec3f64.ZEROS)))}})(d=b.Slice||(b.Slice={}));var k=a.vec3f64.create(),n,c,g,r,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a){a.include(f.RgbaFloatEncoding);a.fragment.uniforms.add("depthTex","sampler2D");a.fragment.uniforms.add("shadowMapNum","int");a.fragment.uniforms.add("shadowMapDistance",
"vec4");a.fragment.uniforms.add("shadowMapMatrix","mat4",4);a.fragment.uniforms.add("depthHalfPixelSz","float");a.fragment.code.add(h.glsl(e||(e=l(["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "],
["\n    float readShadowMap(const in vec3 _vpos, float _linearDepth) {\n      float halfPixelSize \x3d depthHalfPixelSz;\n      vec4 distance \x3d shadowMapDistance;\n      float depth \x3d _linearDepth;\n\n      //choose correct cascade\n      int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\n\n      if (i \x3e\x3d shadowMapNum) { return 0.0; }\n\n      mat4 mat \x3d i \x3d\x3d 0 ? shadowMapMatrix[0] : i \x3d\x3d 1 ? shadowMapMatrix[1] : i \x3d\x3d 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];\n\n      vec4 lv \x3d mat * vec4(_vpos, 1.0);\n      lv.xy /\x3d lv.w;\n\n      // vertex completely outside? -\x3e no shadow\n      vec3 lvpos \x3d 0.5 * lv.xyz + vec3(0.5);\n      if (lvpos.z \x3e\x3d 1.0) { return 0.0; }\n      if (lvpos.x \x3c 0.0 || lvpos.x \x3e 1.0 || lvpos.y \x3c 0.0 || lvpos.y \x3e 1.0) { return 0.0; }\n\n      // calc coord in cascade texture\n      vec2 uv \x3d vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;\n\n      float texSize \x3d 0.5 / halfPixelSize;\n\n      // filter, offset by half pixels\n      vec2 st \x3d fract((vec2(halfPixelSize) + uv) * texSize);\n\n      float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n      float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) \x3c lvpos.z ? 1.0 : 0.0;\n\n      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.ReadShadowMap=a;(function(a){a.bindUniforms=function(a,b){b.shadowMappingEnabled&&(b.shadowMap.bind(a),b.shadowMap.bindView(a,b.origin))};a.bindViewCustomOrigin=function(a,b,c){b.shadowMappingEnabled&&b.shadowMap.bindView(a,c)};a.bindView=function(a,b){b.shadowMappingEnabled&&b.shadowMap.bindView(a,b.origin)}})(a=b.ReadShadowMap||(b.ReadShadowMap={}));var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){function h(b){b.fragment.uniforms.add("texWaveNormal","sampler2D");b.fragment.uniforms.add("texWavePerturbation","sampler2D");b.fragment.uniforms.add("octaveTextureRepeat","vec3");b.fragment.uniforms.add("waveParams","vec4");b.fragment.uniforms.add("waveDirection","vec2");b.fragment.code.add(f.glsl(a||(a=l(["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "],
["\n      const vec2  FLOW_JUMP \x3d vec2(6.0/25.0, 5.0/24.0);\n\n      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rg - 1.0;\n      }\n\n      float sampleNoiseTexture(vec2 _uv) {\n        return texture2D(texWavePerturbation, _uv).b;\n      }\n\n      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\n        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;\n      }\n\n      float computeProgress(vec2 uv, float time) {\n        return fract(time);\n      }\n\n      float computeWeight(vec2 uv, float time) {\n        float progress \x3d computeProgress(uv, time);\n        return 1.0 - abs(1.0 - 2.0 * progress);\n      }\n\n      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\n        float flowStrength \x3d waveParams[2];\n        float flowOffset \x3d waveParams[3];\n\n        vec2 flowVector \x3d textureDenormalized2D(texFlow, uv) * flowStrength;\n\n        float progress \x3d computeProgress(uv, time + phaseOffset);\n        float weight \x3d computeWeight(uv, time + phaseOffset);\n\n        vec2 result \x3d uv;\n        result -\x3d flowVector * (progress + flowOffset);\n        result +\x3d phaseOffset;\n        result +\x3d (time - progress) * FLOW_JUMP;\n\n        return vec3(result, weight);\n      }\n\n      const float TIME_NOISE_TEXTURE_REPEAT \x3d 0.3737;\n      const float TIME_NOISE_STRENGTH \x3d 7.77;\n\n      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\n        float waveStrength \x3d waveParams[0];\n\n        // overall directional shift in uv's for directional wave movement for\n        // now we do a hard coded scale for wave speed such that a unit length\n        // direction is not too fast.\n        vec2 waveMovement \x3d time * -_waveDir;\n\n        float timeNoise \x3d sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\n\n        // compute two perturbed uvs and blend weights\n        // then sample the wave normals at the two positions and blend\n        vec3 uv_A \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\n        vec3 uv_B \x3d computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\n\n        vec3 normal_A \x3d textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\n        vec3 normal_B \x3d textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\n\n        // logic to flatten the wave pattern\n        // scale xy components of the normal, then adjust z (up) component\n        vec3 mixNormal \x3d normalize(normal_A + normal_B);\n        mixNormal.xy *\x3d waveStrength;\n        mixNormal.z \x3d sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\n\n        return mixNormal;\n      }\n\n      vec3 getSurfaceNormal(vec2 _uv, float _time) {\n        float waveTextureRepeat \x3d waveParams[1];\n        return getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\n      }\n    "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.WaterDistortion=h;(function(a){a.bindUniforms=function(a,b){a.setUniform1i("texWaveNormal",0);a.setUniform1i("texWavePerturbation",1);a.setUniform4f("waveParams",b.waveStrength,b.waveTextureRepeat,b.flowStrength,b.flowOffset);a.setUniform2f("waveDirection",b.waveDirection[0]*b.waveVelocity,b.waveDirection[1]*b.waveVelocity)}})(h=b.WaterDistortion||(b.WaterDistortion={}));var a})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/Camera.glsl":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){function f(b,a,e){b.setUniform3f("camPos",e[3]-a[0],e[7]-a[1],e[11]-a[2])}b.bindUniformsCustomOrigin=f;b.bindUniforms=function(b,a){f(b,a.origin,a.viewInvTransp)}})(b.Camera||(b.Camera={}));(function(b){b.bindUniforms=function(b,h){b.setUniform1f("pixelRatio",h.pixelRatio||1);b.setUniform4fv("viewport",h.viewport)}})(b.Viewport||(b.Viewport={}))})},"esri/views/3d/webgl-engine/shaders/WaterSurface.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/Water.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var A=new g.ShaderBuilder;A.include(a.Transform,{linearDepth:!1});A.attributes.add("position","vec3");A.attributes.add("uv0","vec2");A.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("localOrigin","vec3");0===b.output&&(A.include(e.NormalUtils,b),A.include(f.ForwardLinearDepth,b),A.varyings.add("vuv","vec2"),A.varyings.add("vpos","vec3"),A.varyings.add("vnormal","vec3"),
A.varyings.add("vtbnMatrix","mat3"),A.vertex.code.add(c.glsl(r||(r=l(["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "],["\n      void main(void) {\n        vuv \x3d uv0;\n        vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n        vnormal \x3d getLocalUp(vpos, localOrigin);\n        vtbnMatrix \x3d getTBNMatrix(vnormal);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardLinearDepth();\n      }\n    "])))),
A.include(n.WaterDistortion,b),A.include(h.Slice,b),b.receiveShadows&&A.include(d.ReadShadowMap,b),A.include(k.Water,b),A.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float"),A.fragment.code.add(c.glsl(p||(p=l(["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "],
["\n      void main() {\n        discardBySlice(vpos);\n        vec3 localUp \x3d vnormal;\n        // the created normal is in tangent space\n        vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n \x3d normalize(vtbnMatrix * tangentNormal);\n        vec3 v \x3d -normalize(vpos - camPos);\n        vec3 l \x3d normalize(-lightingMainDirection);\n        "])))),b.receiveShadows?A.fragment.code.add(c.glsl(u||
(u=l(["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d 1.0 - readShadowMap(vpos, linearDepth);\n      "])))):A.fragment.code.add(c.glsl(t||(t=l(["\n        float shadow \x3d 1.0;\n      "],["\n        float shadow \x3d 1.0;\n      "])))),A.fragment.code.add(c.glsl(x||(x=l(["\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec4 final \x3d vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow), waterColor.w);\n\n        // gamma correction\n        gl_FragColor \x3d delinearizeGamma(final);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));2===b.output&&(A.include(e.NormalUtils,b),A.include(n.WaterDistortion,b),A.include(h.Slice,b),A.varyings.add("vpos","vec3"),A.varyings.add("vuv","vec2"),A.vertex.code.add(c.glsl(v||(v=l(["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],
["\n        void main(void) {\n          vuv \x3d uv0;\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),A.fragment.uniforms.add("timeElapsed","float"),A.fragment.code.add(c.glsl(y||(y=l(["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal \x3d normalize(tangentNormal);\n          gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "],
["\n        void main() {\n          discardBySlice(vpos);\n          // the created normal is in tangent space\n          vec3 tangentNormal \x3d getSurfaceNormal(vuv, timeElapsed);\n          tangentNormal \x3d normalize(tangentNormal);\n          gl_FragColor \x3d vec4((tangentNormal + vec3(1.0)) * 0.5, 0.0);\n        }\n    "])))));5===b.output&&(A.include(e.NormalUtils,b),A.varyings.add("vpos","vec3"),A.vertex.code.add(c.glsl(m||(m=l(["\n        void main(void) {\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],
["\n        void main(void) {\n          vpos \x3d (model * vec4(position, 1.0)).xyz;\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),A.fragment.uniforms.add("waterColor","vec4"),A.fragment.code.add(c.glsl(w||(w=l(["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "],["\n        void main() {\n          gl_FragColor \x3d waterColor;\n        }\n    "])))));return A};var r,p,u,t,x,v,y,m,w})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["require",
"exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.ForwardLinearDepth=function(b,k){0===k.output&&k.receiveShadows?(b.varyings.add("linearDepth","float"),b.vertex.code.add(f.glsl(h||(h=l(["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "],["\n      void forwardLinearDepth() { linearDepth \x3d gl_Position.w; }\n    "]))))):1===k.output||3===k.output?(b.varyings.add("linearDepth",
"float"),b.vertex.uniforms.add("uCameraNearFar","vec2"),b.vertex.code.add(f.glsl(a||(a=l(["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "],["\n      void forwardLinearDepth() {\n        linearDepth \x3d (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);\n      }\n    "]))))):b.vertex.code.add(f.glsl(e||(e=l(["\n      void forwardLinearDepth() {}\n    "],
["\n      void forwardLinearDepth() {}\n    "]))))};var h,a,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.NormalUtils=function(b,n){0===n.viewingMode?b.vertex.code.add(f.glsl(h||(h=l(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "],
["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return normalize(pos + origin);\n      }\n    "])))):b.vertex.code.add(f.glsl(a||(a=l(["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "],["\n      vec3 getLocalUp(in vec3 pos, in vec3 origin) {\n          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\n      }\n    "]))));0===n.viewingMode?b.vertex.code.add(f.glsl(e||(e=
l(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d normalize(cross(vec3(0.0, 0.0, 1.0), n));\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "])))):b.vertex.code.add(f.glsl(d||(d=l(["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "],
["\n        mat3 getTBNMatrix(in vec3 n) {\n            vec3 t \x3d vec3(1.0, 0.0, 0.0);\n            vec3 b \x3d normalize(cross(n, t));\n            return mat3(t, b, n);\n        }\n    "]))))};var h,a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./Gamma.glsl ./PhysicallyBasedRendering.glsl ../../shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,
"__esModule",{value:!0});b.Water=function(b,k){b.include(h.PhysicallyBasedRendering,k);b.include(f.Gamma);b.fragment.code.add(a.glsl(e||(e=l(["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.06;\n\n    const vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\n    const vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *\x3d 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "],
["\n    const vec3 fresnelSky \x3d  vec3(0.02, 1.0, 5.0); // f0, f0max, exp\n    const vec2 fresnelMaterial \x3d  vec2(0.02, 0.1); // f0, f0max for specular term\n    const float roughness \x3d 0.06;\n\n    const vec3 skyZenitColor \x3d vec3(0, 0.6, 0.9);\n    const vec3 skyColor \x3d vec3(0.72, 0.92, 1.0);\n\n    PBRShadingWater shadingInfo;\n\n    /*\n    *   This function is an approximation for the sky gradient reflected\n    *   the water surface and describes a combination of two fresnel terms.\n    *   @parameter: cosTheta \x3d is the result of max(dot(n,v), 0.0)\n    *   @parameter: horizon \x3d the dominant color of the sky horizon\n    *   @parameter: cosTheta \x3d the dominant color of the sky zenit\n    */\n    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\n      float exponent \x3d pow((1.0 - cosTheta), fresnelSky[2]);\n      return mix(zenit, horizon, exponent);\n    }\n\n    /*\n    *   This function determines the water color per pixel.\n    *   @parameter: n \x3d normal facing away from the surface\n    *   @parameter: v \x3d view direction facing away from the surface.\n    *   @parameter: l \x3d light direction facing away from the surface\n    *   @parameter: lightIntensity \x3d light intensity, currently between 0...PI\n    *   @parameter: localUp \x3d a normal for the general direction of the surface\n    *   @parameter: shadow \x3d the amount of shadow at this pixel (0 \x3d no shadow)\n    */\n    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow) {\n\n      vec3 seaWaterColor \x3d linearizeGamma(color);\n      // using half vector to determine the specular light\n      vec3 h \x3d normalize(l + v);\n      shadingInfo.NdotL \x3d clamp(dot(n, l), 0.0, 1.0);\n      shadingInfo.NdotV \x3d clamp(dot(n, v), 0.001, 1.0);\n      shadingInfo.VdotN \x3d clamp(dot(v, n), 0.001, 1.0);\n      shadingInfo.NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n      shadingInfo.VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n      shadingInfo.LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n\n      // angle between vertex normal and view direction\n      float upDotV \x3d max(dot(localUp,v), 0.0);\n      // reflected sky color: the reflected sky color consists of two main colors, the\n      // reflected color at the horizon and the reflected color of the zenit.\n      // the reflected sky color is then an approximation based on the fresnel term.\n      vec3 skyHorizon \x3d linearizeGamma(skyColor);\n      vec3 skyZenit \x3d linearizeGamma(skyZenitColor);\n      vec3 skyColor \x3d getSkyGradientColor(upDotV, skyHorizon, skyZenit );\n\n      // we use the upDotL to smoothen out the\n      // reflected color of the water\n      float upDotL \x3d max(dot(localUp,l),0.0);\n\n      // The approximated sky color is adjusted according to the sun position.\n      // This is done as approximation for e.g. night views.\n      skyColor *\x3d 0.1 + upDotL * 0.9;\n\n      // If a water surface is in shadow we just use a slight darkening of the\n      // water surface expressed with this shadowModifier.\n      float shadowModifier \x3d clamp(shadow, 0.8, 1.0);\n\n      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.\n      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long\n      // as reflection are absent there is a need to have a slight shadow for depth perception.\n      vec3 reflSky \x3d fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]) * skyColor * shadowModifier;\n\n      // The reflected sea color is the input water color combined with the reflected sky color.\n      // The reflected sky color is modified by the incoming light.\n      vec3 reflSea \x3d seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\n\n      vec3 specular \x3d vec3(0.0);\n      // This prevents the specular light to be rendered when:\n      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)\n      // - viewer is under water (for this localUp is better than n)\n      if(upDotV \x3e 0.0 \x26\x26 upDotL \x3e 0.0) {\n        // calculate the cook torrance BRDF but with simplified occlusion\n        vec3 specularSun \x3d brdfWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\n        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here\n        vec3 incidentLight \x3d lightIntensity * LIGHT_NORMALIZATION * shadow;\n\n        specular \x3d shadingInfo.NdotL * incidentLight * specularSun;\n      }\n      // combining reflected sky, reflected sea and specular highlight.\n      return tonemapACES(reflSky + reflSea + specular);\n    }\n  "]))))};
var e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.Gamma=function(a){a.fragment.code.add(f.glsl(h||(h=l(["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "],
["\n    const float GAMMA \x3d 2.2;\n    const float INV_GAMMA \x3d 0.4545454545;\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./AnalyticalSkyModel.glsl ./PiUtils.glsl ../../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.PhysicallyBasedRendering=function(b,v){var x=b.fragment.code;b.include(h.PiUtils);v.usePBRforWater?(x.add(a.glsl(e||(e=l(["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "],["\n    struct PBRShadingWater\n    {\n        float NdotL;   // cos angle between normal and light direction\n        float NdotV;   // cos angle between normal and view direction\n        float NdotH;   // cos angle between normal and half vector\n        float VdotH;   // cos angle between view direction and half vector\n        float LdotH;   // cos angle between light direction and half vector\n        float VdotN;   // cos angle between view direction and normal vector\n    };\n\n    float dtrExponent \x3d ",
";\n    "])),v.useCustomDTRExponentForWater?"2.2":"2.0")),x.add(a.glsl(d||(d=l(["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "],["\n    vec3 fresnelReflection(float angle, vec3 f0, float f90) {\n      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);\n    }\n    "])))),x.add(a.glsl(k||(k=l(["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "],
["\n    float normalDistributionWater(float NdotH, float roughness)\n    {\n      float r2 \x3d roughness * roughness;\n      float NdotH2 \x3d NdotH * NdotH;\n      float denom \x3d pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;\n      return r2 / denom;\n    }\n    "])))),x.add(a.glsl(n||(n=l(["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "],["\n    float geometricOcclusionKelemen(float LoH)\n    {\n        return 0.25 / (LoH * LoH);\n    }\n    "])))),
x.add(a.glsl(c||(c=l(["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float D \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "],["\n    vec3 brdfWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)\n    {\n      vec3  F \x3d fresnelReflection(props.VdotH, F0, F0Max);\n      float D \x3d normalDistributionWater(props.NdotH, roughness);\n      float V \x3d geometricOcclusionKelemen(props.LdotH);\n      return (D * V) * F;\n    }\n\n    vec3 tonemapACES(const vec3 x) {\n      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);\n    }\n    "]))))):
v.usePBR&&(b.include(f.AnalyticalSkyModel),x.add(a.glsl(g||(g=l(["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 groundReflectance;       // reflectance of the ground\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "],
["\n    struct PBRShadingInfo\n    {\n        float NdotL;                  // cos angle between normal and light direction\n        float NdotV;                  // cos angle between normal and view direction\n        float NdotH;                  // cos angle between normal and half vector\n        float VdotH;                  // cos angle between view direction and half vector\n        float LdotH;                  // cos angle between view light direction and half vector\n        float NdotNG;                 // cos angle between normal and normal of the ground\n        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground\n        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination\n        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination\n        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)\n        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)\n        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)\n        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)\n\n        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping\n        float ssao;                   // ssao coefficient\n        vec3 groundReflectance;       // reflectance of the ground\n        vec3 albedoLinear;            // linear color of the albedo\n        vec3 f0;                      // fresnel value at normal incident light\n        vec3 f90;                     // fresnel value at 90o of incident light\n\n        vec3 diffuseColor;            // diffuse color of the material used in environment illumination\n        float metalness;              // metalness of the material\n        float roughness;              // roughness of the material\n    };\n    "])))),
x.add(a.glsl(r||(r=l(["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "],["\n    float normalDistribution(float NdotH, float roughness)\n    {\n        float a \x3d NdotH * roughness;\n        float b \x3d roughness / (1.0 - NdotH * NdotH + a * a);\n        return b * b * INV_PI;\n    }\n    "])))),x.add(a.glsl(p||(p=l(["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "],
["\n    const vec4 c0 \x3d vec4(-1.0, -0.0275, -0.572,  0.022);\n    const vec4 c1 \x3d vec4( 1.0,  0.0425,  1.040, -0.040);\n    const vec2 c2 \x3d vec2(-1.04, 1.04);\n\n    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {\n        vec4 r \x3d roughness * c0 + c1;\n        float a004 \x3d min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;\n        return c2 * a004 + r.zw;\n    }\n    "])))),x.add(a.glsl(u||(u=l(["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "],
["\n    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {\n      vec3 indirectDiffuse \x3d evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);\n      vec3 indirectSpecular \x3d evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);\n\n      // From diffuse illumination calculate reflected color\n      vec3 diffuseComponent \x3d inputs.diffuseColor * indirectDiffuse * INV_PI;\n\n      // From specular illumination calculate reflected color\n      vec2 dfg \x3d prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);\n      vec3 specularColor \x3d inputs.f0 * dfg.x + inputs.f90 * dfg.y;\n      vec3 specularComponent \x3d specularColor * indirectSpecular;\n\n      return (diffuseComponent + specularComponent);\n    }\n    "])))),
x.add(a.glsl(t||(t=l(["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }\n\n    // Because of the fresnel refletion the image might be too bright we apply black level soft compression gamut mapping\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      // based on the average ambient radiance we approximate the black level for a specific time of a day\n      // p.x - the deduced black level\n      // p.y - the value to which we map the black level (around 1/3 of the black level)\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      // gamut map individual color changels\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n\n      return outColor;\n    }\n    "],
["\n    float gamutMapChanel(float x, vec2 p){\n      return (x \x3c p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );\n    }\n\n    // Because of the fresnel refletion the image might be too bright we apply black level soft compression gamut mapping\n    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){\n      vec3 outColor;\n      // based on the average ambient radiance we approximate the black level for a specific time of a day\n      // p.x - the deduced black level\n      // p.y - the value to which we map the black level (around 1/3 of the black level)\n      vec2 p \x3d vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));\n      // gamut map individual color changels\n      outColor.x \x3d gamutMapChanel(inColor.x, p) ;\n      outColor.y \x3d gamutMapChanel(inColor.y, p) ;\n      outColor.z \x3d gamutMapChanel(inColor.z, p) ;\n\n      return outColor;\n    }\n    "])))))};
var e,d,k,n,c,g,r,p,u,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(f.glsl(h||(h=l(["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "],
["\n    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)\n    {\n      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;\n    }\n    "]))));b.add(f.glsl(a||(a=l(["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "],["\n    float integratedRadiance(float cosTheta2, float roughness)\n    {\n      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);\n    }\n    "]))));
b.add(f.glsl(e||(e=l(["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "],
["\n    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)\n    {\n      float cosTheta2 \x3d 1.0 - RdotNG * RdotNG;\n      float intRadTheta \x3d integratedRadiance(cosTheta2, roughness);\n\n      // Calculate the integrated directional radiance of the ground and the sky\n      float ground \x3d RdotNG \x3c 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;\n      float sky \x3d 2.0 - ground;\n      return (ground * ambientGround + sky * ambientSky) * 0.5;\n    }\n    "]))))};
var h,a,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.PiUtils=function(b){b.vertex.code.add(f.glsl(h||(h=l(["\n    const float PI \x3d 3.141592653589793;\n  "],["\n    const float PI \x3d 3.141592653589793;\n  "]))));b.fragment.code.add(f.glsl(a||(a=l(["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "],
["\n    const float PI \x3d 3.141592653589793;\n    const float LIGHT_NORMALIZATION \x3d 1.0 / PI;\n    const float INV_PI \x3d 0.3183098861837907;\n    const float HALF_PI \x3d 1.570796326794897;\n    "]))))};var h,a})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../support/imageUtils ../../../../webgl/Texture".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=h.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");b.waterParameterDefaultsLocal={waveTexture:q.toUrl("../../../../../images/materials/water/normals.jpg"),perturbationTexture:q.toUrl("../../../../../images/materials/water/perturbation.jpg"),waveStrength:.06,waveTextureRepeat:32,waveDirection:a.vec2f64.fromValues(1,0),waveVelocity:.05,flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,
.35686,.4,1],transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0};b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,
perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,
waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};q=function(){function a(){this.loadingCount=0;this.data=[];this.loadingState=0}a.prototype.loadTexture=function(a,b,h){return f(this,void 0,void 0,function(){var c,g;return l(this,function(f){switch(f.label){case 0:this.loadingCount++,f.label=1;case 1:return f.trys.push([1,3,,4]),[4,e.requestImage(h)];
case 2:return c=f.sent(),this.data[b]=new d(a,this.getTextureProps(c.width,c.height,!0),c),[3,4];case 3:return g=f.sent(),k.warn("Failed to load texture for water material.",g),this.data[b]=new d(a,this.getTextureProps(1,1,!0)),[3,4];case 4:return this.loadingCount--,[2]}})})};a.prototype.getTextureProps=function(a,b,d){void 0===d&&(d=!1);return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:d,maxAnisotropy:8,width:a,height:b}};a.prototype.ready=function(){return 2===
this.loadingState?!0:1===this.loadingState&&0===this.loadingCount?(this.loadingState=2,!0):!1};a.prototype.loading=function(){return 1===this.loadingState};a.prototype.initialize=function(a,b){for(var c=0;c<b.length;c++)this.loadTexture(a,c,b[c]);this.loadingState=1};a.prototype.bindRepo=function(a){for(var c=0;c<this.data.length;c++)a.bindTexture(this.data[c],c)};return a}();b.waterTextureRepo=new q})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require","exports",
"../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(q,b,l,f){return function(){return function(b,a,e,d,k,n,c,g,r){this.name=b;this.from=a;this.to=e;this.displayedIndexRange=d;this.highlightedIndexRanges=k;this.transformation=n;this.instanceParameters=c;this.idx=g;this.dataId=r;null!=n&&(this.transformationNormal=f.mat4f64.clone(n),l.mat4.invert(this.transformationNormal,this.transformationNormal),l.mat4.transpose(this.transformationNormal,this.transformationNormal))}}()})},
"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.generateRenderGeometryVisibleIndexRanges=function(a){return a.instanceParameters.hidden?[]:h.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,
a.componentOffsets)};b.generateRenderGeometryHighlightRanges=function(a){return a.instanceParameters.hidden?null:h.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.doesRenderGeometryHaveHighlights=function(a){return a.instanceParameters.hidden?!1:h.hasHighlights(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets)};b.isRenderGeometryHidden=function(a){return a.instanceParameters.hidden?
!0:h.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)};b.drawArrays=function(a,c,b,d,e){a.drawArrays(c,b,d);e&&(e.drawCalls++,4===c&&(e.triangles+=d))};b.drawElements=function(a,c,b,e,k,f){var g=d.getBytesPerElement(b);a.drawElements(c,k,b,e*g);f&&(f.drawCalls++,4===c&&(f.triangles+=k))};b.drawArraysFaceRange=function(a,c,b,d,e){for(var g=0,k=0;k<c.length;k++){var f=c[k],m=f[0]+b,f=f[1]-f[0]+1,g=g+f;a.drawArrays(d,m,f)}e&&(e.drawCalls+=c.length,4===d&&(e.triangles=g/3))};
b.drawElementsFaceRange=function(a,c,b,e,k,f){for(var g=d.getBytesPerElement(k),h=0,m=0;m<c.length;m++){var p=c[m],n=p[0]+b,p=p[1]-p[0]+1,h=h+p;a.drawElements(e,p,k,n*g)}f&&(f.drawCalls+=c.length,4===e&&(f.triangles+=h/3))};b.acquireMaterials=function(a,c){var b=new Map;b.set(0,c.acquire(a,0));b.set(3,c.acquire(a,3));b.set(2,c.acquire(a,2));b.set(1,c.acquire(a,1));b.set(4,c.acquire(a,4));return b};b.releaseMaterials=function(a,c){c.release(a,0);c.release(a,3);c.release(a,2);c.release(a,1);c.release(a,
4)};b.calculateTransformRelToOrigin=function(a,b,d){var g=a.origin.vec3;e.setMatrixTranslation3(c,-g[0],-g[1],-g[2]);l.mat4.multiply(b,c,a.transformation);d&&(l.mat4.invert(d,b),l.mat4.transpose(d,d))};b.encodeDoubleVec3=function(c,b,d,e,f){k[0]=c.get(b,0);k[1]=c.get(b,1);k[2]=c.get(b,2);a.encodeDoubleArray(k,n,3);d.set(f,0,n[0]);e.set(f,0,n[1]);d.set(f,1,n[2]);e.set(f,1,n[3]);d.set(f,2,n[4]);e.set(f,2,n[5])};var k=new Float64Array(3),n=new Float32Array(6),c=f.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require",
"exports"],function(q,b){function l(a,b,d){for(var e=0;e<d;++e)b[2*e]=a[e],b[2*e+1]=a[e]-b[2*e]}Object.defineProperty(b,"__esModule",{value:!0});b.encodeDouble=function(a,b){h[0]=a;h[1]=a-h[0];b[0]=h[0];b[1]=h[1]};b.encodeDoubleArray=l;b.decodeDoubleArray=function(a,b,d){for(var e=0;e<d;++e)b[e]=a[2*e]+a[2*e+1]};b.encodeDoubleArraySplit=function(a,b,d,k){for(var e=0;e<k;++e)f[0]=a[e],l(f,h,1),b[e]=h[0],d[e]=h[1]};var f=new Float64Array(1),h=new Float32Array(2)})},"esri/views/3d/webgl-engine/shaders/HUDMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a,c){void 0===c&&(c=v);if(a.textureIsSignedDistanceField){var b=a.anchorPos;a=a.distanceFieldBoundingBox;var d=c;d[0]=b[0]*(a[2]-a[0])+a[0];d[1]=b[1]*(a[3]-a[1])+a[1]}else f.vec2.copy(c,a.anchorPos);return c}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var f=new t.ShaderBuilder;f.include(e.AlignPixel);f.include(d.HUD,b);f.include(a.Slice,b);if(6===b.output)return f.include(k.HUDOcclusionPass,b),f;f.include(p.ScreenSizePerspective);
f.include(r.RgbaFloatEncoding);f.include(g.ColorConversion,{stages:1});f.include(c.VisualVariables,b);f.varyings.add("vcolor","vec4");f.varyings.add("vtc","vec2");f.varyings.add("vsize","vec2");b.binaryHighlightOcclusionEnabled&&f.varyings.add("voccluded","float");f.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2");b.screenSizePerspectiveEnabled&&f.vertex.uniforms.add("screenSizePerspective","vec4");(b.debugDrawBorder||b.binaryHighlightOcclusionEnabled)&&
f.varyings.add("debugBorderCoords","vec4");f.attributes.add("uv0","vec2");f.attributes.add("color","vec4");f.attributes.add("size","vec2");f.attributes.add("auxpos2","vec4");f.vertex.code.add(u.glsl(w||(w=l(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ",
"\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ","\n\n      ","\n    "],["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize \x3d inputSize * pixelRatio;\n      vec4 quadOffset \x3d vec4(0.0);\n\n      ",
"\n\n      ","\n    "])),b.screenSizePerspectiveEnabled?u.glsl(y||(y=l(["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "],["\n      inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n      vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):
u.glsl(m||(m=l(["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"],["\n      inputSize \x3d size;\n      vec2 screenOffsetScaled \x3d screenOffset;"]))),b.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":"",b.occlusionTestEnabled||b.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":"",b.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""));var h=u.glsl(A||(A=l(["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "],
["\n      vec2 uv01 \x3d floor(uv0);\n      vec2 uv \x3d uv0 - uv01;\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\n  "]))),v=b.signedDistanceFieldEnabled?u.glsl(B||(B=l(["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"],["\n  posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):u.glsl(C||(C=l(["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"],
["\n  posProj +\x3d quadOffset;\n  if (inputSize.x \x3d\x3d size.x) {\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\n  }"])));f.vertex.code.add(u.glsl(G||(G=l("\n      ,\n      ,\n      ,\n      gl_Position \x3d posProj;\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ,\n      vsize \x3d inputSize;\n      ,\n      gl_Position \x3d posProj;\n      ,\n    }\n    ".split(","),"\n      ,\n      ,\n      ,\n      gl_Position \x3d posProj;\n      vtc \x3d uv * textureCoordinateScaleFactor;\n\n      ,\n      vsize \x3d inputSize;\n      ,\n      gl_Position \x3d posProj;\n      ,\n    }\n    ".split(","))),
b.occlusionTestEnabled?"if (visible) {":"",h,v,b.debugDrawBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":"",b.occlusionTestEnabled?u.glsl(E||(E=l(["} else { vtc \x3d vec2(0.0);\n        ",""],["} else { vtc \x3d vec2(0.0);\n        ",""])),b.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"",b.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);":"vcolor \x3d color / 255.0;"));f.fragment.uniforms.add("tex","sampler2D");f.fragment.uniforms.add("overrideColor",
"vec4");f.fragment.uniforms.add("outlineColor","vec4");f.fragment.uniforms.add("outlineSize","float");h=u.glsl(H||(H=l(["\n    ","\n\n    "," \n      if (gl_FragColor.a \x3c 0.1) {\n        discard;\n      }\n  "],["\n    ","\n\n    "," \n      if (gl_FragColor.a \x3c 0.1) {\n        discard;\n      }\n  "])),b.signedDistanceFieldEnabled?u.glsl(J||(J=l(["\n      vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      vec4 fillPixelColor \x3d overrideColor * vcolor;\n      \n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n      \n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "],
["\n      vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\n      vec4 fillPixelColor \x3d overrideColor * vcolor;\n      \n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      const float txSize \x3d 128.0;\n      const float texelSize \x3d 1.0 / txSize;\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\n      vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist \x3d d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\n\n      if (outlineSize \x3e 0.25) {\n        vec4 outlinePixelColor \x3d outlineColor;\n        float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\n      } else {\n        gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\n      }\n      \n      // visualize SDF:\n      // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "]))):
u.glsl(I||(I=l(["gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);"],["gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);"]))),b.debugDrawBorder?u.glsl(K||(K=l(["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"],["\n      float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);"]))):
"");0===b.output&&f.fragment.code.add(u.glsl(L||(L=l(["\n    void main() {\n      ","\n    }\n    "],["\n    void main() {\n      ","\n    }\n    "])),h));4===b.output&&(f.include(n.OutputHighlight),f.fragment.code.add(u.glsl(S||(S=l(["\n    void main() {\n      ","\n      ","\n    }\n    "],["\n    void main() {\n      ","\n      ","\n    }\n    "])),h,b.binaryHighlightOcclusionEnabled?u.glsl(P||(P=l(["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"],
["\n          if (voccluded \x3d\x3d 1.0) {\n            gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n          } else {\n            gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n          }"]))):"outputHighlight();")));return f};(function(a){a.bindUniforms=function(a,c,b){a.setUniform4fv("overrideColor",c.color);c.textureIsSignedDistanceField&&(a.setUniform4fv("outlineColor",c.outlineColor),a.setUniform1f("outlineSize",c.outlineSize));b=b.pixelRatio||1;a.setUniform2f("screenOffset",2*c.screenOffset[0]*
b,2*c.screenOffset[1]*b);a.setUniform2fv("anchorPos",x(c))}})(b.HUDMaterial||(b.HUDMaterial={}));b.calculateAnchorPosForRendering=x;var v=h.vec2f64.create(),y,m,w,A,B,C,E,G,J,I,K,H,L,P,S})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a,b){a.include(f.ScreenSizePerspective);a.attributes.add("position",
"vec3");a.attributes.add("normal","vec3");a.attributes.add("auxpos1","vec4");a.vertex.uniforms.add("proj","mat4");a.vertex.uniforms.add("view","mat4");a.vertex.uniforms.add("viewNormal","mat4");a.vertex.uniforms.add("model","mat4");a.vertex.uniforms.add("modelNormal","mat4");a.vertex.uniforms.add("viewport","vec4");a.vertex.uniforms.add("camPos","vec3");a.vertex.uniforms.add("polygonOffset","float");a.vertex.uniforms.add("cameraGroundRelative","float");a.vertex.uniforms.add("pixelRatio","float");
a.vertex.uniforms.add("perDistancePixelRatio","float");a.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");b.verticalOffsetEnabled&&a.vertex.uniforms.add("verticalOffset","vec4");b.screenSizePerspectiveEnabled&&a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");a.vertex.uniforms.add("hudVisibilityTexture","sampler2D");a.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208);a.vertex.code.add(h.glsl(e||(e=l(["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "],
["\n    struct ProjectHUDAux {\n      vec3 posModel;\n      vec3 posView;\n      vec3 vnormal;\n\n      float distanceToCamera;\n      float absCosAngle;\n    };\n  "]))));a.vertex.code.add(h.glsl(d||(d=l(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "],
["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign \x3d sign(pointGroundDistance);\n\n      if (pointGroundSign \x3d\x3d 0.0) {\n        pointGroundSign \x3d cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative \x3d cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation\n      // we take the absolute value because the sign that is dropped is\n      // instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset \x3e .0) {\n        float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\n\n        float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor \x3d (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative \x3e 0.0) {\n          posView *\x3d factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /\x3d factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "]))));
a.vertex.code.add(h.glsl(k||(k=l(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "],
["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera \x3d length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel +\x3d modelOffset;\n      posView +\x3d viewOffset;\n    }\n  "]))));
a.vertex.code.add(h.glsl(g||(g=l(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "],["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offsetting\n      // of labels with respect to objects. It also pulls the label towards the viewer\n      // so that the label is visible in front of the object.\n      vec3 centerOffset \x3d auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance \x3d auxpos1.w;\n\n      aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\n      aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\n\n      applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera \x3d length(aux.posView);\n\n      vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\n      float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle \x3d abs(cosAngle);\n\n      ",
"\n\n      ","\n\n      ","\n\n      float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),b.screenSizePerspectiveEnabled?b.verticalOffsetEnabled||1===b.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":
"":"",b.verticalOffsetEnabled?b.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":"",b.verticalOffsetEnabled?h.glsl(n||(n=l(["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"],
["\n            float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset \x3d aux.vnormal * worldOffset;\n            aux.posModel +\x3d modelOffset;\n            vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView +\x3d viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance +\x3d worldOffset;"]))):
"",1!==b.screenCenterOffsetUnitsEnabled?h.glsl(c||(c=l(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "],
["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z !\x3d 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z !\x3d 0.0) {\n              aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\n            }\n          "]))):"",
1===b.screenCenterOffsetUnitsEnabled?b.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":"",1===b.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""));a.vertex.code.add(h.glsl(r||(r=l(["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "],
["\n    bool testVisibilityHUD(vec4 posProj) {\n      // For occlusion testing, use the nearest pixel center to avoid\n      // subpixel filtering messing up the color we use to test for\n      vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\n\n      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\n      // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\n      // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\n\n      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\n      if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\n        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\n        // uRenderTransparentlyOccludedHUD \x3d 0.75\n        return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\n      }\n\n      // and visible pixels that are not occluded by semi-transparent geometry here\n      return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\n    }\n  "]))))}
Object.defineProperty(b,"__esModule",{value:!0});b.HUD=a;(function(a){(function(a){a[a.OCCLUDED=0]="OCCLUDED";a[a.NOTOCCLUDED=1]="NOTOCCLUDED";a[a.BOTH=2]="BOTH";a[a.COUNT=3]="COUNT"})(a.TransparentRenderStyle||(a.TransparentRenderStyle={}));a.bindUniforms=function(c,b){c.setUniform1f("uRenderTransparentlyOccludedHUD",b.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.OCCLUDED?1:b.renderTransparentlyOccludedHUD===a.TransparentRenderStyle.NOTOCCLUDED?0:.75)};a.bindVisibilityTexture=function(a,
c,b){c.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0)}})(a=b.HUD||(b.HUD={}));var e,d,k,n,c,g,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(q,b,l,f,h){function a(a){a.vertex.code.add(f.glsl(e||(e=l(["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "],
["\n    float screenSizePerspectiveMinSize(float size, vec4 factor) {\n      float nonZeroSize \x3d 1.0 - step(size, 0.0);\n\n      return (\n        factor.z * (\n          1.0 +\n          nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\n                                      // proportionally scaled padding\n          2.0 * factor.w / (\n            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\n          )\n        )\n      );\n    }\n  "]))));
a.vertex.code.add(f.glsl(d||(d=l(["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "],["\n    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\n      return absCosAngle * absCosAngle * absCosAngle;\n    }\n  "]))));a.vertex.code.add(f.glsl(k||(k=l(["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "],
["\n    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\n      return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\n    }\n  "]))));a.vertex.code.add(f.glsl(n||(n=l(["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "],
["\n    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\n      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\n    }\n  "]))));a.vertex.code.add(f.glsl(c||(c=l(["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))));a.vertex.code.add(f.glsl(g||(g=l(["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "],
["\n    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\n      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\n    }\n  "]))));a.vertex.code.add(f.glsl(r||(r=l(["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "],
["\n    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\n      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.ScreenSizePerspective=a;(function(a){a.bindUniforms=function(a,c){c.screenSizePerspective&&(h.bindScreenSizePerspective(c.screenSizePerspective,a,"screenSizePerspective"),h.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||
c.screenSizePerspective,a))}})(a=b.ScreenSizePerspective||(b.ScreenSizePerspective={}));var e,d,k,n,c,g,r})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.HUDOcclusionPass=function(b){b.vertex.code.add(f.glsl(h||(h=l(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "],
["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) \x3e 0.0) {\n      // Render single point to center of the pixel to avoid subpixel\n      // filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj \x3d projectPositionHUD(projectAux);\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n      }\n    }\n    else {\n      // Project out of clip space\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position \x3d posProjCenter;\n    gl_PointSize \x3d 1.0;\n  }\n  "]))));
b.fragment.uniforms.add("color","vec4");b.fragment.code.add(f.glsl(a||(a=l(["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "],["\n  void main() {\n    gl_FragColor \x3d color;\n  }\n  "]))))};(function(a){a.bindUniforms=function(a){a.setUniform4f("color",1,1,1,1)}})(b.HUDOcclusion||(b.HUDOcclusion={}));var h,a})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],
function(q,b,l,f){function h(b){b.fragment.uniforms.add("depthTex","sampler2D");b.fragment.uniforms.add("highlightViewportPixelSz","vec4");b.fragment.code.add(f.glsl(a||(a=l(["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "],
["\n    void outputHighlight() {\n      vec4 fragCoord \x3d gl_FragCoord;\n\n      float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\n      if (fragCoord.z \x3e sceneDepth + 5e-7) {\n        gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n      }\n      else {\n        gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\n      }\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.OutputHighlight=h;(function(a){a.bindOutputHighlight=
function(a,b,e){a.bindTexture(e.highlightDepthTexture,5);b.setUniform1i("depthTex",5);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.viewport[2],1/e.viewport[3])}})(h=b.OutputHighlight||(b.OutputHighlight={}));var a})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){function h(b,h){h.vvInstancingEnabled&&(h.vvSize||h.vvColor)&&
b.attributes.add("instanceFeatureAttribute","vec4");h.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),b.vertex.uniforms.add("vvSymbolAnchor","vec3"),b.vertex.code.add(f.glsl(a||(a=l(["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "],
["\n      vec3 vvScale(vec4 _featureAttribute) {\n        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n      }\n\n      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\n        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n      }\n    "])))),b.vertex.code.add(f.glsl(d||(d=l(["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ",
"\n    "],["\n      const float eps \x3d 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 vvScale \x3d clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);\n        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);\n      }\n\n      ","\n    "])),h.vvInstancingEnabled?f.glsl(e||(e=l(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"],
["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):b.vertex.code.add(f.glsl(k||(k=l(["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "],["\n      vec4 localPosition() { return vec4(position, 1.0); }\n\n      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }\n    "]))));
h.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(f.glsl(c||(c=l(["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "],["\n      uniform float vvColorValues[VV_COLOR_N];\n      uniform vec4 vvColorColors[VV_COLOR_N];\n\n      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\n        float value \x3d featureAttribute.y;\n        if (value \x3c\x3d values[0]) {\n          return colors[0];\n        }\n\n        for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n          if (values[i] \x3e\x3d value) {\n            float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\n            return mix(colors[i-1], colors[i], f);\n          }\n        }\n        return colors[VV_COLOR_N - 1];\n      }\n\n      ",
"\n    "])),h.vvInstancingEnabled?f.glsl(n||(n=l(["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"],["\n      vec4 vvColor() {\n        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\n      }"]))):""))):b.vertex.code.add(f.glsl(g||(g=l(["\n      vec4 vvColor() { return vec4(1.0); }\n    "],["\n      vec4 vvColor() { return vec4(1.0); }\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VisualVariables=
h;(function(a){function c(a,c){c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}a.bindUniforms=c;a.bindUniformsWithOpacity=function(a,b){c(a,b);b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
b.vvOpacityOpacities))};a.bindUniformsForSymbols=function(a,b){c(a,b);b.vvSizeEnabled&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",b.vvSymbolRotationMatrix))}})(h=b.VisualVariables||(b.VisualVariables={}));var a,e,d,k,n,c,g})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HUDMaterial.glsl ./HUDMaterial.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}l(f,b);f.prototype.initializeProgram=function(a){var c=f.shader.get(),b=this.configuration,c=c.build({output:b.output,viewingMode:a.viewingMode,occlusionTestEnabled:b.occlusionTestEnabled,signedDistanceFieldEnabled:b.sdf,slicePlaneEnabled:b.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,debugDrawBorder:b.debugDrawBorder,
binaryHighlightOcclusionEnabled:b.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:b.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:b.screenSizePerspective,verticalOffsetEnabled:b.verticalOffset,vvSize:b.vvSize,vvColor:b.vvColor,vvInstancingEnabled:!1});return new m(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),x.Default3D)};f.prototype.bindPass=function(a,b,e){this.program.setUniform1f("cameraGroundRelative",e.cameraAboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",
Math.tan(e.fovY/2)/(e.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",e.viewInvTransp);this.program.setUniform1f("polygonOffset",b.shaderPolygonOffset);d.VerticalOffset.bindUniforms(this.program,b,e);r.ScreenSizePerspective.bindUniforms(this.program,b);g.Viewport.bindUniforms(this.program,e);6===this.configuration.output?n.HUDOcclusion.bindUniforms(this.program):(k.HUD.bindUniforms(this.program,e),y.HUDMaterial.bindUniforms(this.program,b,e),c.VisualVariables.bindUniforms(this.program,
b),this.configuration.occlusionTestEnabled&&k.HUD.bindVisibilityTexture(a,this.program,e))};f.prototype.bindDraw=function(c){e.Transform.bindUniforms(this.program,c);g.Camera.bindUniforms(this.program,c);a.Slice.bindUniformsWithOrigin(this.program,this.configuration,c)};f.prototype.initializePipeline=function(){return 4===this.configuration.output?A.makePipelineState({blending:w.separateBlendingParams(1,1,771,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:513},
colorWrite:A.defaultColorWriteParams}):6===this.configuration.output?A.makePipelineState({depthTest:{func:515},depthWrite:A.defaultDepthWriteParams,colorWrite:A.defaultColorWriteParams}):A.makePipelineState({blending:w.simpleBlendingParams(1,771),polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:515},depthWrite:A.defaultDepthWriteParams,colorWrite:A.defaultColorWriteParams})};f.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};Object.defineProperty(f.prototype,
"primitiveType",{get:function(){return 6===this.configuration.output?0:4},enumerable:!0,configurable:!0});f.shader=new p.ReloadableShaderModule(v,"./HUDMaterial.glsl",q);return f}(u.ShaderTechnique);b.HUDMaterialTechnique=h;h=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.output=0;c.occlusionTestEnabled=!0;c.sdf=!1;c.vvSize=!1;c.vvColor=!1;c.verticalOffset=!1;c.screenSizePerspective=!1;c.screenCenterOffsetUnitsEnabled=0;c.debugDrawBorder=!0;c.binaryHighlightOcclusion=!0;
c.slicePlaneEnabled=!1;c.polygonOffsetEnabled=!1;return c}l(c,a);f([t.parameter({count:7})],c.prototype,"output",void 0);f([t.parameter()],c.prototype,"occlusionTestEnabled",void 0);f([t.parameter()],c.prototype,"sdf",void 0);f([t.parameter()],c.prototype,"vvSize",void 0);f([t.parameter()],c.prototype,"vvColor",void 0);f([t.parameter()],c.prototype,"verticalOffset",void 0);f([t.parameter()],c.prototype,"screenSizePerspective",void 0);f([t.parameter({count:2})],c.prototype,"screenCenterOffsetUnitsEnabled",
void 0);f([t.parameter()],c.prototype,"debugDrawBorder",void 0);f([t.parameter()],c.prototype,"binaryHighlightOcclusion",void 0);f([t.parameter()],c.prototype,"slicePlaneEnabled",void 0);f([t.parameter()],c.prototype,"polygonOffsetEnabled",void 0);return c}(t.ShaderTechniqueConfiguration);b.HUDMaterialTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../util/ScreenSizePerspective.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a,b){var d=a.vertex.code;b.verticalOffsetEnabled?(a.vertex.uniforms.add("verticalOffset","vec4"),b.screenSizePerspectiveEnabled&&(a.include(f.ScreenSizePerspective),a.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),d.add(h.glsl(r||(r=l(["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "],["\n    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\n      ",
"\n      ","\n      // Screen sized offset in world space, used for example for line callouts\n      float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n      return worldNormal * worldOffset;\n    }\n\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n      return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n    }\n    "])),0===b.viewingMode?h.glsl(k||(k=l(["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"],
["vec3 worldNormal \x3d normalize(worldPos + localOrigin);"]))):h.glsl(n||(n=l(["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"],["vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);"]))),b.screenSizePerspectiveEnabled?h.glsl(c||(c=l(["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"],["\n          float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\n          float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):
h.glsl(g||(g=l(["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"],["\n          float verticalOffsetScreenHeight \x3d verticalOffset.x;"])))))):d.add(h.glsl(p||(p=l(["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "],["\n    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }\n    "]))))}function e(a,c,b,e){void 0===e&&(e=d);e.screenLength=a.screenLength;e.perDistance=Math.tan(.5*c)/(.5*b);e.minWorldLength=a.minWorldLength;
e.maxWorldLength=a.maxWorldLength;return e}Object.defineProperty(b,"__esModule",{value:!0});b.VerticalOffset=a;(function(a){a.bindUniforms=function(a,c,b){c.verticalOffset&&(c=e(c.verticalOffset,b.fovY,b.viewport[3]),a.setUniform4f("verticalOffset",c.screenLength*(b.pixelRatio||1),c.perDistance,c.minWorldLength,c.maxWorldLength))}})(a=b.VerticalOffset||(b.VerticalOffset={}));b.calculateVerticalOffsetFactors=e;var d={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0},k,n,c,g,r,p})},"esri/views/support/index":function(){define(["require",
"exports","./Scheduler"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.noBudget=l.noBudget;b.Task=l.Task})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.idHint="__labeler";a._dirty=!1;a.labels=new Map;a.labelsToAdd=new Map;a.labelsToRemove=new Map;a.labelingContexts=[];return a}l(e,b);e.prototype.setup=function(){var a=this;this.handles||(this.handles=new k,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()}),this.view.watch("pixelRatio",
function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new G.default({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new B(this.view._stage),this.calloutMaterialCollection=new B(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(J.Task.LABELER,function(c){return a.update(c)},function(){return a.needsUpdate()}))};e.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&
(this.textTextureAtlas.dispose(),this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};e.prototype.isActiveLabelingContext=function(a){return a.active&&t.areLabelsVisible(a.layer)};e.prototype.activateLabelingContext=function(a){var c=
this;a.labels.forEach(function(a,b){c.labels.set(b,a);a.graphics3DGraphic.setVisibilityFlag(0,!0,1)});a.active=!0};e.prototype.deactivateLabelingContext=function(a){var c=this;a.labels.forEach(function(a,b){a.graphics3DGraphic.setVisibilityFlag(0,!1,1);a.rendered&&c.labelsToRemove.set(b,a);c.labels.delete(b);c.labelsToAdd.delete(b)});a.active=!1};e.prototype.addLabelTextureToAtlas=function(a){for(var c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var b=a.graphics3DGraphic._labelGraphics[c];
if(b._labelClass){var d=a.textRenderers[b._labelIndex];d&&this.textTextureAtlas.addTextTexture(d,b.stageObject)}}a.rendered=!0};e.prototype.removeLabelTextureFromAtlas=function(a){for(var c=a.graphics3DGraphic,b=0;b<c._labelGraphics.length;b++){var d=c._labelGraphics[b];d._labelClass&&(d=a.textRenderers[d._labelIndex])&&this.textTextureAtlas.removeTextTexture(d,c._labelGraphics[b].stageObject)}a.rendered=!1};e.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};e.prototype.update=
function(a){for(var c=this,b=this._dirty=!1,d=function(d){if(!e.isActiveLabelingContext(d))return"continue";if(!e.hasValidLabelClassContext(d)){if(e.hasInvalidLabelClassContext(d))return e.deactivateLabelingContext(d),"continue";e.createLabelClassContext(d);if(e.hasPendingLabelClassContext(d))return e._dirty=!0,"continue";if(!e.hasValidLabelClassContext(d))return"continue"}n.someMap(d.labelsToInitialize,function(e,g){c.ensureGraphics3DResources(e)&&(c.labels.set(g,e),b=!0,a.madeProgress());if(e.visible&&
e.hasTextTextureResources||!e.visible&&e.hasGraphics3DResources)d.labelsToInitialize.delete(g),a.madeProgress();return a.done})&&(e._dirty=!0)},e=this,g=0,k=this.labelingContexts;g<k.length;g++)d(k[g]);a&&b&&this.view.deconflictor.setDirty();this.labelsToRemove.forEach(function(a){return c.removeLabelTextureFromAtlas(a)});this.labelsToRemove.clear();this.labelsToAdd.forEach(function(a){return c.addLabelTextureToAtlas(a)});this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")};e.prototype.hasPendingLabelClassContext=
function(a){return a.labelClassPromise&&!!a.labelClassAbortController};e.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};e.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};e.prototype.createLabelClassContextAsync=function(c){return a(this,void 0,void 0,function(){var b,e,k,f,m,p=this;return h(this,function(n){switch(n.label){case 0:return b=c.labelClassAbortController.signal,[4,c.layer.when()];case 1:n.sent();
g.throwIfAborted(b);c.scaleVisibility&&c.scaleVisibility.updateScaleRangeActive();e=c.graphics3DCore;k=e.layer;f=k.labelingInfo&&k.labelingInfo.filter(function(a){return!!a.symbol});if(!f||0===f.length)return[2,null];m=Array(f.length);return[4,d.forEach(f,function(k,f){return a(p,void 0,void 0,function(){var a,p,n,w;return h(this,function(h){switch(h.label){case 0:return a=k.symbol,p=y.getGraphics3DSymbol(e.getOrCreateGraphics3DSymbol(a)),[4,p.load()];case 1:h.sent();g.throwIfAborted(b);n=null;if(!x.isCalloutSupport(a)||
!a.hasVisibleCallout())return[3,3];n=v.make(a,e.symbolCreationContext);return[4,n.load()];case 2:h.sent(),g.throwIfAborted(b),h.label=3;case 3:return[4,d.result(u.createLabelFunction(k,c.layer.fields.map(function(a){return a.toJSON()}),this.view.spatialReference))];case 4:return w=h.sent(),g.throwIfAborted(b),!0===w.ok&&(m[f]={labelClass:k,labelFunction:w.value,graphics3DSymbol:p,graphics3DCalloutSymbolLayer:n,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(p.symbol)}),
[2]}})})})];case 2:return n.sent(),g.throwIfAborted(b),c.labelClassContexts=m,[2]}})})};e.prototype.createLabelClassContext=function(c){return a(this,void 0,void 0,function(){var a=this;return h(this,function(b){c.labelClassPromise||(c.labelClassPromise=this.createLabelClassContextAsync(c).catch(function(a){if(g.isAbortError(a))throw a;c.labelClassContexts=null}).then(function(){c.labelClassAbortController=null;a.notifyChange("updating")}).catch(function(){}),this.notifyChange("updating"));return[2,
c.labelClassPromise]})})};e.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?E.default.fromSymbol(a,this.view.pixelRatio):null};e.prototype.destroyLabelClassContext=function(a){for(var c=0,b=a.labelClassContexts;c<b.length;c++){var d=b[c];--d.graphics3DSymbol.referenced;d.graphics3DSymbol=null}c=a.labelClassAbortController;a.labelClassAbortController=g.createAbortController();c&&c.abort();a.labelClassContexts=[];a.labelClassPromise=null;this.notifyChange("updating")};
e.prototype.createTextSymbolGraphic=function(a,c,b,d,e){a={text:a.text,centerOffset:b.centerOffset,translation:b.translation,elevationOffset:b.elevationOffset,screenOffset:b.screenOffset,anchor:b.anchor,centerOffsetUnits:b.centerOffsetUnits,verticalOffset:b.verticalOffset,debugDrawBorder:w.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};I.graphic=c;I.renderingInfo=null;I.layer=d;return e.createLabel(I,a,this.hudMaterialCollection,this.textTextureAtlas)};e.prototype.createLineCalloutGraphic=
function(a,c,b,d,e){c={symbol:c,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};I.graphic=a;I.renderingInfo=c;I.layer=e;return b.createGraphics3DGraphic(I)};e.prototype.ensureGraphics3DResources=function(a){if(a.hasGraphics3DResources)return!1;var b=a.graphics3DGraphic;if(b.destroyed)return!1;this.ensureTextTextureResources(a);var d=a.labelingContext,
e=d.labelClassContexts;if(!e||0===e.length||!d.emptySymbolLabelSupported&&0===b._graphics.length)return!1;for(var g=!1,k=b.graphic,f=d.layer,h=t.areLabelsVisible(d.layer),p=this.view._stage,n=0;n<e.length;n++){var w=a.textRenderers[n];if(w){var r=e[n],v=r.graphics3DSymbol,A=null;v.symbol&&"label-3d"===v.symbol.type&&(A=v.symbol);var x=v.symbolLayers[0];if(x){var v=r.labelClass,y=m.get({graphics3DGraphic:b,labelSymbol:A,labelClass:v,disablePlacement:d.disablePlacement});if(!c.isNone(y)){x.setElevationInfoOverride(d.elevationInfoOverride);
g=this.createTextSymbolGraphic(w,k,y,f,x);if(!g)return!1;g._labelClass=v;g._labelIndex=n;b.addLabelGraphic(g,p,d.stageLayer);b.setVisibilityFlag(0,h,1);b.clearVisibilityFlag(1,1);b.setVisibilityFlag(3,!1,1);g=!0;r.graphics3DCalloutSymbolLayer&&y.hasLabelVerticalOffset&&(k=this.createLineCalloutGraphic(k,A,r.graphics3DCalloutSymbolLayer,y,f))&&(r.calloutSymbolLayerIndex=b._labelGraphics.length,b.addLabelGraphic(k,p,d.stageLayer));break}}}}d.scaleVisibility&&g&&d.scaleVisibility.updateGraphicLabelScaleVisibility(b);
return a.hasGraphics3DResources=!0};e.prototype.destroyGraphics3DResources=function(a){for(var c=a.labelingContext.labelClassContexts,b=0,d=a.graphics3DGraphic._labelGraphics;b<d.length;b++){var e=d[b];if(null!=e._labelClass){var g=c[e._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=g)g.onRemoveGraphic(e)}}a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};e.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var b=a.labelingContext,d=b.labelClassContexts;
if(d&&0!==d.length){for(var e=a.graphics3DGraphic.graphic,g=0;g<d.length;g++){var k=d[g];a.textRenderers[g]=null;if(k.textRenderParameters){var f=k.labelFunction,m=void 0;if("arcade"===f.type)try{var h=p.hydrateGraphic(e,b.layer),m=f.evaluate(h)}catch(Z){m=null}else m=f.evaluate(e);c.isNone(m)||""===m||(a.textRenderers[g]=new C.default(m,k.textRenderParameters))}}a.hasTextTextureResources=!0}}};e.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};e.prototype.addGraphic=
function(a,c){var b={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:c,textRenderers:[]};c=c.graphic.uid;a.labels.set(c,b);a.labelsToInitialize.set(c,b);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};e.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var b=a.labels.get(c);b&&(this.destroyGraphic(b,c),a.labels.delete(c),a.labelsToInitialize.delete(c),this.setDirty(a.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};
e.prototype.destroyGraphic=function(a,c){this.labels.has(c)&&(this.labels.delete(c),this.labelsToAdd.delete(c),this.labelsToRemove.delete(c));a.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(a),this.destroyTextTextureResources(a));a.hasGraphics3DResources&&this.destroyGraphics3DResources(a)};e.prototype.labelingInfoChange=function(c,b){return a(this,void 0,void 0,function(){var a,d,e,g;return h(this,function(k){if(b){a=0;for(d=b;a<d.length;a++)if(e=d[a],g=c.labels.get(e))this.removeGraphic(c,
g.graphics3DGraphic),this.addGraphic(c,g.graphics3DGraphic);return[2]}this.visibilityInfoChange(c);this.resetLabels(c);return[2,this.createLabelClassContext(c)]})})};e.prototype.globalPropertyChanged=function(a,b){for(var d=function(d){var e=new Map;b.labels.forEach(function(a){a=a.graphics3DGraphic;e.set(a.graphic.uid,a)});c.expect(d.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(a,e,function(a){return a._labelGraphics[0]});d.graphics3DCalloutSymbolLayer&&d.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,
e,function(a){return a._labelGraphics[d.calloutSymbolLayerIndex]})},e=0,g=b.labelClassContexts;e<g.length;e++)d(g[e])};e.prototype.visibilityInfoChange=function(a){var c=a.layer.labelsVisible;c&&!a.active&&this.activateLabelingContext(a);!c&&a.active&&this.deactivateLabelingContext(a);this.setDirty(a.graphics3DCore.asyncUpdates)};e.prototype.resetAllLabels=function(){for(var a=0,c=this.labelingContexts;a<c.length;a++)this.resetLabels(c[a])};e.prototype.resetLabels=function(a){var c=this;a.labels.forEach(function(b,
d){c.destroyGraphic(b,d);b.visible=!1;b.rendered=!1;a.labelsToInitialize.set(d,b)});this.destroyLabelClassContext(a);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};e.prototype.findLabelingContext=function(a){for(var c=0,b=this.labelingContexts;c<b.length;c++){var d=b[c];if(d.graphics3DCore===a)return d}return null};e.prototype.addGraphicsOwner=function(a,c,b){var d=this,e=b&&b.emptySymbolLabelSupported||!1,k=b&&b.elevationInfoOverride||null;b=b&&b.disablePlacement||
null;if(!this.findLabelingContext(a)){var f=a.layer,m={graphics3DCore:a,layer:f,scaleVisibility:c,emptySymbolLabelSupported:e,elevationInfoOverride:k,disablePlacement:b,active:a.layer.labelsVisible,labelClassPromise:null,labelClassAbortController:g.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new A(this.idHint+"_"+f.uid,{isPickable:!0},f.uid)};this.view._stage.add(0,m.stageLayer);this.view._stage.addToViewContent([m.stageLayer.id]);this.labelingContexts.push(m);
this.setDirty();return{addGraphic:function(a){return d.addGraphic(m,a)},removeGraphic:function(a){return d.removeGraphic(m,a)},featureReductionChange:function(){},layerLabelsEnabled:function(){return t.areLabelsVisible(m.layer)},labelingInfoChange:function(a){return d.labelingInfoChange(m,a)},elevationInfoChange:function(){return d.globalPropertyChanged("elevationInfo",m)},slicePlaneEnabledChange:function(){return d.globalPropertyChanged("slicePlaneEnabled",m)},visibilityInfoChange:function(){return d.visibilityInfoChange(m)},
reset:function(){return d.resetLabels(m)},clear:function(){},processStageDirty:function(){return d.view._stage.processDirtyLayer(m.stageLayer.id)}}}};e.prototype.removeGraphicsOwner=function(a){var c=this,b=this.findLabelingContext(a);b&&(a=this.labelingContexts.indexOf(b),this.labelingContexts.splice(a,1),b.labels.forEach(function(a){return c.removeGraphic(b,a.graphics3DGraphic)}),a=b.stageLayer.id,this.view._stage.removeFromViewContent([a]),this.view._stage.remove(0,a),b.stageLayer=null,this.setDirty())};
e.prototype.setLabelGraphicVisibility=function(a,c){a=a.graphic.uid;var b=this.labels.get(a);b&&(c&&!b.rendered?(this.labelsToAdd.set(a,b),this.labelsToRemove.delete(a),b.hasTextTextureResources||b.labelingContext.labelsToInitialize.set(a,b)):!c&&b.rendered&&(this.labelsToRemove.set(a,b),this.labelsToAdd.delete(a)),b.visible=c,this.setDirty(b.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},
enumerable:!0,configurable:!0});e.prototype.setDirty=function(a){void 0===a&&(a=!0);var c=this._dirty;this._dirty||(this._dirty=!0);a||this.update(J.noBudget);c!==this._dirty&&this.notifyChange("updating")};Object.defineProperty(e.prototype,"updating",{get:function(){var a=this;return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.labelingContexts.some(function(c){return a.hasPendingLabelClassContext(c)})},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"test",{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});f([r.property({constructOnly:!0})],e.prototype,"view",void 0);f([r.property()],e.prototype,"textTextureAtlas",void 0);f([r.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating"]})],e.prototype,"updating",null);return e=f([r.subclass("esri.views.3d.layers.graphics.Labeler")],e)}(r.declared(e));b.Labeler=q;var I={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/Logger ../../core/promiseUtils ../../intl/date ../../intl/number ./FieldsIndex ./fieldUtils ../../support/arcadeOnDemand".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,k.create(function(a){q(["../../core/sql/WhereClause"],a)})]})})}function t(a,b,d,e){a=r.getField(e,a);if(!a)return b;if(null==d[a.name])return"";if(b=a.domain)if("codedValue"===b.type||"coded-value"===b.type){e=d[a.name];var g=0;for(b=b.codedValues;g<b.length;g++){var k=b[g];if(k.code===e)return k.name}}else if("range"===b.type&&(e=+d[a.name],g="range"in b?b.range[1]:b.maxValue,
("range"in b?b.range[0]:b.minValue)<=e&&e<=g))return b.name;d=d[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?d=n.formatDate(d,n.convertDateFormatToIntlOptions("short-date")):r.isNumericField(a)&&(d=c.formatNumber(+d));return d?d:""}Object.defineProperty(b,"__esModule",{value:!0});var x=d.getLogger("esri.layers.support.labelFormatUtils"),v={type:"simple",evaluate:function(){return null}};b.createLabelFunction=function(c,b,d){return a(this,void 0,void 0,function(){var a,k,f,m,n,w,r,y;return h(this,
function(h){switch(h.label){case 0:if(!c||!c.symbol)return[2,v];a=c.where;k=c.getLabelExpression();return a?[4,u()]:[3,2];case 1:return m=h.sent(),[3,3];case 2:m=null,h.label=3;case 3:return f=m,"arcade"!==k.type?[3,5]:[4,p.createLabelExpression(k.expression,d,b)];case 4:return w=h.sent(),n={type:"arcade",evaluate:function(a){try{var c=w.evaluate({$feature:w.repurposeFeature(a)});if(null!=c)return c.toString()}catch(S){x.error(new e("bad-arcade-expression","Encountered an error when evaluating label expression for feature",
{feature:a,expression:k}))}return null}},[3,6];case 5:n={type:"simple",evaluate:function(a){var c=a&&a.attributes;return c?k.expression.replace(/{[^}]*}/g,function(a){return t(a.slice(1,-1),a,c,b)}):null}},h.label=6;case 6:if(a){try{r=f.WhereClause.create(a,new g(b))}catch(L){return[2,v]}y=n.evaluate;n.evaluate=function(a){return r.testFeature(a)?y(a):null}}return[2,n]}})})};b.formatField=t})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=l.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");b.make=function(b,k){if(!f.isCalloutSupport(b))return a.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+b.type+"' does not support callouts"),null;if(!b.callout)return null;var d=e[b.callout.type];return d?new d(b,k):
(a.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+b.callout.type),null)};var e={line:h.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){Object.defineProperty(b,"__esModule",{value:!0});var m,w,A=v.VertexAttrConstants;q=function(b){function g(a,c){a=b.call(this,a,null,c,G)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}l(g,b);g.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return f(this,function(a){this._material=new y(this.materialParameters,this._getIdHint("_lineCallout_common"));this._context.stage.add(3,this._material);
return[2]})})};g.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};g.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(g.prototype,"materialParameters",{get:function(){var c=this.symbol,b=c.callout,g=e.isSome(b.color)?a.toUnitRGBA(b.color):[0,0,0,0];g[3]*=
this._getLayerOpacity();var k=d.pt2px(b.size||0),f=null;if(c.verticalOffset)var f=c.verticalOffset,m=f.minWorldLength,h=f.maxWorldLength,f={screenLength:d.pt2px(f.screenLength),minWorldLength:m||0,maxWorldLength:null!=h?h:Infinity};b=e.isSome(b.border)&&e.isSome(b.border.color)?a.toUnitRGBA(b.border.color):null;m="object"===c.symbolLayers.getItemAt(0).type;return{color:g,size:k,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!m,shaderPolygonOffset:m?0:void 0,depthHUDAlignStart:"label-3d"===c.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});g.prototype._defaultElevationInfoNoZ=function(){return E};g.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo;a=a.graphic;var b=this.getGraphicElevationContext(a,c.elevationOffset||0),d=c.symbol,g="on-the-ground"===this._elevationContext.mode&&("cim"===
d.type||!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type}));if("label-3d"!==d.type&&g)return null;d=r.computeCentroid(a.geometry);return e.isNone(d)?null:this._createAs3DShape(d,b,c,"graphic"+a.uid,a.uid)};g.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};g.prototype.layerElevationInfoChanged=function(a,c,b){var d=this;b=n.elevationModeChangeUpdateType(g.elevationModeChangeTypes,b,this._elevationContext.mode);if(b!==
n.SymbolUpdateType.UPDATE)return b;a.forEach(function(a){var b=c(a);e.isSome(b)&&d.updateGraphicElevationContext(a.graphic,b)});return b};g.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};g.prototype.physicalBasedRenderingChanged=function(){return!0};g.prototype.pixelRatioChanged=function(){return!0};g.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,
a);a.addOffsetRenderUnits(c);return a};g.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=n.needsElevationUpdates2D(a.mode)};g.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,estimated:!1,memory:u.emptySymbolComplexity.memory}};g.prototype.createVertexData=function(a){var c,b=a.translation;a=a.centerOffset;if(!b&&!a)return B;b=b?{size:3,
data:[b[0],b[1],b[2]]}:B[A.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:B[A.AUXPOS1];return c={},c[A.POSITION]=b,c[A.NORMAL]=B[A.NORMAL],c[A.AUXPOS1]=a,c};g.prototype.getOrCreateMaterial=function(a,c){var b=this.perInstanceMaterialParameters(a),d=y.uniqueMaterialIdentifier(b);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new y(b,c+"_lineCallout_shared"),a.materialCollection.addMaterial(d,
e));return{material:e,isUnique:!1}}e=new y(b,c+"_lineCallout_unique");return{material:e,isUnique:!0}};g.prototype._createAs3DShape=function(a,b,d,e,g){var f=new x.GeometryData(this.createVertexData(d),C,x.GeometryData.DefaultOffsets,"point"),f=[new t(f,e)],m=this.getOrCreateMaterial(d,e);e=p.createStageObjectForHUD(this._context,a,f,[m.material],null,null,b,e,this._context.layer.uid,g);if(null===e)return null;g=new c(this,e.object,f,m.isUnique?[m.material]:null,null,k.perObjectElevationAligner,b);
g.metadata={elevationOffset:d.elevationOffset||0};g.alignedSampledElevation=e.sampledElevation;g.needsElevationUpdates=n.needsElevationUpdates2D(b.mode);p.extendPointGraphicElevationContext(g,a,this._context.elevationProvider);return g};g.elevationModeChangeTypes={definedChanged:n.SymbolUpdateType.UPDATE,staysOnTheGround:n.SymbolUpdateType.UPDATE,onTheGroundChanged:n.SymbolUpdateType.RECREATE};return g}(g.Graphics3DSymbolLayer);b.Graphics3DLineCalloutSymbolLayer=q;var B=(m={},m[A.POSITION]={size:3,
data:[0,0,0]},m[A.NORMAL]={size:3,data:[0,0,1]},m[A.AUXPOS1]={size:4,data:[0,0,0,1]},m);m=new Uint32Array([0]);var C=(w={},w[A.POSITION]=m,w[A.NORMAL]=m,w[A.AUXPOS1]=m,w),E={mode:"relative-to-ground",offset:0},G={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};b.default=q})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});var r=g.VertexAttrConstants;b.perVertexElevationAligner=function(a,c,e,g){a=a.stageObject;u.spatialReference=e.spatialReference;for(var k=a.geometryRecords,f=k.length,m="absolute-height"!==c.mode,h=0,p=0;p<f;p++){var A=k[p].geometry,y=k[p].getShaderTransformation();x[0]=y[12];x[1]=y[13];x[2]=y[14];A.invalidateBoundingInfo();for(var y=A.data.getVertexAttr(),l=y[r.POSITION],A=l.data,y=y.mapPos.data,l=l.size,B=A.length/
l,C=0,E=0,q=!1,Y=0,N=0;N<B;N++){u.x=y[E++];u.y=y[E++];u.z=y[E++];v[0]=A[C];v[1]=A[C+1];v[2]=A[C+2];var Z=d.evaluateElevationAlignmentAtPoint(u,e,c,g,m?w:null);m&&(Y+=w.sampledElevation);t[0]=A[C]+x[0];t[1]=A[C+1]+x[1];t[2]=A[C+2]+x[2];g.setAltitude(Z,t);A[C]=t[0]-x[0];A[C+1]=t[1]-x[1];A[C+2]=t[2]-x[2];if(n.TESTS_DISABLE_UPDATE_THRESHOLDS)q=!0;else if(Z=b.updateThresholdInMeters/g.unitInMeters,Math.abs(v[0]-A[C])>=Z||Math.abs(v[1]-A[C+1])>=Z||Math.abs(v[2]-A[C+2])>=Z)q=!0;C+=l}h+=Y/B;q&&a.geometryVertexAttrsUpdated(p)}return h/
f};b.perObjectElevationAligner=function(a,e,g,f){a=a.stageObject;var r=e.centerPointInElevationSR,v=0,A=0;if(a.metadata.usesVerticalDistanceToGround)v=d.evaluateElevationAlignmentAtPoint(r,g,e,f,w),k.updateVertexAttributeAuxpos1w(a,w.verticalDistanceToGround),A=w.sampledElevation;else{var x="absolute-height"!==e.mode,v=d.evaluateElevationAlignmentAtPoint(r,g,e,f,x?w:null);x&&(A=w.sampledElevation)}e=l.mat4.copy(p,a.objectTransformation);g=h.vec3.set(m,e[12],e[13],e[14]);n.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?
(t[0]=r.x,t[1]=r.y,t[2]=v,c.computeLinearTransformation(r.spatialReference,t,e,f.spatialReference)&&(a.objectTransformation=e)):f.setAltitudeOfTransformation(v,e);f=b.updateThresholdInMeters/f.unitInMeters;if(Math.abs(e[12]-g[0])>=f||Math.abs(e[13]-g[1])>=f||Math.abs(e[14]-g[2])>=f)a.objectTransformation=e;return A};var p=f.mat4f64.create();b.perLodInstanceElevationAligner=function(a,e,g,k){var f=e.centerPointInElevationSR,p=0,r=0,v="absolute-height"!==e.mode,p=d.evaluateElevationAlignmentAtPoint(f,
g,e,k,v?w:null);v&&(r=w.sampledElevation);e=a.graphics3DSymbolLayer.lodRenderer.instanceData;a=a.instanceIndex;g=y;e.getGlobalTransform(a,g);v=h.vec3.set(m,g[12],g[13],g[14]);n.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=f.x,t[1]=f.y,t[2]=p,c.computeLinearTransformation(f.spatialReference,t,g,k.spatialReference)&&e.setGlobalTransform(a,g)):k.setAltitudeOfTransformation(p,g);k=b.updateThresholdInMeters/k.unitInMeters;(Math.abs(g[12]-v[0])>=k||Math.abs(g[13]-v[1])>=k||Math.abs(g[14]-v[2])>=k)&&
e.setGlobalTransform(a,g);return r};b.updateThresholdInMeters=.01;b.iterativeUpdatesEnabled=!0;var u=new e,t=a.vec3f64.create(),x=a.vec3f64.create(),v=a.vec3f64.create(),y=f.mat4f64.create(),m=a.vec3f64.create(),w={verticalDistanceToGround:0,sampledElevation:0}})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ./graphicUtils ../../support/ElevationProvider ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k){function n(a,c,b,e,g){var k=a.z||0,f=b.featureExpressionInfoContext;switch(b.mode){case "on-the-ground":var m=d.getElevationAtPoint(c,a,"ground")||0;g&&(g.verticalDistanceToGround=0,g.sampledElevation=m);return m;case "relative-to-ground":return m=d.getElevationAtPoint(c,a,"ground")||0,a=b.calculateOffsetRenderUnits(e),null==f&&(a+=k),g&&(g.verticalDistanceToGround=a,g.sampledElevation=m),a+m;case "relative-to-scene":return m=d.getElevationAtPoint(c,a,"scene")||0,a=b.calculateOffsetRenderUnits(e),
null==f&&(a+=k),g&&(g.verticalDistanceToGround=a,g.sampledElevation=m),a+m;case "absolute-height":return m=b.calculateOffsetRenderUnits(e),null==f&&(m+=k),g&&(k=d.getElevationAtPoint(c,a,"ground")||0,g.verticalDistanceToGround=m-k,g.sampledElevation=k),m;default:return l.neverReached(b.mode),0}}Object.defineProperty(b,"__esModule",{value:!0});b.applyPerVertexElevationAlignment=function(a,c,b,d,e,f,h,p,n,r,u){var m=g[u.mode],w=0;if(k.bufferToBuffer(a,c,b,d,n.spatialReference,e,p)&&(m.requiresAlignment(u)?
(w=m.applyElevationAlignmentBuffer(d,e,f,h,p,n,r,u),a=f,e=h):a=d,k.bufferToBuffer(a,n.spatialReference,e,f,r.spatialReference,h,p)))return w};b.evaluateElevationAlignmentAtPoint=n;b.elevationModeChangeUpdateType=function(a,b,d){return null==b||null==d?a.definedChanged:"on-the-ground"===b&&"on-the-ground"===d?a.staysOnTheGround:b===d||"on-the-ground"!==b&&"on-the-ground"!==d?c.UPDATE:a.onTheGroundChanged};b.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};
b.needsElevationUpdates3D=function(a){return"absolute-height"!==a};b.applyElevationAlignmentForHUD=function(a,c,b,d,g){b=n(c,b,g,d,p);e.updateVertexAttributeAuxpos1w(a,p.verticalDistanceToGround);g=p.sampledElevation;var m=f.mat4.copy(r,a.objectTransformation);u[0]=c.x;u[1]=c.y;u[2]=b;k.computeLinearTransformation(c.spatialReference,u,m,d.spatialReference)?a.objectTransformation=m:console.warn("Could not locate symbol object properly, it might be misplaced");return g};var c;(function(a){a[a.NONE=
0]="NONE";a[a.UPDATE=1]="UPDATE";a[a.RECREATE=2]="RECREATE"})(c=b.SymbolUpdateType||(b.SymbolUpdateType={}));var g={"absolute-height":{applyElevationAlignmentBuffer:function(a,c,b,d,e,g,k,f){g=f.calculateOffsetRenderUnits(k);f=f.featureExpressionInfoContext;c*=3;d*=3;for(k=0;k<e;++k){var m=a[c+1],h=a[c+2];b[d+0]=a[c+0];b[d+1]=m;b[d+2]=null==f?h+g:g;c+=3;d+=3}return 0},requiresAlignment:function(a){var c=a.featureExpressionInfoContext;return 0!==a.meterUnitOffset||null==c}},"on-the-ground":{applyElevationAlignmentBuffer:function(a,
c,b,d,e,g){var k=0,f=g.spatialReference;c*=3;d*=3;for(var m=0;m<e;++m){var h=a[c+0],p=a[c+1],n=g.getElevation(h,p,a[c+2],f,"ground")||0,k=k+n;b[d+0]=h;b[d+1]=p;b[d+2]=n;c+=3;d+=3}return k/e},requiresAlignment:function(){return!0}},"relative-to-ground":{applyElevationAlignmentBuffer:function(a,c,b,d,e,g,k,f){var m=0;k=f.calculateOffsetRenderUnits(k);f=f.featureExpressionInfoContext;var h=g.spatialReference;c*=3;d*=3;for(var p=0;p<e;++p){var n=a[c+0],w=a[c+1],r=a[c+2],t=g.getElevation(n,w,r,h,"ground")||
0,m=m+t;b[d+0]=n;b[d+1]=w;b[d+2]=null==f?r+t+k:t+k;c+=3;d+=3}return m/e},requiresAlignment:function(){return!0}},"relative-to-scene":{applyElevationAlignmentBuffer:function(a,c,b,d,e,g,k,f){var m=0;k=f.calculateOffsetRenderUnits(k);f=f.featureExpressionInfoContext;var h=g.spatialReference;c*=3;d*=3;for(var p=0;p<e;++p){var n=a[c+0],w=a[c+1],r=a[c+2],t=g.getElevation(n,w,r,h,"scene")||0,m=m+t;b[d+0]=n;b[d+1]=w;b[d+2]=null==f?r+t+k:t+k;c+=3;d+=3}return m/e},requiresAlignment:function(){return!0}}},
r=h.mat4f64.create(),p={verticalDistanceToGround:0,sampledElevation:0},u=a.vec3f64.create()})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a){var c=a.paths[0];if(!c||0===c.length)return null;c=p.getPointOnPath(c,p.getPathLength(c)/2);return u.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function v(a,c,b){b=b?a:u.clonePoint(a);return c&&a?t.pointToPoint(a,b,c)?b:null:b}function y(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!y(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(b,"__esModule",{value:!0});b.computeCentroid=function(a,c){if("point"===
a.type)return v(a,c,!1);if(u.isHydratedGeometry(a))switch(a.type){case "extent":return v(a.center,c,!1);case "polygon":return v(a.centroid,c,!1);case "polyline":return v(x(a),c,!0);case "mesh":return v(a.extent.center,c,!1)}else switch(a.type){case "extent":var b=l.isFinite(a.zmin);a=u.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),b?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return v(a,c,!0);case "polygon":return(b=a.rings[0])&&0!==b.length?(b=r.ringsCentroid(a.rings,a.hasZ),a=u.makeDehydratedPoint(b[0],
b[1],b[2],a.spatialReference)):a=null,v(a,c,!0);case "polyline":return v(x(a),c,!0)}};b.enlargeExtent=function(a,c,b){if(a){c||(c=g.create());var d=.5*a.width*(b-1);b=.5*a.height*(b-1);a.width<1E-7*a.height?d+=b/20:a.height<1E-7*a.width&&(b+=d/20);k.vec4.set(c,a.xmin-d,a.ymin-b,a.xmax+d,a.ymax+b);return c}return null};b.updateVertexAttributeAuxpos1w=function(a,c){for(var b=0;b<a.geometries.length;++b){var d=a.geometries[b].data.vertexAttributes.auxpos1;d&&d.data[3]!==c&&(d.data[3]=c,a.geometryVertexAttrsUpdated(b))}};
b.mixinColorAndOpacity=function(a,c){var b=n.vec4f64.clone(n.vec4f64.ONES);f.isSome(a)&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);f.isSome(c)?b[3]=c:f.isSome(a)&&3<a.length&&(b[3]=a[3]);return b};b.overrideColor=function(a,c,b,d,e,g){void 0===g&&(g=[0,0,0,0]);for(var k=0;3>k;++k)f.isSome(a)&&null!=a[k]?g[k]=a[k]:f.isSome(b)&&null!=b[k]?g[k]=b[k]:g[k]=e[k];f.isSome(c)?g[3]=c:f.isSome(d)?g[3]=d:g[3]=e[3];return g};b.computeObjectScale=function(a,c,b,e){void 0===a&&(a=d.vec3f64.ONES);void 0===e&&(e=1);var g=Array(3);
if(null==c||null==b)g[0]=1,g[1]=1,g[2]=1;else{for(var k=void 0,f=0,m=2;0<=m;m--){var h=a[m],p=void 0,n=null!=h,r=0===m&&!k&&!n,w=b[m];"symbolValue"===h||r?p=0!==w?c[m]/w:1:n&&"proportional"!==h&&isFinite(h)&&(p=0!==w?h/w:1);null!=p&&(k=g[m]=p,f=Math.max(f,Math.abs(p)))}for(m=2;0<=m;m--)null==g[m]?g[m]=k:0===g[m]&&(g[m]=.001*f)}for(m=2;0<=m;m--)g[m]/=e;return d.vec3f64.fromArray(g)};b.computeSizeWithResourceSize=function(a,c){var b=c.width,e=c.depth,g=c.height;c=c.isPrimitive?10:1;if(null==b&&null==
g&&null==e)return[c*a[0],c*a[1],c*a[2]];for(var b=d.vec3f64.fromValues(b,e,g),k,e=0;3>e;e++)if(g=b[e],null!=g){k=g/a[e];break}for(e=0;3>e;e++)null==b[e]&&(b[e]=a[e]*k);return b};b.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return y(a)?null:"Symbol sizes may not be negative values"};b.isValidSize=y;b.computeObjectRotation=function(c,b,d,e){void 0===e&&(e=a.mat4f64.create());c=c||0;b=b||0;d=d||0;0!==c&&h.mat4.rotateZ(e,e,-c/180*Math.PI);0!==b&&h.mat4.rotateX(e,
e,b/180*Math.PI);0!==d&&h.mat4.rotateY(e,e,d/180*Math.PI);return e};b.demResolutionForBoundingBox=function(a,b){return null!=b.minDemResolution?b.minDemResolution:c.isPoint(a)?b.minDemResolutionForPoints:.01*c.maximumDimension(a)};b.namedAnchorToHUDMaterialAnchorPos={"bottom-left":e.vec2f64.fromValues(0,0),bottom:e.vec2f64.fromValues(.5,0),"bottom-right":e.vec2f64.fromValues(1,0),left:e.vec2f64.fromValues(0,.5),center:e.vec2f64.fromValues(.5,.5),right:e.vec2f64.fromValues(1,.5),"top-left":e.vec2f64.fromValues(0,
1),top:e.vec2f64.fromValues(.5,1),"top-right":e.vec2f64.fromValues(1,1)}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a){return a.isVisible?a.getParameters().transparent?1:2:0}q=function(){function b(a,d,e,g,k,f,h,p,n){this.uniqueGeometries=e;this.uniqueMaterials=g;this.uniqueTextures=k;this.elevationAligner=f;this._edgeState=p;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.stageObject=d;this.elevationAligner=f;this.elevationContext=
new c(h);this.visibilityMode=null!=n?n:b.VisibilityModes.HIDE_FACERANGE}Object.defineProperty(b.prototype,"isElevationSource",{get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)},enumerable:!0,configurable:!0});b.prototype.initialize=function(a,c){this.stageLayer=c;this.stage=a;if(this.uniqueMaterials)for(c=0;c<this.uniqueMaterials.length;c++)a.add(3,this.uniqueMaterials[c]);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.add(2,this.uniqueGeometries[c]);
if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.add(4,this.uniqueTextures[c]);a.add(1,this.stageObject)};b.prototype.layerOpacityChanged=function(c,b){if(!a.isNone(this._edgeState)){for(var d=r(this._edgeState.baseMaterial),e=!1,g=0,k=this._edgeState.edgeMaterials;g<k.length;g++){var f=k[g];f.objectTransparency!==d&&(f.objectTransparency=d,e=!0)}e&&this.resetEdgeObject(b);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[c])}};b.prototype.slicePlaneEnabledChanged=
function(c,b){a.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:c},!b),this._edgeState.slicePlaneEnabled=c)};b.prototype.setVisibility=function(c){if(null!=this.stage){if(this._visible!==c){(this._visible=c)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===b.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);if(a.isSome(this._edgeState)){var d=this.stage.renderView.ensureEdgeView();d.hasObject(this.stageObject)?d.updateObjectVisibility(this.stageObject,c):c&&this.addEdgeObject(d,this._edgeState,!1)}return!0}return!1}};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});b.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=
0;c<this.uniqueMaterials.length;c++)a.remove(3,this.uniqueMaterials[c].id);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(2,this.uniqueGeometries[c].id);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(4,this.uniqueTextures[c].id)}a.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.renderView.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);
this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};b.prototype.alignWithElevation=function(a,c,b,d){null!=this.elevationAligner&&(n.setContextFeature(this.elevationContext.featureExpressionInfoContext,b),a=this.elevationAligner(this,this.elevationContext,a,c),null!=a&&(this.alignedSampledElevation=a),this.resetEdgeObject(d))};b.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=d.vec3f64.create());
return e.vec3.copy(a,this.stageObject.getCenter(!0))};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=k.create());var c=this.stageObject;a||(a=k.create());k.setMin(a,c.getBBMin(!0));k.setMax(a,c.getBBMax(!0));return a};b.prototype.computeAttachmentOrigin=function(a){for(var c=0,b=this.stageObject.geometryRecords;c<b.length;c++)b[c].computeAttachmentOrigin(t)&&(e.vec3.transformMat4(t,t,this.stageObject.objectTransformation),e.vec3.add(a.render.origin,a.render.origin,t),a.render.num++)};
b.prototype.getProjectedBoundingBox=function(a,c,b,d,n){return h(this,void 0,void 0,function(){var h,m,r,w,v,A,l,y,B,q;return f(this,function(f){switch(f.label){case 0:h=this.getBoundingBoxObjectSpace(n);m=x;r=k.isPoint(h)?1:m.length;for(w=0;w<r;w++)v=m[w],u[0]=h[v[0]],u[1]=h[v[1]],u[2]=h[v[2]],e.vec3.transformMat4(u,u,this.stageObject.objectTransformation),p[3*w+0]=u[0],p[3*w+1]=u[1],p[3*w+2]=u[2];if(!a(p,0,r))return[2,null];k.empty(h);A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());
for(w=0;w<3*r;w+=3){for(l=0;3>l;l++)h[l]=Math.min(h[l],p[w+l]),h[l+3]=Math.max(h[l+3],p[w+l]);A&&b.push({location:p.slice(w,w+3),screenSpaceBoundingRect:A})}if(!c||!c.service||"absolute-height"===this.elevationContext.mode)return[3,5];k.center(h,t);y="relative-to-scene"===this.elevationContext.mode?"scene":"ground";B=void 0;if(!c.useViewElevation)return[3,1];B=c.service.getElevation(t[0],t[1],y);return[3,4];case 1:return f.trys.push([1,3,,4]),q=g.demResolutionForBoundingBox(h,c),[4,c.service.queryElevation(t[0],
t[1],d,q,y)];case 2:return B=f.sent(),[3,4];case 3:return f.sent(),B=null,[3,4];case 4:k.offset(h,0,0,-this.alignedSampledElevation+B),f.label=5;case 5:return[2,h]}})})};b.prototype.addHighlight=function(a,c){c=this.stageObject.highlightAllComponents(c);a.addObject(this.stageObject,c)};b.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};b.prototype.resetEdgeObject=function(c){if(!a.isNone(this._edgeState)){var b=this.stage.renderView.ensureEdgeView();b.removeObject(this.stageObject);
this._visible&&this.addEdgeObject(b,this._edgeState,c)}};b.prototype.addEdgeObject=function(a,c,b){for(var d=r(c.baseMaterial),e=0,g=c.edgeMaterials;e<g.length;e++)g[e].objectTransparency=d;a.addObject(this.stageObject,c.edgeMaterials,{slicePlaneEnabled:c.slicePlaneEnabled},!b,c.addObjectSettings)};return b}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(q||(q={}));var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0],u=d.vec3f64.create(),t=d.vec3f64.create(),x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return q})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Logger ../../../../layers/graphics/dehydratedFeatures ../../../../support/arcadeOnDemand".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});
var d=h.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");b.createContextWithoutExpressionSupport=function(a){a=a&&a.expression;return"string"===typeof a&&(a="0"===a?0:null,null!=a)?{cachedResult:a}:null};b.createContext=function(a,b,c){return f(this,void 0,void 0,function(){var d,k,f,h,n;return l(this,function(g){switch(g.label){case 0:d=a&&a.expression;if("string"!==typeof d)return[2,null];k="0"===d?0:null;return null!=k?[2,{cachedResult:k}]:[4,e.loadArcade()];case 1:return f=
g.sent(),h=f.arcadeUtils,n=h.createSyntaxTree(d),h.dependsOnView(n)?(null!=c&&c.error("Expressions containing '$view' are not supported on ElevationInfo"),[2,{cachedResult:0}]):[2,{arcade:{func:h.createFunction(n),context:h.createExecContext(null,{sr:b}),modules:f}}]}})})};b.createFeature=function(a,b,c){return a.arcadeUtils.createFeature(b.attributes,b.geometry,c)};b.setContextFeature=function(b,e){null!=b&&null==b.cachedResult&&(e&&b.arcade?(e._geometry&&(e._geometry=a.hydrateGeometry(e._geometry)),
b.arcade.modules.arcadeUtils.updateExecContext(b.arcade.context,e)):d.error("Arcade support required but not provided"))};b.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var b=a.arcade,b=a.arcade.modules.arcadeUtils.executeFunction(b.func,b.context);"number"!==typeof b&&(b=a.cachedResult=0);return b}return 0};b.extractExpressionInfo=function(a,b){void 0===b&&(b=!1);var c=(a=a&&a.featureExpressionInfo)&&a.expression;b||"0"===c||(a=null);return a};b.zeroContext={cachedResult:0}})},
"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(q,b,l,f){return function(b){function a(a){a=b.call(this,a)||this;a.centerPointInElevationSR=null;return a}l(a,b);return a}(f)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(q,b,l,f){return function(){function b(a){a?
this.set(a):this.setDefaults()}Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});b.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=l.getMetersPerUnit(a)};b.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=
null;this.setUnit("meters")};b.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.setUnit(a.unit)};b.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};b.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};b.prototype.addOffsetRenderUnits=
function(a){this._renderUnitOffset+=a};b.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};b.prototype.calculateOffsetRenderUnits=function(a){var b=this._meterUnitOffset,d=this.featureExpressionInfoContext;null!=d&&(b+=f.execute(d)*this._metersPerElevationInfoUnit);return b/a.unitInMeters+this._renderUnitOffset};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./Loadable ./symbolComplexity".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){function m(a,c){a=null!=a?c.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(b,"__esModule",{value:!0});var w=new u,A=k.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");q=function(b){function k(a,c,d,e){var g=b.call(this)||this;g._elevationInfoOverride=null;g.complexity=null;g.logger=A;g._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};g.symbol=a;g.symbolLayer=c;g._context=d;g._renderPriority=
e.renderPriority;g._renderPriorityDelta=e.renderPriorityStep;g._elevationContext=new u;g._material=null;g.complexity=g.computeComplexity();g._updateDrivenProperties(e.ignoreDrivers);g._updateElevationContext();return g}l(k,b);k.prototype.getCachedSize=function(){return null};Object.defineProperty(k.prototype,"needsDrivenTransparentPass",{get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque},enumerable:!0,configurable:!0});k.prototype._logGeometryCreationWarnings=
function(a,c,b,d){var e="polygons"in a?a.polygons:null;d+=" geometry failed to be created";var g=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?g=d+" (no "+b+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?g=d+" ("+b+" should contain at least 2 vertices)":e&&0===e.length&&"rings"===b&&(g=d+" (filled "+b+" should use clockwise winding - try reversing the order of vertices)"):g=d+" ("+b+" should be defined as a 2D array)":g=d+" (failed to project geometry to view spatial reference)";
g&&A.warnOncePerTick(g)};k.prototype._validateGeometryType=function(a,c,b){if(e.includes(c,a.type))return!0;this.logger.warn("unsupported geometry type for "+b+(" symbol: "+a.type));return!1};k.prototype._validateGeometry=function(a){return"point"!==a.type||n.isFinite(a.x)&&n.isFinite(a.y)?!0:(A.warn("point coordinate is not a valid number, graphic skipped"),!1)};k.prototype._defaultElevationInfoNoZ=function(){return B};k.prototype._defaultElevationInfoZ=function(){return C};k.prototype._updateElevationContext=
function(){this._elevationContext.setDefaults();c.isSome(this._elevationInfoOverride)?this._elevationContext.mixinApi(this._elevationInfoOverride):this._context.layer.elevationInfo&&(this._elevationContext.mixinApi(this._context.layer.elevationInfo),this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext)};k.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};k.prototype.getGeometryElevationMode=
function(a,c){void 0===c&&(c=this.getDefaultElevationInfo(a));return this._elevationContext.mode||c.mode};k.prototype.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};k.prototype.getGraphicElevationContext=function(a){var b=c.expect(a.geometry),d=this.getDefaultElevationInfo(b);w.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);w.mode=this.getGeometryElevationMode(b,d);w.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?
this._elevationContext.meterUnitOffset:d.offset);w.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==w.mode||(w.mode="relative-to-ground",w.setOffsetMeters(0),w.featureExpressionInfoContext=t.zeroContext);if(b=w.featureExpressionInfoContext&&w.featureExpressionInfoContext.arcade)a=t.createFeature(b.modules,a,this._context.layer),t.setContextFeature(w.featureExpressionInfoContext,a);return w};k.prototype.prepareSymbolLayerPatch=
function(a){};k.prototype.updateGeometry=function(a,c){return!1};k.prototype.onRemoveGraphic=function(a){};k.prototype._updateDrivenProperties=function(a){var c={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":c.color=!0;if(a.stops)for(var b=0;b<a.stops.length;b++){var d=a.stops[b].color;d&&(c.opacity=!0,1>d.a&&(c.opacityAlwaysOpaque=!1))}break;case "opacity":c.opacity=
!0;c.opacityAlwaysOpaque=!1;break;case "size":c.size=!0}});this._drivenProperties=c};k.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};k.prototype._getCombinedOpacity=function(a,b){void 0===b&&(b=E);var d;d=1*this._getLayerOpacity();if(this._drivenProperties.opacity)return d;c.isSome(a)?d*=a.a:b.hasIntrinsicColor||(d=0);return d};k.prototype._getCombinedOpacityAndColor=
function(b,d){void 0===d&&(d=E);d=this._getCombinedOpacity(b,d);if(this._drivenProperties.color)return x.mixinColorAndOpacity(null,d);b=c.isSome(b)?a.toUnitRGB(b):g.vec3f64.ONES;return x.mixinColorAndOpacity(b,d)};k.prototype._getVertexOpacityAndColor=function(a,c,b){a=x.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);b&&(a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b);return c?new c(a):a};k.prototype._getIdHint=function(a){void 0===a&&(a="");return this._context.layer.id+
"_symbol"+a};k.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};k.prototype.computeComplexity=function(){return y.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};k.prototype.destroy=function(){this.abortLoad()};k.prototype.globalPropertyChanged=function(a,c,b){switch(a){case "opacity":return this.layerOpacityChanged(c,b);case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(c,
b,a)===p.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(c,b);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return d.neverReachedSilent(a),!1}};k.prototype.updateGraphics3DGraphicElevationInfo=function(a,b,d){var e=this,g=p.SymbolUpdateType.UPDATE;a.forEach(function(a){var k=b(a);c.isSome(k)?(a=e.getGraphicElevationContext(a.graphic),k.needsElevationUpdates=d(a.mode),
k.elevationContext.set(a)):g=p.SymbolUpdateType.RECREATE});return g};k.prototype.applyRendererDiff=function(a,c){return!1};k.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var c=this._fastUpdates.visualVariables,b=c.size?m(c.size.field,a):0,d=c.color?m(c.color.field,a):0;a=c.opacity?m(c.opacity.field,a):0;return r.vec4f64.fromValues(b,d,a,0)};return k}(v.Loadable);b.Graphics3DSymbolLayer=q;b.getAttributeValue=m;var B={mode:"on-the-ground",offset:0,unit:"meters"},
C={mode:"absolute-height",offset:0,unit:"meters"},E={hasIntrinsicColor:!1};b.default=q})},"esri/views/3d/layers/graphics/Loadable":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../../../core/promiseUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}Object.defineProperty(a.prototype,
"loadStatus",{get:function(){return this._loadStatus},enumerable:!0,configurable:!0});a.prototype.load=function(a,b){var d=this;if(1===this._loadStatus)return a&&a(),this._loader;if(2===this._loadStatus)return b&&b(this._loadError),this._loader;this._loader||(this._abortController=h.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(function(){d._abortController=null;d._loadStatus=1},function(a){d._loadError=a;d._abortController=null;d._loadStatus=2;!h.isAbortError(a)&&
d.logger&&a.message&&d.logger.warn(a.message);throw a;}));this._loader.then(a,b);return this._loader};a.prototype.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};return a}();b.Loadable=q})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(q,b,l,f,h,a,e,d,k){function n(a){for(var c=0,b=0,d=!1,e={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}},g=0;g<a.length;g++){var k=a[g];k&&(c+=k.primitivesPerFeature,b+=k.primitivesPerCoordinate,e.bytesPerFeature+=k.memory.bytesPerFeature,e.bytesPerFeatureLabel+=k.memory.bytesPerFeatureLabel,e.bytesPerCoordinate+=k.memory.bytesPerCoordinate,e.draped.bytesPerFeature+=k.memory.bytesPerFeature,e.draped.bytesPerFeatureLabel+=
k.memory.bytesPerFeatureLabel,e.draped.bytesPerCoordinate+=k.memory.bytesPerCoordinate,d=d||k.estimated)}return{primitivesPerFeature:c,primitivesPerCoordinate:b,estimated:d,memory:e}}function c(c,b){var d=g(c,b);switch(b.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,estimated:!1,memory:d};case "fill":return"mesh-3d"===c.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!1,memory:d}:h.isSome(b.outline)&&0<b.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,
estimated:!1,memory:d}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,estimated:!1,memory:d};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,estimated:!1,memory:d};case "object":return b.resource&&b.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,estimated:!0,memory:d}:l({},r(b.resource&&b.resource.primitive||a.defaultPrimitive),{memory:d});case "path":var e=c=0;switch(b.profile){case "circle":c=
10;break;case "quad":c=4;break;default:f.neverReached(b.profile);return}switch(b.join){case "round":e=3;break;case "miter":case "bevel":e=1;break;default:f.neverReached(b.join);return}var k=2*c,e=c*e*2,m=-2*e-k;switch(b.cap){case "none":break;case "butt":case "square":m+=2*(c-1);break;case "round":m+=2*(4*c+c);break;default:f.neverReached(b.cap);return}return{primitivesPerFeature:m,primitivesPerCoordinate:e+k,estimated:!1,memory:d};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,
estimated:!1,memory:d};default:f.neverReached(b)}}function g(a,c){a="point-3d"===a.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?b.memoryEstimators.EXTRUDE_EDGES:b.memoryEstimators.EXTRUDE;case "fill":return h.isSome(c.outline)&&0<c.outline.size?b.memoryEstimators.FILL_OUTLINE:b.memoryEstimators.FILL;case "water":return b.memoryEstimators.FILL;case "line":return"round"===c.join?b.memoryEstimators.LINE_ROUND:b.memoryEstimators.LINE_MITER;case "path":switch(c.join){case "round":switch(c.profile){case "circle":return b.memoryEstimators.PATH_ROUND_CIRCLE;
case "quad":return b.memoryEstimators.PATH_ROUND_QUAD;default:f.neverReached(c.profile);return}case "miter":case "bevel":switch(c.profile){case "circle":return b.memoryEstimators.PATH_MITER_CIRCLE;case "quad":return b.memoryEstimators.PATH_MITER_QUAD;default:f.neverReached(c.profile);return}default:f.neverReached(c.join);return}case "object":return a?b.memoryEstimators.OBJECT_POINT:b.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?b.memoryEstimators.ICON_POINT:b.memoryEstimators.ICON_POLYGON;
default:f.neverReached(c)}}function r(a){var c=p[a];if(c)return c;c=e.primitiveLodResources(a,null,null);c={primitivesPerFeature:k.geometriesFromLodLevelResources(c.levels[0]).reduce(function(a,c){return a+c.data.getIndices(d.VertexAttrConstants.POSITION).length/3},0),primitivesPerCoordinate:0,estimated:!1};return p[a]=c}Object.defineProperty(b,"__esModule",{value:!0});b.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,
bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};b.defaultSymbolComplexity=function(a){if("web-style"===a.type)return b.emptySymbolComplexity;var d=a.symbolLayers.toArray().map(function(b){return c(a,b)});return n(d)};b.totalSymbolComplexities=n;var p={};b.defaultSymbolLayerComplexity=c;b.defaultSymbolLayerMemoryComplexity=g;b.memoryEstimators={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});var e=f.fromValues(-.5,-.5,-.5,.5,.5,.5),d=f.fromValues(-.5,-.5,0,.5,.5,1),k=f.fromValues(-.5,-.5,0,.5,.5,.5);b.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
b.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return e;case "cylinder":case "cone":case "inverted-cone":return d;case "tetrahedron":return k;default:l.neverReached(a)}};b.primitiveGeometryData=function(c){switch(c){case "sphere":return a.createPolySphereGeometry(.5,2,!0);case "cube":return a.createBoxGeometry(1);case "cylinder":return a.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!1));case "inverted-cone":return a.cgToGIS(a.createConeGeometry(1,
.5,15,!0));case "tetrahedron":return a.cgToGIS(a.createTetrahedronGeometry(1));case "diamond":return a.cgToGIS(a.createDiamondGeometry(1));default:l.neverReached(c)}};b.primitiveLodResources=function(c,b,d){var e=function(c,e,g){void 0===g&&(g=!1);return{levels:c.map(function(c,k){var f=e(c.tesselation);g&&a.cgToGIS(f);return{components:[{geometry:new h(f,d+("_lod"+k)),material:b}],faceCount:f.indexCount/3,minScreenSpaceRadius:c.minScreenSpaceRadius}})}};switch(c){case "sphere":return e([{tesselation:0,
minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(c){return a.createPolySphereGeometry(.5,c,!0)});case "cube":return e([{tesselation:0,minScreenSpaceRadius:0}],function(){return a.createBoxGeometry(1)});case "cone":return e(n,function(c){return a.createConeGeometry(1,.5,c,!1)},!0);case "inverted-cone":return e(n,function(c){return a.createConeGeometry(1,.5,
c,!0)},!0);case "cylinder":return e(n,function(c){return a.createCylinderGeometry(1,.5,c,[0,0,1],[0,0,.5])});case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],function(){return a.createTetrahedronGeometry(1)},!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],function(){return a.createDiamondGeometry(1)},!0);default:l.neverReached(c)}};var n=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},
"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),function(q,b,l,f,h,a,e,d){return function(){function b(a,c,d){this._componentAABBs=this._boundingInfo=null;this._id=b.__idGen.gen(c);this._data=a;this._boundingInfo=d}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._data},
enumerable:!0,configurable:!0});b.prototype.getIndices=function(a){return this.data.getIndices(a)};Object.defineProperty(b.prototype,"indexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});b.prototype.getAttribute=function(a){return this.data.getAttribute(a)};Object.defineProperty(b.prototype,"componentCount",{get:function(){return f.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexCount",{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.computeAttachmentOrigin=
function(a){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(a):this.computeAttachmentOriginPoints(a)};b.prototype.computeAttachmentOriginTriangles=function(a){var c=this.getIndices(d.VertexAttrConstants.POSITION),b=this.getAttribute(d.VertexAttrConstants.POSITION);return h.computeAttachmentOriginTriangles(b,c,a)};b.prototype.computeAttachmentOriginPoints=function(a){var c=this.getIndices(d.VertexAttrConstants.POSITION),b=this.getAttribute(d.VertexAttrConstants.POSITION);
return h.computeAttachmentOriginPoints(b,c,a)};b.prototype.invalidateBoundingInfo=function(){this._componentAABBs=this._boundingInfo=null};b.prototype.getComponentAABB=function(a,c){null==this._componentAABBs&&(this._componentAABBs=this._computeComponentAABBs());for(var b=0;6>b;b++)c[b]=this._componentAABBs[6*a+b];return c};b.prototype._computeComponentAABBs=function(){for(var a=this.componentCount,c=new Float32Array(6*a),b=0;b<a;b++)this._calculateAABB(b,c,6*b);return c};b.prototype._calculateAABB=
function(a,c,b){var e=this.data.getIndices(d.VertexAttrConstants.POSITION),g=this.data.getAttribute(d.VertexAttrConstants.POSITION),k=this.data.componentOffsets,f=k.length?k[a+1]:e.length,h=Infinity,n=Infinity,l=Infinity,m=-Infinity,w=-Infinity,A=-Infinity,B=g.offsetIdx,C=g.strideIdx;for(a=k.length?k[a]:0;a<f;a++)var E=B+C*e[a],k=g.data[E],G=g.data[E+1],E=g.data[E+2],h=Math.min(h,k),n=Math.min(n,G),l=Math.min(l,E),m=Math.max(m,k),w=Math.max(w,G),A=Math.max(A,E);c[b]=h;c[b+1]=n;c[b+2]=l;c[b+3]=m;c[b+
4]=w;c[b+5]=A};b.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(d.VertexAttrConstants.POSITION),c=this.data.getAttribute(d.VertexAttrConstants.POSITION),b="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(b),k=0;k<b;++k)a[k]=k;k=a.length;e.assert(0===k%b,"Indexing error: "+k.toFixed(0)+" not divisible by "+b.toFixed(0));k=h.generateDefaultIndexArray(k/b);return new l(k,b,a,c)};b.__idGen=new a.IdGen;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),
function(q,b,l,f,h,a){q=function(){function b(d,e,n,c){this.primitiveIndices=d;this._numIndexPerPrimitive=e;this.indices=n;this._position=c;this.center=h.vec3f64.create();a.assert(1<=d.length);a.assert(0===n.length%this._numIndexPerPrimitive);a.assert(n.length>=d.length*this._numIndexPerPrimitive);a.assert(3===this._position.size||4===this._position.size);c=this._position;e=c.data;var g=c.offsetIdx,k=c.strideIdx;c=0;var p=d.length,l=g+k*n[this._numIndexPerPrimitive*d[c]];b.tmpIndices.clear();b.tmpIndices.push(l);
this.bbMin=h.vec3f64.fromValues(e[l],e[l+1],e[l+2]);for(this.bbMax=h.vec3f64.clone(this.bbMin);c<p;++c)for(var t=this._numIndexPerPrimitive*d[c],x=0;x<this._numIndexPerPrimitive;++x){l=g+k*n[t+x];b.tmpIndices.push(l);var v=e[l];this.bbMin[0]=Math.min(v,this.bbMin[0]);this.bbMax[0]=Math.max(v,this.bbMax[0]);v=e[l+1];this.bbMin[1]=Math.min(v,this.bbMin[1]);this.bbMax[1]=Math.max(v,this.bbMax[1]);v=e[l+2];this.bbMin[2]=Math.min(v,this.bbMin[2]);this.bbMax[2]=Math.max(v,this.bbMax[2])}f.vec3.lerp(this.center,
this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);d=this.bsRadius*this.bsRadius;for(c=0;c<b.tmpIndices.length;++c)l=b.tmpIndices.data[c],n=e[l]-this.center[0],g=e[l+1]-this.center[1],l=e[l+2]-this.center[2],k=n*n+g*g+l*l,k<=d||(k=Math.sqrt(k),p=.5*(k-this.bsRadius),this.bsRadius+=p,d=this.bsRadius*this.bsRadius,k=p/k,this.center[0]+=n*k,this.center[1]+=g*k,this.center[2]+=l*k);b.tmpIndices.clear()}b.prototype.getCenter=
function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this._children)return this._children;if(1<f.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var a=
f.vec3.lerp(h.vec3f64.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,n=new Uint8Array(e),c=Array(8),g=0;8>g;++g)c[g]=0;for(var g=this._position,r=g.data,p=g.offsetIdx,l=g.strideIdx,g=0;g<e;++g){for(var t=0,x=this._numIndexPerPrimitive*this.primitiveIndices[g],v=p+l*this.indices[x],y=r[v],m=r[v+1],w=r[v+2],A=1;A<this._numIndexPerPrimitive;++A){var v=p+l*this.indices[x+A],B=r[v],C=r[v+1],v=r[v+2];B<y&&(y=B);C<m&&(m=C);v<w&&(w=v)}y<a[0]&&(t|=1);m<a[1]&&(t|=2);w<a[2]&&(t|=4);n[g]=t;
++c[t]}for(g=a=0;8>g;++g)0<c[g]&&++a;if(2>a)return;a=Array(8);for(g=0;8>g;++g)a[g]=0<c[g]?new Uint32Array(c[g]):void 0;for(g=0;8>g;++g)c[g]=0;for(g=0;g<e;++g)t=n[g],a[t][c[t]++]=this.primitiveIndices[g];this._children=Array(8);for(g=0;8>g;++g)void 0!==a[g]&&(this._children[g]=new b(a[g],this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return b}();(q||(q={})).tmpIndices=new l({deallocator:null});return q})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils"],function(q,b,l){function f(b){var a=[];b.components.forEach(function(b){a.push(b.geometry)});return l.unique(a)}Object.defineProperty(b,"__esModule",{value:!0});b.materialsFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){a.push(b.material)})});return l.unique(a)};b.texturesFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){b.textures&&a.push.apply(a,b.textures)})});
return l.unique(a)};b.geometriesFromLodLevelResources=f;b.geometriesFromLodResources=function(b){var a=[];b.levels.forEach(function(b){b.components.forEach(function(b){a.push(b.geometry)})});return l.unique(a)};b.computeFaceCount=function(b){var a=0;f(b).forEach(function(b){a+=b.data.indexCount/3});return a}})},"esri/views/3d/layers/graphics/pointUtils":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});var r=h.vec3f64.create();b.createStageObjectForHUD=function(b,d,e,h,n,y,m,w,A,B,C){var p=e?e.length:0,t=b.clippingExtent;c.pointToVector(d,r,b.elevationProvider.spatialReference);if(l.isSome(t)&&!a.containsPoint(t,r))return null;c.pointToVector(d,r,b.renderCoordsHelper.spatialReference);t=b.localOriginFactory.getOrigin(r);w=new g({castShadow:!1,metadata:{layerUid:A,graphicUid:B,usesVerticalDistanceToGround:!0},idHint:w});
for(A=0;A<p;A++)w.addGeometry(e[A],h[A],n?n[A]:f.mat4f64.IDENTITY,y,t,C);b=k.applyElevationAlignmentForHUD(w,d,b.elevationProvider,b.renderCoordsHelper,m);return{object:w,sampledElevation:b}};b.extendPointGraphicElevationContext=function(a,b,e){a=a.elevationContext;e=e.spatialReference;c.pointToVector(b,r,e);a.centerPointInElevationSR=d.makeDehydratedPoint(r[0],r[1],b.hasZ?r[2]:0,e)};b.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return n.computeCentroid(a);
case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=e.getPointOnPath(b,e.getPathLength(b)/2);return d.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null}})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){q=function(a){function b(c,d){d=a.call(this,d)||this;d.techniqueConfig=new g.LineCalloutTechniqueConfiguration;d.params=n.copyParameters(c,p);d._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(d.params);return d}l(b,a);Object.defineProperty(b.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});b.prototype.dispose=function(){};b.prototype.getGLMaterial=function(a){return 0===a.output?new r(a):
void 0};b.prototype.getPassParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=a;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===
this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;return this.techniqueConfig};b.prototype.intersect=function(){};b.prototype.createBufferWriter=function(){return new x};b.prototype.createRenderer=function(a,b){return new c(a,b,this)};b.prototype.setParameterValues=function(a){n.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(this.params),this.parametersChanged())};b.prototype.getParameters=function(){return this.params};
b.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return b}(e.Material);var r=function(a){function b(b){b=a.call(this,b)||this;b.isRenderSlot=!0;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(g.LineCalloutTechnique,this.material.getTechniqueConfig(!1),this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(g.LineCalloutTechnique,
this.material.getTechniqueConfig(!0),this.depthTechnique)};b.prototype.beginSlot=function(a){switch(a){case 17:return this.isRenderSlot=!0;case 18:return this.isRenderSlot=!1,!0}return!1};b.prototype.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};b.prototype.bind=function(a,b){var c=this.getTechnique();a.bindProgram(c.program);c.bindPass(a,this.material.getPassParameters(),b);c.bindPipelineState(a)};b.prototype.bindView=function(a){this.getTechnique().bindDraw(a)};
return b}(a.GLMaterial),p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},u=h.newLayout().vec3f(d.VertexAttrConstants.POSITION).vec3f(d.VertexAttrConstants.NORMAL).vec2f(d.VertexAttrConstants.UV0).vec4f(d.VertexAttrConstants.AUXPOS1),t=[f.vec2f32.fromValues(0,0),f.vec2f32.fromValues(1,0),f.vec2f32.fromValues(0,1),f.vec2f32.fromValues(1,
0),f.vec2f32.fromValues(1,1),f.vec2f32.fromValues(0,1)],x=function(){function a(){this.vertexBufferLayout=u}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[d.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,e){k.writePosition(b.indices[d.VertexAttrConstants.POSITION],b.vertexAttr[d.VertexAttrConstants.POSITION].data,a.transformation,c.position,e,6);k.writeNormal(b.indices[d.VertexAttrConstants.NORMAL],
b.vertexAttr[d.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,c.normal,e,6);k.writeBufferVec4(b.indices[d.VertexAttrConstants.AUXPOS1],b.vertexAttr[d.VertexAttrConstants.AUXPOS1].data,c.auxpos1,e,6);for(a=0;a<t.length;++a)c.uv0.setVec(e+a,t[a])};return a}();return q})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f32=l})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require",
"exports"],function(q,b){function l(){return new Float32Array(2)}function f(a,b){var d=new Float32Array(2);d[0]=a;d[1]=b;return d}function h(){return f(1,1)}function a(){return f(1,0)}function e(){return f(0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var b=new Float32Array(2);b[0]=a[0];b[1]=a[1];return b};b.fromValues=f;b.createView=function(a,b){return new Float32Array(a,b,2)};b.zeros=function(){return l()};b.ones=h;b.unitX=a;b.unitY=e;b.ZEROS=l();b.ONES=h();
b.UNIT_X=a();b.UNIT_Y=e()})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./LineCallout.glsl ./LineCallout.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,b=b.build({occlusionTestEnabled:d.occlusionTestEnabled,verticalOffsetEnabled:d.verticalOffset,screenSizePerspectiveEnabled:d.screenSizePerspective,depthHudEnabled:d.depthHudEnabled,depthHudAlignStartEnabled:d.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:d.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:a.viewingMode});return new x(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),r.Default3D)};c.prototype.bindPass=function(a,b,c){t.LineCallout.bindUniforms(this.program,b,c);d.VerticalOffset.bindUniforms(this.program,b,c);var e=c.cameraAboveGround?1:-1;this.program.setUniform1i("hudVisibilityTexture",0);a.bindTexture(c.hudVisibilityTexture,0);this.program.setUniform1f("cameraGroundRelative",
e);this.program.setUniform1f("polygonOffset",b.shaderPolygonOffset);this.program.setUniform4fv("viewport",c.viewport);this.program.setUniform1f("perDistancePixelRatio",Math.tan(c.fovY/2)/(c.viewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",c.viewInvTransp);this.program.setUniform2f("pixelToNDC",2/c.viewport[2],2/c.viewport[3]);this.program.setUniform1f("lineSize",Math.ceil(b.size)*(c.pixelRatio||1));p.bindScreenSizePerspective(b.screenSizePerspective,this.program)};c.prototype.bindDraw=
function(b){e.Transform.bindUniforms(this.program,b);k.Camera.bindUniforms(this.program,b);a.Slice.bindUniformsWithOrigin(this.program,this.configuration,b)};c.prototype.initializePipeline=function(){return this.configuration.depthHudEnabled?y.makePipelineState({depthTest:{func:513},depthWrite:v.defaultDepthWriteParams}):y.makePipelineState({blending:y.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:y.defaultColorWriteParams})};c.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};
c.shader=new n.ReloadableShaderModule(u,"./LineCallout.glsl",q);return c}(c.ShaderTechnique);b.LineCalloutTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.occlusionTestEnabled=!0;b.verticalOffset=!1;b.screenSizePerspective=!1;b.depthHudEnabled=!1;b.depthHudAlignStartEnabled=!1;b.screenCenterOffsetUnitsEnabled=0;b.slicePlaneEnabled=!1;return b}l(b,a);f([g.parameter()],b.prototype,"occlusionTestEnabled",void 0);f([g.parameter()],b.prototype,"verticalOffset",void 0);
f([g.parameter()],b.prototype,"screenSizePerspective",void 0);f([g.parameter()],b.prototype,"depthHudEnabled",void 0);f([g.parameter()],b.prototype,"depthHudAlignStartEnabled",void 0);f([g.parameter({count:2})],b.prototype,"screenCenterOffsetUnitsEnabled",void 0);f([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(g.ShaderTechniqueConfiguration);b.LineCalloutTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/LineCallout.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/hud/AlignPixel.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var k=new d.ShaderBuilder;k.include(h.AlignPixel);k.include(a.HUD,b);k.include(f.Slice,b);k.attributes.add("uv0","vec2");k.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");k.varyings.add("coverageSampling","vec4");k.varyings.add("lineSizes","vec2");k.vertex.code.add(e.glsl(x||
(x=l(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "],
["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 endPoint \x3d projectPositionHUD(projectAux);\n\n      vec3 vpos \x3d projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n    ","\n\n    ","\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\n      // used to get the correct depth value\n      vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\n      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\n      vec4 startPoint \x3d proj * vec4(posView, 1.0);\n      // Apply screen offset to both start and end point\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\n      // Align start and end to pixel origin\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\n    ",
"\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\n      // The direction of the line in screen space\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\n\n      // Sub-pixel offset if we need to grow sub-pixels to the left\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\n\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\n\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n      float padding \x3d 1.0 + borderSizeScaled;\n      vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n      // Offset x/y from the center of the line in screen space\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n      // Compute a coverage varying which we can use in the fragment shader to determine\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n      // This works by computing two coordinates that can be linearly interpolated and then\n      // subtracted to find out how far away from the line edge we are.\n      float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\n\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\n\n      coverageSampling \x3d vec4(\n        // Edge coordinate\n        outerEdgeCoverageSampler,\n\n        // Border edge coordinate\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n        // Line offset\n        halfPixelSize - 0.5,\n\n        // Border offset\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n      );\n\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\n\n      gl_Position \x3d projectedPosition;\n    }\n  "])),
b.occlusionTestEnabled?e.glsl(n||(n=l(["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"],["\n      if (!testVisibilityHUD(endPoint)) {\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }"]))):"",b.screenSizePerspectiveEnabled?e.glsl(c||(c=l(["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "],
["\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\n        "]))):e.glsl(g||(g=l(["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "],["\n      vec2 screenOffsetScaled \x3d screenOffset;\n        "]))),b.depthHudEnabled?b.depthHudAlignStartEnabled?e.glsl(r||(r=l(["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"],
["endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);"]))):e.glsl(p||(p=l(["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"],["startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"]))):"",b.screenSizePerspectiveEnabled?e.glsl(u||(u=l(["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "],
["\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\n        "]))):e.glsl(t||(t=l(["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "],["\n      float lineSizeScaled \x3d lineSize;\n      float borderSizeScaled \x3d borderSize;\n        "])))));k.fragment.uniforms.add("color","vec4");
k.fragment.uniforms.add("borderColor","vec4");k.fragment.code.add(e.glsl(m||(m=l(["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "],["\n    void main() {\n      // Mix between line and border coverage offsets depending on whether we need\n      // a border (based on the sidedness).\n      vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n      // Mix between border and line color based on the line coverage (conceptually the line\n      // blends on top of the border background).\n      //\n      // Anti-alias by blending final result using the full (including optional border) coverage\n      // and the color alpha\n      float borderAlpha \x3d color.a * borderColor.a * coverage.y;\n      float colorAlpha \x3d color.a * coverage.x;\n\n      float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\n\n    ",
"\n  }\n  "])),b.depthHudEnabled?e.glsl(v||(v=l(["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "],["\n      if (finalAlpha \x3c 0.01) {\n        discard;\n      }\n      "]))):e.glsl(y||(y=l(["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "],
["\n      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\n      // need to divide by finalAlpha). We avoid the division here by setting the\n      // appropriate blending function in the material.\n      vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\n      gl_FragColor \x3d vec4(finalRgb, finalAlpha);\n      "])))));return k};(function(a){a.bindUniforms=function(a,b,c){k(a,"color",b.color);c=c.pixelRatio||1;a.setUniform1f("pixelRatio",
c);a.setUniform2f("screenOffset",b.screenOffset[0]*c,b.screenOffset[1]*c);null!==b.borderColor?(k(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",c)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))}})(b.LineCallout||(b.LineCallout={}));var n,c,g,r,p,u,t,x,v,y,m})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});
b.getGraphics3DSymbol=function(b){return b instanceof f?b.graphics3DSymbol:b instanceof l?b:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./Loadable ./symbolComplexity".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){var p={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(b){function g(a,c,d){var e=b.call(this)||this;e._symbol=a;e._context=c;e._backgroundLayers=d;e._destroyed=!1;e.symbolLayers=[];e.referenced=0;return e}l(g,b);Object.defineProperty(g.prototype,"symbol",{get:function(){return this._symbol},set:function(a){this._symbol=a;if(this.symbolLayers)for(var b=0;b<a.symbolLayers.length;b++){var c=this.symbolLayers[b];e.isNone(c)||(c.symbol=a,c.symbolLayer=
a.symbolLayers.items[b])}},enumerable:!0,configurable:!0});g.prototype.doLoad=function(b){return h(this,void 0,void 0,function(){var g,k,m,n,r,t=this;return f(this,function(w){switch(w.label){case 0:g=this._symbol.symbolLayers;this._backgroundLayers&&(g=this._backgroundLayers.concat(g));for(k=g.length;this.symbolLayers.length<g.length;)this.symbolLayers.push(null);this.symbolLayers.length=g.length;m=function(a){var e=g.getItemAt(a);if(!1===e.enabled)return"continue";p.renderPriority=1-(1+a)/k;p.renderPriorityStep=
1/k;p.ignoreDrivers=e._ignoreDrivers;var f=c.make(n.symbol,e,n._context,p);d.onAbortOrThrow(b,function(){t.symbolLayers[a]=null;f.destroy()});n.symbolLayers[a]=f};n=this;for(r=0;r<k;r++)m(r);return[4,a.forEach(this.symbolLayers,function(a,b){return h(t,void 0,void 0,function(){return f(this,function(c){switch(c.label){case 0:if(!e.isSome(a))return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.load()];case 2:return c.sent(),[3,4];case 3:return c.sent(),this.symbolLayers[b]=null,[3,4];case 4:return[2]}})})})];
case 1:w.sent();if(this.symbolLayers.length&&!this.symbolLayers.some(function(a){return!!a}))throw Error();return[2]}})})};g.prototype.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return e.isSome(a)?a.getCachedSize():null};g.prototype.createGraphics3DGraphic=function(a,b){for(var c=a.graphic,d=Array(this.symbolLayers.length),g=0;g<this.symbolLayers.length;g++){var f=this.symbolLayers[g];d[g]=e.isSome(f)?f.createGraphics3DGraphic(a):null}return new k(c,b||this,d,a.layer,this._context.arcade||
this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};Object.defineProperty(g.prototype,"complexity",{get:function(){return r.totalSymbolComplexities(this.symbolLayers.map(function(a){return e.isSome(a)&&a.complexity}))},enumerable:!0,configurable:!0});g.prototype.globalPropertyChanged=function(a,b){for(var c=this.symbolLayers.length,d=function(c){var d=g.symbolLayers[c],k=function(a){a=a._graphics[c];
return a instanceof n?a:null};if(e.isSome(d)&&!d.globalPropertyChanged(a,b,k))return{value:!1}},g=this,k=0;k<c;k++){var f=d(k);if("object"===typeof f)return f.value}return!0};g.prototype.applyRendererDiff=function(a,b){return 1!==this.loadStatus?!1:this.symbolLayers.reduce(function(c,d){return c&&(e.isNone(d)||d.applyRendererDiff(a,b))},!0)};g.prototype.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var b=a.diff.diff;if(b.symbolLayers&&"partial"===b.symbolLayers.type){var c=
b.symbolLayers.diff;this.symbolLayers.forEach(function(b,d){var g;if(!e.isNone(b)){var k=c[d];if(k){var f={diff:k,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(f);(g=a.symbolStatePatches).push.apply(g,f.symbolLayerStatePatches);f.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,b){var c=a._graphics[d];e.isSome(c)&&f.graphics3DGraphicPatches.forEach(function(a){return a(c,b)})})}}})}}};g.prototype.updateGeometry=function(a,b){for(var c=
0;c<this.symbolLayers.length;c++){var d=this.symbolLayers[c];if(!e.isNone(d)){var g=a._graphics[c];if(e.isSome(g)&&!d.updateGeometry(g,b))return!1}}return!0};g.prototype.onRemoveGraphic=function(a){for(var b=0;b<this.symbolLayers.length;b++){var c=this.symbolLayers[b];if(!e.isNone(c)){var d=a._graphics[b];if(e.isSome(d))c.onRemoveGraphic(d)}}};g.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.symbolLayers.forEach(function(d){e.isNone(d)||(0===d.loadStatus?a++:d.isFastUpdatesEnabled()?
c++:b++)});return{loading:a,slow:b,fast:c}};g.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(var a=0,b=this.symbolLayers;a<b.length;a++){var c=b[a];e.isSome(c)&&c.destroy()}this.symbolLayers.length=0;this._destroyed=!0}};Object.defineProperty(g.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0});return g}(g.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){var y=new e(Array,function(a){return r.set(a,r.ZERO)},null,10,5),m=p.create();return function(){function b(b,c,d,e,g){this._labelGraphics=[];this._auxiliaryGraphics=[];for(var k=Array(2),f=0;f<k.length;f++)k[f]=Array(4);this._visibilityFlags=k;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this.extent=null;this.isElevationSource=!1;++c.referenced;this.graphics3DSymbol=c;this.graphic=b;this._graphics=d;this._featureExpressionFeature=
g?x.createFeature(g,b,e):null;b=0;for(c=this._graphics;b<c.length;b++)d=c[b],a.isSome(d)&&(this.isElevationSource=this.isElevationSource||d.isElevationSource)}b.prototype.initialize=function(a,b,c){var d=this;this._layer=b;this._stage=a;this.forEachSymbolLayerGraphic(function(e){e.initialize(a,b,c);e.setVisibility(d.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;
this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._stage,
this._layer),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.isVisible=function(a,b){void 0===a&&(a=0);for(var c=0;c<=a;c++)for(var d=this._visibilityFlags[c],e=0;e<d.length;++e)if(!1===d[e]&&e!==b)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,b){return null!=this._visibilityFlags[b][a]};b.prototype.setVisibilityFlag=function(a,b,c){var d=this.isVisible(c);this._visibilityFlags[c][a]=
b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var g=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(g)})}return!0};b.prototype.clearVisibilityFlag=function(a,b){void 0===b&&(b=0);return this.setVisibilityFlag(a,void 0,b)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});
return a};b.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=c.vec3f64.create());if(0===this._graphics.length)return n.vec3.set(b,0,0,0),b;var d=this._graphics[0];return a.isSome(d)?d.getCenterObjectSpace(b):b};b.prototype.computeExtent=function(b){if(!this.extent){this.extent=p.create();var c=this.graphic.geometry;if(a.isNone(c))return this.extent=null,!1;var d=c.spatialReference;u.computeAABR(c,this.extent);if(!d.equals(b)&&!v.boundingRectToBoundingRect(this.extent,d,this.extent,b))return this.extent=
null,!1}return!0};b.prototype.getAsOptimizedGeometry=function(a,b){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===a&&this._optimizedGeometry.hasM===b)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,a,b);this._optimizedGeometry.hasZ=a;this._optimizedGeometry.hasM=b;return this._optimizedGeometry.geometry};b.prototype._convertGraphicToOptimizedGeometry=function(a,b,c){a=a.geometry;if("mesh"===a.type||
"extent"===a.type)a=g.fromExtent("mesh"===a.type?a.extent:a);return t.convertFromGeometry(a,b,c)};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,b=u.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(function(c){var d=c.graphics3DSymbolLayer.complexity;c="draped"===c.type?d.memory.draped:d.memory;b+=c.bytesPerFeature;c.bytesPerCoordinate&&(b+=u.numVertices(a.graphic.geometry)*c.bytesPerCoordinate)});return b},enumerable:!0,configurable:!0});
b.prototype.computeAttachmentOrigin=function(){for(var b={render:{origin:c.vec3f64.create(),num:0},draped:{origin:k.vec2f64.create(),num:0}},e=0,g=this._graphics;e<g.length;e++){var f=g[e];a.isNone(f)||f.computeAttachmentOrigin(b)}b.render.num&&n.vec3.scale(b.render.origin,b.render.origin,1/b.render.num);b.draped.num&&d.vec2.scale(b.draped.origin,b.draped.origin,1/b.draped.num);return b};b.prototype.getProjectedBoundingBox=function(b,c,d,e,g){return f(this,void 0,void 0,function(){var k=this;return l(this,
function(n){switch(n.label){case 0:return g||(g={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),g.boundingBox?r.empty(g.boundingBox):g.boundingBox=r.empty(),g.requiresDrapedElevation=!1,[4,h.forEach(this._graphics,function(h){return f(k,void 0,void 0,function(){var k,f,m;return l(this,function(p){switch(p.label){case 0:if(a.isNone(h))return[2];k="draped"===h.type?c:b;f=y.acquire();return[4,h.getProjectedBoundingBox(k,d,g.screenSpaceObjects,e,f)];case 1:return m=p.sent(),isFinite(m[2])&&
isFinite(m[5])||(g.requiresDrapedElevation=!0),m&&r.expand(g.boundingBox,f),y.release(f),[2]}})})})];case 1:return n.sent(),r.allFinite(g.boundingBox)||p.allFinite(r.toRect(g.boundingBox,m))?[2,g]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var b=0,c=this._graphics;b<c.length;b++){var d=c[b];if(a.isSome(d)&&("object3d"===d.type||"lod-instance"===d.type)&&d.needsElevationUpdates)return!0}b=0;for(c=this._labelGraphics;b<c.length;b++)if((d=c[b])&&d.needsElevationUpdates)return!0;
return!1};b.prototype.alignWithElevation=function(a,b,c){var d=this;this.forEachRenderedGraphic(function(e){"object3d"!==e.type&&"lod-instance"!==e.type||e.alignWithElevation(a,b,d._featureExpressionFeature,c)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,
c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/layers/graphics/featureConversionUtils":function(){define("require exports ../../core/Error ../../core/Logger ../../geometry/support/jsonUtils ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b){return a?b?4:3:b?3:2}function n(a,b,c,d){if(a){if(c)return b&&d?W:N;if(b&&d)return Z}else if(b&&d)return N;return Y}function c(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function g(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function r(a,b){return b*a.scale[0]+a.translate[0]}function p(a,b){return a.translate[1]-b*a.scale[1]}function u(a){a=a.coords;return{x:a[0],y:a[1]}}function t(a,b){a.coords[0]=b.x;a.coords[1]=b.y;return a}function x(a){a=
a.coords;return{x:a[0],y:a[1],z:a[2]}}function v(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;return a}function y(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function m(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.m;return a}function w(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function A(a,b){a.coords[0]=b.x;a.coords[1]=b.y;a.coords[2]=b.z;a.coords[3]=b.m;return a}function B(a,b){return a&&b?A:a?v:b?m:t}function C(a,b,c){if(!a)return null;for(var d=k(b,c),e=[],g=0;g<a.coords.length;g+=
d){for(var f=[],h=0;h<d;h++)f.push(a.coords[g+h]);e.push(f)}return b?c?{points:e,hasZ:b,hasM:c}:{points:e,hasZ:b}:c?{points:e,hasM:c}:{points:e}}function E(a,b,c){void 0===c&&(c=k(b.hasZ,b.hasM));a.lengths[0]=b.points.length;var d=a.coords,e=0,g=0;for(b=b.points;g<b.length;g++)for(var f=b[g],h=0;h<c;h++)d[e++]=f[h];return a}function G(a,b,c){if(!a)return null;var d=k(b,c),e=a.coords,g=[],f=0,h=0;for(a=a.lengths;h<a.length;h++){for(var m=a[h],p=[],n=0;n<m;n++){for(var r=[],w=0;w<d;w++)r.push(e[f++]);
p.push(r)}g.push(p)}return b?c?{paths:g,hasZ:b,hasM:c}:{paths:g,hasZ:b}:c?{paths:g,hasM:c}:{paths:g}}function J(a,b,c){void 0===c&&(c=k(b.hasZ,b.hasM));var d=a.lengths,e=a.coords,g=0,f=0;for(b=b.paths;f<b.length;f++){for(var h=b[f],m=0,p=h;m<p.length;m++)for(var n=p[m],r=0;r<c;r++)e[g++]=n[r];d.push(h.length)}return a}function I(a,b,c){if(!a)return null;var d=k(b,c),e=a.coords,g=[],f=0,h=0;for(a=a.lengths;h<a.length;h++){for(var m=a[h],p=[],n=0;n<m;n++){for(var r=[],w=0;w<d;w++)r.push(e[f++]);p.push(r)}g.push(p)}return b?
c?{rings:g,hasZ:b,hasM:c}:{rings:g,hasZ:b}:c?{rings:g,hasM:c}:{rings:g}}function K(a,b,c,d){void 0===c&&(c=b.hasZ);void 0===d&&(d=b.hasM);H(a,b.rings,c,d);return a}function H(a,b,c,d){c=k(c,d);d=a.lengths;for(var e=a.coords,g=0,f=d.length=e.length=0;f<b.length;f++){for(var h=b[f],m=0,p=h;m<p.length;m++)for(var n=p[m],r=0;r<c;r++)e[g++]=n[r];d.push(h.length)}return a}function L(b,c,e,g,f,h){b.length=0;if(!e){for(g=0;g<c.length;g++)f=c[g],b.push(new a.default(null,f.attributes,null,f.attributes[h]));
return b}switch(e){case "esriGeometryPoint":g=B(g,f);for(f=0;f<c.length;f++){var m=c[f];e=m.geometry;var m=m.attributes,p=void 0;e&&(p=g(new d.default,e));b.push(new a.default(p,m,null,m[h]))}break;case "esriGeometryMultipoint":g=k(g,f);for(f=0;f<c.length;f++)m=c[f],e=m.geometry,m=m.attributes,p=void 0,e&&(p=E(new d.default,e,g)),b.push(new a.default(p,m,null,m[h]));break;case "esriGeometryPolyline":g=k(g,f);for(f=0;f<c.length;f++)m=c[f],e=m.geometry,m=m.attributes,p=void 0,e&&(p=J(new d.default,
e,g)),b.push(new a.default(p,m,null,m[h]));break;case "esriGeometryPolygon":for(e=0;e<c.length;e++){var n=c[e],m=n.geometry,p=n.centroid,n=n.attributes,r=void 0;m&&(r=K(new d.default,m,g,f));p?b.push(new a.default(r,n,t(new d.default,p),n[h])):b.push(new a.default(r,n,null,n[h]))}break;default:Q.error("convertToFeatureSet:unknown-geometry",new l("Unable to parse unknown geometry type '"+e+"'")),b.length=0}return b}function P(a,b,c,d,e){a.length=0;switch(c){case "esriGeometryPoint":c=u;d&&e?c=w:d?
c=x:e&&(c=y);for(d=0;d<b.length;d++){var g=b[d];e=g.geometry;g=g.attributes;e=e?c(e):null;a.push({attributes:g,geometry:e})}break;case "esriGeometryMultipoint":for(c=0;c<b.length;c++){var k=b[c],g=k.geometry,k=k.attributes,f=void 0;g&&(f=C(g,d,e));a.push({attributes:k,geometry:f})}break;case "esriGeometryPolyline":for(c=0;c<b.length;c++)k=b[c],g=k.geometry,k=k.attributes,f=void 0,g&&(f=G(g,d,e)),a.push({attributes:k,geometry:f});break;case "esriGeometryPolygon":for(c=0;c<b.length;c++){var f=b[c],
k=f.geometry,g=f.attributes,h=f.centroid,f=void 0;k&&(f=I(k,d,e));h?(k=u(h),a.push({attributes:g,centroid:k,geometry:f})):a.push({attributes:g,geometry:f})}break;default:Q.error("convertToFeatureSet:unknown-geometry",new l("Unable to parse unknown geometry type '"+c+"'"))}return a}function S(a,b,d,e,f,h,m,p){void 0===m&&(m=d);void 0===p&&(p=e);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;f=T[f];var r=b.coords;b=b.lengths;var w=k(d,
e),t=k(d&&m,e&&p);d=n(d,e,m,p);if(!b.length)return d(a.coords,r,0,0,c(h,r[0]),g(h,r[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=w,a;for(var v,l=0,x,u=0,A=0;A<b.length;A++){var y=b[A];if(!(y<f)){var B=0;x=u;p=e=c(h,r[l]);v=m=g(h,r[l+1]);d(a.coords,r,x,l,p,v);B++;l+=w;x+=t;for(var C=1;C<y;C++,l+=w)if(p=c(h,r[l]),v=g(h,r[l+1]),p!==e||v!==m)d(a.coords,r,x,l,p-e,v-m),x+=t,B++,e=p,m=v;B>=f&&(a.lengths.push(B),u=x)}}a.coords.length=u;return a.coords.length?a:null}function R(a,b,c,d,e,g,k){for(var f=
d,h=0,m,p=g+c;p<k;p+=c){m=b[p];var n=b[p+1],r=b[k],w=b[k+1],t=b[g],v=b[g+1],l=r-t,x=w-v;if(0!==l||0!==x){var u=((m-t)*l+(n-v)*x)/(l*l+x*x);1<u?(t=r,v=w):0<u&&(t+=l*u,v+=x*u)}l=m-t;x=n-v;m=l*l+x*x;m>f&&(h=p,f=m)}f>d&&(h-g>c&&R(a,b,c,d,e,g,h),e(a,b,a.length,h,b[h],b[h+1]),k-h>c&&R(a,b,c,d,e,h,k))}function O(a,b,c,d,e){var g=b.coords,f=b.lengths,h=c?d?W:N:d?N:Y;c=k(c,d);if(!g.length)return a!==b&&(a.lengths.length=0,a.coords.length=0),a;if(!f.length)return h(a.coords,g,0,0,r(e,g[0]),p(e,g[1])),a!==b&&
(a.lengths.length=0,a.coords.length=c),a;var m=e.scale;d=m[0];for(var m=m[1],n=0,w=0;w<f.length;w++){var t=f[w];a.lengths[w]=t;var v=r(e,g[n]),l=p(e,g[n+1]);h(a.coords,g,n,n,v,l);for(var n=n+c,x=1;x<t;x++,n+=c)v+=g[n]*d,l-=g[n+1]*m,h(a.coords,g,n,n,v,l)}a!==b&&(a.lengths.length=f.length,a.coords.length=g.length);return a}Object.defineProperty(b,"__esModule",{value:!0});var Q=f.getLogger("esri.tasks.support.optimizedFeatureSet"),T={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},
Y=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g},N=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g;a[c+2]=b[d+2]},Z=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g;a[c+2]=b[d+3]},W=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g;a[c+2]=b[d+2];a[c+3]=b[d+3]};b.quantizeX=c;b.quantizeY=g;b.hydrateX=r;b.hydrateY=p;b.convertToPoint=function(a,b,c){return a?b?c?w(a):x(a):c?y(a):u(a):null};b.convertFromPoint=function(a,b,c){void 0===c&&(c=B(null!=b.z,null!=b.m));return c(a,b)};b.convertToMultipoint=C;b.convertFromMultipoint=E;b.convertToPolyline=
G;b.convertFromPolyline=J;b.convertToPolygon=I;b.convertFromPolygon=K;b.convertFromNestedArray=H;var aa=[],V=[];b.convertFromFeature=function(a,b,c,d,e){aa[0]=a;a=L(V,aa,b,c,d,e)[0];aa.length=V.length=0;return a};b.convertFromFeatures=L;b.convertToFeature=function(a,b,c,d){V[0]=a;P(aa,V,b,c,d);a=aa[0];aa.length=V.length=0;return a};b.convertFromGeometry=function(a,b,c){if(!a)return null;var e=new d.default;"hasZ"in a&&null==b&&(b=a.hasZ);"hasM"in a&&null==c&&(c=a.hasM);if(h.isPoint(a))return B(null!=
b?b:null!=a.z,null!=c?c:null!=a.m)(e,a);if(h.isPolygon(a))return K(e,a,b,c);if(h.isPolyline(a))return J(e,a,k(b,c));if(h.isMultipoint(a))return E(e,a,k(b,c));Q.error("convertFromGeometry:unknown-geometry",new l("Unable to parse unknown geometry type '"+a+"'"))};b.convertToGeometry=function(a,b,c,d){a=a&&("coords"in a?a:a.geometry);if(!a)return null;switch(b){case "esriGeometryPoint":return b=u,c&&d?b=w:c?b=x:d&&(b=y),b(a);case "esriGeometryMultipoint":return C(a,c,d);case "esriGeometryPolyline":return G(a,
c,d);case "esriGeometryPolygon":return I(a,c,d);default:Q.error("convertToGeometry:unknown-geometry",new l("Unable to parse unknown geometry type '"+b+"'"))}};b.convertToFeatures=P;b.convertToFeatureSet=function(a){var b=a.objectIdFieldName,c=a.spatialReference,d=a.transform,e=a.fields,g=a.hasM,k=a.hasZ,f=a.geometryType,h=a.exceededTransferLimit;a={features:P([],a.features,f,k,g),fields:e,geometryType:f,objectIdFieldName:b,spatialReference:c};d&&(a.transform=d);h&&(a.exceededTransferLimit=h);g&&(a.hasM=
g);k&&(a.hasZ=k);return a};b.convertFromFeatureSet=function(a,b){var c=new e.default,d=a.hasM,g=a.hasZ,k=a.features,f=a.objectIdFieldName,h=a.spatialReference,m=a.geometryType,p=a.exceededTransferLimit,n=a.transform;c.fields=a.fields;c.geometryType=m;c.objectIdFieldName=f||b;c.spatialReference=h;if(!c.objectIdFieldName)return Q.error(new l("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),c;k&&L(c.features,k,m,g,d,c.objectIdFieldName);p&&(c.exceededTransferLimit=p);d&&
(c.hasM=d);g&&(c.hasZ=g);n&&(c.transform=n);return c};b.hydrateOptimizedFeatureSet=function(a){var b=a.transform,c=a.hasM,d=a.hasZ;if(!b)return a;for(var e=0,g=a.features;e<g.length;e++){var k=g[e];k.geometry&&O(k.geometry,k.geometry,c,d,b);k.centroid&&O(k.centroid,k.centroid,c,d,b)}a.transform=null;return a};b.quantizeOptimizedFeatureSet=function(b,c){var e=c.geometryType,g=c.features,k=c.hasM,f=c.hasZ;if(!b)return c;for(var h=0;h<g.length;h++){var m=g[h],p=new a.default(new d.default,m.attributes);
S(p.geometry,m.geometry,k,f,e,b);m.centroid&&(p.centroid=new d.default,S(p.centroid,m.centroid,k,f,"esriGeometryPoint",b));g[h]=p}c.transform=b;return c};b.quantizeOptimizedGeometry=S;b.generalizeOptimizedGeometry=function(a,b,c,d,e,g,f,h){void 0===f&&(f=c);void 0===h&&(h=d);a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;e=T[e];var m=b.coords;b=b.lengths;var p=k(c,d),r=k(c&&f,d&&h);c=n(c,d,f,h);if(!b.length)return c(a.coords,m,0,0,m[0],
m[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=p,a;d=0;g*=g;for(f=0;f<b.length;f++){h=b[f];if(!(h<e)){var w=a.coords.length/r,t=d,v=d+(h-1)*p;c(a.coords,m,a.coords.length,t,m[t],m[t+1]);R(a.coords,m,p,g,c,t,v);c(a.coords,m,a.coords.length,v,m[v],m[v+1]);t=a.coords.length/r-w;t>=e?a.lengths.push(t):a.coords.length=w*r}d+=h*p}return a.coords.length?a:null};b.getBoundsOptimizedGeometry=function(a,b,c,d){c=k(c,d);var e=d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;
if(b&&b.coords){b=b.coords;for(var h=0;h<b.length;h+=c){var m=b[h],p=b[h+1];d=Math.min(d,m);g=Math.max(g,m);e=Math.min(e,p);f=Math.max(f,p)}}a[0]=d;a[1]=e;a[2]=g;a[3]=f;return a};b.getQuantizedBoundsOptimizedGeometry=function(a,b,c,d){c=k(c,d);d=b.coords;var e=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,m=0,p=0;for(b=b.lengths;p<b.length;p++)for(var n=b[p],r=d[m],w=d[m+1],e=Math.min(r,e),g=Math.min(w,g),f=Math.max(r,f),h=Math.max(w,h),
m=m+c,t=1;t<n;t++,m+=c){var v=d[m],l=d[m+1],r=r+v,w=w+l;0>v&&(e=Math.min(e,r));0<v&&(f=Math.max(f,r));0>l?g=Math.min(g,w):0<l&&(h=Math.max(h,w))}a[0]=e;a[1]=g;a[2]=f;a[3]=h;return a};b.hydrateOptimizedGeometry=O;b.removeZMValues=function(a,b,c,d,e,g){var f,h=k(c,d);c=n(c,d,e,g);d=b.coords;a.coords.length=0;a.lengths.length=0;(f=a.lengths).push.apply(f,b.lengths);for(b=0;b<d.length;b+=h)c(a.coords,d,a.coords.length,b,d[b],d[b+1]);return a};b.removeCollinearVectices=function(a,b,c,d,e){if(!b||!b.coords||
!b.coords.length)return null;c=T[c];var g=b.coords;b=b.lengths;var f=n(d,e,d,e);d=k(d,e);for(var h=e=0,m=0,p=0,r=0;r<b.length;r++){var w=b[r],h=p;f(a.coords,g,h,e,g[e],g[e+1]);e+=d;var t=g[e],v=g[e+1],l=t,x=v,u=v/t,h=h+d;f(a.coords,g,h,e,l,x);e+=d;for(var A=2;A<w;A++){var t=g[e],v=g[e+1],y=v/t,B=u===y||!isFinite(u)&&!isFinite(y),u=B&&isFinite(y)?0<=u&&0<=y||0>=u&&0>=y:0<=x&&0<=v||0>=x&&0>=v;B&&u?(l+=t,x+=v):(l=t,x=v,h+=d);f(a.coords,g,h,e,l,x);e+=d;u=y}h+=d;w=(h-p)/d;w>=c&&(a.lengths[m]=w,p=h,m++)}a.coords.length>
h&&(a.coords.length=h);a.lengths.length>m&&(a.lengths.length=m);return a.coords.length?a:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),function(q,
b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});var r=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");b.make=function(a,b,c,d){var e=u[a.type]&&u[a.type][b.type]||p[b.type];return e?new e(a,b,c,d):(r.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var p={icon:h.default,object:d.default,line:a.default,path:k.default,fill:n.default,extrude:f.default,text:c.default,water:g.default};b.setSymbolClass=function(a,b){p[a]=b};var u=
{"mesh-3d":{fill:e.default}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/renderingInfoUtils ./elevationAlignmentUtils ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./polygonUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R){function O(a,b,c,d,e,g,k,f,h,m,n,r,w,t){var v=c.length/3,l=0;n+=2*d.count;var x=d.index,u=d.count,A=h,y=n;p.vec3.copy(ea,w);var B=0<r?1:-1,x=3*x,C=A;w=3*C;for(var E=A+u,A=3*E,G=0;G<u;++G)t&&(ea[0]=a[x+0],ea[1]=a[x+1],ea[2]=a[x+2],p.vec3.normalize(ea,ea)),e[w+0]=a[x+0],e[w+1]=a[x+1],e[w+2]=a[x+2],g[w+0]=b[x+0],g[w+1]=b[x+1],g[w+2]=b[x+2],k[w+0]=-B*ea[0],k[w+1]=-B*ea[1],k[w+2]=-B*ea[2],f[C]=0,e[A+0]=a[x+0]+r*ea[0],e[A+1]=
a[x+1]+r*ea[1],e[A+2]=a[x+2]+r*ea[2],g[A+0]=b[x+0],g[A+1]=b[x+1],g[A+2]=b[x+2],k[A+0]=B*ea[0],k[A+1]=B*ea[1],k[A+2]=B*ea[2],f[E]=r,w+=3,A+=3,x+=3,C+=1,E+=1;x=0;w=3*y;A=3*(y+v);w=3*(y+v);A=3*y;a=ha;b=ka;0>r&&(a=ka,b=ha);for(G=0;G<v;++G)m[w+0]=c[x+a[0]],m[w+1]=c[x+a[1]],m[w+2]=c[x+a[2]],m[A+0]=c[x+b[0]]+u,m[A+1]=c[x+b[1]]+u,m[A+2]=c[x+b[2]]+u,w+=3,A+=3,x+=3;h+=2*d.count;n=n+2*v-(2*d.count+2*v);T(e,g,f,k,l,d.pathLengths[0],d.count,h,m,n,r);h+=4*d.pathLengths[0];n+=2*d.pathLengths[0];l+=d.pathLengths[0];
for(c=1;c<d.pathLengths.length;++c)T(e,g,f,k,l,d.pathLengths[c],d.count,h,m,n,r),h+=4*d.pathLengths[c],n+=2*d.pathLengths[c],l+=d.pathLengths[c]}function Q(a,b,c,d,e,g,k){d[g]=d[k];k*=3;g*=3;a[g+0]=a[k+0];a[g+1]=a[k+1];a[g+2]=a[k+2];b[g+0]=b[k+0];b[g+1]=b[k+1];b[g+2]=b[k+2];c[g+0]=e[0];c[g+1]=e[1];c[g+2]=e[2]}function T(a,b,c,d,e,g,k,f,h,m,n){var r=e,w=e+1,t=e+k,v=e+k+1,l=f,x=f+1,u=f+2*g;f=f+2*g+1;0>n&&(r=e+k+1,v=e);m*=3;for(var A=0;A<g;++A){A===g-1&&(0<n?(w=e,v=e+k):(w=e,r=e+k));var y=a,B=r,C=w,
E=t,G=N,B=3*B,C=3*C,E=3*E;p.vec3.set(Z,y[B++],y[B++],y[B++]);p.vec3.set(W,y[C++],y[C++],y[C++]);p.vec3.set(aa,y[E++],y[E++],y[E++]);p.vec3.subtract(V,W,Z);p.vec3.subtract(F,aa,Z);p.vec3.cross(G,F,V);p.vec3.normalize(G,G);Q(a,b,d,c,N,l,r);Q(a,b,d,c,N,x,w);Q(a,b,d,c,N,u,t);Q(a,b,d,c,N,f,v);h[m++]=l;h[m++]=u;h[m++]=f;h[m++]=l;h[m++]=f;h[m++]=x;r++;w++;t++;v++;l+=2;x+=2;u+=2;f+=2}}function Y(a,b,c,d){a=a.stageObject;ba.spatialReference=c.spatialReference;for(var e=a.geometryRecords,k=e.length,f="absolute-height"!==
b.mode,h=0,m=a.objectTransformation,n=g.mat4.invert(r.mat4f64.create(),m),w=0;w<k;w++){var t=e[w].geometry;t.invalidateBoundingInfo();for(var v=t.data.getVertexAttr(),t=v[P.VertexAttrConstants.POSITION].data,l=v[P.VertexAttrConstants.SIZE].data,v=v.mapPos.data,x=t.length/3,u=0,A=0,B=!1,C=0,E=0;E<x;E++){ba.x=v[A];ba.y=v[A+1];ba.z=v[A+2];ca[0]=t[u];ca[1]=t[u+1];ca[2]=t[u+2];var G=y.evaluateElevationAlignmentAtPoint(ba,c,b,d,f?qa:null);f&&(C+=qa.sampledElevation);p.vec3.set(U,t[u+0],t[u+1],t[u+2]);p.vec3.transformMat4(U,
U,m);d.setAltitude(G+l[u/3],U);p.vec3.transformMat4(U,U,n);t[u]=U[0];t[u+1]=U[1];t[u+2]=U[2];G=.01/d.unitInMeters;if(Math.abs(ca[0]-t[u])>G||Math.abs(ca[1]-t[u+1])>G||Math.abs(ca[2]-t[u+2])>G)B=!0;A+=3;u+=3}B&&a.geometryVertexAttrsUpdated(w);h+=C/x}return h/k}Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function p(a,c,d,e){return b.call(this,a,c,d,e)||this}l(p,b);p.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b,c,g,k,h,m;return f(this,function(f){if(!this._drivenProperties.size&&
(b=B.validateSymbolLayerSize(this._getSymbolSize())))throw new e("graphics3dextrudesymbollayer:invalid-size",b);c=d.get(this.symbolLayer,"material","color");g=this._getCombinedOpacityAndColor(c);k=u.vec3f64.fromArray(g);h=g[3];m={diffuse:k,ambient:k,opacity:h,transparent:1>h||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows};this._material=new S(a({},R.getDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),
m,{offsetTransparentBackfaces:!0}),this._getIdHint("_3dlinemat"));this._context.stage.add(3,this._material);return[2]})})};p.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&this._context.stage.remove(3,this._material.id)};p.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,p.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this._getVertexOpacityAndColor(a.renderingInfo,
Float32Array,255),e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,e,c,b.uid)};p.prototype.layerOpacityChanged=function(a,b){var c=this,e=d.get(this.symbolLayer,"material","color"),e=this._getCombinedOpacity(e);this._material.setParameterValues({opacity:e,transparent:1>e||this.needsDrivenTransparentPass});var g=this._getLayerOpacity();a.forEach(function(a){a=b(a);d.isSome(a)&&a.layerOpacityChanged(g,c._context.isAsync)});return!0};p.prototype.layerElevationInfoChanged=
function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,m.needsElevationUpdates3D)};p.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.forEach(function(a){a=b(a);d.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};p.prototype.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled});
return!0};p.prototype.pixelRatioChanged=function(){return!0};p.prototype._getExtrusionSize=function(a){a=a.size&&this._drivenProperties.size?v.getDriverAxisSizeValue(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};p.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};p.prototype._createAs3DShape=function(a,b,e,f,h,p){var v=C.geometryAsPolygon(a.geometry);if(d.isNone(v))return null;a=[];var l=[],x=[],A=t.create(),y="global"===this._context.renderCoordsHelper.type,
E=this._getExtrusionSize(b),H=u.vec3f64.create();y||this._context.renderCoordsHelper.worldUpAtPosition(null,H);b=C.geometryToRenderInfo(v,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(b,v.rings,"rings","ExtrudeSymbol3DLayer");if(0===v.rings.length||!v.rings.some(function(a){return 0<a.length}))return null;var R=B.computeCentroid(v);if(d.isNone(R))return null;var P=r.mat4f64.create();G.computeLinearTransformation(v.spatialReference,[R.x,R.y,0],
P,this._context.renderCoordsHelper.spatialReference);v=r.mat4f64.create();g.mat4.invert(v,P);R=c.mat3f64.create();n.mat3.normalFromMat4(R,v);for(var q=b.polygons,Q=b.mapPosition,S=b.position,N=S.length/3,U=new Float64Array(18*N),T=new Float64Array(18*N),F=new Float64Array(18*N),N=new Float64Array(6*N),qa=0,W=0;W<q.length;++W){var aa=q[W],V=aa.count;if(this._context.clippingExtent&&(t.empty(A),t.expandWithBuffer(A,aa.mapPosition),!t.intersectsClippingArea(A,this._context.clippingExtent)))continue;
var Z=k(aa.mapPosition,aa.holeIndices,3);if(0!==Z.length){var ja=new Uint32Array(6*V+2*Z.length),ca=6*V,ba=3*U.BYTES_PER_ELEMENT,ba=new J.BufferViewVec3f64(U.buffer,qa*ba,ba,(qa+ca)*ba),ea=3*T.BYTES_PER_ELEMENT,ea=new J.BufferViewVec3f64(T.buffer,qa*ea,ea,(qa+ca)*ea),ka=new Float64Array(F.buffer,3*qa*F.BYTES_PER_ELEMENT,3*ca),ca=new Float64Array(N.buffer,1*qa*N.BYTES_PER_ELEMENT,1*ca);O(S,Q,Z,aa,ba.typedBuffer,ka,ea.typedBuffer,ca,0,ja,0,E,H,y);I.transformMat4(ba,ba,v);I.transformMat3(ea,ea,R);qa+=
6*V;aa=this._createExtrudeGeometry(ja,{positions:ba.typedBuffer,elevation:ka,normals:ea.typedBuffer,heights:ca},e);aa=new K(aa,h+"path"+W);a.push(aa);l.push(this._material);x.push(r.mat4f64.IDENTITY)}}if(0===a.length)return null;e=new L({geometries:a,materials:l,transformations:x,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:p,isElevationSource:!0},idHint:h});e.objectTransformation=P;h=this._createEdgeMaterial();h=d.isSome(h)?{baseMaterial:this._material,edgeMaterials:[h],slicePlaneEnabled:this._context.slicePlaneEnabled}:
null;a=new w(this,e,a,null,null,Y,f,h);a.alignedSampledElevation=b.sampledElevation;a.needsElevationUpdates=m.needsElevationUpdates3D(f.mode);return a};p.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),g=0;g<d;g++)e[g]=0;d={};g={};d[P.VertexAttrConstants.POSITION]=a;d[P.VertexAttrConstants.NORMAL]=a;d[P.VertexAttrConstants.COLOR]=e;g[P.VertexAttrConstants.POSITION]={size:3,data:b.positions};g[P.VertexAttrConstants.NORMAL]={size:3,data:b.normals};g[P.VertexAttrConstants.COLOR]=
{size:4,data:c};g[P.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(g.mapPos={size:3,data:b.elevation},d.mapPos=a);return new H.GeometryData(g,d)};p.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return E.createMaterial(this.symbolLayer,a)};p.validGeometryTypes=["polygon","extent"];return p}(A.default);b.Graphics3DExtrudeSymbolLayer=q;var N=u.vec3f64.create(),Z=u.vec3f64.create(),W=u.vec3f64.create(),aa=u.vec3f64.create(),V=u.vec3f64.create(),F=u.vec3f64.create(),
ca=u.vec3f64.create(),U=u.vec3f64.create(),ea=u.vec3f64.create(),ha=[0,2,1],ka=[0,1,2],ba=x.makeDehydratedPoint(0,0,0,null),qa={verticalDistanceToGround:0,sampledElevation:0};b.default=q})},"esri/core/libs/earcut/earcut":function(){define([],function(){function q(c,d,g){g=g||2;var h=d&&d.length,m=h?d[0]*g:c.length,p=b(c,0,m,g,!0),n=[];if(!p||p.next===p.prev)return n;var r,w,t,v;if(h){var x=g,h=[],A,y,R;v=0;for(A=d.length;v<A;v++)y=d[v]*x,R=v<A-1?d[v+1]*x:c.length,y=b(c,y,R,x,!1),y===y.next&&(y.steiner=
!0),h.push(k(y));h.sort(a);for(v=0;v<h.length;v++){d=h[v];x=p;if(x=e(d,x))d=u(x,d),l(d,d.next);p=l(p,p.next)}}if(c.length>80*g){r=t=c[0];w=h=c[1];for(x=g;x<m;x+=g)v=c[x],d=c[x+1],v<r&&(r=v),d<w&&(w=d),v>t&&(t=v),d>h&&(h=d);t=Math.max(t-r,h-w);t=0!==t?1/t:0}f(p,n,g,r,w,t);return n}function b(a,b,c,d,e){var k;if(e===0<y(a,b,c,d))for(e=b;e<c;e+=d)k=t(e,a[e],a[e+1],k);else for(e=c-d;e>=b;e-=d)k=t(e,a[e],a[e+1],k);k&&g(k,k.next)&&(x(k),k=k.next);return k}function l(a,b){if(!a)return a;b||(b=a);var d;do if(d=
!1,a.steiner||!g(a,a.next)&&0!==c(a.prev,a,a.next))a=a.next;else{x(a);a=b=a.prev;if(a===a.next)break;d=!0}while(d||a!==b);return b}function f(a,b,e,k,t,v,y){if(a){if(!y&&v){var m=a,w=m;do null===w.z&&(w.z=d(w.x,w.y,k,t,v)),w.prevZ=w.prev,w=w.nextZ=w.next;while(w!==m);w.prevZ.nextZ=null;w.prevZ=null;var m=w,A,B,C,E,G,R,O=1;do{w=m;C=m=null;for(E=0;w;){E++;B=w;for(A=G=0;A<O&&(G++,B=B.nextZ,B);A++);for(R=O;0<G||0<R&&B;)0!==G&&(0===R||!B||w.z<=B.z)?(A=w,w=w.nextZ,G--):(A=B,B=B.nextZ,R--),C?C.nextZ=A:m=
A,A.prevZ=C,C=A;w=B}C.nextZ=null;O*=2}while(1<E)}for(m=a;a.prev!==a.next;){w=a.prev;B=a.next;if(v)C=h(a,k,t,v);else a:if(C=a,E=C.prev,G=C,O=C.next,0<=c(E,G,O))C=!1;else{R=A=C.next.next;for(var q=0;A!==C.prev&&(0===q||A!==R);){q++;if(n(E.x,E.y,G.x,G.y,O.x,O.y,A.x,A.y)&&0<=c(A.prev,A,A.next)){C=!1;break a}A=A.next}C=!0}if(C)b.push(w.i/e),b.push(a.i/e),b.push(B.i/e),x(a),m=a=B.next;else if(a=B,a===m){if(!y)f(l(a),b,e,k,t,v,1);else if(1===y){y=b;m=e;w=a;do B=w.prev,C=w.next.next,!g(B,C)&&r(B,w,w.next,
C)&&p(B,C)&&p(C,B)&&(y.push(B.i/m),y.push(w.i/m),y.push(C.i/m),x(w),x(w.next),w=a=C),w=w.next;while(w!==a);a=w;f(a,b,e,k,t,v,2)}else if(2===y)a:{y=a;do{for(m=y.next.next;m!==y.prev;){if(w=y.i!==m.i){w=y;B=m;C=void 0;if(C=w.next.i!==B.i&&w.prev.i!==B.i){C=void 0;b:{C=w;do{if(C.i!==w.i&&C.next.i!==w.i&&C.i!==B.i&&C.next.i!==B.i&&r(C,C.next,w,B)){C=!0;break b}C=C.next}while(C!==w);C=!1}C=!C}E=void 0;if(E=C&&p(w,B)&&p(B,w)){C=w;E=!1;G=(w.x+B.x)/2;B=(w.y+B.y)/2;do C.y>B!==C.next.y>B&&C.next.y!==C.y&&G<
(C.next.x-C.x)*(B-C.y)/(C.next.y-C.y)+C.x&&(E=!E),C=C.next;while(C!==w)}w=E}if(w){a=u(y,m);y=l(y,y.next);a=l(a,a.next);f(y,b,e,k,t,v);f(a,b,e,k,t,v);break a}m=m.next}y=y.next}while(y!==a)}break}}}}function h(a,b,e,g){var k=a.prev,f=a.next;if(0<=c(k,a,f))return!1;var h=k.x>a.x?k.x>f.x?k.x:f.x:a.x>f.x?a.x:f.x,m=k.y>a.y?k.y>f.y?k.y:f.y:a.y>f.y?a.y:f.y,p=d(k.x<a.x?k.x<f.x?k.x:f.x:a.x<f.x?a.x:f.x,k.y<a.y?k.y<f.y?k.y:f.y:a.y<f.y?a.y:f.y,b,e,g);b=d(h,m,b,e,g);e=a.prevZ;for(g=a.nextZ;e&&e.z>=p&&g&&g.z<=b;){if(e!==
a.prev&&e!==a.next&&n(k.x,k.y,a.x,a.y,f.x,f.y,e.x,e.y)&&0<=c(e.prev,e,e.next))return!1;e=e.prevZ;if(g!==a.prev&&g!==a.next&&n(k.x,k.y,a.x,a.y,f.x,f.y,g.x,g.y)&&0<=c(g.prev,g,g.next))return!1;g=g.nextZ}for(;e&&e.z>=p;){if(e!==a.prev&&e!==a.next&&n(k.x,k.y,a.x,a.y,f.x,f.y,e.x,e.y)&&0<=c(e.prev,e,e.next))return!1;e=e.prevZ}for(;g&&g.z<=b;){if(g!==a.prev&&g!==a.next&&n(k.x,k.y,a.x,a.y,f.x,f.y,g.x,g.y)&&0<=c(g.prev,g,g.next))return!1;g=g.nextZ}return!0}function a(a,b){return a.x-b.x}function e(a,b){var c=
b,d=a.x,e=a.y,g=-Infinity,k;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var f=c.x+(e-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(f<=d&&f>g){g=f;if(f===d){if(e===c.y)return c;if(e===c.next.y)return c.next}k=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!k)return null;if(d===g)return k.prev;b=k;for(var f=k.x,h=k.y,m=Infinity,r,c=k.next;c!==b;)d>=c.x&&c.x>=f&&d!==c.x&&n(e<h?d:g,e,f,h,e<h?g:d,e,c.x,c.y)&&(r=Math.abs(e-c.y)/(d-c.x),(r<m||r===m&&c.x>k.x)&&p(c,a)&&(k=c,m=r)),c=c.next;return k}function d(a,b,
c,d,e){a=32767*(a-c)*e;b=32767*(b-d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function k(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function n(a,b,c,d,e,g,k,f){return 0<=(e-k)*(b-f)-(a-k)*(g-f)&&0<=(a-k)*(d-f)-(c-k)*(b-f)&&0<=(c-k)*(g-f)-(e-k)*(d-f)}function c(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function g(a,
b){return a.x===b.x&&a.y===b.y}function r(a,b,d,e){return g(a,b)&&g(d,e)||g(a,e)&&g(d,b)?!0:0<c(a,b,d)!==0<c(a,b,e)&&0<c(d,e,a)!==0<c(d,e,b)}function p(a,b){return 0>c(a.prev,a,a.next)?0<=c(a,b,a.next)&&0<=c(a,a.prev,b):0>c(a,b,a.prev)||0>c(a,a.next,b)}function u(a,b){var c=new v(a.i,a.x,a.y),d=new v(b.i,b.x,b.y),e=a.next,g=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;g.next=d;d.prev=g;return d}function t(a,b,c,d){a=new v(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=
a,a.next=a);return a}function x(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function v(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(a,b,c,d){for(var e=0,g=c-d;b<c;b+=d)e+=(a[g]-a[b])*(a[b+1]+a[g+1]),g=b;return e}q.deviation=function(a,b,c,d){var e=b&&b.length,g=Math.abs(y(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,k=b.length;e<k;e++)g-=Math.abs(y(a,b[e]*c,e<k-1?b[e+
1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var k=d[e]*c,f=d[e+1]*c,h=d[e+2]*c;b+=Math.abs((a[k]-a[h])*(a[f+1]-a[k+1])-(a[k]-a[f])*(a[h+1]-a[k+1]))}return 0===g&&0===b?0:Math.abs((b-g)/g)};q.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var g=0;g<a[e].length;g++)for(var k=0;k<b;k++)c.vertices.push(a[e][g][k]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return q})},"esri/renderers/support/renderingInfoUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Color ../../core/maybe ../visualVariables/support/visualVariableUtils".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b){if(!a||a.symbol)return null;b=b&&b.renderer;return a&&e.isSome(b)&&b.getObservationRenderer?b.getObservationRenderer(a):b}function n(a,b){if(e.isSome(a.symbol))return a.symbol;var c=k(a,b);return e.isSome(c)?c.getSymbol(a,b):null}function c(a,b){return h(this,void 0,void 0,function(){var c;return f(this,function(d){if(e.isSome(a.symbol))return[2,a.symbol];c=k(a,b);return[2,e.isSome(c)&&c.getSymbolAsync(a,l({},b,{abortOptions:{signal:b.signal}}))]})})}Object.defineProperty(b,
"__esModule",{value:!0});b.getRenderer=k;b.getSymbol=n;b.getRenderingInfo=function(a,b){var c=k(a,b),g=n(a,b);if(!g)return null;g={renderer:c,symbol:g};if(e.isNone(c)||!("visualVariables"in c)||!c.visualVariables)return g;var f=["proportional","proportional","proportional"],h=0;for(a=d.getVisualVariableValues(c,a,b);h<a.length;h++)switch(c=a[h],b=c.variable,c=c.value,b.type){case "color":g.color=c.toRgba();break;case "size":if("outline"===b.target)g.outlineSize=c;else switch(c=b.useSymbolValue?"symbolValue":
c,b.axis){case "width":f[0]=c;break;case "depth":f[1]=c;break;case "height":f[2]=c;break;case "width-and-depth":f[0]=f[1]=c;break;default:f[0]=f[1]=f[2]=c}break;case "opacity":g.opacity=c;break;case "rotation":switch(b.axis){case "tilt":g.tilt=c;break;case "roll":g.roll=c;break;default:g.heading=c}}if(isFinite(f[0])||isFinite(f[1])||isFinite(f[2]))g.size=f;return g};b.getSymbolAsync=c;b.getRenderingInfoAsync=function(b,e){return h(this,void 0,void 0,function(){var g,h,n,r,v,l,m,w,A,B,C,E;return f(this,
function(f){switch(f.label){case 0:return g=k(b,e),[4,c(b,e)];case 1:h=f.sent();if(!h)return[2,null];n={renderer:g,symbol:h};if(!(g&&"visualVariables"in g&&g.visualVariables))return[2,n];r=d.getVisualVariableValues(g,b,e);v=["proportional","proportional","proportional"];l=0;for(m=r;l<m.length;l++)w=m[l],A=w.variable,B=w.value,"color"===A.type?n.color=a.toUnitRGBA(B):"size"===A.type?"outline"===A.target?n.outlineSize=B:(C=A.axis,E=A.useSymbolValue?"symbolValue":B,"width"===C?v[0]=E:"depth"===C?v[1]=
E:"height"===C?v[2]=E:v[0]="width-and-depth"===C?v[1]=E:v[1]=v[2]=E):"opacity"===A.type?n.opacity=B:"rotation"===A.type&&"tilt"===A.axis?n.tilt=B:"rotation"===A.type&&"roll"===A.axis?n.roll=B:"rotation"===A.type&&(n.heading=B);if(isFinite(v[0])||isFinite(v[1])||isFinite(v[2]))n.size=v;return[2,n]}})})};b.getDriverAxisSizeValue=function(a,b){void 0===b&&(b=0);a=a[b];return"number"===typeof a&&isFinite(a)?a:null}})},"esri/renderers/visualVariables/support/visualVariableUtils":function(){define("require exports ../../../Color ../../../Graphic ../../../core/Logger ../../../core/maybe ../../support/utils ./sizeVariableUtils".split(" "),
function(q,b,l,f,h,a,e,d){function k(b,c,d){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(a){return"color"===a.type})[0]:b)if("esri.renderers.visualVariables.ColorVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");else{var e="number"===typeof c,g=e?null:c,k=g&&g.attributes,f=e?c:null,h=b.field,m=b.cache;c=m.ipData;var p=m.hasExpression,m=b.cache.compiledFunc;if(!h&&!p)return(d=b.stops)&&d[0]&&
d[0].color;if("number"!==typeof f)if(p){if(!a.isSome(d)||!a.isSome(d.arcade)){v.error("Use of arcade expressions requires an arcade context");return}f=d.arcade.arcadeUtils;h=f.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:d.spatialReference});g=f.createExecContext(g,h);m||(m=f.createSyntaxTree(b.valueExpression),m=f.createFunction(m),b.cache.compiledFunc=m);f=f.executeFunction(m,g)}else k&&(f=k[h]);g=b.normalizationField;k=k?parseFloat(k[g]):void 0;if(null!=f&&(!g||e||!isNaN(k)&&
0!==k)&&(isNaN(k)||e||(f/=k),e=x(f,c)))return k=e[0],c=e[1],d=k===c?b.stops[k].color:l.blendColors(b.stops[k].color,b.stops[c].color,e[2],a.isSome(d)?d.color:void 0),new l(d)}}function n(b,c,d){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(a){return"opacity"===a.type})[0]:b)if("esri.renderers.visualVariables.OpacityVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");else{var e="number"===
typeof c,g=e?null:c,k=g&&g.attributes,f=e?c:null,h=b.field,m=b.cache;c=m.ipData;var p=m.hasExpression,m=b.cache.compiledFunc;if(!h&&!p)return(b=b.stops)&&b[0]&&b[0].opacity;if("number"!==typeof f)if(p){if(a.isNone(d)||a.isNone(d.arcade)){v.error("Use of arcade expressions requires an arcade context");return}f=d.arcade.arcadeUtils;d=f.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:d.spatialReference});d=f.createExecContext(g,d);m||(g=f.createSyntaxTree(b.valueExpression),m=f.createFunction(g),
b.cache.compiledFunc=m);f=f.executeFunction(m,d)}else k&&(f=k[h]);d=b.normalizationField;k=k?parseFloat(k[d]):void 0;if(null!=f&&(!d||e||!isNaN(k)&&0!==k)&&(isNaN(k)||e||(f/=k),e=x(f,c))){c=e[0];k=e[1];if(c===k)return b.stops[c].opacity;c=b.stops[c].opacity;return c+(b.stops[k].opacity-c)*e[2]}}}function c(b,c,d){if(b="visualVariables"in b&&b.visualVariables?b.visualVariables.filter(function(a){return"rotation"===a.type})[0]:b)if("esri.renderers.visualVariables.RotationVariable"!==b.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");
else{var e=b.axis||"heading",g="heading"===e&&"arithmetic"===b.rotationType?90:0,e="heading"===e&&"arithmetic"===b.rotationType?-1:1,k="number"===typeof c?null:c,f=k&&k.attributes,h=b.field,m=b.cache.hasExpression;c=b.cache.compiledFunc;var p=0;if(!h&&!m)return p;if(m){if(a.isNone(d)||a.isNone(d.arcade)){v.error("Use of arcade expressions requires an arcade context");return}f=d.arcade.arcadeUtils;d=f.getViewInfo({viewingMode:d.viewingMode,scale:d.scale,spatialReference:d.spatialReference});d=f.createExecContext(k,
d);c||(c=f.createSyntaxTree(b.valueExpression),c=f.createFunction(c),b.cache.compiledFunc=c);p=f.executeFunction(c,d)}else f&&(p=f[h]||0);return p="number"!==typeof p||isNaN(p)?null:g+e*p}}function g(b,c,e){var g="number"===typeof c,k=g?null:c,f=k&&k.attributes,h=g?c:null;c=b.cache.compiledFunc;if(b.cache.isScaleDriven)k=a.isSome(e)?e.scale:void 0,e=a.isSome(e)?e.view:void 0,null==k||e&&"3d"===e.type?(k=e=null,(k=b.stops)?(e=k[0].value,k=k[k.length-1].value):(e=b.minDataValue||0,k=b.maxDataValue||
0),e=(e+k)/2):e=k,h=e;else if(!g)switch(b.inputValueType){case "expression":if(a.isNone(e)||a.isNone(e.arcade)){v.error("Use of arcade expressions requires an arcade context");return}h=e.arcade.arcadeUtils;e=h.getViewInfo({viewingMode:e.viewingMode,scale:e.scale,spatialReference:e.spatialReference});e=h.createExecContext(k,e);c||(k=h.createSyntaxTree(b.valueExpression),c=h.createFunction(k),b.cache.compiledFunc=c);h=h.executeFunction(c,e);break;case "field":f&&(h=f[b.field]);break;case "unknown":h=
null}if(!d.isValidNumber(h))return null;if(g||!b.normalizationField)return h;b=f?parseFloat(f[b.normalizationField]):null;return d.isValidNumber(b)&&0!==b?h/b:null}function r(a,b,c){if(a="visualVariables"in a&&a.visualVariables?a.visualVariables.filter(function(a){return"size"===a.type})[0]:a)if("esri.renderers.visualVariables.SizeVariable"!==a.declaredClass)v.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");else{var d=g(a,b,c);b=t(d,a,b,c,a.cache.ipData);
return null===b||void 0===b||isNaN(b)?0:b}}function p(a,b,c){return null==a?null:d.isSizeVariable(a)?r(a,b,c):d.isValidNumber(a)?a:null}function u(a,b,c){return d.isValidNumber(c)&&a>c?c:d.isValidNumber(b)&&a<b?b:a}function t(b,c,d,g,k){switch(c.transformationType){case "additive":return g=p(c.minSize,d,g),b+(g||c.minDataValue);case "constant":return b=(b=c.stops)&&b.length&&b[0].size,null==b&&(b=c.minSize),p(b,d,g);case "clamped-linear":k=(b-c.minDataValue)/(c.maxDataValue-c.minDataValue);var f=
p(c.minSize,d,g);d=p(c.maxSize,d,g);g=a.isSome(g)?g.shape:void 0;b<=c.minDataValue?c=f:b>=c.maxDataValue?c=d:"area"===c.scaleBy&&g?(g=(c="circle"===g)?m*Math.pow(f/2,2):f*f,g+=k*((c?m*Math.pow(d/2,2):d*d)-g),c=c?2*Math.sqrt(g/m):Math.sqrt(g)):c=f+k*(d-f);return c;case "proportional":return k=a.isSome(g)?g.shape:void 0,b/=c.minDataValue,f=p(c.minSize,d,g),c=p(c.maxSize,d,g),g=null,g="circle"===k?2*Math.sqrt(b*Math.pow(f/2,2)):"square"===k||"diamond"===k||"image"===k?Math.sqrt(b*Math.pow(f,2)):b*f,
u(g,f,c);case "stops":return k=x(b,k),f=k[0],b=k[1],k=k[2],f===b?c=p(c.stops[f].size,d,g):(f=p(c.stops[f].size,d,g),c=p(c.stops[b].size,d,g),c=f+(c-f)*k),c;case "real-world-size":return k=(a.isSome(g)&&g.resolution?g.resolution:1)*e.meterIn[c.valueUnit],f=p(c.minSize,d,g),g=p(c.maxSize,d,g),c=c.valueRepresentation,d=null,d="area"===c?2*Math.sqrt(b/m)/k:"radius"===c||"distance"===c?2*b/k:b/k,u(d,f,g);case "identity":return b;case "unknown":return null}}function x(a,b){if(b){var c=0,d=b.length-1;b.some(function(b,
e){if(a<b)return d=e,!0;c=e;return!1});return[c,d,(a-b[c])/(b[d]-b[c])]}}Object.defineProperty(b,"__esModule",{value:!0});var v=h.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),y=new f,m=Math.PI;b.getColor=k;b.getOpacity=n;b.getRotationAngle=c;b.getSize=r;b.getSizeFromNumberOrVariable=p;b.getSizeForValue=t;b.getSizeRangeAtScale=function(a,b,c){var d=c&&"3d"===c.type;if(!(a.cache.isScaleDriven&&d||b))return null;c={scale:b,view:c};b=p(a.minSize,y,c);a=p(a.maxSize,y,c);if(null!=
b||null!=a)return b>a&&(c=a,a=b,b=c),{minSize:b,maxSize:a}};b.getVisualVariableValues=function(a,b,d){if(a.visualVariables){var e=[],g=[],f=[],h=[],m=[],p=0;for(a=a.visualVariables;p<a.length;p++){var w=a[p];switch(w.type){case "color":g.push(w);break;case "opacity":f.push(w);break;case "rotation":m.push(w);break;case "size":h.push(w)}}g.forEach(function(a){var c=k(a,b,d);e.push({variable:a,value:c})});f.forEach(function(a){var c=n(a,b,d);e.push({variable:a,value:c})});m.forEach(function(a){var g=
c(a,b,d);e.push({variable:a,value:g})});h.forEach(function(a){var c=r(a,b,d);e.push({variable:a,value:c})});return e.filter(function(a){return null!=a.value})}}})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/maybe ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){function g(a,b,c){for(var d=[],e=0;e<a.length;e++){var g=a[e],k=g.index,g=g.count;if(!(1>=g)){var f=3*k,h=f+3*g;d.push({index:k,count:g,position:b.subarray(f,h),mapPosition:c?c.subarray(f,h):void 0})}}return d}function r(a,b,c){for(var d=[],e=function(a,e,g,k){if(1>=e)return"continue";var f=3*a,h=f+3*e;g=g.map(function(b){return b-a});d.push({index:a,count:e,holeIndices:g,pathLengths:k,position:b.subarray(f,h),mapPosition:c?c.subarray(f,h):void 0})},g=0;g<a.length;g++){var k=
a[g];e(k.index,k.count,k.holeIndices,k.pathLengths)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createColorGeometryData=function(a){var b={},d={};d[c.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};b[c.VertexAttrConstants.POSITION]=a.indices;if(h.isSome(a.attributeData.color)){var e=new Uint32Array(a.indices.length);d[c.VertexAttrConstants.COLOR]={size:4,data:a.attributeData.color};b[c.VertexAttrConstants.COLOR]=e}h.isSome(a.attributeData.mapPosition)&&(d.mapPos=
{size:3,data:a.attributeData.mapPosition},b.mapPos=a.indices);return new n.GeometryData(d,b)};b.createWaterGeometryData=function(a){var b={},d={};d[c.VertexAttrConstants.POSITION]={size:3,data:a.attributeData.position};b[c.VertexAttrConstants.POSITION]=a.indices;d[c.VertexAttrConstants.UV0]={size:2,data:a.attributeData.uv0};b[c.VertexAttrConstants.UV0]=a.indices;h.isSome(a.attributeData.mapPosition)&&(d.mapPos={size:3,data:a.attributeData.mapPosition},b.mapPos=a.indices);return new n.GeometryData(d,
b)};b.geometryAsPolygon=function(a){switch(a.type){case "extent":if(a instanceof f.Extent)return f.Polygon.fromExtent(a);break;case "polygon":return a}return null};b.geometryToRenderInfo=function(b,c,d,k){var f=a.pathsToTriangulationInfo(b.rings,b.hasZ,1),h=new Float64Array(f.position.length);b=e.applyPerVertexElevationAlignment(f.position,b.spatialReference,0,h,0,f.position,0,f.position.length/3,c,d,k);c=null!=b;return{position:f.position,mapPosition:h,polygons:r(f.polygons,f.position,h),outlines:g(f.outlines,
f.position,h),projectionSuccess:c,sampledElevation:b}};b.geometryToRenderInfoDraped=function(b,c){var e=a.pathsToTriangulationInfo(b.rings,!1,1);b=d.bufferToBuffer(e.position,b.spatialReference,0,e.position,c,0,e.position.length/3);for(c=2;c<e.position.length;c+=3)e.position[c]=k.DRAPED_Z;return{position:e.position,polygons:r(e.polygons,e.position),outlines:g(e.outlines,e.position),projectionSuccess:b}}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut",
"./coordsUtils","./meshUtils/deduplicate"],function(q,b,l,f,h){function a(a,b,c){if(1===a.length)return a[0];b=new Float64Array(b);c=new Uint32Array(c);for(var d=0,e=0,k=0,f=0;f<a.length;f++){for(var h=a[f],n=0;n<h.position.length;n++)b[d++]=h.position[n];for(n=0;n<h.faces.length;n++)c[e++]=h.faces[n]+k;k=d/3}return{position:b,faces:c}}function e(a,b,c){for(var e=a.length,k=Array(e),h=Array(e),n=Array(e),t=0,l=0,v=0,y=0,m=0;m<e;++m)y+=a[m].length;for(var y=new Float64Array(3*y),w=0,A=e-1;0<=A;A--){var B=
a[A],C=1===c?!f.isClockwise(B,!1,!1):!1;if(C&&1!==e)k[t++]=B;else{for(var E=B.length,m=0;m<t;++m)E+=k[m].length;m={index:w,pathLengths:Array(t+1),count:E,holeIndices:Array(t)};m.pathLengths[0]=B.length;0<B.length&&(n[v++]={index:w,count:B.length});w=C?d(B,B.length-1,-1,y,w,B.length,b):d(B,0,1,y,w,B.length,b);for(B=0;B<t;++B)C=k[B],m.holeIndices[B]=w,m.pathLengths[B+1]=C.length,0<C.length&&(n[v++]={index:w,count:C.length}),w=d(C,0,1,y,w,C.length,b);t=0;0<m.count&&(h[l++]=m)}}for(B=0;B<t;++B)C=k[B],
0<C.length&&(n[v++]={index:w,count:C.length}),w=d(C,0,1,y,w,C.length,b);l<e&&(h.length=l);v<e&&(n.length=v);return{position:y,polygons:h,outlines:n}}function d(a,b,c,d,e,f,h){e*=3;for(var g=0;g<f;++g){var k=a[b];d[e++]=k[0];d[e++]=k[1];d[e++]=h?k[2]:0;b+=c}return e/3}Object.defineProperty(b,"__esModule",{value:!0});b.triangulate=function(b){var d=e(b.rings,b.hasZ,1),c=[],g=0,k=0;b=function(a){var b=a.index,e=new Float64Array(d.position.buffer,3*b*d.position.BYTES_PER_ELEMENT,3*a.count);a=a.holeIndices.map(function(a){return a-
b});a=new Uint32Array(l(e,a,3));c.push({position:e,faces:a});g+=e.length;k+=a.length};for(var f=0,u=d.polygons;f<u.length;f++)b(u[f]);b=a(c,g,k);f=h.default(b.position.buffer,6,{originalIndices:b.faces});b.position=new Float64Array(f.buffer);b.faces=f.indices;return b};b.pathsToTriangulationInfo=e})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(q,b,l){function f(a,b,d){var e=a.byteLength/(4*b),f=new Uint32Array(a,0,e*b);a=
new Uint32Array(e);var c=d&&d.minReduction||0,g=d&&d.originalIndices||null,r=d&&d.componentOffsets||null,p=0;if(r)for(d=0;d<r.length-1;d++){var u=r[d+1]-r[d];u>p&&(p=u)}else p=e;u=Math.floor(1.1*p)+1;if(null==h||h.length<2*u)h=new Uint32Array(l.nextHighestPowerOfTwo(2*u));for(d=0;d<2*u;d++)h[d]=0;var p=0,t=0!==c?Math.ceil(7.84*1.96/(c*c)*c*(1-c)):e,x=1,v=r?r[1]:e;for(d=0;d<e;d++){if(d===t){var y=1-p/d;if(y+1.96*Math.sqrt(y*(1-y)/d)<c)return null;t*=2}if(d===v){for(v=0;v<2*u;v++)h[v]=0;v=r[++x]}for(var y=
d*b,m,w=m=0;w<b;w++)m=f[y+w]+m|0,m=m+(m<<11)+(m>>>2)|0;m>>>=0;for(var w=m%u,A=p;0!==h[2*w+1];){if(h[2*w]===m){var B=h[2*w+1]-1,C=B*b;a:{for(var E=0;E<b;E++)if(f[y+E]!==f[C+E]){C=!1;break a}C=!0}if(C){A=a[B];break}}w++;w>=u&&(w-=u)}A===p&&(h[2*w]=m,h[2*w+1]=d+1,p++);a[d]=A}if(0!==c&&1-p/e<c)return null;c=new Uint32Array(b*p);for(d=p=0;d<e;d++)if(a[d]===p){r=f;u=d*b;t=c;x=p*b;v=b;for(y=0;y<v;y++)t[x+y]=r[u+y];p++}if(g){b=new Uint32Array(g.length);for(d=0;d<b.length;d++)b[d]=a[g[d]];a=b}return{buffer:c.buffer,
indices:a,uniqueCount:p}}Object.defineProperty(b,"__esModule",{value:!0});b.deduplicate=f;var h=null;b.default=f})},"esri/views/3d/terrain/OverlayRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/iteratorUtils ../../../core/Logger ../../../core/PooledArray ../../../core/accessorSupport/decorators/declared ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../support/debugFlags ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/Camera ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/RenderContext ../webgl-engine/lib/renderStats ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/Lightsources ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/ColorMaterial ../webgl-engine/materials/HUDMaterial ../webgl-engine/materials/lineStippleUtils ../webgl-engine/materials/RibbonLineMaterial ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R){Object.defineProperty(b,"__esModule",{value:!0});var O=a.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");q=function(a){function b(b){var d=a.call(this)||this;d._clearColor=c.vec4f64.fromValues(0,0,0,0);d._hasHighlights=!1;d._lighting=new J.SceneLighting;d._localOrigins=new m;d._layerRenderers=new Map;d._sortedLayerRenderersDirty=!1;d._sortedLayerRenderers=new e;d._stats=new B.RenderStatsAggregator;d._geometries=
new Map;d._renderTargets={};d._uniqueIdx=0;d.longitudeCyclical=null;d._rctx=b.renderingContext;d._renderContext=new A(d._rctx,null,null,null,null,null);d._stippleTextureRepository=new H.StippleTextureRepository;d._shaderTechniqueRepository=new p.ShaderTechniqueRepository({rctx:d._rctx,viewingMode:1,commonUniformStore:new r.CommonUniformStore,stippleTextureRepository:d._stippleTextureRepository});d._materialRepository=new v(b.textureRepository,d._shaderTechniqueRepository);d._materialRepository.onMaterialChanged=
function(){return d.emitContentChanged()};d._bindParameters={fovY:0,highlightDepthTexture:y.createEmptyDepthTexture(d._rctx),nearFar:[T.near,T.far],origin:null,pixelRatio:null,proj:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,view:null,viewInvTransp:null,viewport:null};d._lighting.set({lights:[new G.AmbientLight(n.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0});return d}l(b,a);b.prototype.dispose=function(){this._layerRenderers.forEach(function(a){return a.dispose()});
this._layerRenderers.clear();for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._bindParameters.highlightDepthTexture.dispose();this._bindParameters.highlightDepthTexture=null};b.prototype.disposeRenderTarget=function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};Object.defineProperty(b.prototype,"updating",{get:function(){return this._sortedLayerRenderersDirty||h.someMap(this._layerRenderers,function(a){return a.updating})},
enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){var a=this,b=!1;this._layerRenderers.forEach(function(c,d){c.commitChanges()&&(b=!0);c.isEmpty&&(a._layerRenderers.delete(d),a._sortedLayerRenderersDirty=!0)});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),b=!0);this.emitUpdatingChanged();if(b){this.emitContentChanged();var c=h.someMap(this._layerRenderers,function(a){return a.hasHighlights});c!==this._hasHighlights&&(this._hasHighlights=c,this.emitHasHighlightsChanged())}};
b.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};b.prototype.addGeometries=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];null==d.origin&&(d.origin=this._localOrigins.getOrigin(d.center));d.idx=this._uniqueIdx++;this._geometries.set(d.uniqueName,d)}this.ensureLayerRenderer(b).add(a)};b.prototype.removeGeometries=function(a,b){for(var c=0;c<a.length;c++)this._geometries.delete(a[c].uniqueName);(b=this._layerRenderers.get(b))?b.remove(a):O.warn("Attempted to remove geometry for nonexistent layer")};
b.prototype.updateGeometries=function(a,b,c){(b=this._layerRenderers.get(b))?b.modify(a,c):O.warn("Attempted to update geometry for nonexistent layer")};b.prototype.updateHighlights=function(a,b){(b=this._layerRenderers.get(b))?b.modify(a,16):O.warn("Attempted to update highlights for nonexistent layer")};b.prototype.isEmpty=function(){return 0===this._geometries.size&&!g.OVERLAY_DRAW_DEBUG_TEXTURE};Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return h.someMap(this._layerRenderers,function(a){return a.hasWater})},enumerable:!0,configurable:!0});b.prototype.updateLogic=function(a){var b=!1;this._layerRenderers.forEach(function(c){c.updateLogic(a)&&(b=!0)});return b};b.prototype.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};b.prototype.draw=function(a,b){return this.drawPass(0,a,b)};b.prototype.drawNormals=function(a,b){return this.drawPass(2,
a,b)};b.prototype.drawHighlights=function(a,b){return this.drawPass(4,a,b)};b.prototype.drawPass=function(a,b,c){var d=this;if(0===c.numViews)return!1;this._pixelRatio=c.pixelRatio*Math.abs(c.views[0].extent[2]-c.views[0].extent[0])/Math.abs(c.views[0].viewport[2]-c.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights||2===a&&!this.hasWater||!this.hasNonZeroSizedView(c))return!1;var e=c.width,k=c.height;b=this._renderTargets[b];if(!b)return!1;b.resize(e,k);var f=this._rctx,h=T;h.pixelRatio=
c.pixelRatio||1;this._renderContext.pass=a;this._bindParameters.pixelRatio=h.pixelRatio;f.bindFramebuffer(b);f.setClearColor.apply(f,this._clearColor);f.clearSafe(16384);this.updateLightingUniforms();if(g.OVERLAY_DRAW_DEBUG_TEXTURE)for(a=0;a<c.numViews;a++)this.setViewParameters(c.views[a],h),this.drawDebugTexture(e,k,Q[c.index%Q.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forEach(function(a){for(var b=0;b<c.numViews;b++)d.setViewParameters(c.views[b],h),a.draw(d._renderContext,
d._bindParameters,d._stats)});f.bindFramebuffer(null);b.colorTexture.descriptor.hasMipmap&&b.colorTexture.generateMipmap();return!0};b.prototype.createRenderTarget=function(a,b,c,d){for(var e=a,g=0;this._renderTargets[e];)e=a+"_"+ ++g;this._renderTargets[e]=new P(this._rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:d,hasMipmap:b,maxAnisotropy:c,width:0,height:0});return e};b.prototype.getGpuMemoryUsage=function(){var a=0,b;for(b in this._renderTargets)a+=
R.getGpuMemoryUsage(this._renderTargets[b]);return a};b.prototype.getStats=function(){return this._stats.getAggregatedStats()};b.prototype.intersect=function(a,b,c){var d=this,e=0;this._geometries.forEach(function(g){if(!c||c(g)){if(g.material instanceof I||g.material instanceof L||g.material instanceof K){d.intersectRenderGeometry(g,b,0,a,e);var k=d.longitudeCyclical;k&&(g.center[0]-g.bsRadius<k.min&&d.intersectRenderGeometry(g,b,k.range,a,e),g.center[0]+g.bsRadius>k.max&&d.intersectRenderGeometry(g,
b,-k.range,a,e))}e++}})};b.prototype.intersectRenderGeometry=function(a,b,c,d,e){var g=this;c+=a.transformation[12];var k=a.transformation[13];Y[0]=b[0]-c;Y[1]=b[1]-k;Y[2]=1;N[0]=b[0]-c;N[1]=b[1]-k;N[2]=0;a.pixelRatio=this._pixelRatio;a.material.intersect(a,null,a.getShaderTransformation(),d,Y,N,function(b,c,k){g.addIntersectionResult(k,a.material.renderPriority,e,d,a.data.layerUid,a.data.graphicUid)},a.calculateShaderTransformation,!0)};b.prototype.addIntersectionResult=function(a,b,c,d,e,g){var k=
{type:"external",metadata:{layerUid:e,graphicUid:g}};e=function(e){e.set(k,null,d.results.terrain.dist,d.results.terrain.normal,d.results.terrain.transformation,b,null,null,a,c);e.intersector="OverlayRenderer"};(null==d.results.min.drapedLayerOrder||b>=d.results.min.drapedLayerOrder)&&(null==d.results.min.dist||d.results.terrain.dist<=d.results.min.dist)&&e(d.results.min);0!==d.options.store&&(null==d.results.max.drapedLayerOrder||b<d.results.max.drapedLayerOrder)&&(null==d.results.max.dist||d.results.terrain.dist>
d.results.max.dist)&&e(d.results.max);2===d.options.store&&(g=new w.IntersectorResult(d.ray),e(g),d.results.all.push(g))};b.prototype.ensureLayerRenderer=function(a){var b=this,c=this._layerRenderers.get(a);c||(c=new C.SortedRenderGeometryRenderer(this._rctx,this._materialRepository,function(){return b.emitUpdatingChanged()}),this._layerRenderers.set(a,c),this._sortedLayerRenderersDirty=!0);return c};b.prototype.updateSortedLayerRenderers=function(){var a=this;if(this._sortedLayerRenderersDirty&&
(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==this._layerRenderers.size)){var b=h.firstKeyOfMap(this._layerRenderers).view.allLayerViews,c=h.createSetFromValues(h.valuesOfMap(this._layerRenderers));b.forEach(function(b){if(b=a._layerRenderers.get(b))a._sortedLayerRenderers.push(b),c.delete(b)});c.forEach(function(b){a._sortedLayerRenderers.push(b)})}};b.prototype.setViewParameters=function(a,b){b.viewport=a.viewport;var c=a.extent;k.mat4.ortho(b.projectionMatrix,0,c[2]-
c[0],0,c[3]-c[1],b.near,b.far);k.mat4.identity(b.viewMatrix);k.mat4.translate(b.viewMatrix,b.viewMatrix,[-a.extent[0],-a.extent[1],0]);b.setGLViewport(this._rctx);this._renderContext.camera=b;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;this._bindParameters.viewport=b.fullViewport;this._shaderTechniqueRepository.getProgramsUsingUniform("proj").forEach(function(a){a.setUniformMatrix4fv("proj",b.projectionMatrix)})};
b.prototype.updateLightingUniforms=function(){var a=this;this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection").forEach(function(b){a._lighting.setUniforms(b)})};b.prototype.hasNonZeroSizedView=function(a){for(var b=0;b<a.numViews;b++){var c=a.views[b];if(c.extent[0]!==c.extent[2]&&c.extent[1]!==c.extent[3])return!0}return!1};b.prototype.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};b.prototype.emitUpdatingChanged=function(){if(this.onUpdatingChanged)this.onUpdatingChanged()};
b.prototype.emitHasHighlightsChanged=function(){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this._hasHighlights)};b.prototype.drawDebugTexture=function(a,b,c){var d=this._rctx;this.ensureDebugPatternResources(a,b);a=this._debugPatternProgram;d.bindProgram(a);d.setPipelineState(this._debugPatternPipelineState);a.setUniform4f("color",c[0],c[1],c[2],1);a.setUniform1i("tex",0);d.bindTexture(this._debugPatternTexture,0);d.bindVAO(this._quadVAO);d.drawArrays(5,0,R.vertexCount(this._quadVAO,
"geometry"))};b.prototype.ensureDebugPatternResources=function(a,b){if(!this._debugPatternTexture){for(var c=new Uint8Array(a*b*4),d=0,e=0;e<b;e++)for(var g=0;g<a;g++){var k=Math.floor(g/10),f=Math.floor(e/10);2>k||2>f||10*k>a-20||10*f>b-20?(c[d++]=255,c[d++]=255,c[d++]=255,c[d++]=255):(c[d++]=255,c[d++]=255,c[d++]=255,k&1&&f&1?c[d++]=g&1^e&1?0:255:c[d++]=k&1^f&1?0:128)}this._debugPatternTexture=new S(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},c);a=
new E.TextureTechniqueConfiguration;a.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(E.TextureTechnique,a,this._debugTextureTechnique);this._debugPatternProgram=this._debugTextureTechnique.program;this._debugPatternPipelineState=this._debugTextureTechnique.pipeline;this._quadVAO=y.createQuadVAO(this._rctx,x.Pos3Tex)}};Object.defineProperty(b.prototype,"test",{get:function(){return{layerRenderers:this._layerRenderers}},enumerable:!0,configurable:!0});
f([u.autoDispose()],b.prototype,"_shaderTechniqueRepository",void 0);f([u.autoDispose()],b.prototype,"_stippleTextureRepository",void 0);return b}(d.declared(u.AutoDisposable));b.OverlayRenderer=q;var Q=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],T=new t.default;T.near=1;T.far=1E4;var Y=n.vec3f64.create(),N=n.vec3f64.create();b.DRAPED_Z=-2})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["require","exports","../../../../../core/arrayUtils"],function(q,b,l){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}b.prototype.dispose=function(){this._uniforms=null};b.prototype.getPrograms=function(b){return this._uniforms[b]||[]};b.prototype.subscribeProgram=function(b){for(var a in this._uniforms)b.hasUniform(a)&&this._uniforms[a].push(b)};b.prototype.unsubscribeProgram=function(b){for(var a in this._uniforms)l.removeUnordered(this._uniforms[a],b)};return b}();b.CommonUniformStore=
q})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/maybe ../../../../../core/promiseUtils".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this._context=a;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}Object.defineProperty(b.prototype,
"viewingMode",{get:function(){return this._context.viewingMode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"constructionContext",{get:function(){return this._context},enumerable:!0,configurable:!0});b.prototype.acquire=function(a,b){var d=b.key,c=this._perConstructorInstances.get(a);c||(c=new Map,this._perConstructorInstances.set(a,c));var e=c.get(d);void 0===e?(e={technique:new a(this._context,b),refCount:1,refZeroFrame:0},c.set(d,e)):e.refCount+=1;return e.technique};b.prototype.acquireAndReleaseExisting=
function(a,b,e){return h.isNone(e)?this.acquire(a,b):b.key===e.key&&e instanceof a?e:(this.release(e),this.acquire(a,b))};b.prototype.release=function(a){a=this._perConstructorInstances.get(a.constructor).get(a.key);--a.refCount;0===a.refCount&&(a.refZeroFrame=this._frameCounter)};b.prototype.frameUpdate=function(){var a=this;this._frameCounter++;this._perConstructorInstances.forEach(function(b,d){b.forEach(function(c,d){0===c.refCount&&c.refZeroFrame+a._keepAliveFrameCount<a._frameCounter&&(c.technique.dispose(),
b.delete(d))});0===b.size&&a._perConstructorInstances.delete(d)})};b.prototype.getProgramsUsingUniform=function(a){return this._context.commonUniformStore.getPrograms(a)};b.prototype.hotReload=function(){return l(this,void 0,void 0,function(){var b,e=this;return f(this,function(d){switch(d.label){case 0:return b=[],this._perConstructorInstances.forEach(function(a,d){b.push(function(a,b){return l(e,void 0,void 0,function(){var c,d=this;return f(this,function(e){switch(e.label){case 0:return(c=b.shader)?
[4,c.reload()]:[3,2];case 1:e.sent(),a.forEach(function(a){a.technique.reload(d._context)}),e.label=2;case 2:return[2]}})})}(a,d))}),[4,a.all(b)];case 1:return d.sent(),[2]}})})};return b}();b.ShaderTechniqueRepository=q})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","../core/shaderLibrary/ShaderOutputOptions","./Util"],function(q,b,l,f){var h=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=
function(){--this.refCnt;f.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function a(a,b,k){this._textureRep=a;this._techniqueRep=b;this.onMaterialChanged=k;this._id2glMaterialRef=new Map}a.prototype.acquire=function(a,b){var d=l.getShaderOutputID(a.id,b),e=this._id2glMaterialRef.get(d);null==e?(b=a.getGLMaterial({material:a,techniqueRep:this._techniqueRep,textureRep:this._textureRep,
output:b}),e=new h(b),this._id2glMaterialRef.set(d,e),this.ownMaterial(a)):b=e.getGLMaterial();e.incRefCnt();return b};a.prototype.release=function(a,b){a=l.getShaderOutputID(a.id,b);b=this._id2glMaterialRef.get(a);b.decRefCnt();0===b.getRefCnt()&&((b=b.getGLMaterial())&&b.dispose(),this._id2glMaterialRef.delete(a))};a.prototype.materialChanged=function(a){for(var b=0,e=l.ShaderOutputTypes;b<e.length;b++){var f=e[b];5!==f.output&&6!==f.output&&(f=this._id2glMaterialRef.get(l.getShaderOutputID(a.id,
f.output)))&&f.getGLMaterial()&&(f=f.getGLMaterial(),f.updateParameters&&f.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(a)};a.prototype.ownMaterial=function(a){-1===a.materialRepositories.indexOf(this)&&a.materialRepositories.push(this)};return a}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["require","exports","../../../../../core/arrayUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.ShaderOutputTypes=
[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"}];b.getShaderOutputID=function(f,h){return f+"_"+l.find(b.ShaderOutputTypes,function(a){return a.output===h}).name}})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){var t=0;q=function(){function a(){this.ROOT_ORIGIN_ID="rg_root_"+t++;this._origins=new Map;this._gridSize=42E5}a.prototype.getOrigin=function(b){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){if(l.isSome(a.testOrigin)){var d=a.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,g.fromValues(d[0],d[1],d[2],this.ROOT_ORIGIN_ID));return this.getOrigin(b)}d=g.fromValues(b[0]+Math.random()-.5,b[1]+Math.random()-.5,b[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);
this._origins.set(this.ROOT_ORIGIN_ID,d);return d}h.vec3.subtract(x,b,c.vec3);x[0]=Math.abs(x[0]);x[1]=Math.abs(x[1]);x[2]=Math.abs(x[2]);d=this._gridSize;if(x[0]<d&&x[1]<d&&x[2]<d)return c;var c=Math.round(b[0]/d),e=Math.round(b[1]/d);b=Math.round(b[2]/d);var k="rg_"+c+"/"+e+"/"+b,f=this._origins.get(k);f||(f=g.fromValues(c*d,e*d,b*d,k),this._origins.set(k,f));return f};a.prototype._drawOriginBox=function(a){var b=window.view,g=b._stage;if(null==this._object){this._material=new u({width:2,color:[0,
1,0,1]},"GridLocalOriginMaterial");g.add(3,this._material);var h=new c("GridLocalOrigin",{isPickable:!1});g.add(0,h);this._object=new r({idHint:"GridLocalOrigin",castShadow:!1});g.add(1,this._object);h.addObject(this._object);g.addToViewContent([h.id])}for(var t=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],v=t.length,l=new Float32Array(3*v),h=new Uint32Array(2*(v-1)),x=.5*this._gridSize,y=0;y<v;y++)l[3*y+0]=a[0]+(t[y]&1?x:-x),l[3*y+1]=a[1]+(t[y]&2?x:-x),l[3*y+2]=a[2]+(t[y]&4?x:-x),0<y&&(h[2*y+0]=y-1,h[2*
y+1]=y);d.bufferToBuffer(l,e.WebMercator,0,l,b.spatialReference,0,v);b={};b[p.VertexAttrConstants.POSITION]={size:3,data:l};l={};l[p.VertexAttrConstants.POSITION]=h;h=new n.GeometryData(b,l,void 0,"line");h=new k(h,"GridLocalOriginBox");g.add(2,h);this._object.addGeometry(h,this._material,f.mat4f64.IDENTITY);console.log(this._origins.size,a)};return a}();var x=a.vec3f64.create();(q||(q={})).testOrigin=null;return q})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/arrayUtils ../../../../core/Evented ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./Octree".split(" "),
function(q,b,l,f,h,a,e,d,k){return function(b){function c(a,d,k){var g=b.call(this)||this;g._parentStages=new Map;g._children=new Set;g.id=c._idGen.gen(a);g.apiLayerUid=k;g.name=a;d=d||{};g.group=d.group||"";g.isVisible=null!=d.isVisible?d.isVisible:!0;g.isPickable=null!=d.isPickable?d.isPickable:!0;g.isSliceable=!1;g.translation=d.translation?e.vec3f64.clone(d.translation):e.vec3f64.create();g._extent=[e.vec3f64.fromValues(0,0,0),e.vec3f64.fromValues(1E3,1E3,1E3)];g._extentDirty=!0;return g}l(c,
b);c.prototype.addParentStage=function(a){if(!this._parentStages.has(a)){var b=this.on("dirty",function(b){a.notifyDirty(b.origin,b.dirtyType,b.subObject)});this._parentStages.set(a,b)}};c.prototype.removeParentStage=function(a){var b=this._parentStages.get(a);b&&(b.remove(),this._parentStages.delete(a));this.invalidateSpatialQueryAccelerator()};c.prototype.getName=function(){return this.name};c.prototype.getGroup=function(){return this.group};c.prototype.getTranslation=function(){return this.translation};
c.prototype.getObjectIds=function(){return f.keysOfSet(this._children,function(a){return a.id})};c.prototype.getObjects=function(){return f.keysOfSet(this._children)};c.prototype.getExtent=function(){this._updateExtent();return this._extent};c.prototype.addObject=function(a){this._children.add(a);a.parentLayer=this;this.notifyDirty("layerObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};c.prototype.hasObject=function(a){return this._children.has(a)};c.prototype.removeObject=
function(a){return this._children.delete(a)?(a.parentLayer=null,this.notifyDirty("layerObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};c.prototype.notifyObjectBBChanged=function(a,b){this._octree&&this._octree.update(a,b)};c.prototype.getCenter=function(){this._updateExtent();var b=e.vec3f64.create();return a.vec3.lerp(b,this._extent[0],this._extent[1],.5)};c.prototype.getBSRadius=function(){this._updateExtent();return.5*a.vec3.distance(this._extent[0],this._extent[1])};
c.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};c.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};c.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};c.prototype.notifyDirty=function(a,b,c,d){this.emit("dirty",{origin:d||this,dirtyType:a,subObject:b})};c.prototype._createOctree=function(){for(var b=
this.getExtent(),c=0,d=0;3>d;d++)c=Math.max(c,b[1][d]-b[0][d]);d=e.vec3f64.create();a.vec3.lerp(d,b[0],b[1],.5);this._octree=new k(d,1.2*c,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(f.keysOfSet(this._children))};c.prototype._invalidateExtent=function(){this._extentDirty=!0};c.prototype._updateExtent=function(){var a=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var b=
null;this._children.forEach(function(c){var d=c.getBBMin();c=c.getBBMax();if(b)for(var g=0;3>g;++g)a._extent[0][g]=Math.min(a._extent[0][g],d[g]),a._extent[1][g]=Math.max(a._extent[1][g],c[g]);else b=[e.vec3f64.clone(d),e.vec3f64.clone(c)]});this._extent=b}};c._idGen=new d.IdGen;return c}(h)})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function n(a,b,c){return!e.frustum.intersectsSphere(c.planes,e.sphere.wrap(b,a))}function c(a,b,c){if(!K.length)for(var d=0;8>d;++d)K.push({index:0,distance:0});for(d=0;8>d;++d){var e=u[d];K.data[d].index=d;K.data[d].distance=r(a,b,e)}K.sort(function(a,b){return a.distance-b.distance});c.clear();for(d=0;8>d;++d)c.push(K.data[d].index)}function g(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var g=r(a,b,t[e]);
g<c&&(c=g,d=t[e])}return d}function r(a,b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}q=function(){function b(b,c,d,e){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=d;e&&(void 0!==e.maximumObjectsPerNode&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),void 0!==e.maximumDepth&&(this._maximumDepth=e.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(c)?this._root=new p(null,a.vec3f64.fromValues(0,
0,0),.5):this._root=new p(null,b,c/2)}Object.defineProperty(b.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;p.clearPool();v=[null];B.prune();K.prune();H.prune()};b.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;
this._grow(a,b);for(var c=p.acquire(),d=0;d<b;d++){var e=a[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}p.release(c)};b.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var c=p.acquire(),d=0;d<a.length;d++){var e=a[d],g=b||this._boundingSphereFromObject(e,C);this._isValidRadius(g.radius)?(c.init(this._root),this._remove(e,g,c)):this._degenerateObjects.delete(e)}p.release(c);this._shrink()};b.prototype.update=
function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};b.prototype.forEachAlongRay=function(a,b,c){var d=this,g=e.ray.wrap(a,b);this._forEachNode(this._root,function(a){if(!d._intersectsNode(g,a))return!1;a=a.node;a.terminals.forEach(function(a){d._intersectsObject(g,a)&&c(a)});null!==a.residents&&a.residents.forEach(function(a){d._intersectsObject(g,a)&&c(a)});return!0})};b.prototype.forEachAlongRayWithVerticalOffset=function(a,b,c,d){var g=this,k=e.ray.wrap(a,
b);this._forEachNode(this._root,function(a){if(!g._intersectsNodeWithOffset(k,a,d))return!1;a=a.node;a.terminals.forEach(function(a){g._intersectsObjectWithOffset(k,a,d)&&c(a)});null!==a.residents&&a.residents.forEach(function(a){g._intersectsObjectWithOffset(k,a,d)&&c(a)});return!0})};b.prototype.forEach=function(a){this._forEachNode(this._root,function(b){b=b.node;b.terminals.forEach(a);null!==b.residents&&b.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};b.prototype.forEachDegenerateObject=
function(a){this._degenerateObjects.forEach(a)};b.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,"front-to-back"===b?1:-1,c,d,e)};b.prototype.forEachInDepthRange=function(a,b,c,d,e,g,k,f){this._forEachInDepthRange(a,b,"front-to-back"===c?1:-1,d,e,g,k,f)};b.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};b.prototype._intersectsNode=function(a,b){k(b.center,2*-b.halfSize,w);k(b.center,2*b.halfSize,A);return d.rayBoxTest(a.origin,
a.direction,w,A)};b.prototype._intersectsNodeWithOffset=function(a,b,c){k(b.center,2*-b.halfSize,w);k(b.center,2*b.halfSize,A);c.applyToMinMax(w,A);return d.rayBoxTest(a.origin,a.direction,w,A)};b.prototype._intersectsObject=function(a,b){var c=this._objectToBoundingSphere.getRadius(b);return 0<c?e.sphere.intersectsRay(e.sphere.wrap(c,this._objectToBoundingSphere.getCenter(b)),a):!0};b.prototype._intersectsObjectWithOffset=function(a,b,c){var d=this._objectToBoundingSphere.getRadius(b);return 0<d?
e.sphere.intersectsRay(c.applyToBoundingSphere(d,this._objectToBoundingSphere.getCenter(b)),a):!0};b.prototype._forEachNode=function(a,b){a=p.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(p.acquire().init(a).advance(d));p.release(a)}};b.prototype._forEachNodeDepthOrdered=function(a,b,d,e){void 0===e&&(e=1);a=p.acquire().init(a);var g=[a];for(c(d,e,H);0!==g.length;){a=g.pop();if(b(a)&&!a.isLeaf())for(d=
7;0<=d;--d)e=H.data[d],e>=a.node.children.length||a.node.children[e]&&g.push(p.acquire().init(a).advance(e));p.release(a)}};b.prototype._findClosest=function(a,b,c,d,e){var k=this,f=Infinity,p=Infinity,w=null,v=g(a,b),t=0,l=function(e){++t;if(!d||d(e)){var g=k._objectToBoundingSphere.getCenter(e),h=k._objectToBoundingSphere.getRadius(e);if(!c||!n(g,h,c)){var g=r(a,b,g),m=g-h;m<f&&(f=m,p=g+h,w=e)}}};this._forEachNodeDepthOrdered(this._root,function(d){if(null!=e&&t>=e||c&&n(d.center,d.halfSize*x,c))return!1;
h.vec3.scale(m,v,d.halfSize);h.vec3.add(m,m,d.center);if(r(a,b,m)>p)return!1;d=d.node;d.terminals.forEach(function(a){l(a)});null!==d.residents&&d.residents.forEach(function(a){l(a)});return!0},a,b);return w};b.prototype._forEachInDepthRange=function(a,b,c,d,e,k,f,p){var w=this,t=-Infinity,v=Infinity,l={setRange:function(a){1===c?(t=Math.max(t,a.near),v=Math.min(v,a.far)):(t=Math.max(t,-a.far),v=Math.min(v,-a.near))}};l.setRange(d);var y=r(b,c,a),u=g(b,c),A=g(b,-1*c),B=0,C=function(a){++B;if(!f||
f(a)){var d=w._objectToBoundingSphere.getCenter(a),g=w._objectToBoundingSphere.getRadius(a),h=r(b,c,d)-y;h-g>v||h+g<t||k&&n(d,g,k)||e(a,l)}};this._forEachNodeDepthOrdered(this._root,function(a){if(null!=p&&B>=p||k&&n(a.center,a.halfSize*x,k))return!1;h.vec3.scale(m,u,a.halfSize);h.vec3.add(m,m,a.center);if(r(b,c,m)-y>v)return!1;h.vec3.scale(m,A,a.halfSize);h.vec3.add(m,m,a.center);if(r(b,c,m)-y<t)return!1;a=a.node;a.terminals.forEach(function(a){C(a)});null!==a.residents&&a.residents.forEach(function(a){C(a)});
return!0},b,c)};b.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;v[0]=a;return v};b.prototype._remove=function(a,b,c){B.clear();b=c.advanceTo(b,function(a,b){B.push(a.node);B.push(b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===b.length)for(a=B.length-2;0<=a&&this._purge(B.data[a],B.data[a+1]);a-=2);};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;
return!0};b.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new f({shrink:!0})),!0):!1};b.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,C))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};b.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=p.acquire().init(a);
this._add(b.data[c],d);p.release(d)}};b.prototype._grow=function(a,b){var c=this;0!==b&&(a=this._boundingSphereFromObjects(a,b,function(a,b){return c._boundingSphereFromObject(a,b)},E),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)&&(this._nodeIsEmpty(this._root.node)?(h.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius):(b=p.acquire(),this._rootBoundsForRootAsSubNode(a,b),this._placingRootViolatesMaxDepth(b)?this._rebuildTree(a,b):this._growRootAsSubNode(b),p.release(b))))};
b.prototype._rebuildTree=function(a,b){var c=this;h.vec3.copy(G.center,b.center);G.radius=b.halfSize;a=this._boundingSphereFromObjects([a,G],2,function(a){return a},J);b=p.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){c.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&c.add(a.node.residents.data,a.node.residents.length);return!0});p.release(b)};b.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,
function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,g=this._root.halfSize,k=0;3>k;k++){var f=Math.max(0,Math.ceil((e[k]-g-(d[k]-c))/(2*g))),h=Math.max(0,Math.ceil((d[k]+c-(e[k]+g))/(2*g)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(f+h)*Math.LOG2E)));I[k].min=f;I[k].max=h}for(k=0;3>k;k++)f=I[k].min,h=I[k].max,
c=(a-(f+h))/2,f+=Math.ceil(c),h+=Math.floor(c),y[k]=e[k]-g-f*g*2+(h+f)*g;return b.initFrom(null,y,a*g,0)};b.prototype._growRootAsSubNode=function(a){var b=this._root.node;h.vec3.copy(E.center,this._root.center);E.radius=this._root.halfSize;this._root.init(a);a.advanceTo(E,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};b.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};b.prototype._findShrinkIndex=
function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};b.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};b.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};b.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=
a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};b.prototype._boundingSphereFromObject=function(a,b){h.vec3.copy(b.center,this._objectToBoundingSphere.getCenter(a));b.radius=this._objectToBoundingSphere.getRadius(a);return b};b.prototype._boundingSphereFromObjects=function(a,b,c,d){if(1===b){var e=c(a[0],E);h.vec3.copy(d.center,e.center);d.radius=e.radius}else{w[0]=Infinity;w[1]=Infinity;w[2]=Infinity;A[0]=-Infinity;A[1]=-Infinity;A[2]=
-Infinity;for(var g=0;g<b;g++)if(e=c(a[g],E),this._isValidRadius(e.radius)){var k=w,f=e.center,m=e.radius;k[0]=Math.min(k[0],f[0]-m);k[1]=Math.min(k[1],f[1]-m);k[2]=Math.min(k[2],f[2]-m);k=A;f=e.center;e=e.radius;k[0]=Math.max(k[0],f[0]+e);k[1]=Math.max(k[1],f[1]+e);k[2]=Math.max(k[2],f[2]+e)}h.vec3.lerp(d.center,w,A,.5);d.radius=Math.max(A[0]-w[0],A[1]-w[1],A[2]-w[2])/2}return d};return b}();var p=function(){function b(b,c,d){void 0===d&&(d=0);this.center=a.vec3f64.create();this.initFrom(b,c,d,0)}
b.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};b.prototype.initFrom=function(a,c,d,e){void 0===a&&(a=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=a||b.createEmptyNode();c&&h.vec3.copy(this.center,c);this.halfSize=d;this.depth=e;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);this.node=c;this.halfSize/=2;this.depth++;a=u[a];this.center[0]+=a[0]*this.halfSize;
this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};b.prototype._childIndex=function(a){a=
a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new f({shrink:!0}),residents:new f({shrink:!0})}};b.acquire=function(){return b._pool.acquire()};b.release=function(a){b._pool.release(a)};b.clearPool=function(){b._pool.prune()};b._pool=new l(b);return b}(),u=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,
-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],t=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],x=Math.sqrt(3),v=[null],y=a.vec3f64.create(),m=a.vec3f64.create(),w=a.vec3f64.create(),A=a.vec3f64.create(),B=new f,C={center:a.vec3f64.create(),
radius:0},E={center:a.vec3f64.create(),radius:0},G={center:a.vec3f64.create(),radius:0},J={center:a.vec3f64.create(),radius:0},I=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],K=new f,H=new f;return q})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.fromVector=function(b,h){return{vec3:l.vec3f64.clone(b),id:h}};b.fromValues=function(b,h,a,e){return{vec3:l.vec3f64.fromValues(b,
h,a),id:e}}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./VisualVariableMaterialParameters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){function C(a,b,c,d,e){for(var g=0;g<e;g++)c[d++]=a[b++];return d}var E=h.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");q=function(b){function c(a,c){c=b.call(this,c)||this;c.techniqueConfig=new B.RibbonLineTechniqueConfiguration;c.params=m.copyParameters(a,J);c.validateParams();c.params.transparent=1>c.params.color[3]||c.params.transparent;c.layout=c.createLayout();return c}l(c,b);c.prototype.dispose=function(){};c.prototype.setParameterValues=
function(a){for(var b in a)"cap"===b?E.error("cap cannot be changed after creation"):"join"===b&&"round"===this.params[b]!==("round"===a[b])?E.error("join cannot be changed after creation"):"stipplePattern"===b&&!!this.params[b]!==!!a[b]?E.error("stippledness cannot be changed after creation"):this.params[b]=a[b];this.validateParams();this.parametersChanged()};c.prototype.getParameters=function(){return this.params};c.prototype.getPassParameters=function(){return this.params};c.prototype.getTechniqueConfig=
function(a){this.techniqueConfig.output=a;a=e.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=a;this.techniqueConfig.stippleIntegerRepeatsEnabled=a&&this.params.stippleIntegerRepeats;this.techniqueConfig.stippleOffColorEnabled=a&&e.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=
this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.writeDepth=this.params.writeDepth;return this.techniqueConfig};c.prototype.intersect=function(a,b,c,d,e,g,k,f,h){h?
m.intersectDrapedRenderLineGeometry(a,d,g,this.params.width,k):this.intersectLineGeometry(a,b,c,d,this.params.width,k)};c.prototype.intersectLineGeometry=function(b,c,d,e,f,h){if(e.options.selectionMode&&!p.isAllHidden(c.componentVisibilities,b.componentOffsets))if(v.isTranslationMatrix(d)){c=b.data.getVertexAttr();b=c[B.RibbonVertexAttributeConstants.POSITION].data;this.params.vvSizeEnabled?f*=a.clamp(this.params.vvSizeOffset[0]+c[B.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],
this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):c[B.RibbonVertexAttributeConstants.SIZE]&&(f*=c[B.RibbonVertexAttributeConstants.SIZE].data[0]);var m=e.camera,r=O;k.vec2.copy(r,e.point);f=f*m.pixelRatio/2+4*m.pixelRatio;n.vec3.set(ca[0],r[0]-f,r[1]+f,0);n.vec3.set(ca[1],r[0]+f,r[1]+f,0);n.vec3.set(ca[2],r[0]+f,r[1]-f,0);n.vec3.set(ca[3],r[0]-f,r[1]-f,0);for(var w=0;4>w;w++)m.unprojectPoint(ca[w],U[w]);g.plane.fromPoints(m.eye,U[0],U[1],ea);g.plane.fromPoints(m.eye,U[1],U[2],ha);g.plane.fromPoints(m.eye,
U[2],U[3],ka);g.plane.fromPoints(m.eye,U[3],U[0],ba);c=Number.MAX_VALUE;for(var t=this.params.isClosed?b.length-2:b.length-5,w=0;w<t;w+=3){L[0]=b[w]+d[12];L[1]=b[w+1]+d[13];L[2]=b[w+2]+d[14];var l=(w+3)%b.length;P[0]=b[l]+d[12];P[1]=b[l+1]+d[13];P[2]=b[l+2]+d[14];if(!(0>g.plane.signedDistance(ea,L)&&0>g.plane.signedDistance(ea,P)||0>g.plane.signedDistance(ha,L)&&0>g.plane.signedDistance(ha,P)||0>g.plane.signedDistance(ka,L)&&0>g.plane.signedDistance(ka,P)||0>g.plane.signedDistance(ba,L)&&0>g.plane.signedDistance(ba,
P))){m.projectPoint(L,Q);m.projectPoint(P,T);if(0>Q[2]&&0<T[2]){n.vec3.subtract(S,L,P);var l=m.frustum,x=-g.plane.signedDistance(l.planes[4],L),l=x/n.vec3.dot(S,l.planes[4]);n.vec3.scale(S,S,l);n.vec3.add(L,L,S);m.projectPoint(L,Q)}else if(0<Q[2]&&0>T[2])n.vec3.subtract(S,P,L),l=m.frustum,x=-g.plane.signedDistance(l.planes[4],P),l=x/n.vec3.dot(S,l.planes[4]),n.vec3.scale(S,S,l),n.vec3.add(P,P,S),m.projectPoint(P,T);else if(0>Q[2]&&0>T[2])continue;Q[2]=0;T[2]=0;l=g.lineSegment.distance2(g.lineSegment.fromPoints(Q,
T,Z),r);l<c&&(c=l,n.vec3.copy(Y,L),n.vec3.copy(N,P))}}d=e.rayBeginPoint;e=e.rayEndPoint;c<f*f&&(b=Number.MAX_VALUE,g.lineSegment.closestLineSegmentPoint(g.lineSegment.fromPoints(Y,N,Z),g.lineSegment.fromPoints(d,e,W),R)&&(n.vec3.subtract(R,R,d),b=n.vec3.length(R),n.vec3.scale(R,R,1/b),b/=n.vec3.distance(d,e)),h(b,R))}else E.error("intersection assumes a translation-only matrix")};c.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in
a?a.vertexAttr:null)?u.computeAttachmentOriginLines(a[B.RibbonVertexAttributeConstants.POSITION],null,b):null};c.prototype.createLayout=function(){var a=r.newLayout().vec3f(B.RibbonVertexAttributeConstants.POSITION).f32(B.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(B.RibbonVertexAttributeConstants.UV0).vec3f(B.RibbonVertexAttributeConstants.AUXPOS1).vec3f(B.RibbonVertexAttributeConstants.AUXPOS2);this.params.vvSizeEnabled?a.f32(B.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):a.f32(B.RibbonVertexAttributeConstants.SIZE);
this.params.vvColorEnabled?a.f32(B.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):a.vec4f(B.RibbonVertexAttributeConstants.COLOR);this.params.vvOpacityEnabled&&a.f32(B.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE);return a};c.prototype.createBufferWriter=function(){return new I(this.layout,this.params)};c.prototype.createRenderer=function(a,b){return new w(a,b,this,B.ribbonVertexAttributeLocations)};c.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new G(a):
void 0};c.prototype.validateParams=function(){this.params.width&&1<this.params.width&&(this.params.width=Math.round(this.params.width));"miter"!==this.params.join&&(this.params.miterLimit=0)};return c}(x.Material);var G=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(A.RibbonLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=
function(a){return 0===this.output?a===(this.technique.configuration.writeDepth?6:9):4===a};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPipelineState(a);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(t.GLMaterial),J=f({width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,isClosed:!1},
y.Default),I=function(){function a(a,b){this.params=b;this.numJoinSubdivisions=this.numCapSubdivisions=0;this.vertexBufferLayout=a;if(!b.isClosed)switch(this.params.cap){case "butt":this.numCapSubdivisions=0;break;case "square":this.numCapSubdivisions=1;break;case "round":this.numCapSubdivisions=K}switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=b.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=H}}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){var b=2*this.numCapSubdivisions+2,c=a.indices[B.RibbonVertexAttributeConstants.POSITION].length/2+1,d=this.params.isClosed,b=d?2:2*b,c=d?c:c-1;if(a.vertexAttr[B.RibbonVertexAttributeConstants.SUBDIVISIONS])for(a=a.vertexAttr[B.RibbonVertexAttributeConstants.SUBDIVISIONS].data,d=d?0:1;d<c;++d)b+=4+2*a[d];else b+=c*(2*this.numJoinSubdivisions+4);return b+2};a.prototype.write=function(a,b,c,d){var e=this,g=aa,k=V,f=F,h=b.vertexAttr[B.RibbonVertexAttributeConstants.POSITION].data,
m=b.indices&&b.indices[B.RibbonVertexAttributeConstants.POSITION];m&&m.length!==2*(h.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");m=null;b.vertexAttr[B.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(m=b.vertexAttr[B.RibbonVertexAttributeConstants.SUBDIVISIONS].data);var p=1,r=0;this.params.vvSizeEnabled?r=b.vertexAttr[B.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:b.vertexAttr[B.RibbonVertexAttributeConstants.SIZE]&&(p=b.vertexAttr[B.RibbonVertexAttributeConstants.SIZE].data[0]);
var w=[1,1,1,1],t=0;this.params.vvColorEnabled?t=b.vertexAttr[B.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:b.vertexAttr[B.RibbonVertexAttributeConstants.COLOR]&&(w=b.vertexAttr[B.RibbonVertexAttributeConstants.COLOR].data);var v=0;this.params.vvOpacityEnabled&&(v=b.vertexAttr[B.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);b=h.length/3;a=a.transformation;var l=new Float32Array(c.buffer);c=this.vertexBufferLayout.stride/4;var x=d*c;d=x;var y=function(a,b,c,d,g,
k){l[x++]=b[0];l[x++]=b[1];l[x++]=b[2];l[x++]=d;l[x++]=g;l[x++]=k;l[x++]=a[0];l[x++]=a[1];l[x++]=a[2];l[x++]=c[0];l[x++]=c[1];l[x++]=c[2];e.params.vvSizeEnabled?l[x++]=r:l[x++]=p;e.params.vvColorEnabled?l[x++]=t:(l[x++]=w[0],l[x++]=w[1],l[x++]=w[2],l[x++]=w[3]);e.params.vvOpacityEnabled&&(l[x++]=v)},x=x+c;n.vec3.set(k,h[0],h[1],h[2]);a&&n.vec3.transformMat4(k,k,a);var u=this.params.isClosed;if(u){var A=h.length-3;n.vec3.set(g,h[A],h[A+1],h[A+2]);a&&n.vec3.transformMat4(g,g,a)}else{n.vec3.copy(g,k);
n.vec3.set(f,h[3],h[4],h[5]);a&&n.vec3.transformMat4(f,f,a);for(A=0;A<this.numCapSubdivisions;++A){var E=1-A/this.numCapSubdivisions;y(g,k,f,E,1,-4);y(g,k,f,E,1,4)}y(g,k,f,0,0,-4);y(g,k,f,0,0,4);n.vec3.copy(g,k);n.vec3.copy(k,f)}for(var G=u?b:b-1,A=u?0:1;A<G;A++){E=(A+1)%b*3;n.vec3.set(f,h[E+0],h[E+1],h[E+2]);a&&n.vec3.transformMat4(f,f,a);y(g,k,f,0,1,-1);y(g,k,f,0,1,1);for(var H=m?m[A]:this.numJoinSubdivisions,q=0;q<H;++q)E=(q+1)/(H+1),y(g,k,f,E,1,-2),y(g,k,f,E,1,2);y(g,k,f,1,0,-2);y(g,k,f,1,0,2);
n.vec3.copy(g,k);n.vec3.copy(k,f)}if(u)x=C(l,d+c,l,x,2*c);else for(y(g,k,f,0,1,-5),y(g,k,f,0,1,5),A=0;A<this.numCapSubdivisions;++A)E=(A+1)/this.numCapSubdivisions,y(g,k,f,E,1,-5),y(g,k,f,E,1,5);C(l,d+c,l,d,c);x=C(l,x-c,l,x,c)};return a}(),K=3,H=1,L=c.vec3f64.create(),P=c.vec3f64.create(),S=c.vec3f64.create(),R=c.vec3f64.create(),O=c.vec3f64.create(),Q=d.createRenderScreenPointArray3(),T=d.createRenderScreenPointArray3(),Y=c.vec3f64.create(),N=c.vec3f64.create(),Z=g.lineSegment.create(),W=g.lineSegment.create(),
aa=c.vec3f64.create(),V=c.vec3f64.create(),F=c.vec3f64.create(),ca=[d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3(),d.createRenderScreenPointArray3()],U=[c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create(),c.vec3f64.create()],ea=g.plane.create(),ha=g.plane.create(),ka=g.plane.create(),ba=g.plane.create();return q})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat3f64",
"../../../../core/libs/gl-matrix-2/vec3f32"],function(q,b,l,f){var h;(h||(h={})).Default={vvSizeEnabled:!1,vvSizeMinSize:f.vec3f32.fromValues(1,1,1),vvSizeMaxSize:f.vec3f32.fromValues(100,100,100),vvSizeOffset:f.vec3f32.fromValues(0,0,0),vvSizeFactor:f.vec3f32.fromValues(1,1,1),vvSizeValue:f.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],
vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:l.mat3f64.create()};return h})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./RibbonLine.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x){Object.defineProperty(b,"__esModule",{value:!0});b.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};b.ribbonVertexAttributeLocations={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,
auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};h=function(f){function h(a,b){b=f.call(this,a,b)||this;b.stipplePattern=null;b.stippleTextureBind=null;b.stippleTextureRepository=a.stippleTextureRepository;return b}l(h,f);h.prototype.initializeProgram=function(a){var c=h.shader.get(),d=this.configuration,c=c.build({output:d.output,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:d.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled,roundCaps:d.roundCaps,roundJoins:d.roundJoins,vvColor:d.vvColor,vvSize:d.vvSize,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity});return new t(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.ribbonVertexAttributeLocations)};h.prototype.dispose=function(){f.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);
this.stippleTextureBind=this.stipplePattern=null};h.prototype.bindPass=function(b,d,g){4===this.configuration.output&&n.OutputHighlight.bindOutputHighlight(b,this.program,g);this.program.setUniform1f("symbolLineWidth",d.width);this.program.setUniform4fv("symbolColor",d.color);this.program.setUniform1f("miterLimit","miter"!==d.join?0:d.miterLimit);this.program.setUniform1f("nearPlane",g.nearFar[0]);this.program.setUniform1f("pixelRatio",g.pixelRatio);this.program.setUniform2fv("screenSize",[g.viewport[2],
g.viewport[3]]);c.VisualVariables.bindUniformsWithOpacity(this.program,d);if(this.stipplePattern!==d.stipplePattern){var k=d.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,k);this.stipplePattern=k}this.configuration.stippleEnabled&&(b=e.isSome(this.stippleTextureBind)?this.stippleTextureBind(b,0)*g.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/b),this.configuration.stippleOffColorEnabled&&
(d=a.expect(d.stippleOffColor),this.program.setUniform4f("stippleOffColor",d[0],d[1],d[2],3<d.length?d[3]:1)))};h.prototype.bindDraw=function(a){k.Transform.bindUniforms(this.program,a);d.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};h.prototype.initializePipeline=function(){var a=this.configuration;return 0===a.output?x.makePipelineState({blending:x.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&v,depthTest:{func:513},depthWrite:!a.transparent&&a.writeDepth&&
x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams}):x.makePipelineState({polygonOffset:a.polygonOffset&&v,depthTest:{func:513},depthWrite:!a.transparent&&a.writeDepth&&x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};h.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};Object.defineProperty(h.prototype,"primitiveType",{get:function(){return 5},enumerable:!0,configurable:!0});h.shader=new g.ReloadableShaderModule(u,"./RibbonLine.glsl",q);return h}(r.ShaderTechnique);
b.RibbonLineTechnique=h;var v={factor:0,units:-4};h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!1;b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;b.roundCaps=!1;b.roundJoins=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;return b}l(b,a);f([p.parameter({count:7})],b.prototype,"output",void 0);f([p.parameter()],b.prototype,
"slicePlaneEnabled",void 0);f([p.parameter()],b.prototype,"sliceHighlightDisabled",void 0);f([p.parameter()],b.prototype,"vertexColors",void 0);f([p.parameter()],b.prototype,"transparent",void 0);f([p.parameter()],b.prototype,"polygonOffset",void 0);f([p.parameter()],b.prototype,"writeDepth",void 0);f([p.parameter()],b.prototype,"stippleEnabled",void 0);f([p.parameter()],b.prototype,"stippleOffColorEnabled",void 0);f([p.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);f([p.parameter()],
b.prototype,"roundCaps",void 0);f([p.parameter()],b.prototype,"roundJoins",void 0);f([p.parameter()],b.prototype,"vvSize",void 0);f([p.parameter()],b.prototype,"vvColor",void 0);f([p.parameter()],b.prototype,"vvOpacity",void 0);return b}(p.ShaderTechniqueConfiguration);b.RibbonLineTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/RibbonLine.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderLibrary/shading/PiUtils.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new k.ShaderBuilder;q.extensions.add("GL_OES_standard_derivatives");q.include(e.PiUtils);q.include(h.RibbonVertexPosition,b);q.include(a.LineStipple,b);q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("nearPlane","float").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");q.attributes.add("position","vec3");q.attributes.add("subdivisionFactor",
"float");q.attributes.add("uv0","vec2");q.attributes.add("auxpos1","vec3");q.attributes.add("auxpos2","vec3");q.varyings.add("vColor","vec4");q.varyings.add("vpos","vec3");q.vertex.code.add(d.glsl(n||(n=l(["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"],
["\n\t\t#define PERPENDICULAR(v) vec2(v.y, -v.x);\n\t\t#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\n\n\t\tfloat interp(float ncp, vec4 a, vec4 b) {\n\t\t\treturn (-ncp - a.z) / (b.z - a.z);\n\t\t}\n\n\t\tvec2 rotate(vec2 v, float a) {\n\t\t\tfloat s \x3d sin(a);\n\t\t\tfloat c \x3d cos(a);\n\t\t\tmat2 m \x3d mat2(c, -s, s, c);\n\t\t\treturn m * v;\n\t\t}\n"]))));q.vertex.code.add(d.glsl(c||(c=l(["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"],
["\n    vec4 projectAndScale(vec4 pos) {\n      vec4 posNdc \x3d proj * pos;\n\n      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system\n      // that is twice scaled (going from -size:size).\n      posNdc.xy *\x3d screenSize / posNdc.w;\n      return posNdc;\n    }\n"]))));q.vertex.code.add(d.glsl(g||(g=l(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"],
["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp \x3d nearPlane*0.99;\n\n      //current pos behind ncp --\x3e we need to clip\n      if(pos.z \x3e -nearPlane) {\n        if (!isStartVertex) {\n          //previous in front of ncp\n          if(prev.z \x3c -nearPlane) {\n            pos \x3d mix(prev, pos, interp(vnp, prev, pos));\n            next \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n        //next in front of ncp\n        if(isStartVertex) {\n          if(next.z \x3c -nearPlane) {\n            pos \x3d mix(pos, next, interp(vnp, pos, next));\n            prev \x3d pos;\n          } else {\n            pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        //previous behind ncp\n        if (prev.z \x3e -nearPlane) {\n          prev \x3d mix(pos, prev, interp(vnp, pos, prev));\n        }\n        //next behind ncp\n        if (next.z \x3e -nearPlane) {\n          next \x3d mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      pos \x3d projectAndScale(pos);\n      next \x3d projectAndScale(next);\n      prev \x3d projectAndScale(prev);\n    }\n"]))));
q.vertex.code.add(d.glsl(r||(r=l(["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if( lineWidth\x3c1.0 ){\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }\n\n      vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "],
["\n  void main(void) {\n    float coverage \x3d 1.0;\n    vpos \x3d (model * vec4(position, 1.0)).xyz;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y \x3d\x3d 0.0) {\n      // Project out of clip space\n      gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isStartVertex \x3d abs(abs(uv0.y)-3.0) \x3d\x3d 1.0;\n      bool isJoin \x3d abs(uv0.y)-3.0 \x3c 0.0;\n\n      float lineWidth \x3d getSize() * pixelRatio;\n\n      // convert sub-pixel coverage to alpha\n      if( lineWidth\x3c1.0 ){\n        coverage \x3d lineWidth;\n        lineWidth \x3d 1.0;\n      }\n\n      vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\n      vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\n      vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\n\n      clipAndTransform(pos, prev, next, isStartVertex);\n\n      vec2 left \x3d (pos.xy - prev.xy);\n      vec2 right \x3d (next.xy - pos.xy);\n\n      float leftLen \x3d length(left);\n      float rightLen \x3d length(right);\n  "]))));
b.stippleEnabled&&q.vertex.code.add(d.glsl(p||(p=l(["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "],
["\n      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment\n      // or the end. If start, then use pos-\x3enext, otherwise use prev-\x3epos to define the line segment\n      // vector\n      vec4 stippleSegmentInfo \x3d mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);\n      vec2 stippleSegmentOrigin \x3d stippleSegmentInfo.xy;\n\n      // Scale s.t. it's in units of stipple pattern size.\n      vec2 stippleSegmentDirection \x3d stippleSegmentInfo.zw;\n    "]))));
q.vertex.code.add(d.glsl(u||(u=l(['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // computer miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg*left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n    '],
['\n    left \x3d (leftLen \x3e 0.001) ? left/leftLen : vec2(0.0, 0.0);\n    right \x3d (rightLen \x3e 0.001) ? right/rightLen : vec2(0.0, 0.0);\n\n    vec2 capDisplacementDir \x3d vec2(0, 0);\n    vec2 joinDisplacementDir \x3d vec2(0, 0);\n    float displacementLen \x3d lineWidth;\n\n    if (isJoin) {\n\n      // JOIN handling ---------------------------------------------------\n      // determine if vertex is on the "outside or "inside" of the join\n      bool isOutside \x3d ISOUTSIDE;\n\n      // compute miter join position first\n      joinDisplacementDir \x3d normalize(left + right);\n      joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n\n      // computer miter stretch\n      if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\n        float nDotSeg \x3d dot(joinDisplacementDir, left);\n        displacementLen /\x3d length(nDotSeg*left - joinDisplacementDir);\n\n        // limit displacement of inner vertices\n        if (!isOutside) {\n          displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n        }\n      }\n\n      if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\n    ']))));
b.roundJoins?q.vertex.code.add(d.glsl(t||(t=l(["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "],
["\n        vec2 startDir;\n        vec2 endDir;\n\n        if (leftLen \x3c 0.001) {\n          startDir \x3d right;\n        }\n        else{\n          startDir \x3d left;\n        }\n        startDir \x3d normalize(startDir);\n        startDir \x3d PERPENDICULAR(startDir);\n\n        if (rightLen \x3c 0.001) {\n          endDir \x3d left;\n        }\n        else{\n          endDir \x3d right;\n        }\n        endDir \x3d normalize(endDir);\n        endDir \x3d PERPENDICULAR(endDir);\n\n        float rotationAngle \x3d acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir \x3d rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);\n      "])))):
q.vertex.code.add(d.glsl(x||(x=l(["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "],
["\n        // convert to bevel join if miterLimit is exceeded\n        if (leftLen \x3c 0.001) {\n          joinDisplacementDir \x3d right;\n        }\n        else if (rightLen \x3c 0.001) {\n          joinDisplacementDir \x3d left;\n        }\n        else {\n          joinDisplacementDir \x3d isStartVertex ? right : left;\n        }\n        joinDisplacementDir \x3d normalize(joinDisplacementDir);\n        joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n  "]))));q.vertex.code.add(d.glsl(v||
(v=l(["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "],
["\n        displacementLen \x3d lineWidth;\n      }\n    } else {\n    // CAP handling ---------------------------------------------------\n    if (leftLen \x3c 0.001) {\n      joinDisplacementDir \x3d right;\n    }\n    else if (rightLen \x3c 0.001) {\n      joinDisplacementDir \x3d left;\n    }\n    else {\n      joinDisplacementDir \x3d isStartVertex ? right : left;\n    }\n    joinDisplacementDir \x3d normalize(joinDisplacementDir);\n    joinDisplacementDir \x3d PERPENDICULAR(joinDisplacementDir);\n    displacementLen \x3d lineWidth;\n\n    capDisplacementDir \x3d isStartVertex ? -right : left;\n  "]))));
b.roundCaps?q.vertex.code.add(d.glsl(y||(y=l(["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "],["\n    float angle \x3d subdivisionFactor*PI*0.5;\n    joinDisplacementDir *\x3d cos(angle);\n    capDisplacementDir *\x3d sin(angle);\n    "])))):q.vertex.code.add(d.glsl(m||(m=l(["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "],["\n    capDisplacementDir *\x3d subdivisionFactor;\n    "]))));q.vertex.code.add(d.glsl(w||
(w=l(["\n  }\n\n  pos.xy +\x3d joinDisplacementDir * sign(uv0.y) * displacementLen;\n  pos.xy +\x3d capDisplacementDir * displacementLen;\n  "],["\n  }\n\n  pos.xy +\x3d joinDisplacementDir * sign(uv0.y) * displacementLen;\n  pos.xy +\x3d capDisplacementDir * displacementLen;\n  "]))));b.stippleEnabled&&(q.vertex.code.add(d.glsl(A||(A=l(["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "],
["\n    {\n      // Compute the stipple pattern UV coordinate from the actual position, based on the origin\n      // and direction of the line segment on which the stipple pattern is based.\n\n      // Project the vector from the origin of the segment to the vertex onto the line segment.\n      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)\n      vec2 posVec \x3d pos.xy - stippleSegmentOrigin;\n\n      float stippleSegmentDirectionLength \x3d length(stippleSegmentDirection);\n    "])))),
b.stippleIntegerRepeatsEnabled&&q.vertex.code.add(d.glsl(B||(B=l(["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "],["\n      float numberOfPatternRepeats \x3d stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;\n      float roundedNumberOfPatternRepeats \x3d max(1.0, floor(numberOfPatternRepeats + 0.5));\n      stipplePatternUvMax \x3d roundedNumberOfPatternRepeats;\n      "])))),
q.vertex.code.add(d.glsl(C||(C=l(["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ","\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "],["\n      if (stippleSegmentDirectionLength \x3e\x3d 0.001) {\n        // Project the vertex position onto the line segment.\n        float projectedLength \x3d dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;\n     ",
"\n        stipplePatternUv \x3d projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;\n        } else {\n          stipplePatternUv \x3d 1.0;\n        }\n      }\n    "])),b.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;")));q.vertex.code.add(d.glsl(E||(E=l(["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "],
["\n      // Convert back into NDC\n      pos.xy \x3d pos.xy / screenSize * pos.w;\n\n      vColor \x3d getColor();\n      vColor.a *\x3d coverage;\n\n      gl_Position \x3d pos;\n    }\n  }\n  "]))));q.include(f.Slice,b);0===b.output&&(q.fragment.uniforms.add("symbolColor","vec4"),q.fragment.code.add(d.glsl(G||(G=l(["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n      vec4 color \x3d symbolColor * vColor;\n      gl_FragColor \x3d highlightSlice(blendStipple(color, stippleAlpha), vpos);\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n      vec4 color \x3d symbolColor * vColor;\n      gl_FragColor \x3d highlightSlice(blendStipple(color, stippleAlpha), vpos);\n    }\n    "])))));4===b.output&&q.fragment.code.add(d.glsl(J||(J=l(["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n        discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n        gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "]))));return q};var n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});b.RibbonVertexPosition=function(b,g){b.vertex.uniforms.add("symbolLineWidth","float");g.vvSize?(b.attributes.add("sizeFeatureAttribute","float"),b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(f.glsl(h||(h=l(["\n    float getSize() {\n      return symbolLineWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "],
["\n    float getSize() {\n      return symbolLineWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n    }\n    "]))))):(b.attributes.add("size","float"),b.vertex.code.add(f.glsl(a||(a=l(["\n    float getSize(){\n      return symbolLineWidth * size;\n    }\n    "],["\n    float getSize(){\n      return symbolLineWidth * size;\n    }\n    "])))));g.vvOpacity?(b.attributes.add("opacityFeatureAttribute","float"),b.vertex.defines.addInt("VV_OPACITY_N",
8),b.vertex.code.add(f.glsl(e||(e=l(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    float interpolateOpacity( float value ){\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vvOpacityOpacities[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n        }\n      }\n\n      return vvOpacityOpacities[VV_OPACITY_N - 1];\n    }\n\n    vec4 applyOpacity( vec4 color ){\n      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n    }\n    "]))))):
b.vertex.code.add(f.glsl(d||(d=l(["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity( vec4 color ){\n      return color;\n    }\n    "]))));g.vvColor?(b.attributes.add("colorFeatureAttribute","float"),b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(f.glsl(k||(k=l(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 interpolateColor( float value ) {\n      if (value \x3c\x3d vvColorValues[0]) {\n        return vvColorColors[0];\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return mix(vvColorColors[i-1], vvColorColors[i], f);\n        }\n      }\n\n      return vvColorColors[VV_COLOR_N - 1];\n    }\n\n    vec4 getColor(){\n      return applyOpacity(interpolateColor(colorFeatureAttribute));\n    }\n    "]))))):
(b.attributes.add("color","vec4"),b.vertex.code.add(f.glsl(n||(n=l(["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(color);\n    }\n    "])))))};var h,a,e,d,k,n})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",
{value:!0});b.LineStipple=function(b,n){b.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001);b.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5);n.stippleEnabled?(b.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),n.stippleUVMaxEnabled&&b.varyings.add("stipplePatternUvMax","float"),b.varyings.add("stipplePatternUv","float"),b.fragment.uniforms.add("stipplePatternTexture","sampler2D"),n.stippleOffColorEnabled&&b.fragment.uniforms.add("stippleOffColor","vec4"),b.fragment.code.add(f.glsl(h||
(h=l(["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"],["\n  float getStippleAlpha() {\n    float stipplePatternUvClamped \x3d stipplePatternUv * gl_FragCoord.w;\n    ","\n\n    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;\n  }"])),n.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":
"")),n.stippleOffColorEnabled?b.fragment.code.add(f.glsl(a||(a=l(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "],["\n    #define discardByStippleAlpha(stippleAlpha, threshold) {}\n    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)\n    "])))):b.fragment.code.add(f.glsl(e||(e=l(["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "],
["\n    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha \x3c threshold) { discard; }\n    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)\n    "]))))):b.fragment.code.add(f.glsl(d||(d=l(["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "],["\n  float getStippleAlpha() { return 1.0; }\n\n  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n  #define blendStipple(color, _stippleAlpha_) color\n  "]))))};
var h,a,e,d})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],function(q,b){return function(){function b(b,h,a,e,d,k){this.camera=null;this.slot=this.pass=0;this.options=this.highlightDepthTexture=null;this.renderOccludedMask=5;this.rctx=b;this.offscreenRenderingHelper=h;this.scenelightingData=a;this.shadowMap=e;this.ssaoHelper=d;this.sliceHelper=k}b.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=5};Object.defineProperty(b.prototype,"isHighlightPass",
{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/renderStats":function(){define(["require","exports"],function(q,b){function l(){return{triangles:0,drawCalls:0}}Object.defineProperty(b,"__esModule",{value:!0});b.makeNewRenderStats=l;q=function(){function b(){this.materialRenderStats=new Map;this.reset()}b.prototype.getMaterialRenderStatsObject=function(b){var a=this.materialRenderStats.get(b);a||(a=l(),this.materialRenderStats.set(b,
a));return a};b.prototype.getAggregatedStats=function(){var b={materialRenderers:{},total:l()};this.materialRenderStats.forEach(function(a,e){b.materialRenderers[e]=a;b.total.drawCalls+=a.drawCalls;b.total.triangles+=a.triangles});return b};b.prototype.reset=function(){this.materialRenderStats.forEach(function(b){b.drawCalls=0;b.triangles=0})};return b}();b.RenderStatsAggregator=q})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define(["require","exports","../../../../core/iteratorUtils",
"../../../../core/PooledArray","./rendererUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){return function(){}}();q=function(){function b(b,e,h){this._rctx=b;this._materialRep=e;this.emitUpdatingChanged=h;this._pendingAddsRemoves=new Map;this._adds=new f;this._removes=new f;this._updates=new f({allocator:function(b){return b?b:new a},deallocator:function(a){a.renderGeometry=null;return a}});this._materialRenderers=new Map;this._sortedMaterialRenderers=
new f;this._hasWater=this._hasHighlights=!1}b.prototype.dispose=function(){this._adds.prune();this._removes.prune();this._updates.prune()};Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasWater",{get:function(){return this._hasWater},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isEmpty",{get:function(){return!this.updating&&0===this._materialRenderers.size},enumerable:!0,configurable:!0});b.prototype.commitChanges=function(){var a=this,b=!1;if(!this.updating)return!1;this.updateAddsRemoves();var e=!1,c=!1;h.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}).forEach(function(d,
k){var g=a._materialRenderers.get(k);!g&&0<d.toAdd.length&&(g=k.createRenderer(a._rctx,a._materialRep),a._materialRenderers.set(k,g),c=e=b=!0);if(g){var f=e||g.hasHighlights,h=c||g.hasWater;g.modify(d);e=e||f!==g.hasHighlights;c=c||h!==g.hasWater;g.isEmpty&&(a._materialRenderers.delete(k),g.dispose(),b=!0)}});this._adds.clear();this._removes.clear();this._updates.clear();this._pendingAddsRemoves.clear();b&&this.updateSortedMaterialRenderers();e&&(this._hasHighlights=l.someMap(this._materialRenderers,
function(a){return a.hasHighlights}));c&&(this._hasWater=l.someMap(this._materialRenderers,function(a){return a.hasWater}));this.emitUpdatingChanged();return!0};b.prototype.add=function(a){for(var b=0===this._pendingAddsRemoves.size,d=0;d<a.length;d++)this._pendingAddsRemoves.set(a[d],0);b&&0<this._pendingAddsRemoves.size&&this.emitUpdatingChanged()};b.prototype.remove=function(a){for(var b=0===this._pendingAddsRemoves.size,d=0;d<a.length;d++){var c=a[d],e=this._pendingAddsRemoves.get(c);0===e?this._pendingAddsRemoves.set(c,
2):2!==e&&this._pendingAddsRemoves.set(c,1)}b&&0<this._pendingAddsRemoves.size&&this.emitUpdatingChanged()};b.prototype.modify=function(a,b){for(var d=0===this._updates.length,c=0;c<a.length;c++){var e=a[c],k=this._updates.pushNew();k.renderGeometry=e;k.updateType=b}d&&0<this._updates.length&&this.emitUpdatingChanged()};b.prototype.updateLogic=function(a){for(var b=!1,d=0;d<this._sortedMaterialRenderers.length;d++){var c=this._sortedMaterialRenderers.data[d];c.updateLogic&&c.updateLogic(a)&&(b=!0)}return b};
b.prototype.draw=function(a,b,e){for(var c=0;c<this._sortedMaterialRenderers.length;c++){var d=this._sortedMaterialRenderers.data[c],k=e.getMaterialRenderStatsObject(d.type);d.render(null,a,b,k)}};b.prototype.updateSortedMaterialRenderers=function(){var a=this;this._sortedMaterialRenderers.clear();this._materialRenderers.forEach(function(b){a._sortedMaterialRenderers.push(b)});this._sortedMaterialRenderers.sort(function(a,b){return b.renderPriority()-a.renderPriority()})};b.prototype.updateAddsRemoves=
function(){var a=this;this._adds.clear();this._removes.clear();this._pendingAddsRemoves.forEach(function(b,c){switch(b){case 0:a._adds.push(c);break;case 1:a._removes.push(c)}});for(var b=0;b<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[b].renderGeometry)?this._updates.removeUnorderedIndex(b):b++};Object.defineProperty(b.prototype,"test",{get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}},enumerable:!0,configurable:!0});return b}();b.SortedRenderGeometryRenderer=
q})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["require","exports","./Util"],function(q,b,l){function f(b){return!1===b.preinterleaved?l.getFirstObjectValue(b.indices).length:b.indexCount}Object.defineProperty(b,"__esModule",{value:!0});b.splitRenderGeometryChangeSetByMaterial=function(b){for(var a=new Map,e=null,d=null,k=function(b){if(b===e)return d;var c=a.get(b);c||(c={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},a.set(b,c));e=b;return d=
c},h=0;h<b.numToAdd;h++){var c=b.toAdd[h];if(1<=f(c.data)){var g=k(c.material);g.toAdd.push(c)}}for(h=0;h<b.numToRemove;h++)c=b.toRemove[h],1<=f(c.data)&&(g=k(c.material),g.toRemove.push(c));for(h=0;h<b.numToUpdate;h++)c=b.toUpdate[h],1<=f(c.renderGeometry.data)&&(g=k(c.renderGeometry.material),g.toUpdate.push(c));return a}})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/util/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get().build();return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),n.Default3D)};d.prototype.initializePipeline=function(){return this.configuration.hasAlpha?g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),colorWrite:g.defaultColorWriteParams}):
g.makePipelineState({colorWrite:g.defaultColorWriteParams})};d.shader=new e.ReloadableShaderModule(a,"../core/shaderLibrary/util/TextureOnly.glsl",q);return d}(d.ShaderTechnique);b.TextureTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.hasAlpha=!1;return b}l(b,a);f([k.parameter()],b.prototype,"hasAlpha",void 0);return b}(k.ShaderTechniqueConfiguration);b.TextureTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureOnly.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/PositionAttribute.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new a.ShaderBuilder;b.include(f.PositionAttribute);b.attributes.add("uv0","vec2");b.varyings.add("vtc","vec2");b.vertex.code.add(h.glsl(e||(e=l(["\n    void main(void) {\n      gl_Position \x3d vec4(positionModel(), 1.0);\n      vtc \x3d uv0;\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(positionModel(), 1.0);\n      vtc \x3d uv0;\n    }\n  "]))));b.fragment.uniforms.add("tex","sampler2D");
b.fragment.uniforms.add("color","vec4");b.fragment.code.add(h.glsl(d||(d=l(["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, vtc);\n      gl_FragColor \x3d texColor * color;\n    }\n  "],["\n    void main() {\n      vec4 texColor \x3d texture2D(tex, vtc);\n      gl_FragColor \x3d texColor * color;\n    }\n  "]))));return b};var e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.PositionAttribute=function(a){a.attributes.add("position","vec3");a.vertex.code.add(f.glsl(h||(h=l(["\n    vec3 positionModel() { return position; }\n  "],["\n    vec3 positionModel() { return position; }\n  "]))))};var h})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64",
"./SphericalHarmonics"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=f.vec3f64.create();q=function(){function b(){this._renderLighting={main:{intensity:f.vec3f64.create(),direction:f.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight={direction:f.vec3f64.create(),ambient:{color:f.vec3f64.create(),intensity:0},diffuse:{color:f.vec3f64.create(),intensity:0}}}b.prototype.setLightDirectionUniform=function(a){a.setUniform3fv("lightingMainDirection",
this._renderLighting.main.direction)};b.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(a);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===
this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),
a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]))};b.prototype.set=function(b){this._info=b;h.combineLights(b.lights,this._shOrder,this._renderLighting);l.vec3.negate(this._oldSunlight.direction,this._renderLighting.main.direction);b=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*
this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*b;this._oldSunlight.diffuse.color[1]=this._renderLighting.main.intensity[1]*b;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*b;
this._oldSunlight.diffuse.intensity=1;b=l.vec3.copy(a,this._oldSunlight.diffuse.color);l.vec3.scale(b,b,.4*this._info.globalFactor);l.vec3.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,b)};Object.defineProperty(b.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"old",{get:function(){return this._oldSunlight},enumerable:!0,configurable:!0});return b}();b.SceneLighting=q})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),
function(q,b,l,f,h,a,e){function d(a){return(a+1)*(a+1)}function k(a){return l.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function n(a,b,c){var e=a[0],g=a[1];a=a[2];c=c||[];c.length=d(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*e,c[2]=.4886025119*a,c[3]=.4886025119*g);2<=b&&(c[4]=1.09254843059*e*g,c[5]=1.09254843059*g*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*e*a,c[8]=.54627421529*(e*e-g*g));return c}function c(a,b){a=d(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function g(b,c){for(var d=k(c.r.length),e=0;e<b.length;e++){var g=b[e];f.vec3.negate(y,g.direction);n(y,d,x);a.elementwiseProduct(x,m);a.scalarProduct(x,g.intensity[0],v);a.add(c.r,v);a.scalarProduct(x,g.intensity[1],v);a.add(c.g,v);a.scalarProduct(x,g.intensity[2],v);a.add(c.b,v)}return c}function r(a,b){n(y,0,x);for(var c=0;c<a.length;c++){var d=a[c];b.r[0]+=x[0]*m[0]*d.intensity[0]*4*Math.PI;b.g[0]+=x[0]*m[0]*d.intensity[1]*4*Math.PI;b.b[0]+=x[0]*m[0]*
d.intensity[2]*4*Math.PI}return b}Object.defineProperty(b,"__esModule",{value:!0});b.numberOfCoefficients=d;b.numberOfCoefficientsInBand=function(a){return 2*a+1};b.orderFromNumberOfCoefficients=k;b.computeCoefficients=n;b.initSHCoefficients=c;b.projectFillLights=g;b.projectAmbientLights=r;b.combineLights=function(b,d,k){c(d,k.sphericalHarmonics.sh);f.vec3.set(k.main.intensity,0,0,0);var h=!1,m=p,n=u;d=t;m.length=0;n.length=0;for(var w=d.length=0;w<b.length;w++){var l=b[w];l instanceof e.MainLight&&
!h?(f.vec3.copy(k.main.direction,l.direction),k.main.intensity[0]=l.intensity[0],k.main.intensity[1]=l.intensity[1],k.main.intensity[2]=l.intensity[2],k.main.castShadows=l.castShadows,h=!0):l instanceof e.MainLight||l instanceof e.FillLight?m.push(l):l instanceof e.AmbientLight?n.push(l):l instanceof e.SphericalHarmonicsLight&&d.push(l)}g(m,k.sphericalHarmonics.sh);r(n,k.sphericalHarmonics.sh);for(b=0;b<d.length;b++)l=d[b],a.add(k.sphericalHarmonics.sh.r,l.sh.r),a.add(k.sphericalHarmonics.sh.g,l.sh.g),
a.add(k.sphericalHarmonics.sh.b,l.sh.b)};var p=[],u=[],t=[],x=[0],v=[0],y=h.vec3f64.create(),m=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.dotProduct=function(b,f){for(var h=0,a=0;a<b.length;a++)h+=b[a]*f[a];return h};b.elementwiseProduct=function(b,f,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=
b[a]*f[a];return h};b.scalarProduct=function(b,f,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=b[a]*f;return h};b.add=function(b,f,h){h=h||b;h.length=b.length;for(var a=0;a<b.length;a++)h[a]=b[a]+f[a];return h}})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../lib/GLMaterial ../lib/Material ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorMaterialTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){q=function(a){function b(b,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new c.ColorMaterialTechniqueConfiguration;d.params=k.copyParameters(b,r);return d}f(b,a);b.prototype.setParameterValues=function(a){d.updateParameters(this.params,a)&&this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=
this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;return this.techniqueConfig};b.prototype.getPassParameters=function(){return this.params};b.prototype.intersect=function(a,b,c,d,e,g,f){k.intersectTriangleGeometry(a,b,d,e,g,void 0,f)};b.prototype.getGLMaterial=function(a){return 0===
a.output||4===a.output?new g(a):void 0};b.prototype.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionColorLayout)};b.prototype.createRenderer=function(a,b){return new n(a,b,this)};return b}(a.Material);var g=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(c.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};
b.prototype.beginSlot=function(a){if(4===this.output)return 4===a;var b=4;this.technique.configuration.transparent&&(b=this.technique.configuration.writeDepth?6:9);return a===b};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);this.technique.bindPipelineState(a);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(h.GLMaterial),r={color:[1,1,1,1],transparent:!1,writeDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0};return q})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["require",
"exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.PositionLayout=l.newLayout().vec3f(f.VertexAttrConstants.POSITION);b.PositionUVLayout=l.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec2f(f.VertexAttrConstants.UV0);b.PositionColorLayout=l.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec4u8(f.VertexAttrConstants.COLOR);q=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=
function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[f.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,k,f){h.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,k,f)};return a}();b.DefaultBufferWriter=q})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./ColorMaterial.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}l(k,b);k.prototype.initializeProgram=function(a){var b=k.shader.get(),d=this.configuration,b=b.build({attributeColor:d.vertexColors,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new r(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),c.Default3D)};
k.prototype.bindPass=function(a,b,c){this.program.setUniform4fv("eColor",b.color)};k.prototype.bindDraw=function(b){e.Transform.bindUniforms(this.program,b);a.Slice.bindUniformsWithOrigin(this.program,this.configuration,b)};k.prototype.initializePipeline=function(){var a=this.configuration,b=0===a.output?a.transparent&&p.separateBlendingParams(770,1,771,771):null;return p.makePipelineState({blending:b,polygonOffset:a.polygonOffset&&{factor:1,units:1},culling:function(a){return 0!==a&&{face:1===a?
1028:1029,mode:2305}}(a.cullFace),depthTest:{func:513},depthWrite:a.writeDepth&&p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams})};k.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};k.shader=new d.ReloadableShaderModule(g,"./ColorMaterial.glsl",q);return k}(k.ShaderTechnique);b.ColorMaterialTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.cullFace=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=
!1;b.transparent=!1;b.polygonOffset=!1;b.writeDepth=!0;return b}l(b,a);f([n.parameter({count:7})],b.prototype,"output",void 0);f([n.parameter({count:3})],b.prototype,"cullFace",void 0);f([n.parameter()],b.prototype,"slicePlaneEnabled",void 0);f([n.parameter()],b.prototype,"sliceHighlightDisabled",void 0);f([n.parameter()],b.prototype,"vertexColors",void 0);f([n.parameter()],b.prototype,"transparent",void 0);f([n.parameter()],b.prototype,"polygonOffset",void 0);f([n.parameter()],b.prototype,"writeDepth",
void 0);return b}(n.ShaderTechniqueConfiguration);b.ColorMaterialTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/ColorMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});
b.build=function(b){var c=new d.ShaderBuilder;c.include(h.Transform,{linearDepth:!1});c.include(a.VertexColor,b);c.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4");c.attributes.add("position","vec3");c.varyings.add("vpos","vec3");c.vertex.code.add(e.glsl(k||(k=l(["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "],["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n    }\n  "]))));
c.include(f.Slice,b);c.fragment.uniforms.add("eColor","vec4");c.fragment.code.add(e.glsl(n||(n=l(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "],["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n    }\n    "])),b.attributeColor?"gl_FragColor \x3d vColor * eColor;":"gl_FragColor \x3d eColor;"));return c};var k,n})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.VertexColor=function(b,k){k.attributeColor?(b.attributes.add("color","vec4"),b.varyings.add("vColor","vec4"),b.vertex.code.add(f.glsl(h||(h=l(["\n      void forwardVertexColor() { vColor \x3d color; }\n    "],["\n      void forwardVertexColor() { vColor \x3d color; }\n    "])))),b.vertex.code.add(f.glsl(a||(a=l(["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "],
["\n      void forwardNormalizedVertexColor() { vColor \x3d color * 0.003921568627451; }\n    "]))))):b.vertex.code.add(f.glsl(e||(e=l(["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "],["\n      void forwardVertexColor() {}\n      void forwardNormalizedVertexColor() {}\n    "]))))};var h,a,e})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["require","exports","../../../../core/maybe","../../../webgl"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(){this.cache=new Map}b.prototype.dispose=function(){this.cache.forEach(function(a){l.isSome(a.texture)&&(a.texture.dispose(),a.texture=null)});this.cache.clear()};b.prototype.acquire=function(a){if(l.isNone(a))return null;var b=this.patternId(a),d=this.cache.get(b);if(d)return d.refCount++,d.bind;var k=this.patternToTextureData(a,2),h=k.length/2,c={refCount:1,texture:null,bind:function(a,b){l.isNone(c.texture)&&(c.texture=new f.Texture(a,{width:k.length,
height:1,internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},k));a.bindTexture(c.texture,b);return h}};this.cache.set(b,c);return c.bind};b.prototype.release=function(a){if(!l.isNone(a)){a=this.patternId(a);var b=this.cache.get(a);b&&(b.refCount--,0===b.refCount&&(l.isSome(b.texture)&&b.texture.dispose(),this.cache.delete(a)))}};b.prototype.swap=function(a,b){b=this.acquire(b);this.release(a);return b};b.prototype.bind=function(a,b,d,k,f){a=l.isSome(k)?k(a,f)*b.pixelRatio:1;d.setUniform1i("stipplePatternTexture",
f);d.setUniform1f("stipplePatternPixelSizeInv",1/a)};b.prototype.patternId=function(a){return a.join(",")};b.prototype.patternToTextureData=function(a,b){for(var d=a.reduce(function(a,b){return a+b})*b,d=new Uint8Array(d),e=!0,f=0,c=0;c<a.length;c++){for(var g=a[c],h=0;h<g*b;h++)d[f++]=e?255:0;e=!e}return d};return b}();b.StippleTextureRepository=q;b.createStipplePattern=function(b){return b.slice()};b.createStipplePatternSimple=function(b){return[b,b]}})},"esri/views/webgl":function(){define("require exports ./webgl/BufferObject ./webgl/enums ./webgl/FramebufferObject ./webgl/Program ./webgl/Renderbuffer ./webgl/RenderingContext ./webgl/ShaderCompiler ./webgl/Texture ./webgl/VertexArrayObject ./webgl/ProgramCache ./webgl/programUtils ./webgl/context-util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});b.BufferObject=l;b.enums=f;b.FramebufferObject=h;b.Program=a;b.Renderbuffer=e;b.RenderingContext=d;b.ShaderCompiler=k;b.Texture=n;b.VertexArrayObject=c;b.ProgramCache=g.ProgramCache;b.createProgram=r.createProgram;b.glslifyDefineMap=r.glslifyDefineMap;b.createContextOrErrorHTML=p.createContextOrErrorHTML})},"esri/views/webgl/enums":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",
{value:!0});b.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(q,b,l,f,h){return function(){function a(b,d,k,n){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=b;this._desc={colorTarget:d.colorTarget,depthStencilTarget:d.depthStencilTarget,width:d.width,height:d.height,multisampled:d.multisampled};this._id=
a._nextId++;k&&(b=void 0,k instanceof h?(this._colorAttachment=k,b=k.descriptor):(b=k,this._colorAttachment=new h(this._context,b)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(b,this._desc));n instanceof f?(2===d.depthStencilTarget?this._stencilAttachment=n:1===d.depthStencilTarget||3===d.depthStencilTarget?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
a._validateBufferDimensions(n.descriptor,this._desc)):n&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),d=void 0,n instanceof h?(this._depthStencilTexture=n,d=this._depthStencilTexture.descriptor):(d=n,this._depthStencilTexture=new h(this._context,d)),a._validateTextureDimensions(d,this._desc))}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof h?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorAttachment",{get:function(){return this._colorAttachment},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){if(this._context){var a=this._context,b=a.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(a.gl.deleteFramebuffer(this._glName),this._glName=null);a.bindFramebuffer(b);this._context=null}};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();
if(this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){if(this._colorAttachment instanceof h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null;return a}};a.prototype.attachDepthStencilTexture=
function(b){if(b){var d=b.descriptor;34041!==d.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==d.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(d,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=
4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),d=this._context.gl,d.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,b.glName,0));this._depthStencilTexture=b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=
null;return a};a.prototype.attachDepthStencilBuffer=function(b){if(b){var d=b.descriptor;34041!==d.internalFormat&&33189!==d.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");a._validateBufferDimensions(d,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===d.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),d=this._context.gl,d.framebufferRenderbuffer(d.FRAMEBUFFER,1===this._desc.depthStencilTarget?
d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,b.glName));this._depthAttachment=b}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};a.prototype.copyToTexture=function(a,b,k,f,c,g,h){(0>a||0>b||0>c||0>g)&&
console.error("Offsets cannot be negative!");(0>=k||0>=f)&&console.error("Copy width and height must be greater than zero!");var d=this._desc,e=h.descriptor;3553!==h.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+k>d.width||b+f>d.height||c+k>e.width||g+f>e.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");d=this._context;d.bindTexture(h);d.bindFramebuffer(this);d.gl.copyTexSubImage2D(3553,0,c,g,a,b,k,f)};a.prototype.readPixels=
function(a,b,f,h,c,g,r){(0>=f||0>=h)&&console.error("Copy width and height must be greater than zero!");r||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,f,h,c,g,r)};a.prototype.resize=function(b,d){var e=this._desc;if(e.width!==b||e.height!==d)if(this._initialized)e.width=b,e.height=d,this._colorAttachment instanceof h?(f=this._colorAttachment,e=f.descriptor,e.width=b,e.height=d,this._colorAttachment.dispose(),this._colorAttachment=
new h(this._context,e),a._validateTextureDimensions(f.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(e=this._depthStencilTexture.descriptor,e.width=b,e.height=d,this._depthStencilTexture.dispose(),this._depthStencilTexture=new h(this._context,e)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=
!1;else{e.width=b;e.height=d;if(this._colorAttachment instanceof h){var f=this._colorAttachment;f.resize(b,d)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,d)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var b=a.createFramebuffer(),k=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,b);if(!this._colorAttachment)if(0===k.colorTarget)this._colorAttachment=new h(this._context,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,wrapMode:33071,width:k.width,height:k.height});else{var n=new f(this._context,{internalFormat:32854,width:k.width,height:k.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,n.glName);this._colorAttachment=n}this._colorAttachment instanceof h&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(k.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new f(this._context,
{internalFormat:1===k.depthStencilTarget?33189:34041,width:k.width,height:k.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===k.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new f(this._context,{internalFormat:36168,width:k.width,height:k.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||
(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new h(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:k.width,height:k.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&
console.error("Framebuffer is incomplete!");this._glName=b;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof h){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),
b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=
null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=
function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===
a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(q,b,l){return function(){function b(f,a){this._context=f;this._desc=a;this._glName=null;this._id=-1;f=this._context.gl;this._id=++b._nextId;this._glName=f.createRenderbuffer();this._context.bindRenderbuffer(this);f.renderbufferStorage(f.RENDERBUFFER,a.internalFormat,
a.width,a.height)}Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});b.prototype.resize=function(b,a){var e=this._context.gl,d=this._desc;if(d.width!==b||d.height!==a)d.width=b,d.height=a,this._context.bindRenderbuffer(this),
e.renderbufferStorage(e.RENDERBUFFER,d.internalFormat,d.width,d.height)};b.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};b._nextId=0;return b}()})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ../../core/maybe ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(q,b,l,f,h,a,e,d,k){return function(){function a(a,b){var c=
this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange=
{zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=
{};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=d.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=k.loadCapabilities(a,b);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};this._stateTracker=new e.StateTracker({setBlending:function(a){a?(c.setBlendingEnabled(!0),c.setBlendEquationSeparate(a.opRgb,a.opAlpha),c.setBlendFunctionSeparate(a.srcRgb,
a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,c.setBlendColor(a.r,a.g,a.b,a.a)):c.setBlendingEnabled(!1)},setCulling:function(a){a?(c.setFaceCullingEnabled(!0),c.setCullFace(a.face),c.setFrontFace(a.mode)):c.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(c.setPolygonOffsetFillEnabled(!0),c.setPolygonOffset(a.factor,a.units)):c.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(c.setDepthTestEnabled(!0),c.setDepthFunction(a.func)):c.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){c.setStencilTestEnabled(!0);
var b=a.function;c.setStencilFunction(b.func,b.ref,b.mask);a=a.operation;c.setStencilOp(a.fail,a.zFail,a.zPass)}else c.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(c.setDepthWriteEnabled(!0),c.setDepthRange(a.zNear,a.zFar)):c.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?c.setColorMask(a.r,a.g,a.b,a.a):c.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?c.setStencilWriteMask(a.mask):c.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",
{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){if(!this._parameters){var a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):
void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)}}return this._parameters},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};a.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=
a,this._stateTracker.invalidateBlending())};a.prototype.setBlendColor=function(a,b,d,e){if(a!==this._blendColorState.r||b!==this._blendColorState.g||d!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,b,d,e),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=d,this._blendColorState.a=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,
b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b,this._stateTracker.invalidateBlending()};a.prototype.setBlendFunctionSeparate=function(a,b,d,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==d||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,b,d,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=d,this._blendFunctionState.dstRGB=
b,this._blendFunctionState.dstAlpha=e,this._stateTracker.invalidateBlending()};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};a.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=
b,this._stateTracker.invalidateBlending()};a.prototype.setColorMask=function(a,b,d,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==d||this._colorMaskState.a!==e)this.gl.colorMask(a,b,d,e),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=d,this._colorMaskState.a=e,this._stateTracker.invalidateColorWrite()};a.prototype.setClearColor=function(a,b,d,e){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==d||this._clearColor.a!==
e)this.gl.clearColor(a,b,d,e),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=d,this._clearColor.a=e};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};a.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b),this._stateTracker.invalidatePolygonOffset()};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),
this._frontFace=a,this._stateTracker.invalidateCulling())};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,b,d,e){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==d||this._scissorRect.height!==e)this.gl.scissor(a,b,d,e),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=d,this._scissorRect.height=
e};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a,this._stateTracker.invalidateDepthTest())};a.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};a.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b,this._stateTracker.invalidateDepthWrite()};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),
this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,b,d){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==d)this.gl.stencilFunc(a,b,d),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};
a.prototype.setStencilFunctionSeparate=function(a,b,d,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==d||this._stencilFunction.mask!==e)this.gl.stencilFuncSeparate(a,b,d,e),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=d,this._stencilFunction.mask=e,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=
a,this._stateTracker.invalidateStencilWrite())};a.prototype.setStencilOp=function(a,b,d){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==d)this.gl.stencilOp(a,b,d),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};a.prototype.setStencilOpSeparate=function(a,b,d,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==
b||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,b,d,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=d,this._stencilOperation.zPass=e,this._stateTracker.invalidateStencilTest()};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(h.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};a.prototype.clear=
function(a){a&&this.gl.clear(a)};a.prototype.clearSafe=function(a){a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(255),this.gl.clear(a))};a.prototype.drawArrays=function(a,b,d){this.gl.drawArrays(a,b,d)};a.prototype.drawElements=function(a,b,d,e){5123===d?this.gl.drawElements(a,b,d,e):5125===d&&this.gl.drawElements(a,b,d,e)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},
enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,b,d,e){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==d||c.height!==e)c.x=a,c.y=b,c.width=d,c.height=e,this.gl.viewport(a,b,d,e)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),
this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,d){void 0===d&&(d=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(d>=a._MAX_TEXTURE_IMAGE_UNITS||0>d)&&console.error("Input texture unit is out of range of available units!");var c=this._textureUnitMap[d];this.setActiveTexture(d);null==b||null==b.glName?(null!=c&&(this.gl.bindTexture(c.descriptor.target,null),c.setBoundToUnit(d,!1)),this._textureUnitMap[d]=null):
c&&c.id===b.id?b.applyChanges():(c&&c.setBoundToUnit(d,!1),this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(d,!0),b.applyChanges(),this._textureUnitMap[d]=b)};a.prototype.bindFramebuffer=function(a){f.isNone(a)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null):this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=
a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):
this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=
function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,b=this.capabilities.vao;b&&b.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===
this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,
this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?
a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?
a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(h.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,null),(d=this._textureUnitMap[b])&&a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(h.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,b,d,e){if(!b)return a.bindBuffer(d,null),null;if(e===
b)return e;a.bindBuffer(d,b.glName);return b};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this._current=new l;this._max=new l}b.prototype.incrementCount=function(b){switch(b){case 0:this._current.textures++;this._max.textures=Math.max(this._max.textures,this._current.textures);break;case 1:this._current.buffers++;this._max.buffers=Math.max(this._max.buffers,
this._current.buffers);break;case 2:this._current.vaos++;this._max.vaos=Math.max(this._max.vaos,this._current.vaos);break;case 3:this._current.programs++;this._max.programs=Math.max(this._max.programs,this._current.programs);break;case 4:this._current.frameBuffers++;this._max.frameBuffers=Math.max(this._max.frameBuffers,this._current.frameBuffers);break;case 5:this._current.renderBuffers++,this._max.renderBuffers=Math.max(this._max.renderBuffers,this._current.renderBuffers)}};b.prototype.decrementCount=
function(b){switch(b){case 0:this._current.textures--;break;case 1:this._current.buffers--;break;case 2:this._current.vaos--;break;case 3:this._current.programs--;break;case 4:this._current.frameBuffers--;break;case 5:this._current.renderBuffers--}};Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._current.textures);console.log("Buffers: "+this._current.buffers);
console.log("VAOs: "+this._current.vaos);console.log("Programs: "+this._current.programs);console.log("Framebuffers: "+this._current.frameBuffers);console.log("Renderbuffers: "+this._current.renderBuffers)};return b}();b.InstanceCounter=q;var l=function(){return function(){this.renderBuffers=this.frameBuffers=this.programs=this.vaos=this.buffers=this.textures=0}}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",
{value:!0});b.default=function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./LoseContext ./VertexArrayObjects".split(" "),function(q,b,l,f,h,a,e){function d(a,b,c,d,e){if(d&&h.default(a))return!0;if(b[c])return!1;for(b=0;b<e.length;b++)if(a.getExtension(e[b]))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});b.loadCapabilities=
function(b,n){var c=n&&n.disabledExtensions||{},g=n&&n.debugWebGLExtensions||{},k,p,u,t,x,v,y,m,w,A=null,B=null,C=null,E=null;return{get instancing(){k||(k=f.load(b));return k},get vao(){p||(p=e.load(b,c));return p},get compressedTextureS3TC(){if(!u)if(c.compressedTextureS3TC)u=null;else{var a=b.getExtension("WEBGL_compressed_texture_s3tc");u=a?{COMPRESSED_RGB_S3TC_DXT1:a.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:a.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:a.COMPRESSED_RGBA_S3TC_DXT3_EXT,
COMPRESSED_RGBA_S3TC_DXT5:a.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return u},get textureFilterAnisotropic(){if(!t)if(c.textureFilterAnisotropic)t=null;else{var a=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");t=a?{MAX_TEXTURE_MAX_ANISOTROPY:a.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:a.TEXTURE_MAX_ANISOTROPY_EXT}:null}return t},get disjointTimerQuery(){x||(x=l.load(b,c));return x},
get textureFloat(){if(!v)if(h.default(b))v={textureFloat:!0,textureFloatLinear:!c.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b.HALF_FLOAT};else if(b instanceof WebGLRenderingContext){var a=!c.textureHalfFloat&&b.getExtension("OES_texture_half_float");v={textureFloat:!c.textureFloat&&!!b.getExtension("OES_texture_float"),textureFloatLinear:!c.textureFloatLinear&&
!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!a,textureHalfFloatLinear:!c.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:a?a.HALF_FLOAT_OES:void 0}}else v=null;return v},get colorBufferFloat(){if(!y)if(h.default(b)){var a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");y=a||d?{textureFloat:!!d,textureHalfFloat:!!a,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,
RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(a=!c.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float"),d=!c.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),y=a||d?{textureFloat:!!d,textureHalfFloat:!!a,RGBA16F:a?a.RGBA16F_EXT:void 0,RGB16F:a?a.RGB16F_EXT:void 0,RGBA32F:d?d.RGBA32F_EXT:void 0}:null):y=null;return y},get blendMinMax(){if(!m)if(h.default(b))m={MIN:b.MIN,MAX:b.MAX};else if(c.blendMinMax)m=
null;else{var a=b.getExtension("EXT_blend_minmax");m=a?{MIN:a.MIN_EXT,MAX:a.MAX_EXT}:null}return m},get depthTexture(){null===A&&(A=d(b,c,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return A},get standardDerivatives(){null===B&&(B=d(b,c,"standardDerivatives",!0,["OES_standard_derivatives"]));return B},get shaderTextureLOD(){null===C&&(C=d(b,c,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return C},get fragDepth(){null===E&&(E=d(b,c,"fragDepth",
!0,["EXT_frag_depth"]));return E},get loseContext(){w||(w=a.load(b,g));return w}}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,h){if(h.disjointTimerQuery)return null;var a=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return a?l.default(b)?{createQuery:function(){return b.createQuery()},resultAvailable:function(a){return b.getQueryParameter(a,
b.QUERY_RESULT_AVAILABLE)},getResult:function(a){return b.getQueryParameter(a,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(a.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return b.beginQuery(a.TIME_ELAPSED_EXT,e)},endTimeElapsed:function(){return b.endQuery(a.TIME_ELAPSED_EXT)},createTimestamp:function(b){return a.queryCounterEXT(b,a.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(a.TIMESTAMP_EXT,a.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return a.createQueryEXT()},
resultAvailable:function(b){return a.getQueryObjectEXT(b,a.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(b){return a.getQueryObjectEXT(b,a.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(a.GPU_DISJOINT_EXT)},beginTimeElapsed:function(b){return a.beginQueryEXT(a.TIME_ELAPSED_EXT,b)},endTimeElapsed:function(){return a.endQueryEXT(a.TIME_ELAPSED_EXT)},createTimestamp:function(b){return a.queryCounterEXT(b,a.TIMESTAMP_EXT)},timestampBits:function(){return a.getQueryEXT(a.TIMESTAMP_EXT,
a.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b){return l.default(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),
drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null}})},"esri/views/webgl/capabilities/LoseContext":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,f){var h=f.loseContext&&b.getExtension("WEBGL_lose_context");return h?{loseRenderingContext:function(){return h.loseContext()}}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require",
"exports","./isWebGL2Context"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,h){return l.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:h.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),
bindVertexArray:b.bindVertexArrayOES.bind(b)}:null}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(q,b){return function(){function b(b){this.readFile=b}b.prototype.resolveIncludes=function(b){return this.resolve(b)};b.prototype.resolve=function(b,h){var a=this;void 0===h&&(h=new Map);if(h.has(b))return h.get(b);var e=this.read(b);if(!e)throw Error("cannot find shader file "+b);for(var d=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,k=d.exec(e),f=[];null!=k;)f.push({path:k[1],
start:k.index,length:k[0].length}),k=d.exec(e);var c=0,g="";f.forEach(function(b){g+=e.slice(c,b.start);g+=h.has(b.path)?"":a.resolve(b.path,h);c=b.start+b.length});g+=e.slice(c);h.set(b,g);return g};b.prototype.read=function(b){return this.readFile(b)};return b}()})},"esri/views/webgl/ProgramCache":function(){define(["require","exports","./programUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._programCacheByTemplate=new Map;this._rctx=b}b.prototype.dispose=
function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};b.prototype.getProgram=function(b,a){var e=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(a){return l.createProgram(e._rctx,b,a)});return this.getProgramTemplateInstance(b,a)};b.prototype.addProgramTemplate=function(b,a){this._programCacheByTemplate.set(b,{constructor:a,programs:new Map})};b.prototype.getProgramTemplateInstance=
function(b,a){if(b=this._programCacheByTemplate.get(b)){var e=a?JSON.stringify(a):"default";b.programs.has(e)||(a=b.constructor(a),b.programs.set(e,a));return b.programs.get(e)}return null};return b}();b.ProgramCache=q})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.glslifyDefineMap=function(b){var f="",a;for(a in b){var e=b[a];if("boolean"===typeof e)e&&(f+="#define "+a+"\n");else if("number"===
typeof e)f+="#define "+a+" "+e.toFixed()+"\n";else if("object"===typeof e){var d=e.options,k=0,n;for(n in d)f+="#define "+d[n]+" "+(k++).toFixed()+"\n";f+="#define "+a+" "+d[e.value]+"\n"}}return f};b.createProgram=function(b,h,a,e){a=a||{};e=e||"";a="function"===typeof h.shaders?h.shaders(a):h.shaders;return new l(b,e+a.vertexShader,e+a.fragmentShader,h.attributes)}})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),
function(q,b,l,f,h,a,e,d){function k(b,c){if(a.isNone(b))return null;var k=a.isSome(b.color)?d.vec4f64.fromArray(f.toUnitRGBA(b.color)):d.vec4f64.fromValues(0,0,0,0),p=e.pt2px(b.size),r=e.pt2px(b.extensionLength);switch(b.type){case "solid":return n(l({color:k,size:p,extensionLength:r},c));case "sketch":return l({},g,l({color:k,size:p,extensionLength:r},c),{type:"sketch"});default:h.neverReached(b)}}function n(a){return l({},c,a,{type:"solid"})}Object.defineProperty(b,"__esModule",{value:!0});b.createMaterial=
function(a,b){return k(a&&a.enabled&&a.edges||null,b)};b.createMaterialFromEdges=k;b.createSolidEdgeMaterial=n;var c={color:d.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},g={color:d.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2}})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,a){if(b.count!==
h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var e=b.count,d=a[0],k=a[1],f=a[2],c=a[4],g=a[5],r=a[6],p=a[8],u=a[9],t=a[10],x=a[12],v=a[13];a=a[14];var y=b.typedBuffer;b=b.typedBufferStride;var m=h.typedBuffer;h=h.typedBufferStride;for(var w=0;w<e;w++){var A=w*b,B=w*h,C=m[B],E=m[B+1],B=m[B+2];y[A]=d*C+c*E+p*B+x;y[A+1]=k*C+g*E+u*B+v;y[A+2]=f*C+r*E+t*B+a}}};b.transformMat3=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");
else{var e=b.count,d=a[0],k=a[1],f=a[2],c=a[3],g=a[4],r=a[5],p=a[6],u=a[7];a=a[8];var t=b.typedBuffer;b=b.typedBufferStride;var x=h.typedBuffer;h=h.typedBufferStride;for(var v=0;v<e;v++){var y=v*b,m=v*h,w=x[m],A=x[m+1],m=x[m+2];t[y]=d*w+c*A+p*m;t[y+1]=k*w+g*A+u*m;t[y+2]=f*w+r*A+a*m}}};b.scale=function(b,h,a){var e=Math.min(b.count,h.count),d=b.typedBuffer;b=b.typedBufferStride;var k=h.typedBuffer;h=h.typedBufferStride;for(var f=0;f<e;f++){var c=f*b,g=f*h;d[c]=a*k[g];d[c+1]=a*k[g+1];d[c+2]=a*k[g+2]}}})},
"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.logger=l.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/DiscardOrAdjustAlpha.glsl ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w){var A=r.assert;q=function(a){function b(c,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new v.DefaultMaterialTechniqueConfiguration;d.params=u.copyParameters(c,C);d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=c.instanced?b.getInstanceBufferLayout(d.params):null;return d}l(b,a);b.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};b.prototype.isVisible=function(){var b=this.params;
if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,e=b.symbolColors,c=!!c&&-1<c.indexOf("color"),g=b.vvColorEnabled,k="replace"===b.colorMixMode,f=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||g||e)?k?!0:f:d?k?b:f:c||g||e?k?!0:f:k?b:f};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"instanced"===c&&A(a.instanced===b.instanced,"Can not change instanced attributes"),"textureId"===c&&A(b.textureId,"Can only change texture of material that already has a texture"),
"vertexColors"===c&&!0===a[c]&&a[c]!==b[c]&&A(b.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),b[c]=a[c];this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=this.params.vertexTangents;this.techniqueConfig.instanced=
!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;this.techniqueConfig.alphaDiscardMode=
"opaque"===this.params.textureAlphaMode?1:"mask"===this.params.textureAlphaMode?2:"maskBlend"===this.params.textureAlphaMode?3:0;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;0===a&&(this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=this.params.symbolColors,this.params.treeRendering||(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===
this.params.doubleSidedType?2:0),this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=
!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces));return this.techniqueConfig};b.prototype.intersect=function(a,b,c,d,g,k,f){if(null!==this.params.verticalOffset){var m=d.camera;e.vec3.set(P,c[12],c[13],c[14]);c=null;switch(d.viewingMode){case "global":c=e.vec3.normalize(H,
P);break;case "local":c=e.vec3.copy(H,K)}var p=0;if(null!==this.params.verticalOffset){var n=e.vec3.subtract(S,P,m.eye),r=e.vec3.length(n),n=e.vec3.scale(n,n,1/r),w=null;this.params.screenSizePerspective&&(w=e.vec3.dot(c,n));p+=u.verticalOffsetAtDistance(m,r,this.params.verticalOffset,w,this.params.screenSizePerspective)}e.vec3.scale(c,c,p);e.vec3.transformMat3(L,c,d.transform.inverseRotation);g=e.vec3.subtract(J,g,L);k=e.vec3.subtract(I,k,L)}u.intersectTriangleGeometry(a,b,d,g,k,h.isSome(d.options.verticalOffset)?
d.options.verticalOffset.object3D:void 0,f)};b.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||3===a.output||4===a.output)return new B(a)};b.prototype.createRenderer=function(a,b){return this.params.softwareInstanced?new t(a,b,this):new x(a,b,this)};b.prototype.createBufferWriter=function(){return new E(this.vertexBufferLayout,this.instanceBufferLayout)};b.getVertexBufferLayout=function(a){var b=a.textureId||a.normalTextureId||a.metallicRoughnessTextureId||a.emissiveTextureId||
a.occlusionTextureId,c=k.newLayout().vec3f("position").vec3f("normal");a.vertexTangents&&c.vec4f("tangent");b&&c.vec2f("uv0");a.vertexColors&&c.vec4u8("color");a.symbolColors&&c.vec4u8("symbolColor");return c};b.getInstanceBufferLayout=function(a){var b=k.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&
-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return b}(g.Material);var B=function(a){function b(b){var d=this,d=a.call(this,c.makeCtorParameters(b,b.material.getParameters()))||this;d.updateParameters();return d}l(b,a);b.prototype.updateParameters=function(){this.selectPipeline();this.selectSlot();var a=this.material.getParameters();this.updateTexture(a.textureId);this.technique=a.treeRendering?this.techniqueRep.acquireAndReleaseExisting(y.RealisticTreeTechnique,
this.material.getTechniqueConfig(this.output),this.technique):this.techniqueRep.acquireAndReleaseExisting(v.DefaultMaterialTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.selectSlot=function(){this.slot=this.material.getParameters().transparent?this.material.getParameters().writeDepth?6:9:4};b.prototype.selectPipeline=function(){var a=this.material.getParameters(),b=0===this.output?a.transparent&&m.separateBlendingParams(770,1,771,771):null;this.pipelineState=
w.makePipelineState({blending:b,culling:G(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.material.getParameters().receiveShadows&&(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};b.prototype.bind=function(a,b){var c=this.technique.program;0===this.output&&this._updateShadowState(b);a.bindProgram(c);a.setPipelineState(this.pipelineState);
this.technique.bindPass(a,this.material.getParameters(),b);this.bindTexture(a,c)};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.bindInstance=function(a){this.technique.bindInstance(a)};return b}(c);(q||(q={})).COLOR_GAMMA=2.1;var C={textureId:void 0,initTextureTransparent:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],metallicFactor:0,roughnessFactor:1,reflectanceFactor:.5,
ambient:[.2,.2,.2],diffuse:[.8,.8,.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,softwareInstanced:!1,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,
100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:a.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:n.TEXTURE_ALPHA_CUTOFF_DEFAULT,textureAlphaPremultiplied:!1},E=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=
function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,d){p.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}(),G=function(a){var b;b=a.cullFace?0!==a.cullFace:a.slicePlaneEnabled?!1:!a.transparent&&!a.doubleSided;return b&&{face:1===a.cullFace?1028:1029,mode:2305}},J=d.vec3f64.create(),I=d.vec3f64.create(),K=d.vec3f64.fromValues(0,
0,1),H=d.vec3f64.create(),L=d.vec3f64.create(),P=d.vec3f64.create(),S=d.vec3f64.create();return q})},"esri/views/3d/webgl-engine/core/shaderLibrary/DiscardOrAdjustAlpha.glsl":function(){define(["require","exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardOrAdjustAlpha=function(b,n){var c=b.fragment;switch(n.alphaDiscardMode){case 0:c.code.add(f.glsl(h||(h=l(["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "],
["\n        void discardOrAdjustAlpha(inout vec4 color) {}\n      "]))));break;case 1:c.code.add(f.glsl(a||(a=l(["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "],["\n        void discardOrAdjustAlpha(inout vec4 color) {\n          color.a \x3d 1.0;\n        }\n      "]))));break;case 2:c.uniforms.add("textureAlphaCutoff","float");c.code.add(f.glsl(e||(e=l(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "],
["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } else { color.a \x3d 1.0; } }\n      "]))));break;case 3:b.fragment.uniforms.add("textureAlphaCutoff","float"),b.fragment.code.add(f.glsl(d||(d=l(["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "],["\n        #define discardOrAdjustAlpha(color) { if (color.a \x3c textureAlphaCutoff) { discard; } }\n      "]))))}};b.TEXTURE_ALPHA_CUTOFF_DEFAULT=
.1;var h,a,e,d})},"esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),function(q,b,l,f,h,a,e,d,k,n){function c(a,b){var c=new Map,d=function(a,b){var d=a.origin.id,e=a.data.id,g=c.get(d);g||(g={origin:a.origin.vec3,
deltaByGeometry:new Map},c.set(d,g));d=g.deltaByGeometry.get(e);d||(d={renderData:a.data,toAdd:[],toRemove:[]},g.deltaByGeometry.set(e,d));(b?d.toAdd:d.toRemove).push(a)};a.forEach(function(a){d(a,!0)});b.forEach(function(a){d(a,!1)});return c}function g(a,b,c){var d=b.elementCount(a),d=b.allocate(d);b.write({},a,d,0);c.setData(d.buffer)}return function(){function b(a,b,c,d){void 0===d&&(d=h.Default3D);this.type="InstancedRenderer";this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._vertexAttributeLocations=
d;this._material=c;this._materialRep=b;this._glMaterials=e.acquireMaterials(this._material,this._materialRep);this._bufferWriter=c.createBufferWriter()}b.prototype.dispose=function(){e.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasWater",{get:function(){return!1},enumerable:!0,configurable:!0});b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};b.prototype.addAndRemoveGeometries=function(b,h){var p=this,r=this._rctx,v=this._bufferWriter,y=this._dataByOrigin;b=c(b,h);var m=v.vertexBufferLayout;b.forEach(function(b,c){var h=y.get(c);h||(h={origin:b.origin,highlightCount:0,
dataByGeometry:new Map},y.set(c,h));b.deltaByGeometry.forEach(function(b,c){var w=h.dataByGeometry.get(c);!w&&0<b.toAdd.length&&(w={vao:new n(r,p._vertexAttributeLocations,{geometry:f.glLayout(m)},{geometry:d.createVertex(r,35044)}),vertexCount:0,instances:new Map,highlightCount:0},g(b.renderData,v,w.vao.vertexBuffers.geometry),w.vertexCount=k.vertexCount(w.vao,"geometry"),h.dataByGeometry.set(c,w));var t=w.instances;b.toAdd.forEach(function(b){var c=l.mat4f64.create();e.calculateTransformRelToOrigin(b,
c);var d=e.generateRenderGeometryVisibleIndexRanges(b),g=e.generateRenderGeometryHighlightRanges(b),c=new a(b.name,0,w.vertexCount,d,g,c,b.instanceParameters,b.idx,b.data.id);t.set(b.uniqueName,c);h.highlightCount=null;w.highlightCount=null});b.toRemove.forEach(function(a){t.delete(a.uniqueName)});0===t.size&&(w.vao.dispose(),h.dataByGeometry.delete(c))});0===h.dataByGeometry.size&&y.delete(c)})};b.prototype.updateGeometries=function(a){var b=this._dataByOrigin,c=this._bufferWriter;a.forEach(function(a){var d=
a.updateType;a=a.renderGeometry;var k=b.get(a.origin.id),f=k&&k.dataByGeometry.get(a.data.id),h=f&&f.instances.get(a.uniqueName);h&&(d&1&&(h.displayedIndexRange=e.generateRenderGeometryVisibleIndexRanges(a)),d&17&&(h.highlightedIndexRanges=e.generateRenderGeometryHighlightRanges(a),k.highlightCount=null,f.highlightCount=null),d&2&&g(a.data,c,f.vao.vertexBuffers.geometry),d&4&&e.calculateTransformRelToOrigin(a,h.transformation,h.transformationNormal))})};b.prototype.updateHighlightCount=function(){var a=
this;this._highlightCount=0;this._dataByOrigin.forEach(function(b){if(null==b.highlightCount){var c=0;b.dataByGeometry.forEach(function(a){if(null==a.highlightCount){var b=0;a.instances.forEach(function(a){a.highlightedIndexRanges&&++b});a.highlightCount=b}c+=a.highlightCount});b.highlightCount=c}a._highlightCount+=b.highlightCount})};b.prototype.render=function(a,b,c,d){var e=this,g=this._rctx,k=this._glMaterials.get(b.pass),f=4===b.pass;if(!k||null!=a&&!k.beginSlot(a)||f&&0===this._highlightCount)return!1;
k.bind(g,c);var h=!1;this._dataByOrigin.forEach(function(a){f&&0===a.highlightCount||(c.origin=a.origin,k.bindView(c),a.dataByGeometry.forEach(function(a){h=f?e.renderHighlightPass(k,a,d)||h:e.renderDefaultPass(k,a,d)||h}))});g.bindVAO(null);return h};b.prototype.renderDefaultPass=function(a,b,c){var d=this._rctx,g=b.vao,k=b.vertexCount,f=a.getTechnique();f.ensureAttributeLocations(g);d.bindVAO(g);var h=!1;b.instances.forEach(function(b){var g=b.displayedIndexRange;g&&0===g.length||(a.bindInstance(b),
g?e.drawArraysFaceRange(d,g,0,f.primitiveType,c):e.drawArrays(d,f.primitiveType,0,k,c),h=!0)});return h};b.prototype.renderHighlightPass=function(a,b,c){var d=this._rctx,g=b.vao,k=b.vertexCount,f=a.getTechnique();if(0!==b.highlightCount){f.ensureAttributeLocations(g);d.bindVAO(g);var h=!1;b.instances.forEach(function(b){var g=b.highlightedIndexRanges;if(g&&0!==g.length)for(a.bindInstance(b),b=0;b<g.length;b++){var m=g[b];e.drawArrays(d,f.primitiveType,m.range?m.range[0]:0,m.range?m.range[1]-m.range[0]+
1:k,c);h=!0}});return h}};return b}()})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../materials/internal/MaterialUtil ./DefaultMaterial.glsl ../../../webgl/Program".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){Object.defineProperty(b,"__esModule",{value:!0});x=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}l(f,b);f.prototype.initializeProgram=function(a){var b=f.shader.get(),c=this.configuration,b=b.build({output:c.output,viewingMode:a.viewingMode,receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:c.symbolColors,vvSize:c.vvSize,
vvColor:c.vvColor,vvInstancingEnabled:!0,instanced:c.instanced,instancedColor:c.instancedColor,instancedDoublePrecision:c.instancedDoublePrecision,useOldSceneLightInterface:!1,usePBR:c.usePBR,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,hasColorTexture:c.hasColorTexture,receiveAmbientOcclusion:c.receiveAmbientOcclusion,usePBRforWater:!1,useCustomDTRExponentForWater:!1,
normalType:c.normalsTypeDerivate?3:0,doubleSidedMode:c.doubleSidedMode,vertexTangets:c.vertexTangents,attributeTextureCoordinates:c.hasMetalnessAndRoughnessTexture||c.hasEmissionTexture||c.hasOcclusionTexture||c.hasNormalTexture||c.hasColorTexture?1:0,textureAlphaPremultiplied:c.textureAlphaPremultiplied,attributeColor:c.vertexColors,screenSizePerspectiveEnabled:c.screenSizePerspective,verticalOffsetEnabled:c.verticalOffset,offsetBackfaces:c.offsetBackfaces,doublePrecisionRequiresObfuscation:u.doublePrecisionRequiresObfuscation(a.rctx),
alphaDiscardMode:c.alphaDiscardMode,supportsTextureAtlas:!1});return new A(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),y.Default3D)};f.prototype.bindPass=function(a,b,d){var e=this.configuration.output;0===e?(this.program.setUniform3fv("ambient",b.ambient),this.program.setUniform3fv("diffuse",b.diffuse),this.program.setUniform4fv("externalColor",b.externalColor),this.program.setUniform1i("colorMixMode",m.colorMixModes[b.colorMixMode]),this.program.setUniform1f("opacity",b.opacity),
this.program.setUniform1f("layerOpacity",b.layerOpacity),this.configuration.usePBR&&c.PhysicallyBasedRenderingParameters.bindUniforms(this.program,b)):1===e||3===e?this.program.setUniform2fv("nearFar",d.nearFar):4===e&&n.OutputHighlight.bindOutputHighlight(a,this.program,d);r.VisualVariables.bindUniformsForSymbols(this.program,b);k.VerticalOffset.bindUniforms(this.program,b,d);m.bindScreenSizePerspective(b.screenSizePerspective,this.program);"mask"!==b.textureAlphaMode&&"maskBlend"!==b.textureAlphaMode||
this.program.setUniform1f("textureAlphaCutoff",b.textureAlphaCutoff)};f.prototype.bindDraw=function(b){var c=this.configuration.instancedDoublePrecision?h.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;e.Transform.bindUniformsCustomOrigin(this.program,c,b.view);(0===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&
this.configuration.screenSizePerspective)&&p.Camera.bindUniformsCustomOrigin(this.program,c,b.viewInvTransp);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",b.viewInvTransp);this.configuration.instancedDoublePrecision&&d.InstancedDoublePrecision.bindCustomOrigin(this.program,c);a.Slice.bindUniforms(this.program,this.configuration,b.slicePlane,c);0===this.configuration.output&&g.ReadShadowMap.bindViewCustomOrigin(this.program,b,c)};f.prototype.bindInstance=function(a){this.program.setUniformMatrix4fv("model",
a.transformation);this.program.setUniformMatrix4fv("modelNormal",a.transformationNormal)};f.prototype.initializePipeline=function(){return null};f.shader=new t.ReloadableShaderModule(w,"./DefaultMaterial.glsl",q);return f}(x.ShaderTechnique);b.DefaultMaterialTechnique=x;x=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.alphaDiscardMode=1;b.doubleSidedMode=0;b.vertexColors=!1;b.offsetBackfaces=!1;b.symbolColors=!1;b.vvSize=!1;b.vvColor=!1;b.verticalOffset=!1;b.receiveShadows=
!1;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.receiveAmbientOcclusion=!1;b.screenSizePerspective=!1;b.textureAlphaPremultiplied=!1;b.hasColorTexture=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;b.instanced=!1;b.instancedColor=!1;b.instancedDoublePrecision=!1;b.vertexTangents=!1;b.normalsTypeDerivate=!1;return b}l(b,a);f([v.parameter({count:7})],b.prototype,"output",void 0);f([v.parameter({count:4})],b.prototype,
"alphaDiscardMode",void 0);f([v.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);f([v.parameter()],b.prototype,"vertexColors",void 0);f([v.parameter()],b.prototype,"offsetBackfaces",void 0);f([v.parameter()],b.prototype,"symbolColors",void 0);f([v.parameter()],b.prototype,"vvSize",void 0);f([v.parameter()],b.prototype,"vvColor",void 0);f([v.parameter()],b.prototype,"verticalOffset",void 0);f([v.parameter()],b.prototype,"receiveShadows",void 0);f([v.parameter()],b.prototype,"slicePlaneEnabled",
void 0);f([v.parameter()],b.prototype,"sliceHighlightDisabled",void 0);f([v.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);f([v.parameter()],b.prototype,"screenSizePerspective",void 0);f([v.parameter()],b.prototype,"textureAlphaPremultiplied",void 0);f([v.parameter()],b.prototype,"hasColorTexture",void 0);f([v.parameter()],b.prototype,"usePBR",void 0);f([v.parameter()],b.prototype,"hasMetalnessAndRoughnessTexture",void 0);f([v.parameter()],b.prototype,"hasEmissionTexture",void 0);f([v.parameter()],
b.prototype,"hasOcclusionTexture",void 0);f([v.parameter()],b.prototype,"hasNormalTexture",void 0);f([v.parameter()],b.prototype,"instanced",void 0);f([v.parameter()],b.prototype,"instancedColor",void 0);f([v.parameter()],b.prototype,"instancedDoublePrecision",void 0);f([v.parameter()],b.prototype,"vertexTangents",void 0);f([v.parameter()],b.prototype,"normalsTypeDerivate",void 0);return b}(v.ShaderTechniqueConfiguration);b.DefaultMaterialTechniqueConfiguration=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/libs/gl-matrix-2/vec3f64 ../util/DoublePrecision.glsl ../../shaderModules/interfaces ../../../lib/doublePrecisionUtils".split(" "),
function(q,b,l,f,h,a,e){function d(b,d){d.instanced&&d.instancedDoublePrecision?(b.attributes.add("modelOriginHi","vec3"),b.attributes.add("modelOriginLo","vec3"),b.attributes.add("model","mat3"),b.attributes.add("modelNormal","mat3")):(b.vertex.uniforms.add("model","mat4"),b.vertex.uniforms.add("modelNormal","mat4"));d.instancedDoublePrecision&&(b.include(h.DoublePrecision,d),b.vertex.uniforms.add("viewOriginHi","vec3"),b.vertex.uniforms.add("viewOriginLo","vec3"));var e=[a.glsl(c||(c=l(["\n    vec3 calculateVPos() {\n      ",
"\n    }\n    "],["\n    vec3 calculateVPos() {\n      ","\n    }\n    "])),d.instancedDoublePrecision?"return model * localPosition().xyz;":"return (model * localPosition()).xyz;"),a.glsl(r||(r=l(["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "],["\n    vec3 subtractOrigin(vec3 _pos) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?a.glsl(g||(g=l(["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"],
["\n          vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\n          return _pos - originDelta;"]))):"return vpos;"),a.glsl(p||(p=l(["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "],["\n    vec3 dpNormal(vec4 _normal) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize((modelNormal * _normal).xyz);"),a.glsl(u||(u=l(["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "],
["\n    vec3 dpNormalView(vec4 _normal) {\n      ","\n    }\n    "])),d.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * modelNormal * _normal).xyz);")];b.vertex.code.add(e[0]);b.vertex.code.add(e[1]);b.vertex.code.add(e[2]);2===d.output&&b.vertex.code.add(e[3])}Object.defineProperty(b,"__esModule",{value:!0});b.InstancedDoublePrecision=d;(function(a){var b=function(){return function(){}}();a.Uniforms=b;a.bindCustomOrigin=
function(a,b){e.encodeDoubleArraySplit(b,k,n,3);a.setUniform3fv("viewOriginHi",k);a.setUniform3fv("viewOriginLo",n)}})(d=b.InstancedDoublePrecision||(b.InstancedDoublePrecision={}));var k=f.vec3f64.create(),n=f.vec3f64.create(),c,g,r,p,u})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/has ../../shaderModules/interfaces ../../../lib/WebGLDriverTest".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.DoublePrecision=function(a,b){b.doublePrecisionRequiresObfuscation?a.vertex.code.add(h.glsl(e||(e=l(["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "],
["\n      vec3 dpPlusFrc(vec3 a, vec3 b) {\n        return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n      }\n\n      vec3 dpMinusFrc(vec3 a, vec3 b) {\n        return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n      }\n\n      // based on https://www.thasler.com/blog/blog/glsl-part2-emu\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n        vec3 e \x3d dpMinusFrc(t1, hiA);\n        vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n        return t1 + t2;\n      }\n    "])))):
a.vertex.code.add(h.glsl(d||(d=l(["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "],["\n      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n        vec3 t1 \x3d hiA + hiB;\n        vec3 e \x3d t1 - hiA;\n        vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n        return t1 + t2;\n      }\n    "]))))};
b.doublePrecisionRequiresObfuscation=function(b){return f("force-double-precision-obfuscation")?!0:a.testWebGLDriver(b).doublePrecisionRequiresObfuscation};var e,d})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3f64 ../../../webgl ./doublePrecisionUtils ./Util ../shaders/sources/shaderRepository".split(" "),function(q,b,l,f,h,a,e,d){function k(b,c){var g=new h.FramebufferObject(b,{colorTarget:0,depthStencilTarget:0},
{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1}),k=h.BufferObject.createVertex(b,35044,new Uint16Array([0,0,1,0,0,1,1,1])),n=new h.VertexArrayObject(b,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:k}),r=f.vec3f64.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),l=f.vec3f64.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);b.bindFramebuffer(g);c=new h.Program(b,"\n\n  precision highp float;\n\n  attribute vec2 a_pos;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  "+
(c?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"")+"\n\n  "+d.util["doublePrecision.glsl"]+"\n\n  const float MAX_RGBA_FLOAT \x3d\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat \x3d 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val \x3d dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color \x3d float2rgba(val.z / 25.0);\n\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var y=new Float32Array(6);a.encodeDoubleArray(r,y,3);var m=new Float32Array(6);a.encodeDoubleArray(l,m,3);b.bindProgram(c);c.setUniform3f("u_highA",y[0],y[2],y[4]);c.setUniform3f("u_lowA",y[1],y[3],y[5]);c.setUniform3f("u_highB",m[0],m[2],m[4]);c.setUniform3f("u_lowB",m[1],m[3],m[5]);var w=b.getViewport(),y=w.x,m=w.y,A=w.width,w=w.height;b.setViewport(0,0,1,1);b.bindVAO(n);
b.drawArrays(5,0,4);b.setViewport(y,m,A,w);b=new Uint8Array(4);g.readPixels(0,0,1,1,6408,5121,b);c.dispose();n.dispose(!1);k.dispose();g.dispose();g=(r[2]-l[2])/25;k=e.unpackFloatRGBA(b);return Math.abs(g-k)}Object.defineProperty(b,"__esModule",{value:!0});var n=function(){function a(a){this.context=a;this._doublePrecisionRequiresObfuscation=null}Object.defineProperty(a.prototype,"doublePrecisionRequiresObfuscation",{get:function(){if(l.isNone(this._doublePrecisionRequiresObfuscation)){var a=k(this.context,
!1),b=k(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==a&&(0===b||5<a/b)}return this._doublePrecisionRequiresObfuscation},enumerable:!0,configurable:!0});return a}(),c=null;b.testWebGLDriver=function(a){if(l.isNone(c)||c.context!==a)c=new n(a);return c}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(q,b){return{renderer:{laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\n#include \x3cutil/fsPrecision.glsl\x3e\n#include \x3cutil/depth.glsl\x3e\nuniform sampler2D depthMap;\nuniform vec2 nearFar;\nuniform vec4 projInfo;\nuniform vec2 zScale;\nuniform float maxPixelDistance;\nuniform vec4 focusPlane;\nuniform vec4 focusSphere;\nuniform vec4 segmentPlane;\nuniform vec3 segmentStart;\nuniform vec3 segmentEnd;\nuniform vec3 glowColor;\nuniform float glowWidth;\nuniform vec3 innerColor;\nuniform float innerWidth;\nuniform float globalAlpha;\nvarying vec2 uv;\n#define INFINITY 100000.0\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\n  float width \x3d fwidth(dist);\n  dist /\x3d min(width, maxPixelDistance);\n  return abs(dist);\n}\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\n  return vec4(\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\n    source.a + dest.a * oneMinusSourceAlpha\n  );\n}\nvec4 premultipliedColor(vec3 rgb, float alpha) {\n  return vec4(rgb * alpha, alpha);\n}\nvec4 laserLineProfile(float dist) {\n  if (dist \x3e glowWidth) {\n    return vec4(0.0);\n  }\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\n  return blendPremultiplied(\n    premultipliedColor(innerColor, innerAlpha),\n    premultipliedColor(glowColor, glowAlpha)\n  );\n}\nvoid main() {\n  float depth \x3d linearDepth(depthMap, uv, nearFar);\n  if (-depth \x3d\x3d nearFar[0]) {\n    discard;\n  }\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\n  float ddepth \x3d fwidth(depth);\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\n  float segmentDistance \x3d INFINITY;\n  float segmentLength \x3d length(segmentEnd - segmentStart);\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\n  float t \x3d dot(segmentDir, pos - segmentStart);\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\n  }\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\n  vec4 color \x3d max(\n    focusPlaneColor * focusPlaneAlpha,\n    max(\n      focusSphereColor * focusSphereAlpha,\n      segmentColor * segmentAlpha\n    )\n  );\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\n}"},
offscreen:{"composite.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d texture2D(tex, vtc);\n}","compositeOccluded.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D occludedColorMap;\nuniform float opacity;\nvarying vec2 vtc;\nvoid main() {\n  vec4 occludedColor \x3d texture2D(occludedColorMap, vtc);\n  gl_FragColor \x3d occludedColor * opacity;\n}","compositeTransparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\nuniform sampler2D tex;\nvarying vec2 vtc;\nvoid main() {\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\n}",
"offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 vtc;\nvoid main(void) {\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\n  vtc \x3d position.xy * 0.5 + 0.5;\n}"}},util:{"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\n  return vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n  vec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\n  vec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\n  float d \x3d q.x - min(q.w, q.y);\n  float e \x3d 1.0e-10;\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nfloat rgb2v(vec3 c) {\n  return max(c.x, max(c.y, c.z));\n}",
"depth.glsl":"#include \x3cutil/encoding.glsl\x3e\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n}\nfloat calcFragDepth(const in float depth) {\n  const float SLOPE_SCALE \x3d 2.0;\n  const float BIAS \x3d 2.0 * .000015259;\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\n  return clamp(result, .0, .999999);\n}","doublePrecision.glsl":"#ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\nvec3 dpPlusFrc(vec3 a, vec3 b) {\n  return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n}\nvec3 dpMinusFrc(vec3 a, vec3 b) {\n  return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n}\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d dpPlusFrc(hiA, hiB);\n  vec3 e \x3d dpMinusFrc(t1, hiA);\n  vec3 t2 \x3d dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n  return t1 + t2;\n}\n#else\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n  vec3 t1 \x3d hiA + hiB;\n  vec3 e \x3d t1 - hiA;\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n  return t1 + t2;\n}\n#endif",
"enableExtensions.glsl":"#define EXTENSIONS_ENABLED\n#extension GL_OES_standard_derivatives : enable\n#extension GL_EXT_shader_texture_lod : enable","encoding.glsl":"const float MAX_RGBA_FLOAT \x3d\n  255.0 / 256.0 +\n  255.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 +\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\nvec4 float2rgba(const float value) {\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\n  const float toU8AsFloat \x3d 1.0 / 255.0;\n  return fixedPointU8 * toU8AsFloat;\n}\nconst vec4 rgba2float_factors \x3d vec4(\n  255.0 / (256.0),\n  255.0 / (256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0),\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\nattribute vec2 position;\nvarying vec2 uv;\nvoid main(void) {\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\n  uv \x3d position * .5 + vec2(.5);\n}","vsPrecision.glsl":"precision highp float;\nprecision highp sampler2D;"}}})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a,b){var p=a.fragment,r=b.hasMetalnessAndRoughnessTexture||b.hasEmissionTexture||b.hasOcclusionTexture;b.usePBR&&r&&a.include(f.VertexTextureCoordinates,b);b.usePBR&&(p.uniforms.add("roughnessFactor","float"),p.uniforms.add("metalnessFactor","float"),p.uniforms.add("emissionFactor","vec3"),p.uniforms.add("reflectanceFactor",
"float"),p.code.add(h.glsl(e||(e=l(["\n    float reflectance;\n    float roughness;\n    float metalness;\n    vec3 emission;\n    float occlusion;\n    "],["\n    float reflectance;\n    float roughness;\n    float metalness;\n    vec3 emission;\n    float occlusion;\n    "])))),b.hasMetalnessAndRoughnessTexture&&(p.uniforms.add("texMetallicRoughness","sampler2D"),b.supportsTextureAtlas&&p.uniforms.add("texMetallicRoughnessSize","vec2"),p.code.add(h.glsl(d||(d=l(["\n    void applyMetallnessAndRoughness(TextureLookupParameter params) {\n      vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n      roughness *\x3d metallicRoughness.g;\n      metalness *\x3d metallicRoughness.b;\n    }\n    "],
["\n    void applyMetallnessAndRoughness(TextureLookupParameter params) {\n      vec3 metallicRoughness \x3d textureLookup(texMetallicRoughness, params).rgb;\n\n      roughness *\x3d metallicRoughness.g;\n      metalness *\x3d metallicRoughness.b;\n    }\n    "]))))),b.hasEmissionTexture&&(p.uniforms.add("texEmission","sampler2D"),b.supportsTextureAtlas&&p.uniforms.add("texEmissionSize","vec2"),p.code.add(h.glsl(k||(k=l(["\n    void applyEmission(TextureLookupParameter params) {\n      emission *\x3d textureLookup(texEmission, params).rgb;\n    }\n    "],
["\n    void applyEmission(TextureLookupParameter params) {\n      emission *\x3d textureLookup(texEmission, params).rgb;\n    }\n    "]))))));b.usePBR&&b.hasOcclusionTexture?(p.uniforms.add("texOcclusion","sampler2D"),b.supportsTextureAtlas&&p.uniforms.add("texOcclusionSize","vec2"),p.code.add(h.glsl(n||(n=l(["\n    void applyOcclusion(TextureLookupParameter params) {\n      occlusion *\x3d textureLookup(texOcclusion, params).r;\n    }\n\n    float getBakedOcclusion() {\n      return occlusion;\n    }\n    "],
["\n    void applyOcclusion(TextureLookupParameter params) {\n      occlusion *\x3d textureLookup(texOcclusion, params).r;\n    }\n\n    float getBakedOcclusion() {\n      return occlusion;\n    }\n    "]))))):p.code.add(h.glsl(c||(c=l(["\n    float getBakedOcclusion() { return 1.0; }\n    "],["\n    float getBakedOcclusion() { return 1.0; }\n    "]))));b.usePBR&&p.code.add(h.glsl(g||(g=l(["\n    void applyPBRFactors() {\n      reflectance \x3d reflectanceFactor;\n      roughness \x3d roughnessFactor;\n      metalness \x3d metalnessFactor;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ",
"\n      ","\n      ","\n      ","\n    }\n  "],["\n    void applyPBRFactors() {\n      reflectance \x3d reflectanceFactor;\n      roughness \x3d roughnessFactor;\n      metalness \x3d metalnessFactor;\n      emission \x3d emissionFactor;\n      occlusion \x3d 1.0;\n      ","\n      ","\n      ","\n      ","\n    }\n  "])),r?"vtc.uv \x3d vuv0;":"",b.hasMetalnessAndRoughnessTexture?b.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":
"",b.hasEmissionTexture?b.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":"",b.hasOcclusionTexture?b.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""))}Object.defineProperty(b,"__esModule",{value:!0});b.PhysicallyBasedRenderingParameters=a;(function(a){a.bindUniforms=function(a,b){a.setUniform1f("metalnessFactor",b.metallicFactor);a.setUniform1f("roughnessFactor",b.roughnessFactor);a.setUniform3fv("emissionFactor",
b.emissiveFactor);a.setUniform1f("reflectanceFactor",b.reflectanceFactor)}})(a=b.PhysicallyBasedRenderingParameters||(b.PhysicallyBasedRenderingParameters={}));var e,d,k,n,c,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./TextureCoordinateAttribute.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,
"__esModule",{value:!0});b.VertexTextureCoordinates=function(b,c){b.include(f.TextureCoordinateAttribute,c);b.fragment.code.add(a.glsl(e||(e=l(["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "],["\n  struct TextureLookupParameter {\n    vec2 uv;\n    ","\n  } vtc;\n  "])),c.supportsTextureAtlas?"vec2 size;":""));1===c.attributeTextureCoordinates&&b.fragment.code.add(a.glsl(d||(d=l(["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "],
["\n      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return texture2D(tex, params.uv);\n      }\n    "]))));2===c.attributeTextureCoordinates&&(b.include(h.TextureAtlasLookup),b.fragment.code.add(a.glsl(k||(k=l(["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "],["\n    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {\n        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);\n      }\n    "])))))};
var e,d,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.TextureCoordinateAttribute=function(b,k){1===k.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.vertex.code.add(f.glsl(h||(h=l(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "],
["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n      }\n    "])))));2===k.attributeTextureCoordinates&&(b.attributes.add("uv0","vec2"),b.varyings.add("vuv0","vec2"),b.attributes.add("uvRegion","vec4"),b.varyings.add("vuvRegion","vec4"),b.vertex.code.add(f.glsl(a||(a=l(["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "],["\n      void forwardTextureCoordinates() {\n        vuv0 \x3d uv0;\n        vuvRegion \x3d uvRegion;\n      }\n    "])))));
0===k.attributeTextureCoordinates&&b.vertex.code.add(f.glsl(e||(e=l(["\n      void forwardTextureCoordinates() {}\n    "],["\n      void forwardTextureCoordinates() {}\n    "]))))};var h,a,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.TextureAtlasLookup=function(a){a.extensions.add("GL_EXT_shader_texture_lod");
a.extensions.add("GL_OES_standard_derivatives");a.fragment.code.add(f.glsl(h||(h=l(["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "],
["\n    #ifndef GL_EXT_shader_texture_lod\n      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\n        float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\n        return max(0.0, 0.5 * log2(deltaMaxSqr));\n      }\n    #endif\n\n    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {\n      //[umin, vmin, umax, vmax]\n      vec2 atlasScale \x3d atlasRegion.zw - atlasRegion.xy;\n      vec2 uvAtlas \x3d fract(textureCoordinates) * atlasScale + atlasRegion.xy;\n\n      // calculate derivative of continuous texture coordinate\n      // to avoid mipmapping artifacts caused by manual wrapping in shader\n      vec2 dUVdx \x3d dFdx(textureCoordinates) * atlasScale;\n      vec2 dUVdy \x3d dFdy(textureCoordinates) * atlasScale;\n\n      #ifdef GL_EXT_shader_texture_lod\n        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);\n      #else\n        // use bias to compensate for difference in automatic vs desired mipmap level\n        vec2 dUVdxAuto \x3d dFdx(uvAtlas);\n        vec2 dUVdyAuto \x3d dFdy(uvAtlas);\n        float mipMapLevel \x3d calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);\n        float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);\n\n        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);\n      #endif\n    }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/shaders/DefaultMaterial.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/DiscardOrAdjustAlpha.glsl ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Offset.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/PositionAttribute.glsl ../core/shaderLibrary/attributes/SymbolColor.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/util/MixExternalColor.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new I.ShaderBuilder,W=q.vertex.code,F=q.fragment.code;q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");q.include(c.PositionAttribute);q.varyings.add("vpos","vec3");q.include(E.VisualVariables,b);q.include(k.InstancedDoublePrecision,b);q.include(t.VerticalOffset,b);0===b.output&&(q.include(n.NormalAttribute,
b),q.include(d.Transform,{linearDepth:!1}),0===b.normalType&&b.offsetBackfaces&&q.include(a.Offset),q.include(v.ComputeNormalTexture,b),q.include(u.VertexNormal,b),b.instancedColor&&q.attributes.add("instanceColor","vec4"),q.varyings.add("localvpos","vec3"),q.include(r.TextureCoordinateAttribute,b),q.include(h.ForwardLinearDepth,b),q.include(g.SymbolColor,b),q.include(p.VertexColor,b),q.vertex.uniforms.add("externalColor","vec4"),q.varyings.add("vcolorExt","vec4"),q.vertex.defines.addFloat("SYMBOL_ALPHA_CUTOFF",
.001),W.add(J.glsl(H||(H=l(["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ",
"\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        forwardNormalizedVertexColor();\n        vcolorExt \x3d externalColor;\n        ","\n        vcolorExt *\x3d vvColor();\n        vcolorExt *\x3d getSymbolColor();\n        forwardColorMixMode();\n\n        if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n          gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        }\n        else {\n          vpos \x3d calculateVPos();\n          localvpos \x3d vpos - view[3].xyz;\n          vpos \x3d subtractOrigin(vpos);\n          ",
"\n          vpos \x3d addVerticalOffset(vpos, localOrigin);\n          ","\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          ","\n        }\n        forwardLinearDepth();\n        forwardTextureCoordinates();\n      }\n    "])),b.instancedColor?"vcolorExt *\x3d instanceColor;":"",0===b.normalType?J.glsl(K||(K=l(["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"],["\n          vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));"]))):"",b.vertexTangets?
"transformVertexTangent(mat3(modelNormal));":"",0===b.normalType&&b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),q.include(e.Slice,b),q.include(m.EvaluateSceneLighting,b),q.include(y.EvaluateAmbientOcclusion,b),q.include(f.DiscardOrAdjustAlpha,b),b.receiveShadows&&q.include(C.ReadShadowMap,b),q.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity",
"float"),b.hasColorTexture&&q.fragment.uniforms.add("tex","sampler2D"),q.include(B.PhysicallyBasedRenderingParameters,b),q.include(A.PhysicallyBasedRendering,b),q.include(G.MixExternalColor,{stages:1}),q.include(w.Normals,b),F.add(J.glsl(Z||(Z=l(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        ","\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?J.glsl(L||(L=l(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":
""):J.glsl(P||(P=l(["vec4 texColor \x3d vec4(1.0);"],["vec4 texColor \x3d vec4(1.0);"]))),3===b.normalType?J.glsl(S||(S=l(["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"],["\n        vec3 normal \x3d screenDerivativeNormal(localvpos);"]))):J.glsl(R||(R=l(["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"],["\n        shadingParams.normalView \x3d vNormalWorld;\n        vec3 normal \x3d shadingNormal(shadingParams);"]))),
b.usePBR?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?J.glsl(O||(O=l(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):J.glsl(T||(T=l(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n          ",
""],["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n          ",""])),b.usePBR?J.glsl(Q||(Q=l(["\n          if (int(colorMixMode) \x3d\x3d 3) {\n            reflectance \x3d 0.2;\n            roughness \x3d 0.6;\n            metalness \x3d 0.0;\n          }"],["\n          if (int(colorMixMode) \x3d\x3d 3) {\n            reflectance \x3d 0.2;\n            roughness \x3d 0.6;\n            metalness \x3d 0.0;\n          }"]))):
""),b.hasNormalTexture?J.glsl(Y||(Y=l(["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"],["\n              mat3 tangentSpace \x3d ","\n              vec3 shadedNormal \x3d computeTextureNormal(tangentSpace, vuv0);"])),b.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"):"vec3 shadedNormal \x3d normal;",b.usePBR?J.glsl(N||(N=l(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 normalGround \x3d normalize(vpos + localOrigin);\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);"],
["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 normalGround \x3d normalize(vpos + localOrigin);\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);"]))):"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));
q.include(x.DefaultMaterialAuxiliaryPasses,b);return q};var K,H,L,P,S,R,O,Q,T,Y,N,Z})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["require","exports","../../../../../core/tsSupport/makeTemplateObjectHelper","../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.Offset=function(a){a.vertex.code.add(f.glsl(h||(h=l(["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "],
["\n    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {\n      vec3 camToVert \x3d posWorld - camPosWorld;\n\n      bool isBackface \x3d dot(camToVert, normalWorld) \x3e 0.0;\n      if (isBackface) {\n        posClip.z +\x3d 0.0000003 * posClip.w;\n      }\n      return posClip;\n    }\n  "]))))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../util/DecodeNormal.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.NormalAttribute=function(b,n){0===n.normalType&&(b.attributes.add("normal","vec3"),b.vertex.code.add(h.glsl(a||(a=l(["\n      vec3 normalModel() {\n        return normal;\n      }\n    "],["\n      vec3 normalModel() {\n        return normal;\n      }\n    "])))));1===n.normalType&&(b.include(f.DecodeNormal),b.attributes.add("normalCompressed","vec2"),b.vertex.code.add(h.glsl(e||
(e=l(["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "],["\n      vec3 normalModel() {\n        return decodeNormal(normalCompressed);\n      }\n    "])))));3===n.normalType&&(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(h.glsl(d||(d=l(["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "],["\n      vec3 screenDerivativeNormal(vec3 positionView) {\n        return normalize(cross(dFdx(positionView), dFdy(positionView)));\n      }\n    "])))))};
var a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.DecodeNormal=function(a){var b=f.glsl(h||(h=l(["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "],["\n    vec3 decodeNormal(vec2 f) {\n      float z \x3d 1.0 - abs(f.x) - abs(f.y);\n      return vec3(f + sign(f) * min(z, 0.0), z);\n    }\n  "])));
a.fragment.code.add(b);a.vertex.code.add(b)};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.SymbolColor=function(b,k){k.symbolColor?(b.include(f.DecodeSymbolColor),b.attributes.add("symbolColor",
"vec4"),b.varyings.add("colorMixMode","mediump float")):b.fragment.uniforms.add("colorMixMode","int");k.symbolColor?b.vertex.code.add(h.glsl(a||(a=l(["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "],["\n    int symbolColorMixMode;\n\n    vec4 getSymbolColor() {\n      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;\n    }\n\n    void forwardColorMixMode() {\n      colorMixMode \x3d float(symbolColorMixMode) + 0.5;\n    }\n  "])))):
b.vertex.code.add(h.glsl(e||(e=l(["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "],["\n    vec4 getSymbolColor() { return vec4(1.0); }\n    void forwardColorMixMode() {}\n    "]))))};var a,e})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["require","exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});b.DecodeSymbolColor=function(a){a.vertex.code.add(f.glsl(h||(h=l(["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "],["\n    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\n      float symbolAlpha \x3d 0.0;\n\n      const float maxTint \x3d 85.0;\n      const float maxReplace \x3d 170.0;\n      const float scaleAlpha \x3d 3.0;\n\n      if (symbolColor.a \x3e maxReplace) {\n        colorMixMode \x3d ",
";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\n      } else if (symbolColor.a \x3e maxTint) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\n      } else if (symbolColor.a \x3e 0.0) {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d scaleAlpha * symbolColor.a;\n      } else {\n        colorMixMode \x3d ",";\n        symbolAlpha \x3d 0.0;\n      }\n\n      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\n    }\n  "])),
f.glsl.int(1),f.glsl.int(3),f.glsl.int(4),f.glsl.int(1)))};var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","./NormalAttribute.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a,b){0===b.normalType||1===b.normalType?(a.include(f.NormalAttribute,b),a.varyings.add("vNormalWorld","vec3"),a.varyings.add("vNormalView","vec3"),a.vertex.uniforms.add("uTransformNormal_GlobalFromModel",
"mat3"),a.vertex.uniforms.add("uTransformNormal_ViewFromGlobal","mat3"),a.vertex.code.add(h.glsl(e||(e=l(["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "],["\n      void forwardNormal() {\n        vNormalWorld \x3d uTransformNormal_GlobalFromModel * normalModel();\n        vNormalView \x3d uTransformNormal_ViewFromGlobal * vNormalWorld;\n      }\n    "]))))):
a.vertex.code.add(h.glsl(d||(d=l(["\n      void forwardNormal() {}\n    "],["\n      void forwardNormal() {}\n    "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexNormal=a;(function(a){a.bindUniforms=function(a,b){a.setUniformMatrix4fv("viewNormal",b.viewInvTransp)}})(a=b.VertexNormal||(b.VertexNormal={}));var e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../DiscardOrAdjustAlpha.glsl ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultMaterialAuxiliaryPasses=function(b,q){var G=b.vertex.code,K=b.fragment.code;if(1===q.output||3===q.output)b.include(a.Transform,{linearDepth:!0}),b.include(d.TextureCoordinateAttribute,q),b.include(g.VisualVariables,q),b.include(n.OutputDepth,q),b.include(h.Slice,q),b.vertex.uniforms.add("nearFar","vec2"),b.varyings.add("depth","float"),q.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),G.add(r.glsl(p||
(p=l(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        forwardTextureCoordinates();\n      }\n    "])))),
b.include(f.DiscardOrAdjustAlpha,q),K.add(r.glsl(t||(t=l(["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "],["\n      void main(void) {\n        discardBySlice(vpos);\n        ","\n        outputDepth(depth);\n      }\n    "])),q.hasColorTexture?r.glsl(u||(u=l(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
""));2===q.output&&(b.include(a.Transform,{linearDepth:!1}),b.include(e.NormalAttribute,q),b.include(k.VertexNormal,q),b.include(d.TextureCoordinateAttribute,q),b.include(g.VisualVariables,q),q.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),b.vertex.uniforms.add("viewNormal","mat4"),b.varyings.add("vPositionView","vec3"),G.add(r.glsl(v||(v=l(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],
["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        ","\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])),0===q.normalType?r.glsl(x||(x=l(["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"],["\n        vNormalWorld \x3d dpNormalView(vvLocalNormal(normalModel()));"]))):"")),b.include(h.Slice,
q),b.include(f.DiscardOrAdjustAlpha,q),K.add(r.glsl(A||(A=l(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n\n        ","\n        gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n      }\n    "])),q.hasColorTexture?r.glsl(y||(y=l(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],
["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):"",3===q.normalType?r.glsl(m||(m=l(["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"],["\n            vec3 normal \x3d screenDerivativeNormal(vPositionView);"]))):r.glsl(w||(w=l(["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"],["\n            vec3 normal \x3d normalize(vNormalWorld);\n            if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;"]))))));
4===q.output&&(b.include(a.Transform,{linearDepth:!1}),b.include(d.TextureCoordinateAttribute,q),b.include(g.VisualVariables,q),q.hasColorTexture&&b.fragment.uniforms.add("tex","sampler2D"),G.add(r.glsl(B||(B=l(["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "],["\n      void main(void) {\n        vpos \x3d calculateVPos();\n        vpos \x3d subtractOrigin(vpos);\n        vpos \x3d addVerticalOffset(vpos, localOrigin);\n        gl_Position \x3d transformPosition(proj, view, vpos);\n        forwardTextureCoordinates();\n      }\n    "])))),
b.include(h.Slice,q),b.include(f.DiscardOrAdjustAlpha,q),b.include(c.OutputHighlight),K.add(r.glsl(E||(E=l(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        outputHighlight();\n      }\n    "])),q.hasColorTexture?r.glsl(C||(C=l(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        discardOrAdjustAlpha(texColor);"]))):
"")))};var p,u,t,x,v,y,m,w,A,B,C,E})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.OutputDepth=function(b,k){b.include(f.RgbaFloatEncoding);3===k.output?(b.extensions.add("GL_OES_standard_derivatives"),b.fragment.code.add(h.glsl(a||(a=l(["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "],
["\n      float _calculateFragDepth(const in float depth) {\n        // calc polygon offset\n        const float SLOPE_SCALE \x3d 2.0;\n        const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\n        float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\n        float result \x3d depth + SLOPE_SCALE * m + BIAS;\n        return clamp(result, .0, .999999);\n      }\n\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_calculateFragDepth(_linearDepth));\n      }\n    "]))))):
1===k.output&&b.fragment.code.add(h.glsl(e||(e=l(["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "],["\n      void outputDepth(float _linearDepth) {\n        gl_FragColor \x3d float2rgba(_linearDepth);\n      }\n    "]))))};var a,e})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../attributes/VertexTextureCoordinates.glsl",
"../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeNormalTexture=function(b,g){var c=b.fragment;c.uniforms.add("normalTexture","sampler2D");c.uniforms.add("normalTextureSize","vec2");g.vertexTangets?(b.attributes.add("tangent","vec4"),b.varyings.add("vTangent","vec4"),b.vertex.code.add(h.glsl(a||(a=l(["\n      void transformVertexTangent(mat3 modelTransformForNormals) {\n        vTangent.xyz \x3d modelTransformForNormals * tangent.xyz;\n        vTangent.w \x3d tangent.w;\n      }\n    "],
["\n      void transformVertexTangent(mat3 modelTransformForNormals) {\n        vTangent.xyz \x3d modelTransformForNormals * tangent.xyz;\n        vTangent.w \x3d tangent.w;\n      }\n    "])))),2===g.doubleSidedMode?c.code.add(h.glsl(e||(e=l(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "])))):c.code.add(h.glsl(d||(d=l(["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "],
["\n      mat3 computeTangentSpace(vec3 normal) {\n        float tangentHeadedness \x3d vTangent.w;\n        vec3 tangent \x3d normalize(vTangent.xyz);\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\n        return mat3(tangent, bitangent, normal);\n      }\n    "]))))):(b.extensions.add("GL_OES_standard_derivatives"),c.code.add(h.glsl(k||(k=l(['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-20)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '],
['\n    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {\n\n      vec3 Q1 \x3d dFdx(pos);\n      vec3 Q2 \x3d dFdy(pos);\n\n      vec2 stx \x3d dFdx(st);\n      vec2 sty \x3d dFdy(st);\n\n      float det \x3d stx.t * sty.s - sty.t * stx.s;\n\n      vec3 T \x3d stx.t * Q2 - sty.t * Q1; // compute tangent\n      T \x3d T - normal * dot(normal, T); // orthogonalize tangent\n      T *\x3d inversesqrt(max(dot(T,T), 1.e-20)); // "soft" normalize - goes to 0 when T goes to 0\n      vec3 B \x3d sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B\n      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates\n    }\n  '])))));
0!==g.attributeTextureCoordinates&&(b.include(f.VertexTextureCoordinates,g),c.code.add(h.glsl(n||(n=l(["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "],["\n    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {\n      vtc.uv \x3d uv;\n      ","\n      vec3 rawNormal \x3d textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;\n      return tangentSpace * rawNormal;\n    }\n  "])),
g.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":"")))};var a,e,d,k,n})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientOcclusion=function(b,d){b=b.fragment;d.receiveAmbientOcclusion?(b.uniforms.add("ssaoTex","sampler2D"),b.uniforms.add("viewportPixelSz",
"vec4"),b.code.add(f.glsl(h||(h=l(["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "],["\n      float evaluateAmbientOcclusion() {\n        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      }\n\n      float evaluateAmbientOcclusionInverse() {\n        float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n        return viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\n      }\n    "]))))):
b.code.add(f.glsl(a||(a=l(["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "],["\n      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion\n      float evaluateAmbientOcclusionInverse() { return 1.0; }\n    "]))))};var h,a})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateMainLighting.glsl ./PhysicallyBasedRendering.glsl ./PiUtils.glsl ./ReadShadowMap.glsl ../../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateSceneLighting=function(b,B){var A=b.fragment;b.include(a.EvaluateMainLighting);b.include(h.EvaluateAmbientOcclusion,B);B.usePBR&&b.include(e.PhysicallyBasedRendering,B);b.include(f.EvaluateAmbientLighting,B);B.receiveShadows&&b.include(k.ReadShadowMap,B);A.uniforms.add("lightingGlobalFactor","float");A.uniforms.add("ambientBoostFactor","float");B.useOldSceneLightInterface?(b.include(d.PiUtils),A.code.add(n.glsl(c||
(c=l(["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;  // 1 / GAMMA_SRGB\n\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(1.0/GAMMA_SRGB));\n\n      return outColor;\n    }\n  "],
["\n    const float GAMMA_SRGB \x3d 2.1;\n    const float INV_GAMMA_SRGB \x3d 0.4761904;  // 1 / GAMMA_SRGB\n\n    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\n      // evaluate the main light\n      #if defined(TREE_RENDERING)\n        // Special case for tree rendering:\n        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\n        // facing away from the light. The idea is to get an effect where light is transmitted\n        // through the tree.\n        float minDot \x3d -0.5;\n        float dotRange \x3d 1.0 - minDot;\n        float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\n\n        float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\n      #else\n        float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\n      #endif\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\n      vec3 ambientLight \x3d calculateAmbientIrradiance(normal, ssao);\n\n      // inverse gamma correction on the albedo color\n      vec3 albedoGammaC \x3d pow(albedo, vec3(GAMMA_SRGB));\n\n      // physically correct BRDF normalizes by PI\n      vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\n      totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n      vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\n\n      // apply gamma correction to the computed color\n      outColor \x3d pow(outColor, vec3(1.0/GAMMA_SRGB));\n\n      return outColor;\n    }\n  "]))))):
(0===B.viewingMode?A.code.add(n.glsl(g||(g=l(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        vec3 shadingNormalWorld \x3d normalize(vPosWorld);\n        float vndl \x3d -dot(shadingNormalWorld, lightingMainDirection);\n\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))):
A.code.add(n.glsl(r||(r=l(["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "],["\n      float _oldHeuristicLighting(vec3 vPosWorld) {\n        float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\n        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\n      }\n    "])))),A.code.add(n.glsl(p||(p=l(["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "],
["\n      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vPosWorld);\n        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;\n      }\n    "])))),B.usePBR?(A.code.add(n.glsl(t||(t=l(["\n      // The albedo color of the ground used in the environment illumination algorithm\n      const float GROUND_REFLECTANCE \x3d 0.2; //This is the set value of the diffuse reflectance of the ground surface\n\n      const float GAMMA_SRGB \x3d 2.1;\n      const float INV_GAMMA_SRGB \x3d 0.4761904;  // 1 / GAMMA_SRGB\n\n      const float fillLightIntensity \x3d 0.25;               // intensity of the directional ambient component\n      const float horizonLightDiffusion \x3d 0.4;             // diffusion value describing the area and smoothness of the horizon light\n      const float additionalAmbientIrradianceFactor \x3d 0.02; // Additional irradiance factor - making everything brighter and more colorful\n      "],
["\n      // The albedo color of the ground used in the environment illumination algorithm\n      const float GROUND_REFLECTANCE \x3d 0.2; //This is the set value of the diffuse reflectance of the ground surface\n\n      const float GAMMA_SRGB \x3d 2.1;\n      const float INV_GAMMA_SRGB \x3d 0.4761904;  // 1 / GAMMA_SRGB\n\n      const float fillLightIntensity \x3d 0.25;               // intensity of the directional ambient component\n      const float horizonLightDiffusion \x3d 0.4;             // diffusion value describing the area and smoothness of the horizon light\n      const float additionalAmbientIrradianceFactor \x3d 0.02; // Additional irradiance factor - making everything brighter and more colorful\n      "])))),
A.code.add(n.glsl(x||(x=l(["\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, float _roughness, float _metalness, vec3 _emission, float _reflectance, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.groundReflectance \x3d vec3(GROUND_REFLECTANCE);\n        inputs.ssao \x3d ssao;\n\n        inputs.roughness \x3d clamp(_roughness * _roughness, 0.001, 0.99);\n        inputs.metalness \x3d _metalness;\n      "],
["\n      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, float _roughness, float _metalness, vec3 _emission, float _reflectance, float additionalAmbientIrradiance)\n      {\n        // Calculate half vector between view and light direction\n        vec3 viewDirection \x3d -viewDir;\n        vec3 mainLightDirection \x3d -lightingMainDirection;\n        vec3 h \x3d normalize(viewDirection + mainLightDirection);\n\n        PBRShadingInfo inputs;\n        inputs.NdotL \x3d clamp(dot(normal, mainLightDirection), 0.001, 1.0);\n        inputs.NdotV \x3d clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);\n        inputs.NdotH \x3d clamp(dot(normal, h), 0.0, 1.0);\n        inputs.VdotH \x3d clamp(dot(viewDirection, h), 0.0, 1.0);\n        inputs.NdotNG \x3d clamp(dot(normal, normalGround), -1.0, 1.0);\n        vec3 reflectedView \x3d normalize(reflect(viewDirection, normal));\n        inputs.RdotNG \x3d clamp(dot(reflectedView, normalGround), -1.0, 1.0);\n\n        inputs.albedoLinear \x3d pow(albedo, vec3(GAMMA_SRGB));\n        inputs.groundReflectance \x3d vec3(GROUND_REFLECTANCE);\n        inputs.ssao \x3d ssao;\n\n        inputs.roughness \x3d clamp(_roughness * _roughness, 0.001, 0.99);\n        inputs.metalness \x3d _metalness;\n      "])))),
A.code.add(n.glsl(v||(v=l(["\n        inputs.f0 \x3d (0.16 * _reflectance * _reflectance) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "],["\n        inputs.f0 \x3d (0.16 * _reflectance * _reflectance) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;\n        inputs.f90 \x3d vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 \x3d 1.0\n        inputs.diffuseColor \x3d inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);\n      "])))),
A.code.add(n.glsl(y||(y=l(["\n        vec3 ambientDir \x3d normalize(vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2],\n                                      - 5.0 * normalGround[0] - normalGround[2] * normalGround[1],\n                                        normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d inputs.groundReflectance * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "],
["\n        vec3 ambientDir \x3d normalize(vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2],\n                                      - 5.0 * normalGround[0] - normalGround[2] * normalGround[1],\n                                        normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]));\n\n        inputs.NdotAmbDir \x3d abs(dot(normal, ambientDir));\n\n        // Calculate the irradiance components: sun, fill lights and the sky.\n        vec3 mainLightIrradianceComponent  \x3d inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;\n        vec3 fillLightsIrradianceComponent \x3d inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;\n        // calculateAmbientIrradiance for localView and additionalLight for gloabalView\n        vec3 ambientLightIrradianceComponent \x3d calculateAmbientIrradiance(normal, ssao) + additionalLight;\n\n        // Assemble the overall irradiance of the sky that illuminates the surface\n        inputs.skyIrradianceToSurface    \x3d ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance\n        inputs.groundIrradianceToSurface \x3d inputs.groundReflectance * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;\n      "])))),
A.code.add(n.glsl(m||(m=l(["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d inputs.groundReflectance * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + inputs.groundReflectance[1]);\n        "],
["\n        vec3 horizonRingDir \x3d inputs.RdotNG * normalGround - reflectedView;\n        vec3 horizonRingH \x3d normalize(viewDirection + horizonRingDir);\n        inputs.NdotH_Horizon \x3d dot(normal, horizonRingH);\n\n        vec3 mainLightRadianceComponent  \x3d normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);\n        vec3 horizonLightRadianceComponent \x3d normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;\n        vec3 ambientLightRadianceComponent \x3d calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView\n\n        // Assemble the overall radiance of the sky that illuminates the surface\n        inputs.skyRadianceToSurface    \x3d  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;\n        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance\n        inputs.groundRadianceToSurface \x3d inputs.groundReflectance * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;\n\n        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed\n        inputs.averageAmbientRadiance \x3d ambientLightIrradianceComponent[1] * (1.0 + inputs.groundReflectance[1]);\n        "])))),
A.code.add(n.glsl(w||(w=l(["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));\n        return outColor;\n      }\n    "],
["\n        vec3 reflectedColorComponent \x3d evaluateEnvironmentIllumination(inputs);\n        vec3 additionalMaterialReflectanceComponent \x3d inputs.albedoLinear * additionalAmbientIrradiance;\n        vec3 emissionComponent \x3d pow(_emission, vec3(GAMMA_SRGB));\n        vec3 outColorLinear \x3d reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;\n        vec3 outColor \x3d pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));\n        return outColor;\n      }\n    "]))))):
A.code.add(n.glsl(u||(u=l(["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        float gamma \x3d 2.1;\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(gamma));\n\n        // physically correct BRDF normalizes by PI\n        const float PI \x3d 3.14159;\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(1.0/gamma));\n\n        return outColor;\n      }\n      "],
["\n      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)\n      {\n        vec3 mainLighting \x3d evaluateMainLighting(normalWorld, mainLightShadow);\n        vec3 ambientLighting \x3d calculateAmbientIrradiance(normalWorld, ambientOcclusion);\n        // inverse gamma correction on the base color\n        float gamma \x3d 2.1;\n        vec3 baseColorLinear \x3d pow(baseColor, vec3(gamma));\n\n        // physically correct BRDF normalizes by PI\n        const float PI \x3d 3.14159;\n        vec3 totalLight \x3d mainLighting + ambientLighting + additionalLight;\n        totalLight \x3d min(totalLight, vec3(PI, PI, PI));\n        vec3 outColor \x3d vec3((baseColorLinear / PI) * totalLight);\n\n        // apply gamma correction to the computed color\n        outColor \x3d pow(outColor, vec3(1.0/gamma));\n\n        return outColor;\n      }\n      "])))))};
var c,g,r,p,u,t,x,v,y,m,w})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateAmbientLighting=function(b,n){b=b.fragment;var c=void 0!==n.lightingSphericalHarmonicsOrder?n.lightingSphericalHarmonicsOrder:2;0===c?(b.uniforms.add("lightingAmbientSH0","vec3"),
b.code.add(f.glsl(h||(h=l(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):1===c?(b.uniforms.add("lightingAmbientSH_R",
"vec4"),b.uniforms.add("lightingAmbientSH_G","vec4"),b.uniforms.add("lightingAmbientSH_B","vec4"),b.code.add(f.glsl(a||(a=l(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec4 sh0 \x3d vec4(\n          0.282095,\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y\n        );\n        vec3 ambientLight \x3d vec3(\n          dot(lightingAmbientSH_R, sh0),\n          dot(lightingAmbientSH_G, sh0),\n          dot(lightingAmbientSH_B, sh0)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "]))))):2===c&&(b.uniforms.add("lightingAmbientSH0",
"vec3"),b.uniforms.add("lightingAmbientSH_R1","vec4"),b.uniforms.add("lightingAmbientSH_G1","vec4"),b.uniforms.add("lightingAmbientSH_B1","vec4"),b.uniforms.add("lightingAmbientSH_R2","vec4"),b.uniforms.add("lightingAmbientSH_G2","vec4"),b.uniforms.add("lightingAmbientSH_B2","vec4"),b.code.add(f.glsl(e||(e=l(["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "],
["\n      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {\n        vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\n\n        vec4 sh1 \x3d vec4(\n          0.488603 * normal.x,\n          0.488603 * normal.z,\n          0.488603 * normal.y,\n          1.092548 * normal.x * normal.y\n        );\n        vec4 sh2 \x3d vec4(\n          1.092548 * normal.y * normal.z,\n          0.315392 * (3.0 * normal.z * normal.z - 1.0),\n          1.092548 * normal.x * normal.z,\n          0.546274 * (normal.x * normal.x - normal.y * normal.y)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R1, sh1),\n          dot(lightingAmbientSH_G1, sh1),\n          dot(lightingAmbientSH_B1, sh1)\n        );\n        ambientLight +\x3d vec3(\n          dot(lightingAmbientSH_R2, sh2),\n          dot(lightingAmbientSH_G2, sh2),\n          dot(lightingAmbientSH_B2, sh2)\n        );\n        return ambientLight * (1.0 - ambientOcclusion);\n      }\n    "])))),
n.usePBR&&b.code.add(f.glsl(d||(d=l(["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "],["\n        const vec3 skyTransmittance \x3d vec3(0.9, 0.9, 1.0);\n\n        vec3 calculateAmbientRadiance(float ambientOcclusion)\n        {\n          vec3 ambientLight \x3d 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;\n          return ambientLight *\x3d (1.0 - ambientOcclusion) * skyTransmittance;\n        }\n      "])))))};
var h,a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.EvaluateMainLighting=function(a){a=a.fragment;a.uniforms.add("lightingMainDirection","vec3");a.uniforms.add("lightingMainIntensity","vec3");a.uniforms.add("lightingFixedFactor","float");a.code.add(f.glsl(h||
(h=l(["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "],["\n    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {\n      float dotVal \x3d clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);\n\n      // move lighting towards (1.0, 1.0, 1.0) if requested\n      dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\n\n      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);\n    }\n  "]))))};
var h})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.Normals=function(b,n){b=b.fragment;b.code.add(f.glsl(h||(h=l(["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "],["\n    struct ShadingNormalParameters {\n      vec3 normalView;\n      vec3 viewDirection;\n    } shadingParams;\n    "]))));
1===n.doubleSidedMode?b.code.add(f.glsl(a||(a=l(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return dot(params.normalView, params.viewDirection) \x3e 0.0 ? normalize(-params.normalView) : normalize(params.normalView);\n      }\n    "])))):2===n.doubleSidedMode?
b.code.add(f.glsl(e||(e=l(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "],["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);\n      }\n    "])))):b.code.add(f.glsl(d||(d=l(["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "],
["\n      vec3 shadingNormal(ShadingNormalParameters params) {\n        return normalize(params.normalView);\n      }\n    "]))))};var h,a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","./ColorConversion.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.MixExternalColor=function(b,d){b.include(f.ColorConversion,
d);var e=h.glsl(a||(a=l(["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",
") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "],["\n    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      vec3 internalMixed \x3d internalColor * textureColor;\n      vec3 allMixed \x3d internalMixed * externalColor;\n\n      if (mode \x3d\x3d ",
") {\n        return allMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalColor;\n      }\n      else {\n        // tint (or something invalid)\n        float vIn \x3d rgb2v(internalMixed);\n        vec3 hsvTint \x3d rgb2hsv(externalColor);\n        vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);\n        return hsv2rgb(hsvOut);\n      }\n    }\n\n    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\n      // workaround for artifacts in OSX using Intel Iris Pro\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\n      float internalMixed \x3d internalOpacity * textureOpacity;\n      float allMixed \x3d internalMixed * externalOpacity;\n\n      if (mode \x3d\x3d ",
") {\n        return internalMixed;\n      }\n      else if (mode \x3d\x3d ",") {\n        return externalOpacity;\n      }\n      else {\n        // multiply or tint (or something invalid)\n        return allMixed;\n      }\n    }\n  "])),h.glsl.int(1),h.glsl.int(2),h.glsl.int(3),h.glsl.int(2),h.glsl.int(3));switch(d.stages){case 0:b.vertex.code.add(e);break;case 1:b.fragment.code.add(e);break;default:b.vertex.code.add(e),b.fragment.code.add(e)}};var a})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../core/shaderLibrary/default/RealisticTree.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ./DefaultMaterialTechnique ../../../webgl/Program".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});f=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.initializeProgram=function(b){var e=c.shader.get(),g=this.configuration,e=e.build({output:g.output,viewingMode:b.viewingMode,receiveShadows:g.receiveShadows,slicePlaneEnabled:g.slicePlaneEnabled,sliceHighlightDisabled:g.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:g.symbolColors,vvSize:g.vvSize,vvColor:g.vvColor,
vvInstancingEnabled:!0,instanced:g.instanced,instancedColor:g.instancedColor,instancedDoublePrecision:g.instancedDoublePrecision,useOldSceneLightInterface:!1,usePBR:g.usePBR,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:g.hasColorTexture,receiveAmbientOcclusion:g.receiveAmbientOcclusion,usePBRforWater:!1,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:g.hasColorTexture?
1:0,textureAlphaPremultiplied:g.textureAlphaPremultiplied,attributeColor:g.vertexColors,screenSizePerspectiveEnabled:g.screenSizePerspective,verticalOffsetEnabled:g.verticalOffset,offsetBackfaces:g.offsetBackfaces,doublePrecisionRequiresObfuscation:a.doublePrecisionRequiresObfuscation(b.rctx),alphaDiscardMode:g.alphaDiscardMode,supportsTextureAtlas:!1});return new n(b.rctx,e.generateSource("vertex"),e.generateSource("fragment"),d.Default3D)};c.shader=new e.ReloadableShaderModule(h,"../core/shaderLibrary/default/RealisticTree.glsl",
q);return c}(k.DefaultMaterialTechnique);b.RealisticTreeTechnique=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/RealisticTree.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../DiscardOrAdjustAlpha.glsl ../ForwardLinearDepth.glsl ../Offset.glsl ../Slice.glsl ../Transform.glsl ../attributes/InstancedDoublePrecision.glsl ../attributes/NormalAttribute.glsl ../attributes/PositionAttribute.glsl ../attributes/SymbolColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexColor.glsl ../attributes/VerticalOffset.glsl ./DefaultMaterialAuxiliaryPasses.glsl ../shading/EvaluateAmbientOcclusion.glsl ../shading/EvaluateSceneLighting.glsl ../shading/PhysicallyBasedRendering.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/ReadShadowMap.glsl ../shading/VisualVariables.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new E.ShaderBuilder,O=q.vertex.code,Y=q.fragment.code;q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");q.include(c.PositionAttribute);q.varyings.add("vpos","vec3");q.include(A.VisualVariables,b);q.include(k.InstancedDoublePrecision,b);q.include(u.VerticalOffset,b);0===b.output&&(q.include(n.NormalAttribute,b),q.include(d.Transform,
{linearDepth:!1}),b.offsetBackfaces&&q.include(a.Offset),b.instancedColor&&q.attributes.add("instanceColor","vec4"),q.varyings.add("vNormalWorld","vec3"),q.varyings.add("localvpos","vec3"),q.include(r.TextureCoordinateAttribute,b),q.include(h.ForwardLinearDepth,b),q.include(g.SymbolColor,b),q.include(p.VertexColor,b),q.vertex.uniforms.add("externalColor","vec4"),q.varyings.add("vcolorExt","vec4"),q.vertex.defines.addFloat("SYMBOL_ALPHA_CUTOFF",.001),O.add(C.glsl(G||(G=l(["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ",
"\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "],["\n        void main(void) {\n          forwardNormalizedVertexColor();\n          vcolorExt \x3d externalColor;\n          ","\n          vcolorExt *\x3d vvColor();\n          vcolorExt *\x3d getSymbolColor();\n          forwardColorMixMode();\n\n          if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\n            gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n          }\n          else {\n            vpos \x3d calculateVPos();\n            localvpos \x3d vpos - view[3].xyz;\n            vpos \x3d subtractOrigin(vpos);\n            vNormalWorld \x3d dpNormal(vvLocalNormal(normalModel()));\n            vpos \x3d addVerticalOffset(vpos, localOrigin);\n            gl_Position \x3d transformPosition(proj, view, vpos);\n            ",
"\n          }\n          forwardLinearDepth();\n          forwardTextureCoordinates();\n        }\n      "])),b.instancedColor?"vcolorExt *\x3d instanceColor;":"",b.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":"")),q.include(e.Slice,b),q.include(v.EvaluateSceneLighting,b),q.include(x.EvaluateAmbientOcclusion,b),q.include(f.DiscardOrAdjustAlpha,b),b.receiveShadows&&q.include(w.ReadShadowMap,b),q.fragment.uniforms.add("camPos","vec3").add("localOrigin",
"vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),q.fragment.uniforms.add("view","mat4"),b.hasColorTexture&&q.fragment.uniforms.add("tex","sampler2D"),q.include(m.PhysicallyBasedRenderingParameters,b),q.include(y.PhysicallyBasedRendering,b),q.include(B.MixExternalColor,{stages:1}),Y.add(C.glsl(R||(R=l(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 viewDirection \x3d normalize(vpos - camPos);\n        ","\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n        ssao *\x3d getBakedOcclusion();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n        ",
"\n        vec3 matColor \x3d max(ambient, diffuse);\n        ","\n        ","\n        ","\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\n      }\n    "])),b.hasColorTexture?C.glsl(J||(J=l(["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"],["\n        vec4 texColor \x3d texture2D(tex, vuv0);\n        ","\n        discardOrAdjustAlpha(texColor);"])),b.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":
""):C.glsl(I||(I=l(["vec4 texColor \x3d vec4(1.0);"],["vec4 texColor \x3d vec4(1.0);"]))),b.usePBR?"applyPBRFactors();":"",b.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":0===b.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;",b.attributeColor?C.glsl(K||(K=l(["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"],
["\n        vec3 albedo_ \x3d mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));"]))):C.glsl(L||(L=l(["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n          ",
""],["\n        vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\n        float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\n          ",""])),b.usePBR?C.glsl(H||(H=l(["\n          if (int(colorMixMode) \x3d\x3d 3) {\n            reflectance \x3d 0.2;\n            roughness \x3d 0.6;\n            metalness \x3d 0.0;\n          }"],["\n          if (int(colorMixMode) \x3d\x3d 3) {\n            reflectance \x3d 0.2;\n            roughness \x3d 0.6;\n            metalness \x3d 0.0;\n          }"]))):
""),C.glsl(P||(P=l(["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"],
["\n        vec3 shadedNormal \x3d normalize(vNormalWorld);\n        albedo_ *\x3d 1.2;\n        vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\n        float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\n        float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);\n        float treeRadialFalloff \x3d vColor.r;\n        float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\n        additionalLight +\x3d backLightFactor * lightingMainIntensity;"]))),
b.usePBR?C.glsl(S||(S=l(["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 normalGround \x3d normalize(vpos + localOrigin);\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);"],["\n            float additionalAmbientIrradiance \x3d additionalAmbientIrradianceFactor * lightingMainIntensity[2];\n            vec3 normalGround \x3d normalize(vpos + localOrigin);\n            vec3 shadedColor \x3d evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, roughness, metalness, emission, reflectance, additionalAmbientIrradiance);"]))):
"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);")));q.include(t.DefaultMaterialAuxiliaryPasses,b);return q};var G,J,I,K,H,L,P,S,R})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/cim/CIMSymbolRasterizer ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/utils ./constants ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F){function ca(a){return p.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(b,"__esModule",{value:!0});var U=v.mat4f64.create(),ea=m.vec3f64.fromValues(0,0,1),ha=[.25,.25,.75,.75],ka=[64,64];q=function(b){function w(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._cimLayers=null;a._cimSymbolMaterials=new Map;a._cimSymbolDrapedMaterials=new Map;a._cimSymbolTextures=new Map;a._cimMaterialParametersInfo=null;
a._cimRequiredFields=null;a._cimScaleFactorOrFunction=null;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._drapedMaterial=null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return a}f(w,b);w.prototype.getCachedSize=function(){return{size:this._getIconSize()}};w.prototype.doLoad=function(b){return a(this,void 0,void 0,function(){var a,c,d,e;return h(this,function(g){switch(g.label){case 0:this._validateOrThrow();a=this._prepareMaterialParameters();
c=this._getPrimitive();if(!p.isSome(c))return[3,1];this._prepareResourcesPrimitive(a,c);return[3,5];case 1:return d=G.getIconHref(this.symbol,this.symbolLayer),(e=x.dataComponents(d))&&"application/json"===e.mediaType?[4,this._prepareResourcesCIM(a,JSON.parse(e.data),b)]:[3,3];case 2:return g.sent(),[3,5];case 3:return[4,this._prepareResourcesHref(a,d,b)];case 4:g.sent(),g.label=5;case 5:return[2]}})})};w.prototype._validateOrThrow=function(){if(!this._drivenProperties.size){var a=R.validateSymbolLayerSize(this._getIconSize());
if(a)throw new c("graphics3diconsymbollayer:invalid-size",a);}};w.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?t.pt2px(a.size):16);return this._drivenProperties.size?Math.max(a,64):a};w.prototype._generateTextureCIM=function(a){var b=this._getGraphicHash(a),c=""===b?null:this._cimSymbolTextures.get(b);c||(a=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,a,{scaleFactor:this._cimScaleFactorOrFunction}),this._cimMaterialParametersInfo.anchorPos=
this._getAnchorPos("relative",a.anchorPosition),c=new V(a.imageData,"symbol",{width:a.imageData.width,height:a.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(b,c),this._context.stage.add(4,c));return c};w.prototype._computeSize=function(a,b){a=a.width/a.height;return 1<a?[b,Math.round(b/a)]:[Math.round(b*a),b]};w.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},b=this.symbol;if(b&&"point-3d"===
b.type&&b.hasVisibleVerticalOffset()){var b=b.verticalOffset,c=b.minWorldLength,d=b.maxWorldLength;a.verticalOffset={screenLength:t.pt2px(b.screenLength),minWorldLength:c||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);return a};w.prototype._prepareResourcesPrimitive=function(a,b){var c=this,d=this._getOutlineSize();if(ca(b)&&0===d)throw Error("Nothing to render");this._outlineSize=
d;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var e=this._context.sharedResources.textures.fromData(b,function(){var a;switch(b){case "circle":a=Q.createCircle(128,64);break;case "square":a=Q.createSquare(128,64);break;case "kite":a=Q.createKite(128,64);break;case "cross":a=Q.createCross(128,64);break;case "x":a=Q.createX(128,64);break;case "triangle":a=Q.createTriangle(128,64);break;default:n.neverReached(b)}return new V(a,"sdf_"+b,{mipmap:!1,
wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=e.texture;this._releaseTexture=function(){return c._context.sharedResources.textures.release(e.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=ha;a.textureId=this._texture.id;d=this._getIconSize();this._size=[d,d];this._symbolTextureRatio=2;this._createMaterialsAndAddToStage(a,this._context.stage)};w.prototype._prepareResourcesHref=function(b,d,e){return a(this,void 0,void 0,function(){var a,
f,m,p,n,r,w,l,v=this;return h(this,function(h){switch(h.label){case 0:if(!g("esri-canvas-svg-support")&&x.isSVG(d))throw a="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",new c("graphics3diconsymbollayer:unsupported-image-format",a);this._outlineSize=this._getOutlineSize();b.color=this._getFillColor();b.outlineColor=this._getOutlineColor();b.outlineSize=this._outlineSize;b.textureIsSignedDistanceField=!1;f=this._getIconSize();m=f*this._context.layerView.view.pixelRatio;
return[4,k.result(this._context.sharedResources.textures.fromUrl(d,m,{signal:e}))];case 1:p=h.sent();if(!1===p.ok)throw u.throwIfAbortError(p.error),a="Failed to load (Request for icon resource failed: "+d+")",new c("graphics3diconsymbollayer:request-failed",a);n=p.value;r=n.uid;w=n.texture;this._releaseTexture=function(){return v._context.sharedResources.textures.release(r)};l=w.params;this._size=this._computeSize(l,f);b.textureId=w.id;this._createMaterialsAndAddToStage(b,this._context.stage);return[2]}})})};
w.prototype._prepareResourcesCIM=function(b,c,e){return a(this,void 0,void 0,function(){var a,g,f,k,m,p,n,r,w,l,v;return h(this,function(h){switch(h.label){case 0:return a=new d.CIMSymbol({data:c}),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new C(this._context.renderCoordsHelper.spatialReference,!0)),g=this._context.layer.fields?this._context.layer.fields.map(function(a){return a.toJSON()}):null,f=this,[4,this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(a,
g,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:e})];case 1:f._cimLayers=h.sent();if(!this._context.renderer||"dictionary"!==this._context.renderer.type||!this._context.renderer.scaleExpression)return[3,4];p=this._context.renderer;if(!isNaN(p.scaleExpression))return[3,3];n=p.scaleExpression;return[4,B.createRendererExpression(n,this._context.layer.spatialReference,g)];case 2:return r=h.sent(),m=function(a,b,c){a=
J.callWithFeature(r,a,{$view:c},"esriGeometryPoint",b);return null!==a?a:1},[3,4];case 3:k=Number(p.scaleExpression),h.label=4;case 4:this._cimScaleFactorOrFunction=k||m||1;if(this._context.renderer)return[3,5];l=[];return[3,7];case 5:return[4,this._context.renderer.getRequiredFields(this._context.layer.fields)];case 6:l=h.sent(),h.label=7;case 7:return w=l,u.throwIfAborted(e),v=this._context.layer.fieldsIndex,this._cimRequiredFields=w.map(function(a){return v.get(a).name}),this._cimMaterialParametersInfo=
b,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1,[2]}})})};w.prototype._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||E.defaultPrimitive};w.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(p.isSome(a.outline)&&
null!=a.outline.size)return Math.max(t.pt2px(a.outline.size),0);a=this._getPrimitive();a=ca(a)?1.5:0;return Math.max(a,0)};w.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),b=p.get(this.symbolLayer,"outline","color");if(p.isSome(b)){var c=e.toUnitRGB(b);return[c[0],c[1],c[2],b.a*a]}return[0,0,0,0]};w.prototype._getFillColor=function(){if(ca(this._getPrimitive()))return I.TRANSPARENT_UNIT;var a=p.isNone(this._getPrimitive()),b=p.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(b,
{hasIntrinsicColor:a})};w.prototype._getAnchorPos=function(a,b){return"relative"===a?y.vec2f64.fromValues((b.x||0)+.5,-(b.y||0)+.5):a in R.namedAnchorToHUDMaterialAnchorPos?R.namedAnchorToHUDMaterialAnchorPos[a]:R.namedAnchorToHUDMaterialAnchorPos.center};w.prototype._createMaterialsAndAddToStage=function(a,b){this._fastUpdates=this._cimLayers?{enabled:!1}:T.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&r.mixin(a,this._fastUpdates.materialParameters);
var c=l({},a);c.verticalOffset=null;c.screenSizePerspective=null;c.occlusionTest=!1;c.slicePlaneEnabled=!1;c.shaderPolygonOffset=0;a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;if(this._cimLayers){var d=this._cimSymbolMaterials.get(a.textureId),e=this._cimSymbolDrapedMaterials.get(a.textureId);e||(e=new F(c,this._getIdHint("_iconDraped")),this._cimSymbolDrapedMaterials.set(a.textureId,e),b.add(3,e));d||(d=new F(a,this._getIdHint("_icon")),this._cimSymbolMaterials.set(a.textureId,
d),b.add(3,d));return[d,e]}this._drapedMaterial=new F(c,this._getIdHint("_iconDraped"));b.add(3,this._drapedMaterial);this._material=new F(a,this._getIdHint("_icon"));b.add(3,this._material);return[this._material,this._drapedMaterial]};w.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._forEachMaterial(0,function(b){a._context.stage.remove(3,b.id)});this._material&&(this._material=null);this._cimSymbolMaterials.clear();this._drapedMaterial&&(this._drapedMaterial=null);this._cimSymbolDrapedMaterials.clear();
this._cimSymbolTextures.forEach(function(b){a._context.stage.remove(4,b.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};w.prototype._getScaleFactor=function(a,b){if(this._drivenProperties.size&&a.size){for(var c=0;3>c;c++){var d=a.size[c];d&&"symbolValue"!==d&&"proportional"!==d&&(a.size[c]=t.pt2px(d))}if("symbolValue"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}return 1};
w.prototype.createGraphics3DGraphic=function(a){var b,c=a.renderingInfo,d=a.graphic,e,g;if(this._cimLayers){var f=this._generateTextureCIM(d);g=l({textureId:f.id},this._cimMaterialParametersInfo);b=this._createMaterialsAndAddToStage(g,this._context.stage);g=b[0];b=b[1];e=[f.params.width,f.params.height]}else e=this._size,g=this._material,b=this._drapedMaterial;if(!this._validateGeometry(d.geometry))return null;f=O.placePointOnGeometry(d.geometry);if(p.isNone(f))return this.logger.warn("unsupported geometry type for icon symbol: "+
d.geometry.type),null;var k="graphic"+d.uid,h=this._getVertexOpacityAndColor(c),m=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(m=this._getScaleFactor(c,e[0]>e[1]?e[0]:e[1]));m*=this._symbolTextureRatio;c=[e[0]*m,e[1]*m];e=this.getGraphicElevationContext(d);return"on-the-ground"===e.mode?this._createAsOverlay(d,f,b,h,c,k,a.layer.uid):this._createAs3DShape(d,f,g,h,c,e,k,d.uid)};w.prototype.layerOpacityChanged=function(){var a=this._getFillColor(),b=this._getOutlineColor();this._forEachMaterial(0,
function(c){c.setParameterValues({color:a});c.setParameterValues({outlineColor:b})});return!0};w.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=H.elevationModeChangeUpdateType(w.elevationModeChangeTypes,c,d);if(c!==H.SymbolUpdateType.UPDATE)return c;var e=H.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};w.prototype.slicePlaneEnabledChanged=function(){var a=this;this._forEachMaterial(1,
function(b){b.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};w.prototype.physicalBasedRenderingChanged=function(){return!0};w.prototype.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};w.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(T.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material&&this._material.setParameterValues(this._fastUpdates.materialParameters),
this._drapedMaterial&&this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};w.prototype._defaultElevationInfoNoZ=function(){return ba};w.prototype._createAs3DShape=function(a,b,c,d,e,g,f,k){var h=this,m=this.getFastUpdateAttrValues(a);a=m?function(a){return T.evaluateModelTransform(h._fastUpdates.materialParameters,m,a)}:null;d=W.createPointGeometry(ea,null,d,e,qa,null,m);d=[new Z(d,f)];f=O.createStageObjectForHUD(this._context,
b,d,[c],null,null,g,f,this._context.layer.uid,k,a);if(null===f)return null;var p=new P(this,f.object,d,null,null,K.perObjectElevationAligner,g);p.alignedSampledElevation=f.sampledElevation;p.needsElevationUpdates=H.needsElevationUpdates2D(g.mode)||"absolute-height"===g.mode;p.getScreenSize=this._createScreenSizeGetter(e,a);p.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(p.getScreenSize(),1,a)};O.extendPointGraphicElevationContext(p,b,this._context.elevationProvider);
return p};w.prototype._createAsOverlay=function(a,b,c,d,e,g,f){var k=this;c.renderPriority=this._renderPriority;var h=m.vec3f64.create();Y.pointToVector(b,h,this._context.overlaySR);h[2]=N.DRAPED_Z;b=this._context.clippingExtent;if(p.isSome(b)&&!A.containsPoint(b,h))return null;var n=this.getFastUpdateAttrValues(a);b=n?function(a){return T.evaluateModelTransform(k._fastUpdates.materialParameters,n,a)}:null;d=W.createPointGeometry(ea,h,d,e,null,null,n);var r=new aa(d);r.material=c;r.center=h;r.bsRadius=
0;r.transformation=U;r.name=g;r.uniqueName=g+"#"+d.id;r.data.layerUid=f;r.data.graphicUid=a.uid;r.calculateShaderTransformation=b;var w=new L(this,[r],null);w.getScreenSize=this._createScreenSizeGetter(e,b);w.calculateRelativeScreenBounds=function(a){return c.calculateRelativeScreenBounds(w.getScreenSize(),1,a)};return w};w.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===
a&&(a=y.vec2f64.create());var g=b(U);a[0]=g[0]*d+c;a[1]=g[5]*e+c;return a}}var g=a[0]/this._symbolTextureRatio+c,f=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=y.vec2f64.create());a[0]=g;a[1]=f;return a}};w.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=m.vec3f64.fromValues(a,a,a),c=t.px2pt(1),a=a*c,a=m.vec3f64.fromValues(a,a,a);return{modelSize:b,symbolSize:a,unitInMeters:c,transformation:{anchor:m.vec3f64.ZEROS,
scale:m.vec3f64.ONES,rotation:m.vec3f64.ZEROS}}};w.prototype._getGraphicHash=function(a){for(var b="",c=0,d=this._cimRequiredFields;c<d.length;c++)var e=d[c],b=b+(e+a.attributes[e]);return b};w.prototype._forEachMaterial=function(a,b){switch(a){case 0:this._forEachMaterial(1,b);this._forEachMaterial(2,b);break;case 1:this._material&&b(this._material);this._cimSymbolMaterials.forEach(b);break;case 2:this._drapedMaterial&&b(this._drapedMaterial);this._cimSymbolDrapedMaterials.forEach(b);break;default:n.neverReached(a)}};
w.PRIMITIVE_SIZE=ka;w.elevationModeChangeTypes={definedChanged:H.SymbolUpdateType.UPDATE,staysOnTheGround:H.SymbolUpdateType.NONE,onTheGroundChanged:H.SymbolUpdateType.RECREATE};return w}(S.default);b.Graphics3DIconSymbolLayer=q;var ba={mode:"relative-to-ground",offset:0},qa=w.vec4f64.fromValues(0,0,0,1);b.default=q})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/promiseUtils ../../core/screenUtils ../../geometry/support/jsonUtils ./cimAnalyzer ./Rasterizer ./TextRasterizer ./utils ../support/cimSymbolUtils ../support/Symbol3DAnchorPosition2D".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a,b,c){var d=(a?Object.keys(a):[]).map(function(b){return{name:b,alias:b,type:"string"===typeof a[b]?"esriFieldTypeString":"esriFieldTypeDouble"}});return{geometryType:b,spatialReference:c,fields:d}}return function(){function b(a,b){this._spatialReference=a;this._avoidSDF=b;this._resourceCache=new Map;this._rasterizer=new n.default;this._textRasterizer=new c.default;this._pictureMarkerCache=new Map}b.prototype.rasterizeCIMSymbolAsync=function(b,c,e,
g,h,p){return f(this,void 0,void 0,function(){var f,m,n,w,v,t,x,y,A,q;return l(this,function(l){switch(l.label){case 0:return[4,r.expandSymbol(b)];case 1:return f=l.sent(),m=[],c?(w=null!==c.centroid?"esriGeometryPolygon":d.getJsonType(c.geometry),n=u(c.attributes,w,this._spatialReference)):(f=f.clone(),f.data.primitiveOverrides=[],n=null),v=[],v.push(k.analyzeCIMSymbol(f.data,e,n,m,this._avoidSDF)),[4,a.all(v)];case 2:l.sent(),t=[],x=0,y=m,l.label=3;case 3:if(!(x<y.length))return[3,7];A=y[x];return"CIMPictureMarker"!==
A.cim.type?[3,5]:[4,this.fetchPictureMarkerResource(A)];case 4:l.sent(),l.label=5;case 5:q=this._getRasterizedResource(A,c,g,h,p),null!=q&&t.push({cimLayer:A,rasterizedResource:q}),l.label=6;case 6:return x++,[3,3];case 7:return[2,this.getSymbolImage(t,c,g,h,p)]}})})};b.prototype.analyzeCIMSymbol=function(b,c,d,e,g){return f(this,void 0,void 0,function(){var f,h,m,p,n,w;return l(this,function(l){switch(l.label){case 0:return[4,r.expandSymbol(b,g)];case 1:return f=l.sent(),h=[],c?m=u(c,e,this._spatialReference):
(f=f.clone(),f.data.primitiveOverrides=[],m=null),p=[],p.push(k.analyzeCIMSymbol(f.data,d,m,h,this._avoidSDF)),[4,a.all(p)];case 2:l.sent(),a.throwIfAborted(g),n=0,l.label=3;case 3:if(!(n<h.length))return[3,6];w=h[n];return"CIMPictureMarker"!==w.cim.type?[3,5]:[4,this.fetchPictureMarkerResource(w,g)];case 4:l.sent(),l.label=5;case 5:return n++,[3,3];case 6:return[2,h]}})})};b.prototype.fetchPictureMarkerResource=function(a,b){return f(this,void 0,void 0,function(){var c,d,e;return l(this,function(g){switch(g.label){case 0:return c=
a.materialHash,this._pictureMarkerCache.get(c)?[3,2]:[4,h(a.cim.url,{responseType:"image",signal:b.signal})];case 1:d=g.sent(),e=d.data,this._pictureMarkerCache.set(c,e),g.label=2;case 2:return[2]}})})};b.prototype.rasterizeCIMSymbol=function(a,b,c,d,e){for(var g=[],f=0;f<a.length;f++){var k=a[f];!c||"function"!==typeof c.scaleFactor||"marker"!==k.type&&"text"!==k.type||(c.scaleFactor=c.scaleFactor(b,d,e));var h=this._getRasterizedResource(k,b,c,d,e);null!=h&&g.push({cimLayer:k,rasterizedResource:h})}return this.getSymbolImage(g,
b,c,d,e)};b.prototype.getSymbolImage=function(a,b,c,d,f){for(var k=document.createElement("canvas"),h=k.getContext("2d"),m=0,n=0,r=0,w=0,l=[],v=0;v<a.length;v++){var t=a[v],x=t.rasterizedResource;if(x){var y=t.cimLayer;if("line"!==y.type&&"fill"!==y.type){var u=c.targetSize?c.targetSize/y.referenceSize:c.scaleFactor?c.scaleFactor:1,q=x.size,O=g.evaluateValueOrFunction(y.offsetX,b,d,f)*u,u=g.evaluateValueOrFunction(y.offsetY,b,d,f)*u,O=O?O:0,u=u?u:0,Q=t.rasterizedResource.anchorX,t=t.rasterizedResource.anchorY,
T=!1,Y=y.type,N=void 0;"marker"===y.type&&(N=g.evaluateValueOrFunction(y.rotation,b,d,f),T=y.rotateClockwise?y.rotateClockwise:!1);if("text"===y.type){N=g.evaluateValueOrFunction(y.angle,b,d,f);if(void 0!==y.horizontalAlignment)switch(y.horizontalAlignment){case "left":Q=-.5;break;case "right":Q=.5;break;default:Q=0}if(void 0!==y.verticalAlignment)switch(y.verticalAlignment){case "top":t=.5;break;case "bottom":t=-.5;break;case "baseline":t=-.25;break;default:t=0}}var y=e.pt2px(O)-q[0]*(.5+Q),Z=e.pt2px(u)-
q[1]*(.5+t),W=y+q[0],aa=Z+q[1];if(N){T&&(N=-N);var V=Math.sin(N*Math.PI/180),F=Math.cos(N*Math.PI/180),q=y*F-Z*V,ca=y*V+Z*F,U=y*F-aa*V,ea=y*V+aa*F,ha=W*F-aa*V,aa=W*V+aa*F,ka=W*F-Z*V,V=W*V+Z*F,y=Math.min(q,U,ha,ka),Z=Math.min(ca,ea,aa,V),W=Math.max(q,U,ha,ka),aa=Math.max(ca,ea,aa,V)}m=y<m?y:m;n=Z<n?Z:n;r=W>r?W:r;w=aa>w?aa:w;y=h.createImageData(x.size[0],x.size[1]);y.data.set(new Uint8ClampedArray(x.image.buffer));x={offsetX:O,offsetY:u,rotateClockwise:T,type:Y,angle:N,rasterizedImage:y,anchorX:Q,anchorY:t};
l.push(x)}}}k.width=r-m;k.height=w-n;a=-m;for(v=0;v<l.length;v++)x=l[v],b=this._imageDataToCanvas(x.rasterizedImage),c=a-x.rasterizedImage.width*(.5+x.anchorX),d=w-x.rasterizedImage.height*(.5-x.anchorY),x.angle?(f=(360-x.angle)*Math.PI/180,h.save(),h.translate(e.pt2px(x.offsetX),-e.pt2px(x.offsetY)),h.translate(a,w),h.rotate(f),h.translate(-a,-w),h.drawImage(b,c,d),h.restore()):h.drawImage(b,c+e.pt2px(x.offsetX),d-e.pt2px(x.offsetY));l=new p.default({x:a/k.width-.5,y:w/k.height-.5});return{imageData:h.getImageData(0,
0,k.width,k.height),anchorPosition:l}};b.prototype._imageDataToCanvas=function(a){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var b=this._imageDataCanvas,c=b.getContext("2d");b.width=a.width;b.height=a.height;c.putImageData(a,0,0);return b};b.prototype._imageTo32Array=function(a,b,c){this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas"));var d=this._imageDataCanvas,e=d.getContext("2d");d.width=b;d.height=c;e.drawImage(a,0,0,b,c);return new Uint32Array(e.getImageData(0,
0,b,c).data.buffer)};b.prototype._getRasterizedResource=function(a,b,c,d,f){var h;if("text"===a.type)h=a.cim,a=this._rasterizeTextResource(a,b,c,d,f);else{var m=this._resourceCache,p=void 0;"function"===typeof a.materialHash?(p=a.materialHash,p=p(b,d,f),h=k.analyzeCIMResource(a.cim,a.materialOverrides)):(p=a.materialHash,c&&(p+=JSON.stringify(c)),h=a.cim);if(m.has(p))return m.get(p);c=c.targetSize?c.targetSize/a.referenceSize:c.scaleFactor?c.scaleFactor:1;h.size*=c;if("CIMPictureMarker"===a.cim.type){f=
g.evaluateValueOrFunction(a.cim.size,b,d,f)*c;b=this._pictureMarkerCache.get(a.materialHash);if(!b)return null;c=b.height/b.width;d=1<c?e.pt2px(f):e.pt2px(f)/c;f=1<c?e.pt2px(f)*c:e.pt2px(f);a={image:this._imageTo32Array(b,d,f),size:[d,f],sdf:!1,simplePattern:!1,anchorX:a.anchorPoint?a.anchorPoint.x:0,anchorY:a.anchorPoint?a.anchorPoint.y:0}}else a=this._rasterizer.rasterizeJSONResource(h,this._avoidSDF);m.set(p,a)}return a};b.prototype._rasterizeTextResource=function(a,b,c,d,e){var f=c.targetSize?
c.targetSize/a.referenceSize:c.scaleFactor?c.scaleFactor:1;c=g.evaluateValueOrFunction(a.text,b,d,e);if(!c||0===c.length)return null;var k=g.evaluateValueOrFunction(a.fontName,b,d,e),h=g.evaluateValueOrFunction(a.style,b,d,e),m=g.evaluateValueOrFunction(a.weight,b,d,e),p=g.evaluateValueOrFunction(a.decoration,b,d,e),f=g.evaluateValueOrFunction(a.size,b,d,e)*f,n=g.evaluateValueOrFunction(a.horizontalAlignment,b,d,e),r=g.evaluateValueOrFunction(a.verticalAlignment,b,d,e),w=g.colorToArray(g.evaluateValueOrFunction(a.color,
b,d,e)),l=g.colorToArray(g.evaluateValueOrFunction(a.outlineColor,b,d,e));a=g.evaluateValueOrFunction(a.outlineSize,b,d,e);return this._textRasterizer.rasterizeText(c,{color:w,size:f,horizontalAlignment:n,verticalAlignment:r,font:{family:k,style:h,weight:m,decoration:p},halo:{size:a||0,color:l,style:h},pixelRatio:1,premultiplyColors:!this._avoidSDF})};return b}()})},"esri/symbols/cim/cimAnalyzer":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../Color ../../core/Logger ../../core/promiseUtils ../../core/string ../../support/arcadeOnDemand ./CIMSymbolHelper ./enums ./SDFHelper ../../views/2d/arcade/utils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/255}:{r:0,g:0,b:0,a:0}}function t(a){switch(a){case "Butt":return g.CapType.BUTT;case "Square":return g.CapType.SQUARE;default:return g.CapType.ROUND}}function x(a){switch(a){case "Bevel":return g.JoinType.BEVEL;case "Miter":return g.JoinType.MITER;default:return g.JoinType.ROUND}}function v(a){switch(a){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"justify"}}
function y(a){switch(a){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";case "Bottom":return"bottom"}}function m(a){var b="normal",c="normal";a&&(a=a.toLowerCase(),-1!==a.indexOf("italic")?b="italic":-1!==a.indexOf("oblique")&&(b="oblique"),-1!==a.indexOf("bold")?c="bold":-1!==a.indexOf("light")&&(c="lighter"));return{style:b,weight:c}}function w(a,b,d,e,k,h){return f(this,void 0,void 0,function(){var f,m,p,n,r,w,v;return l(this,function(l){switch(l.label){case 0:if(!a)return[2];
f=a.symbolLayers;if(!f)return[2];p=c.CIMSymbolHelper.getSize(a);"CIMPointSymbol"===a.type&&"Map"===a.angleAlignment&&(m=g.Alignment.MAP);n=f.length;l.label=1;case 1:if(!n--)return[3,23];r=f[n];if(!r||!1===r.enable)return[3,1];w=[];c.OverrideHelper.findApplicableOverrides(r,b,w);v=r.type;switch(v){case "CIMSolidFill":return[3,2];case "CIMPictureFill":return[3,4];case "CIMHatchFill":return[3,6];case "CIMGradientFill":return[3,8];case "CIMSolidStroke":return[3,10];case "CIMPictureStroke":return[3,12];
case "CIMGradientStroke":return[3,14];case "CIMCharacterMarker":return[3,16];case "CIMPictureMarker":return[3,17];case "CIMVectorMarker":return[3,19]}return[3,21];case 2:return[4,A(r,w,e,k)];case 3:return l.sent(),[3,22];case 4:return[4,B(r,w,e,k)];case 5:return l.sent(),[3,22];case 6:return[4,C(r,w,e,k)];case 7:return l.sent(),[3,22];case 8:return[4,E(r,w,e,k)];case 9:return l.sent(),[3,22];case 10:return[4,G(r,w,e,k,"CIMPolygonSymbol"===a.type,p)];case 11:return l.sent(),[3,22];case 12:return[4,
J(r,w,e,k,"CIMPolygonSymbol"===a.type,p)];case 13:return l.sent(),[3,22];case 14:return[4,I(r,w,e,k,"CIMPolygonSymbol"===a.type,p)];case 15:return l.sent(),[3,22];case 16:return[3,22];case 17:return[4,K(r,w,e,k,m,p)];case 18:return l.sent(),[3,22];case 19:return[4,H(r,w,d,e,k,m,p,h)];case 20:return l.sent(),[3,22];case 21:Z.error("Cannot analyze CIM layer",r.type),l.label=22;case 22:return[3,1];case 23:return[2]}})})}function A(a,b,c,d){return f(this,void 0,void 0,function(){var e,g,f,h,m,p;return l(this,
function(n){switch(n.label){case 0:return e=a.primitiveName,g=u(a.color),f=k.numericHash(JSON.stringify(a)).toString(),m=(h=d).push,p={type:"fill",templateHash:f,materialHash:0===b.length?f:function(){return f},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,Q(e,"Color",b,c,g,O)];case 1:return m.apply(h,[(p.color=n.sent(),p.height=0,p.angle=0,p.offsetX=0,p.offsetY=0,p.scaleX=1,p)]),[2]}})})}function B(a,b,c,d){return f(this,void 0,void 0,function(){var e,g,f,h,m,p,n;return l(this,function(r){switch(r.label){case 0:return e=
a.primitiveName,g=u(a.tintColor),f=k.numericHash(JSON.stringify(a)).toString(),h=k.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),p=(m=d).push,n={type:"fill",templateHash:f,materialHash:0===b.length?h:function(){return h},cim:a,materialOverrides:null,colorLocked:a.colorLocked},[4,Q(e,"TintColor",b,c,g,O)];case 1:return n.color=r.sent(),[4,Q(e,"Height",b,c,a.height)];case 2:return n.height=r.sent(),[4,Q(e,"ScaleX",b,c,a.scaleX)];case 3:return n.scaleX=r.sent(),[4,Q(e,"Rotation",
b,c,a.rotation)];case 4:return n.angle=r.sent(),[4,Q(e,"OffsetX",b,c,a.offsetX)];case 5:return n.offsetX=r.sent(),[4,Q(e,"OffsetY",b,c,a.offsetY)];case 6:return p.apply(m,[(n.offsetY=r.sent(),n)]),[2]}})})}function C(a,b,c,d){return f(this,void 0,void 0,function(){var e,g,f,h,m,p,n,r;return l(this,function(w){switch(w.label){case 0:e=["Rotation","OffsetX","OffsetY"];g=b.filter(function(b){return b.primitiveName!==a.primitiveName&&-1===e.indexOf(b.propertyName)});f=a.primitiveName;h=k.numericHash(JSON.stringify(a)).toString();
p=(m=d).push;n={type:"fill",templateHash:h};if(0!==b.length)return[3,1];r=h;return[3,3];case 1:return[4,N(h,g,c)];case 2:r=w.sent(),w.label=3;case 3:return n.materialHash=r,n.cim=a,n.materialOverrides=g,n.colorLocked=a.colorLocked,n.color={r:128,g:128,b:128,a:1},n.height=0,n.scaleX=1,[4,Q(f,"Rotation",b,c,a.rotation)];case 4:return n.angle=w.sent(),[4,Q(f,"OffsetX",b,c,a.offsetX)];case 5:return n.offsetX=w.sent(),[4,Q(f,"OffsetY",b,c,a.offsetY)];case 6:return p.apply(m,[(n.offsetY=w.sent(),n)]),[2]}})})}
function E(a,b,c,d){return f(this,void 0,void 0,function(){var e,g,f,h,m;return l(this,function(p){switch(p.label){case 0:e=k.numericHash(JSON.stringify(a)).toString();f=(g=d).push;h={type:"fill",templateHash:e};if(0!==b.length)return[3,1];m=e;return[3,3];case 1:return[4,N(e,b,c)];case 2:m=p.sent(),p.label=3;case 3:return f.apply(g,[(h.materialHash=m,h.cim=a,h.materialOverrides=null,h.colorLocked=a.colorLocked,h.color={r:128,g:128,b:128,a:1},h.height=0,h.angle=0,h.offsetX=0,h.offsetY=0,h.scaleX=1,
h)]),[2]}})})}function G(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,h,m,p,n,r,w,v,y,A;return l(this,function(l){switch(l.label){case 0:return f=k.numericHash(JSON.stringify(a)).toString(),h=a.primitiveName,m=u(a.color),p=void 0!==a.width?a.width:4,n=t(a.capStyle),r=x(a.joinStyle),w=a.miterLimit,y=(v=d).push,A={type:"line",templateHash:f,materialHash:0===b.length?f:function(){return f},cim:a,materialOverrides:null,isOutline:e,colorLocked:a.colorLocked},[4,Q(h,"Color",b,c,m,O)];case 1:return A.color=
l.sent(),[4,Q(h,"Width",b,c,p)];case 2:return A.width=l.sent(),[4,Q(h,"CapStyle",b,c,n)];case 3:return A.cap=l.sent(),[4,Q(h,"JoinStyle",b,c,r)];case 4:return A.join=l.sent(),[4,Q(h,"MiterLimit",b,c,w)];case 5:return y.apply(v,[(A.miterLimit=l.sent(),A.referenceWidth=g,A.zOrder=R(a.name),A.isDashed=!1,A)]),[2]}})})}function J(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,h,m,p,n,r,w,v,y,A,B;return l(this,function(l){switch(l.label){case 0:return f=k.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString(),
h=a.primitiveName,m=u(a.tintColor),p=void 0!==a.width?a.width:4,n=t(a.capStyle),r=x(a.joinStyle),w=a.miterLimit,v=k.numericHash(JSON.stringify(a)).toString(),A=(y=d).push,B={type:"line",templateHash:v,materialHash:0===b.length?f:function(){return f},cim:a,materialOverrides:null,isOutline:e,colorLocked:a.colorLocked},[4,Q(h,"TintColor",b,c,m,O)];case 1:return B.color=l.sent(),[4,Q(h,"Width",b,c,p)];case 2:return B.width=l.sent(),[4,Q(h,"CapStyle",b,c,n)];case 3:return B.cap=l.sent(),[4,Q(h,"JoinStyle",
b,c,r)];case 4:return B.join=l.sent(),[4,Q(h,"MiterLimit",b,c,w)];case 5:return A.apply(y,[(B.miterLimit=l.sent(),B.referenceWidth=g,B.zOrder=R(a.name),B.isDashed=!1,B)]),[2]}})})}function I(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,h,m,p,n,r,w,v,y,u;return l(this,function(l){switch(l.label){case 0:f=a.primitiveName;h=void 0!==a.width?a.width:4;m=t(a.capStyle);p=x(a.joinStyle);n=a.miterLimit;r=k.numericHash(JSON.stringify(a)).toString();v=(w=d).push;y={type:"line",templateHash:r};
if(0!==b.length)return[3,1];u=r;return[3,3];case 1:return[4,N(r,b,c)];case 2:u=l.sent(),l.label=3;case 3:return y.materialHash=u,y.cim=a,y.materialOverrides=null,y.isOutline=e,y.colorLocked=a.colorLocked,y.color={r:128,g:128,b:128,a:1},[4,Q(f,"Width",b,c,h)];case 4:return y.width=l.sent(),[4,Q(f,"CapStyle",b,c,m)];case 5:return y.cap=l.sent(),[4,Q(f,"JoinStyle",b,c,p)];case 6:return y.join=l.sent(),[4,Q(f,"MiterLimit",b,c,n)];case 7:return v.apply(w,[(y.miterLimit=l.sent(),y.referenceWidth=g,y.zOrder=
R(a.name),y.isDashed=!1,y)]),[2]}})})}function K(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,h,m,p,n,r,w,v,t,x,y,A,B,C,q,E;return l(this,function(l){switch(l.label){case 0:f=a.primitiveName;h=a.size;m=a.scaleX;p=a.rotation;n=a.offsetX;r=a.offsetY;w=u(a.tintColor);v=k.numericHash(""+a.url+JSON.stringify(a.colorSubstitutions)).toString();t=!1;x="";y=0;for(A=b;y<A.length;y++)B=A[y],B.primitiveName===f&&(void 0!==B.value?x+="|"+B.primitiveName+"|"+B.propertyName+"|"+JSON.stringify(B.value):
B.valueExpressionInfo&&(t=!0));q=(C=d).push;E={type:"marker",templateHash:k.numericHash(JSON.stringify(a)+x).toString(),materialHash:t?function(){return v}:v,cim:a,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:!1,alignment:e,anchorPoint:a.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits};return[4,Q(f,"Size",b,c,h)];case 1:return E.size=l.sent(),[4,Q(f,"ScaleX",b,c,m)];case 2:return E.scaleX=l.sent(),[4,Q(f,"Rotation",b,c,p)];case 3:return E.rotation=
l.sent(),[4,Q(f,"OffsetX",b,c,n)];case 4:return E.offsetX=l.sent(),[4,Q(f,"OffsetY",b,c,r)];case 5:return E.offsetY=l.sent(),[4,Q(f,"TintColor",b,c,w,O)];case 6:return q.apply(C,[(E.color=l.sent(),E.outlineColor={r:0,g:0,b:0,a:0},E.outlineWidth=0,E.frameHeight=0,E.rotateClockwise=a.rotateClockwise,E.referenceSize=g,E.sizeRatio=1,E)]),[2]}})})}function H(a,b,c,e,g,k,h,m){return f(this,void 0,void 0,function(){var f,p,n,r,w,v,t,x;return l(this,function(l){switch(l.label){case 0:f=a.markerGraphics;if(!f)return[2];
p=0;a.scaleSymbolsProportionally&&(n=a.frame)&&(p=n.ymax-n.ymin);r=[];w=0;for(v=f;w<v.length;w++)if(t=v[w])if(x=t.symbol)switch(x.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":r.push(P(a,t,b,e,g,k,h,p,m));break;case "CIMTextSymbol":r.push(L(a,t,b,c,e,g,k,h,p))}return[4,d.all(r)];case 1:return l.sent(),[2]}})})}function L(a,b,d,e,g,p,n,r,w){return f(this,void 0,void 0,function(){var f,t,x,A,B,C,q,E,H,G,O,R,L,N,U,P,S,K,T,I,F,J,Z,W;return l(this,function(l){switch(l.label){case 0:f=
[];c.OverrideHelper.findApplicableOverrides(b,d,f);t=b.geometry;if(!("x"in t&&"y"in t))return[2];x=b.symbol;A=x.underline?"underline":x.strikethrough?"line-through":"none";B=m(x.fontStyleName);x.font=h({family:x.fontFamilyName,decoration:A},B);C=a.frame;q=t.x-.5*(C.xmin+C.xmax);E=t.y-.5*(C.ymin+C.ymax);H=a.size/w;G=a.primitiveName;O=(x.height||0)*H;R=x.angle||0;L=((x.offsetX||0)+q)*H;N=((x.offsetY||0)+E)*H;U=u(c.CIMSymbolHelper.getFillColor(x));P=u(c.CIMSymbolHelper.getStrokeColor(x));S=c.CIMSymbolHelper.getStrokeWidth(x);
S||(P=u(c.CIMSymbolHelper.getFillColor(x.haloSymbol)),S=x.haloSize*H);K="";T=0;for(I=d;T<I.length;T++)F=I[T],F.primitiveName===G&&void 0!==F.value&&(K+="|"+F.primitiveName+"|"+F.propertyName+"|"+JSON.stringify(F.value));Z=(J=p).push;W={type:"text",templateHash:k.numericHash(JSON.stringify(b)+K).toString(),materialHash:function(){return k.numericHash(JSON.stringify(x.font)).toString()},cim:x,materialOverrides:null,colorLocked:a.colorLocked,alignment:n,anchorPoint:{x:a.anchorPoint?a.anchorPoint.x:0,
y:a.anchorPoint?a.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==a.anchorPointUnits,fontName:x.fontFamilyName,decoration:"none",weight:"normal",style:"normal"};return[4,Q(G,"Height",d,g,O)];case 1:return W.size=l.sent(),[4,Q(G,"Rotation",d,g,R)];case 2:return W.angle=l.sent(),[4,Q(G,"OffsetX",d,g,L)];case 3:return W.offsetX=l.sent(),[4,Q(G,"OffsetY",d,g,N)];case 4:return Z.apply(J,[(W.offsetY=l.sent(),W.horizontalAlignment=v(x.horizontalAlignment),W.verticalAlignment=y(x.verticalAlignment),W.text=
Y(e,b.textString,x.textCase),W.color=U,W.outlineColor=P,W.outlineSize=S,W.referenceSize=r,W.sizeRatio=1,W)]),[2]}})})}function P(a,b,d,e,g,h,m,p,n){return f(this,void 0,void 0,function(){var f,w,v,t,x,y;return l(this,function(A){switch(A.label){case 0:f=b.symbol;w=b.geometry;if(!w)return[2];v=r.getExtent(w);if("CIMTextSymbol"===f.type)return[2];t=f.symbolLayers;if(!t)return[2];x=t.length;y=function(){var f,y,A,B,C,q,E,H,G,R,L,N,P,U,K,T,I,qa,F,J,Z,Y,W,V,ja,aa,ba,ca,ka;return l(this,function(l){switch(l.label){case 0:return(f=
t[x])&&!1!==f.enable?n?[4,S(a,b,d,e,g,h,m,p)]:[3,2]:[2,"continue"];case 1:return l.sent(),[2,"continue"];case 2:y=f.type;switch(y){case "CIMSolidFill":return[3,3];case "CIMSolidStroke":return[3,3]}return[3,15];case 3:A=r.getSDFMetrics(v,a.frame,a.size,a.anchorPoint,"Relative"!==a.anchorPointUnits);B=A[0];C=A[1];q=A[2];E="CIMSolidFill"===f.type;H={type:"sdf",geom:w,asFill:E};G=a.primitiveName;R=a.size;L=a.rotation;N=a.offsetX;P=a.offsetY;U=f.primitiveName;K=E?u(c.CIMSymbolHelper.getFillColor(f)):u(c.CIMSymbolHelper.getStrokeColor(f));
T=E?{r:0,g:0,b:0,a:0}:u(c.CIMSymbolHelper.getStrokeColor(f));I=c.CIMSymbolHelper.getStrokeWidth(f);if(!E&&!I)return[3,16];qa=!1;F="";J=0;for(Z=d;J<Z.length;J++)if(Y=Z[J],Y.primitiveName===U||Y.primitiveName===G)void 0!==Y.value?F+="|"+Y.primitiveName+"|"+Y.propertyName+"|"+JSON.stringify(Y.value):Y.valueExpressionInfo&&(qa=!0);W=k.numericHash(JSON.stringify(H)).toString();V=k.numericHash(JSON.stringify(f)+JSON.stringify(b)+F).toString();aa=(ja=g).push;ba={type:"marker",templateHash:V,materialHash:qa?
function(){return W}:W,cim:H,materialOverrides:null,colorLocked:a.colorLocked,scaleSymbolsProportionally:a.scaleSymbolsProportionally,alignment:h,anchorPoint:{x:C,y:q},isAbsoluteAnchorPoint:!1};return[4,Q(G,"Size",d,e,R)];case 4:return ba.size=l.sent(),ba.scaleX=1,[4,Q(G,"Rotation",d,e,L)];case 5:return ba.rotation=l.sent(),[4,Q(G,"OffsetX",d,e,N)];case 6:return ba.offsetX=l.sent(),[4,Q(G,"OffsetY",d,e,P)];case 7:return ba.offsetY=l.sent(),[4,Q(U,"Color",d,e,K,O)];case 8:ba.color=l.sent();if(!E)return[3,
9];ca={r:0,g:0,b:0,a:0};return[3,11];case 9:return[4,Q(U,"Color",d,e,T,O)];case 10:ca=l.sent(),l.label=11;case 11:ba.outlineColor=ca;if(!E)return[3,12];ka=0;return[3,14];case 12:return[4,Q(U,"Width",d,e,I)];case 13:ka=l.sent(),l.label=14;case 14:return aa.apply(ja,[(ba.outlineWidth=ka,ba.frameHeight=p,ba.rotateClockwise=a.rotateClockwise,ba.referenceSize=m,ba.sizeRatio=B,ba)]),[3,16];case 15:return S(a,b,d,e,g,h,m,p),[3,16];case 16:return[2]}})};A.label=1;case 1:return x--?[5,y()]:[3,3];case 2:return A.sent(),
[3,1];case 3:return[2]}})})}function S(a,b,d,e,g,h,m,p){return f(this,void 0,void 0,function(){var f,n,r,w,v,t,x,y,u,A,B,C,q,E,H,G;return l(this,function(l){switch(l.label){case 0:f={type:a.type,enable:!0,name:a.name,colorLocked:a.colorLocked,primitiveName:a.primitiveName,anchorPoint:a.anchorPoint,anchorPointUnits:a.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:a.rotateClockwise,rotation:0,size:a.size,billboardMode3D:a.billboardMode3D,depth3D:a.depth3D,frame:a.frame,markerGraphics:[b],scaleSymbolsProportionally:a.scaleSymbolsProportionally,
respectFrame:a.respectFrame,clippingPath:a.clippingPath};n=[];r=["Rotation","OffsetX","OffsetY"];n=d.filter(function(b){return b.primitiveName!==a.primitiveName||-1===r.indexOf(b.propertyName)});w=c.CIMSymbolHelper.getTextureAnchor(f);v=w[0];t=w[1];x=JSON.stringify(f);y=a.primitiveName;u=a.rotation;A=a.offsetX;B=a.offsetY;C=k.numericHash(JSON.stringify(f)).toString();E=(q=g).push;H={type:"marker",templateHash:C};if(0!==n.length)return[3,1];G=C;return[3,3];case 1:return[4,N(x,n,e)];case 2:G=l.sent(),
l.label=3;case 3:return H.materialHash=G,H.cim=f,H.materialOverrides=n,H.colorLocked=a.colorLocked,H.scaleSymbolsProportionally=a.scaleSymbolsProportionally,H.alignment=h,H.anchorPoint={x:v,y:t},H.isAbsoluteAnchorPoint=!1,H.size=a.size,H.scaleX=1,[4,Q(y,"Rotation",d,e,u)];case 4:return H.rotation=l.sent(),[4,Q(y,"OffsetX",d,e,A)];case 5:return H.offsetX=l.sent(),[4,Q(y,"OffsetY",d,e,B)];case 6:return E.apply(q,[(H.offsetY=l.sent(),H.color={r:0,g:0,b:0,a:0},H.outlineColor={r:0,g:0,b:0,a:0},H.outlineWidth=
0,H.frameHeight=p,H.rotateClockwise=a.rotateClockwise,H.referenceSize=m,H.sizeRatio=1,H)]),[2]}})})}function R(a){return a&&0===a.indexOf("Level_")?parseInt(a.substr(6),10):0}function O(b){if(!b||0===b.length)return null;b=(new a(b)).toRgba();return{r:b[0],g:b[1],b:b[2],a:b[3]}}function Q(a,b,c,d,e,g){return f(this,void 0,void 0,function(){var f,k,h,m,r;return l(this,function(w){switch(w.label){case 0:if(!a)return[3,4];f=function(c){var f,k,h;return l(this,function(m){switch(m.label){case 0:if(c.primitiveName!==
a||c.propertyName!==b)return[3,2];if(void 0!==c.value)return[2,{value:g?g(c.value):c.value}];f=c.valueExpressionInfo;if(!f)return[3,2];k=f.expression;return[4,n.createRendererExpression(k,d.spatialReference,d.fields)];case 1:return h=m.sent(),[2,{value:function(a,b,c){a=p.callWithFeature(h,a,{$view:c},d.geometryType,b);null!==a&&g&&(a=g(a));return null!==a?a:e}}];case 2:return[2]}})};k=0;h=c;w.label=1;case 1:if(!(k<h.length))return[3,4];m=h[k];return[5,f(m)];case 2:r=w.sent();if("object"===typeof r)return[2,
r.value];w.label=3;case 3:return k++,[3,1];case 4:return[2,e]}})})}function T(a,b){switch(b){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}function Y(a,b,c){if(!a||-1===b.indexOf("["))return T(b,c);var d=function(a){for(var b=a.length;b--;)if(-1===" /-,\n".indexOf(a.charAt(b)))return!1;return!0},e=[],g=0,f=-1;do f=b.indexOf("[",g),f>=g&&(f>g&&(g=b.substr(g,f-g),e.push([g,null,d(g)])),g=f+1,f=b.indexOf("]",g),f>=g&&(f>g&&(g=b.substr(g,f-g),(g=a[g])&&
e.push([null,g,!1])),g=f+1));while(-1!==f);g<b.length-1&&(g=b.substr(g),e.push([g,null,d(g)]));return function(a){for(var b="",d=null,g=0;g<e.length;g++){var f=e[g],k=f[0],h=f[1],f=f[2];if(k)f?d=k:(d&&(b+=d,d=null),b+=k);else if(k=a.attributes[h])d&&(b+=d,d=null),b+=k}return T(b,c)}}function N(a,b,d){return f(this,void 0,void 0,function(){var e,g,f,h;return l(this,function(m){switch(m.label){case 0:e=function(a){var b,c,e;return l(this,function(g){switch(g.label){case 0:b=a.valueExpressionInfo;if(!b)return[3,
2];c=b.expression;return[4,n.createRendererExpression(c,d.spatialReference,d.fields)];case 1:e=g.sent(),a.fn=function(a,b,c){return p.callWithFeature(e,a,{$view:c},d.geometryType,b)},g.label=2;case 2:return[2]}})},g=0,f=b,m.label=1;case 1:if(!(g<f.length))return[3,4];h=f[g];return[5,e(h)];case 2:m.sent(),m.label=3;case 3:return g++,[3,1];case 4:return[2,function(d,e,g){for(var f=0;f<b.length;f++){var h=b[f];h.fn&&(h.value=h.fn(d,e,g))}return k.numericHash(a+c.OverrideHelper.buildOverrideKey(b)).toString()}]}})})}
Object.defineProperty(b,"__esModule",{value:!0});var Z=e.getLogger("esri.symbols.cim.cimAnalyzer");b.analyzeCIMSymbol=function(a,b,c,d,e){return f(this,void 0,void 0,function(){var g,f,k,h;return l(this,function(m){switch(m.label){case 0:g=d?d:[];if(!a)return[2,g];"CIMSymbolReference"===a.type?(f=a.symbol,k=a.primitiveOverrides):(f=a,k=null);h=f.type;switch(h){case "CIMPointSymbol":return[3,1];case "CIMLineSymbol":return[3,1];case "CIMPolygonSymbol":return[3,1];case "CIMTextSymbol":return[3,3]}return[3,
4];case 1:return[4,w(f,k,b,c,g,e)];case 2:return m.sent(),[3,4];case 3:return[3,4];case 4:return[2,g]}})})};b.analyzeCIMResource=function(a,b){if(!b||0===b.length)return a;a=JSON.parse(JSON.stringify(a));c.OverrideHelper.applyOverrides(a,b);return a}})},"esri/symbols/cim/CIMSymbolHelper":function(){define("require exports ../../Color ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMCursor ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./CIMSymbolDrawHelper ./packingUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){function g(a,b){switch(b.type){case "CIMSymbolReference":var c={type:"point",x:0,y:0};a.drawSymbol(b.symbol,c);break;case "CIMPointSymbol":c={type:"point",x:0,y:0};a.drawSymbol(b,c);break;case "CIMVectorMarker":c=new k.Placement,a.drawMarker(b,c)}return a.envelope()}Object.defineProperty(b,"__esModule",{value:!0});var r=Math.PI,p=r/2,u=f.getLogger("esri.symbols.cim.CIMSymbolHelper");q=function(){function b(){}b.getEnvelope=function(a){var b=new n.EnvDrawHelper;if(Array.isArray(a)){for(var c=
void 0,d=0;d<a.length;d++){var e=a[d];c?c.union(g(b,e)):c=g(b,e)}return c}return g(b,a)};b.getTextureAnchor=function(a){a=this.getEnvelope(a);if(!a||0>=a.width||0>=a.height)return[0,0];var b=96/72;return[(a.x+.5*a.width)*b/(a.width*b+2),-(a.y+.5*a.height)*b/(a.height*b+2)]};b.rasterize=function(a,b,c){void 0===c&&(c=!0);var d=this.getEnvelope(b);if(!d||0>=d.width||0>=d.height)return[null,0,0,0,0];var e=96/72,g=(d.x+.5*d.width)*e,f=(d.y+.5*d.height)*e;a.width=d.width*e+2;a.height=d.height*e+2;d=a.getContext("2d");
e=n.Transformation.createScale(e,-e);e.translate(.5*a.width-g,.5*a.height+f);e=new n.CanvasDrawHelper(d,e);switch(b.type){case "CIMPointSymbol":e.drawSymbol(b,{type:"point",x:0,y:0});break;case "CIMVectorMarker":var h=new k.Placement;e.drawMarker(b,h)}b=d.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);if(c)for(c=void 0,d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;return[b,a.width,a.height,-g/a.width,-f/a.height]};b.fromSimpleMarker=function(a){var b,c,d=a.style;if("circle"===
d||"esriSMSCircle"===d){b=Math.acos(.995);c=Math.ceil(r/b/4);0===c&&(c=1);b=p/c;c*=4;d=[];d.push([50,0]);for(var e=1;e<c;e++)d.push([50*Math.cos(e*b),-50*Math.sin(e*b)]);d.push([50,0]);b={rings:[d]};c={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===d||"esriSMSCross"===d)b=0,b={rings:[[[b,50],[b,b],[50,b],[50,-b],[b,-b],[b,-50],[-b,-50],[-b,-b],[-50,-b],[-50,b],[-b,b],[-b,50],[b,50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===d||"esriSMSDiamond"===d)b={rings:[[[-50,0],[0,50],
[50,0],[0,-50],[-50,0]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===d||"esriSMSSquare"===d)b={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===d||"esriSMSX"===d)b=0,b={rings:[[[0,b],[50-b,50],[50,50-b],[b,0],[50,b-50],[50-b,-50],[0,-b],[b-50,-50],[-50,b-50],[-b,0],[-50,50-b],[b-50,50],[0,b]]]},c={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===d||"esriSMSTriangle"===d)c=2/3*100,d=c-100,b={rings:[[[-57.735026918962575,
d],[0,c],[57.735026918962575,d],[-57.735026918962575,d]]]},c={xmin:-57.735026918962575,ymin:d,xmax:57.735026918962575,ymax:c};var g;b&&c&&(g=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&g.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),g={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:c,markerGraphics:[{type:"CIMMarkerGraphic",geometry:b,symbol:{type:"CIMPolygonSymbol",
symbolLayers:g}}]}]});return g};b.getFillColor=function(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getFillColor(a[c]);if(null!=d)return d}}break;case "CIMTextSymbol":return b.getFillColor(a.symbol);case "CIMSolidFill":return a.color}};b.getStrokeColor=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeColor(a[c]);
if(void 0!==d)return d}}break;case "CIMTextSymbol":return b.getStrokeColor(a.symbol);case "CIMSolidStroke":return a.color}};b.getStrokeWidth=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers){var c=0;for(a=a.symbolLayers;c<a.length;c++){var d=b.getStrokeWidth(a[c]);if(void 0!==d)return d}}break;case "CIMTextSymbol":return b.getStrokeWidth(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}};b.getSize=function(a){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":var c=
0;if(a.symbolLayers){var d=0;for(a=a.symbolLayers;d<a.length;d++){var e=b.getSize(a[d]);e>c&&(c=e)}}return c;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":return a.width;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":return a.size}};b.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-a.frame.ymin)}return 1};b.executeEffects=function(a,b,c){void 0===
c&&(c=!1);var e=96/72,g=a?a.length:0;g&&c&&--g;for(c=0;c<g;++c){var f=a[c];if(f){var k=d.getEffectOperator(f);k&&(b=k.execute(b,f,e))}}return b};b.processEffects=function(c,d,g){var f;c.effects&&0<c.effects.length&&(f=a.deltaEncodeGeometry(g),f=new e.SimpleGeometryCursor(f),f=b.executeEffects(c.effects,f));c=c.symbolLayers[d];c.effects&&0<c.effects.length&&(d=!1,"CIMGeometricEffectDashes"===c.effects[c.effects.length-1].type&&(d=!0),f||(f=a.deltaEncodeGeometry(g),f=new e.SimpleGeometryCursor(f)),
f=b.executeEffects(c.effects,f,d));if(!f)return g;g=[];for(c=f.next();c;)g.push(c),c=f.next();f=g.length;switch(f){case 0:return null;case 1:return a.deltaEncodeGeometry(g[0]);default:c=g[0];for(d=1;d<f;++d){var k=g[d];h.isPolygon(c)&&h.isPolygon(k)&&Array.prototype.push.apply(c.rings,k.rings);h.isPolyline(c)&&h.isPolyline(k)&&Array.prototype.push.apply(c.paths,k.paths)}return a.deltaEncodeGeometry(c)}};return b}();b.CIMSymbolHelper=q;q=function(){function a(){}a.rasterizeSimpleFill=function(a,b){"solid"!==
b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.lineWidth=1;c.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===b||"esriSFSVertical"===b)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||
"esriSFSForwardDiagonal"===b)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)c.moveTo(8,0),c.lineTo(0,8);c.stroke();b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(var d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;return[b,a.width,a.height]};a.rasterizeSimpleLine=function(a,b){switch(b){case "butt":b="Butt";break;case "square":b="Square";break;default:b="Round"}var c="Butt"===
b;switch(a){case "dash":case "esriSLSDash":a=c?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":a=c?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":a=c?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":a=c?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":a=c?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":a=c?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":a=c?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":a=
c?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":a=c?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":a=c?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":u.error("Unexpected: style does not require rasterization");a=[0,0];break;default:u.error("Tried to rasterize SLS, but found an unexpected style: "+a+"!"),a=[0,0]}return this.rasterizeDash(a,b)};a.rasterizeDash=function(a,b){var d="Butt"===b,e="Square"===b;b=!d&&!e;for(var g=
0,f=0;f<a.length;f++)var k=a[f],g=g+k;for(var g=15*g,h=31*g,f=new Float32Array(h),p=b?225:15,k=0;k<h;++k)f[k]=p;for(var p=h=0,n=!0,r=0;r<a.length;r++){for(var k=a[r],h=p,p=p+15*k,l=h;l<p;){for(var t=0;31>t;){var k=t*g+l,v=b?(t-15)*(t-15):Math.abs(t-15);f[k]=n?d?Math.max(Math.max(h+7.5-l,v),Math.max(l-p+7.5,v)):v:b?Math.min((l-h)*(l-h)+v,(l-p)*(l-p)+v):e?Math.min(Math.max(l-h,v),Math.max(p-l,v)):Math.min(Math.max(l-h+7.5,v),Math.max(p+7.5-l,v));t++}l++}n=!n}a=f.length;d=new Uint8Array(4*a);for(k=0;k<
a;++k)c.packFloatRGBA((b?Math.sqrt(f[k]):f[k])/15,d,4*k);return[d,g,31]};return a}();b.SymbolHelper=q;q=function(){function a(){}a.findApplicableOverrides=function(b,c,d){if(c){if(b.primitiveName){for(var e=!1,g=0;g<d.length;g++){var f=d[g];if(f.primitiveName===b.primitiveName){e=!0;break}}if(!e)for(e=0;e<c.length;e++)f=c[e],f.primitiveName===b.primitiveName&&d.push(f)}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(e=0,g=b.effects;e<g.length;e++)f=
g[e],a.findApplicableOverrides(f,c,d);if(b.symbolLayers)for(f=0,b=b.symbolLayers;f<b.length;f++)a.findApplicableOverrides(b[f],c,d);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(b.effects)for(e=0,g=b.effects;e<g.length;e++)f=g[e],a.findApplicableOverrides(f,c,d);b.markerPlacement&&a.findApplicableOverrides(b.markerPlacement,
c,d);if("CIMVectorMarker"===b.type){if(b.markerGraphics)for(f=0,b=b.markerGraphics;f<b.length;f++)e=b[f],a.findApplicableOverrides(e,c,d),a.findApplicableOverrides(e.symbol,c,d)}else"CIMCharacterMarker"===b.type?a.findApplicableOverrides(b.symbol,c,d):"CIMHatchFill"===b.type&&a.findApplicableOverrides(b.lineSymbol,c,d)}}};a.applyOverrides=function(b,c,d,e){if(c){if(b.primitiveName)for(var g=0;g<c.length;g++){var f=c[g];if(f.primitiveName===b.primitiveName){var k;k=(k=f.propertyName)?k.charAt(0).toLowerCase()+
k.substr(1):k;e&&e.push({cim:b,nocapPropertyName:k,value:b[k]});f.expression&&(f.value=a.toValue(f.propertyName,f.expression));if(d){for(var h=!1,m=0,p=d;m<p.length;m++)p[m].primitiveName===b.primitiveName&&(h=!0);h||d.push(f)}b[k]=f.value}}switch(b.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(b.effects)for(f=0,k=b.effects;f<k.length;f++)g=k[f],a.applyOverrides(g,c,d,e);if(b.symbolLayers)for(g=0,b=b.symbolLayers;g<b.length;g++)a.applyOverrides(b[g],c,d,e);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(b.effects)for(f=
0,k=b.effects;f<k.length;f++)g=k[f],a.applyOverrides(g,c,d,e);if("CIMVectorMarker"===b.type&&b.markerGraphics)for(g=0,b=b.markerGraphics;g<b.length;g++)f=b[g],a.applyOverrides(f,c,d,e),a.applyOverrides(f.symbol,c,d,e)}}};a.restoreOverrides=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.cim[c.nocapPropertyName]=c.value}};a.buildOverrideKey=function(a){for(var b="",c=0;c<a.length;c++){var d=a[c];void 0!==d.value&&(b+=""+d.primitiveName+d.propertyName+JSON.stringify(d.value))}return b};a.toValue=
function(a,b){return"DashTemplate"===a?b.split(" ").map(function(a){return Number(a)}):"Color"===a?(a=(new l(b)).toRgba(),a[3]*=255,a):b};return a}();b.OverrideHelper=q})},"esri/symbols/cim/CIMCursor":function(){define(["require","exports","../../geometry/support/jsonUtils","./CIMPlacements"],function(q,b,l,f){function h(a){if(a)for(var b=a.length-1;0<b;--b)a[b][0]-=a[b-1][0],a[b][1]-=a[b-1][1]}function a(a){if(a)for(var b=0;b<a.length;b++)h(a[b])}function e(a){if(a)for(var b=a.length,c=1;c<b;++c)a[c][0]+=
a[c-1][0],a[c][1]+=a[c-1][1]}function d(a){if(a)for(var b=0;b<a.length;b++)e(a[b])}function k(a){a&&a.reverse()}function n(a){return{rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]]}}Object.defineProperty(b,"__esModule",{value:!0});b.deltaEncodePath=h;b.deltaEncodeMultipath=a;b.deltaDecodeGeometry=function(a){l.isPolygon(a)?d(a.rings):l.isPolyline(a)?d(a.paths):l.isMultipoint(a)&&e(a.points);return a};b.deltaEncodeGeometry=function(b){l.isPolygon(b)?a(b.rings):
l.isPolyline(b)?a(b.paths):l.isMultipoint(b)&&h(b.points);return b};b.reverseMultipath=function(a){if(a)for(var b=0;b<a.length;b++)k(a[b])};b.reversePath=k;b.getCoord2D=function(a,b,d){return[a[0]+(b[0]-a[0])*d,a[1]+(b[1]-a[1])*d]};b.isClosedPath=function(a){return a&&0!==a.length?a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]:!1};b.getId=function(a){return a[4]};b.setId=function(a,b){a[4]=b};q=function(){function a(a,b,c,d){this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=
d;this.pathIndex=this.pathCount=-1;this.iteratePath=!1;a&&(l.isPolygon(a)?b&&(this.multiPath=a.rings,this.isClosed=!0):l.isPolyline(a)?c&&(this.multiPath=a.paths,this.isClosed=!1):l.isExtent(a)&&b&&(this.multiPath=n(a).rings,this.isClosed=!0),this.multiPath&&(this.pathCount=this.multiPath.length));this.internalPlacement=new f.Placement}a.prototype.next=function(){if(!this.multiPath)return null;for(;this.iteratePath||this.pathIndex<this.pathCount-1;){this.iteratePath||this.pathIndex++;var a=this.processPath(this.multiPath[this.pathIndex]);
if(a)return a}this.pathIndex=this.pathCount=-1;return this.multiPath=null};return a}();b.PathTransformationCursor=q;q=function(){function a(a,b,c,d){this.inputGeometries=a;this.acceptPolygon=b;this.acceptPolyline=c;this.geomUnitsPerPoint=d;this.pathIndex=this.pathCount=-1;this.iteratePath=!1}a.prototype.next=function(){for(;;){if(!this.multiPath){for(var a=this.inputGeometries.next();a;)if(l.isPolygon(a)?this.acceptPolygon&&(this.multiPath=a.rings,this.isClosed=!0):l.isPolyline(a)?this.acceptPolyline&&
(this.multiPath=a.paths,this.isClosed=!1):l.isExtent(a)&&this.acceptPolygon&&(this.multiPath=n(a).rings,this.isClosed=!0),this.multiPath){this.pathCount=this.multiPath.length;this.pathIndex=-1;break}else a=this.inputGeometries.next();if(!this.multiPath)return null}for(;this.iteratePath||this.pathIndex<this.pathCount-1;)if(this.iteratePath||this.pathIndex++,a=this.processPath(this.multiPath[this.pathIndex]))return a;this.pathIndex=this.pathCount=-1;this.multiPath=null}};return a}();b.PathGeometryCursor=
q})},"esri/symbols/cim/CIMPlacements":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.setIdentity()}b.prototype.setIdentity=function(){this.tz=this.ty=this.tx=0;this.s=1;this.rz=this.ry=this.rx=0;this.rz_c=1;this.rz_s=0};b.prototype.setTranslate=function(b,h){this.tx=b;this.ty=h};b.prototype.setTranslateZ=function(b){this.tz=b};b.prototype.setRotateCS=function(b,h){this.rz=void 0;this.rz_c=b;this.rz_s=h};b.prototype.setRotate=
function(b){this.rz=b;this.rz_s=this.rz_c=void 0};b.prototype.setRotateY=function(b){this.ry=b};b.prototype.setScale=function(b){this.s=b};b.prototype.setMeasure=function(b){this.m=b};return b}();b.Placement=q;q=function(){function b(){}b.prototype.next=function(){return null};return b}();b.EmptyPlacementCursor=q})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../core/lang"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._geometry=
b}b.prototype.next=function(){var b=this._geometry;this._geometry=null;return b};return b}();b.SimpleGeometryCursor=q;b.clone=function(b){return l.clone(b)}})},"esri/symbols/cim/CIMOperators":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.getEffectOperator=function(b){return null};b.getPlacementOperator=function(b){return null}})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/Logger ../../geometry/support/jsonUtils ../cim/CIMEffects ../cim/CIMOperators ../cim/CIMPlacements ./Rect".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});b.C_DEG_TO_RAD=Math.PI/180;var c=h.getLogger("esri.symbols.cim.CIMSymbolDrawHelper"),g=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=function(){return new a(this._t.slice())};a.prototype.transform=function(a){var b=this._t;return[b[0]*a[0]+b[1]*a[1]+b[2],b[3]*a[0]+b[4]*a[1]+b[5]]};a.createScale=function(b,c){return new a([b,0,0,0,c,0])};a.prototype.scale=function(a,
b){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=b;c[4]*=b;c[5]*=b;return this};a.prototype.scaleRatio=function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(b,c){return new a([0,0,b,0,0,c])};a.prototype.translate=function(a,b){var c=this._t;c[2]+=a;c[5]+=b;return this};a.createRotate=function(b){var c=Math.cos(b);b=Math.sin(b);return new a([c,-b,0,b,c,0])};a.prototype.rotate=function(b){return this.multiply(a.createRotate(b))};a.prototype.multiply=function(a){var b=
this._t;a=a._t;var c=b[1]*a[0]+b[4]*a[1],d=b[2]*a[0]+b[5]*a[1]+a[2],e=b[0]*a[3]+b[3]*a[4],g=b[1]*a[3]+b[4]*a[4],f=b[2]*a[3]+b[5]*a[4]+a[5];b[0]=b[0]*a[0]+b[3]*a[1];b[1]=c;b[2]=d;b[3]=e;b[4]=g;b[5]=f;return this};return a}();b.Transformation=g;q=function(){function a(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||g.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}a.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};a.prototype.transformSize=
function(a){return a*this._sizeTransfos[this._sizeTransfos.length-1]};a.prototype.back=function(){return this._transfos[this._transfos.length-1]};a.prototype.push=function(a){var b=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*b)};a.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};a.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,
b)}};a.prototype.drawMultiLayerSymbol=function(a,b){if(a){var c=a.symbolLayers;if(c)if(a=a.effects){if(b=this.executeEffects(a,b))for(a=b.next();a;)this.drawSymbolLayers(c,a),a=b.next()}else this.drawSymbolLayers(c,b)}};a.prototype.executeEffects=function(a,b){var c=96/72;b=new e.SimpleGeometryCursor(b);for(var g=a?a.length:0,f=0;f<g;++f){var k=a[f];if(k){var h=d.getEffectOperator(k);h&&(b=h.execute(b,k,c))}}return b};a.prototype.drawSymbolLayers=function(a,b){for(var c=a.length;c--;){var d=a[c];
if(d&&!1!==d.enable){var e=d.effects;if(e){if(e=this.executeEffects(e,b))for(var g=e.next();g;)this.drawSymbolLayer(d,g),g=e.next()}else this.drawSymbolLayer(d,b)}}};a.prototype.drawSymbolLayer=function(a,b){switch(a.type){case "CIMSolidFill":this.drawSolidFill(b,a.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,a.color,a.width);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":this.drawMarkerLayer(a,b)}};a.prototype.drawMarkerLayer=function(a,b){var c=a.markerPlacement;
if(c){var e=96/72,g=d.getPlacementOperator(c);if(g&&(b=g.execute(b,c,e)))for(c=b.next();c;)this.drawMarker(a,c),c=b.next()}else c=new k.Placement,c.tx=b.x,c.ty=b.y,this.drawMarker(a,c)};a.prototype.drawMarker=function(a,b){switch(a.type){case "CIMCharacterMarker":case "CIMPictureMarker":this.drawPictureMarker(a,b);break;case "CIMVectorMarker":this.drawVectorMarker(a,b)}};a.prototype.drawPictureMarker=function(a,b){};a.prototype.drawVectorMarker=function(a,d){if(a){var e=a.markerGraphics;if(e){var f=
a.size,k=a.frame,h=k?k.ymax-k.ymin:0,f=f&&h?f/h:1,h=g.createIdentity();k&&h.translate(.5*-(k.xmax+k.xmin),.5*-(k.ymax+k.ymin));var m=a.anchorPoint;if(m){var p=m.x,m=m.y;"Absolute"!==a.anchorPointUnits&&k&&(p*=k.xmax-k.xmin,m*=k.ymax-k.ymin);h.translate(-p,-m)}1!==f&&h.scale(f,f);a.rotation&&h.rotate(a.rotation*b.C_DEG_TO_RAD);h.translate(a.offsetX||0,a.offsetY||0);h.translate(d.tx,d.ty);this.push(h);for(a=0;a<e.length;a++)(d=e[a])&&d.symbol&&d.geometry||c.error("Invalid marker graphic",d),this.drawSymbol(d.symbol,
d.geometry);this.pop()}}};return a}();b.CIMSymbolDrawHelper=q;f=function(b){function c(){var a=b.call(this)||this;a.reset();return a}l(c,b);c.prototype.reset=function(){this._xmin=this._ymin=Infinity;this._xmax=this._ymax=-Infinity};c.prototype.envelope=function(){return new n.default(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};c.prototype._merge=function(a,b){a[0]-b<this._xmin&&(this._xmin=a[0]-b);a[0]+b>this._xmax&&(this._xmax=a[0]+b);a[1]-b<this._ymin&&(this._ymin=a[1]-
b);a[1]+b>this._ymax&&(this._ymax=a[1]+b)};c.prototype.drawSolidFill=function(a){if(a&&a.rings){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b],d=c?c.length:0;if(2<d){this._merge(this.transformPt(c[0]),0);for(var e=1;e<d;++e)this._merge(this.transformPt(c[e]),0)}}}};c.prototype.drawSolidStroke=function(b,c,d){c=.5*this.transformSize(d);if(b=a.isPolygon(b)?b.rings:b.paths)for(d=0;d<b.length;d++){var e=b[d],g=e?e.length:0;if(1<g){this._merge(this.transformPt(e[0]),c);for(var f=1;f<g;++f)this._merge(this.transformPt(e[f]),
c)}}};return c}(q);b.EnvDrawHelper=f;q=function(b){function c(a,c){c=b.call(this,c)||this;c._ctx=a;return c}l(c,b);c.prototype.drawSolidFill=function(a,b){if(a&&a.rings){var c=this._ctx;c.fillStyle="string"===typeof b?b:"rgba("+Math.round(b[0])+","+Math.round(b[1])+","+Math.round(b[2])+","+b[3]/255+")";c.beginPath();b=0;for(a=a.rings;b<a.length;b++){var d=a[b],e=d?d.length:0;if(2<e){var g=this.transformPt(d[0]);c.moveTo(g[0],g[1]);for(var f=1;f<e;++f)g=this.transformPt(d[f]),c.lineTo(g[0],g[1]);c.closePath()}}c.fill("evenodd")}};
c.prototype.drawSolidStroke=function(b,c,d){var e=this._ctx;e.strokeStyle="string"===typeof c?c:"rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/255+")";e.lineWidth=this.transformSize(d)+.5;e.beginPath();c=!1;a.isPolygon(b)?(d=b.rings,c=!0):d=b.paths;for(b=0;b<d.length;b++){var g=d[b],f=g?g.length:0;if(1<f){var k=this.transformPt(g[0]);e.moveTo(k[0],k[1]);for(var h=1;h<f;++h)k=this.transformPt(g[h]),e.lineTo(k[0],k[1]);c&&e.closePath()}}e.stroke()};return c}(q);b.CanvasDrawHelper=
q})},"esri/symbols/cim/Rect":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h,a,e){void 0===b&&(b=0);void 0===h&&(h=0);void 0===a&&(a=0);void 0===e&&(e=0);this.x=b;this.y=h;this.width=a;this.height=e}Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});b.prototype.union=function(b){this.x=Math.min(this.x,b.x);this.y=Math.min(this.y,b.y);this.width=
Math.max(this.width,b.width);this.height=Math.max(this.height,b.height)};return b}();b.default=q})},"esri/symbols/cim/packingUtils":function(){define(["require","exports"],function(q,b){function l(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var f=[1,256,65536,16777216],h=[1/256,1/65536,1/16777216,1/4294967296],a=function(a,b){void 0===b&&(b=0);for(var d=0,e=0;4>e;e++)d+=a[b+e]*h[e];return d}(new Uint8ClampedArray([255,255,255,255]));b.packFloatRGBA=function(b,d,k){void 0===
k&&(k=0);b=0>b?0:b>a?a:b;for(var e=0;4>e;e++)d[k+e]=Math.floor(256*l(b*f[e]))}})},"esri/symbols/cim/enums":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b[b.BUTT=0]="BUTT";b[b.ROUND=1]="ROUND";b[b.SQUARE=2]="SQUARE";b[b.UNKNOWN=4]="UNKNOWN"})(b.CapType||(b.CapType={}));(function(b){b[b.BEVEL=0]="BEVEL";b[b.ROUND=1]="ROUND";b[b.MITER=2]="MITER";b[b.UNKNOWN=4]="UNKNOWN"})(b.JoinType||(b.JoinType={}));(function(b){b[b.SCREEN=0]="SCREEN";
b[b.MAP=1]="MAP"})(b.Alignment||(b.Alignment={}))})},"esri/symbols/cim/SDFHelper":function(){define(["require","exports","../../geometry/support/jsonUtils","./packingUtils","./Rect"],function(q,b,l,f,h){function a(b){if(!b)return null;switch(b.type){case "CIMPointSymbol":b=b.symbolLayers;if(!b||1!==b.length)break;return a(b[0]);case "CIMVectorMarker":b=b.markerGraphics;if(!b||1!==b.length)break;var d=b[0];if(!d)break;b=d.geometry;if(!b)break;d=d.symbol;if(!d||"CIMPolygonSymbol"!==d.type&&"CIMLineSymbol"!==
d.type)break;return{geom:b,asFill:"CIMPolygonSymbol"===d.type};case "sdf":return{geom:b.geom,asFill:b.asFill}}return null}function e(a){for(var b=Infinity,d=-Infinity,c=Infinity,e=-Infinity,f=0;f<a.length;f++)for(var h=0,l=a[f];h<l.length;h++){var t=l[h];t[0]<b&&(b=t[0]);t[0]>d&&(d=t[0]);t[1]<c&&(c=t[1]);t[1]>e&&(e=t[1])}return[b,c,d,e]}Object.defineProperty(b,"__esModule",{value:!0});b.getSDFInfo=a;b.getSDFSymbol=function(a){a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;
a=a.symbol;return!a||"CIMPolygonSymbol"!==a.type&&"CIMLineSymbol"!==a.type?null:a};b.getExtent=function(a){return a?a.rings?e(a.rings):a.paths?e(a.paths):l.isExtent(a)?[a.xmin,a.ymin,a.xmax,a.ymax]:null:null};b.getSDFMetrics=function(a,b,e,c,g){var d=a[0],f=a[1],k=a[2];a=a[3];if(k<d||a<f)return[0,0,0];var h=k-d,n=a-f,k=Math.floor(31.5);a=(128-2*(k+1))/Math.max(h,n);var h=Math.round(h*a),n=Math.round(n*a)+2*k,l=1;b&&(l=n/a/(b.ymax-b.ymin));var y=0,m=0;c&&(g?b&&e&&0<b.ymax-b.ymin&&(y=c.x/((b.xmax-b.xmin)/
(b.ymax-b.ymin)*e),m=c.y/e):(y=c.x,m=c.y));y=.5*(b.xmax+b.xmin)+y*(b.xmax-b.xmin);m=.5*(b.ymax+b.ymin)+m*(b.ymax-b.ymin);y=(y-d)*a+k;m=(m-f)*a+k;return[l,y/(h+2*k)-.5,-(m/n-.5)]};b.buildSDF=function(a){var b,d=a.geom;b=d?d.rings?d.rings:d.paths?d.paths:void 0!==d.xmin&&void 0!==d.ymin&&void 0!==d.xmax&&void 0!==d.ymax?[[[d.xmin,d.ymin],[d.xmin,d.ymax],[d.xmax,d.ymax],[d.xmax,d.ymin],[d.xmin,d.ymin]]]:null:null;var c,d=Infinity,e=-Infinity,r=Infinity,p=-Infinity;for(c=0;c<b.length;c++)for(var l=0,
t=b[c];l<t.length;l++){var x=t[l];x[0]<d&&(d=x[0]);x[0]>e&&(e=x[0]);x[1]<r&&(r=x[1]);x[1]>p&&(p=x[1])}c=new h.default(d,r,e-d,p-r);r=Math.floor(31.5);l=(128-2*(r+1))/Math.max(c.width,c.height);d=Math.round(c.width*l)+2*r;e=Math.round(c.height*l)+2*r;p=[];for(t=0;t<b.length;t++){var v=b[t];if(v&&1<v.length){for(var x=[],y=0;y<v.length;y++){var m=v[y],w=m[0],m=m[1],w=w-c.x,m=m-c.y,w=w*l,m=m*l,w=w+(r-.5),m=m+(r-.5);x.push([w,m])}a.asFill&&(y=x.length-1,x[0][0]===x[y][0]&&x[0][1]===x[y][1]||x.push(x[0]));
p.push(x)}}c=d*e;b=Array(c);t=r*r+1;for(l=0;l<c;++l)b[l]=t;for(t=0;t<p.length;t++)for(x=p[t],y=x.length,l=1;l<y;++l){var v=x[l-1],w=x[l],A=void 0,m=void 0;v[0]<w[0]?(A=v[0],m=w[0]):(A=w[0],m=v[0]);var B=void 0,C=void 0;v[1]<w[1]?(B=v[1],C=w[1]):(B=w[1],C=v[1]);var q=Math.floor(A)-r,m=Math.floor(m)+r,B=Math.floor(B)-r,C=Math.floor(C)+r;0>q&&(q=0);m>d&&(m=d);0>B&&(B=0);C>e&&(C=e);for(var A=w[0]-v[0],G=w[1]-v[1],J=A*A+G*G;q<m;q++)for(var I=B;I<C;I++){var K=(q-v[0])*A+(I-v[1])*G,H=void 0,L=void 0;0>K?
(H=v[0],L=v[1]):K>J?(H=w[0],L=w[1]):(K/=J,H=v[0]+K*A,L=v[1]+K*G);K=(q-H)*(q-H)+(I-L)*(I-L);H=(e-I-1)*d+q;K<b[H]&&(b[H]=K)}}for(l=0;l<c;++l)b[l]=Math.sqrt(b[l]);if(a.asFill)for(a=0;a<p.length;a++)for(c=p[a],l=c.length,t=1;t<l;++t)for(x=c[t-1],y=c[t],w=v=void 0,x[0]<y[0]?(v=x[0],w=y[0]):(v=y[0],w=x[0]),m=B=void 0,x[1]<y[1]?(B=x[1],m=y[1]):(B=y[1],m=x[1]),v=Math.floor(v),w=Math.floor(w)+1,B=Math.floor(B),m=Math.floor(m)+1,v<r&&(v=r),w>d-r&&(w=d-r),B<r&&(B=r),m>e-r&&(m=e-r);B<m;++B)if(x[1]>B!==y[1]>B){C=
(e-B-1)*d;for(A=v;A<w;++A)A<(y[0]-x[0])*(B-x[1])/(y[1]-x[1])+x[0]&&(b[C+A]=-b[C+A]);for(A=r;A<v;++A)b[C+A]=-b[C+A]}r*=2;p=b.length;a=new Uint8Array(4*p);for(c=0;c<p;++c)f.packFloatRGBA(.5-b[c]/r,a,4*c);return[a,d,e]}})},"esri/views/2d/arcade/utils":function(){define("require exports ../../../core/tsSupport/assignHelper @dojo/framework/shim/WeakMap ../../../core/Error ../../../core/Logger ../../../geometry/support/quantizationUtils ../../../layers/graphics/featureConversionUtils".split(" "),function(q,
b,l,f,h,a,e,d){function k(a,b,c,d){var e=d.transform,f=d.hasZ;d=d.hasM;g.has(a)||g.set(a,n(c));a=g.get(a)(b.geometry,e,f,d);return l({},b,{geometry:a})}function n(a){var b={};switch(a){case "esriGeometryPoint":return function(a,c,d,g){return e.hydratePoint(c,b,a,d,g)};case "esriGeometryPolygon":return function(a,c,d,g){return e.hydratePolygon(c,b,a,d,g)};case "esriGeometryPolyline":return function(a,c,d,g){return e.hydratePolyline(c,b,a,d,g)};case "esriGeometryMultipoint":return function(a,c,d,g){return e.hydrateMultipoint(c,
b,a,d,g)};default:return c.error(new h("mapview-arcade","Unable to handle geometryType: "+a)),function(a){return a}}}Object.defineProperty(b,"__esModule",{value:!0});var c=a.getLogger("esri.views.2d.support.arcadeOnDemand");b.callWithOptimizedFeature=function(a,b,e,g,f){var h=g.geometryType,p=g.hasZ;g=g.hasM;b=a.referencesGeometry()?f?k(a,d.convertToFeature(b,h,p,g),h,f):d.convertToFeature(b,h,p,g):b;b=a.repurposeFeature(b);try{return a.evaluate(l({},e,{$feature:b}))}catch(m){return c.warn("Feature arcade evaluation failed:",
m),null}};b.callWithFeature=function(a,b,d,e,g){b=a.referencesGeometry()&&g?k(a,b,e,g):b;b=a.repurposeFeature(b);try{return a.evaluate(l({},d,{$feature:b}))}catch(v){return c.warn("Feature arcade evaluation failed:",v),null}};var g=new f.default;b.createHydrateFactory=n})},"esri/symbols/cim/Rasterizer":function(){define(["require","exports","./CIMSymbolHelper","./SDFHelper","./utils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){}a.prototype.dispose=
function(){this._rasterizationCanvas=null};a.prototype.rasterizeJSONResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type)return b=l.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style),{size:[b[1],b[2]],image:new Uint32Array(b[0].buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0};if("simple-line"===a.type||"esriSLS"===a.type)return b=l.SymbolHelper.rasterizeSimpleLine(a.style,a.cap),
{size:[b[1],b[2]],image:new Uint32Array(b[0].buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0};var d;a="simple-marker"===a.type||"esriSMS"===a.type?l.CIMSymbolHelper.fromSimpleMarker(a):a;if((d=f.getSDFInfo(a))&&!b)return b=f.buildSDF(d),(a=b[0])?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null;b=l.CIMSymbolHelper.rasterize(this._rasterizationCanvas,a,!b);a=b[0];d=b[3];var e=b[4];return a?{size:[b[1],b[2]],image:new Uint32Array(a.buffer),sdf:!1,
simplePattern:!1,anchorX:d,anchorY:e}:null};a.prototype.rasterizeImageResource=function(a,b){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var d=this._rasterizationCanvas.getContext("2d");d.drawImage(a,0,0,a.width,a.height);d=d.getImageData(0,0,a.width,a.height);d=new Uint8Array(d.data);if(b)for(var e=0;e<b.length;e++){var c=b[e];if(c&&c.oldColor&&4===c.oldColor.length&&c.newColor&&
4===c.newColor.length){var g=c.oldColor,f=g[0],p=g[1],l=g[2],g=g[3],t=c.newColor,c=t[0],x=t[1],v=t[2],y=t[3];if(f!==c||p!==x||l!==v||g!==y)for(t=0;t<d.length;t+=4)f===d[t]&&p===d[t+1]&&l===d[t+2]&&g===d[t+3]&&(d[t]=c,d[t+1]=x,d[t+2]=v,d[t+3]=y)}}for(t=0;t<d.length;t+=4)b=d[t+3]/255,d[t]*=b,d[t+1]*=b,d[t+2]*=b;b=a.width;e=a.height;f=d;if(512<=b||512<=e)f=a.width/a.height,1<f?(b=512,e=Math.round(512/f)):(e=512,b=Math.round(512*f)),f=new Uint8Array(4*b*e),h.resampleHermite(d,a.width,a.height,new Uint8ClampedArray(f.buffer),
b,e,!1);return{size:[b,e],image:new Uint32Array(f.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};return a}();b.default=q})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.evaluateValueOrFunction=function(b,f,h,a){return"function"===typeof b?b(f,h,a):b};b.colorToArray=function(b){return[b.r,b.g,b.b,b.a]};b.resampleHermite=function(b,f,h,a,e,d,k){void 0===k&&(k=!0);var n=f/e;h/=d;for(var c=Math.ceil(n/2),g=Math.ceil(h/
2),r=0;r<d;r++)for(var p=0;p<e;p++){for(var l=4*(p+(k?d-r-1:r)*e),t=0,x=0,v=0,y=0,m=0,w=0,A=0,B=(r+.5)*h,C=Math.floor(r*h);C<(r+1)*h;C++)for(var q=Math.abs(B-(C+.5))/g,G=(p+.5)*n,q=q*q,J=Math.floor(p*n);J<(p+1)*n;J++){var I=Math.abs(G-(J+.5))/c,t=Math.sqrt(q+I*I);-1<=t&&1>=t&&(t=2*t*t*t-3*t*t+1,0<t&&(I=4*(J+C*f),A+=t*b[I+3],v+=t,255>b[I+3]&&(t=t*b[I+3]/250),y+=t*b[I],m+=t*b[I+1],w+=t*b[I+2],x+=t))}a[l]=y/x;a[l+1]=m/x;a[l+2]=w/x;a[l+3]=A/v}}})},"esri/symbols/cim/TextRasterizer":function(){define(["require",
"exports","../../core/screenUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){}a.prototype.rasterizeText=function(a,b){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));var d=this._textRasterizationCanvas,e=d.getContext("2d");this.setFontProperties(e,b);this.parameters=b;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight();a=this.computeTextWidth(e,b);var c=this.lineHeight*this.textLines.length;
d.width=a;d.height=c;this.renderedLineHeight=Math.round(this.lineHeight*b.pixelRatio);this.renderedHaloSize=b.halo.size*b.pixelRatio;this.renderedWidth=a*b.pixelRatio;this.renderedHeight=c*b.pixelRatio;d=b.color;this.fillStyle="rgba("+d.slice(0,3).toString()+","+d[3]+")";this.haloStyle="rgb("+b.halo.color.slice(0,3).toString()+")";var d=this.renderedLineHeight,g=this.renderedHaloSize;this.setFontProperties(e,b);a=e.textAlign;var c=this.renderedWidth,f=("center"===a?.5*c:"right"===a?c:0)+g,c=a=0;0<
g&&this.renderHalo(e,f,g,a,c,b);c+=g;a+=f;g=0;for(f=this.textLines;g<f.length;g++){var h=f[g];e.globalCompositeOperation="destination-out";e.fillStyle="rgb(0, 0, 0)";e.fillText(h,a,c);e.globalCompositeOperation="source-over";e.fillStyle=this.fillStyle;e.fillText(h,a,c);c+=d}e=e.getImageData(0,0,this.renderedWidth,this.renderedHeight);e=new Uint8Array(e.data);if(b.premultiplyColors)for(b=void 0,d=0;d<e.length;d+=4)b=e[d+3]/255,e[d]*=b,e[d+1]*=b,e[d+2]*=b;return{size:[this.renderedWidth,this.renderedHeight],
image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}};a.prototype.renderHalo=function(a,b,f,h,c,g){var d=this.renderedWidth,e=this.renderedHeight;this._haloRasterizationCanvas||(this._haloRasterizationCanvas=document.createElement("canvas"));this._haloRasterizationCanvas.width=d;this._haloRasterizationCanvas.height=e;var k=this._haloRasterizationCanvas,n=k.getContext("2d");n.clearRect(0,0,d,e);this.setFontProperties(n,g);n.fillStyle=this.haloStyle;n.strokeStyle=this.haloStyle;
g=3>this.renderedHaloSize;n.lineJoin=g?"miter":"round";g?this.renderHaloEmulated(n,b,f):this.renderHaloNative(n,b,f);a.globalAlpha=this.parameters.halo.color[3];a.drawImage(k,0,0,d,e,h,c,d,e);a.globalAlpha=1};a.prototype.renderHaloEmulated=function(a,b,k){for(var d=this.renderedLineHeight,c=this.renderedHaloSize,e=0,h=this.textLines;e<h.length;e++){for(var p=h[e],l=0,t=f;l<t.length;l++){var x=t[l];a.fillText(p,b+c*x[0],k+c*x[1])}k+=d}};a.prototype.renderHaloNative=function(a,b,f){for(var d=this.renderedLineHeight,
c=this.renderedHaloSize,e=0,k=this.textLines;e<k.length;e++){for(var h=k[e],l=2*c,t=0;5>t;t++)a.lineWidth=(.6+.1*t)*l,a.strokeText(h,b,f);f+=d}};a.prototype.setFontProperties=function(a,b){var d=b.font;b=d.style+" "+d.weight+" "+l.pt2px(b.size*b.pixelRatio)+"px "+d.family+", sans-serif";a.font=b;a.textAlign="left";a.textBaseline="top"};a.prototype.computeTextWidth=function(a,b){for(var d=0,e=0,c=this.textLines;e<c.length;e++)d=Math.max(d,a.measureText(c[e]).width);b=b.font;if("italic"===b.style||
"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)d+=.3*a.measureText("A").width;d+=2*this.parameters.halo.size;return Math.round(d)};a.prototype.computeLineHeight=function(){return Math.round(1.275*this.parameters.size+2*this.parameters.halo.size)};return a}();b.TextRasterizer=q;for(var f=[],h=0;360>h;h+=22.5)f.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);b.default=q})},"esri/symbols/support/utils":function(){define("require exports ../../Color ../../symbols ../../core/compilerUtils ../../core/has ../../core/Logger ../../core/maybe ../../core/screenUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){function g(a,b){if(null==b)return a;a=a.toRgba();a[3]*=b;return new l(a)}function r(a,b,e){if(a=a.symbolLayers){var f=function(a){a=d.isSome(a)?a:null;b=b||a||null!=e&&x;return g(b,e)};a.forEach(function(a){if("water"===a.type)a.color=f(a.color);else{var b=d.isSome(a.material)?a.material.color:null,b=f(b);d.isNone(a.material)?a.material=new c.default({color:b}):a.material.color=b;null!=e&&"outline"in a&&d.isSome(a.outline)&&d.isSome(a.outline.color)&&(a.outline.color=
g(a.outline.color,e))}})}}function p(a,b,c){(a=a.symbolLayers)&&a.forEach(function(a){if(a)switch(a.type){case "icon":case "line":case "path":case "extrude":case "text":a.size=b;break;case "object":switch(c){case "width":a.width=b;break;case "depth":a.depth=b;break;case "height":a.height=b;break;case "width-and-depth":a.width=b;a.depth=b;break;default:a.width=b,a.depth=b,a.height=b}break;default:u.warn("symbolUtils: applySizeToSymbol","symbolLayer not supported")}})}Object.defineProperty(b,"__esModule",
{value:!0});var u=e.getLogger("esri.symbols.support.utils"),t=/\/resource\/(.*?)\.svg$/,x=new l("white");b.getSymbolOutlineSize=function(a){if(!a)return 0;if(f.isSymbol3D(a)){var b=a.symbolLayers&&a.symbolLayers.length;b?(a=a.symbolLayers.getItemAt(b-1),a="outline"in a?d.get(a,"outline","size"):void 0):a=void 0;return d.isSome(a)?a:0}return(a=n.getStroke(a))&&k.px2pt(a.width)||0};b.isVolumetricSymbol=function(a){if(!a||!a.symbolLayers)return!1;switch(a.type){case "point-3d":return a.symbolLayers.some(function(a){return"object"===
a.type});case "line-3d":return a.symbolLayers.some(function(a){return"path"===a.type});case "polygon-3d":return a.symbolLayers.some(function(a){return"object"===a.type||"extrude"===a.type});default:return!1}};b.getIconHref=function(b,c){c=c.resource.href;return!a("esri-canvas-svg-support")&&b.styleOrigin&&t.test(c)?c.replace(t,"/resource/png/$1.png"):c};b.applyOpacityToColor=g;b.applyColorToSymbol=function(a,b,c){if(a&&(b||null!=c))if(b&&(b=new l(b)),f.isSymbol3D(a))r(a,b,c);else if(f.isSymbol2D(a)){if(b=
b||a.color)a.color=g(b,c);null!=c&&"outline"in a&&a.outline&&a.outline.color&&(a.outline.color=g(a.outline.color,c))}};b.applySizeToSymbol=function(a,b,c){if(a&&null!=b)if(f.isSymbol3D(a))p(a,b,c);else if(f.isSymbol2D(a))switch(a.type){case "simple-marker":a.size=b;break;case "picture-marker":c=a.width/a.height;1<c?(a.width=b,a.height=b*c):(a.width=b*c,a.height=b);break;case "simple-line":a.width=b;break;case "text":a.font.size=b;break;case "simple-fill":case "picture-fill":break;case "cim":break;
default:h.neverReached(a)}};b.applyRotationToSymbol=function(a,b,c){a&&null!=b&&(f.isSymbol3D(a)?(a=a.symbolLayers)&&a.forEach(function(a){if(a&&"object"===a.type)switch(c){case "tilt":a.tilt=b;break;case "roll":a.roll=b;break;default:a.heading=b}}):!f.isSymbol2D(a)||"simple-marker"!==a.type&&"picture-marker"!==a.type&&"text"!==a.type||(a.angle=b))}})},"esri/symbols/support/gfxUtils":function(){define("require exports ../../core/tsSupport/assignHelper ../../Color ../../request ../../core/ItemCache ../../core/promiseUtils ../../core/screenUtils".split(" "),
function(q,b,l,f,h,a,e,d){function k(a){if(!a)return null;var b;switch(a.type){case "simple-fill":case "picture-fill":case "simple-marker":b=k(a.outline);break;case "simple-line":var c=d.pt2px(a.width);"none"!==a.style&&0!==c&&(b={color:a.color,style:p(a.style),width:c,cap:a.cap,join:"miter"===a.join?d.pt2px(a.miterLimit):a.join});break;default:b=null}return b}Object.defineProperty(b,"__esModule",{value:!0});var n=q.toUrl("../../symbols/patterns/"),c={left:"start",center:"middle",right:"end",justify:"start"},
g={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},r=new a(1E3);b.getSVGAlign=function(a){return a=(a=a.horizontalAlignment)&&c[a.toLowerCase()]||"middle"};b.getSVGBaseline=function(a){return(a=a.verticalAlignment)&&g[a.toLowerCase()]||"alphabetic"};b.getSVGBaselineShift=function(a){return"bottom"===a.verticalAlignment?"super":null};b.getFill=function(a){var b=a.style,c=null;if(a)switch(a.type){case "simple-marker":"cross"!==b&&"x"!==b&&(c=a.color);break;case "simple-fill":"solid"===
b?c=a.color:"none"!==b&&(c={type:"pattern",x:0,y:0,src:n+b+".png",width:8,height:8});break;case "picture-fill":c={type:"pattern",src:a.url,width:d.pt2px(a.width)*a.xscale,height:d.pt2px(a.height)*a.yscale,x:d.pt2px(a.xoffset),y:d.pt2px(a.yoffset)};break;case "text":c=a.color}return c};b.getPatternUrlWithColor=function(a,b){var c=a+"-"+b;return void 0!==r.get(c)?e.resolve(r.get(c)):h(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.naturalWidth,e=a.naturalHeight,g=document.createElement("canvas");
g.width=d;g.height=e;var f=g.getContext("2d");f.fillStyle=b;f.fillRect(0,0,d,e);f.globalCompositeOperation="destination-in";f.drawImage(a,0,0);a=g.toDataURL();r.put(c,a);return a})};b.getStroke=k;var p=function(){var a={};return function(b){if(a[b])return a[b];var c=b.replace(/-/g,"");return a[b]=c}}();b.defaultThematicColor=new f([128,128,128])})},"esri/core/ItemCache":function(){define(["require","exports","./MemCache"],function(q,b,l){return function(){function b(b,a){this._storage=new l.MemCacheStorage;
this._storage.maxSize=b;a&&this._storage.registerRemoveFunc("",a)}b.prototype.put=function(b,a){this._storage.put(b,a,1,1)};b.prototype.pop=function(b){return this._storage.pop(b)};b.prototype.get=function(b){return this._storage.get(b)};b.prototype.clear=function(){this._storage.clearAll()};b.prototype.destroy=function(){this._storage.clearAll()};return b}()})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec4f64"],function(q,
b,l){Object.defineProperty(b,"__esModule",{value:!0});b.defaultIconElevationOffset=1;b.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;b.TRANSPARENT_UNIT=l.vec4f64.ZEROS;b.WHITE_UNIT=l.vec4f64.ONES})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/ComponentUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){q=function(){function b(a,b,c){this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}b.prototype.initialize=function(a,b,c){this.stage=a;this._layerView=c;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};b.prototype.setVisibility=function(a){if(null!=this.stage){if(this._visible!==a){if((this._visible=
a)&&!this._addedToStage)return this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView),!0;if(!a&&!this._addedToStage)return!1;for(var b=0,d=this.renderGeometries;b<d.length;b++){var e=d[b],g=e.instanceParameters.componentVisibilities,g=a?c.unhideAllComponents(g):c.hideAllComponents(g);e.instanceParameters.componentVisibilities=g}this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1);return!0}return!1}};b.prototype.destroy=function(){this.stage&&
this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView);this._visible=this._addedToStage=!1;this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};b.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=e.vec3f64.create());return a.vec3.set(b,0,0,0)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=d.create());return d.empty(a)};b.prototype.addHighlight=function(a,
b){var c=this;this.renderGeometries.forEach(function(d){var e=d.addHighlight(b);a.addRenderGeometry(d,e,c)});this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};b.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};b.prototype.removeRenderGeometryHighlight=function(a,b){a.removeHighlight(b);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};b.prototype.computeAttachmentOrigin=
function(a){for(var b=0,c=this.renderGeometries;b<c.length;b++)c[b].computeAttachmentOrigin(p)&&(a.draped.origin[0]+=p[0],a.draped.origin[1]+=p[1],a.draped.num++)};b.prototype.getProjectedBoundingBox=function(a,b,c,e,k){return h(this,void 0,void 0,function(){var h,m,r,l;return f(this,function(f){switch(f.label){case 0:d.empty(k);for(h=0;h<this.renderGeometries.length;h++)m=this.renderGeometries[h],this._getRenderGeometryProjectedBoundingRect(m,a,g,c),d.expand(k,g);if(!b)return[3,5];d.center(k,p);
r=void 0;l=n.demResolutionForBoundingBox(k,b);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,b.service.queryElevation(p[0],p[1],e,l)];case 2:return r=f.sent(),[3,4];case 3:return f.sent(),r=null,[3,4];case 4:null!=r&&(k[2]=Math.min(k[2],r),k[5]=Math.max(k[5],r)),f.label=5;case 5:return[2,k]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,e){if(this.boundingBox)d.set(r,this.boundingBox);else{var g=a.center;a=a.bsRadius;r[0]=g[0]-a;r[1]=g[1]-a;r[2]=g[2]-a;r[3]=g[0]+a;r[4]=
g[1]+a;r[5]=g[2]+a}b(r,0,2);this.calculateRelativeScreenBounds&&e.push({location:d.center(r),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return d.toRect(r,c)};return b}();var g=k.create(),r=d.create(),p=e.vec3f64.create();return q})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(q,b,l){function f(a,b,d){d&&(b/=Math.SQRT2);for(var e=new Uint8Array(4*a*a),f=0;f<a;f++)for(var c=0;c<a;c++){var g=c-.5*a+.25,
h=-f+.5*a-.75,p=f*a+c;if(d)var u=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=u;g=Math.max(Math.abs(g),Math.abs(h))-.5*b;g=g/a+.5;l.packFloatRGBA(g,e,4*p)}return e}function h(a,b,d){d&&(b*=Math.SQRT2);b*=.5;for(var e=new Uint8Array(4*a*a),f=0;f<a;f++)for(var c=0;c<a;c++){var g=c-.5*a,h=-f+.5*a-1,p=f*a+c;if(d)var u=(g+h)/Math.SQRT2,h=(h-g)/Math.SQRT2,g=u;u=void 0;g=Math.abs(g);h=Math.abs(h);u=g>h?g>b?Math.sqrt((g-b)*(g-b)+h*h):h:h>b?Math.sqrt(g*g+(h-b)*(h-b)):g;u=u/a+.5;l.packFloatRGBA(u,e,4*p)}return e}
Object.defineProperty(b,"__esModule",{value:!0});b.createCircle=function(a,b){var d=new Uint8Array(4*a*a),e=a/2-.5;b/=2;for(var f=0;f<a;f++)for(var c=0;c<a;c++){var g=c+a*f,h=c-e,p=f-e,h=Math.sqrt(h*h+p*p)-b,h=h/a+.5;l.packFloatRGBA(h,d,4*g)}return d};b.createSquare=function(a,b){return f(a,b,!1)};b.createKite=function(a,b){return f(a,b,!0)};b.createCross=function(a,b){return h(a,b,!1)};b.createX=function(a,b){return h(a,b,!0)};b.createTriangle=function(a,b){for(var d=new Uint8Array(4*a*a),e=Math.sqrt(1.25),
f=(a-b)/2,c=0;c<a;c++)for(var g=0;g<a;g++){var h=(g-f)/b,p=(c-f+.75)/b;l.packFloatRGBA(Math.max(-(1*h+-.5*p)/e,(1*(h-1)+-.5*-p)/e,-p)*b/a+.5,d,4*(c*a+g))}return d}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a){return null!==a&&void 0!==a}function p(a){return"number"===typeof a}function u(a){return"string"===typeof a}function t(a,b){a&&a.push(b)}function x(a,b,d,e,g){var f=a.minSize,k=a.maxSize;if(a.expression)return t(g,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],b.minSize[d]=a,b.maxSize[d]=a,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(r(a.field)){if(r(a.stops)){if(2===a.stops.length&&
p(a.stops[0].size)&&p(a.stops[1].size))return v(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,d),b.type[d]=1,!0;t(g,"Could not convert size info: stops only supported with 2 elements");return!1}if(p(f)&&p(k)&&r(a.minDataValue)&&r(a.maxDataValue))return v(f,k,a.minDataValue,a.maxDataValue,b,d),b.type[d]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[d]=-Infinity,b.maxSize[d]=Infinity,b.offset[d]=0,b.factor[d]=1/c.meterIn[a.valueUnit],b.type[d]=1,!0;if("unknown"===a.valueUnit)return t(g,
"Could not convert size info: proportional size not supported"),!1;t(g,"Could not convert size info: scale-dependent size not supported");return!1}if(!r(a.field)){if(a.stops&&a.stops[0]&&p(a.stops[0].size))return b.minSize[d]=a.stops[0].size,b.maxSize[d]=a.stops[0].size,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(p(f))return b.minSize[d]=f,b.maxSize[d]=f,b.offset[d]=f,b.factor[d]=0,b.type[d]=1,!0}t(g,"Could not convert size info: unsupported variant of sizeInfo");return!1}function v(a,
b,c,d,e,g){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[g]=0<d?a:b;e.maxSize[g]=0<d?b:a;e.offset[g]=a-c*d;e.factor[g]=d}function y(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return t(d,"Could not convert size info: unsupported property"),null;var e=a.field;if(null!=e&&!u(e))return t(d,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=
a.field;else if(a.field!==b.size.field)return t(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(e=x(a,b.size,0,c,d))?b:null;case "height":return(e=x(a,b.size,2,c,d))?b:null;case "depth":return(e=x(a,b.size,1,c,d))?b:null;case "width-and-depth":return(e=x(a,b.size,0,c,d))&&x(a,b.size,1,c,d),e?b:null;case null:case void 0:case "all":return(e=(e=(e=x(a,b.size,0,c,d))&&x(a,b.size,1,c,d))&&x(a,b.size,2,c,d))?b:null;default:return t(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function m(a,b,c){for(var d=0;3>d;++d){var e=b.unitInMeters;1===a.type[d]&&(e*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return t(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function w(a,
b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function A(a,b,c){if(a.normalizationField)return t(c,"Could not convert color info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return t(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.color.values[a]=d.value;
w(b.color.colors,a,d.color)}}else return t(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,w(b.color.colors,a,c);else return t(c,"Could not convert color info: no field and no colors/stops"),null;return b}function B(a,b,c){if(a.normalizationField)return t(c,
"Could not convert opacity info: unsupported property"),null;if(u(a.field))if(a.stops){if(8<a.stops.length)return t(c,"Could not convert opacity info: too many opacity stops"),null;b.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.opacity.values[a]=d.value;b.opacity.opacityValues[a]=d.opacity}}else return t(c,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(c=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,b.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.opacity.values[a]=Infinity,b.opacity.opacityValues[a]=c;else return t(c,"Could not convert opacity info: no field and no opacities/stops"),null;return b}function C(a,b,c){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function E(a,b,c){if(!u(a.field))return t(c,"Could not convert rotation info: field is not a string"),
null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return t(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return C(a,b.rotation,0),b;case "roll":return C(a,b.rotation,1),b;case null:case void 0:case "heading":return C(a,b.rotation,2),b;default:return t(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),
null}}function G(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,e=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation,f=!!b.supportedTypes&&!!b.supportedTypes.opacity,k=a.reduce(function(a,k){if(!a)return a;if(k.valueExpression)return t(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(k.type){case "size":return d?y(k,a,b,c):a;case "color":return e?A(k,a,c):a;case "opacity":return f?B(k,a,c):null;
case "rotation":return g?E(k,a,c):a;default:return l.neverReached(k),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&k&&!k.size&&!k.color&&!k.opacity&&!k.rotation||k&&k.size&&!m(k.size,b,c)?null:k}function J(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function I(b,c){var g={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,
vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},f=b&&null!=b.size;b&&b.size?(g.vvSizeEnabled=!0,g.vvSizeMinSize=b.size.minSize,g.vvSizeMaxSize=b.size.maxSize,g.vvSizeOffset=b.size.offset,g.vvSizeFactor=b.size.factor):b&&f&&(g.vvSizeValue=c.transformation.scale);if(b&&f){g.vvSymbolAnchor=c.transformation.anchor;g.vvSymbolRotationMatrix=a.mat3f64.create();
e.mat4.identity(H);var k=c.transformation.rotation[2],f=c.transformation.rotation[0],m=c.transformation.rotation[1];c=H;void 0===c&&(c=d.mat4f64.create());k=k||0;f=f||0;m=m||0;0!==k&&e.mat4.rotateZ(c,c,-k/180*Math.PI);0!==f&&e.mat4.rotateX(c,c,f/180*Math.PI);0!==m&&e.mat4.rotateY(c,c,m/180*Math.PI);h.mat3.fromMat4(g.vvSymbolRotationMatrix,H)}b&&b.color&&(g.vvColorEnabled=!0,g.vvColorValues=b.color.values,g.vvColorColors=b.color.colors);b&&b.opacity&&(g.vvOpacityEnabled=!0,g.vvOpacityValues=b.opacity.values,
g.vvOpacityOpacities=b.opacity.opacityValues);return g}Object.defineProperty(b,"__esModule",{value:!0});b.convertVisualVariables=G;b.initFastSymbolUpdatesState=function(a,b){return!a||g.DISABLE_FAST_UPDATES?{enabled:!1}:(a=G(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:I(a,b),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};b.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=G(b.visualVariables,c);if(!(b&&J(d.size,
b.size,"size")&&J(d.color,b.color,"color")&&J(d.rotation,b.rotation,"rotation")&&J(d.opacity,b.opacity,"opacity")))return!1;a.visualVariables=b;a.materialParameters=I(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};b.getMaterialParams=I;var K;(function(a){var b=d.mat4f64.create(),c=n.vec3f64.create();a.evaluateModelTransform=function(a,d,g){if(!a.vvSizeEnabled)return g;e.mat4.copy(b,g);g=a.vvSymbolRotationMatrix;e.mat4.set(H,g[0],g[1],g[2],0,g[3],g[4],g[5],0,g[6],g[7],g[8],0,0,0,0,1);
e.mat4.multiply(b,b,H);for(g=0;3>g;++g)c[g]=f.clamp(a.vvSizeOffset[g]+d[0]*a.vvSizeFactor[g],a.vvSizeMinSize[g],a.vvSizeMaxSize[g]);e.mat4.scale(b,b,c);e.mat4.translate(b,b,a.vvSymbolAnchor);return b};a.evaluateModelTransformScale=function(a,b,c){if(!b.vvSizeEnabled)return k.vec3.set(a,1,1,1);for(var d=0;3>d;++d)a[d]=f.clamp(b.vvSizeOffset[d]+c[0]*b.vvSizeFactor[d],b.vvSizeMinSize[d],b.vvSizeMaxSize[d]);return a}})(K||(K={}));var H=d.mat4f64.create();b.evaluateModelTransform=K.evaluateModelTransform;
b.evaluateModelTransformScale=K.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./geometryDataUtils ./HighlightUtils ./Util".split(" "),function(q,b,l,f,h,a,e,d,k,n,c){return function(){function b(b,c,d,e,g,f,k,h,n,l){this.shaderTransformationDirty=
!0;this.data=b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=c;this.material=d;this.origin=null;this.center=a.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=g;e&&this.updateTransformation(e,f);this.castShadow=k;this.name=h;this.uniqueName=n;this.idx=l;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};
b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};b.prototype.getBoundingSphere=function(a,b,c){b=b||e.maxScale(a);h.vec3.transformMat4(c,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentCount",{get:function(){return d.componentCount(this.componentOffsets)},
enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return this.transformation;this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=f.mat4f64.create()),l.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1);return this.shaderTransformation};b.prototype.computeAttachmentOrigin=function(a){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
a)?(h.vec3.transformMat4(a,a,this.transformation),!0):!1;var b=this.getIndices(c.VertexAttrConstants.POSITION),d=this.getAttribute(c.VertexAttrConstants.POSITION);return k.computeAttachmentOriginTriangles(d,b,a)?(h.vec3.transformMat4(a,a,this.transformation),!0):!1};b.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};b.prototype.getAttribute=function(a){return"vertexAttr"in this.data?this.data.vertexAttr[a]:null};b.prototype.addHighlight=function(a){var b=n.generateHighlightId(),
c=this.instanceParameters;c.componentHighlights=d.addHighlight(c.componentHighlights,null,a,b);return b};b.prototype.removeHighlight=function(a){var b=this.instanceParameters;b.componentHighlights=d.removeHighlight(b.componentHighlights,a)};return b}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestUtils ../../support/imageUtils ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C){return function(){function b(a,c,d){this.data=a;this.loadingController=this.loadingPromise=this.powerOfTwoStretchInfo=this.glTexture=null;this.events=new e;this.data=a;this.id=b.idGen.gen(c);this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=
this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=b.estimateTexMemRequired(this.data,this.params);this.startPreload()}b.prototype.startPreload=function(){var a=this.data;n.isNone(a)||(a instanceof HTMLVideoElement?this.startPreloadVideoElement(a):a instanceof HTMLImageElement&&this.startPreloadImageElement(a))};b.prototype.startPreloadVideoElement=function(a){r.isBlobProtocol(a.src)||"auto"===a.preload&&a.crossOrigin||(a.preload="auto",a.crossOrigin="anonymous",a.src=a.src)};b.prototype.startPreloadImageElement=
function(a){r.isDataProtocol(a.src)||r.isBlobProtocol(a.src)||a.crossOrigin||(a.crossOrigin="anonymous",a.src=a.src)};b.getDataDimensions=function(a){return a instanceof HTMLVideoElement?{width:a.videoWidth,height:a.videoHeight}:a};b.estimateTexMemRequired=function(a,c){if(n.isNone(a))return 0;if(g.isArrayBuffer(a)||g.isUint8Array(a))return a.byteLength;a=a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?b.getDataDimensions(a):c;return(c.mipmap?
4/3:1)*a.width*a.height*(c.components||4)||0};b.prototype.dispose=function(){this.data=void 0};Object.defineProperty(b.prototype,"width",{get:function(){return this.params.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this.params.height},enumerable:!0,configurable:!0});b.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?
9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?a.parameters.maxMaxAnisotropy:void 0}};b.prototype.load=function(a,c){if(n.isSome(this.glTexture))return this.glTexture;if(n.isSome(this.loadingPromise))return this.loadingPromise;var d=this.data;if(n.isNone(d))return this.glTexture=new A(a,this.createDescriptor(a),null),a.bindTexture(this.glTexture),this.glTexture;if("string"===typeof d)return this.loadFromURL(a,
c,d);if(d instanceof Image)return this.loadFromImageElement(a,c,d);if(d instanceof HTMLVideoElement)return this.loadFromVideoElement(a,c,d);if(d instanceof ImageData||d instanceof HTMLCanvasElement)return this.loadFromImage(a,d,c);if((g.isArrayBuffer(d)||g.isUint8Array(d))&&this.params.encoding===b.DDS_ENCODING)return this.loadFromDDSData(a,d);if(g.isUint8Array(d))return this.loadFromPixelData(a,d);if(g.isArrayBuffer(d))return this.loadFromPixelData(a,new Uint8Array(d));h.neverReachedSilent(d);return null};
Object.defineProperty(b.prototype,"requiresFrameUpdates",{get:function(){return this.data instanceof HTMLVideoElement},enumerable:!0,configurable:!0});b.prototype.frameUpdate=function(a,b,c){if(!(this.data instanceof HTMLVideoElement)||n.isNone(this.glTexture)||2>this.data.readyState||c===this.data.currentTime)return c;if(n.isSome(this.powerOfTwoStretchInfo)){var d=this.powerOfTwoStretchInfo;c=d.framebuffer;var e=d.vao,d=d.sourceTexture;d.setData(this.data);this.drawStretchedTexture(a,b,c,e,d,this.glTexture)}else b=
this.data,a=b.width,b=b.height,e=this.glTexture.descriptor,c=e.width,e=e.height,a!==c||b!==e?this.glTexture.updateData(0,0,0,Math.min(a,c),Math.min(b,e),this.data):this.glTexture.setData(this.data);this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};b.prototype.loadFromDDSData=function(a,b){this.glTexture=t.createDDSTexture(a,this.createDescriptor(a),b,this.params.mipmap);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadFromPixelData=
function(a,b){m.assert(0<this.params.width&&0<this.params.height);var c=this.createDescriptor(a);c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;c.width=this.params.width;c.height=this.params.height;this.glTexture=new A(a,c,b);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.loadAsync=function(a){return f(this,void 0,void 0,function(){var b,d,e,g=this;return l(this,function(f){this.loadingController=b=c.createAbortController();this.loadingPromise=
d=a(b.signal);e=function(){g.loadingController===b&&(g.loadingController=null);g.loadingPromise===d&&(g.loadingPromise=null)};d.then(e,e);return[2,d]})})};b.prototype.loadFromURL=function(a,b,c){var d=this;return this.loadAsync(function(e){return f(d,void 0,void 0,function(){var d;return l(this,function(g){switch(g.label){case 0:return[4,u.requestImage(c,{signal:e})];case 1:return d=g.sent(),[2,this.loadFromImage(a,d,b)]}})})})};b.prototype.loadFromImageElement=function(a,b,c){var d=this;return c.complete?
this.loadFromImage(a,c,b):this.loadAsync(function(e){return f(d,void 0,void 0,function(){var d;return l(this,function(g){switch(g.label){case 0:return[4,p.loadImageAsync(c,c.src,!1,e)];case 1:return d=g.sent(),[2,this.loadFromImage(a,d,b)]}})})})};b.prototype.loadFromVideoElement=function(a,b,c){return 2<=c.readyState?this.loadFromImage(a,c,b):this.loadFromVideoElementAsync(a,b,c)};b.prototype.loadFromVideoElementAsync=function(b,d,e){var g=this;return this.loadAsync(function(f){return c.create(function(k,
h){var m=function(){e.removeEventListener("loadeddata",p);e.removeEventListener("error",l);n.isSome(r)&&r.remove()},p=function(){2<=e.readyState&&(m(),k(g.loadFromImage(b,e,d)))},l=function(b){m();h(b||new a("Failed to load video"))};e.addEventListener("loadeddata",p);e.addEventListener("error",l);var r=c.onAbort(f,l)})})};b.prototype.loadFromImage=function(a,c,d){var e=b.getDataDimensions(c);this.params.width=e.width;this.params.height=e.height;var g=this.createDescriptor(a);g.pixelFormat=3===this.params.components?
6407:6408;if(this.requiresPowerOfTwo(a,g)&&(!k.isPowerOfTwo(e.width)||!k.isPowerOfTwo(e.height)))return this.glTexture=this.makePowerOfTwoTexture(a,c,e,g,d),a.bindTexture(this.glTexture),this.glTexture;g.width=e.width;g.height=e.height;this.glTexture=new A(a,g,c);a.bindTexture(this.glTexture);return this.glTexture};b.prototype.requiresPowerOfTwo=function(a,b){var c="number"===typeof b.wrapMode?33071===b.wrapMode:33071===b.wrapMode.s&&33071===b.wrapMode.t;return!C.default(a.gl)&&(b.hasMipmap||!c)};
b.prototype.makePowerOfTwoTexture=function(a,b,c,e,g){var f=c.width;c=c.height;var k=d.nextHighestPowerOfTwo(f),m=d.nextHighestPowerOfTwo(c);e.width=k;e.height=m;var p;switch(this.params.powerOfTwoResizeMode){case 2:e.textureCoordinateScaleFactor=[f/k,c/m];p=new A(a,e);p.updateData(0,0,0,f,c,b);break;case 1:case null:case void 0:p=this.stretchToPowerOfTwo(a,b,e,g);break;default:h.neverReached(this.params.powerOfTwoResizeMode)}e.hasMipmap&&p.generateMipmap();return p};b.prototype.stretchToPowerOfTwo=
function(a,b,c,d){var e=new A(a,c),g=new w(a,{colorTarget:0,depthStencilTarget:0},e);b=new A(a,{target:3553,pixelFormat:c.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!c.flipped,maxAnisotropy:8,preMultiplyAlpha:c.preMultiplyAlpha},b);c=v.createQuadVAO(a,x.Pos3Tex);this.drawStretchedTexture(a,d,g,c,b,e);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:c,sourceTexture:b,framebuffer:g}:(c.dispose(!0),b.dispose(),g.detachColorTexture(),a.bindFramebuffer(null),g.dispose());
return e};b.prototype.drawStretchedTexture=function(a,b,c,d,e,g){a.bindFramebuffer(c);c=a.getViewport();a.setViewport(0,0,g.descriptor.width,g.descriptor.height);g=b.program;a.bindProgram(g);g.setUniform4f("color",1,1,1,1);g.setUniform1i("tex",0);a.bindTexture(e,0);a.bindVAO(d);a.setPipelineState(b.pipeline);a.drawArrays(5,0,B.vertexCount(d,"geometry"));a.bindFramebuffer(null);a.setViewport(c.x,c.y,c.width,c.height)};b.prototype.unload=function(){if(n.isSome(this.powerOfTwoStretchInfo)){var a=this.powerOfTwoStretchInfo,
b=a.framebuffer,c=a.sourceTexture;a.vao.dispose(!0);c.dispose();b.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}n.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);n.isSome(this.loadingController)&&(a=this.loadingController,this.loadingPromise=this.loadingController=null,a.abort());this.events.emit("unloaded")};b.idGen=new y.IdGen;b.DDS_ENCODING="image/vnd-ms.dds";return b}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../../core/Logger",
"../../../../core/mathUtils","../../../webgl/Texture"],function(q,b,l,f,h){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function e(a,b){var e=new Int32Array(a,0,31);if(542327876!==e[0])return d.error("Invalid magic number in DDS header"),null;if(!(e[20]&4))return d.error("Unsupported format, must contain a FourCC code"),null;var g=e[21],h;switch(g){case k:g=8;h=33776;break;case n:g=16;h=33778;break;case c:g=16;h=33779;break;default:return d.error("Unsupported FourCC code:",
String.fromCharCode(g&255,g>>8&255,g>>16&255,g>>24&255)),null}var l=1,r=e[4],y=e[3];if(0!==(r&3)||0!==(y&3))d.warn("Rounding up compressed texture size to nearest multiple of 4."),r=r+3&-4,y=y+3&-4;var m=r,w=y;e[2]&131072&&!1!==b&&(l=Math.max(1,e[7]));1===l||f.isPowerOfTwo(r)&&f.isPowerOfTwo(y)||(d.warn("Ignoring mipmaps of non power of two sized compressed texture."),l=1);for(var A=e[1]+4,B=[],C=0;C<l;++C)e=(r+3>>2)*(y+3>>2)*g,b=new Uint8Array(a,A,e),B.push(b),A+=e,r=Math.max(1,r>>1),y=Math.max(1,
y>>1);return{textureData:{type:"compressed",levels:B},internalFormat:h,width:m,height:w}}Object.defineProperty(b,"__esModule",{value:!0});var d=l.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),k=a("DXT1"),n=a("DXT3"),c=a("DXT5");b.createDDSTexture=function(a,b,c,d){var g=e(c,d);c=g.textureData;d=g.internalFormat;var f=g.width,g=g.height;b.samplingMode=1<c.levels.length?9987:9729;b.hasMipmap=1<c.levels.length;b.internalFormat=d;b.width=f;b.height=g;b=new h(a,b,c);a.bindTexture(b);return b};b.createDDSTextureData=
e})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./lineUtils ../support/FastSymbolUpdates ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function q(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._uniformSize=1;return a}l(q,b);q.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var a;return f(this,function(b){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};
this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?A.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){a=null!=this.symbolLayer.size?this.symbolLayer.size:c.px2pt(1);if(0>a)throw new k("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=a}return[2]})})};q.prototype.getMaterialParameters=function(b){var d=
this._getCombinedOpacityAndColor(n.get(this.symbolLayer,"material","color"));b={width:1,color:d,polygonOffset:!0,join:this.symbolLayer.join||"miter",cap:this.symbolLayer.cap||"butt",transparent:1>d[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:b,stipplePattern:this.symbolLayer.stipplePattern?G.createStipplePattern(this.symbolLayer.stipplePattern.map(c.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?e.toUnitRGBA(this.symbolLayer.stippleOffColor):
null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(b.width=c.pt2px(1)):(d=null!=this.symbolLayer.size?this.symbolLayer.size:c.px2pt(1),b.width=c.pt2px(d));return this._fastUpdates&&this._fastUpdates.visualVariables?a({},b,this._fastUpdates.materialParameters):b};Object.defineProperty(q.prototype,"lineMaterial",{get:function(){n.isNone(this._lineMaterial)&&(this._lineMaterial=new J(this.getMaterialParameters(!1),this._getIdHint("_ribbonlinemat")),
this._context.stage.add(3,this._lineMaterial));return this._lineMaterial},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"ringMaterial",{get:function(){n.isNone(this._ringMaterial)&&(this._ringMaterial=new J(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial));return this._ringMaterial},enumerable:!0,configurable:!0});q.prototype.destroy=function(){b.prototype.destroy.call(this);n.isSome(this._lineMaterial)&&(this._context.stage.remove(3,
this._lineMaterial.id),this._lineMaterial=null);n.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)};q.prototype.getDrivenSize=function(a){return this._drivenProperties.size&&a.size?c.pt2px(u.getDriverAxisSizeValue(a.size)):1};q.prototype.getSizeFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?m.getAttributeValue(this._fastUpdates.visualVariables.size.field,a):null};q.prototype.getDrivenColor=
function(a){var b=r.vec4f64.fromValues(1,1,1,1);this._drivenProperties.color&&a.color&&(b[0]=a.color[0],b[1]=a.color[1],b[2]=a.color[2],0<a.color.length&&(b[3]=a.color[3]));this._drivenProperties.opacity&&a.opacity&&(b[3]=a.opacity);return b};q.prototype.getColorFeatureAttributeData=function(a){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?m.getAttributeValue(this._fastUpdates.visualVariables.color.field,a):null};q.prototype.getOpacityFeatureAttributeData=function(a){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.opacity?m.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,a):null};q.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,c=b.geometry;if(!this._validateGeometryType(b.geometry,q.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(c))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(a,c,this._context.layer.uid):this._createAs3DShape(a,d,c,b.uid)};q.prototype.applyRendererDiff=
function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(A.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))n.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),n.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};q.prototype.layerOpacityChanged=function(){n.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);
n.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};q.prototype.updateMaterialLayerOpacity=function(a){var b=a.getParameters().color,c=n.get(this.symbolLayer,"material","color"),c=this._getCombinedOpacity(c);a.setParameterValues({color:[b[0],b[1],b[2],c],transparent:1>c||this.needsDrivenTransparentPass})};q.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=x.elevationModeChangeUpdateType(q.elevationModeChangeTypes,c,d);
if(c!==x.SymbolUpdateType.UPDATE)return c;var e=x.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};q.prototype.slicePlaneEnabledChanged=function(){n.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});n.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};q.prototype.physicalBasedRenderingChanged=function(){return!0};
q.prototype.pixelRatioChanged=function(){return!0};q.prototype._getGeometryAsPolygonOrPolyline=function(a){switch(a.type){case "extent":if(a instanceof d.Extent)return d.Polygon.fromExtent(a);break;case "polygon":case "polyline":return a}return null};q.prototype._createAs3DShape=function(a,b,c,d){var e=this._getGeometryAsPolygonOrPolyline(a.graphic.geometry),f="polygon"===e.type?e.rings:e.paths,k=[],h=[],m=[],l=p.create(),r=w.geometryToRenderInfo(e,this._context.elevationProvider,this._context.renderCoordsHelper,
b);this._logGeometryCreationWarnings(r,f,"polygon"===e.type?"rings":"paths","LineSymbol3DLayer");for(f=0;f<r.lines.length;f++){var v=r.lines[f],A=v.position,v=v.mapPosition;if(n.isSome(this._context.clippingExtent)&&(p.empty(l),p.expandWithBuffer(l,v),!p.intersectsClippingArea(l,this._context.clippingExtent)))continue;A=this._createGeometryData(a,A,v,e.type);A=new B(A,c+"path"+f);k.push(A);h.push("polygon"===e.type?this.ringMaterial:this.lineMaterial);m.push(g.mat4f64.IDENTITY)}if(0===k.length)return null;
a=new C({geometries:k,materials:h,transformations:m,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:d},idHint:c});k=new y(this,a,k,null,null,t.perVertexElevationAligner,b);k.alignedSampledElevation=r.sampledElevation;k.needsElevationUpdates=x.needsElevationUpdates2D(b.mode);return k};q.prototype._createGeometryData=function(a,b,c,d){var e=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return w.createGeometryData({removeDuplicateStartEnd:"polygon"===d?1:0,uniformSize:this._uniformSize,
attributeData:{position:b,mapPosition:c,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(a.renderingInfo),color:e?null:this.getDrivenColor(a.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(a.graphic),colorFeature:this.getColorFeatureAttributeData(a.graphic),opacityFeature:this.getOpacityFeatureAttributeData(a.graphic)}})};q.prototype._createAsOverlay=function(a,b,c){var d=a.graphic,e=this._getGeometryAsPolygonOrPolyline(d.geometry),f="polygon"===
e.type?e.rings:e.paths,k="polygon"===e.type?this.ringMaterial:this.lineMaterial;k.renderPriority=this._renderPriority;var h=[],m=p.create(),n=p.empty(),l=w.geometryToRenderInfoDraped(e,this._context.overlaySR);this._logGeometryCreationWarnings(l,f,"polygon"===e.type?"rings":"paths","LineSymbol3DLayer");if(0<f.length){f=l.lines;for(l=0;l<f.length;++l){var r=f[l];p.empty(m);p.expandWithBuffer(m,r.position);if(p.intersectsClippingArea(m,this._context.clippingExtent)){p.expand(n,m);var r=this._createGeometryData(a,
r.position,null,e.type),t=new E(r);t.data.layerUid=c;t.data.graphicUid=d.uid;t.material=k;t.center=[.5*(m[0]+m[3]),.5*(m[1]+m[4]),0];t.bsRadius=.5*Math.sqrt((m[3]-m[0])*(m[3]-m[0])+(m[4]-m[1])*(m[4]-m[1]));t.transformation=g.mat4f64.create();t.name=b;t.uniqueName=b+"#"+r.id;h.push(t)}}return new v(this,h,n)}return null};q.validGeometryTypes=["polyline","polygon","extent"];q.elevationModeChangeTypes={definedChanged:x.SymbolUpdateType.RECREATE,staysOnTheGround:x.SymbolUpdateType.NONE,onTheGroundChanged:x.SymbolUpdateType.RECREATE};
return q}(m.Graphics3DSymbolLayer);b.Graphics3DLineSymbolLayer=q;b.default=q})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/mathUtils ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/triangulationUtils ./constants ./elevationAlignmentUtils ../../support/projectionUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/GeometryData ../../webgl-engine/shaders/RibbonLineTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(a,b,c){for(var d=[],e=0;e<a.length;e++){var g=a[e],f=g.count;1>=f||(g=3*g.index,f=g+3*f,d.push({position:b.subarray(g,f),mapPosition:c?c.subarray(g,f):void 0}))}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createGeometryData=function(b){for(var c={},d={},g=b.attributeData.position,k=b.removeDuplicateStartEnd,m=g.length,l=g[0]===g[m-3]&&g[1]===g[m-2]&&g[2]===g[m-1]&&1===k,k=g.length/3-(l?1:0),m=new Uint32Array(2*(k-1)),g=l?a.slice(g,
0,g.length-3):g,r=l=0;r<k-1;r++)m[l++]=r,m[l++]=r+1;d[u.RibbonVertexAttributeConstants.POSITION]={size:3,data:g,offsetIdx:0,strideIdx:3};c[u.RibbonVertexAttributeConstants.POSITION]=m;k=new Uint32Array(c[u.RibbonVertexAttributeConstants.POSITION].length);m=b.attributeData.mapPosition;h.isNone(m)||(c.mapPos=c[u.RibbonVertexAttributeConstants.POSITION],d.mapPos={size:3,data:m,offsetIdx:0,strideIdx:3});h.isSome(b.attributeData.colorFeature)||(d[u.RibbonVertexAttributeConstants.COLOR]={size:4,data:h.unwrapOr(b.attributeData.color,
n.WHITE_UNIT),offsetIdx:0,strideIdx:4},c[u.RibbonVertexAttributeConstants.COLOR]=k);h.isSome(b.attributeData.sizeFeature)||(d[u.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([h.unwrapOr(b.attributeData.size,1)]),offsetIdx:0,strideIdx:1},c[u.RibbonVertexAttributeConstants.SIZE]=k);m=b.attributeData.colorFeature;h.isNone(m)||(d[u.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},c[u.RibbonVertexAttributeConstants.COLOR]=
k);m=b.attributeData.sizeFeature;h.isNone(m)||(d[u.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},c[u.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=k);m=b.attributeData.opacityFeature;h.isNone(m)||(d[u.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([m]),offsetIdx:0,strideIdx:1},c[u.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=k);if("round"===b.join){k=d[u.RibbonVertexAttributeConstants.POSITION].data;
m=k.length/3;g=new Float32Array(m);l=x;r=v;e.vec3.set(l,0,0,0);b=h.unwrapOr(b.uniformSize,1);for(var t=-1;t<m;++t){var q=0>t?m+t:t,H=(t+1)%m;e.vec3.set(r,k[3*H+0]-k[3*q+0],k[3*H+1]-k[3*q+1],k[3*H+2]-k[3*q+2]);e.vec3.normalize(r,r);0<=t&&(q=1*(Math.PI-f.acosClamped(e.vec3.dot(l,r)))*y*(1.863798+-2.0062872/Math.pow(1+b/18.2313,.8856294)),g[t]=Math.max(Math.floor(q),0));e.vec3.scale(l,r,-1)}d[u.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:g,offsetIdx:0,strideIdx:1};c[u.RibbonVertexAttributeConstants.SUBDIVISIONS]=
c[u.RibbonVertexAttributeConstants.POSITION]}return new p.GeometryData(d,c,p.GeometryData.DefaultOffsets,"line")};b.geometryToRenderInfo=function(a,b,d,e){var g=k.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,a.hasZ,"polygon"===a.type?1:0),f=g.position,g=g.outlines,h=new Float64Array(f.length);a=c.applyPerVertexElevationAlignment(f,a.spatialReference,0,h,0,f,0,f.length/3,b,d,e);b=null!=a;return{lines:b?t(g,f,h):[],projectionSuccess:b,sampledElevation:a}};b.geometryToRenderInfoDraped=
function(a,b){var c=k.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,!1,"polygon"===a.type?1:0),d=c.position,c=c.outlines;a=g.bufferToBuffer(d,a.spatialReference,0,d,b,0,d.length/3);for(b=2;b<d.length;b+=3)d[b]=r.DRAPED_Z;return{lines:a?t(c,d):[],projectionSuccess:a}};var x=d.vec3f64.create(),v=d.vec3f64.create(),y=4/Math.PI})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q){Object.defineProperty(b,"__esModule",{value:!0});var T=S.VertexAttrConstants;q=function(b){function c(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._materials=new Map;a._textures=new Map;return a}l(c,b);c.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return f(this,function(a){J.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new O({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=
new O({color:[0,1,1,1]},"debugFAceNormal"));return[2]})})};c.prototype.destroy=function(){var a=this;b.prototype.destroy.call(this);this._materials.forEach(function(b){a._context.stage.remove(3,b.material.id)});this._textures.forEach(function(b){a._context.stage.remove(4,b.id)});this._materials.clear();this._textures.clear()};c.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,c.validGeometryTypes,"fill on mesh-3d")||!this._validateGeometry(b.geometry))return null;
var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,e,d,b.uid)};c.prototype.layerOpacityChanged=function(a,b){var c=this,d=this._getLayerOpacity();this._materials.forEach(function(a){a.material.setParameterValues({layerOpacity:d});var b=a.material.getParameters();c._setMaterialTransparentParameter(b,a);a.material.setParameterValues({transparent:b.transparent})});a.forEach(function(a){a=b(a);k.isSome(a)&&a.layerOpacityChanged(d,c._context.isAsync)});
return!0};c.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,A.needsElevationUpdates3D)};c.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._materials.forEach(function(a){a.material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});a.forEach(function(a){a=b(a);k.isSome(a)&&a.slicePlaneEnabledChanged(c._context.slicePlaneEnabled,c._context.isAsync)});return!0};c.prototype.physicalBasedRenderingChanged=function(){var a=
this;this._materials.forEach(function(b){b.material.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled})});return!0};c.prototype.pixelRatioChanged=function(){return!0};c.prototype._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};c.prototype._colorOrTextureUid=function(a){return a?a instanceof e?a.toHex():a.contentHash:"-"};c.prototype._materialProperties=function(a,b,c){var d=this._requiresSymbolVertexColors(),e,g,f,k,h,m,
p,n,l;b.material&&(g=b.material.color,e=this._colorOrTextureUid(b.material.color),f=b.material.colorTexture,k=this._colorOrTextureUid(b.material.colorTexture),h=b.material.normalTexture,m=this._colorOrTextureUid(b.material.normalTexture),p=b.material.doubleSided,n=b.material.alphaCutoff,l=b.material.alphaMode);b=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:d,hasVertexColors:b,hasVertexTangents:a,color:g,colorTexture:f,normalTexture:h,uid:"vc:"+b+",vt:"+a+
",vct"+c+",svc:"+d+",cmuid:"+e+",ctmuid:"+k+",ntmuid:"+m+",ds:"+p+",ac:"+n+",am:"+l}};c.prototype._setInternalColorValueParameters=function(a,b){b.diffuse=e.toUnitRGB(a);b.opacity=a.a};c.prototype._getLoadableTextureResource=function(a){return a.data?a.data:a.url};c.prototype._getInternalTextureId=function(a,b){var c=this._getLoadableTextureResource(a);if(c){var d=a.contentHash,e=this._textures.get(d);e||(e=new P(c,b+"_"+d+"_tex",{mipmap:!0,wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0}),this._textures.set(d,
e),this._context.stage.add(4,e));return e.id}};c.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};c.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};c.prototype._setInternalMaterialParameters=function(a,b,c){a.color&&this._setInternalColorValueParameters(a.color,
c);a.colorTexture&&(c.textureId=this._getInternalTextureId(a.colorTexture,b));a.normalTexture&&(c.normalTextureId=this._getInternalTextureId(a.normalTexture,b))};c.prototype._setExternalMaterialParameters=function(a){var b=this._drivenProperties.color,c=k.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;b?a.externalColor=t.vec4f64.ONES:(b=k.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,k.isSome(b)?a.externalColor=e.toUnitRGBA(b):(c=null,a.externalColor=
t.vec4f64.ONES));c&&(a.colorMixMode=c)};c.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};c.prototype._getOrCreateMaterial=function(b,c){var d=c.material&&c.material.color,e=c.material&&c.material.colorTexture,g=c.material&&"blend"===c.material.alphaMode,d=!(c.material&&"opaque"===c.material.alphaMode)&&(this._hasTransparentVertexColors(b)||d&&1>d.a||e&&e.transparent||g);b=this._materialProperties(b,
c,d);if(e=this._materials.get(b.uid))return e.material;d={material:null,isComponentTransparent:d,alphaMode:c.material?c.material.alphaMode:"opaque"};e=this._getIdHint();g=a({},Q.getDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{vertexColors:b.hasVertexColors,symbolColors:b.hasSymbolVertexColors,vertexTangents:b.hasVertexTangents,ambient:u.vec3f64.ZEROS,diffuse:u.vec3f64.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,layerOpacity:this._getLayerOpacity(),
slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0});c.material&&(g.doubleSided=c.material.doubleSided,g.cullFace=c.material.doubleSided?0:2,g.textureAlphaCutoff=c.material.alphaCutoff);this._setInternalMaterialParameters(b,e,g);this._setExternalMaterialParameters(g);this._setMaterialTransparentParameter(g,d);c=new R(g,e+"_"+b.uid+"_mat");d.material=c;this._materials.set(b.uid,d);this._context.stage.add(3,c);return c};c.prototype._setMaterialTransparentParameter=function(a,
b){a.transparent=this.needsDrivenTransparentPass||b.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===b.alphaMode?a.transparent?"maskBlend":"opaque":b.alphaMode};c.prototype._addDebugNormals=function(a,b,c,d){var e,g,f,k,h=b.length,m=a.spatialReference.isGeographic?20015077/180:1,n=.1*Math.max(a.extent.width*m,a.extent.height*m,a.extent.zmax-a.extent.zmin),l=[],w=[];a=[];for(var m=[],t=0;t<h;t++)for(var v=b[t],y=v.data.getAttribute(T.POSITION),
x=v.data.getAttribute(T.NORMAL),A=v.data.getIndices(T.POSITION),v=v.data.getIndices(T.NORMAL),y=y.data,x=x.data,u=0;u<A.length;u++){for(var B=3*A[u],C=3*v[u],q=0;3>q;q++)l.push(y[B+q]);for(q=0;3>q;q++)l.push(y[B+q]+x[C+q]*n);w.push(w.length);w.push(w.length);if(0===u%3){this._calculateFaceNormal(y,A,u,aa);this._getFaceVertices(y,A,u,N,Z,W);p.vec3.add(N,N,Z);p.vec3.add(N,N,W);p.vec3.scale(N,N,1/3);for(q=0;3>q;q++)a.push(N[q]);for(q=0;3>q;q++)a.push(N[q]+aa[q]*n);m.push(m.length);m.push(m.length)}}h=
(e={},e[T.POSITION]={data:new Float64Array(l),size:3},e);e=(g={},g[T.POSITION]=new Uint32Array(w),g);g=new H.GeometryData(h,e,void 0,"line");g=new K(g,"debugVertexNormal");b.push(g);c.push(this._debugVertexNormalMaterial);d.push(r.mat4f64.clone(d[0]));h=(f={},f[T.POSITION]={data:new Float64Array(a),size:3},f);e=(k={},k[T.POSITION]=new Uint32Array(m),k);g=new H.GeometryData(h,e,void 0,"line");g=new K(g,"debugFaceNormal");b.push(g);c.push(this._debugFaceNormalMaterial);d.push(r.mat4f64.clone(d[0]))};
c.prototype._createAs3DShape=function(a,b,c,d,e){a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,b,d);if(!g)return null;b=g.geometries;var f=g.materials,h=g.transformations,g=g.objectTransformation;J.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,f,h);e=new L({geometries:b,materials:f,transformations:h,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});e.objectTransformation=g;d=w.perObjectElevationAligner;h=this._createEdgeMaterial();
f=k.isSome(h)?{baseMaterial:f[0],edgeMaterials:[h],addObjectSettings:{mergeGeometries:!0},slicePlaneEnabled:this._context.slicePlaneEnabled}:null;b=new B(this,e,b,null,null,d,c,f);b.needsElevationUpdates=A.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;b.elevationContext.centerPointInElevationSR=c;b.alignedSampledElevation=d(b,b.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);return b};c.prototype._createComponentNormals=function(a,b,c,e){var g=
c.shading||"flat";switch(g){case "source":return this._createComponentNormalsSource(a,b,c,e);case "flat":return this._createComponentNormalsFlat(a,e);case "smooth":return this._createComponentNormalsSmooth(a,e);default:d.neverReached(g)}};c.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,d);var e=!1;if(!c.trustSourceNormals)for(c=0;c<d.length;c+=3){this._calculateFaceNormal(a,d,c,aa);for(var g=0;3>g;g++){var f=3*d[c+g];N[0]=b[f+0];N[1]=b[f+
1];N[2]=b[f+2];0>p.vec3.dot(aa,N)&&(b[f+0]=-b[f+0],b[f+1]=-b[f+1],b[f+2]=-b[f+2],e=!0)}}return{normals:b,indices:d,didFlipNormals:e}};c.prototype._createComponentNormalsFlat=function(a,b){for(var c=new Float32Array(b.length),d=new Uint32Array(3*b.length),e=0;e<b.length;e+=3)for(var g=this._calculateFaceNormal(a,b,e,aa),f=0;3>f;f++)c[e+f]=g[f],d[e+f]=e/3;return{normals:c,indices:d,didFlipNormals:!1}};c.prototype._createComponentNormalsSmooth=function(a,b){for(var c={},d=0;d<b.length;d+=3)for(var e=
this._calculateFaceNormal(a,b,d,aa),g=0;3>g;g++){var f=b[d+g],k=c[f];k||(k={normal:u.vec3f64.create(),count:0},c[f]=k);p.vec3.add(k.normal,k.normal,e);k.count++}a=new Float32Array(3*b.length);e=new Uint32Array(3*b.length);for(d=0;d<b.length;d++){f=b[d];k=c[f];1!==k.count&&(p.vec3.normalize(k.normal,k.normal),k.count=1);for(g=0;3>g;g++)a[3*d+g]=k.normal[g];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};c.prototype._getFaceVertices=function(a,b,c,d,e,g){var f=3*b[c+0],k=3*b[c+1];b=3*b[c+2];d[0]=
a[f+0];d[1]=a[f+1];d[2]=a[f+2];e[0]=a[k+0];e[1]=a[k+1];e[2]=a[k+2];g[0]=a[b+0];g[1]=a[b+1];g[2]=a[b+2]};c.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,N,Z,W);p.vec3.subtract(Z,Z,N);p.vec3.subtract(W,W,N);p.vec3.cross(N,Z,W);p.vec3.normalize(d,N);return d};c.prototype._getOrCreateComponents=function(a){return a.components?a.components:U};c.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);I.bufferToBuffer(a.vertexAttributes.position,
a.spatialReference,0,c,this._context.renderCoordsHelper.spatialReference,0,b.length/3);return c};c.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return m.projectNormalToECEF(c,d,b,a.spatialReference,e)};c.prototype._createTangentBuffer=function(a,b){var c=a.vertexAttributes.tangent;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;
var d=a.vertexAttributes.position,e=new Float32Array(c.length);return m.projectTangentToECEF(c,d,b,a.spatialReference,e)};c.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};c.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=G.parseColorMixMode(k.get(this.symbolLayer,"material","colorMixMode")),c=new Uint8Array(4);G.encodeSymbolColor(a,b,c);return c}return null};c.prototype._createColorIndices=function(a){a=
new Uint32Array(a.length);for(var b=0;b<a.length;b++)a[b]=0;return a};c.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,g=a.vertexAttributes.tangent;if(d&&d.length!==c.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(g&&g.length/
4!==c.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var g=this._createNormalBuffer(a,c),f=this._createTangentBuffer(a,c);a=this._transformCenterLocal(a,c,g);return{positionBuffer:c,
normalBuffer:g,tangentBuffer:f,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};c.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,e=this._context.renderCoordsHelper.spatialReference;Y[0]=d.x;Y[1]=d.y;Y[2]=0;d=r.mat4f64.create();I.computeLinearTransformation(a.spatialReference,Y,d,e);g.mat4.invert(V,d);for(a=0;a<b.length;a+=3)N[0]=b[a+0],N[1]=b[a+1],N[2]=b[a+2],p.vec3.transformMat4(N,N,V),b[a+0]=N[0],b[a+1]=N[1],b[a+2]=N[2];if(c)for(n.mat3.fromMat4(F,d),n.mat3.transpose(F,
F),a=0;a<c.length;a+=3)N[0]=c[a+0],N[1]=c[a+1],N[2]=c[a+2],p.vec3.transformMat3(N,N,F),c[a+0]=N[0],c[a+1]=N[1],c[a+2]=N[2];return d};c.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this.logger.warn("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};c.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};c.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),I.bufferToBuffer(a.vertexAttributes.position,
a.spatialReference,0,b,c,0,d));x.empty(ca);x.expandWithBuffer(ca,b,0,d);return!x.intersectsClippingArea(ca,this._context.clippingExtent)};c.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!y.canProject(a,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var g=this._createBuffers(a,b);if(!g)return null;b=g.positionBuffer;for(var f=g.uvBuffer,k=g.colorBuffer,
h=g.symbolColorBuffer,m=g.normalBuffer,p=g.tangentBuffer,g=g.objectTransformation,n=[],l=[],w=[],t=!1,v=0,x=this._getOrCreateComponents(a);v<x.length;v++){var A=x[v];if(!this._validateFaces(a,A))return null;var u=this._getOrCreateFaces(a,A);if(0!==u.length){var B=this._createComponentNormals(b,m,A,u);B.didFlipNormals&&(t=!0);var C=(d={},d[T.POSITION]={size:3,data:b},d[T.NORMAL]={size:3,data:B.normals},d),B=(e={},e[T.POSITION]=u,e[T.NORMAL]=B.indices,e);k&&(C[T.COLOR]={size:4,data:k},B[T.COLOR]=u);
h&&(C[T.SYMBOLCOLOR]={size:4,data:h},B[T.SYMBOLCOLOR]=this._createColorIndices(u));a.vertexAttributes.uv&&(C[T.UV0]={size:2,data:f},B[T.UV0]=u);a.vertexAttributes.tangent&&(C[T.TANGENT]={size:4,data:p},B[T.TANGENT]=u);u=new H.GeometryData(C,B);u=new K(u,c+"_mesh");n.push(u);l.push(r.mat4f64.create());w.push(this._getOrCreateMaterial(a,A))}}t&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:n,transformations:l,materials:w,objectTransformation:g}};c.prototype._createEdgeMaterial=function(){var a={opacity:this._getLayerOpacity()};return E.createMaterial(this.symbolLayer,a)};c.validGeometryTypes=["mesh"];return c}(C.default);b.Graphics3DMeshFillSymbolLayer=q;var Y=u.vec3f64.create(),N=u.vec3f64.create(),Z=u.vec3f64.create(),W=u.vec3f64.create(),aa=u.vec3f64.create(),V=r.mat4f64.create(),F=c.mat3f64.create(),ca=x.create(),U=[new v];b.default=q})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshVertexAttributes".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){var g=e.getLogger("esri.geometry.support.MeshComponent");return function(b){function e(a){a=b.call(this,a)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}l(e,b);h=e;e.from=function(a){return k.ensureClass(h,a)};e.prototype.castFaces=function(a){return c.castArray(a,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},g)};e.prototype.clone=function(){return new h({faces:a.clone(this.faces),shading:this.shading,material:a.clone(this.material),
trustSourceNormals:this.trustSourceNormals})};e.prototype.cloneWithDeduplication=function(b,c){return new h({faces:a.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(b,c):null,trustSourceNormals:this.trustSourceNormals})};var h;f([d.property({json:{write:!0}})],e.prototype,"faces",void 0);f([d.cast("faces")],e.prototype,"castFaces",null);f([d.property({type:n,json:{write:!0}})],e.prototype,"material",void 0);f([d.property({type:String,json:{write:!0}})],
e.prototype,"shading",void 0);f([d.property({type:Boolean})],e.prototype,"trustSourceNormals",void 0);return e=h=f([d.subclass("esri.geometry.support.MeshComponent")],e)}(d.declared(h))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./MeshTexture".split(" "),function(q,
b,l,f,h,a,e,d,k,n){return function(a){function b(b){b=a.call(this,b)||this;b.color=null;b.colorTexture=null;b.normalTexture=null;b.alphaMode="auto";b.alphaCutoff=.5;b.doubleSided=!0;return b}l(b,a);c=b;b.prototype.castColorTexture=function(a){return a?"string"===typeof a?new n({url:a}):a instanceof HTMLImageElement||a instanceof HTMLVideoElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new n({data:a}):k.ensureType(n,a):a};b.prototype.readColorTexture=function(a){if(a)return new n(a)};
b.prototype.castNormalTexture=function(a){return a?"string"===typeof a?new n({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData||a instanceof HTMLVideoElement?new n({data:a}):k.ensureType(n,a):a};b.prototype.readNormalTexture=function(a){if(a)return new n(a)};b.prototype.clone=function(){return new c({color:e.clone(this.color),colorTexture:e.clone(this.colorTexture),normalTexture:e.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,
doubleSided:this.doubleSided})};b.prototype.cloneWithDeduplication=function(a,b){var d=a.get(this);if(d)return d;b=new c({color:e.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(b):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(b):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided});a.set(this,b);return b};var c;f([d.property({type:h,json:{write:!0}})],b.prototype,"color",void 0);f([d.property({json:{write:!0}})],
b.prototype,"colorTexture",void 0);f([d.cast("colorTexture")],b.prototype,"castColorTexture",null);f([d.reader("colorTexture")],b.prototype,"readColorTexture",null);f([d.property({json:{write:!0}})],b.prototype,"normalTexture",void 0);f([d.cast("normalTexture")],b.prototype,"castNormalTexture",null);f([d.reader("normalTexture")],b.prototype,"readNormalTexture",null);f([d.property({json:{write:!0}})],b.prototype,"alphaMode",void 0);f([d.property({json:{write:!0}})],b.prototype,"alphaCutoff",void 0);
f([d.property({json:{write:!0}})],b.prototype,"doubleSided",void 0);return b=c=f([d.subclass("esri.geometry.support.MeshMaterial")],b)}(d.declared(a.JSONSupport))})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper @dojo/framework/shim/WeakMap ../../core/compilerUtils ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../views/support/screenshotUtils".split(" "),function(q,
b,l,f,h,a,e,d,k,n){var c=new h.default,g=0;return function(b){function e(a){a=b.call(this,a)||this;a.wrap="repeat";return a}l(e,b);h=e;Object.defineProperty(e.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});e.prototype.writeData=
function(a,b,c,e){a instanceof HTMLImageElement?a={type:"image-element",src:d.toJSON(a.src,e),crossOrigin:a.crossOrigin}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a=a instanceof HTMLVideoElement?{type:"video-element",src:d.toJSON(a.src,e),autoplay:a.autoplay,loop:a.loop,muted:a.muted,crossOrigin:a.crossOrigin,preload:a.preload}:{type:"image-data",imageData:this.encodeImageData(a)};b[c]=a};e.prototype.readData=
function(b){switch(b.type){case "image-element":var c=new Image;c.src=b.src;c.crossOrigin=b.crossOrigin;return c;case "canvas-element":return b=this.decodeImageData(b.imageData),c=document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").putImageData(b,0,0),c;case "image-data":return this.decodeImageData(b.imageData);case "video-element":return c=document.createElement("video"),c.src=b.src,c.crossOrigin=b.crossOrigin,c.autoplay=b.autoplay,c.loop=b.loop,c.muted=b.muted,
c.preload=b.preload,c;default:a.neverReached(b)}};Object.defineProperty(e.prototype,"transparent",{get:function(){var a=this.data,b=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):b&&(a=b.substr(b.length-4,4).toLowerCase(),b=b.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===b)?!0:!1},set:function(a){null!=a?this._override("transparent",
a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"contentHash",{get:function(){var a=this,b="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?this.wrap.horizontal+"/"+this.wrap.vertical:"",d=function(c){void 0===c&&(c="");return"d:"+c+",t:"+a.transparent+",w:"+b};if(null!=this.url)return d(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return d(this.data.src);c.has(this.data)||
c.set(this.data,++g);return d(c.get(this.data))}return d()},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new h({url:this.url,data:this.data,wrap:this.cloneWrap()})};e.prototype.cloneWithDeduplication=function(a){var b=a.get(this);if(b)return b;b=new h({url:this.url,data:this.data,wrap:this.cloneWrap()});a.set(this,b);return b};e.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};e.prototype.encodeImageData=
function(a){for(var b="",c=0;c<a.data.length;c++)b+=String.fromCharCode(a.data[c]);return{data:btoa(b),width:a.width,height:a.height}};e.prototype.decodeImageData=function(a){for(var b=atob(a.data),c=new Uint8ClampedArray(b.length),d=0;d<b.length;d++)c[d]=b.charCodeAt(d);return n.wrapImageData(c,a.width,a.height)};e.prototype.imageDataContainsTransparent=function(a){for(var b=3;b<a.data.length;b+=4)if(255!==a.data[b])return!0;return!1};var h;f([k.property({type:String,json:{write:d.write}})],e.prototype,
"url",null);f([k.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),k.property()],e.prototype,"data",null);f([k.writer("data")],e.prototype,"writeData",null);f([k.reader("data")],e.prototype,"readData",null);f([k.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],e.prototype,"transparent",null);f([k.property({json:{write:!0}})],e.prototype,"wrap",void 0);f([k.property({readOnly:!0,
dependsOn:["url","data","wrap","transparent"]})],e.prototype,"contentHash",null);return e=h=f([k.subclass("esri.geometry.support.MeshTexture")],e)}(k.declared(e.JSONSupport))})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/mathUtils"],function(q,b,l,f,h){function a(a,b){var d=a||{},e=d.format,g=d.quality,p=d.rotation,d=d.disableSlice,l=c(a,b.padding),r;r=b.width-l.left-l.right;b=b.height-l.top-
l.bottom;l={x:0,y:0,width:r,height:b};if(a&&a.area){null!=a.area.x&&(l.x=Math.floor(a.area.x));null!=a.area.y&&(l.y=Math.floor(a.area.y));var v=null!=a.area.width?Math.floor(a.area.width):null,y=null!=a.area.height?Math.floor(a.area.height):null;l.width=r-l.x;l.height=b-l.y;null!=v&&null!=y?(l.width=Math.min(l.width,v),l.height=Math.min(l.height,y)):null==v&&null!=y?(v=Math.min(l.width,v),l.height*=v/l.width,l.width=v):null!=v&&null==y&&(v=Math.min(l.height,y),l.width*=v/l.height,l.height=v)}l=n(l,
a);v=Math.floor(Math.max(l.x,0));y=Math.floor(Math.max(l.y,0));r={x:v,y:y,width:Math.floor(Math.min(l.width,r-v)),height:Math.floor(Math.min(l.height,b-y))};b=r.width/r.height;l=l.width/l.height;l!==b&&(l>b?(b=Math.floor(r.width/l),r={x:r.x,y:Math.floor(r.y+(r.height-b)/2),width:r.width,height:b}):(b=Math.floor(r.height*l),r={x:Math.floor(r.x+(r.width-b)/2),y:r.y,width:b,height:r.height}));l=k(a,r);b=l.width;l=l.height;a:switch(e){case "png":case "jpg":case "jpeg":break a;case null:case void 0:e=
u;break a;default:f.neverReached(e),e=u}v=t[e];g=h.clamp(null!=g?g:v,0,100);return{format:e,quality:g,area:r,width:b,height:l,rotation:p,disableSlice:!!d,ignoreBackground:!(!a||!a.ignoreBackground),ignorePadding:!(!a||!a.ignorePadding)}}function e(a,b){return a.toDataURL(p[b.format],b.quality/100)}function d(a,b,c){c||(g||(g=document.createElement("canvas"),g.width=1,g.height=1),c=g);return c.getContext("2d").createImageData(a,b)}function k(a,b){if(!a)return b;var c=a.width;a=a.height;if(null!=c&&
null!=a)return{width:Math.floor(c),height:Math.floor(a)};if(null==c&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(c),height:Math.floor(c/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function n(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;var c=a.width/a.height;if(c===b)return a;if(c<b)return b=Math.floor(a.height*b),a.x-=(b-a.width)/2,a.width=b,a;b=Math.floor(a.width/b);a.y-=(b-a.height)/2;a.height=b;return a}function c(a,b){return!b||a&&a.ignorePadding?
x:b}Object.defineProperty(b,"__esModule",{value:!0});b.completeUserSettings=a;b.toRenderSettings=function(b,d){var e=a(b,d),g=e.area,f=e.width/g.width,k=c(e,d.padding),h=k.left+k.right,p=k.top+k.bottom;return{framebufferWidth:Math.floor((d.width-h)*f+h),framebufferHeight:Math.floor((d.height-p)*f+p),region:{x:Math.floor(g.x*f)+k.left,y:Math.floor(g.y*f)+k.top,width:e.width,height:e.height},format:e.format,quality:e.quality,rotation:e.rotation,pixelRatio:f,layers:b&&b.layers?b.layers:[],disableSlice:e.disableSlice,
ignoreBackground:e.ignoreBackground,ignorePadding:e.ignorePadding}};b.encodeResult=function(a,b,c,d){if(d.premultipliedAlpha)for(var g=a.data,f=g.length,k=0;k<f;k+=4){var h=g[k+3];0<h&&(h/=255,g[k+0]/=h,g[k+1]/=h,g[k+2]/=h)}c.width=a.width;c.height=a.height;g=c.getContext("2d");g.putImageData(a,0,0);d.flipY&&(g.save(),g.globalCompositeOperation="copy",g.scale(1,-1),g.translate(0,-g.canvas.height),g.drawImage(g.canvas,0,0),g.restore());a=g.getImageData(0,0,a.width,a.height);b=e(c,b);c.width=0;c.height=
0;return{dataUrl:b,data:a}};b.toDataUrl=e;b.createEmptyImageData=function(a,b,c){if(!a||!b)throw Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(a,b)}catch(w){r=!1}return d(a,b,c)};b.wrapImageData=function(a,b,c,e){if(!b||!c)throw Error("Cannot construct image data without dimensions");if(r)try{return new ImageData(a,b,c)}catch(A){r=!1}b=d(b,c,e);b.data.set(a,0);return b};b.resampleHermite=function(a,b,c,d,e,g,f,k){void 0===d&&(d=0);void 0===e&&(e=0);void 0===
g&&(g=a.width-d);void 0===f&&(f=a.height-e);void 0===k&&(k=!1);var h=a.data,m=b.width,p=b.height,n=b.data;g/=m;f/=p;var l=Math.ceil(g/2),r=Math.ceil(f/2);a=a.width;for(var w=0;w<p;w++)for(var t=0;t<m;t++){for(var v=4*(t+(k?p-w-1:w)*m),y=0,x=0,u=0,A=0,B=0,C=0,q=(w+.5)*f,E=Math.floor(w*f);E<(w+1)*f;E++)for(var V=Math.abs(q-(E+.5))/r,F=(t+.5)*g,V=V*V,ca=Math.floor(t*g);ca<(t+1)*g;ca++){var U=Math.abs(F-(ca+.5))/l,U=Math.sqrt(V+U*U);if(!(1<=U)){var U=2*U*U*U-3*U*U+1,ea=4*(d+ca+(e+E)*a),C=C+U*h[ea+3],
x=x+U;!c&&255>h[ea+3]&&(U=U*h[ea+3]/255);u+=U*h[ea];A+=U*h[ea+1];B+=U*h[ea+2];y+=U}}n[v]=u/y;n[v+1]=A/y;n[v+2]=B/y;n[v+3]=C/x}return b};b.screenshotSuperSampleSettings=function(a,b,d){if(!b)return a;b=a.framebufferWidth;var e=a.framebufferHeight,g=a.pixelRatio,f=a.region;d=c(a,d);var k=d.left+d.right,h=d.top+d.bottom,m=b-k,p=e-h,n=Math.min(8,Math.min((2048-k)/m,(2048-h)/p));return 1.5>n?a:l({},a,{framebufferWidth:Math.round(m*n)+k,framebufferHeight:Math.round(p*n)+h,pixelRatio:g*n,resample:{region:{x:Math.round((f.x-
d.left)*n)+d.left,y:Math.round((f.y-d.top)*n)+d.top,width:Math.round(f.width*n),height:Math.round(f.height*n)},width:b,height:e}})};var g=null,r=!0,p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},u="jpg",t={png:100,jpg:98,jpeg:98},x={top:0,right:0,bottom:0,left:0}})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b,c,d){var e=b.loggerTag;b=b.stride;return 0!==a.length%b?(d.error(e,"Invalid array length, expected a multiple of "+b),new c([])):a}function n(a,b,c,d,e){if(!a)return a;if(a instanceof b)return k(a,d,b,e);for(var g=0;g<c.length;g++)if(a instanceof c[g])return k(new b(a),d,b,e);if(Array.isArray(a))return k(new b(a),d,b,e);c=c.map(function(a){return"'"+a.name+"'"});e.error("Failed to set property, expected one of "+c+", but got "+a.constructor.name);return new b([])}
function c(a,b,c){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];b[c]=d}Object.defineProperty(b,"__esModule",{value:!0});var g=e.getLogger("esri.geometry.support.MeshVertexAttributes");q=function(b){function e(a){a=b.call(this,a)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}l(e,b);k=e;e.prototype.castColor=function(a){return n(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},g)};e.prototype.castPosition=function(a){a&&
a instanceof Float32Array&&g.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return n(a,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},g)};e.prototype.castUv=function(a){return n(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},g)};e.prototype.castNormal=function(a){return n(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},g)};e.prototype.castTangent=
function(a){return n(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},g)};e.prototype.clone=function(){var b={position:a.clone(this.position),uv:a.clone(this.uv),normal:a.clone(this.normal),tangent:a.clone(this.tangent),color:a.clone(this.color)};return new k(b)};var k;f([d.property({json:{write:c}})],e.prototype,"color",void 0);f([d.cast("color")],e.prototype,"castColor",null);f([d.property({nonNullable:!0,json:{write:c}})],e.prototype,"position",void 0);f([d.cast("position")],e.prototype,
"castPosition",null);f([d.property({json:{write:c}})],e.prototype,"uv",void 0);f([d.cast("uv")],e.prototype,"castUv",null);f([d.property({json:{write:c}})],e.prototype,"normal",void 0);f([d.cast("normal")],e.prototype,"castNormal",null);f([d.property({json:{write:c}})],e.prototype,"tangent",void 0);f([d.cast("tangent")],e.prototype,"castTangent",null);return e=k=f([d.subclass("esri.geometry.support.MeshVertexAttributes")],e)}(d.declared(h.JSONSupport));b.MeshVertexAttributes=q;b.castArray=n;b.default=
q})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),function(q,b,l,f,h,a,e,d,k,n){function c(a,b,c,d,g,h){if(b){var m=c.count;if(g.isWGS84)for(g=0;g<m;g++)d.getVec(g,
r),b.getVec(g,p),k.computeLinearTransformation(k.SphericalECEFSpatialReference,r,u,k.SphericalECEFSpatialReference),f.mat3.fromMat4(t,u),1===a&&f.mat3.transpose(t,t),e.vec3.transformMat3(p,p,t),h.setVec(g,p);else for(g=0;g<m;g++){d.getVec(g,r);b.getVec(g,p);k.computeLinearTransformation(k.SphericalECEFSpatialReference,r,u,k.SphericalECEFSpatialReference);f.mat3.fromMat4(t,u);var n=k.webMercator.y2lat(c.get(g,1)),n=Math.cos(n);0===a&&(n=1/n);t[0]*=n;t[1]*=n;t[2]*=n;t[3]*=n;t[4]*=n;t[5]*=n;1===a&&f.mat3.transpose(t,
t);e.vec3.transformMat3(p,p,t);e.vec3.normalize(p,p);h.setVec(g,p)}return h}}Object.defineProperty(b,"__esModule",{value:!0});var g=l.getLogger("esri.geometry.support.meshUtils.normalProjection");b.projectNormalToECEF=function(a,b,d,e,f){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert PCS spatial reference buffer to ECEF"),f;c(0,n.BufferViewVec3f.fromTypedArray(a),n.BufferViewVec3f64.fromTypedArray(b),n.BufferViewVec3f64.fromTypedArray(d),e,n.BufferViewVec3f.fromTypedArray(f));return f};
b.projectNormalFromECEF=function(a,b,d,e,f){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert to PCS spatial reference buffer from ECEF"),f;c(1,n.BufferViewVec3f.fromTypedArray(a),n.BufferViewVec3f64.fromTypedArray(b),n.BufferViewVec3f64.fromTypedArray(d),e,n.BufferViewVec3f.fromTypedArray(f));return f};b.projectToECEF=function(a,b,c){k.bufferToBuffer(a,b,0,c,k.SphericalECEFSpatialReference,0,a.length/3);return c};b.projectFromECEF=function(a,b,c){k.bufferToBuffer(a,k.SphericalECEFSpatialReference,
0,b,c,0,a.length/3);return b};b.transformBufferInPlace=function(a,b,c){void 0===c&&(c=!1);if(a)for(var d=0;d<a.length;d+=3){for(var g=0;3>g;g++)r[g]=a[d+g];e.vec3.transformMat4(r,r,b);c&&e.vec3.normalize(r,r);for(g=0;3>g;g++)a[d+g]=r[g]}};b.projectTangentToECEF=function(a,b,d,e,f){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert PCS spatial reference buffer to ECEF"),f;c(0,n.BufferViewVec3f.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT),n.BufferViewVec3f64.fromTypedArray(b),n.BufferViewVec3f64.fromTypedArray(d),
e,n.BufferViewVec3f.fromTypedArray(f,4*Float32Array.BYTES_PER_ELEMENT));for(b=3;b<a.length;b+=4)f[b]=a[b];return f};b.projectTangentFromECEF=function(a,b,d,e,f){if(!e.isWebMercator&&!e.isWGS84)return g.error("Cannot convert to PCS spatial reference buffer from ECEF"),f;c(1,n.BufferViewVec3f.fromTypedArray(a,16),n.BufferViewVec3f64.fromTypedArray(b),n.BufferViewVec3f64.fromTypedArray(d),e,n.BufferViewVec3f.fromTypedArray(f,16));for(b=3;b<a.length;b+=4)f[b]=a[b];return f};var r=d.vec3f64.create(),p=
d.vec3f64.create(),u=a.mat4f64.create(),t=h.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports","../../../../core/mathUtils","../../../../core/maybe"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.parseColorMixMode=function(a){switch(a){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;default:return 1}};b.encodeSymbolColor=function(b,n,c){if(f.isNone(b)||2===n)c[0]=255,c[1]=255,
c[2]=255,c[3]=255;else{var g=l.clamp(Math.round(b[3]*a),0,a);n=0===g||4===n?0:3===n?e:d;c[0]=l.clamp(Math.round(b[0]*h),0,h);c[1]=l.clamp(Math.round(b[1]*h),0,h);c[2]=l.clamp(Math.round(b[2]*h),0,h);c[3]=g+n}};var h=255,a=85,e=a,d=2*a})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/BufferView ../lib/ComponentUtils ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLineTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){var B=h.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");q=function(b){function e(a,c){c=b.call(this,c)||this;c.techniqueConfig=new A.NativeLineTechniqueConfiguration;c.params=m.copyParameters(a,G);return c}l(e,b);e.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.parametersChanged()};e.prototype.getParameters=function(){return this.params};e.prototype.getTechniqueConfig=function(b){this.techniqueConfig.output=
b;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=1>this.params.color[3]||1>this.params.width;b=a.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=b;this.techniqueConfig.stippleOffColorEnabled=b&&a.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=b&&this.params.stippleIntegerRepeats;return this.techniqueConfig};e.prototype.getPassParameters=
function(){return this.params};e.prototype.intersect=function(a,b,c,d,e,g,f,k,h){h?this.intersectLineGeometry(a,b,c,d,f):m.intersectDrapedRenderLineGeometry(a,d,g,1,f)};e.prototype.intersectLineGeometry=function(a,b,e,g,f){if(g.options.selectionMode&&!r.isAllHidden(b.componentVisibilities,a.componentOffsets))if(x.isTranslationMatrix(e)){b=a.data.getVertexAttr().position.data;var h=g.camera,m=T;d.vec2.copy(m,g.point);k.vec3.set(Y[0],m[0]-2,m[1]+2,0);k.vec3.set(Y[1],m[0]+2,m[1]+2,0);k.vec3.set(Y[2],
m[0]+2,m[1]-2,0);k.vec3.set(Y[3],m[0]-2,m[1]-2,0);for(var p=0;4>p;p++)h.unprojectPoint(Y[p],N[p]);c.plane.fromPoints(h.eye,N[0],N[1],Z);c.plane.fromPoints(h.eye,N[1],N[2],W);c.plane.fromPoints(h.eye,N[2],N[3],aa);c.plane.fromPoints(h.eye,N[3],N[0],V);a=Number.MAX_VALUE;for(p=0;p<b.length-5;p+=3)if(J[0]=b[p]+e[12],J[1]=b[p+1]+e[13],J[2]=b[p+2]+e[14],I[0]=b[p+3]+e[12],I[1]=b[p+4]+e[13],I[2]=b[p+5]+e[14],!(0>c.plane.signedDistance(Z,J)&&0>c.plane.signedDistance(Z,I)||0>c.plane.signedDistance(W,J)&&0>
c.plane.signedDistance(W,I)||0>c.plane.signedDistance(aa,J)&&0>c.plane.signedDistance(aa,I)||0>c.plane.signedDistance(V,J)&&0>c.plane.signedDistance(V,I))){h.projectPoint(J,L);h.projectPoint(I,P);if(0>L[2]&&0<P[2]){k.vec3.subtract(K,J,I);var n=h.frustum,l=-c.plane.signedDistance(n.planes[4],J),n=l/k.vec3.dot(K,n.planes[4]);k.vec3.scale(K,K,n);k.vec3.add(J,J,K);h.projectPoint(J,L)}else if(0<L[2]&&0>P[2])k.vec3.subtract(K,I,J),n=h.frustum,l=-c.plane.signedDistance(n.planes[4],I),n=l/k.vec3.dot(K,n.planes[4]),
k.vec3.scale(K,K,n),k.vec3.add(I,I,K),h.projectPoint(I,P);else if(0>L[2]&&0>P[2])continue;L[2]=0;P[2]=0;n=c.lineSegment.distance2(c.lineSegment.fromPoints(L,P,O),m);n<a&&(a=n,k.vec3.copy(S,J),k.vec3.copy(R,I))}e=g.rayBeginPoint;g=g.rayEndPoint;4>a&&(a=Number.MAX_VALUE,c.lineSegment.closestLineSegmentPoint(c.lineSegment.fromPoints(S,R,O),c.lineSegment.fromPoints(e,g,Q),H)&&(k.vec3.subtract(H,H,e),a=k.vec3.length(H),k.vec3.scale(H,H,1/a),a/=k.vec3.distance(e,g)),f(a,H))}else B.error("intersection assumes a translation-only matrix")};
e.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?p.computeAttachmentOriginLines(a[x.VertexAttrConstants.POSITION],null,b):null};e.prototype.createBufferWriter=function(){var b=this.params.vertexColors?y.PositionColorLayout:y.PositionLayout;return a.isNone(this.params.stipplePattern)?new y.DefaultBufferWriter(b):new E(b.clone().vec3f(x.VertexAttrConstants.AUXPOS1))};e.prototype.createRenderer=function(a,b){return new w(a,
b,this)};e.prototype.getGLMaterial=function(a){return 0===a.output||4===a.output?new C(a):void 0};return e}(t.Material);var C=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}l(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(A.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return 4===a};b.prototype.bind=function(a,b){a.bindProgram(this.technique.program);
this.technique.bindPipelineState(a);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(u.GLMaterial),E=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[x.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){v.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d);this.writeAuxpos1(a,
b,c,d)};a.prototype.writeAuxpos1=function(a,b,c,d){var e=c.getField(x.VertexAttrConstants.AUXPOS1,g.BufferViewVec3f);c=b.indices[x.VertexAttrConstants.POSITION];b=b.vertexAttr[x.VertexAttrConstants.POSITION].data;a=a.transformation;var f=e.typedBufferStride,e=e.typedBuffer;d*=f;for(var k=0;k<c.length;k+=2)for(var h=3*c[k],m=b[h],p=b[h+1],n=b[h+2],h=a[0]*m+a[4]*p+a[8]*n+a[12],l=a[1]*m+a[5]*p+a[9]*n+a[13],m=a[2]*m+a[6]*p+a[10]*n+a[14],p=0;2>p;++p)e[d]=h,e[d+1]=l,e[d+2]=m,d+=f};return a}(),G={color:[1,
1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null},J=n.vec3f64.create(),I=n.vec3f64.create(),K=n.vec3f64.create(),H=n.vec3f64.create(),L=e.createRenderScreenPointArray3(),P=e.createRenderScreenPointArray3(),S=n.vec3f64.create(),R=n.vec3f64.create(),O=c.lineSegment.create(),Q=c.lineSegment.create(),T=n.vec3f64.create(),Y=[e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3(),e.createRenderScreenPointArray3()],
N=[n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create(),n.vec3f64.create()],Z=c.plane.create(),W=c.plane.create(),aa=c.plane.create(),V=c.plane.create();return q})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./NativeLine.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function c(a,c){c=b.call(this,a,c)||this;c.stipplePattern=null;c.stippleTextureBind=null;c.stippleTextureRepository=a.stippleTextureRepository;return c}l(c,b);c.prototype.initializeProgram=function(a){var b=c.shader.get(),d=this.configuration,b=b.build({output:d.output,attributeColor:d.vertexColors,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:d.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:d.stippleEnabled,stippleOffColorEnabled:d.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:d.stippleIntegerRepeatsEnabled});return new u(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),r.Default3D)};c.prototype.dispose=function(){b.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};c.prototype.bindPass=function(b,c,d){if(this.stipplePattern!==c.stipplePattern){var e=
c.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,e);this.stipplePattern=e}this.configuration.stippleEnabled&&(e=a.isSome(this.stippleTextureBind)?this.stippleTextureBind(b,0)*d.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/e),this.program.setUniform2f("ndcToPixel",d.viewport[2]/2,d.viewport[3]/2));0===this.configuration.output?(this.program.setUniform4fv("constantColor",c.color),
this.program.setUniform1f("alphaCoverage",Math.min(1,c.width*d.pixelRatio)),this.configuration.stippleOffColorEnabled&&(b=a.expect(c.stippleOffColor),this.program.setUniform4f("stippleOffColor",b[0],b[1],b[2],3<b.length?b[3]:1))):k.OutputHighlight.bindOutputHighlight(b,this.program,d)};c.prototype.bindDraw=function(a){d.Transform.bindUniforms(this.program,a);e.Slice.bindUniformsWithOrigin(this.program,this.configuration,a)};c.prototype.initializePipeline=function(){var a=this.configuration;return 0===
a.output?t.makePipelineState({blending:a.transparent||a.stippleEnabled?t.separateBlendingParams(770,1,771,771):null,depthTest:{func:513},depthWrite:t.defaultDepthWriteParams,colorWrite:t.defaultColorWriteParams}):t.makePipelineState({depthTest:{func:513},colorWrite:t.defaultColorWriteParams})};c.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};Object.defineProperty(c.prototype,"primitiveType",{get:function(){return 1},enumerable:!0,configurable:!0});c.shader=new n.ReloadableShaderModule(p,
"./NativeLine.glsl",q);return c}(c.ShaderTechnique);b.NativeLineTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.vertexColors=!1;b.transparent=!1;b.stippleEnabled=!1;b.stippleOffColorEnabled=!1;b.stippleIntegerRepeatsEnabled=!1;return b}l(b,a);f([g.parameter({count:7})],b.prototype,"output",void 0);f([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);f([g.parameter()],b.prototype,"sliceHighlightDisabled",
void 0);f([g.parameter()],b.prototype,"vertexColors",void 0);f([g.parameter()],b.prototype,"transparent",void 0);f([g.parameter()],b.prototype,"stippleEnabled",void 0);f([g.parameter()],b.prototype,"stippleOffColorEnabled",void 0);f([g.parameter()],b.prototype,"stippleIntegerRepeatsEnabled",void 0);return b}(g.ShaderTechniqueConfiguration);b.NativeLineTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/NativeLine.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/VertexColor.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/LineStipple.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var t=new n.ShaderBuilder;t.include(h.Transform,{linearDepth:!1});t.include(a.VertexColor,b);t.include(d.LineStipple,b);t.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4");t.attributes.add("position","vec3");t.varyings.add("vpos","vec3");t.vertex.code.add(k.glsl(c||(c=l(["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "],
["\n    void main(void) {\n      vpos \x3d (model * vec4(position, 1.0)).xyz;\n      forwardNormalizedVertexColor();\n      gl_Position \x3d transformPosition(proj, view, vpos);\n  "]))));b.stippleEnabled&&(t.attributes.add("auxpos1","vec3"),t.vertex.uniforms.add("ndcToPixel","vec2"),t.vertex.code.add(k.glsl(g||(g=l(["\n    vec4 vpos2 \x3d transformPosition(proj, view, (model * vec4(auxpos1, 1.0)).xyz);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ",
"\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "],["\n    vec4 vpos2 \x3d transformPosition(proj, view, (model * vec4(auxpos1, 1.0)).xyz);\n    float lineSegmentPixelSize \x3d length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);\n\n    stipplePatternUv \x3d lineSegmentPixelSize * stipplePatternPixelSizeInv;\n    ","\n\n    // Cancel out perspective correct interpolation because we want this length the really represent\n    // the screen distance\n    stipplePatternUv *\x3d gl_Position.w;\n    "])),
b.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":"")));t.vertex.code.add(k.glsl(r||(r=l(["\n  }\n  "],["\n  }\n  "]))));0===b.output&&(t.include(f.Slice,b),t.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float"),t.fragment.code.add(k.glsl(p||(p=l(["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n\n      vec4 color \x3d ",";\n\n      float stippleAlpha \x3d getStippleAlpha();\n      discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);\n\n      gl_FragColor \x3d highlightSlice(blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha), vpos);\n    }\n    "])),b.attributeColor?"vcolor":"constantColor")));4===b.output&&(t.include(f.Slice,b),t.include(e.OutputHighlight),t.fragment.code.add(k.glsl(u||(u=l(["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "],
["\n    void main() {\n      discardBySlice(vpos);\n      discardByStippleAlpha(getStippleAlpha(), STIPPLE_ALPHA_HIGHLIGHT_DISCARD);\n      outputHighlight();\n    }\n    "])))));return t};var c,g,r,p,u})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../Color ../../../../core/lang ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;return a}l(g,b);g.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};g.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var b,c,d,e;return f(this,function(g){switch(g.label){case 0:b=this._getIdHint("_objectmat");
if(!this._drivenProperties.size&&(c=A.validateSymbolLayerSize(this.symbolLayer)))throw Error();d=this.symbolLayer;return this.isByResource?[4,this._prepareModelResources(d.resource.href,a)]:[3,2];case 1:return g.sent(),[3,3];case 2:e=d.resource?d.resource.primitive:x.defaultPrimitive,this._preparePrimitiveResources(e,b),g.label=3;case 3:return[2]}})})};Object.defineProperty(g.prototype,"isByResource",{get:function(){return!(!this.symbolLayer.resource||!this.symbolLayer.resource.href)},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});g.prototype.setMaterialTransparencyParams=function(a,b){void 0===b&&(b=k.get(this.symbolLayer,"material","color"));b=this._getCombinedOpacity(b);a.transparent=1>b||this.needsDrivenTransparentPass;a.opacity=b;return a};g.prototype._preparePrimitiveResources=function(b,c){if(!G.isValidPrimitive(b))throw Error("Unknown object symbol primitive: "+b);var g=this.symbolLayer;
this._resourceBoundingBox=t.create(G.primitiveBoundingBox(b));this._resourceSize=p.vec3f64.fromArray(t.size(this._resourceBoundingBox));this._symbolSize=p.vec3f64.fromArray(A.computeSizeWithResourceSize(this._resourceSize,g));this._isWosr=this._isEsriSymbolResource=!1;var f=a({},R.getDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled),{instanced:["transformation"],ambient:p.vec3f64.ONES,diffuse:p.vec3f64.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,
castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:this.symbolLayer.isPrimitive});this.setMaterialTransparencyParams(f);var h=this.symbol;if("point-3d"===h.type&&h.verticalOffset){var h=h.verticalOffset,m=h.minWorldLength,l=h.maxWorldLength;f.verticalOffset={screenLength:n.pt2px(h.screenLength),minWorldLength:m||0,maxWorldLength:null!=l?l:Infinity};f.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(f.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._drivenProperties.color?f.externalColor=u.vec4f64.ONES:(g=k.isSome(g.material)&&g.material.color,g=k.isSome(g)?e.toUnitRGBA(g):u.vec4f64.ONES,f.externalColor=g);this._fastUpdates=I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(d.mixin(f,this._fastUpdates.materialParameters),f.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(f.instanced.push("color"),this._optionalFields.push("color"));
f=new S(f,c);this._lodResources=G.primitiveLodResources(b,f,c);this._originalOpacities=P.materialsFromLodResources(this._lodResources).map(function(){return 1});if(!this._lodResources)throw Error("Unknown object symbol primitive: "+b);this._finalizeSymbolResources();this._initializeLodRenderer();this.complexity=this.computeComplexity()};g.prototype._prepareModelResources=function(a,b){return h(this,void 0,void 0,function(){var c,e,g,h,m,l,r,w,v,y,x,u,q,E,H,O,R,G=this;return f(this,function(f){switch(f.label){case 0:return c=
["transformation"],e={instanced:c,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},g={materialParamsMixin:e,streamDataRequester:this._context.streamDataRequester},this._fastUpdates=I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled?(d.mixin(g.materialParamsMixin,this._fastUpdates.materialParameters),c.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&
(c.push("color"),this._optionalFields.push("color")),h=this.symbol,"point-3d"===h.type&&h.verticalOffset&&(m=h.verticalOffset,l=m.screenLength,r=m.minWorldLength,w=m.maxWorldLength,g.materialParamsMixin.verticalOffset={screenLength:n.pt2px(l),minWorldLength:r||0,maxWorldLength:null!=w?w:Infinity},g.materialParamsMixin.castShadows=!1),g.signal=b,g.usePBR=this._context.physicalBasedRenderingEnabled,[4,C.fetch(a,g)];case 1:return v=f.sent(),this._isEsriSymbolResource=v.isEsriSymbolResource,this._isWosr=
v.isWosr,y=B.makeLodResources(v.lods),B.fillEstimatedMinScreenSpaceRadius(y),y.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius}),y.levels[0].minScreenSpaceRadius=Math.min(2,y.levels[0].minScreenSpaceRadius),this._lodResources=y,x=this._context,u=this.symbolLayer.material,q=this._getExternalColorParameters(u),E=k.get(this.symbolLayer,"material","color"),H=this._getCombinedOpacity(E,{hasIntrinsicColor:!0}),O=this.needsDrivenTransparentPass,R=P.materialsFromLodResources(this._lodResources),
this._originalOpacities=R.map(function(a){return a.getParameters().opacity||1}),R.forEach(function(a){var b=a.getParameters();a.setParameterValues(q);var c=b.opacity*H;a.setParameterValues({opacity:c,transparent:1>c||O||b.transparent});x.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:x.sharedResources.screenSizePerspectiveSettings})}),this._resourceBoundingBox=v.referenceBoundingBox,this._resourceSize=p.vec3f64.fromArray(t.size(this._resourceBoundingBox)),this._pivotOffset=
p.vec3f64.fromArray(this._lodResources.levels[0].pivotOffset),this._symbolSize=p.vec3f64.fromArray(A.computeSizeWithResourceSize(this._resourceSize,this.symbolLayer)),I.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions())&&R.forEach(function(a){return a.setParameterValues(G._fastUpdates.materialParameters)}),this._finalizeSymbolResources(),this._initializeLodRenderer(),this.complexity=this.computeComplexity(),[2]}})})};g.prototype._finalizeSymbolResources=
function(){var a=this._context.stage;this._materials=P.materialsFromLodResources(this._lodResources);this._materials.forEach(function(b){a.add(3,b)});this._textures=P.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(4,b)});this._geometries=P.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(b){a.add(2,b)})};g.prototype._initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new L.LodRenderer(this._lodResources,
this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(b){return a._instanceIndexToGraphicUid.get(b)}},this._fastUpdates.enabled?{applyTransform:function(b,d,e){b.getFeatureAttribute(d,Y);c.mat4.copy(e,I.evaluateModelTransform(a._fastUpdates.materialParameters,Y,e))},scaleFactor:function(b,c,d){c.getFeatureAttribute(d,Y);return I.evaluateModelTransformScale(b,a._fastUpdates.materialParameters,Y)}}:null);this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;b.addRenderPlugin(this._lodRenderer.slots,
this._lodRenderer)};g.prototype._getExternalColorParameters=function(a){var b={};this._drivenProperties.color?b.externalColor=u.vec4f64.ONES:k.isSome(a)&&k.isSome(a.color)?b.externalColor=e.toUnitRGBA(a.color):(b.externalColor=u.vec4f64.ONES,b.colorMixMode="ignore");return b};g.prototype.destroy=function(){b.prototype.destroy.call(this);var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(3,
b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(4,b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(2,b.id)})};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=E.placePointOnGeometry(b.geometry);if(k.isNone(c))return this.logger.warn("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,
c,a.renderingInfo,d,b.uid)};g.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};g.prototype.graphicLayerToGraphicId=function(){return 0};g.prototype.layerOpacityChanged=function(){var a=this,b=this._drivenProperties.opacity,c=this.isByResource;this._materials.forEach(function(d,e){var g=k.get(a.symbolLayer,"material","color");e=a._getCombinedOpacity(g,{hasIntrinsicColor:c})*a._originalOpacities[e];d.setParameterValues({opacity:e,transparent:1>
e||b})});return!0};g.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,y.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(){var a=this;this._lodRenderer.slicePlane=this._context.slicePlaneEnabled;this._materials.forEach(function(b){b.setParameterValues({slicePlaneEnabled:a._context.slicePlaneEnabled})});return!0};g.prototype.physicalBasedRenderingChanged=function(){var a=this;this._materials.forEach(function(b){a.isByResource?
a._isEsriSymbolResource&&!a._isWosr&&b.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled}):b.setParameterValues({usePBR:a._context.physicalBasedRenderingEnabled})});return!0};g.prototype.pixelRatioChanged=function(){return!0};g.prototype.applyRendererDiff=function(a,b){var c=this,d;for(d in a.diff)switch(d){case "visualVariables":if(I.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};g.prototype.computeComplexity=function(){if(!this._lodResources)return b.prototype.computeComplexity.call(this);var a=P.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(H.VertexAttrConstants.POSITION).length},0)/3,c=J.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,
estimated:!1,memory:c}};g.prototype._createAs3DShape=function(a,b,c,d,e){a=this.getFastUpdateAttrValues(a);var g=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?A.mixinColorAndOpacity(c.color,c.opacity):null,f=this._context.clippingExtent;K.pointToVector(b,O,this._context.elevationProvider.spatialReference);if(k.isSome(f)&&!t.containsPoint(f,O))return null;var f=this._requiresTerrainElevation(d),h=this._computeGlobalTransform(b,d,T,f?N:null);c=this._computeLocalTransform(this.symbolLayer,
c,Q);var p=this._lodRenderer.instanceData,n=p.addInstance();this._instanceIndexToGraphicUid.set(n,e);p.setLocalTransform(n,c,!1);p.setGlobalTransform(n,h);a&&p.setFeatureAttribute(n,a);g&&p.setColor(n,g);e=new m(this,n,v.perLodInstanceElevationAligner,d);f&&(e.alignedSampledElevation=N.sampledElevation);e.needsElevationUpdates=y.needsElevationUpdates3D(d.mode);E.extendPointGraphicElevationContext(e,b,this._context.elevationProvider);return e};g.prototype._computeGlobalTransform=function(a,b,c,d){b=
y.evaluateElevationAlignmentAtPoint(a,this._context.elevationProvider,b,this._context.renderCoordsHelper,d);O[0]=a.x;O[1]=a.y;O[2]=b;K.computeLinearTransformation(a.spatialReference,O,c,this._context.renderCoordsHelper.spatialReference);return c};g.prototype._computeLocalTransform=function(a,b,d){c.mat4.identity(d);this._applyObjectRotation(b,!1,d);this._applyObjectRotation(a,!0,d);this._applyObjectScale(b,d);this._applyAnchor(a,d);return d};g.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&
this._fastUpdates.requiresShaderTransformation||(a=A.computeObjectScale(this._drivenProperties.size&&a.size?a.size:this._symbolSize,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||c.mat4.scale(b,b,a))};g.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var b=a.diff.diff;this._preparePatchTransform(a,b);this._preparePatchColor(a,b)}};g.prototype.updateGeometry=function(a,b){var c=b&&E.placePointOnGeometry(b);
if(k.isNone(c))return!1;b=this.getGeometryElevationMode(b);if(a.elevationContext.mode!==b)return!1;b=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(c,a.elevationContext,T,b?N:null);b&&(a.alignedSampledElevation=N.sampledElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,T,!0);E.extendPointGraphicElevationContext(a,c,this._context.elevationProvider);return!0};g.prototype._preparePatchTransform=function(a,b){var c=this;if(b.heading||b.tilt||
b.roll||b.width||b.height||b.depth||b.anchor||b.anchorPosition){var d=function(a,b,c){return(null!=a&&"complete"===a.type?a.newValue:b)||c},e=d(b.heading,this.symbolLayer.heading,0),g=d(b.tilt,this.symbolLayer.tilt,0),f=d(b.roll,this.symbolLayer.roll,0),k=d(b.width,this.symbolLayer.width,void 0),h=d(b.height,this.symbolLayer.height,void 0),m=d(b.depth,this.symbolLayer.depth,void 0),n=d(b.anchor,this.symbolLayer.anchor,void 0),d=d(b.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete b.heading;
delete b.tilt;delete b.roll;delete b.width;delete b.height;delete b.depth;delete b.anchor;delete b.anchorPosition;var l={heading:e,tilt:g,roll:f,anchor:n,anchorPosition:d};1===this.loadStatus&&a.symbolLayerStatePatches.push(function(){c._symbolSize=p.vec3f64.fromArray(A.computeSizeWithResourceSize(c._resourceSize,{width:k,height:h,depth:m,isPrimitive:c.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,b){b=c._computeLocalTransform(l,b,Q);c._lodRenderer.instanceData.setLocalTransform(a.instanceIndex,
b,!0)})}};g.prototype._preparePatchColor=function(a,b){var c=this;if(b.material&&"partial"===b.material.type&&(b=b.material.diff,b.color&&"complete"===b.color.type&&null!=b.color.newValue&&null!=b.color.oldValue)){var d=b.color.newValue,g=k.isSome(d)?e.toUnitRGBA(d):u.vec4f64.ONES;delete b.color;a.graphics3DGraphicPatches.push(function(a){c._hasPerInstanceColor()?(c._lodRenderer.instanceData.setColor(a.instanceIndex,g),a=c.setMaterialTransparencyParams({},d)):a=c.setMaterialTransparencyParams({externalColor:g},
d);for(var b=0,e=c._materials;b<e.length;b++)e[b].setParameterValues(a)})}};g.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};g.prototype._applyObjectRotation=function(a,b,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&b))return A.computeObjectRotation(a.heading,a.tilt,a.roll,c)};g.prototype._computeAnchor=function(a){var b=p.vec3f64.create();switch(a.anchor){case "center":r.vec3.copy(b,t.center(this._resourceBoundingBox));r.vec3.negate(b,
b);break;case "top":var c=t.center(this._resourceBoundingBox);r.vec3.set(b,-c[0],-c[1],-this._resourceBoundingBox[5]);break;case "bottom":c=t.center(this._resourceBoundingBox);r.vec3.set(b,-c[0],-c[1],-this._resourceBoundingBox[2]);break;case "relative":var c=t.center(this._resourceBoundingBox),d=t.size(this._resourceBoundingBox);a=(a=a.anchorPosition)?p.vec3f64.fromValues(a.x,a.y,a.z):p.vec3f64.ZEROS;r.vec3.multiply(b,d,a);r.vec3.add(b,b,c);r.vec3.negate(b,b);break;default:this._pivotOffset?r.vec3.negate(b,
this._pivotOffset):r.vec3.copy(b,p.vec3f64.ZEROS)}return b};g.prototype._applyAnchor=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&c.mat4.translate(b,b,a)};g.prototype._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};g.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?p.vec3f64.fromArray(t.size(this._resourceBoundingBox)):p.vec3f64.ONES,b=
this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):p.vec3f64.ZEROS,c=this._context.renderCoordsHelper.unitInMeters,d=A.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c),e=p.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:a,symbolSize:this._symbolSize||p.vec3f64.ONES,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:e}}};return g}(w.default);b.Graphics3DObjectSymbolLayer=q;var O=p.vec3f64.create(),
Q=g.mat4f64.create(),T=g.mat4f64.create(),Y=u.vec4f64.create(),N={verticalDistanceToGround:0,sampledElevation:0};b.default=q})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){q=function(){function a(a,b,d,e){this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=d;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1;this.elevationContext=new c(e)}a.prototype.initialize=function(){};a.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};a.prototype.destroy=
function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};a.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(n.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedSampledElevation=a))};a.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*
a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};a.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=d.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v);return e.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,v)};a.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=k.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,v);var b=this.lodRenderer.baseBoundingBox;k.empty(a);
for(var c=0;8>c;++c)e.vec3.set(u,0===(c&1)?b[0]:b[3],0===(c&2)?b[1]:b[4],0===(c&4)?b[2]:b[5]),e.vec3.transformMat4(u,u,v),k.expandPointInPlace(a,u);return a};a.prototype.computeAttachmentOrigin=function(a){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,v);a.render.origin[0]+=v[12];a.render.origin[1]+=v[13];a.render.origin[2]+=v[14];a.render.num++};a.prototype.getProjectedBoundingBox=function(a,b,c,d,n){return h(this,void 0,void 0,function(){var h,m,l,r,w,y,A,B,C;return f(this,
function(f){switch(f.label){case 0:h=this.getBoundingBoxObjectSpace(n);m=x;l=k.isPoint(h)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,v);for(r=0;r<l;r++)w=m[r],u[0]=h[w[0]],u[1]=h[w[1]],u[2]=h[w[2]],e.vec3.transformMat4(u,u,v),p[3*r+0]=u[0],p[3*r+1]=u[1],p[3*r+2]=u[2];if(!a(p,0,l))return[2,null];k.empty(h);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(r=0;r<3*l;r+=3){for(A=0;3>A;A++)h[A]=Math.min(h[A],p[r+A]),h[A+3]=Math.max(h[A+
3],p[r+A]);y&&c.push({location:p.slice(r,r+3),screenSpaceBoundingRect:y})}if(!b)return[3,5];k.center(h,t);if("absolute-height"===this.elevationContext.mode)return[3,5];B=void 0;C=g.demResolutionForBoundingBox(h,b);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,b.service.queryElevation(t[0],t[1],d,C)];case 2:return B=f.sent(),[3,4];case 3:return f.sent(),B=null,[3,4];case 4:null!=B&&k.offset(h,0,0,-this.alignedSampledElevation+B),f.label=5;case 5:return[2,h]}})})};a.prototype.addHighlight=function(a){var b=
this,c=r.generateHighlightId();this.addHighlightId(c);a.addExternal(function(a){b.removeHighlightId(a)},c)};a.prototype.removeHighlight=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};a.prototype.addHighlightId=function(a){this.highlights=this.highlights||new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};a.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(a.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return a}();var p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=d.vec3f64.create(),t=d.vec3f64.create(),x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=a.mat4f64.create();return q})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require",
"exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(q,b,l,f,h){function a(a){var b=[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.stageResources.materials[d],geometry:c,textures:a.stageResources.textures})});return{components:b,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function e(a,b){void 0===b&&(b=d);a=h.computeFaceCount(a);return Math.sqrt(a/(b*
Math.PI))}Object.defineProperty(b,"__esModule",{value:!0});b.makeLodLevelResources=a;b.makeLodResources=function(b){return{levels:b.map(function(b){return a(b)})}};b.estimateMinScreenSpaceRadius=e;b.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||(a.minScreenSpaceRadius=e(a))})};var d=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/devEnvironmentUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/string ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/esriProvidedModelParameters ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H){function L(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return b?{fileType:"gltf",url:b[1],specifiedLodIndex:null!=b[4]?Number(b[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function P(b,d,e,f){var h=b.model,m=g.mat3f64.create(),p=[],n=new Map,l=new Map;h.lods.forEach(function(b,g){if(void 0===f||g===f){var r=0,t={name:b.name,
stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:k.isSome(b.lodThreshold)?b.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:x.empty()};p.push(t);b.parts.forEach(function(g){var f=g.material+(g.attributes.normal?"_normal":"")+(g.attributes.color?"_color":"")+(g.attributes.texCoord0?"_texCoord0":"")+(g.attributes.tangent?"_tangent":""),p=h.materials.get(g.material),v=k.isSome(g.attributes.texCoord0),y=k.isSome(g.attributes.normal);if(!n.has(f)){if(v){if(k.isSome(p.textureColor)&&
!l.has(p.textureColor)){var u=h.textures.get(p.textureColor),A=a({},u.parameters,{preMultiplyAlpha:!0});l.set(p.textureColor,new I(u.data,p.textureColor,A))}k.isSome(p.textureNormal)&&!l.has(p.textureNormal)&&(u=h.textures.get(p.textureNormal),A=a({},u.parameters,{preMultiplyAlpha:!0}),l.set(p.textureNormal,new I(u.data,p.textureNormal,A)));k.isSome(p.textureOcclusion)&&!l.has(p.textureOcclusion)&&(u=h.textures.get(p.textureOcclusion),A=a({},u.parameters,{preMultiplyAlpha:!0}),l.set(p.textureOcclusion,
new I(u.data,p.textureOcclusion,A)));k.isSome(p.textureEmissive)&&!l.has(p.textureEmissive)&&(u=h.textures.get(p.textureEmissive),A=a({},u.parameters,{preMultiplyAlpha:!0}),l.set(p.textureEmissive,new I(u.data,p.textureEmissive,A)));k.isSome(p.textureMetallicRoughness)&&!l.has(p.textureMetallicRoughness)&&(u=h.textures.get(p.textureMetallicRoughness),A=a({},u.parameters,{preMultiplyAlpha:!0}),l.set(p.textureMetallicRoughness,new I(u.data,p.textureMetallicRoughness,A)))}var q=K.COLOR_GAMMA,u=Math.pow(p.color[0],
1/q),A=Math.pow(p.color[1],1/q),H=Math.pow(p.color[2],1/q),O=Math.pow(p.emissiveFactor[0],1/q),R=Math.pow(p.emissiveFactor[1],1/q),q=Math.pow(p.emissiveFactor[2],1/q);n.set(f,new K(a({},d,{transparent:"BLEND"===p.alphaMode,textureAlphaMode:S(p.alphaMode),textureAlphaCutoff:p.alphaCutoff,diffuse:[u,A,H],ambient:[u,A,H],opacity:p.opacity,doubleSided:p.doubleSided,doubleSidedType:"winding-order",cullFace:p.doubleSided?0:2,vertexColors:!!g.attributes.color,vertexTangents:!!g.attributes.tangent,normals:y?
"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:k.isSome(p.textureColor)&&v?l.get(p.textureColor).id:void 0,colorMixMode:p.colorMixMode,normalTextureId:k.isSome(p.textureNormal)&&v?l.get(p.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:k.isSome(p.textureOcclusion)&&v?l.get(p.textureOcclusion).id:void 0,emissiveTextureId:k.isSome(p.textureEmissive)&&v?l.get(p.textureEmissive).id:void 0,metallicRoughnessTextureId:k.isSome(p.textureMetallicRoughness)&&v?
l.get(p.textureMetallicRoughness).id:void 0,emissiveFactor:[O,R,q],metallicFactor:p.metallicFactor,roughnessFactor:p.roughnessFactor},e),f))}a:{y=g.indices||g.attributes.position.count;switch(g.primitiveType){case 4:u=w.trianglesToTriangles(y);break a;case 5:u=w.triangleStripToTriangles(y);break a;case 6:u=w.triangleFanToTriangles(y);break a}u=void 0}A={};H={};y=g.attributes.position.count;O=E.createBuffer(B.BufferViewVec3f,y);C.vec3.transformMat4(O,g.attributes.position,g.transform);H.position={data:O.typedBuffer,
size:O.elementCount};A.position=u;k.isSome(g.attributes.normal)&&(O=E.createBuffer(B.BufferViewVec3f,y),c.mat3.normalFromMat4(m,g.transform),C.vec3.transformMat3(O,g.attributes.normal,m),H.normal={data:O.typedBuffer,size:O.elementCount},A.normal=u);k.isSome(g.attributes.tangent)&&(O=E.createBuffer(B.BufferViewVec4f,y),c.mat3.normalFromMat4(m,g.transform),C.vec4.transformMat3(O,g.attributes.tangent,m),H.tangent={data:O.typedBuffer,size:O.elementCount},A.tangent=u);k.isSome(g.attributes.texCoord0)&&
(O=E.createBuffer(B.BufferViewVec2f,y),E.vec2.normalizeIntegerBuffer(O,g.attributes.texCoord0),H.uv0={data:O.typedBuffer,size:O.elementCount},A.uv0=u);k.isSome(g.attributes.color)&&(O=E.createBuffer(B.BufferViewVec4u8,y),4===g.attributes.color.elementCount?g.attributes.color instanceof B.BufferViewVec4f?C.vec4.scale(O,g.attributes.color,255):g.attributes.color instanceof B.BufferViewVec4u8?E.vec4.copy(O,g.attributes.color):g.attributes.color instanceof B.BufferViewVec4u16&&C.vec4.scale(O,g.attributes.color,
1/256):(E.vec4.fill(O,255,255,255,255),R=new B.BufferViewVec3u8(O.buffer,0,4),g.attributes.color instanceof B.BufferViewVec3f?C.vec3.scale(R,g.attributes.color,255):g.attributes.color instanceof B.BufferViewVec3u8?E.vec3.copy(R,g.attributes.color):g.attributes.color instanceof B.BufferViewVec3u16&&C.vec3.scale(R,g.attributes.color,1/256)),H.color={data:O.typedBuffer,size:O.elementCount},A.color=u);g=new G(new J.GeometryData(H,A),"gltf_"+b.name+"_"+r++);t.stageResources.geometries.push(g);t.stageResources.materials.push(n.get(f));
v&&(k.isSome(p.textureColor)&&t.stageResources.textures.push(l.get(p.textureColor)),k.isSome(p.textureNormal)&&t.stageResources.textures.push(l.get(p.textureNormal)),k.isSome(p.textureOcclusion)&&t.stageResources.textures.push(l.get(p.textureOcclusion)),k.isSome(p.textureEmissive)&&t.stageResources.textures.push(l.get(p.textureEmissive)),k.isSome(p.textureMetallicRoughness)&&t.stageResources.textures.push(l.get(p.textureMetallicRoughness)));t.numberOfVertices+=y;f=g.boundingInfo;x.expand(t.boundingBox,
f.getBBMin());x.expand(t.boundingBox,f.getBBMax())})}});return p}function S(a){switch(a){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}function R(a){var b=a.model.lods.length;a.meta.isEsriSymbolResource&&a.model.lods.forEach(function(a){if(!k.isSome(a.lodThreshold)){var c=(a.name||"").replace("Imposter","Realistic_LOD0").split("_LOD")[0],d=a.parts.reduce(function(a,b){return a+b.attributes.position.count},0);a.lodThreshold=O(c,d,b)}})}function O(a,
b,c){void 0===a&&(a="");if(1===c)return null;if(a in y.lodThresholdLUT){c=y.lodThresholdLUT[a].vertexCounts;a=y.lodThresholdLUT[a].thresholds;var d=c.length;if(1>=d)return null;if(b<=c[0]){var e=(c[1]-c[0])/(a[1]-a[0]);b-=c[0];return Math.max(0,a[0]+b*e)}if(b>=c[d-1])return e=(c[d-1]-c[d-2])/(a[d-1]-a[d-2]),b-=c[d-1],a[d-1]+b*e;for(var g=1;g<c.length;++g){var f=c[g-1],k=c[g],d=a[g-1],e=a[g];if(b<k)return b=(b-f)/(k-f),d*(1-b)+e*b}}return null}Object.defineProperty(b,"__esModule",{value:!0});b.fetch=
function(b,c){void 0===c&&(c={});return h(this,void 0,void 0,function(){var g,h,l,w,x,C,q,O,G,Q,T;return f(this,function(f){switch(f.label){case 0:return g=L(e.adjustStaticAGOUrl(b)),"wosr"!==g.fileType?[3,2]:[4,A.load(g.url,c)];case 1:return h=f.sent(),[2,{lods:[h],referenceBoundingBox:h.boundingBox,isEsriSymbolResource:!1,isWosr:!0}];case 2:return l=new v.DefaultLoadingContext(c.streamDataRequester),[4,m.load(l,g.url,c)];case 3:w=f.sent();a:if(f=w,f.meta.isEsriSymbolResource)for(var N=0,U=f.model.lods;N<
U.length;N++){var K=U[N],S;b:{var I=K.name,J=f.meta.uri;void 0===I&&(I="");void 0===J&&(J="");S=n.endsWith(I,"Imposter");I=I.split("__")[0];if(-1!==J.indexOf("/RealisticTrees/")&&(J=y.treeParamsTable[I])){S={crownCenter:J.center,crownDimensions:J.radius,imposter:S};break b}S=void 0}if(!S)break a;f.customMeta.esriTreeRendering=!0;J=0;for(K=K.parts;J<K.length;J++){var I=K[J],F=I.attributes.normal;if(k.isNone(F))break a;for(var Z=I.attributes.position,Y=Z.count,W=t.vec3f64.create(),ca=t.vec3f64.create(),
V=t.vec3f64.create(),aa=E.createBuffer(B.BufferViewVec4u8,Y),ea=E.createBuffer(B.BufferViewVec3f,Y),ha=r.mat4.invert(p.mat4f64.create(),I.transform),da=u.vec3.transformMat4(t.vec3f64.create(),S.crownCenter,ha),ha=u.vec3.transformMat4(t.vec3f64.create(),S.crownDimensions,ha),ka=0;ka<Y;ka++){Z.getVec(ka,ca);F.getVec(ka,W);u.vec3.subtract(V,ca,da);u.vec3.divide(V,V,ha);var Ja=d.clamp(u.vec3.length(V),0,1),Ja=.6+.4*Ja*Ja;u.vec3.lerp(V,V,W,.2);ea.setVec(ka,V);aa.set(ka,0,255*Ja);aa.set(ka,1,255*Ja);aa.set(ka,
2,255*Ja);aa.set(ka,3,255)}I.attributes.normal=ea;I.attributes.color=aa}}R(w);x=w.meta.isEsriSymbolResource?H.getDefaultPBRMaterialParameters(c.usePBR,w.customMeta.esriTreeRendering):{usePBR:!0};C=a({},c.materialParamsMixin,{treeRendering:w.customMeta.esriTreeRendering});if(null!=g.specifiedLodIndex)return q=P(w,x,C,g.specifiedLodIndex),O=q[0].boundingBox,0!==g.specifiedLodIndex&&(G=P(w,x,C,g.specifiedLodIndex),O=G[0].boundingBox),[2,{lods:q,referenceBoundingBox:O,isEsriSymbolResource:w.meta.isEsriSymbolResource,
isWosr:!1}];Q=P(w,x,C);T=Q[0].boundingBox;return[2,{lods:Q,referenceBoundingBox:T,isEsriSymbolResource:w.meta.isEsriSymbolResource,isWosr:!1}]}})})};b.parseUrl=L;b.gltfToEngineResources=P})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.streamDataRequester=a}b.prototype.loadJSON=function(a,b){return l(this,void 0,void 0,function(){return f(this,function(c){return[2,this.load("json",a,b)]})})};b.prototype.loadBinary=function(a,b){return l(this,void 0,void 0,function(){return f(this,function(d){return c.isDataProtocol(a)?(n.throwIfAborted(b),[2,c.dataToArrayBuffer(a)]):[2,this.load("binary",a,b)]})})};b.prototype.loadImage=
function(a,b){return l(this,void 0,void 0,function(){return f(this,function(c){return[2,this.load("image",a,b)]})})};b.prototype.load=function(b,c,h){return l(this,void 0,void 0,function(){var p;return f(this,function(f){switch(f.label){case 0:return k.isNone(this.streamDataRequester)?[4,a(c,{responseType:g[b]})]:[3,2];case 1:return[2,f.sent().data];case 2:return[4,e.result(this.streamDataRequester.request(c,b,h))];case 3:p=f.sent();if(!0===p.ok)return[2,p.value];n.throwIfAbortError(p.error);throw new d("",
"Request for resource failed: "+p.error);}})})};return b}();b.DefaultLoadingContext=q;var g={image:"image",binary:"array-buffer",json:"json"}})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,
5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,
0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},
Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,
0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},
Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,
0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};b.lodThresholdLUT={Alder_Buckthorn__Realistic:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant__Realistic:{thresholds:[2,
22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut__Realistic:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore__Realistic:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot__Realistic:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine__Realistic:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress__Realistic:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir__Realistic:{thresholds:[2,
64.674],vertexCounts:[18,10266]},Bamboo__Realistic:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree__Realistic:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood__Realistic:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel__Realistic:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust__Realistic:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus__Realistic:{thresholds:[2,
56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood__Realistic:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern__Realistic:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay__Realistic:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar__Realistic:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm__Realistic:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood__Realistic:{thresholds:[2,
110.805],vertexCounts:[18,10260]},California_Walnut__Realistic:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm__Realistic:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn__Realistic:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam__Realistic:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree__Realistic:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm__Realistic:{thresholds:[2,
31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow__Realistic:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir__Realistic:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech__Realistic:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch__Realistic:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus__Realistic:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm__Realistic:{thresholds:[2,
34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush__Realistic:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood__Realistic:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree__Realistic:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump__Realistic:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown__Realistic:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia__Realistic:{thresholds:[2,
30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave__Realistic:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree__Realistic:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron__Realistic:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress__Realistic:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley__Realistic:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,
378,1464,4152]},Scots_Pine__Realistic:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn__Realistic:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto__Realistic:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany__Realistic:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak__Realistic:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple__Realistic:{thresholds:[2,28.322,
59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce__Realistic:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid__Realistic:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other__Realistic:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet__Realistic:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily__Realistic:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde__Realistic:{thresholds:[2,65.31,198.124],vertexCounts:[18,
2010,7668]},Paper_Birch__Realistic:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm__Realistic:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus__Realistic:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder__Realistic:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory__Realistic:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas__Realistic:{thresholds:[2,47.068,192.681],
vertexCounts:[18,1044,8160]},Rose__Realistic:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm__Realistic:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus__Realistic:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras__Realistic:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca__Realistic:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush__Realistic:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,
336,1932,9030]},Snake_Plant__Realistic:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia__Realistic:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom__Realistic:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree__Realistic:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower__Realistic:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum__Realistic:{thresholds:[2,
31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia__Realistic:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper__Realistic:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash__Realistic:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar__Realistic:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow__Realistic:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel__Realistic:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,
330,2070,10386]},ATM_:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1_:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2_:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster_:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine_:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On_:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off_:{thresholds:[2,
46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On_:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off_:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On_:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1_:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2_:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3_:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4_:{thresholds:[2,69.923],vertexCounts:[144,
2304]},Payphone_:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table_:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular_:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square_:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered_:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1_:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2_:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3_:{thresholds:[2,37.931,70.286],vertexCounts:[144,
678,2328]},Rock_4_:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On_:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2_:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1_:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2_:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3_:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},
Trash_Can_1_:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2_:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox_:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance_:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6_:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe_:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series_:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat_:{thresholds:[2,
61.105,269.127],vertexCounts:[438,4476,14952]},Bus_:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane_:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck_:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365_:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying_:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125_:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying_:{thresholds:[2,
94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck_:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge_:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition_:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150_:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta_:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback_:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},
Ford_Fusion_:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang_:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus_:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van_:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect_:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass_:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat_:{thresholds:[2,
67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle_:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car_:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter_:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera_:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat_:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up_:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},
Taxi_:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van_:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7_:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane_:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius_:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram_:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon_:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},
Traffic_Light_1_:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3_:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4_:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]},Cell_Phone_Antenna_:{thresholds:[2,53.05602049838099,225.75567007367763],vertexCounts:[150,894,4242]},Electricity_Box_:{thresholds:[2,56.48433069112405,207.14360140104995],vertexCounts:[108,744,1026]},Electricity_Meter_:{thresholds:[2,53.4669717168887,215.04066673528195],vertexCounts:[120,384,960]},
Powerline_Pole_:{thresholds:[2,28.11004122822377,58.29783783397482],vertexCounts:[120,840,3678]},Radio_Antenna_:{thresholds:[2,32.2179270951266,462.06696540941175],vertexCounts:[297,1815,9009]},Wind_Turbine_:{thresholds:[2,56.15679308163878,247.66420622007408],vertexCounts:[291,1806,7974]},Bike_Rack_:{thresholds:[2,33.4134686118416,742.2476610265626],vertexCounts:[138,900,3948]},Fire_Hydrant_:{thresholds:[2,30.215510249190537,390.42722821984944],vertexCounts:[156,894,2676]},Fountain_1_:{thresholds:[2,
52.36907652663328,221.4335455931077],vertexCounts:[300,1782,8052]},Fountain_2_:{thresholds:[2,58.20077988776262,254.01846725224388],vertexCounts:[288,1794,8526]},Fountain_3_:{thresholds:[2,30.089436161855176,215.0465007031079],vertexCounts:[306,1800,8880]},Fountain_4_:{thresholds:[2,90.06038366113779,351.6045839690371],vertexCounts:[252,1656,2136]},Mailbox_:{thresholds:[2,52.806020498381045,378.6213345953622],vertexCounts:[150,894,4494]},Sewer_Grate_:{thresholds:[2,32.31186201200472,388.7801192944885],
vertexCounts:[60,492,1788]},Storm_Drain_:{thresholds:[2,93.440164912895,355.73135487536024],vertexCounts:[150,840,3300]},Traffic_Pylon_:{thresholds:[2,59.30348706874729,388.12062237971986],vertexCounts:[138,756,1740]},Airplane_Large_Passenger_:{thresholds:[2,32.63681118513339,229.25055778384916],vertexCounts:[303,1614,7086]},Airplane_Large_Passenger_With_Wheels_:{thresholds:[2,57.56132180109627,219.23679864871204],vertexCounts:[450,2550,9186]},Airplane_Private_:{thresholds:[2,55.15153188839752,218.4051249478359],
vertexCounts:[300,1209,6894]},Airplane_Private_With_Wheels_:{thresholds:[2,54.962671511046956,225.3801611565773],vertexCounts:[366,1737,8454]},Airplane_Propeller_:{thresholds:[2,55.03627391751588,214.63956781455144],vertexCounts:[291,1560,8502]},Airplane_Propeller_With_Wheels_:{thresholds:[2,57.1404638556843,221.48743600008154],vertexCounts:[303,1776,9006]},Airplane_Small_Passenger_:{thresholds:[2,56.98035485213009,217.0648860940108],vertexCounts:[300,1530,8946]},Airplane_Small_Passenger_With_Wheels_:{thresholds:[2,
56.402226419354996,227.53633450087503],vertexCounts:[456,1698,11400]},Cargo_Box_:{thresholds:[2,180.55115902122088,360.2534460453696],vertexCounts:[132,672,3738]},Cargo_Ship_Empty_:{thresholds:[2,58.00721049029622,327.1185961587389],vertexCounts:[444,2616,10896]},Cargo_Ship_Full_:{thresholds:[2,55.386139460867525,346.87126261041203],vertexCounts:[450,2670,10950]},City_Bike_:{thresholds:[2,56.670817449986885,242.3113495346381],vertexCounts:[300,1785,8736]},Delivery_Truck_:{thresholds:[2,34.92797405514993,
120.33485126686935],vertexCounts:[408,2130,13248]},High_Speed_Train_:{thresholds:[2,58.255981072570464,405.19492233117126],vertexCounts:[276,1908,11928]},Mountain_Bike_:{thresholds:[2,30.151936161855172,115.15158622172994],vertexCounts:[294,1800,8994]},Pickup_Truck_Ford_F250_:{thresholds:[2,31.705838007504713,69.25663661786093],vertexCounts:[300,1770,8976]},Pickup_Truck_Toyota_Hilux_:{thresholds:[2,56.84455317543219,128.81569681781366],vertexCounts:[306,1716,9048]},Road_Bike_:{thresholds:[2,44.97251491181105,
127.30122549350301],vertexCounts:[297,1788,8916]},Semi_Trailer_Truck_:{thresholds:[2,35.382538898732484,127.42462492550419],vertexCounts:[282,1740,8997]},Tractor_:{thresholds:[2,33.01181118513338,128.39790644030703],vertexCounts:[306,1614,8961]},Tractor_And_Trailer_:{thresholds:[2,33.18284541984615,130.95719106637375],vertexCounts:[450,2502,12894]},Trailer_:{thresholds:[2,30.327031957706836,119.19765978853422],vertexCounts:[270,1440,9E3]},Train_Europe_:{thresholds:[2,31.15174353437363,105.3408295387661],
vertexCounts:[138,756,3846]},Train_Europe_With_Carriages_:{thresholds:[2,57.97062023935375,355.8054399222865],vertexCounts:[408,2682,10596]},Train_US_:{thresholds:[2,27.776264387000953,61.24231873858716],vertexCounts:[156,618,3648]},Tricycle_:{thresholds:[2,31.87237750582925,132.64683491853526],vertexCounts:[297,1746,8136]},Truck_With_Trailer_:{thresholds:[2,57.64037298915464,361.21271516459444],vertexCounts:[438,2478,13476]},Orange_Tree__Realistic:{thresholds:[2,25.470734736913386,62.118518915365755,
128.10642692525323],vertexCounts:[18,354,1524,10302]},American_Football_Goal_:{thresholds:[2,34.76135530828228,712.2046360848831],vertexCounts:[147,588,2688]},Basketball_Hoop_:{thresholds:[2,52.74512035232253,208.15783725757558],vertexCounts:[123,768,4260]},Jungle_Gym_:{thresholds:[2,47.5885918871016,256.602450987006],vertexCounts:[294,1773,8916]},Slide_:{thresholds:[2,29.23625745590553,729.2078902902748],vertexCounts:[252,1788,7440]},Soccer_Goal_:{thresholds:[2,33.671199284957794,364.5834082156921],
vertexCounts:[138,870,4266]},Swing_:{thresholds:[2,32.70510997459713,449.6062391021012],vertexCounts:[300,1734,7176]},Teeter_Totter_:{thresholds:[2,53.23896332520353,456.4221097287286],vertexCounts:[294,1710,7794]},Balsam_Fir__Schematic:{thresholds:[2,107.63596252927391,859.3878782201409],vertexCounts:[66,126,222]},Umbrella_Acacia__Schematic:{thresholds:[2,28.236981042654023,770.1463507109006],vertexCounts:[138,630,2238]},Sugar_Maple__Schematic:{thresholds:[2,14.35031627906977,881.1466235565822],
vertexCounts:[108,852,3396]},Conker_Tree__Schematic:{thresholds:[2,15.284392361111118,832.0115049504952],vertexCounts:[108,852,3396]},Hedgehog_Agave__Schematic:{thresholds:[2,14.987731203007513,823.8048558262012],vertexCounts:[72,792,3312]},Ruffle_Palm__Schematic:{thresholds:[2,12.135573455233287,817.5737099621688],vertexCounts:[108,852,3396]},Red_Alder__Schematic:{thresholds:[2,14.01284931506851,780.2679999999996],vertexCounts:[108,852,3396]},Shadbush__Schematic:{thresholds:[2,29.80464285714286,
842.6101098901099],vertexCounts:[72,792,3312]},Japanese_Angelica_Tree__Schematic:{thresholds:[2,15.115126024590165,799.501264413519],vertexCounts:[108,852,3396]},Strawberry_Tree__Schematic:{thresholds:[2,15.083150000000003,818.0121967213113],vertexCounts:[108,852,3396]},Paper_Birch__Schematic:{thresholds:[2,10.303635227272727,878.0123272727276],vertexCounts:[108,780,2100]},Orchid__Schematic:{thresholds:[2,26.07269215291752,923.3067065420558],vertexCounts:[108,780,2100]},Boxwood__Schematic:{thresholds:[2,
15.198452928870296,830.9156959761549],vertexCounts:[108,852,3396]},California_Incense_Cedar__Schematic:{thresholds:[2,12.739357933579337,864.1071448275861],vertexCounts:[138,630,2238]},Saguaro_Cactus__Schematic:{thresholds:[2,27.560375000000015,919.7996596551259],vertexCounts:[108,780,2100]},Red_Hickory__Schematic:{thresholds:[2,16.855436823104693,800.57046628131],vertexCounts:[108,852,3396]},American_Chestnut__Schematic:{thresholds:[2,17.239219730941716,846.5782343859651],vertexCounts:[108,852,3396]},
Australian_Pine__Schematic:{thresholds:[2,16.529950965824664,803.2413670133733],vertexCounts:[138,630,2238]},Mountain_Mahogany__Schematic:{thresholds:[2,13.008124060150381,917.9049999999999],vertexCounts:[108,852,3396]},Parlour_Palm__Schematic:{thresholds:[2,14.524522935779814,819.898849909584],vertexCounts:[108,780,2100]},Desert_Willow__Schematic:{thresholds:[2,14.02700704225353,920.7354144884243],vertexCounts:[108,852,3396]},Orange_Tree__Schematic:{thresholds:[2,14.192646264057018,861.1305417111394],
vertexCounts:[108,852,3396]},Coconut_Palm__Schematic:{thresholds:[2,16.367034412955462,902.0106492659056],vertexCounts:[108,852,3396]},Lily_Of_The_Valley__Schematic:{thresholds:[2,51.11744751381218,792.1491071428572],vertexCounts:[138,630,2238]},Palm_Lily__Schematic:{thresholds:[2,15.243925287356316,799.762794117647],vertexCounts:[108,780,2100]},Flowering_Dogwood__Schematic:{thresholds:[2,15.508128172588837,810.379933284989],vertexCounts:[108,852,3396]},Common_Hawthorn__Schematic:{thresholds:[2,15.159807441253282,
889.5056919060053],vertexCounts:[72,792,3312]},Leyland_Cypress__Schematic:{thresholds:[2,14.94957231404959,805.2679669421484],vertexCounts:[108,852,3396]},Amazon_Sword_Plant__Schematic:{thresholds:[2,17.358711448598132,824],vertexCounts:[108,852,3396]},Blue_Gum_Eucalyptus__Schematic:{thresholds:[2,26.441309523809522,820.3575976676384],vertexCounts:[138,630,2238]},European_Beech__Schematic:{thresholds:[2,25.26955788590608,871.8532751677853],vertexCounts:[138,630,2238]},Ficus__Schematic:{thresholds:[2,
15.364387681159425,800.1358897637797],vertexCounts:[108,852,3396]},Alder_Buckthorn__Schematic:{thresholds:[2,16.64437797619048,1028.757943743938],vertexCounts:[108,852,3396]},White_Ash__Schematic:{thresholds:[2,14.981912280701744,776.9208385269121],vertexCounts:[108,852,3396]},Flannelbush__Schematic:{thresholds:[2,15.24620504087194,805.9792635498547],vertexCounts:[72,792,3312]},Generic_Dead_Tree__Schematic:{thresholds:[2,15.068557103064066,858],vertexCounts:[108,852,3396]},Witch_Hazel__Schematic:{thresholds:[2,
15.320549999999995,801.9632958152956],vertexCounts:[108,852,3396]},Sunflower__Schematic:{thresholds:[2,30.66128647686832,796.1051534500516],vertexCounts:[108,852,3396]},California_Walnut__Schematic:{thresholds:[2,16.488717712177117,895.3309873754151],vertexCounts:[108,852,3396]},Western_Juniper__Schematic:{thresholds:[2,26.945806855636135,767.2468292682922],vertexCounts:[138,630,2238]},European_Larch__Schematic:{thresholds:[2,13.155643356643353,830.1452680652685],vertexCounts:[138,630,2238]},Bay_Laurel__Schematic:{thresholds:[2,
14.695218421052633,808.1161693811073],vertexCounts:[138,630,2238]},Oval_Leaved_Privet__Schematic:{thresholds:[2,14.822584645669306,828.4657637795276],vertexCounts:[72,792,3312]},Sweetgum__Schematic:{thresholds:[2,14.500420491803279,792.8281936148301],vertexCounts:[138,630,2238]},Southern_Magnolia__Schematic:{thresholds:[2,15.046679712460072,778.8604087591239],vertexCounts:[108,852,3396]},Banana_Tree__Schematic:{thresholds:[2,14.268900557620823,855.4758067831449],vertexCounts:[108,780,2100]},Prickly_Pear_Cactus__Schematic:{thresholds:[2,
14.461720869565228,817.0421426086955],vertexCounts:[72,720,2016]},Generic_Unknown__Schematic:{thresholds:[2,14.366287644787645,899.208477804681],vertexCounts:[108,852,3396]},Palo_Verde__Schematic:{thresholds:[2,28.513162650602432,932.5919321314955],vertexCounts:[138,630,2238]},Lacy_Tree_Philodendron__Schematic:{thresholds:[2,15.89430837004405,797.5864920353984],vertexCounts:[102,570,2154]},Cabbage_Palm_Fern__Schematic:{thresholds:[2,29.3428324742268,1016],vertexCounts:[102,570,2154]},Date_Palm__Schematic:{thresholds:[2,
13.186208480565373,956.3961600000001],vertexCounts:[108,852,3396]},Bamboo__Schematic:{thresholds:[2,114.71951515151522,843.8529763779525],vertexCounts:[60,132,276]},Norway_Spruce__Schematic:{thresholds:[2,129.71889887640438,911.9744719101127],vertexCounts:[66,126,222]},Scots_Pine__Schematic:{thresholds:[2,31.596748201438846,802.180143884892],vertexCounts:[138,630,2238]},American_Sycamore__Schematic:{thresholds:[2,17.793048780487815,818.0204116094988],vertexCounts:[108,852,3396]},White_Poplar__Schematic:{thresholds:[2,
15.577301587301578,793.0779038047372],vertexCounts:[108,780,2100]},Apricot__Schematic:{thresholds:[2,17.03619453924915,796.0093830508479],vertexCounts:[108,852,3396]},Douglas_Fir__Schematic:{thresholds:[2,6.898190007037297,871.0619788881072],vertexCounts:[126,636,1956]},White_Oak__Schematic:{thresholds:[2,13.248768433179723,895.745945945946],vertexCounts:[108,852,3396]},Mediterranean_Buckthorn__Schematic:{thresholds:[2,15.481177685950412,814.9279016681298],vertexCounts:[108,852,3396]},Rhododendron_Azaleas__Schematic:{thresholds:[2,
14.877305555555564,813.5712917369306],vertexCounts:[108,852,3396]},Black_Locust__Schematic:{thresholds:[2,16.01144497607656,791.7159498154983],vertexCounts:[108,852,3396]},Rose__Schematic:{thresholds:[2,14.787227941176468,800.0478006734006],vertexCounts:[108,852,3396]},Mexican_Palmetto__Schematic:{thresholds:[2,13.546397993311047,909.3318618618619],vertexCounts:[108,852,3396]},White_Willow__Schematic:{thresholds:[2,15.464474625144176,821.6042260668969],vertexCounts:[108,852,3396]},Snake_Plant__Schematic:{thresholds:[2,
116.3567710843375,792.3341835147744],vertexCounts:[60,132,276]},Sassafras__Schematic:{thresholds:[2,28.228858319604583,870.7394179022517],vertexCounts:[138,630,2238]},California_Redwood__Schematic:{thresholds:[2,12.938791007615702,889.7742940831868],vertexCounts:[108,780,2100]},Giant_Sequoia__Schematic:{thresholds:[2,13.939714285714274,828.8460395256916],vertexCounts:[138,630,2238]},Common_Whitebeam__Schematic:{thresholds:[2,15.902902542372882,872.9050708661416],vertexCounts:[108,852,3396]},Spanish_Broom__Schematic:{thresholds:[2,
14.866623996789723,815.3769117174961],vertexCounts:[72,792,3312]},Generic_Stump__Schematic:{thresholds:[2,121.01622222222227,923.740137931034],vertexCounts:[60,132,276]},Baldcypress__Schematic:{thresholds:[2,16.348127777777776,817.8199690358902],vertexCounts:[138,630,2238]},Basswood__Schematic:{thresholds:[2,15.118691605839418,835.9789696969701],vertexCounts:[108,852,3396]},Field_Elm__Schematic:{thresholds:[2,15.185642361111121,804.1571316818777],vertexCounts:[108,852,3396]},California_Bay__Schematic:{thresholds:[2,
14.085977419354833,841.5876923076921],vertexCounts:[108,852,3396]},California_Palm__Schematic:{thresholds:[2,13.896321678321671,843.3262657342657],vertexCounts:[138,630,2238]},Sea_Islands_Yucca__Schematic:{thresholds:[2,28.116965753424623,870.5225410421126],vertexCounts:[102,570,2154]}}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){function g(a,b){return l(this,void 0,void 0,function(){function c(e,g){return l(this,void 0,void 0,function(){var k,h,m,p,n,l,r,w,v;return f(this,function(f){switch(f.label){case 0:k=d.nodes[e];h=a.getNodeTransform(e);t.warnUnsupportedIf(null!=k.weights,"Morph targets are not supported.");if(null==k.mesh)return[3,4];m=d.meshes[k.mesh];p=0;n=m.primitives;f.label=1;case 1:if(!(p<n.length))return[3,4];l=n[p];return[4,b(l,h,g,m.name)];case 2:f.sent(),f.label=3;case 3:return p++,
[3,1];case 4:r=0,w=k.children||[],f.label=5;case 5:if(!(r<w.length))return[3,8];v=w[r];return[4,c(v,g)];case 6:f.sent(),f.label=7;case 7:return r++,[3,5];case 8:return[2]}})})}var d,g,k,h,m,p,n,r,v,y;return f(this,function(b){switch(b.label){case 0:d=a.json,g=d.scenes[d.scene||0],k=g.nodes,h=1<k.length,m=0,p=k,b.label=1;case 1:if(!(m<p.length))return[3,4];n=p[m];r=d.nodes[n];v=[c(n,0)];r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!h&&(y=r.extensions.MSFT_lod.ids,
v.push.apply(v,y.map(function(a,b){return c(a,b+1)})));return[4,e.all(v)];case 2:b.sent(),b.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function r(a,b,c){var d=function(b){var d=c+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(d)){var e=n.makeTextureSource(b.data,{wrap:{s:p(b.wrapS),t:p(b.wrapT)},mipmap:x.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(d,e)}return d},e=c+"_mat_"+b.id+"_"+b.name;a.materials.has(e)||(b=n.makeMaterialParameters({color:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?d(b.colorTexture):void 0,textureNormal:b.normalTexture?d(b.normalTexture):void 0,textureOcclusion:b.occlusionTexture?d(b.occlusionTexture):void 0,textureEmissive:b.emissiveTexture?d(b.emissiveTexture):void 0,textureMetallicRoughness:b.metallicRoughnessTexture?d(b.metallicRoughnessTexture):void 0,emissiveFactor:[b.emissiveFactor[0],
b.emissiveFactor[1],b.emissiveFactor[2]],metallicFactor:b.metallicFactor,roughnessFactor:b.roughnessFactor}),a.materials.set(e,b));return e}function p(a){if(33071===a||33648===a||10497===a)return a;t.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var u=0;b.load=function(b,e,k){void 0===k&&(k={});return l(this,void 0,void 0,function(){var h,m,p,n,w=this;return f(this,function(y){switch(y.label){case 0:return[4,c.Resource.load(b,t,e,k)];case 1:return h=
y.sent(),m="gltf_"+u++,p={lods:[],materials:new Map,textures:new Map},n=!(!h.json.asset.extras||"symbolResource"!==h.json.asset.extras.ESRI_type),[4,g(h,function(b,c,e,g){return l(w,void 0,void 0,function(){var n,l,w,y,u,x,A,B,C,q;return f(this,function(f){switch(f.label){case 0:n=void 0!==b.mode?b.mode:4;a:switch(n){case 4:case 5:case 6:l=n;break a;default:l=null}return a.isNone(l)?(t.warnUnsupported("Unsupported primitive mode ("+v[n]+"). Skipping primitive."),[2]):h.hasPositions(b)?[4,h.getMaterial(b,
k)]:(t.warn("Skipping primitive without POSITION vertex attribute."),[2]);case 1:return w=f.sent(),u={transform:d.mat4f64.clone(c)},x={},[4,h.getPositionData(b,k)];case 2:return u.attributes=(x.position=f.sent(),x.normal=null,x.texCoord0=null,x.color=null,x.tangent=null,x),[4,h.getIndexData(b,k)];case 3:y=(u.indices=f.sent(),u.primitiveType=l,u.material=r(p,w,m),u);if(!h.hasNormals(b))return[3,5];A=y.attributes;return[4,h.getNormalData(b,k)];case 4:A.normal=f.sent(),f.label=5;case 5:if(!h.hasTangents(b))return[3,
7];B=y.attributes;return[4,h.getTangentData(b,k)];case 6:B.tangent=f.sent(),f.label=7;case 7:if(!h.hasTextureCoordinates(b))return[3,9];C=y.attributes;return[4,h.getTextureCoordinates(b,k)];case 8:C.texCoord0=f.sent(),f.label=9;case 9:if(!h.hasVertexColors(b))return[3,11];q=y.attributes;return[4,h.getVertexColors(b,k)];case 10:q.color=f.sent(),f.label=11;case 11:return p.lods[e]=p.lods[e]||{parts:[],name:g,lodThreshold:null},p.lods[e].parts.push(y),[2]}})})})];case 2:return y.sent(),[2,{model:p,meta:{isEsriSymbolResource:n,
uri:h.uri},customMeta:{}}]}})})};var t=new k.DefaultErrorContext,x=[9987,9985],v="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Error","../../../core/Logger"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=f.getLogger("esri.views.3d.glTF");q=function(){function a(){}a.prototype.error=function(a){throw new l("gltf-loader-error",a);};a.prototype.errorUnsupported=
function(a){throw new l("gltf-loader-unsupported-feature",a);};a.prototype.errorUnsupportedIf=function(a,b){a&&this.errorUnsupported(b)};a.prototype.assert=function(a,b){a||this.error(b)};a.prototype.warn=function(a){h.warn(a)};a.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};a.prototype.warnUnsupportedIf=function(a,b){a&&this.warnUnsupported(b)};return a}();b.DefaultErrorContext=q})},"esri/views/3d/glTF/LoaderResult":function(){define(["require","exports","../../../core/tsSupport/assignHelper"],
function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.makeMaterialParameters=function(b){void 0===b&&(b={});return l({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},b)};b.makeTextureSource=function(b,h){void 0===
h&&(h={});return{data:b,parameters:l({wrap:l({s:10497,t:10497},h.wrap),noUnpackFlip:!0,mipmap:!1},h)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/promiseUtils ../../../../core/string ../../../../core/urlUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m){function w(b){switch(b.componentType){case 5120:return new y.BufferViewVec2i8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5121:return new y.BufferViewVec2u8(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5122:return new y.BufferViewVec2i16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5123:return new y.BufferViewVec2u16(b.raw,b.byteOffset,b.byteStride,b.byteOffset+
b.byteStride*b.entryCount);case 5125:return new y.BufferViewVec2u32(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);case 5126:return new y.BufferViewVec2f(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount);default:a.neverReached(b.componentType)}}function A(a){return l(this,void 0,void 0,function(){return f(this,function(b){return[2,e.create(function(b,c){var d=new Blob([a]),e=new FileReader;e.onload=function(){b(JSON.parse(e.result))};e.onerror=function(a){c(a)};
e.readAsText(d)})]})})}function B(a,b){return l(this,void 0,void 0,function(){return f(this,function(c){return[2,e.create(function(c,d){var e=new Blob([a],{type:b}),g=URL.createObjectURL(e),f=new Image;f.addEventListener("load",function(){URL.revokeObjectURL(g);c(f)});f.addEventListener("error",function(a){URL.revokeObjectURL(g);d(a)});f.src=g})]})})}Object.defineProperty(b,"__esModule",{value:!0});var C;q=function(){function a(a,b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;
this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=v.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}a.load=function(b,c,e,g){return l(this,
void 0,void 0,function(){var k,h,m,p,l,r;return f(this,function(f){switch(f.label){case 0:if(n.isDataProtocol(e)){k=n.dataComponents(e);if("model/gltf-binary"!==k.mediaType)try{return h=JSON.parse(k.isBase64?atob(k.data):k.data),[2,new a(b,c,e,h)]}catch(V){}m=n.dataToArrayBuffer(e);if(a.isGLBData(m))return[2,this.fromGLBData(b,c,e,m)]}return d.endsWith(e,".gltf")?[4,b.loadJSON(e,g)]:[3,2];case 1:return p=f.sent(),[2,new a(b,c,e,p)];case 2:return[4,b.loadBinary(e,g)];case 3:return l=f.sent(),a.isGLBData(l)?
[2,this.fromGLBData(b,c,e,l)]:[4,b.loadJSON(e,g)];case 4:return r=f.sent(),[2,new a(b,c,e,r)]}})})};a.isGLBData=function(a){a=new t.BinaryStreamReader(a);return 4<=a.remainingBytes()&&1179937895===a.readUint32()};a.fromGLBData=function(b,c,d,e){return l(this,void 0,void 0,function(){var g;return f(this,function(f){switch(f.label){case 0:return[4,a.parseGLBData(c,e)];case 1:return g=f.sent(),[2,new a(b,c,d,g.json,g.binaryData)]}})})};a.parseGLBData=function(a,b){return l(this,void 0,void 0,function(){var c,
d,e,g,k,h,m,p,n;return f(this,function(f){switch(f.label){case 0:c=new t.BinaryStreamReader(b),a.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),d=c.readUint32(),e=c.readUint32(),g=c.readUint32(),a.assert(1179937895===d,"Magic first 4 bytes do not fit to expected GLB value."),a.assert(b.byteLength>=g,"GLB binary data is smaller than header specifies."),a.errorUnsupportedIf(2!==e,"An unsupported GLB container version was detected. Only version 2 is supported."),k=0,f.label=
1;case 1:if(!(8<=c.remainingBytes()))return[3,5];p=c.readUint32();n=c.readUint32();if(0!==k)return[3,3];a.assert(1313821514===n,"First GLB chunk must be JSON.");a.assert(0<=p,"No JSON data found.");return[4,A(c.readUint8Array(p))];case 2:return h=f.sent(),[3,4];case 3:1===k?(a.errorUnsupportedIf(5130562!==n,"Second GLB chunk expected to be BIN."),m=c.readUint8Array(p)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),f.label=4;case 4:return k+=1,[3,1];case 5:return h||a.error("No GLB JSON chunk detected."),
[2,{json:h,binaryData:m}]}})})};a.prototype.getBuffer=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,g;return f(this,function(f){switch(f.label){case 0:return c=this.json.buffers[a],d=this.errorContext,null==c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(e=this.bufferCache.get(a))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri),b)];case 1:g=f.sent(),e=new Uint8Array(g),this.bufferCache.set(a,e),d.assert(e.byteLength===c.byteLength,"Buffer byte lengths should match."),
f.label=2;case 2:return[2,e]}})})};a.prototype.getAccessor=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,g,k,h,m,p;return f(this,function(f){switch(f.label){case 0:return c=this.json.accessors[a],d=this.errorContext,d.errorUnsupportedIf(null==c.bufferView,"Some accessor does not specify a bufferView."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer,b)];case 1:return g=
f.sent(),k=I[c.type],h=K[c.componentType],m=k*h,p=e.byteStride||m,[2,{raw:g.buffer,byteStride:p,byteOffset:g.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:p===m,componentCount:k,componentByteSize:h,componentType:c.componentType,min:c.min,max:c.max,normalized:!!c.normalized}]}})})};a.prototype.getIndexData=function(a,b){return l(this,void 0,void 0,function(){var c;return f(this,function(d){switch(d.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices,
b)];case 1:c=d.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5121:return[2,m.scalar.makeDense(this.wrapAccessor(y.BufferViewUint8,c))];case 5123:return[2,m.scalar.makeDense(this.wrapAccessor(y.BufferViewUint16,c))];case 5125:return[2,m.scalar.makeDense(this.wrapAccessor(y.BufferViewUint32,
c))]}return[2,void 0]}})})};a.prototype.getPositionData=function(a,b){return l(this,void 0,void 0,function(){var c,d;return f(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.POSITION,"No POSITION vertex data found."),[4,this.getAccessor(a.attributes.POSITION,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+H[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,
"POSITION vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(y.BufferViewVec3f,d)]}})})};a.prototype.getNormalData=function(a,b){return l(this,void 0,void 0,function(){var c,d;return f(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.NORMAL,"No NORMAL vertex data found."),[4,this.getAccessor(a.attributes.NORMAL,b)];case 1:return d=e.sent(),c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+
H[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"NORMAL vertex attribute must have 3 components, but found "+d.componentCount.toFixed()),[2,this.wrapAccessor(y.BufferViewVec3f,d)]}})})};a.prototype.getTangentData=function(a,b){return l(this,void 0,void 0,function(){var c,d;return f(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.TANGENT,"No TANGENT vertex data found."),[4,this.getAccessor(a.attributes.TANGENT,b)];case 1:return d=e.sent(),
c.errorUnsupportedIf(5126!==d.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+H[d.componentType]),c.errorUnsupportedIf(4!==d.componentCount,"TANGENT vertex attribute must have 4 components, but found "+d.componentCount.toFixed()),[2,new y.BufferViewVec4f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};a.prototype.getTextureCoordinates=function(a,b){return l(this,void 0,void 0,function(){var c,d;return f(this,function(e){switch(e.label){case 0:return c=
this.errorContext,c.assert(null!=a.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found."),[4,this.getAccessor(a.attributes.TEXCOORD_0,b)];case 1:d=e.sent();c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+d.componentCount.toFixed());if(5126===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec2f,d)];c.errorUnsupportedIf(!d.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return[2,
w(d)]}})})};a.prototype.getVertexColors=function(a,b){return l(this,void 0,void 0,function(){var c,d;return f(this,function(e){switch(e.label){case 0:return c=this.errorContext,c.assert(null!=a.attributes.COLOR_0,"No COLOR_0 vertex data found."),[4,this.getAccessor(a.attributes.COLOR_0,b)];case 1:d=e.sent();c.errorUnsupportedIf(4!==d.componentCount&&3!==d.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+d.componentCount.toFixed());if(4===d.componentCount){if(5126===d.componentType)return[2,
this.wrapAccessor(y.BufferViewVec4f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u16,d)]}else if(3===d.componentCount){if(5126===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec3f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u8,d)];if(5123===d.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u16,d)]}c.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+
H[d.componentType]);return[2,void 0]}})})};a.prototype.hasPositions=function(a){return void 0!==a.attributes.POSITION};a.prototype.hasNormals=function(a){return void 0!==a.attributes.NORMAL};a.prototype.hasVertexColors=function(a){return void 0!==a.attributes.COLOR_0};a.prototype.hasTextureCoordinates=function(a){return void 0!==a.attributes.TEXCOORD_0};a.prototype.hasTangents=function(a){return void 0!==a.attributes.TANGENT};a.prototype.getMaterial=function(a,b){return l(this,void 0,void 0,function(){var c,
d,e,g,k,h,m,p,n,l,r;return f(this,function(f){switch(f.label){case 0:c=this.errorContext;if(d=this.materialCache.get(a.material))return[3,15];e=null!=a.material?x.material(this.json.materials[a.material]):x.material();g=e.pbrMetallicRoughness;k=this.hasVertexColors(a);h=void 0;if(!g.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(g.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported.");return[4,this.getTexture(g.baseColorTexture.index,b)];case 1:h=f.sent(),f.label=2;case 2:m=
void 0;if(!e.normalTexture)return[3,5];if(0===(e.normalTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture.");return[3,5];case 3:return[4,this.getTexture(e.normalTexture.index,b)];case 4:m=f.sent(),f.label=5;case 5:p=void 0;if(!e.occlusionTexture)return[3,8];if(0===(e.occlusionTexture.texCoord||0))return[3,6];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture.");return[3,8];case 6:return[4,this.getTexture(e.occlusionTexture.index,
b)];case 7:p=f.sent(),f.label=8;case 8:n=void 0;if(!e.emissiveTexture)return[3,11];if(0===(e.emissiveTexture.texCoord||0))return[3,9];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture.");return[3,11];case 9:return[4,this.getTexture(e.emissiveTexture.index,b)];case 10:n=f.sent(),f.label=11;case 11:l=void 0;if(!g.metallicRoughnessTexture)return[3,14];if(0===(g.metallicRoughnessTexture.texCoord||0))return[3,12];c.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture.");
return[3,14];case 12:return[4,this.getTexture(g.metallicRoughnessTexture.index,b)];case 13:l=f.sent(),f.label=14;case 14:r=null!=a.material?a.material:-1,d={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:g.baseColorFactor,doubleSided:!!e.doubleSided,colorTexture:h,normalTexture:m,name:e.name,id:r,occlusionTexture:p,emissiveTexture:n,emissiveFactor:e.emissiveFactor,metallicFactor:g.metallicFactor,roughnessFactor:g.roughnessFactor,metallicRoughnessTexture:l,vertexColors:k,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},
f.label=15;case 15:return[2,d]}})})};a.prototype.getTexture=function(a,b){return l(this,void 0,void 0,function(){var c,d,e,g,k,h,m,p;return f(this,function(f){switch(f.label){case 0:c=this.errorContext;d=this.json.textures[a];e=x.textureSampler(null!=d.sampler?this.json.samplers[d.sampler]:{});c.errorUnsupportedIf(null==d.source,"Source is expected to be defined for a texture.");g=this.json.images[d.source];if(k=this.textureCache.get(a))return[3,6];h=void 0;return g.uri?[4,this.context.loadImage(this.resolveUri(g.uri),
b)]:[3,2];case 1:return h=f.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==g.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==g.mimeType,"Image mimeType must be defined."),m=this.json.bufferViews[g.bufferView],[4,this.getBuffer(m.buffer,b)];case 3:return p=f.sent(),c.errorUnsupportedIf(null!=m.byteStride,"byteStride not supported for image buffer"),[4,B(new Uint8Array(p.buffer,p.byteOffset+(m.byteOffset||0),m.byteLength),g.mimeType)];case 4:h=f.sent(),f.label=5;case 5:k=
{data:h,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:g.name,id:a},this.textureCache.set(a,k),f.label=6;case 6:return[2,k]}})})};a.prototype.getNodeTransform=function(a){if(void 0===a)return G;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),c=this.json.nodes[a];if(c.matrix)b=g.mat4.multiply(r.mat4f64.create(),b,c.matrix);else if(c.translation||c.rotation||c.scale)b=r.mat4f64.clone(b),c.translation&&g.mat4.translate(b,b,c.translation),c.rotation&&
(J[3]=p.quat.getAxisAngle(J,c.rotation),g.mat4.rotate(b,b,J[3],J)),c.scale&&g.mat4.scale(b,b,c.scale);this.nodeTransformCache.set(a,b)}return b};a.prototype.wrapAccessor=function(a,b){return new a(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*(b.entryCount-1)+b.componentByteSize*b.componentCount)};a.prototype.resolveUri=function(a){return k.makeAbsolute(a,this.baseUri)};a.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};a.prototype.checkVersionSupported=function(){var a=
c.Version.parse(this.json.asset.version,"glTF");E.validate(a)};a.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+a.extensionsRequired.join(", "))};a.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};
return a}();b.Resource=q;var E=new c.Version(2,0,"glTF"),G=g.mat4.fromXRotation(r.mat4f64.create(),Math.PI/2),J=u.quatf64.create(),I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},K=(C={},C[5120]=1,C[5121]=1,C[5122]=2,C[5123]=2,C[5126]=4,C[5125]=4,C),H={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require","exports","./Error"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,
a,e){void 0===e&&(e="");this.major=b;this.minor=a;this._context=e}b.prototype.lessThan=function(b,a){return this.major<b||b===this.major&&this.minor<a};b.prototype.since=function(b,a){return!this.lessThan(b,a)};b.prototype.validate=function(b){if(this.major!==b.major)throw new l((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:b});};b.prototype.clone=function(){return new b(this.major,
this.minor,this._context)};b.parse=function(f,a){void 0===a&&(a="");var e=f.split("."),d=e[0],e=e[1],k=/^\s*\d+\s*$/;if(!d||!d.match||!d.match(k))throw new l((a&&a+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!e||!e.match||!e.match(k))throw new l((a&&a+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:f});f=parseInt(d,10);d=parseInt(e,10);return new b(f,d,a)};return b}();b.Version=q})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.data=b;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}b.prototype.readUint32=function(){var b=this.offset4;this.offset4+=1;return this.dataUint32[b]};b.prototype.readUint8Array=function(b){var f=4*this.offset4;this.offset4+=b/4;return new Uint8Array(this.data,f,b)};b.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};
return b}();b.BinaryStreamReader=q})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/compilerUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},a={pbrMetallicRoughness:h,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},e={ESRI_externalColorMixMode:"tint"};b.material=function(b){void 0===b&&
(b={});var d=l({},h,b.pbrMetallicRoughness),c=l({},e,b.extras);switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:f.neverReached(c.ESRI_externalColorMixMode),c.ESRI_externalColorMixMode="tint"}return l({},a,b,{pbrMetallicRoughness:d,extras:c})};var d={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.textureSampler=function(a){return l({},d,a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(q,
b){Object.defineProperty(b,"__esModule",{value:!0});b.splitURI=function(b){var f,h;b.replace(/^(.*\/)?([^/]*)$/,function(a,b,d){f=b||"";h=d||"";return""});return{dirPart:f,filePart:h}}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=f;b.mat4=h;b.scalar=a;b.vec2=e;b.vec3=d;b.vec4=k;b.createBuffer=
function(a,b){return new a(new ArrayBuffer(b*a.ElementCount*l.elementTypeSize(a.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,h){var a=b.typedBuffer;b=b.typedBufferStride;var e=f.typedBuffer,d=f.typedBufferStride;f=h?h.count:f.count;var k=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*d;for(var n=0;n<f;++n){for(var c=0;9>c;++c)a[k+c]=e[h+c];k+=b;
h+=d}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,h){var a=b.typedBuffer;b=b.typedBufferStride;var e=f.typedBuffer,d=f.typedBufferStride;f=h?h.count:f.count;var k=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*d;for(var n=0;n<f;++n){for(var c=0;16>c;++c)a[k+c]=e[h+c];k+=b;h+=d}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,h){var a=b.typedBuffer;b=b.typedBufferStride;var e=f.typedBuffer,d=f.typedBufferStride;f=h?h.count:f.count;var k=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*d;for(var n=0;n<f;++n)a[k]=e[h],k+=b,h+=d};b.makeDense=function(b,f){var h=b.count;f||(f=new b.TypedArrayConstructor(h));for(var a=0;a<h;a++)f[a]=b.get(a);return f}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports",
"../types"],function(q,b,l){function f(b,a,e){var d=b.typedBuffer;b=b.typedBufferStride;var f=a.typedBuffer,h=a.typedBufferStride;a=e?e.count:a.count;var c=(e&&e.dstIndex?e.dstIndex:0)*b;e=(e&&e.srcIndex?e.srcIndex:0)*h;for(var g=0;g<a;++g)d[c]=f[e],d[c+1]=f[e+1],c+=b,e+=h}Object.defineProperty(b,"__esModule",{value:!0});b.copy=f;b.normalizeIntegerBuffer=function(b,a,e){var d=b.typedBuffer,k=b.typedBufferStride,h=a.typedBuffer,c=a.typedBufferStride,g=e?e.count:a.count,r=(e&&e.dstIndex?e.dstIndex:
0)*k,p=(e&&e.srcIndex?e.srcIndex:0)*c;if(l.isInteger(a.elementType))if(e=l.maximumValue(a.elementType),l.isSigned(a.elementType))for(a=0;a<g;++a)d[r]=Math.max(h[p]/e,-1),d[r+1]=Math.max(h[p+1]/e,-1),r+=k,p+=c;else for(a=0;a<g;++a)d[r]=h[p]/e,d[r+1]=h[p+1]/e,r+=k,p+=c;else f(b,a,e);return b}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,h){var a=b.typedBuffer;b=b.typedBufferStride;
var e=f.typedBuffer,d=f.typedBufferStride;f=h?h.count:f.count;var k=(h&&h.dstIndex?h.dstIndex:0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*d;for(var n=0;n<f;++n)a[k]=e[h],a[k+1]=e[h+1],a[k+2]=e[h+2],k+=b,h+=d}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,h){var a=b.typedBuffer;b=b.typedBufferStride;var e=f.typedBuffer,d=f.typedBufferStride;f=h?h.count:f.count;var k=(h&&h.dstIndex?h.dstIndex:
0)*b;h=(h&&h.srcIndex?h.srcIndex:0)*d;for(var n=0;n<f;++n)a[k]=e[h],a[k+1]=e[h+1],a[k+2]=e[h+2],a[k+3]=e[h+3],k+=b,h+=d};b.fill=function(b,f,h,a,e,d){var k=b.typedBuffer,n=b.typedBufferStride;b=d?d.count:b.count;d=(d&&d.dstIndex?d.dstIndex:0)*n;for(var c=0;c<b;++c)k[d]=f,k[d+1]=h,k[d+2]=a,k[d+3]=e,d+=n}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(q,b,l,f){function h(a){return f.generateDefaultIndexArray(a)}
Object.defineProperty(b,"__esModule",{value:!0});b.linearIndexArray=h;b.trianglesToTriangles=function(a){return"number"===typeof a?h(a):l.isUint16Array(a)||l.isUint8Array(a)?new Uint32Array(a):a};b.triangleStripToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,d=new Uint32Array(3*b);if("number"===typeof a)for(var f=0,h=0;h<b;h+=1)0===h%2?(d[f++]=h,d[f++]=h+1):(d[f++]=h+1,d[f++]=h),d[f++]=h+2;else for(h=f=0;h<b;h+=1){if(0===h%2)var c=a[h],g=a[h+
1],l=a[h+2];else c=a[h+1],g=a[h],l=a[h+2];d[f++]=c;d[f++]=g;d[f++]=l}return d};b.triangleFanToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,d=new Uint32Array(3*b);if("number"===typeof a){for(var f=0,h=0;h<b;++h)d[f++]=0,d[f++]=h+1,d[f++]=h+2;return d}for(var c=a[0],g=a[1],h=f=0;h<b;++h){var l=a[h+2];d[f++]=c;d[f++]=g;g=d[f++]=l}return d}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m){function w(b,d){return h(this,void 0,void 0,function(){var k,h;return f(this,function(f){switch(f.label){case 0:return(k=c.isSome(d)&&d.streamDataRequester)?[2,A(b,k,d)]:[4,e.result(a(b,c.unwrap(d)))];case 1:h=f.sent();if(!0===h.ok)return[2,h.value.data];g.throwIfAbortError(h.error);B(h.error);return[2,void 0]}})})}function A(a,b,c){return h(this,void 0,void 0,function(){var d;return f(this,function(f){switch(f.label){case 0:return[4,e.result(b.request(a,
"json",c))];case 1:d=f.sent();if(!0===d.ok)return[2,d.value];g.throwIfAbortError(d.error);B(d.error.details.url);return[2,void 0]}})})}function B(a){throw new d("","Request for object resource failed: "+a);}function C(a,b){return h(this,void 0,void 0,function(){var d,e,g,h,n,l,w,t,y,u,A,B,C,q,H,L,ha,ka,ba,qa,ja,la,ma,ta,ua,sa,xa,ra,oa,pa,ia,na,ya,da,Oa;return f(this,function(f){switch(f.label){case 0:return g=[],h=[],n=[],l=[],w=r.Version.parse(a.version||"1.0","wosr"),K.validate(w),t="meshsymbol_"+
a.model.name,y=a.textureDefinitions,[4,G(t,y,b)];case 1:u=f.sent();for(A in u)l.push(u[A].engineTexObj);B=a.model.geometries;C=a.materialDefinitions;for(H=q=0;H<B.length;H++){var O=L=B[H],N=O.params,R=N.topology;f=!0;N.vertexAttributes||(I.warn("Geometry must specify vertex attributes"),f=!1);switch(N.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:R=N.faces;if(!R)I.warn("Indexed geometries must specify faces"),f=!1;else if(N.vertexAttributes){var U=void 0;for(U in N.vertexAttributes)(N=
R[U])&&N.values?(null!=N.valueType&&"UInt32"!==N.valueType&&(I.warn("Unsupported indexed geometry indices type '"+N.valueType+"', only UInt32 is currently supported"),f=!1),null!=N.valuesPerElement&&1!==N.valuesPerElement&&(I.warn("Unsupported indexed geometry values per element '"+N.valuesPerElement+"', only 1 is currently supported"),f=!1)):(I.warn("Indexed geometry does not specify face indices for '"+U+"' attribute"),f=!1)}break;default:I.warn("Unsupported topology '"+R+"'"),f=!1}O.params.material||
(I.warn("Geometry requires material"),f=!1);O=O.params.vertexAttributes;N=void 0;for(N in O)O[N].values||(I.warn("Geometries with externally defined attributes are not yet supported"),f=!1);if(f){f=L.params;d=f.material;e=f.texture;ha=L.params.vertexAttributes;ka={};for(ba in ha)qa=ha[ba],ja=qa.values,ka[ba]={data:ja,size:qa.valuesPerElement};la={};if("PerAttributeArray"===L.params.topology){f=ma=ka.position.data.length/ka.position.size;O=new Uint32Array(f);for(N=0;N<f;N++)O[N]=N;ta=O;for(ua in ka)la[ua]=
ta}else for(xa in sa=L.params.faces,sa)la[xa]=new Uint32Array(sa[xa].values);ra=e?u[e]:null;oa=n[d]?n[d][e]:null;oa||(pa=d.substring(d.lastIndexOf("/")+1),ia=C[pa].params,1===ia.transparency&&(ia.transparency=0),na=ra&&ra.alphaChannelUsage,ya=0<ia.transparency||"transparency"===na||"maskAndTransparency"===na,da={ambient:p.vec3f64.fromArray(ia.diffuse),diffuse:p.vec3f64.fromArray(ia.diffuse),opacity:1-(ia.transparency||0),transparent:ya,textureAlphaMode:ra?J(ra.alphaChannelUsage):void 0,textureAlphaCutoff:.33,
textureId:ra?ra.engineTexObj.id:void 0,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:ia.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},c.isSome(b)&&b.materialParamsMixin&&k.mixin(da,b.materialParamsMixin),oa=new m(da,t),n[d]||(n[d]={}),n[d][e]=oa);h.push(oa);Oa=new x(new v.GeometryData(ka,la),t);q+=la.position?la.position.length:0;g.push(Oa)}}return[2,{name:t,stageResources:{textures:l,materials:h,geometries:g},pivotOffset:a.model.pivotOffset,boundingBox:E(g),numberOfVertices:q,
lodThreshold:null}]}})})}function E(a){var b=u.empty();a.forEach(function(a){a=a.boundingInfo;u.expand(b,a.getBBMin());u.expand(b,a.getBBMax())});return b}function G(a,b,d){return h(this,void 0,void 0,function(){var e,k,h,m,p,n,l,r;return f(this,function(f){switch(f.label){case 0:e=[];k=function(f){var k=b[f],h=k.images[0].data;if(!h)return I.warn("Externally referenced texture data is not yet supported"),"continue";var h=k.encoding+";base64,"+h,m="/textureDefinitions/"+f,p={noUnpackFlip:!0,wrap:{s:10497,
t:10497},preMultiplyAlpha:!0};f=c.isSome(d)&&d.disableTextures?g.resolve(null):t.requestImage(h,d);e.push(f.then(function(b){return{refId:m,engineTexObj:new y(b,a,p),alphaChannelUsage:"rgba"===k.channels?k.alphaChannelUsage||"transparency":"none"}}))};for(h in b)k(h);return[4,g.all(e)];case 1:m=f.sent();p={};n=0;for(l=m;n<l.length;n++)r=l[n],p[r.refId]=r;return[2,p]}})})}function J(a){switch(a){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";case "none":return"opaque";case "transparency":return"blend";
default:return"blend"}}Object.defineProperty(b,"__esModule",{value:!0});var I=n.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");b.load=function(a,b){return h(this,void 0,void 0,function(){var c;return f(this,function(d){switch(d.label){case 0:return[4,w(a,b)];case 1:return c=d.sent(),[2,C(c,b)]}})})};b.createStageResources=C;var K=new r.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});b.vec3=l;b.vec4=f})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var e=b.count,d=a[0],f=a[1],n=a[2],c=a[3],g=a[4],r=a[5],p=a[6],u=a[7],t=a[8],x=a[9],v=a[10],y=a[11],m=a[12],w=a[13],A=a[14];a=a[15];var B=b.typedBuffer;
b=b.typedBufferStride;var C=h.typedBuffer;h=h.typedBufferStride;for(var q=0;q<e;q++){var G=q*b,J=q*h,I=C[J],K=C[J+1],H=C[J+2],J=C[J+3];B[G]=d*I+g*K+t*H+m*J;B[G+1]=f*I+r*K+x*H+w*J;B[G+2]=n*I+p*K+v*H+A*J;B[G+3]=c*I+u*K+y*H+a*J}}};b.transformMat3=function(b,h,a){if(b.count!==h.count)l.logger.error("source and destination buffers need to have the same number of elements");else{var e=b.count,d=a[0],f=a[1],n=a[2],c=a[3],g=a[4],r=a[5],p=a[6],u=a[7];a=a[8];var t=b.typedBuffer;b=b.typedBufferStride;var x=
h.typedBuffer;h=h.typedBufferStride;for(var v=0;v<e;v++){var y=v*b,m=v*h,w=x[m],A=x[m+1],B=x[m+2],m=x[m+3];t[y]=d*w+c*A+p*B;t[y+1]=f*w+g*A+u*B;t[y+2]=n*w+r*A+a*B;t[y+3]=m}}};b.scale=function(b,h,a){var e=Math.min(b.count,h.count),d=b.typedBuffer;b=b.typedBufferStride;var f=h.typedBuffer;h=h.typedBufferStride;for(var n=0;n<e;n++){var c=n*b,g=n*h;d[c]=a*f[g];d[c+1]=a*f[g+1];d[c+2]=a*f[g+2];d[c+3]=a*f[g+3]}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C){function E(a,b,c,d){w.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,a.model,b);c.modelNormal.copyFrom(d,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(d,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,a.featureAttribute,b)}Object.defineProperty(b,"__esModule",{value:!0});var G=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new x.LevelSelector(b,a)};b.setLevelSelectorFactory=function(a){G=a};var J=function(){function a(a,b){var c=a.rctx,d=b.geometry;b=b.material;var e=d.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var f=a.vertexBufferLayout,k=a.elementCount(e),h=a.allocate(k);a.write({},e,h,0);this.geometry=d;this.material=b;this.glMaterials=w.acquireMaterials(b,this.materialRep);this.vertexBufferLayout=f;this.vbo=A.createVertex(c,
35044,h.buffer);this.vao=new C(c,g.Default3D,{geometry:n.glLayout(f)},{geometry:this.vbo});this.vertexCount=k}a.prototype.destroy=function(){w.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=
function(a,b,c,d,e,g){var f=this.geometry.id,k=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,c,d,function(c,d,h,m){if(0<=c&&(null==b||b(a.rayBeginPoint,a.rayEndPoint,c))){var p={type:"external",metadata:{layerUid:g.layerUid,graphicUid:g.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||m>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||c<a.results.min.dist)a.results.min.set(p,k,c,d,a.transform.transform,m,null,f,h),a.results.min.intersector="LodRenderer";
0!==a.options.store&&(null==a.results.max.drapedLayerOrder||m>=a.results.max.drapedLayerOrder)&&(null==a.results.max.dist||c>a.results.max.dist)&&(a.results.max.set(p,k,c,d,a.transform.transform,m,null,f,h),a.results.min.intersector="LodRenderer");if(2===a.options.store){var n=new r.IntersectorResult(a.results.min.ray);n.set(p,k,c,d,a.transform.transform,m,null,f,h);n.intersector="LodRenderer";a.results.all.push(n)}}})};return a}();b.LodComponentData=J;var I=function(){function b(a,b){var c=this;
this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new J(a,b))})}b.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};b.prototype.intersect=function(a,b,c,d,e,g){this.components.forEach(function(f){f.intersect(a,b,c,d,e,g)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=d.empty();this.components.forEach(function(b){d.expand(a,b.boundingInfo.bbMin);d.expand(a,
b.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,c=a.vec3f64.create();d.center(b,c);this._boundingSphere={center:c,radius:.5*d.diameter(b)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},
0)},enumerable:!0,configurable:!0});return b}();b.LodLevelData=I;q=function(){function d(a,d,e,g){var f=this;this.type="Lod";this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new c.default;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=a;this._optionalFields=d;this._metadata=e;this._instanceBufferLayout=y.getInstanceBufferLayout({instancedDoublePrecision:!0,
instanced:d});this._glInstanceBufferLayout=n.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new u.InstanceData(this._optionalFields,g);this._instanceData.on("instance-added",function(){f.requestUpdateCycle()});this._instanceData.on("instance-removed",function(){f.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(){f.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(){f.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",
function(){f.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;b.lodRenderers.push(this)}d.prototype.destroy=function(){b.lodRenderers.splice(b.lodRenderers.indexOf(this),1)};Object.defineProperty(d.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"slicePlane",{get:function(){return this._slicePlane},set:function(a){this._slicePlane=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"intersectionHandlerId",
{get:function(){return this._metadata.layerUid},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,
configurable:!0});d.prototype.initializeRenderContext=function(a){var b=this;this._initContext=a;var c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new I(a,d));b._renderInstanceData.push(new v.RenderInstanceData(c,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new v.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=G(this)};d.prototype.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});
this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(d.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});d.prototype.prepareRender=function(a){this.runUpdates(a)};d.prototype.render=function(a){var b=a.rctx,c=5===a.slot?4:7===a.slot?6:null;if(c){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleInPass(a.pass))return!1;var d=a.camera,d={view:d.viewMatrix,proj:d.projectionMatrix,origin:[0,0,0],viewInvTransp:d.viewInverseTransposeMatrix,viewport:d.viewport,fovY:d.fovY,nearFar:[d.near,d.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:d.pixelRatio,slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:d.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?
a.offscreenRenderingHelper.hudVisibilityTexture:null};b.bindVAO();for(b=0;b<this._levels.length;++b)this.renderLevel(a,c,d,a.isHighlightPass?this._highlightRenderInstanceData[b]:this._renderInstanceData[b],b);return!0}};d.prototype.intersect=function(b,c,d,e){var g=this;if(this.baseMaterial.isVisible()){var f=a.vec3f64.create();h.vec3.subtract(f,e,d);var k=function(a){g._instanceData.getCombinedModelTransform(a,L);b.transform.set(L);h.vec3.transformMat4(P,d,b.transform.inverse);h.vec3.transformMat4(S,
e,b.transform.inverse);var f=g._instanceData.getState(a),k=g._instanceData.getLodLevel(a);p.assert(f&u.StateFlags.ACTIVE,"invalid instance state");p.assert(0<=k&&k<g._levels.length,"invaid lod level");g._levels[k].intersect(b,c,P,S,a,g._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(k):this.octree.forEachAlongRay(d,f,k)}};d.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};d.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};
d.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};Object.defineProperty(d.prototype,"needsUpdates",{get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera},enumerable:!0,configurable:!0});d.prototype.runUpdates=function(a){if(!k.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var b=a.equals(this._lastCamera);this._lastCamera.copyFrom(a);
b||this.requestUpdateCycle()}b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b);this.needsUpdates&&this._initContext.requestRender()}};Object.defineProperty(d.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});d.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};d.prototype.buildOctree=function(){for(var a=new t.InstanceOctree(this._instanceData,
this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&u.StateFlags.ACTIVE&&a.addInstance(c);return a};d.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this.octree.findClosest(c,"front-to-back",a.frustum),e=this.octree.findClosest(c,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,H),h.vec3.subtract(H,H,b),d=h.vec3.dot(H,c)-H[3],this._instanceData.view.boundingSphere.getVec(e,
H),h.vec3.subtract(H,H,b),b=h.vec3.dot(H,c)+H[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};d.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};d.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,d=this._levelSelector;
d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,g=a.capacity,f=this._instanceIndex;b=Math.min(a.size,b);for(var k=0;k<b;++k){0===f&&this.startUpdateCycle();var h=e.state.get(f),m=0;if(h&u.StateFlags.ALLOCATED){var p=e.lodLevel.get(f);h&u.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail();h&u.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail();
if(h&u.StateFlags.REMOVE)a.freeInstance(f);else if(h&u.StateFlags.VISIBLE){p=0;c&&(e.modelOrigin.getVec(f,K),p=d.selectLevel(K,a.getCombinedMedianScaleFactor(f)));m=h&~(u.StateFlags.ACTIVE|u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED);if(0<=p){var n=this._renderInstanceData[p],l=n.allocateHead();E(e,f,n.view,l);m|=u.StateFlags.ACTIVE;h&u.StateFlags.HIGHLIGHT&&(n=this._highlightRenderInstanceData[p],l=n.allocateHead(),E(e,f,n.view,l),m|=u.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(f,
m);e.lodLevel.set(f,p)}else m=h&~(u.StateFlags.ACTIVE|u.StateFlags.HIGHLIGHT_ACTIVE|u.StateFlags.TRANSFORM_CHANGED),e.state.set(f,m);this._octree&&(p=!!(h&u.StateFlags.ACTIVE),m=!!(m&u.StateFlags.ACTIVE),!p&&m?this._octree.addInstance(f):p&&!m?this._octree.removeInstance(f):p&&m&&h&u.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(f),this._octree.addInstance(f)));f=(f+1)%g}else f=(f+1)%g,b++}this._instanceIndex=f;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};
d.prototype.renderLevel=function(a,b,c,d,e){var g=this;this._levels[e].components.forEach(function(f){g.renderComponent(a,b,c,d,f,e)})};d.prototype.renderComponent=function(a,b,c,d,e,f){var h=e.glMaterials.get(a.pass);if(h&&h.beginSlot(b)&&0!==d.size){var n=a.rctx,l=n.capabilities.instancing,r=h.getTechnique();c.origin=[0,0,0];h.bind(n,c);n.bindVAO(e.vao);r.ensureAttributeLocations(e.vao);b=r.program;a.isHighlightPass&&(n.bindTexture(a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:
null,5),b.setUniform1i("depthTex",5),b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3]));h.bindView(c);k.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(b.setUniform4fv("externalColor",R[Math.min(f,R.length-1)]),b.setUniform1i("colorMixMode",m.colorMixModes.replace));a=d.capacity;c=d.headIndex;f=d.tailIndex;var h=d.firstIndex,w=this._glInstanceBufferLayout;b=function(a,b){B.bindVertexBufferLayout(n,g.Default3D,d.buffer,w,a);l.drawArraysInstanced(r.primitiveType,0,
e.vertexCount,b-a);B.unbindVertexBufferLayout(n,g.Default3D,d.buffer,w)};e.material.getParameters().transparent&&null!=h?c>f?(p.assert(h>=f&&h<=c,"invalid firstIndex"),b(h,c),b(f,h)):c<f&&(h<=c?(p.assert(0<=h&&h<=c,"invalid firstIndex"),b(h,c),b(f,a),b(0,h)):(p.assert(h>=f&&h<=a,"invalid firstIndex"),b(h,a),b(0,c),b(f,h))):c>f?b(f,c):c<f&&(b(0,c),b(f,a));n.bindVAO(null)}};return d}();b.LodRenderer=q;b.lodRenderers=[];var K=a.vec3f64.create(),H=e.vec4f64.create(),L=f.mat4f64.create(),P=a.vec3f64.create(),
S=a.vec3f64.create(),R=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/Evented ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});var u;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(u=b.StateFlags||(b.StateFlags={}));var t=function(){return function(a){this.localTransform=a.getField("localTransform",g.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
g.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",g.BufferViewVec3f64);this.model=a.getField("model",g.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",g.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",g.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",g.BufferViewVec4f64);this.color=a.getField("color",g.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",g.BufferViewVec4f);this.state=a.getField("state",g.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",g.BufferViewUint8)}}();b.View=t;q=function(a){function b(b,c){var d=a.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=r.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=b.indexOf("color")&&(e=e.vec4f("color"));0<=b.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=c;return d}l(b,a);Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});b.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,u.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};b.prototype.removeInstance=function(a){var b=this._view.state;p.assert(0<=a&&a<this._capacity&&b.get(a)&u.ALLOCATED,"invalid instance handle");this.getStateFlag(a,u.ACTIVE)?this.setStateFlags(a,u.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};b.prototype.freeInstance=function(a){var b=this._view.state;p.assert(0<=
a&&a<this._capacity&&b.get(a)&u.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};b.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};b.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};b.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};b.prototype.getGlobalTransform=function(a,b){this._view.globalTransform.getMat(a,
b)};b.prototype.updateModelTransform=function(a){var b=this._view,d=y,g=m;b.localTransform.getMat(a,w);b.globalTransform.getMat(a,A);var f=e.mat4.multiply(A,A,w);k.vec3.set(d,f[12],f[13],f[14]);b.modelOrigin.setVec(a,d);h.mat3.fromMat4(g,f);b.model.setMat(a,g);d=c.scaleFromMatrix(y,f);d.sort();b.modelScaleFactors.set(a,0,d[1]);b.modelScaleFactors.set(a,1,d[2]);h.mat3.invert(g,g);h.mat3.transpose(g,g);b.modelNormal.setMat(a,g);this.setStateFlags(a,u.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:a})};b.prototype.getModelTransform=function(a,b){var c=this._view;c.model.getMat(a,m);c.modelOrigin.getVec(a,y);b[0]=m[0];b[1]=m[1];b[2]=m[2];b[3]=0;b[4]=m[3];b[5]=m[4];b[6]=m[5];b[7]=0;b[8]=m[6];b[9]=m[7];b[10]=m[8];b[11]=0;b[12]=y[0];b[13]=y[1];b[14]=y[2];b[15]=1};b.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};b.prototype.getCombinedModelTransform=function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,a,b);return b};b.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};b.prototype.getCombinedMaxScaleFactor=function(a){var b=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(y,this,a),b*=Math.max(a[0],a[1],a[2]));return b};b.prototype.getCombinedMedianScaleFactor=function(a){var b=
this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(y,this,a),a.sort(),b*=a[1]);return b};b.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};b.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};b.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};b.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};b.prototype.getColor=function(a,b){this._view.color.getVec(a,
b)};b.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,u.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};b.prototype.getVisible=function(a){return this.getStateFlag(a,u.VISIBLE)};b.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,u.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};b.prototype.getHighlight=function(a){return this.getStateFlag(a,u.HIGHLIGHT)};b.prototype.getState=function(a){return this._view.state.get(a)};
b.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};b.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};b.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};b.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};b.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};b.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&
b)};b.prototype.grow=function(){var a=Math.max(x,Math.floor(this._capacity*v)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=a;this._buffer=b;this._view=new t(this._buffer)};b.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&u.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};return b}(f);b.InstanceData=q;var x=1024,v=2,y=n.vec3f64.create(),m=a.mat3f64.create(),
w=d.mat4f64.create(),A=d.mat4f64.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(c,d){var e=b.call(this,[0,0,0],1,{getCenter:function(a){var b=
e._instanceData.view.boundingSphere,c=e._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return e._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;e._tmpCenter=a.vec3f64.create();e._tmpMat4=f.mat4f64.create();e._instanceData=c;e._boundingSphere=d;return e}l(d,b);d.prototype.addInstance=function(a){var b=this._instanceData.view.boundingSphere,c=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),d=h.vec3.transformMat4(this._tmpCenter,
this._boundingSphere.center,c),c=this._boundingSphere.radius*e.maxScale(c);b.set(a,0,d[0]);b.set(a,1,d[1]);b.set(a,2,d[2]);b.set(a,3,c);this.add(a)};d.prototype.removeInstance=function(a){this.remove(a)};return d}(d);b.InstanceOctree=q})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a){this.thresholdScale=1;this._camera=new l.default;this._worldSpaceRadius=
b;this._thresholds=a.map(function(a){return a})}b.prototype.updateCamera=function(b){this._camera.copyFrom(b)};b.prototype.selectLevel=function(b,a){b=this._camera.computeScreenPixelSizeAt(b);a=this._worldSpaceRadius*a/b;b=this._thresholds;for(var e=-1,d=0;d<b.length;++d)a>=b[d]*this.thresholdScale&&(e=d);return e};return b}();b.LevelSelector=q})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","../Util",
"./BackedBufferObject"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",l.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",l.BufferViewVec3f);this.model=a.getField("model",l.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",l.BufferViewMat3f);this.color=a.getField("instanceColor",l.BufferViewVec4f);this.featureAttribute=a.getField("instanceFeatureAttribute",l.BufferViewVec4f)}}();
b.View=a;q=function(){function b(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}b.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFull",{get:function(){return this._tailIndex===
(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return this._buffer?
this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};b.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};b.prototype.beginUpdate=function(){f.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};b.prototype.endUpdate=function(){f.assert(this._updating,"not updating");this.size<k*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),
this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};b.prototype.allocateHead=function(){f.assert(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();f.assert(this._headIndex!==this._tailIndex,"invalid pointers");return a};b.prototype.freeTail=function(){f.assert(this._updating,"not updating");f.assert(0<this.size,"invalid size");var a=this._tailIndex===
this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};b.prototype.grow=function(){this.resize(Math.max(e,Math.floor(this._capacity*d)))};b.prototype.shrink=function(){c&&this.resize(Math.max(e,Math.floor(this._capacity*n)))};b.prototype.resize=function(b){f.assert(this._updating,"not updating");if(b!==this._capacity){var c=new h(this._rctx,34962,35044,this._elementSize,b);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%
this._capacity);var d=this.size,e=this.compactInstances(c);f.assert(e===d,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=e;this._prevHeadIndex=0}this._resized=!0;this._capacity=b;this._buffer=c;this._view=new a(this._instanceBufferLayout.createView(this._buffer.array))}};b.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,
b,a,this._capacity-c),b+(this._capacity-c)):0};b.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};b.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};b.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return b}();b.RenderInstanceData=q;var e=1024,d=2,k=.3,n=.5,c=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require",
"exports","../../../../webgl/BufferObject"],function(q,b,l){return function(){function b(b,a,e,d,f){this._elementSize=d;this._buffer=new l(b,a,e);this.resize(f)}b.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(b.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"array",{get:function(){return this._array},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});b.prototype.copyRange=function(b,a,e,d){void 0===d&&(d=0);b=new Uint8Array(this.array,b*this.elementSize,(a-b)*this.elementSize);(new Uint8Array(e.array,d*this.elementSize)).set(b)};
b.prototype.transferAll=function(){this._buffer.setData(this._array)};b.prototype.transferRange=function(b,a){b*=this._elementSize;this._buffer.setSubData(this._array,b,b,a*this._elementSize)};b.prototype.resize=function(b){var a=b*this._elementSize,e=new ArrayBuffer(a);this._array&&(b>=this._capacity?(new Uint8Array(e)).set(new Uint8Array(this._array)):(new Uint8Array(e)).set((new Uint8Array(this._array)).subarray(0,b*this._elementSize)));this._array=e;this._buffer.setData(a);this._capacity=b};return b}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/lang ../../../../core/mathUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L){function P(a,b,d){switch(b){case "world":for(var e=0,g=a.vertices;e<g.length;e++)b=g[e],p.vec3.add(N,b.pos,a.offset),d.worldUpAtPosition(N,Y),b.setFrameFromUpVector(Y),b.computeRotationAxisAndAngleFromUpVector();break;case "path":for(p.vec3.add(N,a.vertices[0].pos,a.offset),d.worldUpAtPosition(N,Y),I.computeMinimumRotationTangentFrame(a,Y),d=0,a=a.vertices;d<a.length;d++){b=a[d];e=k.sign(p.vec3.dot(b.frame.right,b.vRight));p.vec3.cross(b.rotationFrame.up,
b.vRight,b.vLeft);p.vec3.scale(b.rotationFrame.up,b.rotationFrame.up,e);p.vec3.normalize(b.rotationFrame.up,b.rotationFrame.up);var g=p.vec3.dot(b.rotationFrame.up,b.frame.up),f=p.vec3.dot(b.rotationFrame.up,b.frame.right);p.vec3.scale(N,b.frame.up,-f);p.vec3.scale(Z,b.frame.right,g);p.vec3.add(N,N,Z);p.vec3.normalize(b.rotationFrame.right,N);I.vertexSpaceToProfileSpace(b.rotationRight,b.frame,b.rotationFrame.right);p.vec3.negate(N,b.vLeft);b.rotationAngle=-e*(Math.PI-k.acosClamped(p.vec3.dot(N,b.vRight)));
0<Math.abs(b.rotationAngle)&&(e=1/Math.cos(.5*b.rotationAngle),c.mat2.set(b.miterStretch,1+(e-1)*b.rotationRight[0]*b.rotationRight[0],(e-1)*b.rotationRight[0]*b.rotationRight[1],(e-1)*b.rotationRight[0]*b.rotationRight[1],1+(e-1)*b.rotationRight[1]*b.rotationRight[1]));b.maxStretchDistance=Math.abs(Math.min(b.vLeftLength,b.vRightLength)/Math.cos(.5*(Math.PI-b.rotationAngle)))}}}function S(a,b,c){switch(a){case "symbolValue":return c;case "proportional":return b;default:return a}}function R(a,b,c,
d){a=a.stageObject;var e=a.geometryRecords,g=e.length,f=0;Q.spatialReference=c.spatialReference;O.spatialReference=d.spatialReference;for(var k=0;k<g;k++){var h=e[k].geometry,m=h.metadata,n=m.pathGeometry,l=n.builder.path;T.spatialReference=m.geometrySR;for(var r=l,w=b,t=c,v=d,x=0,u=0,A=r.vertices;u<A.length;u++){var B=A[u];Q.x=B.posES[0];Q.y=B.posES[1];Q.z=B.posES[2];var q=y.evaluateElevationAlignmentAtPoint(Q,t,w,v,W),x=x+W.sampledElevation;p.vec3.add(Y,B.pos,r.offset);v.setAltitude(q,Y);p.vec3.subtract(B.pos,
Y,r.offset)}r.updatePathVertexInformation();f+=x/r.vertices.length;"world"!==l.upVector&&P(l,m.upVectorAlignment,d);n.onPathChanged();h.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(k)}return f/g}Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function f(a,b,d,e){a=c.call(this,a,b,d,e)||this;a._intrinsicSize=r.vec2f64.fromValues(1,1);a.upVectorAlignment="path";a.stencilWidth=.1;return a}l(f,c);f.prototype.doLoad=function(){return a(this,void 0,void 0,function(){var a,c,f,k,
m,p,l,r,w,v,y,x,u,A;return h(this,function(h){a=n.isSome(this.symbolLayer.width)?this.symbolLayer.width:n.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size;c=n.isSome(this.symbolLayer.height)?this.symbolLayer.height:a;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[a,1,c],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?C.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};f=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");k=this.symbolLayer.profile||"circle";switch(k){default:this._profile=I.Profile.circle(b.NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=I.Profile.rect()}m=
[0,0];"center"!==f&&(m={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[f],this._profile.translate(m[0],m[1]));p=this.symbolLayer.join||"simple";switch(p){case "round":this._extruder=new I.MiterExtruder(0,b.NUM_ROUND_JOIN_SUBDIVISIONS);break;case "bevel":this._extruder=new I.MiterExtruder(0,1);break;case "miter":this._extruder=new I.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new I.SimpleExtruder}l=this.symbolLayer.cap||"butt";switch(l){case "none":this._startCap=new I.NoCapBuilder;
this._endCap=new I.NoCapBuilder;break;default:this._startCap=new I.TriangulationCapBuilder(this._profile,0);this._endCap=new I.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new I.TriangulationCapBuilder(this._profile,-.5);this._endCap=new I.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":r="quad"===k?!0:!1,this._startCap=new I.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:r,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=
new I.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:r,subdivisions:b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}w=this._getIdHint();v=n.get(this.symbolLayer,"material","color");y=this._getCombinedOpacityAndColor(v);x=t.vec3f64.fromArray(y);u=y[3];A={diffuse:x,ambient:x,opacity:u,transparent:1>u||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:"none"===l?0:void 0,offsetTransparentBackfaces:!0};
if(!this._drivenProperties.size&&(g.vec2.set(this._intrinsicSize,a,c),!B.isValidSize(this._intrinsicSize[0])||!B.isValidSize(this._intrinsicSize[1])))throw new e("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||g.vec2.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(d.mixin(A,this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],
this._intrinsicSize[1],0]}),this._material=new H(A,w+"_pathmat")):(A.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new K(A,w+"_pathmat"));this._material.setParameterValues(L.getDefaultPBRMaterialParameters(this._context.physicalBasedRenderingEnabled));this._context.stage.add(3,this._material);return[2]})})};f.prototype.destroy=function(){c.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null)};
f.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,f.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};f.prototype.layerOpacityChanged=function(){var a=n.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacity(a);this._material.setParameterValues({opacity:a,transparent:1>a||
this.needsDrivenTransparentPass});return!0};f.prototype.layerElevationInfoChanged=function(a,b){var c=this;a.forEach(function(a){var d=b(a);n.isSome(d)&&(a=c.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=m.needsElevationUpdates3D(a.mode),d.elevationContext.set(a))});return m.SymbolUpdateType.UPDATE};f.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};f.prototype.physicalBasedRenderingChanged=
function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled});return!0};f.prototype.pixelRatioChanged=function(){return!0};f.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,b,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};f.prototype.getVertexData=function(a){for(var b=
0,c=a.paths,d=[],e=a.spatialReference,g=this._context.elevationProvider.spatialReference,f=this._context.renderCoordsHelper.spatialReference,k=0;k<c.length;k++)var h=c[k],b=b+h.length;for(var k=new Float64Array(3*b),m=new Float64Array(3*b),p=new Float64Array(3*b),n=0,l=0;l<c.length;l++){h=c[l];d.push({index:n,numVertices:h.length});for(var r=0;r<h.length;r++){var w=h[r];k[n++]=w[0];k[n++]=w[1];k[n++]=a.hasZ?w[2]:0}}a=!0;e.equals(g)?this._copyVertices(k,0,m,0,b):a=E.bufferToBuffer(k,e,0,m,g,0,b);g.equals(f)?
this._copyVertices(m,0,p,0,b):E.bufferToBuffer(m,g,0,p,f,0,b);return{pathVertexDataInfos:d,vertexDataGS:k,vertexDataES:m,vertexDataRS:p,projectionSuccess:a,terrainElevation:0}};f.prototype._copyVertices=function(a,b,c,d,e){b*=3;d*=3;for(var g=0;g<e;++g)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]};f.prototype._createAs3DShape=function(a,b,c,d,e){var g=a.geometry,f=[],k=[],h=[],l=g.spatialReference,r=this._context.elevationProvider.spatialReference,t=x.create(),v=this._context.renderCoordsHelper;T.spatialReference=
l;Q.spatialReference=r;g=this.getVertexData(g);if(!g.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<g.pathVertexDataInfos.length){for(r=0;r<g.pathVertexDataInfos.length;++r){var u=g.pathVertexDataInfos[r],B=u.index,u=u.numVertices;if(2>u)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(n.isSome(this._context.clippingExtent)&&
(x.empty(t),x.expandWithBuffer(t,g.vertexDataES,3*B,u),!x.intersectsClippingArea(t,this._context.clippingExtent)))continue;for(var q=[],C=B;C<B+3*u;){var H=C++,E=C++,O=C++,N=new I.PathVertex;p.vec3.set(N.posGS,g.vertexDataGS[H],g.vertexDataGS[E],g.vertexDataGS[O]);p.vec3.set(N.posES,g.vertexDataES[H],g.vertexDataES[E],g.vertexDataES[O]);Q.x=N.posES[0];Q.y=N.posES[1];Q.z=N.posES[2];var K=y.evaluateElevationAlignmentAtPoint(Q,this._context.elevationProvider,c,v,null);p.vec3.set(Y,g.vertexDataRS[H],
g.vertexDataRS[E],g.vertexDataRS[O]);v.setAltitude(K,Y);p.vec3.set(N.pos,Y[0],Y[1],Y[2]);q.push(N)}B=new I.Path(q);P(B,this.upVectorAlignment,this._context.renderCoordsHelper);B=new I.Builder(B,this._profile,this._extruder,this._startCap,this._endCap);u=null;this._fastUpdates.enabled?(C=this._fastUpdates.visualVariables,u=C.size?A.getAttributeValue(C.size.field,a):0,q=C.color?A.getAttributeValue(C.color.field,a):0,C=C.opacity?A.getAttributeValue(C.opacity.field,a):0,u=new I.FastUpdatePathGeometry(B,
u,q,C)):(u=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(u[0]*=S(b.size[0],b.size[2],this.symbolLayer.width),u[1]*=S(b.size[2],b.size[0],this.symbolLayer.height)),q=null,this._drivenProperties.color&&(q=b.color),this._drivenProperties.opacity&&null!=b.opacity&&(q=q?[q[0],q[1],q[2],b.opacity]:[1,1,1,b.opacity]),B=new I.StaticPathGeometry(B),B.bake(u),q&&B.bakeVertexColors(q),u=B);B=u.createGeometryData();B=new G(B,d+"path"+r);B.metadata={pathGeometry:u,geometrySR:l,
upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};f.push(B);k.push(this._material);h.push(u.xform)}}a={layerUid:this._context.layer.uid,graphicUid:e};if(0<f.length)return d=new J({geometries:f,materials:k,transformations:h,castShadow:!0,metadata:a,idHint:d}),f=new w(this,d,f,null,null,R,c),f.alignedSampledElevation=g.terrainElevation,f.needsElevationUpdates=m.needsElevationUpdates3D(c.mode),f}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");
return null};f.validGeometryTypes=["polyline"];return f}(A.Graphics3DSymbolLayer);b.Graphics3DPathSymbolLayer=q;var O=v.makeDehydratedPoint(0,0,0,null),Q=v.makeDehydratedPoint(0,0,0,null),T=v.makeDehydratedPoint(0,0,0,null),Y=t.vec3f64.create(),N=u.vec3f32.create(),Z=u.vec3f32.create();b.NUM_ROUND_JOIN_SUBDIVISIONS=3;b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;b.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;var W={verticalDistanceToGround:0,sampledElevation:0};b.default=q})},"esri/core/libs/gl-matrix-2/mat2":function(){define(["require",
"exports","./math/mat2"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2=l})},"esri/core/libs/gl-matrix-2/math/mat2":function(){define(["require","exports","./common"],function(q,b,l){function f(a,b,d){var e=b[0],f=b[1],c=b[2];b=b[3];var g=d[0],h=d[1],p=d[2];d=d[3];a[0]=e*g+c*h;a[1]=f*g+b*h;a[2]=e*p+c*d;a[3]=f*p+b*d;return a}function h(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];return a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,
b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};b.set=function(a,b,d,f,h){a[0]=b;a[1]=d;a[2]=f;a[3]=h;return a};b.transpose=function(a,b){if(a===b){var d=b[1];a[1]=b[2];a[2]=d}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};b.invert=function(a,b){var d=b[0],e=b[1],f=b[2];b=b[3];var c=d*b-f*e;if(!c)return null;c=1/c;a[0]=b*c;a[1]=-e*c;a[2]=-f*c;a[3]=d*c;return a};b.adjoint=function(a,b){var d=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];
a[3]=d;return a};b.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};b.multiply=f;b.rotate=function(a,b,d){var e=b[0],f=b[1],c=b[2];b=b[3];var g=Math.sin(d);d=Math.cos(d);a[0]=e*d+c*g;a[1]=f*d+b*g;a[2]=e*-g+c*d;a[3]=f*-g+b*d;return a};b.scale=function(a,b,d){var e=b[1],f=b[2],c=b[3],g=d[0];d=d[1];a[0]=b[0]*g;a[1]=e*g;a[2]=f*d;a[3]=c*d;return a};b.fromRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=-d;a[3]=b;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;
a[3]=b[1];return a};b.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};b.LDU=function(a,b,d,f){a[2]=f[2]/f[0];d[0]=f[0];d[1]=f[1];d[3]=f[3]-a[2]*d[1];return[a,b,d]};b.add=function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];return a};b.subtract=h;b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};b.equals=function(a,
b){var d=a[0],e=a[1],f=a[2];a=a[3];var c=b[0],g=b[1],h=b[2];b=b[3];return Math.abs(d-c)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(c))&&Math.abs(e-g)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(g))&&Math.abs(f-h)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(h))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};b.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;return a};b.multiplyScalarAndAdd=function(a,b,d,f){a[0]=b[0]+d[0]*f;a[1]=b[1]+d[1]*f;a[2]=b[2]+d[2]*
f;a[3]=b[3]+d[3]*f;return a};b.mul=f;b.sub=h})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat2 ../../../../core/libs/gl-matrix-2/mat2f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./GeometryData ./GeometryUtil ./Util ../materials/PathTechnique ../materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){var m;(function(b){function m(){return{up:r.vec3f64.create(),right:r.vec3f64.create()}}b.makeFrame=m;b.profileSpaceToVertexSpace=function(a,b,c){a[0]=c[0]*b.right[0]+c[1]*b.up[0];a[1]=c[0]*b.right[1]+c[1]*b.up[1];a[2]=c[0]*b.right[2]+c[1]*b.up[2]};b.vertexSpaceToProfileSpace=function(a,b,c){n.vec2.set(a,g.vec3.dot(c,b.right),g.vec3.dot(c,b.up))};var l=function(){function b(){this.pos=r.vec3f64.create();this.posES=r.vec3f64.create();this.posGS=r.vec3f64.create();
this.vRight=r.vec3f64.create();this.vLeft=r.vec3f64.create();this.frame=m();this.rotationFrame=m();this.rotationRight=c.vec2f64.create();this.rotationAngle=0;this.miterStretch=e.mat2f64.create()}b.prototype.setFrameFromUpVector=function(a){g.vec3.copy(this.frame.up,a);g.vec3.add(G,this.vLeft,this.vRight);g.vec3.normalize(G,G);g.vec3.scale(E,this.frame.up,g.vec3.dot(G,this.frame.up));g.vec3.subtract(K,G,E);g.vec3.normalize(K,K);g.vec3.cross(this.frame.right,K,this.frame.up)};b.prototype.computeRotationAxisAndAngleFromUpVector=
function(){g.vec3.copy(this.rotationFrame.up,this.frame.up);g.vec3.copy(this.rotationFrame.right,this.frame.right);n.vec2.set(this.rotationRight,1,0);g.vec3.scale(E,this.frame.up,g.vec3.dot(this.frame.up,this.vLeft));g.vec3.subtract(E,this.vLeft,E);g.vec3.negate(E,E);g.vec3.normalize(E,E);g.vec3.scale(G,this.frame.up,g.vec3.dot(this.frame.up,this.vRight));g.vec3.subtract(G,this.vRight,G);g.vec3.normalize(G,G);g.vec3.cross(J,this.rotationFrame.up,this.vLeft);this.rotationAngle=h.sign(g.vec3.dot(J,
this.vRight))*(Math.PI-h.acosClamped(g.vec3.dot(E,G)));0<Math.abs(this.rotationAngle)&&a.mat2.set(this.miterStretch,1+(1/Math.cos(.5*this.rotationAngle)-1),0,0,1);this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return b}();b.PathVertex=l;l=function(){function a(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}a.prototype.addVertex=function(a,b){this.vertices.push(c.vec2f64.clone(a));
this.vertexNormals.push(c.vec2f64.clone(b));return this.vertices.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addPole=function(a,b){void 0===b&&(b=null);this.poles.push({position:c.vec2f64.clone(a),normal:b?c.vec2f64.clone(b):null});return this.poles.length-1};a.prototype.addSegment=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=null);this.vertexIndices.push(a.v0);this.vertexIndices.push(a.v1);b&&(this.uvIndices.push(b.v0),
this.uvIndices.push(b.v1));c&&(this.poleIndices.push(c.v0),this.poleIndices.push(c.v1))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.translate=function(a,b){for(var c=0,d=this.vertices;c<d.length;c++){var e=d[c];e[0]+=a;e[1]+=b}c=0;for(d=this.poles;c<d.length;c++)e=d[c],e.position[0]+=a,e.position[1]+=b};a.circle=function(b){void 0===b&&(b=20);var d=
new a,e={v0:0,v1:0};d.addPole(c.vec2f64.fromValues(0,0));for(var g=0;g<b;++g){var f=2*g*Math.PI/b,k=Math.cos(f),h=Math.sin(f),f=c.vec2f64.fromValues(.5*k,.5*h),k=c.vec2f64.fromValues(k,h);d.addVertex(f,k);d.addUV(g/b)}d.addUV(1);for(g=0;g<b-1;++g)k={v0:g,v1:g+1},d.addSegment(k,k,e);d.addSegment({v0:b-1,v1:0},{v0:b-1,v1:b},e);return d};a.rect=function(){var b=new a,d=c.vec2f64.fromValues(-.5,-.5),e=c.vec2f64.fromValues(.5,-.5),g=c.vec2f64.fromValues(.5,.5),f=c.vec2f64.fromValues(-.5,.5),k=c.vec2f64.fromValues(0,
-1),h=c.vec2f64.fromValues(1,0),m=c.vec2f64.fromValues(0,1),p=c.vec2f64.fromValues(-1,0);b.addUV(0);b.addUV(1);b.addPole(c.vec2f64.fromValues(0,.5),m);b.addPole(c.vec2f64.fromValues(0,.5));b.addPole(c.vec2f64.fromValues(0,-.5));b.addPole(c.vec2f64.fromValues(0,-.5),k);var n={v0:0,v1:1};b.addVertex(d,k);b.addVertex(e,k);b.addSegment({v0:0,v1:1},n,{v0:3,v1:3});b.addVertex(e,h);b.addVertex(g,h);b.addSegment({v0:2,v1:3},n,{v0:2,v1:1});b.addVertex(g,m);b.addVertex(f,m);b.addSegment({v0:4,v1:5},n,{v0:0,
v1:0});b.addVertex(f,p);b.addVertex(d,p);b.addSegment({v0:6,v1:7},n,{v0:1,v1:2});return b};return a}();b.Profile=l;l=function(){function a(a){this.vertices=[];this.offset=r.vec3f64.create();this.xform=k.mat4f64.create();this.vertices=a;g.vec3.copy(this.offset,this.vertices[Math.floor((a.length-1)/2)].pos);a=0;for(var b=this.vertices;a<b.length;a++){var c=b[a];g.vec3.subtract(c.pos,c.pos,this.offset)}d.mat4.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}a.prototype.updatePathVertexInformation=
function(){var a=this.vertices.length,b=this.vertices[0];b.index=0;g.vec3.set(b.vLeft,0,0,0);b.vLeftLength=0;g.vec3.subtract(b.vRight,this.vertices[1].pos,b.pos);b.vRightLength=g.vec3.length(b.vRight);g.vec3.normalize(b.vRight,b.vRight);for(var c=b,d=1;d<a;++d)b=this.vertices[d],b.index=d,g.vec3.copy(b.vLeft,c.vRight),b.vLeftLength=c.vRightLength,d<a-1?(g.vec3.subtract(b.vRight,this.vertices[d+1].pos,b.pos),b.vRightLength=g.vec3.length(b.vRight),g.vec3.normalize(b.vRight,b.vRight)):(g.vec3.copy(b.vRight,
b.vLeft),b.vRightLength=b.vLeftLength),c=b};return a}();b.Path=l;b.computeMinimumRotationTangentFrame=function(a,b){var c=null,d=a.vertices.length,e=r.vec3f64.create(),f=r.vec3f64.create(),k=r.vec3f64.create(),h=r.vec3f64.create(),m=r.vec3f64.create(),n=r.vec3f64.create(),l=p.plane.create(),w=a.vertices[0];g.vec3.copy(f,b);g.vec3.set(e,0,1,0);t.makeOrthoBasisDirUpFallback(w.vRight,f,e,e,k,f,.99619469809);g.vec3.copy(w.frame.up,f);g.vec3.copy(w.frame.right,k);c=w;for(b=1;b<d;++b){w=a.vertices[b];g.vec3.add(m,
w.vLeft,w.vRight);var v=g.vec3.length(m);0<v?(v=1/Math.sqrt(v),m[0]*=v,m[1]*=v,m[2]*=v):(m[0]=w.vRight[0],m[1]=w.vRight[1],m[2]=w.vRight[2]);g.vec3.add(n,c.pos,c.frame.up);p.plane.fromPositionAndNormal(w.pos,m,l);p.plane.intersectRay(l,p.ray.wrap(n,w.vLeft),h)?(g.vec3.subtract(h,h,w.pos),g.vec3.normalize(f,h),g.vec3.cross(k,m,f),g.vec3.normalize(k,k)):t.makeOrthoBasisDirUpFallback(m,c.frame.up,c.frame.right,e,k,f,.99619469809);g.vec3.copy(w.frame.up,f);g.vec3.copy(w.frame.right,k);c=w}};l=function(){return function(){}}();
b.Extruder=l;l=function(){function a(){}a.prototype.numProfilesPerJoin=function(){return 1};a.prototype.extrude=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],!1)};return a}();b.SimpleExtruder=l;l=function(){function a(a,b){void 0===a&&(a=.8*Math.PI);void 0===b&&(b=1);this.cutoffAngle=a;this.numBendSubdivisions=b}a.prototype.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};a.prototype.extrude=function(a,b,c){var e=H;if(Math.abs(a.rotationAngle)>=
this.cutoffAngle)for(var f=0;f<this.numBendSubdivisions+1;++f){d.mat4.identity(L);d.mat4.rotate(L,L,.5*-a.rotationAngle+f*a.rotationAngle/this.numBendSubdivisions,a.rotationFrame.up);var k=e,h=a.frame,m=L;g.vec3.transformMat4(k.up,h.up,m);g.vec3.transformMat4(k.right,h.right,m);for(k=0;k<b.vertices.length;++k)h=n.vec2.dot(b.vertices[k],a.rotationRight),(h=0<=h*a.rotationAngle)?c(a.index,e,b.vertices[k],b.vertexNormals[k],!1):(n.vec2.transformMat2(A,b.vertices[k],a.miterStretch),c(a.index,a.frame,
A,b.vertexNormals[k],!0))}else for(f=0;f<this.numBendSubdivisions+1;++f)for(k=0;k<b.vertices.length;++k)h=n.vec2.dot(b.vertices[k],a.rotationRight),h=0<=h*a.rotationAngle,n.vec2.transformMat2(A,b.vertices[k],a.miterStretch),c(a.index,a.frame,A,b.vertexNormals[k],h?!1:!0)};return a}();b.MiterExtruder=l;var q={generateUV:!1},l=function(){function a(){}a.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],0,
0)};return a}();b.CapBuilder=l;var Q=function(a){function b(){return a.call(this)||this}f(b,a);b.prototype.getNumVertices=function(){return 0};b.prototype.getNumIndices=function(){return 0};b.prototype.rebuildCapGeometry=function(){};b.prototype.buildTopology=function(){};return b}(l);b.NoCapBuilder=Q;Q=function(a){function b(b,c,d){void 0===c&&(c=0);void 0===d&&(d=!1);var e=a.call(this)||this;e.profile=b;e.profilePlaneOffset=c;e.flip=d;return e}f(b,a);b.prototype.getNumVertices=function(){return this.profile.vertices.length};
b.prototype.getNumIndices=function(){return 3*this.profile.numSegments};b.prototype.rebuildConnectingProfileGeometry=function(a,b,c){for(var d=0;d<b.vertices.length;++d)c(a.index,a.frame,b.vertices[d],b.vertexNormals[d],this.profilePlaneOffset,0)};b.prototype.rebuildCapGeometry=function(a,b){var c=B;n.vec2.set(c,0,0);for(var d=this.flip?1:-1,e=0;e<this.profile.vertices.length;++e)b(a.index,a.frame,this.profile.vertices[e],c,this.profilePlaneOffset,d)};b.prototype.buildTopology=function(a,b){a=this.vertexBufferStart+
this.profile.vertexIndices[0];for(var c=1;c<this.profile.numSegments;++c){var d=this.vertexBufferStart+this.profile.vertexIndices[2*c+0],e=this.vertexBufferStart+this.profile.vertexIndices[2*c+1];this.flip?b(e,d,a):b(a,d,e)}};return b}(l);b.TriangulationCapBuilder=Q;l=function(a){function b(b){var c=a.call(this)||this;c.flip=!1;c.sign=0;c.breakNormals=!1;c.numSegments=3;c.profile=b.profile;c.flip=b.flip;c.sign=c.flip?1:-1;c.breakNormals=b.breakNormals;c.numSegments=b.subdivisions;return c}f(b,a);
b.prototype.getNumVertices=function(){var a=0,a=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(a+=this.profile.vertices.length);return a+=this.profile.poles.length};b.prototype.getNumIndices=function(){var a;a=0+2*this.profile.numSegments*(this.numSegments-1);for(var b=0;b<this.profile.numSegments;++b)a=this.profile.poleIndices[this.profile.vertexIndices[2*b+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*b+1]]?a+1:a+2;return 3*a};b.prototype.rebuildCapGeometry=
function(a,b){var c=a.frame,d=.5*this.sign,e=A,g=B;n.vec2.set(g,0,0);for(var f=0;f<this.profile.poles.length;++f){var k=this.profile.poles[f];k.normal?b(a.index,c,k.position,k.normal,d,0):b(a.index,c,k.position,g,d,this.sign)}if(this.breakNormals)for(f=0;f<this.profile.vertices.length;++f)b(a.index,c,this.profile.vertices[f],this.profile.vertexNormals[f],0,0);for(f=0;f<this.numSegments-1;++f)for(var k=(1-(f+1)/this.numSegments)*Math.PI*.5,h=Math.sin(k),m=Math.cos(k),p=0;p<this.profile.vertices.length;++p)k=
this.profile.poles[this.profile.poleIndices[p]],n.vec2.subtract(e,this.profile.vertices[p],k.position),n.vec2.scale(e,e,h),k.normal?(n.vec2.add(e,e,k.position),b(a.index,c,e,k.normal,d*m,0)):(n.vec2.normalize(g,e),n.vec2.scale(g,g,h),n.vec2.add(e,e,k.position),b(a.index,c,e,g,d*m,this.sign*m))};b.prototype.buildTopology=function(a,b){a=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;for(var c=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+
this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length,d=0;d<this.profile.numSegments;++d){for(var e=this.profile.vertexIndices[2*d+0],g=this.profile.vertexIndices[2*d+1],f=this.vertexBufferStart+this.profile.poleIndices[e],k=this.vertexBufferStart+this.profile.poleIndices[g],h=a+e,m=a+g,p=0;p<this.numSegments-1;++p){var n=c+p*this.profile.vertices.length+e,l=c+p*this.profile.vertices.length+g;this.flip?(b(n,m,h),b(m,n,l)):(b(h,m,n),b(l,n,m));h=n;m=l}this.flip?(b(f,m,h),f!==
k&&b(f,k,m)):(b(h,m,f),f!==k&&b(m,k,f))}};return b}(l);b.RoundCapBuilder=l;l=function(){function a(a,b,c,d,e,g){void 0===g&&(g=q);this.options=g;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=b;this.path=a;this.extruder=c;this.startCap=d;this.endCap=e;a=this.path.vertices.length-2;this.numExtrusionProfiles=c.numProfilesPerJoin()*a+2;this.numNormalsTotal=this.numVerticesTotal=b.vertices.length*this.numExtrusionProfiles;
this.startCap.vertexBufferStart=this.numVerticesTotal;b=this.startCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.endCap.vertexBufferStart=this.numVerticesTotal;b=this.endCap.getNumVertices();this.numVerticesTotal+=b;this.numNormalsTotal+=b;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*
this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,b,c,d,e){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+
2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=
a;e?(a=this.path.vertices[a],this.profileRightAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[0]*a.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=a.rotationRight[1]*a.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};a.prototype.emitCapVertex=function(a,b,c,d,e,g){this.profileRightAxisData[4*this._extrusionVertexCount+0]=b.right[0];this.profileRightAxisData[4*
this._extrusionVertexCount+1]=b.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=b.right[2];this.profileUpAxisData[4*this._extrusionVertexCount+0]=b.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=b.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=b.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=c[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=c[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=
d[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=d[1];this.pathVertexData[this._extrusionVertexCount]=a;this.profileRightAxisData[4*this._extrusionVertexCount+3]=e;this.profileUpAxisData[4*this._extrusionVertexCount+3]=g;++this._extrusionVertexCount};a.prototype.emitTriangle=function(a,b,c){this.vertexIndices[3*this._triangleCount+0]=a;this.vertexIndices[3*this._triangleCount+1]=b;this.vertexIndices[3*this._triangleCount+2]=c;this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[a];
this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[b];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[c];this.normalIndices[3*this._triangleCount+0]=a;this.normalIndices[3*this._triangleCount+1]=b;this.normalIndices[3*this._triangleCount+2]=c;++this._triangleCount};a.prototype.rebuildGeometry=function(){for(var a=this,b=function(b,c,d,e,g){return a.emitVertex(b,c,d,e,g)},c=function(b,c,d,e,g,f){return a.emitCapVertex(b,c,d,e,g,f)},d=this._extrusionVertexCount=
0,e=this.path.vertices;d<e.length;d++){var g=e[d];this.originData[3*g.index+0]=g.pos[0];this.originData[3*g.index+1]=g.pos[1];this.originData[3*g.index+2]=g.pos[2]}this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,c);for(d=1;d<this.path.vertices.length-1;++d)this.extruder.extrude(this.path.vertices[d],this.profile,b);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,c);this.startCap.rebuildCapGeometry(this.path.vertices[0],
c);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],c);if(this.profile.hasUV()&&this.options.generateUV)for(d=0;d<this.profile.uvs.length;++d)this.uvData[2*d+0]=this.profile.uvs[d],this.uvData[2*d+1]=0};a.prototype.buildTopology=function(){var a=this,b=function(b,c,d){return a.emitTriangle(b,c,d)};this._triangleCount=0;var c=this.profile.vertices.length,d=this.profile.numSegments,e=this.numExtrusionProfiles-1,g=d*e*6;this.startCap.indexBufferStart=g;this.startCap.firstProfileVertexIndex=
0;g+=this.startCap.getNumIndices();this.endCap.indexBufferStart=g;this.endCap.firstProfileVertexIndex=c*(this.numExtrusionProfiles-1);g+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(g);this.normalIndices=new Uint32Array(g);this.pathVertexIndices=new Uint32Array(g);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(g));for(g=0;g<d;++g)for(var f=this.profile.vertexIndices[2*g],k=this.profile.vertexIndices[2*g+1],h=0;h<e;++h){var m=h*c+f,p=(h+1)*c+k,n=h*
c+k;b(m,(h+1)*c+f,p);b(m,p,n)}this.startCap.buildTopology(this.path.vertices[0],b);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],b)};a.prototype.onPathChanged=function(){this.rebuildGeometry()};return a}();b.Builder=l;l=function(){function a(a){this.builder=a}Object.defineProperty(a.prototype,"xform",{get:function(){return this.builder.path.xform},enumerable:!0,configurable:!0});a.prototype.onPathChanged=function(){this.builder.onPathChanged()};return a}();b.PathGeometry=
l;var T=function(a){function b(b){b=a.call(this,b)||this;b.vertexAttributePosition=null;b.vertexAttributeNormal=null;b.vertexAttributeColor=null;b.vertexAttributePosition=new Float32Array(3*b.builder.numVerticesTotal);b.vertexAttributeNormal=new Float32Array(3*b.builder.numNormalsTotal);b.vertexAttributeColor=new Uint8Array(4);b.vertexAttributeColor[0]=255;b.vertexAttributeColor[1]=255;b.vertexAttributeColor[2]=255;b.vertexAttributeColor[3]=255;return b}f(b,a);b.prototype.bakeVertexColors=function(a){this.vertexAttributeColor[0]=
255*a[0];this.vertexAttributeColor[1]=255*a[1];this.vertexAttributeColor[2]=255*a[2];this.vertexAttributeColor[3]=255*(3<a.length?a[3]:1)};b.prototype.bake=function(a){this.size=a;for(var b=0;b<this.builder.numVerticesTotal;++b){var c=this.builder.pathVertexData[b],d=0===c||c===this.builder.path.vertices.length-1,e=w;g.vec3.set(e,this.builder.originData[3*c+0],this.builder.originData[3*c+1],this.builder.originData[3*c+2]);var f=E,k=A,c=G,m=J,p=I,l=0,r=0;g.vec3.set(m,this.builder.profileRightAxisData[4*
b+0],this.builder.profileRightAxisData[4*b+1],this.builder.profileRightAxisData[4*b+2]);g.vec3.set(p,this.builder.profileUpAxisData[4*b+0],this.builder.profileUpAxisData[4*b+1],this.builder.profileUpAxisData[4*b+2]);n.vec2.set(k,this.builder.profileVertexAndNormalData[4*b+0]*a[0],this.builder.profileVertexAndNormalData[4*b+1]*a[1]);if(d)g.vec3.cross(c,p,m),l=this.builder.profileRightAxisData[4*b+3]*a[0],r=this.builder.profileUpAxisData[4*b+3];else{var d=B,t=C;n.vec2.set(d,this.builder.profileRightAxisData[4*
b+3],this.builder.profileUpAxisData[4*b+3]);var v=n.vec2.length(d);n.vec2.normalize(d,d);var u=n.vec2.dot(k,d);if(Math.abs(u)>v){n.vec2.set(t,-d[1],d[0]);var y=n.vec2.dot(k,t);n.vec2.scale(d,d,v*h.sign(u));n.vec2.scale(t,t,y);n.vec2.add(k,d,t)}g.vec3.set(c,0,0,0)}g.vec3.set(f,m[0]*k[0]+p[0]*k[1],m[1]*k[0]+p[1]*k[1],m[2]*k[0]+p[2]*k[1]);this.vertexAttributePosition[3*b+0]=e[0]+f[0]+c[0]*l;this.vertexAttributePosition[3*b+1]=e[1]+f[1]+c[1]*l;this.vertexAttributePosition[3*b+2]=e[2]+f[2]+c[2]*l;e=A;
n.vec2.set(e,this.builder.profileVertexAndNormalData[4*b+2],this.builder.profileVertexAndNormalData[4*b+3]);this.vertexAttributeNormal[3*b+0]=m[0]*e[0]+p[0]*e[1]+c[0]*r;this.vertexAttributeNormal[3*b+1]=m[1]*e[0]+p[1]*e[1]+c[1]*r;this.vertexAttributeNormal[3*b+2]=m[2]*e[0]+p[2]*e[1]+c[2]*r}};b.prototype.createGeometryData=function(){var a={};a[x.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[x.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[x.VertexAttrConstants.COLOR]=
new Uint32Array(a[x.VertexAttrConstants.POSITION].length));var b={};b[x.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};b[x.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(b[x.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new u.GeometryData(b,a,u.GeometryData.DefaultOffsets,"triangle")};b.prototype.onPathChanged=function(){a.prototype.onPathChanged.call(this);this.bake(this.size)};b.prototype.intersect=
function(a,b,c){var d=this.builder.vertexIndices;y.intersectTriangles(a,b,0,d.length/3,d,{size:3,offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,void 0,c)};return b}(l);b.StaticPathGeometry=T;l=function(a){function b(b,c,d,e){var g=a.call(this,b)||this;g.sizeAttributeValue=c;g.colorAttributeValue=d;g.opacityAttributeValue=e;g.vvData=null;g.baked=new T(b);g.vvData=new Float32Array(4*g.builder.path.vertices.length);for(b=0;b<g.builder.path.vertices.length;++b)g.vvData[4*b+0]=c,g.vvData[4*
b+1]=d,g.vvData[4*b+2]=e,g.vvData[4*b+3]=0===b||b===g.builder.path.vertices.length-1?1:0;return g}f(b,a);b.prototype.createGeometryData=function(){var a={};a[v.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices;a[v.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;a[v.PathVertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;
var b={};b[v.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData};b[v.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};b[v.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};b[v.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};b[v.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new u.GeometryData(b,a,u.GeometryData.DefaultOffsets,"triangle")};
return b}(l);b.FastUpdatePathGeometry=l})(m||(m={}));var w=r.vec3f64.create(),A=c.vec2f64.create(),B=c.vec2f64.create(),C=c.vec2f64.create(),E=r.vec3f64.create(),G=r.vec3f64.create(),J=r.vec3f64.create(),I=r.vec3f64.create(),K=r.vec3f64.create(),H=m.makeFrame(),L=k.mat4f64.create();return m})},"esri/core/libs/gl-matrix-2/mat2f64":function(){define(["require","exports","./factories/mat2f64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2f64=l})},"esri/core/libs/gl-matrix-2/factories/mat2f64":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,f,h,a){return[b,f,h,a]};b.createView=function(b,f){return new Float64Array(b,f,4)}})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/Camera.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../shaders/Path.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};b.pathVertexAttributeLocations={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};h=function(f){function h(){return null!==f&&f.apply(this,arguments)||this}l(h,f);h.prototype.initializeProgram=function(a){var c=
h.shader.get(),d=this.configuration,c=c.build({output:d.output,viewingMode:a.viewingMode,slicePlaneEnabled:d.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:d.receiveShadows,vvSize:d.vvSize,vvColor:d.vvColor,vvInstancingEnabled:!0,vvOpacity:d.vvOpacity,useOldSceneLightInterface:!1,usePBR:!1,usePBRforWater:!1,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:d.receiveSSAO,doubleSidedMode:d.doubleSidedMode});return new x(a.rctx,c.generateSource("vertex"),
c.generateSource("fragment"),b.pathVertexAttributeLocations)};h.prototype.bindPass=function(a,b,c){this.program.setUniform3fv("size",b.size);0===this.configuration.output?(this.program.setUniform3fv("size",b.size),this.program.setUniform3fv("ambient",b.ambient),this.program.setUniform3fv("diffuse",b.diffuse),this.program.setUniform3fv("specular",b.specular),this.program.setUniform1f("opacity",b.opacity)):1!==this.configuration.output&&3!==this.configuration.output||n.ReadLinearDepth.bindUniforms(this.program,
c);d.setVVUniforms(this.program,b)};h.prototype.bindDraw=function(b){e.Transform.bindUniforms(this.program,b);a.Slice.bindUniformsWithOrigin(this.program,this.configuration,b);0===this.configuration.output&&(g.Camera.bindUniforms(this.program,b),c.ReadShadowMap.bindView(this.program,b));2===this.configuration.output&&k.VertexNormal.bindUniforms(this.program,b)};h.prototype.initializePipeline=function(){var a=this.configuration;return 0===a.output?v.makePipelineState({blending:a.transparent&&v.separateBlendingParams(770,
1,771,771),culling:(a.slicePlaneEnabled?!1:!a.transparent&&0!==a.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams}):v.makePipelineState({culling:(a.slicePlaneEnabled?!1:!a.transparent&&0!==a.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:513},depthWrite:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams})};h.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};h.shader=
new r.ReloadableShaderModule(t,"../shaders/Path.glsl",q);return h}(p.ShaderTechnique);b.PathTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.doubleSidedMode=0;b.receiveShadows=!1;b.receiveSSAO=!1;b.vvSize=!1;b.vvColor=!1;b.vvOpacity=!1;b.slicePlaneEnabled=!1;b.shadowMap=!1;b.transparent=!1;return b}l(b,a);f([u.parameter({count:7})],b.prototype,"output",void 0);f([u.parameter({count:3})],b.prototype,"doubleSidedMode",void 0);f([u.parameter()],b.prototype,
"receiveShadows",void 0);f([u.parameter()],b.prototype,"receiveSSAO",void 0);f([u.parameter()],b.prototype,"vvSize",void 0);f([u.parameter()],b.prototype,"vvColor",void 0);f([u.parameter()],b.prototype,"vvOpacity",void 0);f([u.parameter()],b.prototype,"slicePlaneEnabled",void 0);f([u.parameter()],b.prototype,"shadowMap",void 0);f([u.parameter()],b.prototype,"transparent",void 0);return b}(u.ShaderTechniqueConfiguration);b.PathTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","./PositionAttribute.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.PathVertexPosition=function(b,v){b.attributes.add("featureValue","vec4");b.vertex.code.add(h.glsl(a||(a=l(["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "],["\n  bool isCapVertex() {\n    return featureValue.w \x3d\x3d 1.0;\n  }\n  "]))));b.vertex.uniforms.add("size","vec3");
v.vvSize?(b.vertex.uniforms.add("vvSizeMinSize","vec3"),b.vertex.uniforms.add("vvSizeMaxSize","vec3"),b.vertex.uniforms.add("vvSizeOffset","vec3"),b.vertex.uniforms.add("vvSizeFactor","vec3"),b.vertex.code.add(h.glsl(e||(e=l(["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "],["\n    vec2 getSize() {\n      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;\n    }\n    "]))))):
b.vertex.code.add(h.glsl(d||(d=l(["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "],["\n    vec2 getSize(){\n      return size.xy;\n    }\n    "]))));v.vvOpacity?(b.vertex.defines.addInt("VV_OPACITY_N",8),b.vertex.code.add(h.glsl(k||(k=l(["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "],
["\n    uniform float vvOpacityValues[VV_OPACITY_N];\n    uniform float vvOpacityOpacities[VV_OPACITY_N];\n\n    vec4 applyOpacity(vec4 color) {\n      float value \x3d featureValue.z;\n      if (value \x3c\x3d vvOpacityValues[0]) {\n        return vec4( color.xyz, vvOpacityOpacities[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\n        if (vvOpacityValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\n          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));\n        }\n      }\n\n      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(h.glsl(n||(n=l(["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "],["\n    vec4 applyOpacity(vec4 color){\n      return color;\n    }\n    "]))));v.vvColor?(b.vertex.defines.addInt("VV_COLOR_N",8),b.vertex.code.add(h.glsl(c||(c=l(["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "],
["\n    uniform float vvColorValues[VV_COLOR_N];\n    uniform vec4 vvColorColors[VV_COLOR_N];\n\n    vec4 getColor() {\n      float value \x3d featureValue.y;\n      if (value \x3c\x3d vvColorValues[0]) {\n        return applyOpacity(vvColorColors[0]);\n      }\n\n      for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\n        if (vvColorValues[i] \x3e\x3d value) {\n          float f \x3d (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));\n        }\n      }\n\n      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);\n    }\n    "]))))):
b.vertex.code.add(h.glsl(g||(g=l(["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "],["\n    vec4 getColor(){\n      return applyOpacity(vec4(1, 1, 1, 1));\n    }\n    "]))));b.include(f.PositionAttribute);b.attributes.add("profileRight","vec4");b.attributes.add("profileUp","vec4");b.attributes.add("profileVertexAndNormal","vec4");b.vertex.code.add(h.glsl(r||(r=l(["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "],
["\n  vec3 calculateVPos() {\n    vec2 size \x3d getSize();\n    vec3 origin \x3d position;\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileVertex \x3d profileVertexAndNormal.xy * size;\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n    float positionOffsetAlongProfilePlaneNormal \x3d 0.0;\n    float normalOffsetAlongProfilePlaneNormal \x3d 0.0;\n    "]))));b.vertex.code.add(h.glsl(p||(p=l(["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "],
["\n    if(!isCapVertex()) {\n      vec2 rotationRight \x3d vec2(profileRight.w, profileUp.w);\n      float maxDistance \x3d length(rotationRight);\n  "]))));b.vertex.code.add(h.glsl(u||(u=l(["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    vec4 localPosition \x3d vec4(origin + offset, 1.0);\n    return (model * localPosition).xyz;\n  }\n  "],
["\n      rotationRight \x3d maxDistance \x3e 0.0 ? normalize(rotationRight) : vec2(0, 0);\n\n      // decompose vertex into rotationRight and rotationUp\n      // limit rotation right component to maxDistance\n      // and reassemble profile vertex from rotationRight and rotationUp\n      float rx \x3d dot(profileVertex, rotationRight);\n      if (abs(rx) \x3e maxDistance) {\n        // NB: we do the tangent by x\x3d-y and y\x3dx\n        vec2 rotationUp \x3d vec2(-rotationRight.y, rotationRight.x);\n        float ry \x3d dot(profileVertex, rotationUp);\n        profileVertex \x3d rotationRight * maxDistance * sign(rx) + rotationUp * ry;\n      }\n    }else{\n       positionOffsetAlongProfilePlaneNormal \x3d profileRight.w * size[0];\n       normalOffsetAlongProfilePlaneNormal \x3d profileUp.w;\n    }\n\n    vec3 offset \x3d right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;\n\n    vec4 localPosition \x3d vec4(origin + offset, 1.0);\n    return (model * localPosition).xyz;\n  }\n  "]))));
b.vertex.code.add(h.glsl(t||(t=l(["\n  vec4 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return vec4(normal, 1.0);\n  }\n  "],["\n  vec4 localNormal() {\n    vec3 right \x3d profileRight.xyz;\n    vec3 up \x3d profileUp.xyz;\n    vec3 forward \x3d cross(up, right);\n    vec2 profileNormal \x3d profileVertexAndNormal.zw;\n\n    vec3 normal \x3d right * profileNormal.x + up * profileNormal.y;\n\n    if(isCapVertex()) {\n      normal +\x3d forward * profileUp.w;\n    }\n\n    return vec4(normal, 1.0);\n  }\n  "]))))};
b.setVVUniforms=function(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors));b.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",b.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",b.vvOpacityOpacities))};var a,e,
d,k,n,c,g,r,p,u,t})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(q,b,l,f,h){function a(a){a.include(f.RgbaFloatEncoding);a.fragment.code.add(h.glsl(e||(e=l(["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "],
["\n    float linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\n      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.ReadLinearDepth=a;(function(a){a.bindUniforms=function(a,b){a.setUniform2fv("nearFar",b.nearFar)}})(a=b.ReadLinearDepth||(b.ReadLinearDepth={}));var e})},"esri/views/3d/webgl-engine/shaders/Path.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/ForwardLinearDepth.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new t.ShaderBuilder;q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("model","mat4").add("modelNormal","mat4").add("camPos","vec3").add("localOrigin","vec3");q.varyings.add("vpos","vec3");q.include(e.PathVertexPosition,b);0===b.output&&(q.include(a.Transform,{linearDepth:!1}),b.receiveShadows&&q.include(p.ReadShadowMap,b),q.include(f.ForwardLinearDepth,b),q.varyings.add("vnormal",
"vec3"),q.varyings.add("vcolor","vec4"),q.vertex.code.add(u.glsl(x||(x=l(["\n      void main() {\n        vpos \x3d calculateVPos();\n\n        vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "],["\n      void main() {\n        vpos \x3d calculateVPos();\n\n        vnormal \x3d normalize((modelNormal * localNormal()).xyz);\n\n        gl_Position \x3d transformPosition(proj, view, vpos);\n\n        forwardLinearDepth();\n\n        vcolor \x3d getColor();\n      }\n    "])))),
q.include(h.Slice,b),q.include(c.EvaluateSceneLighting,b),q.include(n.EvaluateAmbientOcclusion,b),b.receiveShadows&&q.include(p.ReadShadowMap,b),q.include(g.Normals,b),q.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),q.fragment.code.add(u.glsl(v||(v=l(["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "],
["\n      void main() {\n        discardBySlice(vpos);\n\n        shadingParams.viewDirection \x3d normalize(vpos - camPos);\n        shadingParams.normalView \x3d vnormal;\n        vec3 normal \x3d shadingNormal(shadingParams);\n        float ssao \x3d evaluateAmbientOcclusionInverse();\n\n        float additionalAmbientScale \x3d _oldHeuristicLighting(vpos + localOrigin);\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n    "])))),
b.receiveShadows?q.fragment.code.add(u.glsl(y||(y=l(["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "])))):0===b.viewingMode?q.fragment.code.add(u.glsl(m||(m=l(["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "],["\n        float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n      "])))):q.fragment.code.add(u.glsl(w||(w=l(["\n        float shadow \x3d 0.0;\n      "],
["\n        float shadow \x3d 0.0;\n      "])))),q.fragment.code.add(u.glsl(A||(A=l(["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],
["\n        vec3 albedo \x3d vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one\n        float combinedOpacity \x3d vcolor.a * opacity;\n        albedo +\x3d 0.25 * specular; // don't completely ignore specular for now\n\n        vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);\n        gl_FragColor \x3d vec4(shadedColor, combinedOpacity);\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));
if(1===b.output||3===b.output)q.include(a.Transform,{linearDepth:!0}),q.vertex.uniforms.add("nearFar","vec2"),q.varyings.add("depth","float"),q.vertex.code.add(u.glsl(B||(B=l(["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "],["\n        void main() {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, depth);\n        }\n    "])))),
q.include(h.Slice,b),q.include(d.OutputDepth,b),q.fragment.uniforms.add("timeElapsed","float"),q.fragment.code.add(u.glsl(C||(C=l(["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          outputDepth(depth);\n        }\n    "]))));2===b.output&&(q.include(a.Transform,{linearDepth:!1}),q.include(r.NormalUtils,b),q.vertex.uniforms.add("viewNormal","mat4"),q.varyings.add("vnormal",
"vec3"),q.vertex.code.add(u.glsl(E||(E=l(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),
q.include(h.Slice,b),q.fragment.uniforms.add("waterColor","vec4"),q.fragment.code.add(u.glsl(G||(G=l(["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "],["\n        void main() {\n          discardBySlice(vpos);\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 1.0);\n        }\n    "])))));
4===b.output&&(q.include(a.Transform,{linearDepth:!1}),q.include(r.NormalUtils,b),q.vertex.uniforms.add("viewNormal","mat4"),q.varyings.add("vnormal","vec3"),q.vertex.code.add(u.glsl(J||(J=l(["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "],["\n        void main(void) {\n          vpos \x3d calculateVPos();\n          gl_Position \x3d transformPosition(proj, view, vpos);\n        }\n    "])))),q.include(h.Slice,
b),q.include(k.OutputHighlight),q.fragment.code.add(u.glsl(I||(I=l(["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vpos);\n        outputHighlight();\n      }\n    "])))));return q};var x,v,y,m,w,A,B,C,E,G,J,I})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/mathUtils ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./PathTechnique ./VisualVariableMaterialParameters ./internal/bufferWriterUtils ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){var y=g.assert;q=function(b){function c(a,d){d=b.call(this,d)||this;d.supportsEdges=!0;d.techniqueConfig=new r.PathTechniqueConfiguration;d.params=x.copyParameters(a,w);d.vertexBufferLayout=c.getVertexBufferLayout(d.params);return d}f(c,b);c.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=a;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;
this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;0===a&&(this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,this.techniqueConfig.receiveSSAO=this.params.receiveSSAO);return this.techniqueConfig};c.prototype.getPassParameters=function(){return this.params};
c.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};c.prototype.isVisible=function(){var a=this.params;return b.prototype.isVisible.call(this)?0<a.opacity:!1};c.prototype.setParameterValues=function(a){t.updateParameters(this.params,a)&&this.parametersChanged()};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(b,c,d,e,g,f,k){if(b.metadata){c=b.metadata.pathGeometry;d=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var m=
this.params.vvSizeOffset,p=this.params.vvSizeFactor,n=this.params.vvSizeMinSize,l=this.params.vvSizeMaxSize,r=c.sizeAttributeValue;d[0]*=h.clamp(m[0]+r*p[0],n[0],l[0]);d[1]*=h.clamp(m[1]+r*p[1],n[1],l[1])}m=Math.max(d[0],d[1]);b=a.fromValues(b.boundingInfo.bbMin[0]-m,b.boundingInfo.bbMin[1]-m,b.boundingInfo.bbMin[2]-m,b.boundingInfo.bbMax[0]+m,b.boundingInfo.bbMax[1]+m,b.boundingInfo.bbMax[2]+m);m=[f[0]-g[0],f[1]-g[1],f[2]-g[2]];p=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]);x.intersectAabbInvDir(b,g,
[p/m[0],p/m[1],p/m[2]],e.tolerance)&&(c.baked.size&&c.baked.size[0]===d[0]&&c.baked.size[1]===d[1]||c.baked.bake(d),c.baked.intersect(g,f,k))}};c.prototype.computeAttachmentOrigin=function(a,b){a=a.data;return(a="getVertexAttr"in a?a.getVertexAttr():"vertexAttr"in a?a.vertexAttr:null)?k.computeAttachmentOriginLines(a[r.PathVertexAttrConstants.POSITION],null,b):null};c.prototype.createBufferWriter=function(){return new A(this.vertexBufferLayout)};c.prototype.createRenderer=function(a,b){return new v(a,
b,this,r.pathVertexAttributeLocations)};c.prototype.getGLMaterial=function(a){if(0===a.output||1===a.output||2===a.output||4===a.output||3===a.output&&this.params.castShadows)return new m(a)};c.getVertexBufferLayout=function(a){var b=d.newLayout().vec3f(r.PathVertexAttrConstants.POSITION).vec4f(r.PathVertexAttrConstants.PROFILERIGHT).vec4f(r.PathVertexAttrConstants.PROFILEUP).vec4f(r.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);if(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)b=b.vec4f(r.PathVertexAttrConstants.FEATUREVALUE);
return b};return c}(c.Material);var m=function(a){function b(b){b=a.call(this,b)||this;b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(r.PathTechnique,this.material.getTechniqueConfig(this.output),this.technique)};b.prototype.beginSlot=function(a){return a===(this.technique.configuration.transparent?6:4)};b.prototype._updateShadowState=function(a){a.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&
(this.material.setParameterValues({receiveShadows:a.shadowMappingEnabled}),this.updateParameters())};b.prototype.bind=function(a,b){0===this.output&&this._updateShadowState(b);a.bindProgram(this.technique.program);this.technique.bindPipelineState(a);this.technique.bindPass(a,this.material.getPassParameters(),b)};return b}(n.GLMaterial),w=l({size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,
slicePlaneEnabled:!1,transparent:!1},p.Default),A=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[r.PathVertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d){var g=function(a){if(a in b.vertexAttr){var g=b.vertexAttr[a],f=b.indices[a];y(4===g.size);var k=c.getField(a,e.BufferViewVec4f);if(k)u.writeBufferVec4(f,g.data,k,d);else throw Error("unable to acquire view for "+
a);}};g(r.PathVertexAttrConstants.PROFILERIGHT);g(r.PathVertexAttrConstants.PROFILEUP);g(r.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(r.PathVertexAttrConstants.FEATUREVALUE)&&g(r.PathVertexAttrConstants.FEATUREVALUE);u.writeDefaultAttributes(b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,c,d)};return a}();return q})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function x(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._hasOutline=!1;return a}l(x,b);x.prototype.doLoad=function(){return h(this,void 0,void 0,function(){return f(this,function(a){this._prepareFillResources();this._prepareOutlineResources();return[2]})})};x.prototype._prepareFillResources=function(){var a=d.get(this.symbolLayer,"material","color"),a=this._getCombinedOpacityAndColor(a);
this._material=new C({color:a,transparent:1>a[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},this._getIdHint("_colormat"));this._context.stage.add(3,this._material)};x.prototype._prepareOutlineResources=function(){var a=this.symbolLayer.outline;if(this._isValidOutline(a)){this._hasOutline=!0;var b;b=k.pt2px(a.size);var c=a.stipplePattern?E.createStipplePattern(a.stipplePattern.map(k.pt2px)):null,a=a.stippleOffColor?e.toUnitRGBA(a.stippleOffColor):
null;b=1.5<b?new J({width:b,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_ribbonlinemat")):new G({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:b,stipplePattern:c,stippleIntegerRepeats:!0,stippleOffColor:a},this._getIdHint("_outline_nativelinemat"));this._outlineMaterial=b;this._context.stage.add(3,this._outlineMaterial)}};
x.prototype._isValidOutline=function(a){return d.isSome(a)&&a.size&&0<a.size&&d.isSome(a.color)};x.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=null)};x.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometryType(b.geometry,x.validGeometryTypes,this.symbolLayer.type)||
!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,c):this._createAs3DShape(b,a,d,c)};x.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,b=d.get(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(b);this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:1>
b||this.needsDrivenTransparentPass});this._outlineMaterial&&(a=this._outlineMaterial.getParameters().color,this._outlineMaterial.setParameterValues({color:[a[0],a[1],a[2],this._getOutlineOpacity()]}));return!0};x.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=p.elevationModeChangeUpdateType(x.elevationModeChangeTypes,c,d);if(c!==p.SymbolUpdateType.UPDATE)return c;var e=p.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};
x.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};x.prototype.physicalBasedRenderingChanged=function(){return!0};x.prototype.pixelRatioChanged=function(){return!0};x.prototype._createAs3DShape=function(a,b,c,e){var g=m.geometryAsPolygon(a.geometry);if(d.isNone(g))return null;K.renderData=
m.geometryToRenderInfo(g,this._context.elevationProvider,this._context.renderCoordsHelper,c);K.idHint=e;K.color=b;K.outNum=0;K.outGeometries=[];K.outTransforms=[];K.outMaterials=[];this._createAs3DShapeFill(K);this._hasOutline&&this._createAs3DShapeOutline(K);this._logGeometryCreationWarnings(K.renderData,g.rings,"rings","FillSymbol3DLayer");if(0===K.outNum)return null;a=new A({geometries:K.outGeometries,materials:K.outMaterials,transformations:K.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,
graphicUid:a.uid},idHint:e});a=new t(this,a,K.outGeometries,null,null,r.perVertexElevationAligner,c);a.alignedSampledElevation=K.renderData.sampledElevation;a.needsElevationUpdates=p.needsElevationUpdates2D(c.mode);return a};x.prototype._createAs3DShapeFill=function(a){for(var b=a.renderData.polygons,e=0;e<b.length;++e){var f=b[e],k=f.position,h=f.mapPosition,f=f.holeIndices;if(d.isSome(this._context.clippingExtent)&&(g.empty(I),g.expandWithBuffer(I,h),!g.intersectsClippingArea(I,this._context.clippingExtent)))continue;
f=n(h,f,3);0!==f.length&&(f=new Uint32Array(f),k=m.createColorGeometryData({indices:f,attributeData:{position:k,color:a.color,mapPosition:h}}),k=new w(k,a.idHint),a.outGeometries.push(k),a.outMaterials.push(this._material),a.outTransforms.push(c.mat4f64.IDENTITY),a.outNum++)}};x.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.renderData.outlines,e=0;e<b.length;++e){var f=b[e],k=f.position,f=f.mapPosition;if(d.isSome(this._context.clippingExtent)&&(g.empty(I),g.expandWithBuffer(I,
f),!g.intersectsClippingArea(I,this._context.clippingExtent)))continue;k=y.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof G?0:1,attributeData:{position:k,mapPosition:f}});k=new w(k,a.idHint+"outline"+e);a.outGeometries.push(k);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(c.mat4f64.IDENTITY);a.outNum++}};x.prototype._createAsOverlay=function(a,b,c){var e=m.geometryAsPolygon(a.geometry);if(d.isNone(e))return null;this._material.renderPriority=this._renderPriority+
this._renderPriorityDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._renderPriority);H.renderData=m.geometryToRenderInfoDraped(e,this._context.overlaySR);H.idHint=c;H.color=b;H.outNum=0;H.outGeometries=[];H.outBoundingBox=g.empty();H.layerUid=this._context.layer.uid;H.graphicsUid=a.uid;this._createAsOverlayFill(H);this._hasOutline&&this._createAsOverlayOutline(H);this._logGeometryCreationWarnings(H.renderData,e.rings,"rings","FillSymbol3DLayer");return 0<H.outNum?new u(this,H.outGeometries,
H.outBoundingBox):null};x.prototype._createAsOverlayFill=function(a){for(var b=a.renderData.polygons,d=0;d<b.length;++d){var e=b[d],f=e.position,e=e.holeIndices;g.empty(I);g.expandWithBuffer(I,f);if(g.intersectsClippingArea(I,this._context.clippingExtent)&&(e=n(f,e,3),0!==e.length)){g.expand(a.outBoundingBox,I);e=new Uint32Array(e);f=m.createColorGeometryData({indices:e,attributeData:{position:f,color:a.color}});e=new B(f);e.data.layerUid=a.layerUid;e.data.graphicUid=a.graphicsUid;e.material=this._material;
var k=I;e.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];e.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));e.transformation=c.mat4f64.create();e.name=a.idHint;e.uniqueName=a.idHint+"#"+f.id;a.outGeometries.push(e);a.outNum++}}};x.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.renderData.outlines,d=0;d<b.length;++d){var e=b[d].position;g.empty(I);g.expandWithBuffer(I,e);if(g.intersectsClippingArea(I,this._context.clippingExtent)){g.expand(a.outBoundingBox,
I);var e=y.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof G?0:1,attributeData:{position:e}}),f=new B(e);f.data.layerUid=a.layerUid;f.data.graphicUid=a.graphicsUid;f.material=this._outlineMaterial;var k=I;f.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];f.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));f.transformation=c.mat4f64.create();f.name=a.idHint+"outline";f.uniqueName=a.idHint+"outline#"+e.id;a.outGeometries.push(f);a.outNum++}}};x.prototype._getOutlineOpacity=
function(){var a=d.get(this.symbolLayer,"outline","color");return this._getLayerOpacity()*(d.isSome(a)?a.a:0)};x.prototype._getOutlineColor=function(){var b=d.get(this.symbolLayer,"outline","color"),c=this._getOutlineOpacity();return v.mixinColorAndOpacity(d.isSome(b)?a.toUnitRGB(b):null,c)};Object.defineProperty(x.prototype,"test",{get:function(){var a=this;return{createAsOverlay:function(b,c,d){return a._createAsOverlay(b,c,d)},createAs3DShape:function(b,c,d,e){return a._createAs3DShape(b,c,d,e)}}},
enumerable:!0,configurable:!0});x.validGeometryTypes=["polyline","polygon","extent"];x.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};return x}(x.default);b.Graphics3DPolygonFillSymbolLayer=q;var I=g.create(),K={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},H={idHint:null,renderData:null,color:null,outNum:0,outBoundingBox:null,
outGeometries:null,outMaterials:null,outTransforms:null};b.default=q})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){function C(a,b,c){a&&a.forEach(function(a){var d=b(a);e.isSome(d)&&c(d,a.graphic)})}Object.defineProperty(b,"__esModule",{value:!0});var E=[0,0,1];q=function(b){function u(a,c,g,f){a=b.call(this,a,c,g,f)||this;a._geometryDataPool=new d(y.GeometryData,function(a,b,c){var d=b.translation;c=e.isSome(c)?[c.displayWidth,c.displayHeight]:[0,0];b=b.centerOffset;0===a.indexCount?m.createPointGeometry(E,d,null,c,b,[0,0],null,a):m.updatePointGeometry(null,
d,null,c,b,null,null,a)});a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}l(u,b);u.prototype.doLoad=function(){return h(this,void 0,void 0,function(){var b;return f(this,function(c){if(!this._drivenProperties.size&&(b=t.validateSymbolLayerSize(this.symbolLayer.size)))throw new a("graphics3dtextsymbollayer:invalid-size",b);this._createTextRenderParameters();return[2]})})};u.prototype._createTextRenderParameters=function(){this._textRenderParameters=w.default.fromSymbol(this.symbolLayer,
this._context.layerView.view.pixelRatio)};u.prototype.destroy=function(){b.prototype.destroy.call(this);this._geometryDataPool.destroy()};u.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var b=x.placePointOnGeometry(a.geometry);if(e.isNone(b))return this.logger.warn("unsupported geometry type for text symbol: "+a.geometry.type),null;var d=this.symbolLayer.text;if(!d)return null;var g=c.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(a,
b,d,g)};u.prototype.onRemoveGraphic=function(a){this._geometryDataPool.release(a.stageObject.geometries[0].data)};u.prototype.createLabel=function(a,b,c,d){a=a.graphic;var g=x.placePointOnGeometry(a.geometry);if(e.isNone(g))return this.logger.warn("unsupported geometry type for label: "+a.geometry.type),null;var f=b.text;return f?this._createAs3DShape(a,g,f,b,b,c,d):null};u.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);
return a};u.prototype.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};u.prototype.layerElevationInfoChanged=function(a,b){var c=this;C(a,b,function(a,b){c.updateGraphicElevationContext(b,a)});return r.SymbolUpdateType.UPDATE};u.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;C(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});
return!0};u.prototype.physicalBasedRenderingChanged=function(){return!0};u.prototype.pixelRatioChanged=function(){return!1};u.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=r.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};u.prototype._defaultElevationInfoNoZ=function(){return G};u.prototype._createAs3DShape=function(a,b,c,d,f,h,m){void 0===f&&(f=J);var l=this.getGraphicElevationContext(a,
f.elevationOffset),w=this._context.layer.id+"_label_"+a.uid,u="polyline"===e.get(a.geometry,"type"),y=a.uid;a=this._context.stage.renderView.renderingContext;var q=t.namedAnchorToHUDMaterialAnchorPos[f.anchor in t.namedAnchorToHUDMaterialAnchorPos?f.anchor:"center"];a=e.isNone(m)?new A(a,c,this._textRenderParameters,w):null;q={occlusionTest:!0,screenOffset:f.screenOffset,anchorPos:q,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:f.centerOffsetUnits,debugDrawBorder:f.debugDrawBorder,drawInSecondSlot:!0};
e.isSome(a)&&(q.textureId=a.id,q.texCoordScale=a.texcoordScale);e.isSome(m)&&(q.textureId=m.textureId);if(e.isSome(d)&&e.isSome(d.verticalOffset)){d=d.verticalOffset;m=d.minWorldLength;var C=d.maxWorldLength;q.verticalOffset={screenLength:k.pt2px(d.screenLength),minWorldLength:m||0,maxWorldLength:null!=C?C:Infinity}}this._context.screenSizePerspectiveEnabled&&(d=this._context.sharedResources,m=d.screenSizePerspectiveSettings,q.screenSizePerspective=d.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),
q.screenSizePerspectiveAlignment=m);u&&(q.shaderPolygonOffset=1E-4);q.slicePlaneEnabled=this._context.slicePlaneEnabled;u=null;d=JSON.stringify(q);e.isSome(h)?(u=h.getMaterial(d),null==u&&(u=new B(q,w),h.addMaterial(d,u))):u=new B(q,w);u=[u];q=this._geometryDataPool.acquire(f,a);q=[new v(q,w)];w=x.createStageObjectForHUD(this._context,b,q,u,null,null,l,w,this._context.layer.uid,y);if(null===w)return null;y=g.perObjectElevationAligner;h=new p(this,w.object,q,e.isNone(h)?u:null,e.isSome(a)?[a]:null,
y,l);h.alignedSampledElevation=w.sampledElevation;h.needsElevationUpdates=r.needsElevationUpdates2D(l.mode)||"absolute-height"===l.mode;var l=e.isSome(a)?a:f,E=l.displayWidth,H=l.displayHeight;h.getScreenSize=function(a){void 0===a&&(a=n.vec2f64.create());a[0]=E;a[1]=H;return a};h.metadata={labelText:c,elevationOffset:f.elevationOffset};x.extendPointGraphicElevationContext(h,b,this._context.elevationProvider);return h};return u}(u.default);b.Graphics3DTextSymbolLayer=q;var G={mode:"relative-to-ground",
offset:0},J={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.default=q})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("require exports ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/factories/vec4f64".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",
{value:!0});q=function(){function b(a){this.definition=a;this.key=JSON.stringify(a);this.haloSize=Math.round(a.halo.size);this.fillStyle=this.colorToRGBA(a.color);this.haloStyle=this.colorToRGB(a.halo.color)}b.prototype.colorToRGB=function(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"};b.prototype.colorToRGBA=function(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"};b.fromSymbol=function(d,e){void 0===e&&(e=
1);var k=f.get(d,"material","color"),k=f.isSome(k)?l.toUnitRGBA(k):a.ZEROS,c=d.halo,g=null!=d.size?h.pt2px(d.size):12;d={family:d.font&&d.font.family?d.font.family:"sans-serif",weight:d.font&&d.font.weight?d.font.weight:"normal",style:d.font&&d.font.style?d.font.style:"normal"};c=f.isSome(c)&&f.isSome(c.color)&&0<c.size?{size:h.pt2px(c.size),color:l.toUnitRGBA(c.color)}:{size:0,color:a.ZEROS};return new b({size:g,color:k,font:d,halo:c,pixelRatio:e})};return b}();b.TextRenderParameters=q;b.default=
q})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),function(q,b,l,f,h,a,e,d,k){var n={canvas:null};return function(){function b(b,c,d,e){this._idHint=e;this._glTexture=null;this.events=new l;this._requiresPowerOfTwo=!k.default(b.gl);this._renderer=new a.default(c,d)}Object.defineProperty(b.prototype,
"id",{get:function(){null==this._id&&(this._id=e.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._renderer.renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._renderer.renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureWidth",{get:function(){var a=this.width;return this._requiresPowerOfTwo?f.nextHighestPowerOfTwo(a):
a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureHeight",{get:function(){var a=this.height;return this._requiresPowerOfTwo?f.nextHighestPowerOfTwo(a):a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});b.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};b.prototype.load=
function(b){if(h.isSome(this._glTexture))return this._glTexture;var c=a.getTextHelperCanvas(n,this.textureWidth,this.textureHeight),e=c.getContext("2d");e.save();this._renderer.render(e,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new d(b,this.createDescriptor(b),c);e.restore();return this._glTexture};b.prototype.unload=function(){h.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};return b}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require",
"exports","../../../../core/maybe","./TextRenderParameters"],function(q,b,l,f){function h(a,b,d){a.canvas||(a.canvas=document.createElement("canvas"));a.canvas.width=b;a.canvas.height=d;return a.canvas}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,d){void 0===d&&(d=2048);this.text=a;this.maxSize=d;this._displayWidth=this._renderPixelRatio=null;this.parameters=b instanceof f.default?b:new f.default(b);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);
this.lineHeight=this.computeLineHeight()}Object.defineProperty(b.prototype,"displayWidth",{get:function(){l.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPixelRatio",{get:function(){if(l.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},enumerable:!0,configurable:!0});
b.prototype.render=function(a,b,d){void 0===b&&(b=0);void 0===d&&(d=0);var c=this.renderedLineHeight,e=this.renderedHaloSize,g=a.textAlign,f=this.renderedWidth,g=("center"===g?.5*f:"right"===g?f:0)+e;a.save();0<e&&this.renderHalo(a,g,e,b,d);this.setFontProperties(a,this.renderedFontSize);d+=e;b+=g;e=0;for(g=this.textLines;e<g.length;e++)f=g[e],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(f,b,d),a.globalCompositeOperation="source-over",a.fillStyle=this.parameters.fillStyle,
a.fillText(f,b,d),d+=c;a.restore()};b.prototype.renderHalo=function(a,b,e,f,n){var c=this.renderedWidth,g=this.renderedHeight,p=h(d,Math.max(c,k),Math.max(g,k)),l=p.getContext("2d");l.clearRect(0,0,c,g);this.setFontProperties(l,this.renderedFontSize);l.fillStyle=this.parameters.haloStyle;l.strokeStyle=this.parameters.haloStyle;var m=3>this.renderedHaloSize;l.lineJoin=m?"miter":"round";m?this.renderHaloEmulated(l,b,e):this.renderHaloNative(l,b,e);a.globalAlpha=this.parameters.definition.halo.color[3];
a.drawImage(p,0,0,c,g,f,n,c,g);a.globalAlpha=1};b.prototype.renderHaloEmulated=function(b,d,e){for(var c=this.renderedLineHeight,g=this.renderedHaloSize,f=0,k=this.textLines;f<k.length;f++){for(var h=k[f],n=0,m=a;n<m.length;n++){var l=m[n];b.fillText(h,d+g*l[0],e+g*l[1])}e+=c}};b.prototype.renderHaloNative=function(a,b,d){for(var c=this.renderedLineHeight,e=this.renderedHaloSize,g=0,f=this.textLines;g<f.length;g++){for(var k=f[g],h=2*e,m=0;5>m;m++)a.lineWidth=(.6+.1*m)*h,a.strokeText(k,b,d);d+=c}};
b.prototype.setFontProperties=function(a,b){var c=this.parameters.definition.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};b.prototype.computeTextWidth=function(){var a=h(d,k,k).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var b=0,e=0,f=this.textLines;e<f.length;e++)b=Math.max(b,a.measureText(f[e]).width);e=this.parameters.definition.font;if("italic"===e.style||"oblique"===e.style||"string"===typeof e.weight&&
("bold"===e.weight||"bolder"===e.weight)||"number"===typeof e.weight&&600<e.weight)b+=.3*a.measureText("A").width;b+=2*this.parameters.haloSize;return Math.round(b)};b.prototype.computeLineHeight=function(){return Math.floor(1.275*this.parameters.definition.size+2*this.parameters.haloSize)};return b}();b.TextRenderer=q;for(var a=[],e=0;360>e;e+=22.5)a.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);b.getTextHelperCanvas=h;var d={canvas:null},k=512;b.default=q})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/math/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function A(a,c,d,e){return b.call(this,a,c,d,e)||this}f(A,b);A.prototype.doLoad=function(){return a(this,void 0,void 0,function(){var a,b;return h(this,function(c){a=I.waterParameterDefaultsLocal;b=l({},a);this._updateMaterialParameters(b);b.isDraped=!0;this._drapedMaterial=new J.WaterMaterial(b,"waterDraped");this._context.stage.add(3,this._drapedMaterial);this._updateMaterialParameters(a);
this._material=new J.WaterMaterial(a,"water");this._context.stage.add(3,this._material);return[2]})})};A.prototype.destroy=function(){b.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(3,this._drapedMaterial.id),this._drapedMaterial=null)};A.prototype.createGraphics3DGraphic=function(a){a=a.graphic;if(!this._validateGeometryType(a.geometry,A.validGeometryTypes,this.symbolLayer.type)||
!this._validateGeometry(a.geometry))return null;var b="graphic"+a.uid,c=this.getGraphicElevationContext(a);return"on-the-ground"===c.mode?this._createAsOverlay(a,b):this._createAs3DShape(a,c,b,a.uid)};A.prototype.layerOpacityChanged=function(){var a=this._material.getParameters().color,b=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),c=1>b||this.needsDrivenTransparentPass;this._material.setParameterValues({color:[a[0],a[1],a[2],b],transparent:c});this._drapedMaterial.setParameterValues({color:[a[0],
a[1],a[2],b],transparent:c});return!0};A.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;c=y.elevationModeChangeUpdateType(A.elevationModeChangeTypes,c,d);if(c!==y.SymbolUpdateType.UPDATE)return c;var e=y.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};A.prototype.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._drapedMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};A.prototype.physicalBasedRenderingChanged=function(){return!0};A.prototype.pixelRatioChanged=function(){return!0};A.prototype._createAs3DShape=function(a,b,c,e){a=B.geometryAsPolygon(a.geometry);if(d.isNone(a))return null;S.renderData=B.geometryToRenderInfo(a,this._context.elevationProvider,this._context.renderCoordsHelper,b);var g=S.renderData.position.length/3;S.uvCoords=new Float64Array(2*g);S.idHint=c;S.outNum=0;S.outGeometries=[];S.outTransforms=[];S.outMaterials=[];this._create3DShapeGeometries(S);
this._logGeometryCreationWarnings(S.renderData,a.rings,"rings","WaterSymbol3DLayer");if(0===S.outNum)return null;this._createUVCoordsFromVertices(S.uvCoords,S.renderData.mapPosition,g,this._context.elevationProvider.spatialReference);c=new E({geometries:S.outGeometries,materials:S.outMaterials,transformations:S.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:c});c=new w(this,c,S.outGeometries,null,null,v.perVertexElevationAligner,b);c.alignedSampledElevation=
S.renderData.sampledElevation;c.needsElevationUpdates=y.needsElevationUpdates2D(b.mode);return c};A.prototype._createUVCoordsFromVertices=function(a,b,c,d){d=k.getMetersPerUnitForSR(d);x.empty(H);for(var e=0;e<c;e++)g.vec2.set(L,b[3*e+0],b[3*e+1]),x.expandPointInPlace(H,L);p.vec4.scale(H,H,d);e=H[1]%A.unitSizeOfTexture;K[0]=H[0]-H[0]%A.unitSizeOfTexture;K[1]=H[1]-e;for(e=0;e<c;e++)a[2*e+0]=(b[3*e+0]*d-K[0])/A.unitSizeOfTexture,a[2*e+1]=(b[3*e+1]*d-K[1])/A.unitSizeOfTexture};A.prototype._create3DShapeGeometries=
function(a){for(var b=a.uvCoords,e=0,g=a.renderData.polygons;e<g.length;e++){var f=g[e],k=f.count,h=f.index,m=f.position,p=f.mapPosition,f=f.holeIndices;if(d.isSome(this._context.clippingExtent)&&(t.empty(P),t.expandWithBuffer(P,p),!t.intersectsClippingArea(P,this._context.clippingExtent)))continue;f=n(p,f,3);0!==f.length&&(f=new Uint32Array(f),k=new Float64Array(b.buffer,2*h*b.BYTES_PER_ELEMENT,2*k),m=B.createWaterGeometryData({indices:f,attributeData:{position:m,uv0:k,mapPosition:p}}),m=new C(m,
a.idHint),a.outGeometries.push(m),a.outMaterials.push(this._material),a.outTransforms.push(c.mat4f64.IDENTITY),a.outNum++)}};A.prototype._updateMaterialParameters=function(a){var b=this.symbolLayer.color;d.isSome(b)&&(a.color=e.toUnitRGBA(b));b=this._getCombinedOpacity(b,{hasIntrinsicColor:!0});a.color=[a.color[0],a.color[1],a.color[2],b];a.transparent=1>b||this.needsDrivenTransparentPass;a.waveDirection=d.isSome(this.symbolLayer.waveDirection)?A.headingVectorFromAngle(this.symbolLayer.waveDirection):
r.vec2f64.fromValues(0,0);b=I.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];a.waveStrength=b.waveStrength;a.waveTextureRepeat=b.textureRepeat;a.waveVelocity=b.waveVelocity;a.flowStrength=b.perturbationStrength;a.slicePlaneEnabled=this._context.slicePlaneEnabled};A.prototype._createAsOverlay=function(a,b){var c=B.geometryAsPolygon(a.geometry);if(d.isNone(c))return null;this._drapedMaterial.renderPriority=this._renderPriority+this._renderPriorityDelta/2;R.renderData=
B.geometryToRenderInfoDraped(c,this._context.overlaySR);R.idHint=b;b=R.renderData.position.length/3;R.uvCoords=new Float64Array(2*b);R.outNum=0;R.outGeometries=[];R.outBoundingBox=t.empty();R.layerUid=this._context.layer.uid;R.graphicsUid=a.uid;this._createAsOverlayWater(R);this._logGeometryCreationWarnings(R.renderData,c.rings,"rings","WaterSymbol3DLayer");if(0===R.outNum)return null;this._createUVCoordsFromVertices(R.uvCoords,R.renderData.position,b,c.spatialReference);return 0<R.outNum?new m(this,
R.outGeometries,R.outBoundingBox):null};A.prototype._createAsOverlayWater=function(a){for(var b=a.uvCoords,d=0,e=a.renderData.polygons;d<e.length;d++){var g=e[d],f=g.position,k=g.holeIndices,h=g.index,g=g.count;t.empty(P);t.expandWithBuffer(P,f);t.intersectsClippingArea(P,this._context.clippingExtent)&&(t.expand(a.outBoundingBox,P),k=n(f,k,3),0!==k.length&&(k=new Uint32Array(k),h=new Float64Array(b.buffer,2*h*b.BYTES_PER_ELEMENT,2*g),f=B.createWaterGeometryData({indices:k,attributeData:{position:f,
uv0:h}}),h=new G(f),h.data.layerUid=a.layerUid,h.data.graphicUid=a.graphicsUid,h.material=this._drapedMaterial,g=P,h.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0],h.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1])),h.transformation=c.mat4f64.create(),h.name=a.idHint,h.uniqueName=a.idHint+"#"+f.id,a.outGeometries.push(h),a.outNum++))}};A.headingVectorFromAngle=function(a){var b=r.vec2f64.create();a=u.toRadian(a);b[0]=Math.sin(a);b[1]=Math.cos(a);return b};Object.defineProperty(A.prototype,
"test",{get:function(){var a=this;return{create3DShape:function(b){return a._createAs3DShape(b.graphic,b.elevationContext,b.idHint,b.graphicUid)}}},enumerable:!0,configurable:!0});A.validGeometryTypes=["polyline","polygon","extent"];A.unitSizeOfTexture=100;A.elevationModeChangeTypes={definedChanged:y.SymbolUpdateType.RECREATE,staysOnTheGround:y.SymbolUpdateType.NONE,onTheGroundChanged:y.SymbolUpdateType.RECREATE};return A}(A.default);b.Graphics3DWaterSymbolLayer=q;var K=r.vec2f64.create(),H=x.create(),
L=r.vec2f64.create(),P=t.create(),S={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},R={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=q})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../lib/AnimationTimer ../lib/Material ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil ./internal/waterMaterialUtils ./renderers/MergedRenderer".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b,e){e=a.call(this,e)||this;e.animation=new h.AnimationTimer;e.techniqueConfig=new d.WaterTechniqueConfiguration;e.params=n.copyParameters(b,c.waterParameterDefaultsLocal);return e}l(b,a);b.prototype.setParameterValues=function(a){this.params=f({},this.params,a);this.parametersChanged()};b.prototype.getParameters=function(){return this.params};b.prototype.getTechniqueConfig=function(a){this.techniqueConfig.output=
a;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;return this.techniqueConfig};b.prototype.update=function(a){this.animation.enabled=Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*Math.min(a.camera.relativeElevation,a.camera.distance)<r;this.animation.advance(a.dt);return this.animation.enabled};
b.prototype.intersect=function(a,b,c,d,e,g,f){n.intersectTriangleGeometry(a,b,d,e,g,void 0,f)};b.prototype.getGLMaterial=function(a){if(2===a.output)return new e.WaterGLMaterial(a);if(0===a.output)return this.params.isDraped&&(a.output=5),new e.WaterGLMaterial(a)};b.prototype.createBufferWriter=function(){return new k.DefaultBufferWriter(k.PositionUVLayout)};b.prototype.createRenderer=function(a,b){return new g(a,b,this)};return b}(a.Material);b.WaterMaterial=q;var r=35E3})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["require",
"exports","../../../../core/maybe","../../../../layers/support/timeUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){void 0===a&&(a=!0);this.enabled=a;this._time=0}Object.defineProperty(b.prototype,"time",{get:function(){return l.isSome(this._forcedTime)?this._forcedTime:f.Milliseconds(this._time)},enumerable:!0,configurable:!0});b.prototype.advance=function(a){this.enabled&&(this._time+=a)};b.prototype.forceTime=function(a){this._forcedTime=a};
return b}();b.AnimationTimer=q})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Loadable ./symbolComplexity".split(" "),function(q,b,l,f,h,a,e){return function(a){function b(b,c){var d=a.call(this)||this;d.symbol=b;d.convert=c;d.graphics3DSymbol=null;d.referenced=0;return d}l(b,a);b.prototype.getSymbolLayerSize=function(a){return this.graphics3DSymbol?
this.graphics3DSymbol.getSymbolLayerSize(a):null};b.prototype.doLoad=function(a){return h(this,void 0,void 0,function(){var b;return f(this,function(c){switch(c.label){case 0:return[4,this.symbol.fetchSymbol({signal:a})];case 1:return b=c.sent(),b.id=this.symbol.id,this.graphics3DSymbol=this.convert(b),[4,this.graphics3DSymbol.load()];case 2:return c.sent(),[2]}})})};b.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,this)};Object.defineProperty(b.prototype,
"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:e.emptySymbolComplexity},enumerable:!0,configurable:!0});b.prototype.globalPropertyChanged=function(a,b){return this.graphics3DSymbol.globalPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b){return this.graphics3DSymbol.applyRendererDiff(a,b)};b.prototype.prepareSymbolPatch=function(a){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(a)};b.prototype.updateGeometry=function(a,b){return this.graphics3DSymbol?
this.graphics3DSymbol.updateGeometry(a,b):!1};b.prototype.onRemoveGraphic=function(){};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};b.prototype.destroy=function(){this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return b}(a.Loadable)})},
"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a){return c.getGraphics3DSymbol(a.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}
function p(a,b){var c=b.graphics3DGraphic.graphic.geometry;if(h.isNone(c))return null;if(h.isSome(b.disablePlacement))return(c=b.labelClass.labelPlacement)?(m.warnOncePerTick(u(a.placement,b.disablePlacement.logEntityDescription)),t(b)):a;var d=c.type;switch(d){case "polyline":case "polygon":case "extent":case "multipoint":if(c=b.labelClass.labelPlacement)return m.warnOncePerTick(u(a.placement,"'"+d+"' geometries")),t(b);break;case "point":case "mesh":break;default:l.neverReached(d)}return a}function u(a,
b){return"the requested label placement '"+a+"' is currently unsupported for "+b+" in SceneView"}function t(a){var b=a.graphics3DGraphic.graphic.geometry;if(h.isNone(b))return null;b=b.type;switch(b){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return a=r(a),h.isSome(a)&&"extrude"===a.type?w["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return w["above-center"];
case "mesh":return w["above-center"];default:l.neverReached(b)}}function x(a,b,c){c=c.graphics3DGraphic._graphics[0];c=h.isSome(c)?c.getBoundingBoxObjectSpace(G):G;c=d.vec3f64.fromValues(c[3]-c[0],c[4]-c[1],c[5]-c[2]);a.centerOffset[0]=1.1*Math.sqrt(c[0]*c[0]+c[1]*c[1])/2*b.normalizedOffset[0];var g=a.translation[2],f=c[2]/2*b.normalizedOffset[1];a.translation[2]=f*(1.1-1);a.elevationOffset=g+f;c=e.vec3.length(c);a.centerOffset[2]=1.1*c/2*b.normalizedOffset[2]}function v(a){var b=a.labelClass.labelPlacement,
d=a.labelSymbol,e=a.graphics3DGraphic,g=c.getGraphics3DSymbol(e.graphics3DSymbol).symbol;a=w[b]||t(a);if("point-3d"===g.type&&g.supportsCallout()&&g.hasVisibleVerticalOffset()&&!e.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(g.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==g.type||!g.supportsCallout()||!g.verticalOffset||e.isDraped())){a:switch(a.placement){case "above-center":e=!0;break a;default:e=!1}return e?{placement:"above-center",
verticalOffset:y(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(m.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(b,
"__esModule",{value:!0});var m=f.getLogger("esri.views.3d.layers.graphics.labelPlacement");b.get=function(b){var c=v(b);if(h.isNone(c))return null;var e;if(c.anchor)e=c;else{e=b.labelClass.labelPlacement;var f=w[e],l=f||t(b);e&&!f&&m.warnOncePerTick("the requested label placement '"+e+"' is not currently supported in SceneView");e=p(l,b)}if(h.isNone(e))return null;f=!!c.hasLabelVerticalOffset;c={anchor:e.anchor,verticalOffset:c.verticalOffset,screenOffset:a.vec2f64.create(),centerOffset:k.vec4f64.fromValues(0,
0,0,-1),centerOffsetUnits:"world",translation:d.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:f};f=b.graphics3DGraphic.graphic.geometry;if(h.isNone(f))b=null;else{switch(f.type){case "point":f=r(b);if(!h.isNone(f))switch(b.graphics3DGraphic.getCenterObjectSpace(c.translation),f.type){case "icon":case "text":l=b.graphics3DGraphic;f=l._graphics[0].getScreenSize();l.isDraped()?c.hasLabelVerticalOffset||"center"===c.anchor||(w[b.labelClass.labelPlacement]&&m.warnOncePerTick("the requested placement '"+
e.placement+"' is currently unsupported for draped graphics"),c.anchor="center"):(l=void 0,void 0===l&&(l=E),b=b.graphics3DGraphic._graphics[0].stageObject.geometryRecords[0].material,b instanceof g?(b=b.getParameters().anchorPos,l[0]=2*(b[0]-.5),l[1]=2*(b[1]-.5)):(l[0]=0,l[1]=0),b=l,C[0]=f[0]/2*(e.normalizedOffset[0]-b[0]),C[1]=f[1]/2*(e.normalizedOffset[1]-b[1]),c.screenOffset[0]=C[0],c.hasLabelVerticalOffset?(c.centerOffset[1]=C[1],c.centerOffsetUnits="screen"):c.screenOffset[1]=C[1]);break;case "object":x(c,
e,b)}break;case "polygon":f=r(b);if(!h.isNone(f))switch(f.type){case "extrude":f=b.graphics3DGraphic._graphics[0],h.isSome(f)&&f.getBoundingBoxObjectSpace(G),n.center(G,c.translation),c.translation[2]=n.height(G)/2,x(c,e,b)}break;case "mesh":x(c,e,b)}b=c}return b};var w={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,
0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,
0,0],anchor:"left"}},A={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};q=function(a){var b=w[a];A[a].forEach(function(a){w[a]=b})};for(var B in A)q(B);Object.freeze&&(Object.freeze(w),Object.keys(w).forEach(function(a){Object.freeze(w[a]);Object.freeze(w[a].normalizedOffset)}));var C=[0,0],E=[0,0],G=n.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports"],function(q,b){return function(){function b(b){this.materials={};this.stage=b}b.prototype.getMaterial=function(b){return this.materials[b]};
b.prototype.addMaterial=function(b,h){this.materials[b]=h;this.stage.add(3,h)};b.prototype.dispose=function(){for(var b in this.materials)this.stage.remove(3,this.materials[b].id);this.materials={}};return b}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/iteratorUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators ./Texture ../../../support/index ../../../webgl/Texture".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c){c=b.call(this,c)||this;c.events=new a;c.glTexture=null;c.dirty=!1;c.needsClear=!1;c.elementsToAddOrUpdate=new Map;c.elementsToRemove=new Map;c.elementsToRender=new Map;c.elements=new Map;c.stageObjects=new Map;return c}l(h,b);y=h;h.prototype.initialize=function(){this.id=c.idGen.gen(this.idHint);this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);var a=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(a);this.update2DCanvasSize();this.resetAtlasCursor()};h.prototype.unload=function(){k.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};Object.defineProperty(h.prototype,"width",{get:function(){return this.atlas.size.width},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"height",{get:function(){return this.atlas.size.height},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"requiresFrameUpdates",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype.createDescriptor=function(a){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:a.parameters.maxMaxAnisotropy}};h.prototype.load=function(a){var b=this;if(k.isSome(this.glTexture))return this.glTexture;this.glTexture=new r(a,this.createDescriptor(a),this.canvas);
this.frameWorker=this.view.resourceController.scheduler.registerTask(g.Task.TEXT_TEXTURE_ATLAS,function(a){return b.run(b.makeRunContext(a))},function(){return b.dirty});this.setDirty();return this.glTexture};h.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(4,this.id));this.canvas.width=0;this.canvas.height=
0;this.ctx=this.canvas=null};h.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};h.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};h.prototype.createAtlasRegion=function(a){void 0===a&&
(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};h.prototype.computeAtlasResolution=function(a,b){a=Math.max(a,b);a=d.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};h.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;k.isSome(this.glTexture)&&this.glTexture.resize(a,b);this.update2DCanvasSize()};h.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=p;a.cursor.y=p+u;a.lineHeight=0;this.needsClear=!0};h.prototype.getAtlasUsage=
function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};h.prototype.getExpectedAtlasUsage=function(){var a=this.elementsToRemove.size,b=this.elementsToAddOrUpdate.size,c=this.elements.size;return this.getAtlasUsage()/c*(c+b-a)};h.prototype.addAtlasElement=function(a,b,c,d){var e=this.atlas,g=a.textRenderer,f=g.renderedWidth,k=g.renderedHeight,h=g.displayWidth,g=g.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=
f;a.placement.size.height=k;a.placement.size.displayWidth=h;a.placement.size.displayHeight=g;a.placement.uvMinMax=[a.placement.offset.x/e.size.width,1-(a.placement.offset.y+k)/e.size.height,(a.placement.offset.x+f)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=c;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(b,a)};h.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);
this.elements.delete(a.textId)}};h.prototype.ensureStageObjects=function(a){var b=this.stageObjects.get(a);if(b)return b;b=new Set;this.stageObjects.set(a,b);return b};h.prototype.addStageObject=function(a,b){this.ensureStageObjects(a).add(b)};h.prototype.removeStageObject=function(a,b){(a=this.stageObjects.get(a))&&a.delete(b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};h.prototype.processAdditionRequest=function(a,b){var c=this.atlas,
d=a.textId,e=a.textRenderer.renderedWidth+p,g=a.textRenderer.renderedHeight+p+u;b=b.repackingEnabled;if(c.cursor.x+e<c.size.width&&c.cursor.y+g<c.size.height)this.addAtlasElement(a,d,e,g),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else if(c.cursor.y+g+c.lineHeight<c.size.height)c.cursor.x=p,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,d,e,g),this.elementsToRender.set(d,a),this.elementsToAddOrUpdate.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&
4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);if(!b||!d&&.95<a&&4096===c.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};h.prototype.processRemovals=function(){var a=this;this.elementsToRemove.forEach(function(b,c){var d=a.stageObjects.get(c);d&&0!==d.size||a.removeAtlasElement(b);d&&0===d.size&&a.stageObjects.delete(c)});this.elementsToRemove.clear()};h.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(b,
c){b.rendered=!1;a.elementsToAddOrUpdate.set(c,b)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};h.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var b=this.stageObjects.get(a.textId);b&&b.forEach(function(b){b.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);
b.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);b.geometryVertexAttrsUpdated(0)});a.rendered=!0};h.prototype.run=function(a){var b=this;if(this.glTexture){var c=a.budget,d=!1;e.someMap(this.elementsToAddOrUpdate,function(c,e){return(c=b.elements.get(e))&&c.rendered?((c=b.stageObjects.get(e))&&c.forEach(function(a){var c=a.geometries[0].data.vertexAttributes,d=b.elements.get(e);c.uv0.data=new Float32Array(d.placement.uvMinMax);
c.size.data=new Float32Array([d.placement.size.displayWidth,d.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),b.elementsToAddOrUpdate.delete(e),!1):1===b.processAdditionRequest(b.elementsToAddOrUpdate.get(e),a)?d=!0:!1});if(d)a.budget=null,a.repackingEnabled=!1,this.run(a);else{var g=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);e.someMap(this.elementsToRender,function(a,d){b.processRenderingRequest(a);
b.elementsToRender.delete(d);g=!0;return c&&(c.madeProgress(),c.done)?!0:!1});g&&k.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;this.dirty||(y.test.orderedRepackingEnabled&&this.repackOrdered(),this.notifyChange("updating"))}}};h.prototype.makeRunContext=function(a){void 0===a&&(a=null);t.budget=a;t.repackingEnabled=!0;return t};h.prototype.addTextTexture=function(a,b){var c=a.key;this.elementsToAddOrUpdate.has(c)||this.elementsToAddOrUpdate.set(c,
{textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(c,b);this.elementsToRemove.delete(c);this.setDirty()};h.prototype.removeTextTexture=function(a,b){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,b)};Object.defineProperty(h.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isDirty",{get:function(){return this.dirty},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"updating",{get:function(){return this.dirty&&!!this.frameWorker},enumerable:!0,configurable:!0});h.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.notifyChange("updating"))};Object.defineProperty(h.prototype,"test",{get:function(){var a=this;return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:function(b,c){return a.resizeAtlas(b,c)},run:function(b){return a.run(b)}}},
enumerable:!0,configurable:!0});h.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(b,c){return a.push({element:b,key:c})});for(var b=!0,c=0;c<a.length-1;c++)if(0<a[c].key.localeCompare(a[c+1].key)){b=!1;break}if(!b){a.sort(function(a,b){return a.key.localeCompare(b.key)});this.elements.clear();for(b=0;b<a.length;b++)c=a[b],this.elements.set(c.key,c.element);this.repack();this.setDirty()}}};var y;h.test={orderedRepackingEnabled:!1};f([n.property({constructOnly:!0})],
h.prototype,"idHint",void 0);f([n.property({constructOnly:!0})],h.prototype,"view",void 0);f([n.property({type:Boolean,readOnly:!0})],h.prototype,"updating",null);return h=y=f([n.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],h)}(n.declared(h));b.TextTextureAtlas=q;var p=2,u=2,t={budget:null,repackingEnabled:!0};b.default=q})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});var x=d.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");q=function(b){function d(c){c=b.call(this,c)||this;c.tiles=new a;c.tileSize=512;c.idToTile=new Map;c.handles=new e;c.clients=new Set;c._dirty=!1;c._newTiles=new k;return c}l(d,b);Object.defineProperty(d.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))x.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this._setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=g.create();u.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),this._setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"updating",{get:function(){return this._dirty||!!this._pendingTiles},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a._reset()},!0));this.handles.add(n.init(this,["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"],function(){return a._setDirty()}));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(t.Task.FEATURE_TILE_TREE,
function(b){return a._update(b)},function(){return a.updating}))};d.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.addClient=function(){var a=this,b=v++;this.clients.add(b);1===this.clients.size&&this._setDirty();return{remove:function(){return a._removeClient(b)}}};d.prototype._removeClient=function(a){this.clients.delete(a);this._hasClients||this._clear()};Object.defineProperty(d.prototype,
"_hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});d.prototype._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(t.noBudget))};d.prototype._clear=function(){this.tiles.removeAll();this.idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};d.prototype._update=function(a){this._dirty=!1;this._pendingTiles||(this._startUpdate(),this._frameWorker&&
(this._frameWorker.task=t.Task.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(a);!this._pendingTiles&&this._frameWorker&&(this._frameWorker.task=t.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};d.prototype._startUpdate=function(){if(!this.suspended)if(this.tilingScheme){this._tileMeasurements||(this._tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:m}));var a=this.cameraOnSurface.location;
this._tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this._pendingTiles=this._getRootTiles()}else this._clear()};d.prototype._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};d.prototype._getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new r.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};d.prototype._purgeHorizonTiles=function(a){a.sort(function(a,b){a=
a.measures.screen.rect;b=b.measures.screen.rect;return a[1]+a[3]-(b[1]+b[3])});g.empty(y);for(var b=0;b<a.length;b++)if(g.expand(y,a.data[b].measures.screen.rect),g.height(y)>m)return a.data.slice(b,a.length);return[]};d.prototype._subdivideTilesForView=function(a){var b;if(this._pendingTiles){for(;0<this._pendingTiles.length&&!a.done;){var c=this._pendingTiles.pop();a.madeProgress();if(!this.filterExtentRect||g.intersects(this.filterExtentRect,c.extent))this._tileMeasurements.updateTile(c),0!==c.measures.visibility&&
(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),(b=this._pendingTiles).push.apply(b,c.getChildren())):this._newTiles.push(c))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};d.prototype._updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=
!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){return a.used?!1:(b.idToTile.delete(a.id),!0)});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};d.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};f([c.property({constructOnly:!0})],d.prototype,"scheduler",void 0);
f([c.property({constructOnly:!0})],d.prototype,"renderCoordsHelper",void 0);f([c.property({constructOnly:!0})],d.prototype,"tilingSchemeOwner",void 0);f([c.property({constructOnly:!0})],d.prototype,"cameraOnSurface",void 0);f([c.property({constructOnly:!0})],d.prototype,"focus",void 0);f([c.property({constructOnly:!0})],d.prototype,"viewState",void 0);f([c.property()],d.prototype,"tiles",void 0);f([c.property()],d.prototype,"tileSize",void 0);f([c.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],
d.prototype,"tilingScheme",null);f([c.property()],d.prototype,"filterExtent",null);f([c.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],d.prototype,"filterExtentRect",null);f([c.property({readOnly:!0,dependsOn:["filterExtentRect"]})],d.prototype,"rootTileIds",null);f([c.property({value:!1})],d.prototype,"suspended",null);f([c.property({readOnly:!0})],d.prototype,"updating",null);return d=f([c.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],d)}(c.declared(h));b.FeatureTileTree3D=
q;var v=0,y=g.create(),m=10;b.default=q})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e,d){void 0===d&&(d=null);this.lij=[0,0,0];this.extent=l.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:l.create()},distance:0,shouldSplit:!1};this.used=!1;d&&this.acquire(b,a,e,d)}b.prototype.acquire=
function(f,a,e,d){this.tilingScheme=d;this.id=b.id(f,a,e);this.lij[0]=f;this.lij[1]=a;this.lij[2]=e;d.getExtent(f,a,e,this.extent);this.resolution=d.resolutionAtLevel(f)};b.prototype.release=function(){this.tilingScheme=null};b.prototype.getChildren=function(f){var a=this.lij[0]+1,e=2*this.lij[1],d=2*this.lij[2];if(!f)return[new b(a,e,d,this.tilingScheme),new b(a,e+1,d,this.tilingScheme),new b(a,e,d+1,this.tilingScheme),new b(a,e+1,d+1,this.tilingScheme)];f[0].acquire(a,e,d,this.tilingScheme);f[1].acquire(a,
e+1,d,this.tilingScheme);f[2].acquire(a,e,d+1,this.tilingScheme);f[3].acquire(a,e+1,d+1,this.tilingScheme);return f};b.prototype.copyMeasurementsFrom=function(b){this.measures.visibility=b.measures.visibility;this.measures.shouldSplit=b.measures.shouldSplit;this.measures.distance=b.measures.distance;l.set(b.measures.screen.rect,this.measures.screen.rect)};b.id=function(b,a,e){return b+"/"+a+"/"+e};return b}();b.FeatureTileDescriptor3D=q;b.default=q})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils ../../webgl-engine/lib/Camera".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.camera=new k.default;this.pointOfInterestInMap=[0,0];this.screenRect=a.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new e.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}b.prototype.begin=function(b,c,d){this.camera.copyFrom(b);this.z=d;this.pointOfInterestInMap[0]=
c.x;this.pointOfInterestInMap[1]=c.y;a.fromValues(0,0,b.fullWidth,b.fullHeight,this.screenRect);this.visibility.begin(this.camera,d)};b.prototype.end=function(){this.visibility.end()};b.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};b.prototype.updateDistanceMeasure=function(b){b.measures.distance=a.distance(b.extent,this.pointOfInterestInMap)};b.prototype.updateScreenMeasure=
function(b){var c=g,d=1<<c,e=b.measures.screen.rect;a.empty(e);for(var f=0,k=b.lij[0]+c,h=b.lij[1]<<c,c=b.lij[2]<<c,m=this.tileSizeWithBias(b),m=m*m,p=!1,n=0;n<d;n++){for(var l=0;l<d&&!(p=this.computeScreenArea(b,k,h+n,c+l,e),f+=p.area,p=f>m&&a.height(e)>this.maxVerticalScreenSize);l++);if(p)break}b.measures.shouldSplit=f>m};b.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*r:this.tileSize};b.prototype.computeScreenArea=function(b,e,g,f,k){var h=p.points;this.projectToScreen(e,
g,f,1===b.measures.visibility,h);a.empty(n);for(b=0;4>b;b++)a.expandPointInPlace(n,h[b]);a.expand(k,n);a.intersection(n,this.screenRect,c);p.screenOverlap=a.area(c)/a.area(n);p.area=d.triangle.areaPoints2d(h[0],h[1],h[2])+d.triangle.areaPoints2d(h[0],h[2],h[3]);return p};b.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,u);this.toRenderCoords(u,0,3,x[0]);this.toRenderCoords(u,2,3,x[1]);this.toRenderCoords(u,2,1,x[2]);this.toRenderCoords(u,
0,1,x[3]);d&&(this.projectToPlane(x,this.camera.frustum.planes[4]),this.projectToPlane(x,this.camera.frustum.planes[3]),this.projectToPlane(x,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(x[a],y),this.camera.renderToScreen(y,e[a])};b.prototype.projectToPlane=function(a,b){for(var c=0;4>c;c++)v[c]=d.plane.signedDistance(b,a[c]);c=Math.max(v[0],v[1],v[2],v[3]);if(0<c)for(b=f.vec3.scale(t,b,-c),c=0;4>c;c++)f.vec3.add(a[c],a[c],b)};b.prototype.toRenderCoords=function(a,b,c,
d){t[0]=a[b];t[1]=a[c];t[2]=this.z;this.renderCoordsHelper.toRenderCoords(t,this.tilingScheme.spatialReference,d);return d};return b}();b.FeatureTileMeasurements3D=q;var n=a.create(),c=a.create(),g=2,r=5,p={points:[l.createScreenPointArray(),l.createScreenPointArray(),l.createScreenPointArray(),l.createScreenPointArray()],area:0,screenOverlap:0},u=a.create(),t=h.vec3f64.create(),x=[h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create(),h.vec3f64.create()],v=[0,0,0,0],y=l.createRenderScreenPointArray3();
b.default=q})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils".split(" "),function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a){this.surfaceElevation=0;this.cache=
new Map;a=a.renderCoordsHelper;this.frustum=new d.Frustum({renderCoordsHelper:a});this.extendedFrustum=new d.Frustum({renderCoordsHelper:a});this.intersector=new k.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};
a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=c&&a.lij[0]<g,d=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==d&&b?this.calculateAggregatedChildrenVisibility(a):d};a.prototype.shortenFrustumFarPlane=function(a){for(var b=a.mutablePoints,c=0,e=d.Frustum.nearFarLineIndices;c<e.length;c++){var g=e[c],f=g[1],g=b[g[0]];h.vec3.subtract(u,b[f],g);h.vec3.scale(u,u,p);h.vec3.add(b[f],g,u)}a.updatePoints(b)};a.prototype.calculateAggregatedChildrenVisibility=
function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=v.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}v.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&
a.lij[0]<r){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=
function(a,b){var c=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var d=this.renderCoordsHelper.worldUpAtPosition(a.eye,u);this.aboveGround||h.vec3.negate(d,d);d=l.acosClamped(-h.vec3.dot(d,a.viewForward));this.allTilesInvisible=d>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=d>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;for(d=0;4>d;d++){var e=a.pointIndices[d],g=b[e],f=c.getAltitude(g);
if(a.needsAltitudeAdjustment(f)){this.renderCoordsHelper.worldUpAtPosition(g,u);switch(e){case 4:case 7:case 0:case 3:n.plane.projectVector(this.extendedFrustum.planes[0],u,u);break;case 5:case 6:case 1:case 2:n.plane.projectVector(this.extendedFrustum.planes[1],u,u)}h.vec3.scale(u,u,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(n.ray.wrap(g,u),a.zWithMargin,g)}}this.extendedFrustum.updatePoints(b);n.plane.fromPoints(b[0],b[1],b[2],t);n.plane.fromPoints(b[1],b[2],b[3],x);0>h.vec3.dot(t,
x)&&(c=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[c[1],c[0]],c[0]=a[0],c[1]=a[1]):(a=[c[2],c[3]],c[3]=a[0],c[2]=a[1]),this.extendedFrustum.updatePoints(c))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,b){var c=a-b;return{zWithMargin:c,pointIndices:d.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:function(a){return a>
c}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,b){var c=a+b;return{zWithMargin:c,pointIndices:d.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<c}}};return a}();b.FeatureTileVisibility3D=q;var c=2,g=6,r=12,p=.95,u=a.vec3f64.create(),t=n.plane.create(),x=n.plane.create(),v=new f(Array,function(a){4!==a.length&&(a[0]=new e.FeatureTileDescriptor3D,a[1]=new e.FeatureTileDescriptor3D,a[2]=new e.FeatureTileDescriptor3D,a[3]=new e.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});b.default=q})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.frustum=a.create();this.lines=Array(12);this.origin=f.vec3f64.create();this.direction=f.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;12>b;b++)this.lines[b]={origin:null,direction:f.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});b.prototype.update=function(b){a.fromMatrix(b.viewMatrix,b.projectionMatrix,this.frustum);l.vec3.copy(this.origin,b.eye);l.vec3.copy(this.direction,b.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(b){for(var d=0;d<this.frustum.points.length;d++)l.vec3.copy(this.frustum.points[d],b[d]);a.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});b.prototype.intersectsSphere=function(b){return a.intersectsSphere(this.frustum.planes,b)};b.prototype.intersectsRay=function(b){return a.intersectsRay(this.frustum.planes,b)};b.prototype.intersectsLineSegment=function(b,e){return a.intersectsLineSegment(this.frustum.planes,b,e)};b.prototype.intersectsPoint=function(b){return a.intersectsPoint(this.frustum.planes,b)};b.prototype.updateLines=function(){for(var a=this.frustum.points,b=0;4>b;b++){var e=b,c=b+4;this.updateLine(this.lines[b],
a[e],a[c]);this.updateLine(this.lines[b+4],a[e],3===b?a[0]:a[e+1]);this.updateLine(this.lines[b+8],a[c],3===b?a[4]:a[c+1])}};b.prototype.updateLine=function(a,b,e){a.origin=b;a.endpoint=e;h.directionFromTo(a.direction,b,e)};b.planePointIndices=a.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();b.Frustum=q;b.default=q})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/mathUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){Object.defineProperty(b,"__esModule",{value:!0});q=.5*Math.PI;var t=q/Math.PI*180,x=q*c.earthRadius,v=.9*c.earthRadius;c=function(){function a(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:d.vec3f64.create(),direction:d.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:d.vec3f64.create(),direction:d.vec3f64.create(),cap:{next:null,direction:d.vec3f64.create()}},this.planes[a]=
g.plane.create();this.planes[4]=g.plane.create();this.planes[5]=g.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}a.prototype.update=function(a,b,c,d){void 0===d&&(d=!0);var f=this.extent;this.toRenderBoundingExtent(a,b,c);e.vec3.add(this.center.origin,f[0].origin,f[2].origin);e.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||e.vec3.scale(this.center.direction,this.center.direction,-1);for(c=0;4>
c;c++){var k=f[c];this.renderCoordsHelper.worldUpAtPosition(k.origin,k.direction);var h=f[3===c?0:c+1];k.cap.next=h.origin;p.directionFromTo(k.cap.direction,k.origin,h.origin);g.plane.fromVectorsAndPoint(k.direction,k.cap.direction,k.origin,this.planes[c]);d||e.vec3.scale(k.direction,k.direction,-1)}g.plane.fromVectorsAndPoint(f[0].cap.direction,f[1].cap.direction,f[0].origin,this.planes[4]);d?g.plane.negate(this.planes[4],this.planes[5]):(g.plane.copy(this.planes[4],this.planes[5]),g.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=b};a.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if(null==a)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?t:x))return!0;if(a.altitude>=v)return this.isVisibleInFrustumGlobal(a)}if(0===this.maxSpan){var c=this.extent[0];return!b&&a.intersectsRay(g.ray.wrap(c.origin,c.direction))?!0:!1}for(var d=0;d<this.extent.length;d++)if(c=
this.extent[d],!b&&a.intersectsRay(g.ray.wrap(c.origin,c.direction))||a.intersectsLineSegment(g.lineSegment.fromPoints(c.origin,c.cap.next,C),c.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(c=a.lines[d],r.frustumLineSegment(b,c.origin,c.endpoint,c.direction))return!0;return!1};a.prototype.toRenderBoundingExtentGlobal=function(a,b,c){n.center(a,m);m[2]=c;u.computeLinearTransformation(b,m,w,this.renderCoordsHelper.spatialReference);h.mat4.invert(A,w);
k.empty(B);for(var d=0,g=y;d<g.length;d++)for(var p=g[d],l=p.x0,r=p.x1,t=p.y0,p=p.y1,v=0;5>v;v++){var x=v/4;m[0]=f.lerp(a[l],a[r],x);m[1]=f.lerp(a[t],a[p],x);m[2]=c;u.vectorToVector(m,b,m,this.renderCoordsHelper.spatialReference);e.vec3.transformMat4(m,m,A);k.expandPointInPlace(B,m)}e.vec3.set(this.extent[0].origin,B[0],B[1],B[2]);e.vec3.set(this.extent[1].origin,B[3],B[1],B[2]);e.vec3.set(this.extent[2].origin,B[3],B[4],B[2]);e.vec3.set(this.extent[3].origin,B[0],B[4],B[2]);for(v=0;4>v;++v)e.vec3.transformMat4(this.extent[v].origin,
this.extent[v].origin,w)};a.prototype.toRenderBoundingExtentLocal=function(a,b){e.vec3.set(this.extent[0].origin,a[0],a[1],b);e.vec3.set(this.extent[1].origin,a[2],a[1],b);e.vec3.set(this.extent[2].origin,a[2],a[3],b);e.vec3.set(this.extent[3].origin,a[0],a[3],b)};a.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,c);break;default:l.neverReached(this.renderCoordsHelper.type)}};
a.prototype.isVisibleInFrustumGlobal=function(a){if(0>e.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>e.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return a}();b.FrustumExtentIntersection=c;var y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],m=d.vec3f64.create(),w=a.mat4f64.create(),A=a.mat4f64.create(),B=k.create(),C=g.lineSegment.create();b.default=c})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory}})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c){c=b.call(this,c)||this;c.propertiesPool=new u.default({camera:t.default},c);c.lastSeenCameraProjectionValues=new t.default;c.events=new a;c.updateQueue=[];c.processingUpdates=!1;return c}l(h,b);h.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};h.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new c.default({mode:a.viewingMode})}};Object.defineProperty(h.prototype,"animation",{get:function(){return this.cameraController instanceof g.AnimationController&&e.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==x&&x.copyFrom(a);x.markViewDirty();x.computeUp(this.mode);
v.camera=x;this.events.emit("before-camera-change",v);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,x)&&(this.lastSeenCameraProjectionValues.copyFrom(x),y.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",y));a&&a.equals(x)||this._set("camera",this.propertiesPool.get("camera").copyFrom(x))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"navigating",{get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===r.State.Finished||
c===r.State.Stopped)b._set("cameraController",null),b.updateCamera(function(b){return a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=r.State.Rejected)},enumerable:!0,configurable:!0});h.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==r.State.Rejected};h.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};h.prototype.cameraChanged=
function(){this.updateCamera(function(){})};h.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};h.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();x.copyFrom(this._get("camera"));a(x);this.camera=x;this.processingUpdates=!1;this.processUpdateQueue()}};h.prototype.createInitialCamera=function(a){return"global"===a?new t.default(k.vec3f64.fromValues(4*p.earthRadius,
0,0),k.vec3f64.fromValues(p.earthRadius,0,0),k.vec3f64.fromValues(0,0,1)):new t.default(k.vec3f64.fromValues(0,0,100),k.vec3f64.fromValues(0,0,0),k.vec3f64.fromValues(0,1,0))};h.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==
b.padding[3]?!0:!1};f([d.property({readOnly:!0,type:n,dependsOn:["cameraController"]})],h.prototype,"animation",null);f([d.property({type:t.default})],h.prototype,"camera",null);f([d.property({constructOnly:!0})],h.prototype,"constraints",void 0);f([d.property({readOnly:!0})],h.prototype,"events",void 0);f([d.property({readOnly:!0,dependsOn:["isLocal"]})],h.prototype,"isGlobal",null);f([d.property({readOnly:!0,dependsOn:["mode"]})],h.prototype,"isLocal",null);f([d.property({constructOnly:!0})],h.prototype,
"mode",void 0);f([d.property({constructOnly:!0})],h.prototype,"spatialReference",void 0);f([d.property({readOnly:!0,dependsOn:["cameraController"]})],h.prototype,"navigating",null);f([d.property()],h.prototype,"cameraController",null);return h=f([d.subclass("esri.views.3d.state.ViewState")],h)}(d.declared(h));b.ViewState=q;var x=new t.default,v={camera:null},y={camera:null};b.default=q})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool",
"../../../core/accessorSupport/watch"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b){var d=this;this.owner=b;this.properties={};this.afterDispatchHandle=null;for(var e in a)b=new l.ReentrantObjectPool(a[e],null,null,2,2),this.properties[e]={pool:b,acquired:[]};this.afterDispatchHandle=f.afterDispatch(function(){return d.release()})}b.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=
null);for(var a in this.properties){for(var b=this.properties[a],d=0,k=b.acquired;d<k.length;d++){var h=k[d];f.isValueInUse(h)||b.pool.release(h)}b.pool.destroy();b.pool=null;b.acquired=null}this.owner=this.properties=null};b.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var d=a.pool.acquire();for(a.acquired.push(d);d===b;)a.acquired.push(d),d=a.pool.acquire();return d};b.prototype.release=function(){for(var a in this.properties){for(var b=this.properties[a],d=0,k=0,h=b.acquired;k<
h.length;k++){var c=h[k];f.isValueInUse(c)?b.acquired[d++]=c:b.pool.release(c)}b.acquired.length=d}};return b}();b.PropertiesPool=q;b.default=q})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O){Object.defineProperty(b,"__esModule",{value:!0});var Q=r.getLogger("esri.views.3d.state.ViewStateManager");q=function(b){function n(a){a=b.call(this,a)||this;a.propertiesPool=new P.default({frustum:I.default},a);a.handles=new g;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToController=null;a.animatedGoToController=null;a.ready=!1;a.updateDevicePixelRatio=null;return a}f(n,b);Object.defineProperty(n.prototype,
"camera",{get:function(){if(!this.ready)return this._get("camera");var a=L.internalToExternal(this.view,this.view.state.camera),b=this._get("camera");return a&&b&&a.equals(b)?b:a},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(L.externalToInternal(this.view,a),{applyConstraints:!1})||Q.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:
this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():Q.error("#center\x3d","Invalid center",a):Q.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):Q.error("#center\x3d","Center may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"extent",{get:function(){return this.ready?L.toExtent(this.view,this.view.state.camera,this.view.pointsOfInterest.centerOnContent.renderLocation):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||Q.error("#extent\x3d","Invalid extent",a):Q.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+
(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):Q.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;return L.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||Q.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");
var a=this.view.state.camera,b=a.padding,c=a.pixelRatio,a=this._get("padding"),d=Math.round(b[0]/c),e=Math.round(b[1]/c),g=Math.round(b[2]/c),b=Math.round(b[3]/c);return null!=a&&a.top===d&&a.right===e&&a.bottom===g&&a.left===b?a:{top:d,right:e,bottom:g,left:b}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,aa),this.view.state.updateCamera(function(a){return a.padding=aa}))},enumerable:!0,configurable:!0});n.prototype.paddingToArray=
function(a,b,c){a?m.vec4.set(c,a.top||0,a.right||0,a.bottom||0,a.left||0):m.vec4.set(c,0,0,0,0);for(a=0;4>a;a++)c[a]=Math.round(c[a]*b)};Object.defineProperty(n.prototype,"screenCenter",{get:function(){var a=this.padding;return x.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"viewpoint",{get:function(){return this.ready?S.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||Q.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;Q.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else Q.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},
enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"zoom",{get:function(){return this.ready?L.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||Q.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});n.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),v.on(this.view,
"state.events","before-camera-change",function(b){return a.updateElevation(b.camera)})]);v.once(this.view,"state.camera",function(b){return a.updateElevation(b)},!0);this.handles.add(t.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(V);a.cancelImmediateGoTo()}));this.handles.add(v.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};
n.prototype.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};n.prototype.init=function(){var a=this;this.constraintsManager=new J.default({view:this.view});this.prepareFrame();var b=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||
this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(v.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(V);a.setInitialView(a.view.groundExtent)}),V))};n.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(V),
this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};n.prototype.goTo=function(b,c){return e(this,void 0,void 0,function(){var d;return a(this,function(a){d=l({animate:!0},c);return d.animate?[2,this.goToAnimated(b,d)]:[2,this.goToImmediate(b,d)]})})};n.prototype.debugSetCameraOnContent=function(){this.setStateCamera(G.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};n.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;
c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};n.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToController;p.isSome(a)&&(this.immediateGoToController=null,a.abort())};n.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToController;p.isSome(a)&&(this.animatedGoToController=null,a.abort())};n.prototype.getInitialProperties=function(){for(var a=new Set,b=[],c=0,d=Y;c<d.length;c++){var e=d[c],g=e.propertyName,e=e.overrides,
f=a.has(g),k=this._isOverridden(g);!f&&k&&b.push({name:g,value:this._get(g)});this._clearOverride(g);(f||k)&&e.forEach(function(b){return a.add(b)})}return b};n.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof d)this.setStateCamera(L.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof k)if(a.targetGeometry instanceof A){var b=L.fromExtent(this.view,a.targetGeometry,0,.5,L.OrientationMode.LOCKED);this.setStateCamera(L.externalToInternal(this.view,
b),{applyConstraints:!0})}else b={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,b);else b=L.fromExtent(this.view,a,0,.5,L.OrientationMode.LOCKED),this.setStateCamera(L.externalToInternal(this.view,b),{applyConstraints:!0})};n.prototype.updatePropertyBeforeReady=function(a,b){if(!this.ready){this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==T.indexOf(a)&&
this._override("hasInitialView",!0));return!0}return!1};n.prototype.isCompatible=function(a){return a?a instanceof k?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof d?this.isCompatible(a.position):a.spatialReference&&C.canProject(a.spatialReference,this.view.spatialReference):!1};n.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=N);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};n.prototype.centerPointAtDistanceToCamera=
function(a,b,c){void 0===c&&(c=W);var d=this.getPreservingHeadingTilt();return(a=L.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,L.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};n.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;b.update();return this.centerPointAtDistanceToCamera(a,b.distance)};n.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=L.fromExtent(this.view,
a,b.heading,b.tilt,L.OrientationMode.ADJUST,Z);return L.externalToInternal(this.view,a)};n.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.update();var c=b.renderLocation;a=L.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,a)};n.prototype.zoomToCamera=function(a){return this.scaleToCamera(L.zoomToScale(this.view,a))};n.prototype.viewpointToCamera=function(a){return(a=S.toCamera(this.view,a))?
L.externalToInternal(this.view,a):null};n.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){b.positionAndOrientationOnly?(d.eye=a.eye,d.center=a.center,d.up=a.up):d.copyFrom(a);b.applyConstraints&&E.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));
return!0};n.prototype.prepareFrame=function(){var a=this.view,b=a.container,c=a.canvas;if(b&&c){p.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,d=Math.round(b.clientWidth*a),b=Math.round(b.clientHeight*a);0!==d&&0!==b&&(c.width=d,c.height=b,this.view.state&&(c=this.view.state.camera,c.fullWidth!==d||c.fullHeight!==b||c.pixelRatio!==a))&&(W.copyFrom(c),W.pixelRatio!==a&&(this.paddingToArray(this.padding,a,aa),W.padding=aa),W.fullWidth=d,W.fullHeight=
b,W.pixelRatio=a,this.view.state.camera=W)}};n.prototype.updateElevation=function(a){var b=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b?G.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};n.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};n.prototype.createGoToCamera=function(b,g){return e(this,void 0,void 0,function(){var e,f,h,m,p,n,l,r;return a(this,function(a){switch(a.label){case 0:return[4,
v.whenOnce(this,"ready",g.signal,!0)];case 1:return a.sent(),u.throwIfAborted(g),[4,S.create(this.view,b,g.signal)];case 2:e=a.sent();f=!!(b instanceof k&&b.camera||b instanceof d);h=e.camera;if(!this.isCompatible(h))throw n=(p=(m=h.position)&&m.spatialReference)?p.wkid:"none",l=this.view.spatialReference.wkid,new c("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+n+", view: "+l+")",{camera:h});r=L.externalToInternal(this.view,h);if(!r)throw new c("goto:invalid-camera",
"Resulting camera is invalid");return[2,{viewpoint:e,camera:r,isFullySpecified:f}]}})})};n.prototype.cancellableGoTo=function(a,b){var c=this,d,e=function(){c.view.state.cameraController===a&&a.active&&a.asyncResult===d&&a.stopController()};return u.create(function(c,g){d={resolve:c,reject:g};a.asyncResult=d;u.onAbort(b,e)},e)};n.prototype.goToImmediate=function(b,d){return e(this,void 0,void 0,function(){var e,g,f,k=this;return a(this,function(a){this.cancelAnimatedGoTo();this.cancelImmediateGoTo();
e=u.createAbortController();u.onAbort(d,function(){return e.abort()});g=this.createGoToCamera(b,l({},d,{signal:e.signal}));f=function(){k.immediateGoToController===e&&(k.immediateGoToController=null)};this.immediateGoToController=e;return[2,g.then(function(a){f();k.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified,positionAndOrientationOnly:!0})}).catch(function(a){f();!u.isAbortError(a)&&a instanceof c&&a.message&&Q.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+
a.message.slice(1));throw a;})]})})};n.prototype.goToAnimatedBeforeReady=function(b,c){return e(this,void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return this.cancelAnimatedGoTo(),d=u.createAbortController(),u.onAbort(c,function(){return d.abort()}),this.animatedGoToController=d,c=l({},c,{signal:d.signal}),[4,v.whenOnce(this.view,"ready",d.signal)];case 1:return a.sent(),this.animatedGoToController=null,[2,this.goToAnimated(b,c)]}})})};n.prototype.goToAnimated=function(b,
d){return e(this,void 0,void 0,function(){var g,f,k,h,m,n,l=this;return a(this,function(r){this.cancelAnimatedGoTo();if(!this.ready)return[2,this.goToAnimatedBeforeReady(b,d)];g=this.view.state.cameraController;g instanceof K.PointToPointAnimationController&&(g.updateStateFromViewAnimation(),g.active&&(f=g));null==f&&(f=new K.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper,"animation"));k=f.viewAnimation;if(p.isNone(k))return Q.warn("Unreachable code in ViewStateManager"),
[2];h=this.createGoToCamera(b,d);k.update(h.then(function(a){return a.viewpoint}));if(f!==g&&!this.view.state.switchCameraController(f))return k.stop(),Q.error("#goTo()","Cannot start an animation while interacting"),[2,u.reject(new c("view:goto-cannot-interrupt","Cannot start an animation while interacting"))];m=k.target;n=function(){return l.view.state.cameraController===f&&p.isSome(f.viewAnimation)&&f.viewAnimation.target===m&&f.active};h.then(function(b){var c=b.viewpoint,g=b.camera,h=b.isFullySpecified;
return e(l,void 0,void 0,function(){var b,e,l=this;return a(this,function(a){switch(a.label){case 0:if(!n())return[2];p.isSome(f.viewAnimation)&&(f.viewAnimation.update(c),m=f.viewAnimation.target);h?(b=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:g}),E.applySurfaceCollisionConstraint(this.view,g,1)):E.applyAll(this.view,g);f.begin(g,this.internalAnimateOptions(d));e=function(){var a=l.view.state.cameraController;b&&(a&&a.active?a instanceof K.PointToPointAnimationController&&
p.isSome(a.viewAnimation)&&a.viewAnimation.target===m&&(l.view.state.cameraController=b):p.isSome(f.viewAnimation)&&f.viewAnimation.target===m&&"finished"===f.state&&(l.view.state.cameraController=b))};return[4,k.when(e,e)];case 1:return a.sent(),[2]}})})}).catch(function(a){!u.isAbortError(a)&&a instanceof c&&a.message&&Q.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(n())throw l.view.state.cameraController.stopController(),a;});return[2,
this.cancellableGoTo(f,d)]})})};n.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?O.named[a.easing]:a.easing));return b};h([y.property({type:d,dependsOn:["view.state.camera","ready"]})],n.prototype,"camera",null);h([y.property({type:B,dependsOn:["view.pointsOfInterest.centerOnContent.location",
"ready"]})],n.prototype,"center",null);h([y.property({type:A,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],n.prototype,"extent",null);h([y.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],n.prototype,"frustum",null);h([y.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],n.prototype,"hasInitialView",null);h([y.property({readOnly:!0,type:Boolean})],n.prototype,"ready",void 0);h([y.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance",
"ready"],type:Number})],n.prototype,"scale",null);h([y.property({dependsOn:["view.state.camera","ready"]})],n.prototype,"padding",null);h([y.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],n.prototype,"screenCenter",null);h([y.property({constructOnly:!0})],n.prototype,"view",void 0);h([y.property({type:k,dependsOn:["camera","ready"]})],n.prototype,"viewpoint",null);h([y.property({type:Number,dependsOn:["scale"]})],n.prototype,"zoom",null);h([y.property({constructOnly:!0})],
n.prototype,"updateDevicePixelRatio",void 0);return n=h([y.subclass("esri.views.3d.state.ViewStateManager")],n)}(y.declared(n));b.ViewStateManager=q;var T="camera viewpoint extent scale center zoom".split(" "),Y=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],
N={heading:0,tilt:0},Z=new d,W=new R.default,aa=w.vec4f64.create(),V="pending-initial-view";b.default=q})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c){var d=b.call(this,c)||this;d.handles=new a;d.nearFarHeuristic=g.createNearFarHeuristic(c.view.state.mode,c.view.basemapTerrain,c.view.renderCoordsHelper.spatialReference);return d}l(h,b);h.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),
this.view.watch("constraints.clipDistance.mode",function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},
!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(d.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();
this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new r.default({view:this.view}))};h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};h.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};h.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};h.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};h.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};h.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,c.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};h.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};h.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto())};h.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};h.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};h.prototype.handleTiltModeChanged=function(){this.updateTilt()};h.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};h.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto();this.reapplyConstraints()};h.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(e.deg2rad(a.max))};h.prototype.updateTiltAuto=function(){var a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};h.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(e.rad2deg(b)))}};h.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};h.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return n.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};f([k.property({constructOnly:!0})],h.prototype,"view",void 0);f([k.property({readOnly:!0})],h.prototype,"surfaceCollisionConstraint",void 0);return h=f([k.subclass("esri.views.3d.state.ConstraintsManager")],
h)}(k.declared(h));b.ConstraintsManager=q;b.default=q})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/mathUtils ../../../core/mathUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils".split(" "),function(q,b,l,f,h,a,e,d){function k(a,b,c,d){c=r/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(b,"__esModule",{value:!0});b.createNearFarHeuristic=
function(a,b,d){return"global"===a?new c:new n(b,d)};var n=function(){function b(a,b){this.elevationProvider=a;this.unitInMeters=h.getMetersPerUnitForSR(b)}b.prototype.compute=function(b,c,e,h,n){n||(n={near:0,far:0});var m=d.earthRadius,r=b[2]*this.unitInMeters,w=r;h=r-h;var v=this.elevationProvider?this.elevationProvider.elevationBounds:null;v&&(r=0<=h?w-this.unitInMeters*v.min:this.unitInMeters*v.max-w);w=Math.max(e.xmax-e.xmin,e.ymax-e.ymin,4*Math.max(e.xmax-e.xmin,e.ymax-e.ymin));a.vec3.subtract(x,
c,b);t[0]=0<x[0]?e.xmax:e.xmin;t[1]=0<x[1]?e.ymax:e.ymin;t[2]=0<x[2]?w/2:-w/2;a.vec3.subtract(t,t,b);a.vec3.normalize(x,x);b=1.1*a.vec3.dot(t,x)*this.unitInMeters;m=Math.sqrt(r*(r+2*m));e=Math.max(e.xmax-e.xmin,e.ymax-e.ymin);c=e*u*this.unitInMeters;r=l.clamp((r-c)/(e*p*this.unitInMeters-c),0,1);r=f.lerp(m,b,r*r*r);r*=Math.max(Math.log(Math.abs(h)),1);r=Math.min(r,Math.max(34064E4,w));r/=this.unitInMeters;return k(r,g,this.unitInMeters,n)};return b}(),c=function(){function b(){}b.prototype.compute=
function(b,c,e,g,f){f||(f={near:0,far:0});c=d.earthRadius;b=a.vec3.length(b)-c;b=Math.max(Math.abs(b-g),Math.abs(b));g=Math.sqrt(b*(b+2*(c+Math.min(0,g))));b=l.clamp(2E4-(Math.log(b)-7.983)/9.011*19E3,1E3,2E4);return k(1.2*g,b,1,f)};return b}(),g=2E4,r=2,p=.001,u=1E-4,t=e.vec3f64.create(),x=e.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(c){c=b.call(this,c)||this;c.handles=new a;return c}l(c,b);c.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};c.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};c.prototype.handleElevationChangeEvent=function(a){this.view.state.cameraController||k.eyeWithinExtent(this.view,
this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};c.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){d.applySurfaceCollisionConstraint(a.view,b,1)})};f([e.property({constructOnly:!0})],c.prototype,"view",void 0);return c=f([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],c)}(e.declared(h));b.SurfaceCollisionConstraint=q;b.default=q})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(a){a=b.call(this,a)||this;a.handles=new h;return a}l(c,b);Object.defineProperty(c.prototype,"desiredCamera",{set:function(a){this._set("desiredCamera",a.clone())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},
enumerable:!0,configurable:!0});c.prototype.onControllerStart=function(){var a=this;this.state=k.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}));this.applyCorrection()};c.prototype.onControllerEnd=function(){this.handles.removeAll()};c.prototype.stepController=function(){};c.prototype.handleElevationChangeEvent=function(a){d.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};
c.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);e.applySurfaceCollisionConstraint(a.view,b,1)||a.constraintEnabled||(a.state=k.State.Stopped)})};f([a.property({constructOnly:!0})],c.prototype,"view",void 0);f([a.property({constructOnly:!0})],c.prototype,"desiredCamera",null);return c=f([a.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],c)}(a.declared(k.CameraController));b.SurfaceCollisionCorrectionController=
q})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/compilerUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J){function I(a){return 360-G.cyclicalDeg.normalize(a)}function K(a){return G.cyclicalDeg.normalize(360-a)}function H(a,b){a&&a.resolver&&(null==b?a.resolver.reject():a.resolver.resolve(b));return b}function L(b,c,d,e){if(!c)return H(e);var g=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!w.canProject(b,g))return H(e);c=c.camera.clone();b.equals(g)||(c.position=w.project(c.position,
g));return H(e,c)}var f=c.get("targetGeometry.spatialReference");if(f&&!w.canProject(f,g))return H(e);g=B.internalToExternal(b,b.state.camera);f=B.OrientationMode.ADJUST;null!=c.rotation&&(g.heading=I(c.rotation),f=B.OrientationMode.LOCKED);null!=d&&(g.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var k=void 0,h=c.targetGeometry.clone(),k=null!=c.scale?B.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;return B.fromCenterDistance(b,h,k,g,f,e)}return B.fromExtent(b,c.targetGeometry.extent,
g.heading,g.tilt,f,e)}function P(a,b){return null==b.scale&&null!=b.zoom?B.zoomToScale(a,b.zoom):b.scale}function S(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=I(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function R(b,c,d){var e=b.spatialReference||a.SpatialReference.WGS84;c=c||B.externalToInternal(b,d.camera);d.targetGeometry=J.vectorToPoint(c.center,b.renderSpatialReference,e);d.scale=B.computeScale(b,c);d.rotation=
K(d.camera.heading);return d}function O(a,b,d){if(b){if(!w.canProject(b.spatialReference,a.spatialReference))throw new c("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var e=[];if(!b.hasZ&&a.basemapTerrain){var g=void 0;switch(b.type){case "point":g=b;break;case "multipoint":case "polyline":case "mesh":g=b.extent.center;break;case "extent":g=b.center;
break;case "polygon":g=b.centroid;break;default:n.neverReached(b)}g&&w.canProject(g,a.basemapTerrain.spatialReference)?ca[2]=C.getElevationAtPoint(a.basemapTerrain,g)||0:ca[2]=0}(0,ta[b.type])(b,function(a){e.push(a[0],a[1],a[2])},ca);var f=e.length/3;if(0!==f&&(g=Array(e.length),J.bufferToBuffer(e,b.spatialReference,0,g,a.spatialReference,0,f)))for(b.hasZ&&(d.hasZ=!0),a=0;a<g.length;a+=3)b.hasZ?(ca[0]=g[a+0],ca[1]=g[a+1],ca[2]=g[a+2]):(ca[0]=g[a+0],ca[1]=g[a+1]),y.expand(d.boundingBox,ca)}}function Q(a,
b,c,d){return f(this,void 0,void 0,function(){var e,f,h,m,p,n;return l(this,function(l){switch(l.label){case 0:return[4,k.result(a.whenViewForGraphic(b))];case 1:e=l.sent();if(!1===e.ok||g.isNone(e.value)||!("whenGraphicBounds"in e.value))return O(a,b.geometry,d),[2];f=e.value;return[4,k.result(f.whenGraphicBounds(b,{minDemResolution:c}))];case 2:h=l.sent();if(!1===h.ok)return O(a,b.geometry,d),[2];m=h.value;p=m.screenSpaceObjects;n=m.boundingBox;y.expand(d.boundingBox,n);p&&p.forEach(function(a){d.screenSpaceObjects.push(a)});
isFinite(n[2])&&(d.hasZ=!0);return[2]}})})}function T(b,c,d,g){return f(this,void 0,void 0,function(){var f,k;return l(this,function(h){switch(h.label){case 0:return Array.isArray(c)&&2===c.length&&(f=c[0],k=c[1],"number"===typeof f&&"number"===typeof k)?(ma.x=f,ma.y=k,ma.z=void 0,ma.spatialReference=b.spatialReference.isGeographic?b.spatialReference:a.SpatialReference.WGS84,O(b,ma,g),[2]):c&&"function"===typeof c.map?[4,r.eachAlways(c.map(function(a){return T(b,a,d,g)}))]:[3,2];case 1:return h.sent(),
[2];case 2:if(!(c instanceof a.BaseGeometry))return[3,3];O(b,c,g);return[3,5];case 3:return c instanceof e?[4,Q(b,c,d,g)]:[3,5];case 4:h.sent(),h.label=5;case 5:return[2]}})})}function Y(a,b,c,d,e){return f(this,void 0,void 0,function(){var g,f,k;return l(this,function(h){switch(h.label){case 0:if(b.camera)return[2,N(a,b.camera,e)];e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=K(c.heading):null!=c.rotation&&
(e.rotation=c.rotation);g=P(a,c);null!=g&&(e.scale=g);f=B.createAsyncContext(d);L(a,e,c.tilt,f);k=e;return[4,f.resolver.promise];case 1:return k.camera=h.sent(),[2,e]}})})}function N(a,b,c){c.camera=b.clone();c.camera.fov=a.camera.fov;b=a.spatialReference;var d=c.camera.position.spatialReference;if(!w.canProject(d,b))return null;d.equals(b)||(c.camera.position=w.project(c.camera.position,b));return R(a,null,c)}function Z(b,d,e,g,k){return f(this,void 0,void 0,function(){var f,h,m,p,n,r;return l(this,
function(l){switch(l.label){case 0:if(!e)throw new c("createfromcenter","invalid point");k.targetGeometry=e.clone();f=A.cameraOnContentAlongViewDirection(b);if(d.position){l=k.targetGeometry;var w=f,t=b.renderSpatialReference;J.pointToVector(d.position,qa,t);J.pointToVector(l,ja,t);k.targetGeometry=new a.Point(l);k.camera.position=new a.Point(d.position);x.vec3.subtract(ba,ja,qa);B.directionToHeadingTilt(b,qa,ba,w.up,k.camera);k.scale=B.distanceToScale(b,x.vec3.distance(qa,ja),k.targetGeometry.latitude);
k.rotation=K(k.camera.heading);return[2,k]}d.zoomFactor&&(h=f.distance/d.zoomFactor,m=x.vec3.scale(ca,f.viewForward,-h),x.vec3.add(f.eye,f.center,m),f.markViewDirty(),k.scale=B.distanceToScale(b,h,e.latitude));B.internalToExternal(b,f,k.camera);p=S(k.camera,d)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;if(d.zoomFactor)return[3,2];k.scale=P(b,d);null==k.scale&&(J.pointToVector(e,ca,b.renderSpatialReference),E.frustum.intersectsPoint(f.frustum.planes,ca)?k.scale=B.distanceToScale(b,x.vec3.distance(f.eye,
ca),e.latitude):k.scale=B.computeScale(b,f));n=B.createAsyncContext(g);B.fromCenterScale(b,k.targetGeometry,k.scale,k.camera,p,n);r=k;return[4,n.resolver.promise];case 1:r.camera=l.sent(),l.label=2;case 2:return[2,k]}})})}function W(a,b,c,d){return f(this,void 0,void 0,function(){var e,g;return l(this,function(f){e=A.cameraOnContentAlongViewDirection(a);g=J.vectorToPoint(e.center,a.renderSpatialReference,ma,a.spatialReference);return[2,Z(a,b,g,c,d)]})})}function aa(a,b,c,d,e){return f(this,void 0,
void 0,function(){var g,f,k,h;return l(this,function(m){switch(m.label){case 0:return e.targetGeometry=c.clone(),g=A.cameraOnContentAlongViewDirection(a),B.internalToExternal(a,g,e.camera),f=S(e.camera,b)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST,k=B.createAsyncContext(d),B.fromExtent(a,c,e.camera.heading,e.camera.tilt,f,k),h=e,[4,k.resolver.promise];case 1:return h.camera=m.sent(),[2,e]}})})}function V(a,b,c,d,e,g,k){return f(this,void 0,void 0,function(){var f,h,m,n,r;return l(this,function(l){switch(l.label){case 0:k.targetGeometry=
c.clone();l=f=A.cameraOnContentAlongViewDirection(a);var w=0;c.hasZ?w=c.z:a.basemapTerrain&&(w=C.getElevationAtPoint(a.basemapTerrain,c));x.vec3.set(ca,c.x,c.y,w);J.computeLinearTransformation(a.spatialReference,ca,U,a.renderSpatialReference);p.mat3.fromMat4(ea,U);p.mat3.transpose(ea,ea);y.empty(ha);for(var t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],v=0;v<t.length;v++){var u=t[v],q=d[u[2]];isFinite(q)||(q=w);x.vec3.set(ca,d[u[0]],d[u[1]],q);J.vectorToVector(ca,a.spatialReference,
ca,a.renderSpatialReference);y.expand(ha,x.vec3.transformMat3(ca,ca,ea))}w=y.width(ha);t=y.height(ha);v=y.depth(ha);u=1/Math.tan(l.fovY/2);h=Math.max(.5*Math.sqrt(w*w+v*v)*Math.max(u,1/Math.tan(l.fovX/2))+.5*t,.5*t*u+.5*Math.max(w,v))/e;B.internalToExternal(a,f,k.camera);m=S(k.camera,b)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;k.scale=B.distanceToScale(a,h,k.targetGeometry.latitude);n=B.createAsyncContext(g);B.fromCenterScale(a,k.targetGeometry,k.scale,k.camera,m,n);r=k;return[4,n.resolver.promise];
case 1:return r.camera=l.sent(),[2,k]}})})}function F(a){a&&(a.rotation=K(a.camera.heading));return a}Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_FRAME_COVERAGE=.66;b.rotationToHeading=I;b.headingToRotation=K;b.toCamera=L;b.fromInternalCamera=function(a,b,c){c||(c=new d({camera:new h}));B.internalToExternal(a,b,c.camera);return R(a,b,c)};b.fromCamera=function(a,b,c){c||(c=new d);c.camera=b.clone();return R(a,null,c)};b.create=function(e,g,k){return f(this,void 0,void 0,function(){var f,
p,n,r,w,t,v,u,q,C,H,E,O;return l(this,function(l){switch(l.label){case 0:if(g&&e.spatialReference){l={target:null};if("declaredClass"in g||Array.isArray(g))l.target=g;else{for(var G in g)l[G]=g[G];g.center&&!l.target&&(l.target=g.center)}f=l}else f=null;if(!f)throw new c("viewpointutils-create:no-target","Missing target for creating viewpoint");p=new d({camera:new h({fov:e.camera.fov})});return f.target instanceof d?[4,Y(e,f.target,f,k,p)]:[3,2];case 1:return n=l.sent(),[2,F(n)];case 2:if(f.target instanceof
h)return[2,F(N(e,f.target,p))];r=null!=f.scale||null!=f.zoom;if(!(f.target instanceof a.Extent))return[3,6];w=f.target.xmin===f.target.xmax||f.target.ymin===f.target.ymax;if(!r&&!w)return[3,4];t=F;return[4,Z(e,f,f.target.center,k,p)];case 3:return[2,t.apply(void 0,[l.sent()])];case 4:return v=F,[4,aa(e,f,f.target,k,p)];case 5:return[2,v.apply(void 0,[l.sent()])];case 6:return u={boundingBox:y.empty(),hasZ:!1,screenSpaceObjects:[]},q=r?B.scaleToResolution(e,P(e,f)):void 0,[4,T(e,f.target,q,u)];case 7:l.sent();
if(!isFinite(u.boundingBox[0]))return[3,11];y.center(u.boundingBox,ca);ma.x=ca[0];ma.y=ca[1];ma.z=ca[2];ma.spatialReference=e.spatialReference;w=void 0;isFinite(ma.z)&&u.hasZ?w=y.isPoint(u.boundingBox):(ma.z=void 0,w=m.isPoint(y.toRect(u.boundingBox,ka)));if(!r&&!w)return[3,9];C=F;return[4,Z(e,f,ma,k,p)];case 8:return[2,C.apply(void 0,[l.sent()])];case 9:G=u.screenSpaceObjects;l=b.DEFAULT_FRAME_COVERAGE;if(G.length){for(var z=Number.NEGATIVE_INFINITY,K=0;K<G.length;K++)var I=G[K].screenSpaceBoundingRect,
z=Math.max(z,Math.abs(I[0]),Math.abs(I[1]),Math.abs(I[2]),Math.abs(I[3]));H=l-z/Math.min(e.width,e.height)*2}else H=l;E=F;return[4,V(e,f,ma,u.boundingBox,H,k,p)];case 10:return[2,E.apply(void 0,[l.sent()])];case 11:if(f.position)return G=f,l=p,z=A.cameraOnContentAlongViewDirection(e),x.vec3.copy(ba,z.viewForward),B.directionToHeadingTilt(e,z.eye,ba,z.up,la),l.camera.position=new a.Point(G.position),l.camera.heading=null!=G.heading?G.heading:la.heading,l.camera.tilt=null!=G.tilt?G.tilt:la.tilt,G=R(e,
null,l),[2,F(G)];O=F;return[4,W(e,f,k,p)];case 12:return[2,O.apply(void 0,[l.sent()])]}})})};var ca=v.vec3f64.create(),U=t.mat4f64.create(),ea=u.mat3f64.create(),ha=y.create(),ka=m.create(),ba=v.vec3f64.create(),qa=v.vec3f64.create(),ja=v.vec3f64.create(),la={heading:0,tilt:0},ma=new a.Point,ta={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var g=a.rings[e],f=0;f<g.length;f++)c[0]=g[f][0],c[1]=g[f][1],d&&(c[2]=
g[f][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var g=a.paths[e],f=0;f<g.length;f++)c[0]=g[f][0],c[1]=g[f][1],d&&(c[2]=g[f][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(x.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(x.vec3.set(c,a.xmax,a.ymin,a.zmin)),b(x.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(x.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(x.vec3.set(c,a.xmin,
a.ymin,a.zmax)),b(x.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(x.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(x.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(x.vec3.set(c,a.xmin,a.ymin,c[2])),b(x.vec3.set(c,a.xmax,a.ymin,c[2])),b(x.vec3.set(c,a.xmin,a.ymax,c[2])),b(x.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(x.vec3.set(c,a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n){function c(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];b&&!b(e)||c.push(e)}return c}function g(a){r||(r=new k(a));r.viewingMode=a;return r}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a,b,c){this.viewingMode=a;this.layerProvider=b;this.view=c;this.tmpRay=e.ray.create();this.externalIntersectionHandlers=new Set;this.tolerance=k.DEFAULT_TOLERANCE;this.validateHUDIntersector=new k(this.viewingMode);this.validateHUDIntersector.options.hud=!1}
a.prototype.intersectScreen=function(a,b){return this.intersectRay(this.getPickRay(a,this.tmpRay),g(this.viewingMode),b)};a.prototype.intersectScreenFreePointFallback=function(a,b){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b)};a.prototype.intersectRayFreePointFallback=function(a,b){return this.intersectRay(a,g(this.viewingMode),b)||this.intersectRayFreePointLocal(a,b)};a.prototype.intersectRay=function(a,b,c,d){b.options.selectionMode=!1;b.options.store=0;this.computeIntersection(a,
b,d);return b.results.min?b.results.min.getIntersectionPoint(c):!1};a.prototype.getCenterRayWithSubpixelOffset=function(a,b,c,d){void 0===c&&(c=.5);void 0===d&&(d=.5);a.getRenderCenter(t,c,d);t[0]+=.0466;t[1]-=.0123;return e.ray.fromRenderAtEye(a,t,b)};a.prototype.intersectIntersectorScreen=function(a,b,c){this.computeIntersection(this.getPickRay(a,this.tmpRay),b,c)};a.prototype.intersectToolIntersectorScreen=function(a,b,c){a=this.getPickRay(a,this.tmpRay);this.intersectToolIntersectorRay(a,b,c)};
a.prototype.intersectToolIntersectorRay=function(a,b,c){b.options.selectionMode=!0;this.computeIntersection(a,b,c);var d=b.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||d.hasIntersectionPoint&&"TerrainRenderer"!==d.intersector||(b.options.selectionMode=!1,this.computeIntersection(a,b,c))};a.prototype.setTolerance=function(a){void 0===a&&(a=k.DEFAULT_TOLERANCE);this.tolerance=a};a.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};a.prototype.removeIntersectionHandler=
function(a){this.externalIntersectionHandlers.delete(a)};a.prototype.getPickRay=function(a,b){void 0===b&&(b=e.ray.create());return e.ray.fromScreen(this.view.state.camera,a,b)};a.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==this.viewingMode)return!1;var c=this.view.dataExtent,e=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===e)return h.vec3.add(b,a.origin,h.vec3.normalize(d.sv3d.get(),a.direction)),!0;var g=this.view.state.camera,f=Math.max(0,
c.xmin-g.eye[0],g.eye[0]-c.xmax),c=Math.max(0,c.ymin-g.eye[1],g.eye[1]-c.ymax),g=e/Math.max(1,Math.pow(Math.max(0,Math.log(e/(Math.abs(g.relativeElevation)+Number.MIN_VALUE))),2)),g=Math.max(g,Math.min(Math.sqrt(f*f+c*c),e)),e=h.vec3.scale(d.sv3d.get(),a.direction,g/h.vec3.length(a.direction));h.vec3.add(b,a.origin,e);return!0};a.prototype.intersectElevationFromScreen=function(a,b,c){void 0===c&&(c=0);return this.intersectElevation(this.getPickRay(a,this.tmpRay),b,c)};a.prototype.intersectElevation=
function(a,b,c){void 0===c&&(c=0);var e="on-the-ground"!==b.mode?b.offset+c:0,g=e/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===b.mode)return c=this.view.computeMapPointFromVec3d(this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a,e,u)),c.z-=b.offset,c;var m=this.view.state.camera,l=f.castRenderScreenPointArray3(d.sv3d.get());m.projectPoint(a.origin,l);var r=this.prepareFilters(null,p),w=this.view.slicePlane,t=w?n.sliceFilterPredicate(w):null,v=new k(this.viewingMode);
v.options.store=0;var y=a.origin;0!==e&&("local"===this.viewingMode?y=h.vec3.set(d.sv3d.get(),a.origin[0],a.origin[1],a.origin[2]-g):(x&&x.offset===e||(x={offset:e,verticalOffset:new n.VerticalOffsetForGlobalViewingMode(e)}),v.options.verticalOffset=x.verticalOffset));var q=h.vec3.add(d.sv3d.get(),y,a.direction);v.reset(y,q);v.point=l;v.camera=m;v.filterPredicate=null;switch(b.mode){case "relative-to-scene":v.intersect(r.layers,l,m,this.tolerance,null,function(a){return a.metadata&&a.metadata.isElevationSource});
this.externalIntersectionHandlers.forEach(function(a){"I3S"!==a.type&&"Terrain"!==a.type||a.intersect(v,a.slicePlane?t:null,y,q,l)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forEach(function(a){"Terrain"===a.type&&a.intersect(v,a.slicePlane?t:null,y,q,l)})}return v.results.min.getIntersectionPoint(u)?(b=this.view.computeMapPointFromVec3d(u),b.z=c,b):null};a.prototype.computeIntersection=function(a,b,c){var e=this,g=this.view.state.camera,k=f.castRenderScreenPointArray3(d.sv3d.get());
g.projectPoint(a.origin,k);var m=this.prepareFilters(c,p);b.options.storeTerrainResults=m.filterLayerUid(n.TERRAIN_ID);b.options.selectOpaqueTerrainOnly=!c||!("include"in c||"exclude"in c);var l=a.origin,r=h.vec3.add(d.sv3d.get(),a.origin,a.direction);b.reset(l,r);b.intersect(m.layers,k,g,this.tolerance);var w=(a=this.view.slicePlane)?n.sliceFilterPredicate(a):null;b.intersect(m.sliceableLayers,k,g,this.tolerance,w);var t=c&&(c.terrainLocationFeedbackEnabled||c.enableDraped);this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===
n.TERRAIN_ID){if(!t&&!m.filterLayerUid(n.TERRAIN_ID))return}else if(!m.filterLayerUid(a.intersectionHandlerId))return;a.intersect(b,a.slicePlane?w:null,l,r,k)});a=d.sv3d.get();if(c&&c.enableDraped&&b.results.terrain.getIntersectionPoint(a)){c=this.view.basemapTerrain.overlayManager.renderer;var v=d.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(a,v,this.view.spatialReference);v[2]=this.view.basemapTerrain.getElevation(a[0],a[1],a[2],this.view.renderCoordsHelper.spatialReference)||0;c.intersect(b,
v,m.filterRenderGeometry)}b.sortResults();c=b.results.hud;if(c.hasIntersectionPoint){var u=f.castRenderScreenPointArray3(d.sv3d.get()),x=d.sv3d.get(),y=d.sv3d.get();this.unprojectHUDResultRay(c.center,u,x,y);a=h.vec3.distance(c.center,x)/h.vec3.distance(x,y)*.99;this.validateHUDIntersector.reset(x,y);this.validateHUDIntersector.intersect(m.layers,u,g,this.tolerance);this.validateHUDIntersector.intersect(m.sliceableLayers,u,g,this.tolerance,w);this.externalIntersectionHandlers.forEach(function(a){m.filterLayerUid(a.intersectionHandlerId)&&
a.intersect(e.validateHUDIntersector,a.slicePlane?w:null,x,y,u)});g=this.validateHUDIntersector.results.min;if(null==g.dist||a<=g.dist)b.results.min.copyFrom(c),b.results.all.splice(0,0,c)}};a.prototype.prepareFilters=function(a,b){var d=[],e=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?e:d).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;c(d,b.filterLayer,b.layers);c(e,b.filterLayer,b.sliceableLayers);return b};a.prototype.unprojectHUDResultRay=
function(a,b,c,e){var g=this.view.state.camera;g.projectPoint(a,b);a=f.castRenderScreenPointArray3(d.sv3d.get());a[0]=b[0];a[1]=b[1];a[2]=0;g.unprojectPoint(a,c);a[2]=1;g.unprojectPoint(a,e)};return a}();b.SceneIntersectionHelper=q;var r,p={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:function(a){return p.filterLayerUid(a.apiLayerUid)},filterLayerUid:function(a){var b=p.include,c=p.exclude;return l.isNone(a)?null==b&&null==c:(null==b||b.has(a))&&(null==c||!c.has(a))},filterRenderGeometry:function(a){return p.filterLayerUid(a.data.layerUid)}},
u=a.vec3f64.create(),t=f.createRenderScreenPointArray(),x=null})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./ElevationProvider".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){return function(a){function b(b){b=a.call(this,b)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;return b}l(b,a);b.prototype.getElevation=function(a,b,c,d,e){var g=null,f=!0;"scene"===e&&(g=this._updateElevation(g,this.providers.im,a,b,c,d,e),null!=g&&(f=!1));f&&(g=this._updateElevation(g,this.providers.ground,a,b,c,d,e));"scene"===e&&(g=this._updateElevation(g,this.providers.scene,a,b,c,d,e));return g};b.prototype._updateElevation=function(a,b,
c,d,e,g,f){for(var k=0;k<b.length;k++){var h=b[k].getElevation(c,d,e,g,f);null!=h&&(a=null!=a?Math.max(h,a):h)}return a};b.prototype.queryElevation=function(a,b,d,e){var f=this;void 0===d&&(d=0);this._elevationService||(this._elevationService=new g.ElevationQuery(this.view.spatialReference,function(){return f.view.map&&f.view.map.ground},{maximumAutoTileRequests:4}));var h=k.createResolver();(c.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b,d):this._elevationService.queryElevation(a[0],
a[1],b,d)).then(function(b){"scene"===e&&(b=c.isPoint(a)?f._updateElevation(b,f.providers.scene,a.x,a.y,a.z,a.spatialReference,e):f._updateElevation(b,f.providers.scene,a[0],a[1],a[2],f.spatialReference,e));h.resolve(b)}).catch(function(b){k.isAbortError(b)?h.reject(b):h.resolve(c.isPoint(a)?r.getElevationAtPoint(f,a):f.getElevation(a[0],a[1],a[2],f.spatialReference))});return h.promise};b.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",
a)}));this.providers[a].push(b)};b.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};f([n.property({constructOnly:!0})],b.prototype,"view",void 0);f([n.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.prototype,"spatialReference",void 0);return b=f([n.subclass("esri.views.3d.support.CombinedElevationProvider")],
b)}(n.declared(d.EventedMixin(e)))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,
c){this.spatialReference=b;this.view=c;this.point=new a.Point;this.point.spatialReference=b}b.prototype.getElevation=function(a,b,c){return this.view.elevationProvider.getElevation(a,b,0,this.spatialReference,c)};b.prototype.queryElevation=function(a,b,c,d,e){return f(this,void 0,void 0,function(){return l(this,function(g){this.point.x=a;this.point.y=b;return[2,this.view.elevationProvider.queryElevation(this.point,c,d,e)]})})};return b}();b.ViewElevationProvider=q;q=function(){function b(a,b,c){this.spatialReference=
a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=h({},c,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(a,b,c,d){void 0===d&&(d=0);return f(this,void 0,void 0,function(){var g=this;return l(this,function(f){return[2,n.create(function(f,k){var h={x:a,y:b,minDemResolution:d,result:{resolve:f,reject:k},signal:c};g._queries.push(h);n.onAbort(c,function(){e.remove(g._queries,h);k(n.createAbortError())});g._scheduleDoQuery()})]})})};b.prototype._scheduleDoQuery=
function(){var a=this;this._isScheduled||(c.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return f(this,void 0,void 0,function(){var b,c,e,g,f,v,y,m,w,A,B,q;return l(this,function(p){switch(p.label){case 0:this._isScheduled=!1;b=this._queries;this._queries=[];if(0===b.length)return[2];c=b.map(function(a){return[a.x,a.y]});e=b.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);g=new a.Multipoint({points:c,spatialReference:this.spatialReference});
f=this._getElevationQueryProvider();if(!f)return b.forEach(function(a){return a.result.reject()}),[2];v=1<b.length&&b.some(function(a){return!!a.signal})?n.createAbortController():null;y=k.isSome(v)?v.signal:b[0].signal;k.isSome(v)&&(m=0,b.forEach(function(a){return n.onAbort(a.signal,function(){m++;a.result.reject(n.createAbortError());m===b.length&&v.abort()})}));w=h({},this._queryOptions,{minDemResolution:e,signal:y});return[4,d.result(f.queryElevation(g,w))];case 1:A=p.sent();for(B=0;B<b.length;B++)q=
b[B],k.isSome(q.signal)&&q.signal.aborted?q.result.reject(n.createAbortError()):!1===A.ok?q.result.reject(A.error):q.result.resolve(A.value.geometry.points[B][2]);return[2]}})})};return b}();b.ElevationQuery=q})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/has"],function(q,b,l){function f(){var b=!!l("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureBlendTime:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?.8:1,polylineLodFactor:b?1.2:1.5},
sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:b},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!l("disable-feature:reduce-map-tile-levels"),textureBlendTime:200},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,memoryLimit:b?600:750,additionalCacheMemory:b?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5,polygonLodFactor:b?1.2:2,polylineLodFactor:b?1.2:2},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!l("disable-feature:reduce-map-tile-levels"),textureBlendTime:200},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,memoryLimit:b?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:b?
null:4096,maximumPixelRatio:b?1:null}}}q=function(){function b(){}b.isValidProfile=function(a){return a in b.profiles};b.getDefaultProfile=function(){return l("trident")||l("esri-iPhone")?"low":"medium"};b.apply=function(a,e){a=b.profiles[a];e.graphics3D.maxTotalNumberOfFeatures=a.graphics3D.maxTotalNumberOfFeatures;e.graphics3D.maxTotalNumberOfPrimitives=a.graphics3D.maxTotalNumberOfPrimitives;e.graphics3D.polygonLodFactor=a.graphics3D.polygonLodFactor;e.graphics3D.polylineLodFactor=a.graphics3D.polylineLodFactor;
e.sceneService["3dObject"].lodFactor=a.sceneService["3dObject"].lodFactor;e.sceneService.point.lodFactor=a.sceneService.point.lodFactor;e.sceneService.integratedMesh.lodFactor=a.sceneService.integratedMesh.lodFactor;e.sceneService.pointCloud.lodFactor=a.sceneService.pointCloud.lodFactor;e.sceneService.uncompressedTextureDownsamplingEnabled=a.sceneService.uncompressedTextureDownsamplingEnabled;e.tiledSurface.lodBias=a.tiledSurface.lodBias;e.tiledSurface.angledSplitBias=a.tiledSurface.angledSplitBias;
e.tiledSurface.reduceTileLevelDifferences=a.tiledSurface.reduceTileLevelDifferences;e.tiledSurface.textureBlendTime=a.tiledSurface.textureBlendTime;e.antialiasingEnabled=a.antialiasingEnabled;e.physicallyBasedRenderingEnabled=a.physicalBasedRenderingEnabled;e.memoryLimit=a.memoryLimit;e.additionalCacheMemory=a.additionalCacheMemory;e.frameRate=a.frameRate;e.maximumRenderResolution=a.maximumRenderResolution;e.maximumPixelRatio=a.maximumPixelRatio};b.debug={reset:function(){var a=f(),e;for(e in a)b.profiles[e]=
a[e]}};return b}();(q||(q={})).profiles=f();return q})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),function(q,b,l,f,h,a,e,d,k){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.color=new h([0,255,255]);b.haloColor=
null;b.haloOpacity=1;b.fillOpacity=.25;return b}l(b,a);b.toEngineOptions=function(a){var b=h.toUnitRGBA(a.color),c=e.isSome(a.haloColor)?h.toUnitRGBA(a.haloColor):b;return{color:k.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloColor:k.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};f([d.property({type:h})],b.prototype,"color",void 0);f([d.property({type:h})],b.prototype,"haloColor",
void 0);f([d.property()],b.prototype,"haloOpacity",void 0);f([d.property()],b.prototype,"fillOpacity",void 0);return b=f([d.subclass("esri.views.3d.support.HighlightOptions")],b)}(d.declared(a))})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f32=l})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require","exports"],function(q,b){function l(){return new Float32Array(4)}
function f(a,b,d,e){var c=new Float32Array(4);c[0]=a;c[1]=b;c[2]=d;c[3]=e;return c}function h(){return f(1,1,1,1)}function a(){return f(1,0,0,0)}function e(){return f(0,1,0,0)}function d(){return f(0,0,1,0)}function k(){return f(0,0,0,1)}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.clone=function(a){var b=new Float32Array(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};b.fromValues=f;b.createView=function(a,b){return new Float32Array(a,b,4)};b.zeros=function(){return l()};b.ones=
h;b.unitX=a;b.unitY=e;b.unitZ=d;b.unitW=k;b.ZEROS=l();b.ONES=h();b.UNIT_X=a();b.UNIT_Y=e();b.UNIT_Z=d();b.UNIT_W=k()})},"esri/views/3d/support/index":function(){define(["require","exports","../../../core/iteratorUtils","./ResourceController","./MemoryController"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.ResourceControllerMaster=f.ResourceControllerMaster;b.newResourceController=f.newResourceController;b.newMemoryController=h.newMemoryController;b.downloadSlotsPerClient=
l.MapFromValues([[0,15],[1,15],[2,20],[3,5]]);b.maxDownloadSlots=30})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/Handles ../../../core/now ../../../core/scheduling ../../../core/accessorSupport/decorators ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,
"__esModule",{value:!0});var p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.updating=!1;return b}f(b,a);l([k.property({readOnly:!0})],b.prototype,"updating",void 0);return b=l([k.subclass("esri.views.3d.support.ResourceController")],b)}(k.declared(h));b.ResourceControllerMaster=p;b.newResourceController=function(a,b){void 0===b&&(b=e);return new u.ResourceController({view:a,now:b})};var u;(function(b){var e=function(b){function e(){var c=null!==b&&b.apply(this,arguments)||
this;c._scheduler=null;c._memoryController=null;c._streamDataLoader=null;c._cameraChangeTime=0;c._handles=new a;c._frameTask=null;return c}f(e,b);e.prototype.initialize=function(){var a=this;this._cameraChangeTime=this.now();this._scheduler=r.newScheduler(this.now);this._memoryController=c.newMemoryController(this.view);this._streamDataLoader=new g.default;this._streamDataLoader.setup(n.maxDownloadSlots,n.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",function(){return a._cameraChangedHandler()},
!0),this.view.watch("stationary",function(){return a._stationaryChangedHandler()}),this._memoryController.events.on("updating-changed",function(){return a.notifyChange("updating")})]);this._frameTask=d.addFrameTask({update:function(b){return a.frame(b)}})};e.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null);this._memoryController.destroy();
this._memoryController=null;this._scheduler.destroy();this._scheduler=null};Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this._memoryController&&this._memoryController.updating||this._streamDataLoader&&this._streamDataLoader.updating)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryController",{get:function(){return this._memoryController},
enumerable:!0,configurable:!0});e.prototype.createStreamDataRequester=function(a){var b=this._streamDataLoader;return{request:function(c,d,e){return b.request(c,d,a,e)},get busy(){return b.busy}}};e.prototype.frame=function(a){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(a.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&
this._memoryController.update()}};e.prototype._cameraChangedHandler=function(){this._cameraChangeTime=this._scheduler.now;this._scheduler.state=this.state};e.prototype._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};Object.defineProperty(e.prototype,"state",{get:function(){var a=this.view;return a.animation?0:a.interacting||this._scheduler.now-this._cameraChangeTime<=h?1:2},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"test",{get:function(){var a=
this;return{getQueueStats:function(b){return a._streamDataLoader.test.loadQueue.getStatsForType(b)},state:this.state}},enumerable:!0,configurable:!0});l([k.property({constructOnly:!0})],e.prototype,"view",void 0);l([k.property({constructOnly:!0})],e.prototype,"now",void 0);l([k.property()],e.prototype,"_streamDataLoader",void 0);l([k.property({readOnly:!0,dependsOn:["_streamDataLoader.updating"]})],e.prototype,"updating",null);return e=l([k.subclass("esri.views.3d.support.ResourceController")],e)}(k.declared(p));
b.ResourceController=e;var h=300})(u||(u={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Evented ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});var e=f.getLogger("esri.views.3d.support.MemoryController");b.newMemoryController=function(a){return new d(a)};var d=function(){function b(a){this._view=a;this.events=new l;this.minQuality=
.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new h.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}b.prototype.destroy=function(){this.events=null};b.prototype.getMemCache=function(a,b){return new h.MemCache(a,this._cacheStorage,b)};Object.defineProperty(b.prototype,"maxMemory",{get:function(){return this._maxMemory},set:function(a){null!=
a&&0<a&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<a&&this._updateQuality(1),this._maxMemory=a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"additionalCacheMemory",{set:function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)},enumerable:!0,configurable:!0});b.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};Object.defineProperty(b.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});b.prototype.resetStableQuality=function(){this._stableQuality=0};b.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var a=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=
!1,this._updateQuality(1);else if(a){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,a=this._updateQuality(this._quality/1.3),
this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this.updating!==a&&(this._updating=a,this.events.emit("updating-changed",this.updating))}};b.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this.minQuality),1);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);
++this._numQualityChanges;return!0};b.prototype._layersUpdating=function(){return this._view.allLayerViews.some(function(a){return!!a.updating})};b.prototype._updateMemory=function(){var b=this,c=0,d=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(c+=this._view.basemapTerrain.getUsedMemory());var f=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;f&&(c+=f.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(e){if(a.isMemoryManagedLayerView(e)){var g=
e.ignoresMemoryFactor()?b._quality:1;c+=e.getUsedMemory()*g;d+=e.getUnloadedMemory()*g}});var k=null==this._warnMemoryUsage||Math.round(10*c)!==Math.round(10*this._warnMemoryUsage),f=1048576*this._maxMemory;if(c>f&&k){this._warnMemoryUsage=c;var k=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},h=Math.round(100*this._quality);e.warn("Memory Limit exceeded! Limit: "+k(f)+" Current: "+k(c)+" Projected: "+k(c+d)+" Quality: "+h+"%")}this._memoryUsed=c/f;this._memoryPredicted=
(c+d)/f;this._cacheStorage.maxSize=Math.max(0,f-c+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(b.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/now ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../../views/support/Scheduler".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a){if(2>a.byteLength)return"unknown";a=new Uint8Array(a,0,a.byteLength);return 137===a[0]&&80===a[1]?"image/png":71===a[0]&&73===a[1]?"image/gif":66===a[0]&&77===a[1]?"image/bmp":255===a[0]&&216===a[1]?"image/jpeg":"unknown"}Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.tasks=new Map;b.onLoadQueue=[];b.doneQueue=[];b.updating=!1;return b}f(b,a);b.prototype.setup=function(a,
b,c){var d=this;this.loadQueue=new p.AsyncWorkerQueue(function(a,b){return d.startLoading(a,b)},function(a,b){return d.doneLoadingCallback(a,b)},a,b);c&&(this.taskHandle=c.registerTask(t.Task.STREAM_DATA_LOADER,function(a){return d.update(a)},function(){return 0<d.doneQueue.length||0<d.onLoadQueue.length}))};b.prototype.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(function(a){a.abortController&&a.abortController.abort()});this.loadQueue.clear();
this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};Object.defineProperty(b.prototype,"busy",{get:function(){return this.loadQueue.busy},enumerable:!0,configurable:!0});b.prototype.request=function(a,b,c,d){var e=this,f=g.createResolver();f.__signal=n.isSome(d)?d.signal:null;var k=n.isSome(d)&&d.uid||a,h=this.createOrUpdateTask(a,b,c,k,f);g.onAbort(d,function(){return e.cancelRequest(h,f)});return f.promise};b.prototype.createTask=function(a,b,c,d,e){a={url:a,docType:b,clientType:c,key:d,
result:null,status:1,resourceRequest:null,abortController:null,resolvers:[],_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,e);this.tasks.set(d,a);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(a);return a};b.prototype.cancelRequest=function(a,b){e.removeUnordered(a.resolvers,b);b.reject(g.createAbortError());0===a.resolvers.length&&(2===a.status&&(a.status=4,this.loadQueue.cancel(a),a.abortController.abort(),a.resourceRequest=null,a.abortController=null),
a.status=4,this.tasks.delete(a.key),0===this.tasks.size&&this._set("updating",!1))};b.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};b.prototype.updateTask=function(a,b){a.resolvers.push(b)};b.prototype.createOrUpdateTask=function(a,b,c,d,e){d=this.taskKey(d,b,c);var g=this.tasks.get(d);return g?(this.updateTask(g,e),g):this.createTask(a,b,c,d,e)};b.prototype.doneLoadingCallback=function(a,b){u.assert(2===a.status);a.status=3;this.taskHandle?this.doneQueue.push({task:a,err:b}):this.doneLoading(a,
b)};b.prototype.update=function(a){for(;!a.done&&0<this.onLoadQueue.length;){var b=this.onLoadQueue.shift();g.throwIfAborted(b.task.abortController);b.task.abortController=null;b.callback(b.task);a.madeProgress()}for(;!a.done&&0<this.doneQueue.length;)b=this.doneQueue.shift(),3!==b.task.status&&(b.err=b.err||g.createAbortError()),this.doneLoading(b.task,b.err),a.madeProgress()};b.prototype.doneLoading=function(a,b){for(var c=a.result instanceof HTMLImageElement?0:a.resolvers.length,e=0,f=a.resolvers;e<
f.length;e++){var h=f[e];if(b)g.isAbortError(b)?h.reject(b):h.reject(new d("stream-data-loader:request-error","Failed to request resource at '"+a.url+"'. "+b,{url:a.url,error:b}));else{--c;var m=0>=c?a.result:k.clone(a.result);h.resolve(m)}}this.tasks.delete(a.key);0===this.tasks.size&&this._set("updating",!1)};b.prototype.startLoading=function(a,b){var d=this;if(4===a.status)return!1;a.status=2;var e,f;switch(a.docType){case "binary":f="array-buffer";e=0;break;case "image":f="image";break;case "image+type":f=
"array-buffer";break;default:f="json"}a.startTime=c();a.abortController=g.createAbortController();a.resourceRequest=h(a.url,{responseType:f,timeout:e,signal:a.abortController.signal});var k=function(){},m=function(e){a.duration=c()-a.startTime;a.size=e instanceof ArrayBuffer?e.byteLength:a.size||0;a.result=e;d.taskHandle?d.onLoadQueue.push({callback:b,task:a}):(a.abortController=null,b(a))},p=function(c){2===a.status&&b(a,c);k()};if("image+type"!==a.docType)return a.resourceRequest.then(function(a){return m(a.data)},
p),!0;a.resourceRequest.then(function(b){b=b.data;var c=x(b);f="image";a.size=b.byteLength;if("unknown"===c)a.resourceRequest=h(a.url,{responseType:f,timeout:e,signal:a.abortController.signal}),a.resourceRequest.then(function(a){return m(a.data)},p);else{b=new Blob([b],{type:c});var d=window.URL.createObjectURL(b);k=function(){return window.URL.revokeObjectURL(d)};a.resourceRequest=h(d,{responseType:f,timeout:e,signal:a.abortController.signal});a.resourceRequest.then(function(a){return m(new v(a.data,
c,k))},p)}},p);return!0};Object.defineProperty(b.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});l([r.property({readOnly:!0})],b.prototype,"updating",void 0);return b=l([r.subclass("esri.views.3d.support.StreamDataLoader")],b)}(r.declared(a));b.StreamDataLoader=q;var v=function(){return function(a,b,c){this.image=a;this.type=b;this.release=c}}();b.ImageWithType=v;b.default=q})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["require",
"exports","../webgl-engine/lib/Util"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a,e,d){var f=this;this._workerFunc=b;this._callbackFunc=a;this._maxTotalNumWorkers=e;this._type2id=new Map;this._tasks=[];this._typeNumWorkers=[];this._typeWorkerQuota=[];this._typeStatistics=[];this._totalNumWorkers=0;d.forEach(function(a,b){f._type2id.set(b,f._tasks.length);f._tasks.push([]);f._typeNumWorkers.push(0);f._typeStatistics.push({requests:0,size:0,duration:0,
speed:0});f._typeWorkerQuota.push(a)})}Object.defineProperty(b.prototype,"numTypes",{get:function(){return this._tasks.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"busy",{get:function(){return this._totalNumWorkers>=this._maxTotalNumWorkers},enumerable:!0,configurable:!0});b.prototype.push=function(b){var a=this,e=this._type2id.get(b.clientType);this._totalNumWorkers<this._maxTotalNumWorkers?(this._typeNumWorkers[e]++,this._totalNumWorkers++,this._workerFunc(b,function(b,
e){return a._taskCallback(b,e)})):this._tasks[e].push(b)};b.prototype.getStatsForType=function(b){b=this._type2id.get(b);return{quota:this._typeWorkerQuota[b],workers:this._typeNumWorkers[b],queueSize:this._tasks[b].length,requestStats:this._typeStatistics[b]}};b.prototype.cancel=function(b){this._taskFinished(b);b._cancelledInQueue=!0};b.prototype.clear=function(){for(var b=0;b<this._tasks.length;b++)this._tasks[b]=[]};b.prototype._taskFinished=function(b){var a=this._type2id.get(b.clientType);this._typeNumWorkers[a]--;
this._totalNumWorkers--;this._typeStatistics[a].requests++;this._typeStatistics[a].size+=b.size||0;this._typeStatistics[a].duration+=b.duration||0;this._typeStatistics[a].speed=0<this._typeStatistics[a].duration?this._typeStatistics[a].size/this._typeStatistics[a].duration:0;l.assert(0<=this._typeNumWorkers[a]);this._next()};b.prototype._next=function(){for(var b=0;b<this.numTypes;++b){if(this._typeNumWorkers[b]<this._typeWorkerQuota[b]&&this._processQueue(b))return;++b}for(b=0;b<this.numTypes&&!this._processQueue(b);++b);
};b.prototype._processQueue=function(b){for(var a=this;0<this._tasks[b].length;)if(this._workerFunc(this._tasks[b].shift(),function(b,d){return a._taskCallback(b,d)}))return this._typeNumWorkers[b]++,this._totalNumWorkers++,!0;return!1};b.prototype._taskCallback=function(b,a){b._cancelledInQueue||(this._callbackFunc(b,a),this._taskFinished(b))};Object.defineProperty(b.prototype,"test",{get:function(){var b=this;return{set workerFunc(a){b._workerFunc=a}}},enumerable:!0,configurable:!0});return b}();
b.AsyncWorkerQueue=q})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,d){void 0===d&&(d=null);this.spatialReference=b;this.unitInMeters=
e.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=this.loadGeometryService(a,d)}b.prototype.loadGeometryService=function(b,e){return f(this,void 0,void 0,function(){return l(this,function(c){switch(c.label){case 0:if(e)return[2,e];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,d.create(b&&b.get("portalItem"))];case 2:return[2,c.sent()];case 3:throw c.sent(),new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");case 4:return[2]}})})};
b.prototype.toGeographic=function(a){return f(this,void 0,void 0,function(){var b,c,d,e,f,n,v,y=this;return l(this,function(g){switch(g.label){case 0:return[4,this._geometryServicePromise];case 1:return b=g.sent(),c=!0,Array.isArray(a[0])&&"number"!==typeof a[0]?d=a:(d=[a],c=!1),e=d.map(function(a){return a instanceof h.Point?a:new h.Point(a,y.spatialReference)}),f=new k({geometries:e,outSpatialReference:h.SpatialReference.WGS84}),[4,b.project(f)];case 2:return n=g.sent(),v=n.map(function(a){return"point"===
a.type?[a.x,a.y]:void 0}),[2,c?v:v[0]]}})})};return b}();b.MapCoordsHelper=q;b.default=q})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../core/Error ../Portal ../../tasks/GeometryService ../../tasks/support/ProjectParameters @dojo/framework/shim/Promise".split(" "),function(q,b,l,f,h,a,e,d,k){function n(b,g){void 0===b&&(b=null);return f(this,void 0,void 0,function(){var c;return l(this,
function(f){switch(f.label){case 0:if(h.geometryServiceUrl)return[2,new d({url:h.geometryServiceUrl})];if(!b)throw new a("internal:geometry-service-url-not-configured");c="portal"in b?b.portal||e.getDefault():b;return[4,c.load({signal:g})];case 1:f.sent();if(c.helperServices&&c.helperServices.geometry&&c.helperServices.geometry.url)return[2,new d({url:c.helperServices.geometry.url})];throw new a("internal:geometry-service-url-not-configured");}})})}Object.defineProperty(b,"__esModule",{value:!0});
b.create=n;b.projectGeometry=function(b,d,e,h){void 0===e&&(e=null);return f(this,void 0,void 0,function(){var c,g,f;return l(this,function(p){switch(p.label){case 0:return[4,n(e,h)];case 1:return c=p.sent(),g=new k,g.geometries=[b],g.outSpatialReference=d,[4,c.project(g,{signal:h})];case 2:if((f=p.sent())&&Array.isArray(f)&&1===f.length)return[2,f[0]];throw new a("internal:geometry-service-projection-failed");}})})}})},"esri/tasks/GeometryService":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/paramHelper ../core/tsSupport/assignHelper ../geometry ../request ../core/jsonMap ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/support/jsonUtils ./Task ./operations/generalize ./operations/lengths ./operations/offset ./operations/relation ./operations/trimExtend ./support/GeneralizeParameters ./support/LengthsParameters ./support/OffsetParameters ./support/ProjectParameters ./support/RelationParameters ./support/TrimExtendParameters".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C){var E=new k.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),G=c.ensureType(A);return function(b){function c(a){a=b.call(this,a)||this;a.url=null;return a}l(c,b);c.prototype.areasAndLengths=function(b,c){b=a({},this.parsedUrl.query,{f:"json"},b.toJSON());c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/areasAndLengths",c).then(function(a){return a.data})};c.prototype.autoComplete=
function(b,c,g){var f=b[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),polygons:JSON.stringify(this._encodeGeometries(b).geometries),polylines:JSON.stringify(this._encodeGeometries(c).geometries)});g=this._asValidOptions(b,g);return d(this.parsedUrl.path+"/autoComplete",g).then(function(a){return(a.data.geometries||[]).map(function(a){return new e.Polygon({spatialReference:f,rings:a.rings})})})};c.prototype.buffer=function(b,c){var g=a({},this.parsedUrl.query,
{f:"json"},b.toJSON()),f=b.outSpatialReference||b.geometries[0].spatialReference;b=this._asValidOptions(g,c);return d(this.parsedUrl.path+"/buffer",b).then(function(a){return(a.data.geometries||[]).map(function(a){return new e.Polygon({spatialReference:f,rings:a.rings})})})};c.prototype.convexHull=function(b,c){var e=b[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))});c=this._asValidOptions(b,c);return d(this.parsedUrl.path+
"/convexHull",c).then(function(a){return g.fromJSON(a.data.geometry).set({spatialReference:e})})};c.prototype.cut=function(b,c,e){var f=b[0].spatialReference,k=b.map(function(a){return a.toJSON()});b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),target:JSON.stringify({geometryType:g.getJsonType(b[0]),geometries:k}),cutter:JSON.stringify(c.toJSON())});e=this._asValidOptions(b,e);return d(this.parsedUrl.path+"/cut",e).then(function(a){a=a.data;return{cutIndexes:a.cutIndexes,geometries:(a.geometries||
[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})}})};c.prototype.densify=function(b,c){var e=b.geometries[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json"},b.toJSON());c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/densify",c).then(function(a){return(a.data.geometries||[]).map(function(a){return g.fromJSON(a).set({spatialReference:e})})})};c.prototype.difference=function(b,c,e){var f=b[0].spatialReference;b={query:a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),
geometries:JSON.stringify(this._encodeGeometries(b)),geometry:JSON.stringify({geometryType:g.getJsonType(c),geometry:c.toJSON()})})};if(this.requestOptions||e)b=a({},this.requestOptions,e,b);return d(this.parsedUrl.path+"/difference",b).then(function(a){return(a.data.geometries||[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})})};c.prototype.distance=function(b,c){b=a({},this.parsedUrl.query,{f:"json"},b.toJSON());c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/distance",
c).then(function(a){return(a=a.data)&&a.distance})};c.prototype.fromGeoCoordinateString=function(b,c){var e={};e.sr=null!=b.sr&&"object"===typeof b.sr?b.sr.wkid||JSON.stringify(b.sr):b.sr;e.strings=JSON.stringify(b.strings);e.conversionType=E.toJSON(b.conversionType||"mgrs");e.conversionMode=b.conversionMode;b=a({},this.parsedUrl.query,{f:"json"},e);c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/fromGeoCoordinateString",c).then(function(a){return a.data.coordinates})};c.prototype.generalize=
function(b,c){b=y.from(b);var e=b.toJSON();b=p.generalizeToRESTParameters(b);b=a({},this.parsedUrl.query,{f:"json"},b);var f=e.geometries[0].spatialReference;c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/generalize",c).then(function(a){return(a.data.geometries||[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})})};c.prototype.intersect=function(b,c,e){var f=b[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b)),
geometry:JSON.stringify({geometryType:g.getJsonType(c),geometry:c.toJSON()})});e=this._asValidOptions(b,e);return d(this.parsedUrl.path+"/intersect",e).then(function(a){return(a.data.geometries||[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})})};c.prototype.labelPoints=function(b,c){var e=b.map(function(a){return a.toJSON()}),f=b[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:f.wkid?f.wkid:JSON.stringify(f.toJSON()),polygons:JSON.stringify(e)});c=this._asValidOptions(b,
c);return d(this.parsedUrl.path+"/labelPoints",c).then(function(a){return(a.data.labelPoints||[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})})};c.prototype.lengths=function(b,c){b=m.from(b);b=u.lengthsToRESTParameters(b);b=a({},this.parsedUrl.query,{f:"json"},b);c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/lengths",c).then(function(a){return a.data})};c.prototype.offset=function(b,c){b=w.from(b);var e=t.offsetToRESTParameters(b),e=a({},this.parsedUrl.query,{f:"json"},
e),f=b.geometries[0].spatialReference;b=this._asValidOptions(e,c);return d(this.parsedUrl.path+"/offset",b).then(function(a){return(a.data.geometries||[]).map(function(a){return g.fromJSON(a).set({spatialReference:f})})})};c.prototype.project=function(b,c){var e=this;b=G(b);var f=a({},this.parsedUrl.query,{f:"json"},b.toJSON()),k=b.outSpatialReference,h=g.getJsonType(b.geometries[0]);b=this._asValidOptions(f,c);return d(this.parsedUrl.path+"/project",b).then(function(a){return e._decodeGeometries(a.data,
h,k)})};c.prototype.relation=function(b,c){b=B.from(b);b=x.relationToRESTParameters(b);b=a({},this.parsedUrl.query,{f:"json"},b);c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/relation",c).then(function(a){return a.data.relations})};c.prototype.reshape=function(b,c,e){var f=b.spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(f.toJSON()),target:JSON.stringify({geometryType:g.getJsonType(b),geometry:b.toJSON()}),reshaper:JSON.stringify(c.toJSON())});e=this._asValidOptions(b,
e);return d(this.parsedUrl.path+"/reshape",e).then(function(a){return g.fromJSON(a.data.geometry).set({spatialReference:f})})};c.prototype.simplify=function(b,c){var e=this,f=b[0].spatialReference,k=a({},this.parsedUrl.query,{f:"json",sr:f.wkid?f.wkid:JSON.stringify(f.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))}),h=g.getJsonType(b[0]);b=this._asValidOptions(k,c);return d(this.parsedUrl.path+"/simplify",b).then(function(a){return e._decodeGeometries(a.data,h,f)})};c.prototype.toGeoCoordinateString=
function(b,c){var e={};e.sr=null!=b.sr&&"object"===typeof b.sr?b.sr.wkid||JSON.stringify(b.sr):b.sr;e.coordinates=JSON.stringify(b.coordinates);e.conversionType=E.toJSON(b.conversionType||"mgrs");e.conversionMode=b.conversionMode;e.numOfDigits=b.numOfDigits;e.rounding=b.rounding;e.addSpaces=b.addSpaces;b=a({},this.parsedUrl.query,{f:"json"},e);c=this._asValidOptions(b,c);return d(this.parsedUrl.path+"/toGeoCoordinateString",c).then(function(a){return a.data.strings})};c.prototype.trimExtend=function(b,
c){b=C.from(b);var g=v.trimExtendToRESTParameters(b),g=a({},this.parsedUrl.query,{f:"json"},g),f=b.sr;b=this._asValidOptions(g,c);return d(this.parsedUrl.path+"/trimExtend",b).then(function(a){return(a.data.geometries||[]).map(function(a){return new e.Polyline({spatialReference:f,paths:a.paths})})})};c.prototype.union=function(b,c){var e=b[0].spatialReference;b=a({},this.parsedUrl.query,{f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(this._encodeGeometries(b))});c=this._asValidOptions(b,
c);return d(this.parsedUrl.path+"/union",c).then(function(a){return g.fromJSON(a.data.geometry).set({spatialReference:e})})};c.prototype._asValidOptions=function(b,c){b={query:b};if(this.requestOptions||c)b=a({},this.requestOptions,c,b);return b};c.prototype._encodeGeometries=function(a){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d].toJSON());return{geometryType:g.getJsonType(a[0]),geometries:b}};c.prototype._decodeGeometries=function(b,c,d){var e=g.getGeometryType(c);b=b.geometries;var f=[],k=
{spatialReference:d.toJSON()};b.forEach(function(b,c){f[c]=new e(a({},b,k))});return f};c.prototype._toProjectGeometry=function(a){var b=a.spatialReference.toJSON();return a instanceof e.Extent?new e.Polygon({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new e.Polyline({paths:[[].concat(a.points)],spatialReference:b})};c.prototype._fromProjectedGeometry=function(a,b,c){return"extent"===b?(a=a.rings[0],new e.Extent(a[0][0],a[0][1],a[2][0],
a[2][1],c)):new e.Multipoint({points:a.paths[0],spatialReference:c.toJSON()})};c.UNIT_METER=9001;c.UNIT_GERMAN_METER=9031;c.UNIT_FOOT=9002;c.UNIT_SURVEY_FOOT=9003;c.UNIT_CLARKE_FOOT=9005;c.UNIT_FATHOM=9014;c.UNIT_NAUTICAL_MILE=9030;c.UNIT_SURVEY_CHAIN=9033;c.UNIT_SURVEY_LINK=9034;c.UNIT_SURVEY_MILE=9035;c.UNIT_KILOMETER=9036;c.UNIT_CLARKE_YARD=9037;c.UNIT_CLARKE_CHAIN=9038;c.UNIT_CLARKE_LINK=9039;c.UNIT_SEARS_YARD=9040;c.UNIT_SEARS_FOOT=9041;c.UNIT_SEARS_CHAIN=9042;c.UNIT_SEARS_LINK=9043;c.UNIT_BENOIT_1895A_YARD=
9050;c.UNIT_BENOIT_1895A_FOOT=9051;c.UNIT_BENOIT_1895A_CHAIN=9052;c.UNIT_BENOIT_1895A_LINK=9053;c.UNIT_BENOIT_1895B_YARD=9060;c.UNIT_BENOIT_1895B_FOOT=9061;c.UNIT_BENOIT_1895B_CHAIN=9062;c.UNIT_BENOIT_1895B_LINK=9063;c.UNIT_INDIAN_FOOT=9080;c.UNIT_INDIAN_1937_FOOT=9081;c.UNIT_INDIAN_1962_FOOT=9082;c.UNIT_INDIAN_1975_FOOT=9083;c.UNIT_INDIAN_YARD=9084;c.UNIT_INDIAN_1937_YARD=9085;c.UNIT_INDIAN_1962_YARD=9086;c.UNIT_INDIAN_1975_YARD=9087;c.UNIT_FOOT_1865=9070;c.UNIT_RADIAN=9101;c.UNIT_DEGREE=9102;c.UNIT_ARCMINUTE=
9103;c.UNIT_ARCSECOND=9104;c.UNIT_GRAD=9105;c.UNIT_GON=9106;c.UNIT_MICRORADIAN=9109;c.UNIT_ARCMINUTE_CENTESIMAL=9112;c.UNIT_ARCSECOND_CENTESIMAL=9113;c.UNIT_MIL6400=9114;c.UNIT_BRITISH_1936_FOOT=9095;c.UNIT_GOLDCOAST_FOOT=9094;c.UNIT_INTERNATIONAL_CHAIN=109003;c.UNIT_INTERNATIONAL_LINK=109004;c.UNIT_INTERNATIONAL_YARD=109001;c.UNIT_STATUTE_MILE=9093;c.UNIT_SURVEY_YARD=109002;c.UNIT_50KILOMETER_LENGTH=109030;c.UNIT_150KILOMETER_LENGTH=109031;c.UNIT_DECIMETER=109005;c.UNIT_CENTIMETER=109006;c.UNIT_MILLIMETER=
109007;c.UNIT_INTERNATIONAL_INCH=109008;c.UNIT_US_SURVEY_INCH=109009;c.UNIT_INTERNATIONAL_ROD=109010;c.UNIT_US_SURVEY_ROD=109011;c.UNIT_US_NAUTICAL_MILE=109012;c.UNIT_UK_NAUTICAL_MILE=109013;c.UNIT_SQUARE_INCHES="esriSquareInches";c.UNIT_SQUARE_FEET="esriSquareFeet";c.UNIT_SQUARE_YARDS="esriSquareYards";c.UNIT_ACRES="esriAcres";c.UNIT_SQUARE_MILES="esriSquareMiles";c.UNIT_SQUARE_MILLIMETERS="esriSquareMillimeters";c.UNIT_SQUARE_CENTIMETERS="esriSquareCentimeters";c.UNIT_SQUARE_DECIMETERS="esriSquareDecimeters";
c.UNIT_SQUARE_METERS="esriSquareMeters";c.UNIT_ARES="esriAres";c.UNIT_HECTARES="esriHectares";c.UNIT_SQUARE_KILOMETERS="esriSquareKilometers";f([n.property()],c.prototype,"url",void 0);return c=f([n.subclass("esri.tasks.GeometryService")],c)}(n.declared(r))})},"esri/tasks/operations/generalize":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=new l.default({109006:"centimeters",
9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});b.generalizeToRESTParameters=function(a){var b=a.toJSON();a=b.geometries;var d=b.deviationUnit,b={maxDeviation:b.maxDeviation};a&&a.length&&(b.geometries=JSON.stringify({geometryType:f.getJsonType(a[0]),geometries:a}),b.sr=JSON.stringify(a[0].spatialReference));h.write(d,b,"deviationUnit");return b}})},"esri/tasks/operations/lengths":function(){define(["require",
"exports","../../core/jsonMap"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});var f=new l.default({preserveShape:"preserve-shape"});b.lengthsToRESTParameters=function(b){var a=b.toJSON(),e=a.lengthUnit,d=a.geodesic,k=a.calculationType,h={};h.polylines=JSON.stringify(a.polylines);b=b.polylines[0].spatialReference;h.sr=b.wkid?b.wkid:JSON.stringify(b.toJSON());e&&(h.lengthUnit=e);d&&(h.geodesic=d);k&&(h.calculationType=f.toJSON(k));return h}})},"esri/tasks/operations/offset":function(){define(["require",
"exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=new l.default({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),a=new l.default({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});b.offsetToRESTParameters=function(b){var d=b.toJSON();b=d.geometries;var e=d.offsetHow,n=d.offsetUnit,d={bevelRatio:d.bevelRatio,
offsetDistance:d.offsetDistance};b&&b.length&&(d.geometries=JSON.stringify({geometryType:f.getJsonType(b[0]),geometries:b}),d.sr=JSON.stringify(b[0].spatialReference));e&&(d.offsetHow=h.toJSON(e));n&&(d.offsetUnit=a.toJSON(n));return d}})},"esri/tasks/operations/relation":function(){define(["require","exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=new l.default({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",
esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});b.relationToRESTParameters=function(a){var b=a.toJSON(),d=b.geometries1;
a=b.geometries2;var k=b.relation,b=b.relationParameter,n={};d&&d.length&&(n.geometries1=JSON.stringify({geometryType:f.getJsonType(d[0]),geometries:d}),d=d[0].spatialReference,n.sr=d.wkid?d.wkid:JSON.stringify(d));a&&0<a.length&&(n.geometries2=JSON.stringify({geometryType:f.getJsonType(a[0]),geometries:a}));k&&(n.relation=h.toJSON(k));b&&(n.relationParam=b);return n}})},"esri/tasks/operations/trimExtend":function(){define(["require","exports","../../core/jsonMap"],function(q,b,l){Object.defineProperty(b,
"__esModule",{value:!0});var f=new l.default({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});b.trimExtendToRESTParameters=function(b){b=b.toJSON();var a=b.polylines,e=b.trimExtendTo,d={};d.extendHow=f.toJSON(b.extendHow);a&&a.length&&(d.polylines=JSON.stringify(a),d.sr=JSON.stringify(a[0].spatialReference));e&&(d.trimExtendTo=JSON.stringify(e));return d}})},"esri/tasks/support/GeneralizeParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(q,b,l,f,h,a,e,d){q=function(b){function e(a){a=b.call(this,a)||this;a.deviationUnit=null;a.geometries=null;a.maxDeviation=null;return a}l(e,b);f([a.property({type:String,json:{write:!0}})],e.prototype,"deviationUnit",void 0);f([a.property({json:{read:{reader:function(a){return a?a.map(function(a){return d.fromJSON(a)}):null}},write:{writer:function(a,b){b.geometries=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries",void 0);f([a.property({type:Number,json:{write:!0}})],
e.prototype,"maxDeviation",void 0);return e=f([a.subclass("esri.tasks.support.GeneralizeParameters")],e)}(a.declared(h.JSONSupport));q.from=e.default(q);return q})},"esri/tasks/support/LengthsParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),function(q,b,l,f,h,a,e,d,
k){q=function(a){function b(b){b=a.call(this,b)||this;b.calculationType=null;b.geodesic=null;b.lengthUnit=null;b.polylines=null;return b}l(b,a);f([e.property({type:String,json:{write:!0}})],b.prototype,"calculationType",void 0);f([e.property({type:Boolean,json:{write:!0}})],b.prototype,"geodesic",void 0);f([e.property({json:{write:!0}})],b.prototype,"lengthUnit",void 0);f([e.property({type:[h.Polyline],json:{read:{reader:function(a){return a?a.map(function(a){return k.fromJSON(a)}):null}},write:{writer:function(a,
b){b.polylines=a.map(function(a){return a.toJSON()})}}}})],b.prototype,"polylines",void 0);return b=f([e.subclass("esri.tasks.support.LengthsParameters")],b)}(e.declared(a.JSONSupport));q.from=d.default(q);return q})},"esri/tasks/support/OffsetParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(q,b,l,f,h,a,e,d){q=function(b){function e(a){a=b.call(this,a)||this;a.bevelRatio=null;a.geometries=null;a.offsetDistance=null;a.offsetHow=null;a.offsetUnit=null;return a}l(e,b);f([a.property({type:Number,json:{write:!0}})],e.prototype,"bevelRatio",void 0);f([a.property({json:{read:{reader:function(a){return a?a.map(function(a){return d.fromJSON(a)}):null}},write:{writer:function(a,b){b.geometries=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries",void 0);f([a.property({type:Number,
json:{write:!0}})],e.prototype,"offsetDistance",void 0);f([a.property({type:String,json:{write:!0}})],e.prototype,"offsetHow",void 0);f([a.property({type:String,json:{write:!0}})],e.prototype,"offsetUnit",void 0);return e=f([a.subclass("esri.tasks.support.OffsetParameters")],e)}(a.declared(h.JSONSupport));q.from=e.default(q);return q})},"esri/tasks/support/ProjectParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/jsonUtils".split(" "),
function(q,b,l,f,h,a,e,d){var k=a.getLogger("esri.tasks.support.ProjectParameters");return function(a){function b(b){b=a.call(this,b)||this;b.geometries=null;b.outSpatialReference=null;b.transformation=null;b.transformForward=null;return b}l(b,a);Object.defineProperty(b.prototype,"outSR",{get:function(){k.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(a){k.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");
this.outSpatialReference=a},enumerable:!0,configurable:!0});b.prototype.toJSON=function(){var a=this.geometries.map(function(a){return a.toJSON()}),b=this.geometries[0],c={};c.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());c.inSR=b.spatialReference.wkid||JSON.stringify(b.spatialReference.toJSON());c.geometries=JSON.stringify({geometryType:d.getJsonType(b),geometries:a});this.transformation&&(c.transformation=this.transformation.wkid||JSON.stringify(this.transformation));
null!=this.transformForward&&(c.transformForward=this.transformForward);return c};f([e.property()],b.prototype,"geometries",void 0);f([e.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);f([e.property({json:{read:!1}})],b.prototype,"outSR",null);f([e.property()],b.prototype,"transformation",void 0);f([e.property()],b.prototype,"transformForward",void 0);return b=f([e.subclass("esri.tasks.support.ProjectParameters")],b)}(e.declared(h.JSONSupport))})},"esri/tasks/support/RelationParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(q,b,l,f,h,a,e,d){q=function(b){function e(a){a=b.call(this,a)||this;a.geometries1=null;a.geometries2=null;a.relation=null;a.relationParameter=null;return a}l(e,b);f([a.property({json:{read:{reader:function(a){return a?a.map(function(a){return d.fromJSON(a)}):null}},write:{writer:function(a,b){b.geometries1=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries1",void 0);f([a.property({json:{read:{reader:function(a){return a?a.map(function(a){return d.fromJSON(a)}):null}},write:{writer:function(a,
b){b.geometries2=a.map(function(a){return a.toJSON()})}}}})],e.prototype,"geometries2",void 0);f([a.property({type:String,json:{write:!0}})],e.prototype,"relation",void 0);f([a.property({type:String,json:{write:!0}})],e.prototype,"relationParameter",void 0);return e=f([a.subclass("esri.tasks.support.RelationParameters")],e)}(a.declared(h.JSONSupport));q.from=e.default(q);return q})},"esri/tasks/support/TrimExtendParameters":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils".split(" "),
function(q,b,l,f,h,a,e,d,k){q=function(a){function b(b){b=a.call(this,b)||this;b.extendHow="default-curve-extension";b.polylines=null;b.trimExtendTo=null;return b}l(b,a);f([e.property({type:String,json:{write:!0}})],b.prototype,"extendHow",void 0);f([e.property({type:[h.Polyline],json:{read:{reader:function(a){return a?a.map(function(a){return k.fromJSON(a)}):null}},write:{writer:function(a,b){b.polylines=a.map(function(a){return a.toJSON()})}}}})],b.prototype,"polylines",void 0);f([e.property({json:{read:{reader:function(a){return a?
k.fromJSON(a):null}},write:{writer:function(a,b){b.trimExtendTo=a.toJSON()}}}})],b.prototype,"trimExtendTo",void 0);return b=f([e.subclass("esri.tasks.support.TrimExtendParameters")],b)}(e.declared(a.JSONSupport));q.from=d.default(q);return q})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){var e=
function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.minTotalNumberOfFeatures=2E3;a.maxTotalNumberOfFeatures=5E4;a.maxTotalNumberOfPrimitives=17E5;a.polygonLodFactor=1;a.polylineLodFactor=1;return a}l(c,b);f([a.property()],c.prototype,"minTotalNumberOfFeatures",void 0);f([a.property()],c.prototype,"maxTotalNumberOfFeatures",void 0);f([a.property()],c.prototype,"maxTotalNumberOfPrimitives",void 0);f([a.property()],c.prototype,"polygonLodFactor",void 0);f([a.property()],c.prototype,
"polylineLodFactor",void 0);return c=f([a.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],c)}(a.declared(h)),d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.lodFactor=1;return a}l(c,b);f([a.property()],c.prototype,"lodFactor",void 0);return c=f([a.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c)}(a.declared(h)),k=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a["3dObject"]=new d;a.point=new d;a.integratedMesh=
new d;a.pointCloud=new d;a.uncompressedTextureDownsamplingEnabled=!1;return a}l(c,b);f([a.property({type:d})],c.prototype,"3dObject",void 0);f([a.property({type:d})],c.prototype,"point",void 0);f([a.property({type:d})],c.prototype,"integratedMesh",void 0);f([a.property({type:d})],c.prototype,"pointCloud",void 0);f([a.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=f([a.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c)}(a.declared(h)),n=function(b){function c(){var a=
null!==b&&b.apply(this,arguments)||this;a.lodBias=0;a.angledSplitBias=1;a.reduceTileLevelDifferences=!0;a.textureBlendTime=500;return a}l(c,b);f([a.property()],c.prototype,"lodBias",void 0);f([a.property()],c.prototype,"angledSplitBias",void 0);f([a.property()],c.prototype,"reduceTileLevelDifferences",void 0);f([a.property()],c.prototype,"textureBlendTime",void 0);return c=f([a.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c)}(a.declared(h));return function(b){function c(){var a=
null!==b&&b.apply(this,arguments)||this;a.graphics3D=new e;a.sceneService=new k;a.tiledSurface=new n;a.antialiasingEnabled=!0;return a}l(c,b);f([a.property({type:e})],c.prototype,"graphics3D",void 0);f([a.property({type:k})],c.prototype,"sceneService",void 0);f([a.property({type:n})],c.prototype,"tiledSurface",void 0);f([a.property()],c.prototype,"antialiasingEnabled",void 0);f([a.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);f([a.property()],c.prototype,"memoryLimit",void 0);
f([a.property()],c.prototype,"additionalCacheMemory",void 0);f([a.property()],c.prototype,"frameRate",void 0);f([a.property()],c.prototype,"maximumRenderResolution",void 0);f([a.property()],c.prototype,"maximumPixelRatio",void 0);return c=f([a.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)}(a.declared(h))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c,d){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this.tmpCoordinateSystem=p.create(d)}Object.defineProperty(b.prototype,"extent",{set:function(a){a&&p.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});b.prototype.getAltitude=function(a){return p.altitudeAt(this.coordinateSystem,a)};b.prototype.setAltitude=function(a,
b){p.setAltitudeAt(this.coordinateSystem,b,a,b)};b.prototype.setAltitudeOfTransformation=function(a,b){p.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};b.prototype.worldUpAtPosition=function(a,b){return p.normalAt(this.coordinateSystem,a,b)};b.prototype.worldBasisAtPosition=function(a,b,c){return p.axisAt(this.coordinateSystem,a,b,c)};b.prototype.basisMatrixAtPosition=function(b,c){var d=this.worldBasisAtPosition(b,0,r.sv3d.get()),e=this.worldBasisAtPosition(b,1,r.sv3d.get());b=this.worldBasisAtPosition(b,
2,r.sv3d.get());a.mat4.set(c,d[0],d[1],d[2],0,e[0],e[1],e[2],0,b[0],b[1],b[2],0,0,0,0,1);return c};b.prototype.intersectManifoldClosestSilhouette=function(a,b,c){p.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);p.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,c);return c};b.prototype.intersectManifold=function(a,b,c){p.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=r.sv3d.get();return p.intersectRay(this.tmpCoordinateSystem,a,b)?(e.vec3.copy(c,b),!0):!1};b.prototype.intersectInfiniteManifold=
function(a,b,d){if("global"===this.type)return this.intersectManifold(a,b,d);p.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=this.tmpCoordinateSystem.value;var g=r.sv3d.get();return c.plane.intersectRay(b.plane,a,g)?(e.vec3.copy(d,g),!0):!1};b.prototype.toRenderCoords=function(a,b,c){return k.isPoint(a)?g.pointToVector(a,b,this.spatialReference):g.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=function(a,b,c){return k.isPoint(b)?g.vectorToPoint(a,this.spatialReference,
b,c):b instanceof d?g.vectorToPoint(a,this.spatialReference,b):g.vectorToVector(a,this.spatialReference,b,c)};b.createGlobal=function(a){var d=p.fromValues(c.sphere,c.sphere.fromValues(n.earthRadius,[0,0,0]));return new b("global",a,1,d)};b.createLocal=function(a){var d=p.fromValues(c.boundedPlane,c.boundedPlane.fromValues([0,0,0],[u,0,0],[0,u,0])),e=h.getMetersPerUnitForSR(a);return new b("local",a,e,d)};b.createMode=function(a,c){switch(a){case "local":return b.createLocal(c);case "global":return b.createGlobal(c);
default:f.neverReached(a)}};return b}();b.RenderCoordsHelper=q;var u=Math.pow(2,50)})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=
null;this.viewState=b.viewState;this.stage=b.stage;this.pointsOfInterest=b.pointsOfInterest;this.resourceController=b.resourceController;this.streamDataRequester=this.resourceController.createStreamDataRequester(3);this.textures=new h.default(this.streamDataRequester,b.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=a.getSettings(b.viewingMode);this.screenSizePerspectiveSettingsLabels=a.getLabelSettings(b.viewingMode)}b.prototype.destroy=function(){this.textures.destroy();
this.streamDataRequester=this.textures=null};b.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),l.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};b.prototype.updateScreenSizePerspectiveEnabled=function(){var a=
this,b=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new f,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",b,!0),this.viewState.events.on("camera-projection-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),
this.screenSizePerspectiveHandles=null)};b.prototype.updateScreenSizePerspectiveSettings=function(){e.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;e.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(e);this.screenSizePerspectiveSettingsLabels.update(e);this.stage.renderView.setNeedsRender()};return b}();b.SharedSymbolResources=q;var e={distance:0,fovY:0};b.default=q})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/lib/Texture".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c,e){void 0===e&&(e=d.schedule);this._streamDataRequester=a;this._stage=b;this._textureOptions=c;this._schedule=e;this._textureRequests=new Map}b.prototype.destroy=function(){var a=this;this._textureRequests.forEach(function(b){return a.releaseTextureRequest(b)});this._textureRequests=null};b.prototype.fromUrl=function(b,c,d){return h(this,void 0,void 0,function(){var g,k,h,p,n,m=this;return f(this,
function(f){e.throwIfAborted(d);g=a.isSome(d)&&d.signal;k=this.makeUid(b,c);h=this._textureRequests.get(k);h||(p=e.createAbortController(),n=this._streamDataRequester.request(b,"image",{uid:k,signal:p.signal}),h={referenceCount:0,texture:null,textureAsync:null,abortController:p},this._textureRequests.set(k,h),h.textureAsync=n.then(function(a){a=m.createTexture(b,a,c);h.texture=a;h.abortController=null;m.addToStage(a);return{uid:k,texture:a}},function(a){h.abortController=null;throw a;}));h.referenceCount++;
return[2,e.create(function(a,b){e.onAbort(g,function(){b(e.createAbortError())});h.textureAsync.then(a,b)}).catch(function(a){m.release(k);throw a;})]})})};b.prototype.fromData=function(a,b){a=this.makeUid(a);var c=this._textureRequests.get(a);c||(c={referenceCount:0,texture:b(),textureAsync:null,abortController:null},this.addToStage(c.texture),this._textureRequests.set(a,c));c.referenceCount++;return{uid:a,texture:c.texture}};b.prototype.release=function(a){var b=this;if(this._textureRequests){var c=
this._textureRequests.get(a);c?(1>c.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),c.referenceCount--,1>c.referenceCount&&this._schedule(function(){return b.releaseNow(a)})):console.warn("TextureCollection: texture doesn't exist: '"+a+"'")}};Object.defineProperty(b.prototype,"test",{get:function(){return{textureRequests:this._textureRequests}},enumerable:!0,configurable:!0});b.prototype.releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);
!b||0<b.referenceCount||(this.releaseTextureRequest(b),this._textureRequests.delete(a))}};b.prototype.releaseTextureRequest=function(a){a.texture?this.removeFromStage(a.texture):a.abortController&&(a.abortController.abort(),a.abortController=null)};b.prototype.createTexture=function(a,b,c){k.isSVG(a)&&(c||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,c=c||64,1<a?(b.width=Math.round(c/a),b.height=c):(b.width=c,b.height=Math.round(c*a)));c=l({},this._textureOptions,{width:b.width,height:b.height,
powerOfTwoResizeMode:2});return new n(b,"symbol",c)};b.prototype.addToStage=function(a){this._stage.add(4,a)};b.prototype.removeFromStage=function(a){this._stage.remove(4,a.id)};b.prototype.makeUid=function(a,b){return null!=b?a+"."+b+"px":a};return b}();b.TextureCollection=q;b.default=q})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b){b=a.call(this,b)||this;b.handles=new e;b.surfaceAltitudeAtCenter=0;b.surfaceAltitudeAtCenterDirty=!0;b.surfaceAltitudeAtCenterWithContent=0;b.surfaceAltitudeAtCenterWithContentDirty=!0;b.propertiesPool=new g.PropertiesPool({renderPointOfView:C},b);b.renderPointOfView=c.vec3f64.create();return b}l(b,a);b.prototype.initialize=function(){var a=this,b=this.view,c=b.state,
e=b.basemapTerrain,g=b.renderCoordsHelper,b=b.map;this.surfaceIntersector=new w(c.mode);this.surfaceIntersector.options.backfacesTerrain=c.isGlobal?!1:!0;this.surfaceIntersector.options.invisibleTerrain=!1;this.contentIntersector=new w(c.mode);this.contentIntersectorOptions={exclude:d.createSetFromValues([A.TERRAIN_ID])};var f=function(){return a.estimateSurfaceAltitudeAtCenter()},k={state:c,scheduler:this.view.resourceController.scheduler,surface:e,renderCoordsHelper:g};this._set("centerOnSurfaceInfrequent",
new u.default(h({},k,{task:B.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnSurfaceFrequent",new u.default(h({},k,{task:B.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:f})));this._set("centerOnContent",new u.default(h({},k,{task:B.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:function(){return a.estimateSurfaceAltitudeAtCenterWithContent()}})));this._set("cameraOnSurface",new p.default(h({},k,{task:B.Task.POINT_OF_INTEREST_INFREQUENT,
map:b})));this._set("surfaceGeometryUpdates",new m.default(h({},k,{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})));this._set("contentGeometryUpdates",new t.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:g}));this._set("surfaceOrigin",new y.default({view:this.view}));this._set("focus",new v.default({state:c,surface:e,renderCoordsHelper:g,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add([c.watch("camera",
function(b){return a.cameraChanged(b)},!0),e.watch("extent",function(){return a.updateCenterPointsOfInterest()}),this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}),this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()})]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};
b.prototype.destroy=function(){x.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(b.prototype,"updating",{get:function(){return!!(this.surfaceGeometryUpdates&&this.surfaceGeometryUpdates.updating||this.centerOnContent&&this.centerOnContent.updating||this.centerOnSurfaceInfrequent&&this.centerOnSurfaceInfrequent.updating||this.centerOnSurfaceFrequent&&this.centerOnSurfaceFrequent.updating||
this.cameraOnSurface&&this.cameraOnSurface.updating||this.focus&&this.focus.updating)},enumerable:!0,configurable:!0});b.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,G);this.view.sceneIntersectionHelper.intersectRay(a,this.contentIntersector,E,
this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(E):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(a);return this.surfaceAltitudeAtCenterWithContent};b.prototype.estimateSurfaceAltitudeAtCenter=function(a){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var b=this.view.state.camera;a||(a=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(b,
G));var c=a.origin,d=n.vec3.add(E,a.origin,a.direction);this.surfaceIntersector.resetWithRay(a);this.surfaceIntersector.intersect(null,null,b);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,c,d);this.surfaceIntersector.results.min.getIntersectionPoint(E)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(E));return this.surfaceAltitudeAtCenter};b.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest();a=a.eye;n.vec3.exactEquals(this.renderPointOfView,
a)||this._set("renderPointOfView",n.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};b.prototype.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();this.focus.updateRenderLocation();this.centerOnContent.updateRenderLocation()};b.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=
!0;this.centerOnContent.updateRenderLocation()};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{update:function(){a.surfaceGeometryUpdates.update();a.centerOnSurfaceFrequent.update();a.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}},enumerable:!0,configurable:!0});f([k.property({readOnly:!0})],b.prototype,"centerOnContent",void 0);f([k.property({readOnly:!0})],b.prototype,"centerOnSurfaceFrequent",void 0);f([k.property({readOnly:!0})],
b.prototype,"centerOnSurfaceInfrequent",void 0);f([k.property({readOnly:!0})],b.prototype,"cameraOnSurface",void 0);f([k.property({readOnly:!0})],b.prototype,"focus",void 0);f([k.property({readOnly:!0})],b.prototype,"renderPointOfView",void 0);f([k.property({readOnly:!0})],b.prototype,"surfaceOrigin",void 0);f([k.property({readOnly:!0})],b.prototype,"contentGeometryUpdates",void 0);f([k.property({readOnly:!0})],b.prototype,"surfaceGeometryUpdates",void 0);f([k.property({constructOnly:!0})],b.prototype,
"view",void 0);f([k.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],b.prototype,"updating",null);return b=f([k.subclass("esri.views.3d.support.PointsOfInterest")],b)}(k.declared(a));b.PointsOfInterest=q;var C=Array,E=c.vec3f64.create(),G=r.create();b.default=q})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});var r=Array;q=function(b){function g(a){a=b.call(this,a)||this;a._dirty=!1;a._propertiesPool=new c.default({location:n,renderLocation:r},a);a._estimatedSurfaceAltitude=0;a._pendingElevationQueryController=null;a.renderLocation=k.vec3f64.create();return a}l(g,b);g.prototype.initialize=function(){var b=this;this.handles.add(this.scheduler.registerTask(this.task,function(){return b._measureSurfaceAltitude()},function(){return b._needsUpdate()}));
this._measureSurfaceAltitude();if(this.map){var c=function(){return b._setDirty()};this.handles.add([a.on(this.map,"ground.layers","change",c,c,c)])}};g.prototype.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};Object.defineProperty(g.prototype,"location",{get:function(){var a=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"updating",{get:function(){return this._dirty||null!=this._pendingElevationQueryController},enumerable:!0,configurable:!0});g.prototype.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};g.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};g.prototype._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};g.prototype._needsUpdate=function(){return!this._pendingElevationQueryController&&
this._dirty};g.prototype._cancelPendingRequest=function(){var a=this._pendingElevationQueryController;a&&(this._pendingElevationQueryController=null,a.abort(),this.notifyChange("updating"))};g.prototype._measureSurfaceAltitude=function(){var a=this;this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,u,this.state.spatialReference);var b=h.createAbortController();this.map.ground.queryElevation(u,
{signal:b.signal}).then(function(b){return a._updateSurfaceAltitude(b.geometry.z)}).catch(function(b){h.isAbortError(b)||a._updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a._pendingElevationQueryController===b&&(a._pendingElevationQueryController=null,a.notifyChange("updating"));b=null});this._pendingElevationQueryController=b}else this._updateSurfaceAltitude(0)};g.prototype._updateSurfaceAltitude=function(a){this._estimatedSurfaceAltitude!==a&&(this._estimatedSurfaceAltitude=a,this._updateRenderLocation())};
g.prototype._updateRenderLocation=function(){d.vec3.copy(p,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,p);d.vec3.exactEquals(this._get("renderLocation"),p)||this._set("renderLocation",d.vec3.copy(this._propertiesPool.get("renderLocation"),p))};f([e.property({constructOnly:!0})],g.prototype,"scheduler",void 0);f([e.property({constructOnly:!0})],g.prototype,"task",void 0);f([e.property({readOnly:!0,dependsOn:["renderLocation"]})],g.prototype,"location",
null);f([e.property({constructOnly:!0})],g.prototype,"map",void 0);f([e.property({readOnly:!0})],g.prototype,"renderLocation",void 0);f([e.property({readOnly:!0})],g.prototype,"updating",null);return g=f([e.subclass("esri.views.3d.support.CameraOnSurface")],g)}(e.declared(g.PointOfInterest));b.CameraOnSurface=q;var p=k.vec3f64.create(),u=new n;b.default=q})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function k(c){c=b.call(this,c)||this;c.handles=new a;return c}l(k,b);k.prototype.destroy=function(){d.default(this,"handles")};f([e.property({constructOnly:!0})],k.prototype,"renderCoordsHelper",void 0);f([e.property({constructOnly:!0})],k.prototype,"surface",void 0);f([e.property({constructOnly:!0})],k.prototype,"state",void 0);return k=f([e.subclass("esri.views.3d.support.PointOfInterest")],k)}(e.declared(h));
b.PointOfInterest=q;b.default=q})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(q,b,l){function f(b){for(var a=[],e=1;e<arguments.length;e++)a[e-1]=arguments[e];if(b instanceof l&&b.destroyed)try{throw Error("instance is already destroyed");}catch(n){console.warn(n.stack)}else for(e=0;e<a.length;e++){var d=a[e];if(!(d in b))throw Error("Property '"+d+"' does not exist and cannot be disposed");var f=b[d];f&&("function"===
typeof f.destroy?f.destroy():"function"===typeof f.dispose?f.dispose():"function"===typeof f.remove&&f.remove());b instanceof l&&d in b.__accessor__.metadatas?b._set(d,null):b[d]=null}}Object.defineProperty(b,"__esModule",{value:!0});b.disposeMembers=f;b.default=f})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;q=function(b){function r(a){a=b.call(this,a)||this;a.propertiesPool=new g.default({location:k,renderLocation:p},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=d.vec3f64.create();a.updating=!1;return a}l(r,b);r.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(this.task,function(){return a._measureSurfaceAltitude()},function(){return a.updating});
this._measureSurfaceAltitude()};r.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(r.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});r.prototype.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};
r.prototype.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};Object.defineProperty(r.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});r.prototype._measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this._set("updating",!1)};r.prototype._updateRenderLocation=function(){var a=t,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,
a),c=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=x;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(e.vec3.copy(a,c),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=e.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,e.vec3.scale(a,b.viewForward,this._get("distance")),
e.vec3.add(a,a,b.eye));e.vec3.exactEquals(this._get("renderLocation"),a)||this._set("renderLocation",e.vec3.copy(this.propertiesPool.get("renderLocation"),a))};r.prototype.calculateSurfaceIntersection=function(a,b){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.ray,a,b))return!1;if(this.state.isGlobal){a=c.earthRadius+a;var g=e.vec3.squaredLength(d.eye),f=g<a*a,k=e.vec3.distance(d.eye,b);f&&k>c.earthRadius/4&&(e.vec3.scale(b,d.viewForward,a-Math.sqrt(g)),e.vec3.add(b,b,d.eye))}else if(d=
this.surface.ready&&this.surface.extent)b[0]=h.clamp(b[0],d[0],d[2]),b[1]=h.clamp(b[1],d[1],d[3]);return!0};r.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=e.vec3.distance(c,a);b=e.vec3.distance(c,b);if(n.TESTS_DISABLE_UPDATE_THRESHOLDS||Math.abs(b-a)/a>u)return!0}return!1};f([a.property({constructOnly:!0})],
r.prototype,"scheduler",void 0);f([a.property({constructOnly:!0})],r.prototype,"task",void 0);f([a.property({readOnly:!0})],r.prototype,"distance",void 0);f([a.property({constructOnly:!0})],r.prototype,"estimateSurfaceAltitudeAtCenter",void 0);f([a.property({readOnly:!0,dependsOn:["renderLocation"]})],r.prototype,"location",null);f([a.property({readOnly:!0})],r.prototype,"renderLocation",void 0);f([a.property({readOnly:!0})],r.prototype,"updating",void 0);return r=f([a.subclass("esri.views.3d.support.CenterOnSurface")],
r)}(a.declared(r.PointOfInterest));b.CenterOnSurface=q;var u=.05,t=d.vec3f64.create(),x=d.vec3f64.create();b.default=q})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Evented","../../../../core/Handles"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a){var b=this;this.handles=new f;this.events=new l;this.contentLayerViews=a.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",
function(a){return b.layerViewsChanged(a)}));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",function(){return b.contentChanged()}),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};
a.prototype.contentChanged=function(){this.events.emit("request-update",h)};return a}();b.ContentGeometryUpdates=q;var h={};b.default=q})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});var p=Array;q=function(b){function k(a){a=b.call(this,a)||this;a.propertiesPool=new g.default({locationOnSurface:n,renderLocationOnSurface:p},a);a.centerOnSurface=null;return a}l(k,b);k.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(k.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,b=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(v);d.vec3.subtract(u,a,this.state.camera.eye);d.vec3.normalize(u,u);b.worldUpAtPosition(a,t);var e=Math.abs(Math.acos(d.vec3.dot(t,u))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),e=1-h.clamp(e/(.5*Math.PI),0,1);d.vec3.lerp(b,
a,c,e*e*e);return b},enumerable:!0,configurable:!0});k.prototype.calculateScreenHorizontalEdgeOnSurface=function(b){var e=this.state.camera,g=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),f=this.renderCoordsHelper.getAltitude(e.eye)>=g,k=e.getRenderCenter(a.createRenderScreenPointArray3());k[1]=f?e.padding[2]:e.fullHeight-e.padding[0];e.unprojectPoint(k,x);d.vec3.subtract(x,x,e.eye);f=d.vec3.normalize(x,x);if(this.renderCoordsHelper.intersectManifold(c.ray.wrap(e.eye,f),
g,b))return b;d.vec3.copy(b,e.eye);this.renderCoordsHelper.setAltitude(g,b);return b};k.prototype.updateRenderLocation=function(){};f([e.property({constructOnly:!0})],k.prototype,"centerOnSurface",void 0);f([e.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],k.prototype,"locationOnSurface",null);f([e.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],k.prototype,"renderLocationOnSurface",null);f([e.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],k.prototype,
"updating",void 0);return k=f([e.subclass("esri.views.3d.support.CenterOnSurface")],k)}(e.declared(r.PointOfInterest));b.Focus=q;var u=k.vec3f64.create(),t=k.vec3f64.create(),x=k.vec3f64.create(),v=k.vec3f64.create();b.default=q})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c){c=b.call(this,c)||this;c.location=null;c._updateController=null;c._handles=new a;return c}l(h,b);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=n.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&
(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],function(){return a._update()}),d.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=g.center(this.surfaceView.extent),
b=new c({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=e.createAbortController(),this.surface.queryElevation(b,{noDataValue:0,signal:this._updateController.signal}).then(function(b){a._updateController=null;a._set("location",b.geometry)}).catch(function(a){e.isAbortError(a)||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):
this._set("location",b)}else this._set("location",null)};f([k.property({constructOnly:!0})],h.prototype,"view",void 0);f([k.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);f([k.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);f([k.property({readOnly:!0})],h.prototype,"location",void 0);f([k.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=f([k.subclass("esri.views.3d.terrain.StableSurfaceCenter")],
h)}(k.declared(h));b.StableSurfaceCenter=q;b.default=q})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/index".split(" "),function(q,b,
l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function k(){var c=null!==b&&b.apply(this,arguments)||this;c.handles=new e;c._tileGeometryUpdateExtent=n.empty();c._tileGeometryUpdateSpatialReference=null;c.events=new a;c.updating=!1;return c}f(k,b);k.prototype.initialize=function(){var a=this;this.handles.add([this.surface.on("elevation-change",function(b){return a._tileGeometryChanged(b)}),this.scheduler.registerTask(c.Task.SURFACE_GEOMETRY_UPDATES,function(){return a.update()},
function(){return a.updating})])};k.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};k.prototype.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",g),n.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};k.prototype._tileGeometryChanged=function(a){this._tileGeometryUpdateSpatialReference=a.spatialReference;n.expand(this._tileGeometryUpdateExtent,
a.tile.extent);this._set("updating",!0)};k.prototype._furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaces[0],b=1;b<this.centerOnSurfaces.length;b++){var c=this.centerOnSurfaces[b];c.distance>a.distance&&(a=c)}return a};k.prototype._centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,d=u,e=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,r,b);this.renderCoordsHelper.fromRenderCoords(e.renderLocation,p,b);r[0]<p[0]?(d[0]=r[0],d[2]=p[0]):(d[0]=p[0],
d[2]=r[0]);r[1]<p[1]?(d[1]=r[1],d[3]=p[1]):(d[1]=p[1],d[3]=r[1]);return n.intersects(d,a)};l([d.property({constructOnly:!0})],k.prototype,"state",void 0);l([d.property({constructOnly:!0})],k.prototype,"centerOnSurfaces",void 0);l([d.property({constructOnly:!0})],k.prototype,"renderCoordsHelper",void 0);l([d.property({constructOnly:!0})],k.prototype,"scheduler",void 0);l([d.property({constructOnly:!0})],k.prototype,"surface",void 0);l([d.property({readOnly:!0})],k.prototype,"updating",void 0);return k=
l([d.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],k)}(d.declared(h));b.SurfaceGeometryUpdates=q;var g={},r=k.vec3f64.create(),p=k.vec3f64.create(),u=n.empty();b.default=q})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../../../layers/support/TilemapCache ../../2d/engine/vectorTiles/VectorTile ../layers/ElevationLayerView3D ../support/debugFlags ../support/geometryUtils ../support/projectionUtils ../support/StreamDataLoader ./ElevationBounds ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./Tile ./TilemapOnlyTile ./TileTexture ./tileUtils ./tileUtils ./UpsampleInfo ../../support/index ../../webgl/Util @dojo/framework/shim/Promise".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca,U,ea,ha,ka,ba,qa,ja,la,ma){function ta(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function ua(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var g=0;g<e.layerInfo.length;g++)for(var f=0,k=e.layerInfo[g];f<k.length;f++){var h=k[f].upsampleInfo;if(h&&h.tile===b)return!0}c=c||ua(e,b)}}return c}function sa(a){return a.isLeaf?!1:a.children[0].shouldRender||a.children[1].shouldRender||
a.children[2].shouldRender||a.children[3].shouldRender||sa(a.children[0])||sa(a.children[1])||sa(a.children[2])||sa(a.children[3])}var xa=g.getLogger("esri.views.3d.terrain.TerrainSurface");b=function(b){function e(a){a=b.call(this,a)||this;a.defaultTileBackground=F.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=ra;a.hideSkirtsMinimumCameraTilt=oa;a.hideSkirtsMaximumCameraTilt=pa;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=new O.ElevationBounds;a._rootExtent=G.create();
a._iteratorPool=new u(qa.IteratorPreorder);a._postorderIterator=new qa.IteratorPostorder;a._visible=!1;a._pendingUpdates=!1;a._asyncWorkItems=0;a._usedMemory=ia;a._isFrameProcessing=!1;a._viewChangeUpdateDirty=!1;a._overlayOpacity=1;a._eyePosRenderSR=C.vec3f64.create();a._eyePosSurfaceSR=C.vec3f64.create();a._splitLimits=new ea.SplitLimits;a._snapLevel=Infinity;a._frustum=P.frustum.create();a._viewProjectionMatrix=A.mat4f64.create();a._layerViews=[[],[]];a._layerIndexByLayerViewId=[new Map,new Map];
a._basemapLayerViewHandles=new Map;a._handles=new c;a._allTiles=new t;a._topLevelTilemapOnlyTiles=[];a._upsampleInfoPool=new u(ja);a._visibleLevels=new t({deallocator:null});a._getElevationData={spatialReference:null,rootTiles:null};a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=F.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;a._scheduledLayerViewChangesHandle=null;return a}f(e,b);e.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._lercWorker=J.acquireInstance(this.view.resourceController.scheduler);
this._tilePool="planar"===this.manifold?new u(Z.PlanarPatch):new u(W.SphericalPatch);this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",function(a){return a.unloadMapData()});this._set("overlayManager",new N.OverlayManager({terrainSurface:this,view:this.view}));this._handles.add(this.watch("overlayManager.hasHighlights",function(b){return a._handleHasHighlights(b)}),"overlayManager");this._renderer=new ca({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer});
this._renderer.install(this.view._stage);y.init(this,"_background",function(){a._renderer.setTileBackground(a._background)},!0);this._handles.add([this.view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}),y.whenTrue(L,"TERRAIN_DEBUG_POPUP",function(){(new Promise(function(a,b){q(["./support/TerrainDebugPopupOpener"],a,b)})).then(function(b){var c=new b.TerrainDebugPopupOpener({surface:a});y.whenFalseOnce(L,"TERRAIN_DEBUG_POPUP",function(){return c.destroy()})})})]);var b={layers:this.view.map.allLayers,
layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new aa.SurfaceExtentHelperGlobal(b):new aa.SurfaceExtentHelperLocal(b);this._handles.add(y.init(this.extentHelper,"stencilEnabledExtents",function(b){return a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this.view.defaultsFromMap?new k({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):
this.view.map.allLayers;b=new V({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",function(){return a._updateTilingSchemeAndExtent()},!0),this.tilingSchemeLogic.watch("extent",function(){return a._updateTilingSchemeAndExtent()},!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._handles.add(this.view.resourceController.scheduler.registerTask(la.Task.TERRAIN_SURFACE,function(b){return a._frame(b)},function(){return a.updating}));this.view.resourceController.memoryController.events.on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this.view.on("resize",function(){return a._viewChangeUpdate()}),this.view.watch("state.camera",function(){return a._viewChangeUpdate()},
!0),this.view.watch("qualitySettings.tiledSurface.lodBias",function(){return a._viewChangeUpdate()}),y.init(this.view,"qualitySettings.tiledSurface.textureBlendTime",function(b){return a._renderer.blendingEnabled=0<b}),this.view.watch("lodSnapping",function(){return a._viewChangeUpdate()}),this.view.watch("clippingArea",function(){return a._clippingChanged()})]);this._handles.add(this.view.allLayerViews.on("after-changes",function(){return a._scheduleLayerViewChangesUpdate()}));this._handleLayerViewChanges();
this._updateClippingExtent();this.notifyChange("extent")};e.prototype.destroy=function(){var a=this;this._handles.destroy();J.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._upsampleMapCache.destroy();this._upsampleMapCache=null;this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;this._basemapLayerViewHandles.forEach(function(b,c){return a._unregisterTiledLayerView(c)});this._mapDataRequester=
this._elevationDataRequester=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;T.Pool.prune(0);Y.Pool.prune(0);this._renderer.uninstall(this._stage);this._renderer.destroy();this._renderer=null;this._iteratorPool.destroy();this._iteratorPool=null;this._set("view",null);this._stage=null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(e.prototype,"renderer",{get:function(){return this._renderer},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"snapLevel",{get:function(){return Math.round(this._snapLevel)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"upsampleMapCache",{get:function(){return this._upsampleMapCache},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return!(!(this._pendingUpdates||this._renderer.updating||this._scheduledLayerViewChangesHandle)||!this.ready||
this._get("suspended"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"baseOpacity",{set:function(a){var b=this._renderer.opaque;this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(b!==this._renderer.opaque)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",
a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_background",{get:function(){return null!=this.backgroundColor?
this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlane=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"visible",{set:function(a){a!==this._visible&&(this._visible=a,this._renderer.setVisibility(a),this.suspended=!a)},enumerable:!0,configurable:!0});e.prototype.isOpaque=function(){return this._renderer.opaque};Object.defineProperty(e.prototype,"suspended",{set:function(a){this._set("suspended",a);this._viewChangeUpdate()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"lodSnapping",{get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?
0:1},enumerable:!0,configurable:!0});e.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d)};e.prototype.getElevation=function(a,b,c,d){var e=this._getElevationData.rootTiles;if(!e||!e.length||0===e[0].layerInfo[0].length)return null;var g=na;g[0]=a;g[1]=b;g[2]=c;if(!S.vectorToVector(g,d,g,this._getElevationData.spatialReference))return xa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(b=0;b<e.length;b++)if(a=e[b],
a.containsPoint(g)){for(;a&&!a.rendered&&!a.isLeaf;)e=0,g[0]>.5*(a.extent[0]+a.extent[2])&&(e+=1),g[1]<.5*(a.extent[1]+a.extent[3])&&(e+=2),a=a.children[e];if(e=(e=a.renderData)&&e.geometryState?e.geometryState.samplerData:null)return Q.ElevationData.sample(g[0],g[1],e);break}return null};Object.defineProperty(e.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});e.prototype.getScale=function(a){if(this.tilingScheme){if(!S.pointToVector(a,na,this.spatialReference))return xa.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;var b=this.rootTiles;if(b)for(var c=0;c<b.length;c++)if(a=b[c],a.containsPoint(na)){for(;null!=a.children[0];)b=0,na[0]>a.children[0].extent[2]&&(b+=1),na[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.level)}}return 1E100};e.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this.lodBias;this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};e.prototype._updateTilingSchemeAndExtent=
function(){var a=this.tilingSchemeLogic.extent,b=a&&!G.equals(a,this._dataExtent);b&&(this._dataExtent?G.set(this._dataExtent,a):this._dataExtent=G.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(U.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize),this.overlayManager.setSpatialReference(a.spatialReference,
"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};e.prototype._acquireTile=function(a,b,c,d){var e=this._tilePool.acquire();da[0]=a;da[1]=b;da[2]=c;e.init(da,d,this);return e};e.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var e=ya,g=c.rootTilesInExtent(b,e,5*F.MAX_ROOT_TILES),f=function(b){b=a._acquireTile(0,b[1],b[2],null);1===b.shouldSplit(a._splitLimits,a._eyePosRenderSR,a.lodSnapping)&&b.setPendingUpdate(1);
a._loadTile(b);return b};if(this.rootTiles){if(g.length>F.MAX_ROOT_TILES){xa.warn(F.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),k=d.difference(b,g,ta);if(0<k.removed.length||0<k.added.length){var h=this.rootTiles.filter(function(b){return-1<d.findIndex(k.removed,ta.bind(null,b.lij))?(a._purgeTile(b),!1):!0});k.added.forEach(function(a){return h.push(f(a))});this._setRootTiles(h)}}else g.length>F.MAX_ROOT_TILES&&(xa.warn(F.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),
g=c.rootTilesInExtent(b,e,F.MAX_ROOT_TILES)),this._setRootTiles(g.map(function(a){return f(a)}));G.equals(e,this._rootExtent)||(this._rootExtent=G.create(e),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};e.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._allTiles.clear();a&&this._allTiles.pushArray(a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles);
this._updateTiles(a)};e.prototype._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};e.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._isFrameProcessing?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),this.updateOverlayOpacity(),this._updateTiles(this.rootTiles)))};e.prototype._updateClippingStatus=
function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(16)&&this._updateTileGeometry(a)};e.prototype._updateTiles=function(a){if(a){var b=this._iteratorPool.acquire();b.reset(a);var c;ba.hasVisibleSiblings(a)?(a=this._elevationBounds.min,c=this._elevationBounds.max):(a=Infinity,c=-Infinity);for(;!b.done;){var d=b.next();this._updateClippingStatus(d);d.updateVisibility();d.setPendingUpdate(8);if(d.visible){d.updateScreenDepth(this._viewProjectionMatrix);d.renderData&&(a=Math.min(d.elevationBounds[0],
a),c=Math.max(d.elevationBounds[1],c));var e=d.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(1===e){d.resetPendingUpdate(4);d.isLeaf&&(d.setPendingUpdate(1),b.skipSubtree());this._pendingUpdates=this._pendingUpdates||d.updating;continue}d.resetPendingUpdate(1)&&d.updateAgentSuspension();2===e&&d.updateAgents(0)}b.skipSubtree();if(!d.isLeaf){d.setPendingUpdate(4);d.resetPendingUpdate(1);e=this._iteratorPool.acquire();for(e.resetOne(d);!e.done;){var g=e.next();this._updateClippingStatus(g);
g.updateVisibility();g.visible&&g.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(e)}this._pendingUpdates=this._pendingUpdates||d.updating}this._iteratorPool.release(b);isFinite(a)&&isFinite(c)&&(this._elevationBounds.min!==a||this._elevationBounds.max!==c)&&(this._elevationBounds.min=a,this._elevationBounds.max=c,this.emit("elevation-bounds-change",null))}};e.prototype._updateViewDependentParameters=function(){var a=this.view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*
a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this.lodBias)*a.pixelRatio;this._splitLimits.aboveGround=a.aboveGround;this._splitLimits.fovX=b;this._splitLimits.fovY=c;this._splitLimits.relativeWidthLimit=d/a.width*this.maxTextureScale*e;this._splitLimits.relativeHeightLimit=d/a.height*this.maxTextureScale*e;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;P.frustum.copy(a.frustum,this._frustum);w.mat4.multiply(this._viewProjectionMatrix,
a.projectionMatrix,a.viewMatrix);B.vec3.copy(this._eyePosRenderSR,a.eye);S.vectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};e.prototype._updateSnapLevel=function(){if(1!==this.lodSnapping){var a=L.TESTS_DISABLE_UPDATE_THRESHOLDS?0:.1,b=this._findSnapLevel();Math.abs(this._snapLevel-b)<a||(a=this.snapLevel,this._snapLevel=b,a!==this.snapLevel&&this._updateTiles(this.rootTiles))}};e.prototype._findSnapLevel=function(){if(0>=this._visibleLevels.length)return this._snapLevel;
var a=this._visibleLevels,b=Math.round(a.length*(Math.abs(this.view.camera.tilt-90)/90*.4+.3));if(b>=a.length)return this._snapLevel;a.sort(function(a,b){return a-b});for(var c=0,d=b;d<a.length;++d)c+=a.getItemAt(d);d=a.getItemAt(Math.round(.95*a.length)-1);return Math.max(c/(a.length-b),d-1)};e.prototype._updateSkirts=function(){var a=this.view.state.camera;U.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this.spatialReference,this.view.state.constraints.collision.enabled?0:1.11*a.near)};
e.prototype._updateRender=function(a){a.rendered&&!a.shouldRender&&(sa(a)?this._loadChildren(a):a.isLeaf&&a.parent&&a.parent.shouldRender&&this._loadParent(a))};e.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);this._elevationUpdate(a);this._usedMemory=ia};e.prototype._elevationUpdate=function(a){Ja.spatialReference=this.spatialReference;Ja.tile=a;Ja.extent=a.extent;this.emit("elevation-change",Ja);G.containsPoint(a.extent,this._eyePosSurfaceSR)&&
this._updateSkirts()};e.prototype._frame=function(a){var b=this;this._isFrameProcessing=!0;this._frameTraversal(a);a.run(function(){return b._processElevation(a)});a.run(function(){return b._processTextures(a)});0!==this._asyncWorkItems&&(this._pendingUpdates=!0);this._isFrameProcessing=!1;this._runViewChangeUpdateIfDirty();this.notifyChange("updating")};e.prototype._frameTraversal=function(a){var b=this;if(!this.suspended&&this._pendingUpdates){var c=this._eyePosRenderSR,d=0,e=!1;this._pendingUpdates=
!1;this._visibleLevels.clear();for(var g=function(){},f=0===this.lodSnapping?function(a){a.visible&&1!==a.shouldSplit(b._splitLimits,c,1)&&a.parent&&1===a.parent.shouldSplit(b._splitLimits,c,1)&&b._visibleLevels.push(a.level)}:g;!a.done;){var k=!this._allTiles.some(function(c){d+=c.usedMemory;f(c);c.resetPendingUpdate(4)?(b._mergeTile(c),e=!0,a.madeProgress()):c.resetPendingUpdate(1)&&(b._splitTile(c),e=!0,a.madeProgress());c.resetPendingUpdate(8)&&(b._updateRender(c),a.madeProgress());b._pendingUpdates=
b._pendingUpdates||c.updating;return a.done});this._pendingUpdates=this._pendingUpdates||!k;k&&f!==g&&this._updateSnapLevel();f=g;if(e)this._pendingUpdates=!0,e=!1,ba.sortTiles(this._renderer.renderOrder,this._allTiles);else if(k){this._usedMemory=d;break}}this._visibleLevels.clear()}};e.prototype._processElevation=function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(16)&&(b._updateTileGeometry(c),a.madeProgress());return a.done});return a.hasProgressed};e.prototype._processTextures=
function(a){var b=this;this._allTiles.some(function(c){c.resetPendingUpdate(32)&&(b._renderer.updateTileTexture(c),b._usedMemory=ia,a.madeProgress());return a.done});return a.hasProgressed};e.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=G.create(),b=null;S.extentToBoundingRect(this.view.clippingArea,a,this.spatialReference)&&(b=a);if(G.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this.updateTileOverlayParams();
this.overlayManager.setOverlayPlacementDirty();return!0};e.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Object.defineProperty(e.prototype,"lodBias",{get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*F.MAX_MEMORY_LOD_BIAS},enumerable:!0,configurable:!0});e.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=r.clamp(a-this.lodBias,0,b.length-
1);var c=a-Math.floor(a);return b[Math.floor(a)].scale*(1-c)+b[Math.ceil(a)].scale*c};e.prototype._cancelTilemapRequests=function(a){var b=0;for(a=a.layerInfo;b<a.length;b++){var c=a[b];if(c)for(var d=0;d<c.length;d++)c[d].abortTilemapRequest()}};e.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){return a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();for(var b=0,c=this._topLevelTilemapOnlyTiles;b<c.length;b++){var d=
c[b];p.isSome(d)&&this._cancelTilemapRequests(d)}this.visible=!1};e.prototype._purgeChildTiles=function(a){if(a.isLeaf)return!1;var b=this._purgeTile(a.children[0]),b=this._purgeTile(a.children[1])||b,b=this._purgeTile(a.children[2])||b,b=this._purgeTile(a.children[3])||b;a.unsetChildren();return b};e.prototype._purgeTile=function(a){var b=this._purgeChildTiles(a)||a.rendered;this._allTiles.removeUnordered(a);a.unload(this._renderer);this._cancelTilemapRequests(a);this._tilePool.release(a);return b};
e.prototype._splitTile=function(a){U.weakAssert(a.isLeaf,"tile that is already split should not be split again!");var b=a.level+1,c=2*a.lij[1],d=2*a.lij[2];a.setChildren(this._createTile(b,c,d,a),this._createTile(b,c,d+1,a),this._createTile(b,c+1,d,a),this._createTile(b,c+1,d+1,a));a.setPendingUpdate(8);a.updateAgentSuspension();this._allTiles.pushArray(a.children);Ma.spatialReference=this.spatialReference;Ma.extent=a.extent;Ma.scale=this._getLodBiasCorrectedScale(b);this._pendingUpdates=!0;this.emit("scale-change",
Ma);return a.children[0].hasPendingUpdate(1)||a.children[1].hasPendingUpdate(1)||a.children[2].hasPendingUpdate(1)||a.children[3].hasPendingUpdate(1)};e.prototype._createTile=function(a,b,c,d){U.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),1===a.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&a.setPendingUpdate(1));return a};e.prototype._mergeTile=
function(a){U.weakAssert(!a.hasPendingUpdate(1),"_mergeTile sanity check");this._purgeChildTiles(a)&&(U.weakAssert(!a.renderData,"_mergeTile sanity check"),this._loadTile(a));Ma.spatialReference=this.spatialReference;Ma.extent=a.extent;Ma.scale=this._getLodBiasCorrectedScale(a.level);this._pendingUpdates=!0;this.emit("scale-change",Ma)};e.prototype._loadChildren=function(a){U.weakAssert(a.rendered,"parent should be rendered");a.unload(this._renderer);this._loadTile(a.children[0]);this._loadTile(a.children[1]);
this._loadTile(a.children[2]);this._loadTile(a.children[3])};e.prototype._loadParent=function(a){a=a.parent;this._unloadChildren(a);this._loadTile(a)};e.prototype._unloadChildren=function(a){a.isLeaf||(this._unloadChildren(a.children[0]),a.children[0].unload(this._renderer),this._unloadChildren(a.children[1]),a.children[1].unload(this._renderer),this._unloadChildren(a.children[2]),a.children[2].unload(this._renderer),this._unloadChildren(a.children[3]),a.children[3].unload(this._renderer))};e.prototype._loadTile=
function(a){a.load(this._renderer);a.setPendingUpdate(8);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setTileParameters(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};e.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};e.prototype._elevationDataArrived=function(a,b,c){c=new Q.ElevationData(a.lij,a.extent,c);a.dataArrived(b,0,c);c=[a];a=a.level;var d=this._iteratorPool.acquire();for(d.reset(c);!d.done;){var e=d.next();e.findElevationBoundsForLayer(b,
a);e.computeElevationBounds()}this._iteratorPool.release(d);this._updateTiles(c)};e.prototype._scheduleLayerViewChangesUpdate=function(){var a=this;this._scheduledLayerViewChangesHandle||(this._scheduledLayerViewChangesHandle=v.schedule(function(){return a._handleLayerViewChanges()}),this._handles.add(this._scheduledLayerViewChangesHandle,"scheduledLayerViewChangesHandle"))};e.prototype._handleLayerViewChanges=function(){var a=this;this._handles.remove("scheduledLayerViewChangesHandle");this._scheduledLayerViewChangesHandle=
null;for(var b=!1,c=new Set,d=-1,e=0,g=this.view.allLayerViews.items;e<g.length;e++){var f=g[e];c.add(f.uid);if(U.isTiledLayerView(f))if(this._basemapLayerViewHandles.has(f.uid)){var k=this.layerClassFromLayerView(f),f=this._layerIndexByLayerViewId[k].get(f.uid);f<d&&(b=!0);d=f}else this._registerTiledLayerView(f),f.layer.loaded&&(b=!0)}this._basemapLayerViewHandles.forEach(function(d,e){c.has(e)||(a._unregisterTiledLayerView(e),b=!0)});this.overlayManager&&this.overlayManager.updateLayerViews(c);
b&&this._updateTiledLayers()};e.prototype.layerClassFromLayerView=function(a){return U.isElevationLayerView(a)?0:1};e.prototype._registerTiledLayerView=function(a){var b=this,c=[],d=this.layerClassFromLayerView(a);c.push(a.watch("suspended",function(){return b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures(!1)}));c.push(a.layer.watch("scaleRangeId",function(){return b._restartAllAgents(d)}));a.on("data-changed",function(){var c=b._layerIndexByLayerViewId[d].get(a.uid);
null!=c&&b._invalidateLayerData(c,d)});this._basemapLayerViewHandles.set(a.uid,c)};e.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles.get(a);if(b){for(var c=0;c<b.length;c++)b[c].remove();this._basemapLayerViewHandles.delete(a)}};e.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme&&!this.view.suspended){var b=this.view.allLayerViews,c=[[],[]],d=null,e=G.empty();b.forEach(function(b){var g=b.layer;if(g&&!b.suspended&&U.isTiledLayerView(b)){var f=
b.fullExtent;f?a.tilingScheme.compatibleWith(b.tileInfo)?(G.expand(e,f),g=a.layerClassFromLayerView(b),1===g&&(f=b.displayLevelRange,Infinity!==f.maxLevel&&(null===d||f.maxLevel>d)&&(d=f.maxLevel)),c[g].push(b)):xa.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):xa.warn("Terrain: Map or elevation layer does not have fullExtent: "+g.id)}});for(b=0;2>b;b++){var g=this._layerViews[b],f=c[b];f.reverse();var k=f.length,h=g.length!==k,m=Array(k),
n=Array(g.length);this._layerIndexByLayerViewId[b].clear();for(var l=0;l<k;l++){this._layerIndexByLayerViewId[b].set(f[l].uid,l);var r=g.indexOf(f[l]);m[l]=r;l!==r&&(h=!0);-1<r&&(n[r]=l)}if(h){g=0;for(k=this._topLevelTilemapOnlyTiles;g<k.length;g++)h=k[g],p.isSome(h)&&h.modifyLayers(n,m,b);g=this._postorderIterator;for(g.reset(this.rootTiles);!g.done;)g.next().modifyLayers(n,m,b);this._layerViews[b]=f;this._restartAllAgents(b);this._updateTiles(this.rootTiles)}}this.tilingScheme.ensureMaxLod(d)&&
this._viewChangeUpdate()}};e.prototype._restartAllAgents=function(a){var b=this._postorderIterator;for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.restartAgents(a);0===a&&c.computeElevationBounds()}};e.prototype._hasFixedExtent=function(){return!!this._clippingExtent};e.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};e.prototype.numLayers=function(a){return this._layerViews[a].length};e.prototype._updateTileTextures=function(a){var b=this;this._allTiles.forEach(function(c){c.updateAgents(1);
a?b.renderer.updateTileTexture(c):c.updateRenderData(1)})};e.prototype._invalidateLayerData=function(a,b){this._allTiles.forEach(function(c){return c.removeLayerAgent(a,b)});this._allTiles.forEach(function(c){return c.invalidateLayerData(a,b)})};e.prototype.requestRender=function(a){void 0===a&&(a=1);this.renderer.setNeedsRender(a)};e.prototype.setPendingUpdates=function(){this._pendingUpdates||(this._pendingUpdates=!0,this.notifyChange("updating"))};e.prototype.requestTileData=function(a,b,c,d){var e=
this,g=this.layerViewByIndex(b,c),f=g.layer;if(f.tilemapCache&&!U.isVectorTileLayerView(g)){var k=this.getTilemapTile(a),h=k.layerInfo[c][b];if(h.tilemap){if(!k.hasDataAvailable(a,b,c))return this._dataMissing(a,c,g,{notInTilemap:!0}),x.reject()}else return h.tilemapRequestPromise||(h.tilemapRequestAbort=x.createAbortController(),h.tilemapRequestPromise=this.requestTilemap(k,b,c,g,f,{signal:h.tilemapRequestAbort.signal})),++this._asyncWorkItems,h.tilemapRequestPromise.catch(function(){}).then(function(){--e._asyncWorkItems;
h.tilemapRequestPromise=null;h.tilemapRequestAbort=null;x.throwIfAborted(d);var b=e._layerIndexByLayerViewId[c].get(g.uid);if(null!=b){if(k.hasDataAvailable(a,b,c))return e._requestTileData(a,c,g,d);e._dataMissing(a,c,g,{notInTilemap:!0});return x.reject()}})}return this._requestTileData(a,c,g,d)};e.prototype._requestTileData=function(a,b,c,d){return 0===b?this._requestElevationTileData(a,c,d):this._requestMapTileData(a,c,d)};e.prototype._requestElevationTileData=function(a,b,c){var d=this;if(U.isElevationLayerView(b)){var e=
function(e){--d._asyncWorkItems;if(!x.isAborted(c)){var g=d._layerIndexByLayerViewId[0].get(b.uid);null==g?xa.warn("TerrainSurface: received data from unknown layer %d %s",0,a.lij.toString()):(d._usedMemory=ia,d._pendingUpdates=!0,d._elevationDataArrived(a,g,e))}},g=function(c){--d._asyncWorkItems;x.isAbortError(c)||d._dataMissing(a,0,b,c)};++this._asyncWorkItems;if(U.useFetchTileForLayer(b.layer))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],{noDataValue:F.ELEVATION_NODATA_VALUE,signal:c.signal}).then(function(a){x.isAborted(c)?
(xa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),g(x.createAbortError())):e(a)},g);var f=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);return this._elevationDataRequester.request(f,"binary",c).then(function(a){return d._lercWorker.decode(a,{noDataValue:F.ELEVATION_NODATA_VALUE},c.signal)}).then(function(a){e({values:a.pixelData,width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},
g)}U.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};e.prototype._requestMapTileData=function(a,b,c){var d=this;if(b instanceof H)return x.reject();++this._asyncWorkItems;var e=function(e){--d._asyncWorkItems;x.isAborted(c)||d._dataArrived(a,1,b,e)},g=function(c){--d._asyncWorkItems;x.isAbortError(c)||d._dataMissing(a,1,b,c)};if(U.isVectorTileLayerView(b)){var f=b.schemaHelper.getLevelRowColumn(a.lij);return b.tileHandler.getVectorTile(f[0],f[1],f[2]).then(e,
g)}if(U.useFetchTileForLayer(b.layer)&&U.isTileLayerView(b))return b.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],c).then(function(a){x.isAborted(c)?(xa.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),g(x.createAbortError())):e(a)},g);f=b.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=b.refreshInterval&&b.refreshTimestamp&&(f+=(-1<f.indexOf("?")?"\x26":"?")+"_ts\x3d"+b.refreshTimestamp);return this._mapDataRequester.request(f,
b.hasMixedImageFormats?"image+type":"image",c).then(e,g)};e.prototype.requestTilemap=function(a,b,c,d,e,g){var f=this;return e.tilemapCache.fetchTilemap(a.lij[0]+I.TILEMAP_SIZE_EXP,Math.round(a.lij[1]*Math.pow(2,I.TILEMAP_SIZE_EXP)),Math.round(a.lij[2]*Math.pow(2,I.TILEMAP_SIZE_EXP)),l({},g,{timeout:6E3})).then(function(e){b=f._layerIndexByLayerViewId[c].get(d.uid);null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(){})};e.prototype.getTilemapTile=function(a){var b=a.level;if(b>I.TILEMAP_SIZE_EXP)return ba.getTileNLevelsUp(a,
I.TILEMAP_SIZE_EXP);var c=this._topLevelTilemapOnlyTiles[b];if(p.isSome(c))return c;a=ba.getRootTile(a);c=I.TILEMAP_SIZE_EXP-b+a.level;c=new ha([b-I.TILEMAP_SIZE_EXP,a.lij[1]/Math.pow(2,c),a.lij[2]/Math.pow(2,c)],this._upsampleInfoPool,[this._layerViews[0].length,this._layerViews[1].length]);return this._topLevelTilemapOnlyTiles[b]=c};e.prototype._dataArrived=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataArrived(c,b,d):xa.warn("TerrainSurface: received data from unknown layer")};
e.prototype._dataMissing=function(a,b,c,d){c=this._layerIndexByLayerViewId[b].get(c.uid);null!=c?a.dataMissing(c,b,d):xa.warn("TerrainSurface: received data from unknown layer")};e.prototype.updateTileOverlayParams=function(){var a=this;this.rootTiles&&(this._allTiles.forEach(function(b){b.renderData&&a.overlayManager&&a.overlayManager.setTileParameters(b,b.renderData,a._overlayOpacity)}),this._renderer.setNeedsRender())};e.prototype.updateOverlayOpacity=function(){if(this.overlayManager){var a=this.overlayManager.updateOpacity(this._eyePosSurfaceSR[2]);
isNaN(a)||a===this._overlayOpacity||(this._allTiles.forEach(function(b){return b.renderData&&(b.renderData.overlayOpacity=a)}),this._overlayOpacity=a,this._renderer.setNeedsRender())}};e.prototype.getStats=function(){var a={numNodes:this._allTiles.length,numLeaves:0,numVisible:0,numRendered:0,numRenderedPerLevel:[],numLoadedPerLevel:[]};this._allTiles.forEach(function(b){b.isLeaf&&a.numLeaves++;var c=b.level;b.renderData&&(a.numLoadedPerLevel[c]=(a.numLoadedPerLevel[c]||0)+1);b.visible&&(a.numVisible++,
b.rendered&&(a.numRenderedPerLevel[c]=(a.numRenderedPerLevel[c]||0)+1,a.numRendered++))});return a};e.prototype.getUsedMemory=function(){var a=this;if(!this.tilingScheme)return 0;this._usedMemory===ia&&(this._usedMemory=0,this._allTiles.forEach(function(b){return a._usedMemory+=b.usedMemory}));return this._usedMemory};e.prototype.getUsedMemoryForLayerView=function(a){var b=0,c=this.layerClassFromLayerView(a),d=this._layerIndexByLayerViewId[c].get(a.uid);this._allTiles.forEach(function(a){return b+=
a.getUsedMemoryForLayer(c,d)});return b};e.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,d=this.tilingScheme.pixelSize,e=d*d*4;this._allTiles.forEach(function(d){for(var g=ua(d),f=0,k=d.layerInfo[1];f<k.length;f++){var h=k[f],h=h.data,m=0,p=0;h instanceof ka.TileTexture?m+=ma.getGpuMemoryUsage(h.texture):h instanceof HTMLImageElement||h instanceof R.ImageWithType?p+=e:h instanceof K.VectorTile&&(c+=h.getMemoryUsage());d.renderData||g?(a+=p,a+=m):(b+=p,b+=m)}g=
0;for(f=d.layerInfo[0];g<f.length;g++)h=f[g],h=h.data,a+=h?e:0;d.renderData&&(h=d.renderData.textureDescriptor,a+=h?ma.getGpuMemoryUsage(h):0,d=d.renderData.estimatedGeometryMemoryUsage,c+=d,c+=d)});return{visibleImageData:a,invisibleImageData:b,geometryData:c}};e.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return d.find(this.rootTiles,function(a){return a.lij[1]===b[1]&&a.lij[2]===b[2]});var c=Math.pow(2,b[0]),e=Math.floor(b[1]/c),g=Math.floor(b[2]/c),
f;this.rootTiles.some(function(a){return a.lij[1]===e&&a.lij[2]===g?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var k=b[1]&c?2:0;0<(b[2]&c)&&k++;if(!f.children[k])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+ba.tile2str(f)),null;f=f.children[k];c>>=1}U.weakAssert(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};e.prototype.setBorders=function(a){this._renderer.renderPatchBorders=a};e.prototype.setDisableRendering=function(a){this._renderer.renderingDisabled=
a};e.prototype.getRenderedTiles=function(){Oa.clear();this._allTiles.forEach(function(a){a.visible&&a.rendered&&Oa.push(a)});ba.sortTiles(this.renderOrder,Oa);return Oa.toArray()};Object.defineProperty(e.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)},getTiles:function(){return a._allTiles.toArray()}}},enumerable:!0,configurable:!0});h([m.property()],
e.prototype,"_renderer",void 0);h([m.property({constructOnly:!0})],e.prototype,"view",void 0);h([m.property({value:!1})],e.prototype,"cullBackFaces",null);h([m.property({readOnly:!0})],e.prototype,"extent",null);h([m.property({readOnly:!0,dependsOn:["ready","_renderer.updating","_scheduledLayerViewChangesHandle"]})],e.prototype,"updating",null);h([m.property({value:1})],e.prototype,"baseOpacity",null);h([m.property({readOnly:!0})],e.prototype,"overlayManager",void 0);h([m.property({constructOnly:!0})],
e.prototype,"manifold",void 0);h([m.property()],e.prototype,"maxTextureScale",void 0);h([m.property({readOnly:!0})],e.prototype,"ready",null);h([m.property({value:1})],e.prototype,"renderOrder",null);h([m.property({readOnly:!0})],e.prototype,"rootTiles",void 0);h([m.property({value:!0})],e.prototype,"skirtScale",null);h([m.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],e.prototype,"spatialReference",null);h([m.property()],e.prototype,"backgroundImage",void 0);h([m.property({type:a})],
e.prototype,"backgroundColor",void 0);h([m.property({dependsOn:["backgroundColor","backgroundImage"]})],e.prototype,"_background",null);h([m.property({value:!1})],e.prototype,"slicePlaneEnabled",null);h([m.property({readOnly:!0})],e.prototype,"tilingScheme",void 0);h([m.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],e.prototype,"tilingSchemeLocked",void 0);h([m.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],e.prototype,"tilingSchemeDone",void 0);h([m.property({readOnly:!0})],
e.prototype,"tilingSchemeLogic",void 0);h([m.property({value:!0})],e.prototype,"velvetOverground",null);h([m.property({value:!1})],e.prototype,"wireframe",null);h([m.property({value:!1})],e.prototype,"suspended",null);h([m.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],e.prototype,"lodSnapping",null);h([m.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureBlendTime"})],e.prototype,"textureBlendTime",void 0);h([m.property()],
e.prototype,"_scheduledLayerViewChangesHandle",void 0);return e=h([m.subclass("esri.views.3d.terrain.TerrainSurface")],e)}(m.declared(n.EventedMixin(e)));var ra=1.2,oa=80/180*Math.PI,pa=110/180*Math.PI,ia=-1,na=E.vec4f64.create(),ya=G.create(),da=[0,0,0],Oa=new t,Ja={spatialReference:null,tile:null,extent:null,context:"ground"},Ma={spatialReference:null,extent:null,scale:0};return b})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/workers".split(" "),
function(q,b,l,f,h,a){function e(){return h.create(function(a){return q(["./rasterFormats/LercCodec"],a)})}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(){}a.prototype._decode=function(a){return e().then(function(b){b=b.decode;b=b(a.buffer,a.options);return{result:b,transferList:[b.pixelData.buffer]}})};return a}(),k=function(b){function c(c){var d=b.call(this)||this;d.scheduler=c;d._threadInitialized=h.create(function(b){a.open("LercWorker",{strategy:"dedicated",scheduler:c}).then(function(a){void 0===
d._thread?d._thread=a:a.close();b()},function(){return b()})});return d}f(c,b);c.prototype.destroy=function(){this._thread&&this._thread.close();this._thread=null};Object.defineProperty(c.prototype,"test",{get:function(){return{threadInitialized:this._threadInitialized}},enumerable:!0,configurable:!0});c.prototype.decode=function(a,b,c){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:b},{transferList:[a],signal:c}):e().then(function(d){d=d.decode;h.throwIfAborted(c);
return d(a,b)}):h.resolve(null)};return c}(d);b.LercWorkerMaster=k;var n=new Map;b.acquireInstance=function(a){var b=n.get(a);b||(b={instance:new k(a),ref:0},n.set(a,b));++b.ref;return b.instance};b.releaseInstance=function(a){if(null!=a){a=a.scheduler;var b=n.get(a);b&&0>=--b.ref&&(b.instance.destroy(),n.delete(a))}};b.default=function(){return new d}})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/now ../../../webgl ./RenderBucket ../webgl/TiledDisplayObject".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(a,c,e,f){e=b.call(this,a,e,f,[4096,4096])||this;e._referenced=0;e._symbolFadeHold=null;e._vectorTileData=null;e._setData=!1;e._symbolUpdateData=null;e._memoryUsed=d;e.rotation=0;e.layerData={};e.status="loading";e._referenced=1;e.styleLayers=c;e.id=a.id;return e}l(c,b);Object.defineProperty(c.prototype,"hasSymbolBuckets",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"isHoldingForFade",{get:function(){return null!==this._symbolFadeHold},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isSymbolFadeDone",{get:function(){return!this._symbolFadeHold||this._symbolFadeHold<f()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"wasRequested",{get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status},enumerable:!0,configurable:!0});c.prototype.setData=function(a,b,c){this._vectorTileData=a;this.client=
b;this.refKeys=c;this._memoryUsed=d;this.ready();this._setData=!0};c.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};c.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender();this._memoryUsed=d};c.prototype.clearSymbolFadeHold=function(){this._symbolFadeHold=null};c.prototype.setSymbolHoldDuration=function(a){this._symbolFadeHold=f()+a};c.prototype.hasData=function(){return 0<Object.keys(this.layerData).length};c.prototype.dispose=
function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id);this._deleteBufferMemory();this.destroy();this._memoryUsed=d};c.prototype.release=function(){return 0===--this._referenced?(this.dispose(),this.attached=!1,this.stage=null,!0):!1};c.prototype.reference=function(){++this._referenced};Object.defineProperty(c.prototype,"referenced",{get:function(){return this._referenced},enumerable:!0,configurable:!0});c.prototype.getMemoryUsage=function(){var a=this;this._memoryUsed===
d&&(this._memoryUsed=k.reduce(function(b,c){return a[c]?b+a[c].size:b},0),this.texture&&(this._memoryUsed+=this.texture.descriptor.width*this.texture.descriptor.height*4),this._vectorTileData&&this._vectorTileData.bufferData&&(this._memoryUsed+=this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength)));return this._memoryUsed/(this._referenced||1)};c.prototype.commitChanges=function(){if(this._vectorTileData||
this._symbolUpdateData)this._vectorTileData?(this._deleteBufferMemory(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null):this._symbolUpdateData&&(this._updateSymbolData(this._symbolUpdateData),this._symbolUpdateData=null)};c.prototype._deleteBufferMemory=function(){for(var a=0,b="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" ");a<
b.length;a++){var c=b[a];this[c]&&(this[c].dispose(),this[c]=null)}this.layerData={};this.triangleCount=0};c.prototype._createRenderBuckets=function(){for(var b=new Uint32Array(this._vectorTileData.bucketDataInfo),c=b.length,d=0;d<c;){var e=b[d];switch(b[d+1]){case 0:(new a.BackgroundRenderBucket).layerID=e;d+=2;break;case 1:var f=new a.FillRenderBucket;f.layerID=e;f.triangleElementStart=b[d+2];f.triangleElementCount=b[d+3];f.outlineElementStart=b[d+4];f.outlineElementCount=b[d+5];if(0!==f.triangleElementCount||
0!==f.outlineElementCount)this.layerData[e]=f;d+=6;break;case 2:f=new a.LineRenderBucket;f.layerID=e;f.triangleElementStart=b[d+2];f.triangleElementCount=b[d+3];0<f.triangleElementCount&&(this.layerData[e]=f);d+=4;break;case 3:f=new a.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==b[d+2];var k=d+3,h=b[k];k++;for(var n=0;n<h;n++){var m=b[k],l=b[k+1],A=b[k+2];f.iconPerPageElementsMap.set(m,[l,A]);k+=3}var q=b[k];k++;for(n=0;n<q;n++)m=b[k],l=b[k+1],A=b[k+2],f.glyphPerPageElementsMap.set(m,[l,A]),k+=3;if(0<
f.iconPerPageElementsMap.size||0<f.glyphPerPageElementsMap.size)this.layerData[e]=f;d+=5+3*h+3*q;break;case 4:f=new a.CircleRenderBucket;f.layerID=e;f.triangleElementStart=b[d+2];f.triangleElementCount=b[d+3];0<f.triangleElementCount&&(this.layerData[e]=f);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};c.prototype.attach=function(){return this._setData};c.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};c.prototype._updateSymbolData=function(b){if(!b||
!b.bucketDataInfo)return!0;var c=new Uint32Array(b.bucketDataInfo),d=c.length;if(0===d)return!0;if(!this.isReady)return this.requestRender(),!1;for(var e=this.stage.context,g=new Uint32Array(b.bufferDataInfo),f=g.length,k=0,n=0;n<f;n+=2,k++)switch(g[n]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=h.BufferObject.createVertex(e,35044,b.bufferData[k]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=
null);this.iconDDVertexBuffer=h.BufferObject.createVertex(e,35044,b.bufferData[k]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=h.BufferObject.createIndex(e,35044,b.bufferData[k]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=h.BufferObject.createVertex(e,35044,b.bufferData[k]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=
null);this.textDDVertexBuffer=h.BufferObject.createVertex(e,35044,b.bufferData[k]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=h.BufferObject.createIndex(e,35044,b.bufferData[k])}b={};for(var m in this.layerData)3!==this.layerData[m].type&&(b[m]=this.layerData[m]);this.layerData=b;e=this.styleLayers.layers;for(g=0;g<d;){m=c[g];f=new a.SymbolRenderBucket;f.layerID=m;f.isSDF=0!==c[g+2];e.length>f.layerID&&e[f.layerID].type===f.type&&
(b[f.layerID]=f);var l=g+3;m=c[l];l++;for(k=0;k<m;k++){var n=c[l],A=c[l+1],q=c[l+2];f.iconPerPageElementsMap.set(n,[A,q]);l+=3}var C=c[l];l++;for(k=0;k<C;k++)n=c[l],A=c[l+1],q=c[l+2],f.glyphPerPageElementsMap.set(n,[A,q]),l+=3;g+=5+3*m+3*C}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),
this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};c._createBufferToObject=function(){var a=[];a[1]={create:h.BufferObject.createVertex,var:"fillVertexBuffer"};a[2]={create:h.BufferObject.createVertex,var:"fillDDVertexBuffer"};a[3]={create:h.BufferObject.createIndex,var:"fillIndexBuffer"};a[4]={create:h.BufferObject.createVertex,var:"outlineVertexBuffer"};a[5]={create:h.BufferObject.createVertex,var:"outlineDDVertexBuffer"};
a[6]={create:h.BufferObject.createIndex,var:"outlineIndexBuffer"};a[7]={create:h.BufferObject.createVertex,var:"lineVertexBuffer"};a[8]={create:h.BufferObject.createVertex,var:"lineDDVertexBuffer"};a[9]={create:h.BufferObject.createIndex,var:"lineIndexBuffer"};a[10]={create:h.BufferObject.createVertex,var:"iconVertexBuffer"};a[11]={create:h.BufferObject.createVertex,var:"iconDDVertexBuffer"};a[12]={create:h.BufferObject.createIndex,var:"iconIndexBuffer"};a[13]={create:h.BufferObject.createVertex,
var:"textVertexBuffer"};a[14]={create:h.BufferObject.createVertex,var:"textDDVertexBuffer"};a[15]={create:h.BufferObject.createIndex,var:"textIndexBuffer"};a[16]={create:h.BufferObject.createVertex,var:"circleVertexBuffer"};a[17]={create:h.BufferObject.createIndex,var:"circleIndexBuffer"};return a};c.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),d=b.length,e=0;e<d;e+=2){var f=e/2;if(!(0>=b[e+1]||0===this._vectorTileData.bufferData[f].byteLength)){var k=
b[e],h=c.bufferToObject[k];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[f]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[f]):console.error("Bad buffer type "+k)}}};c.bufferToObject=c._createBufferToObject();return c}(e.TiledDisplayObject);b.VectorTile=q;var d=-1,k="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ")})},
"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(b){this.type=b}}();b.RenderBucket=q;var f=function(b){function a(){var a=b.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount};a.prototype.triangleCount=function(){return this.triangleElementCount/
3};return a}(q);b.LineRenderBucket=f;f=function(b){function a(){var a=b.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};a.prototype.triangleCount=function(){return(this.triangleElementCount+this.outlineElementCount)/3};return a}(q);b.FillRenderBucket=f;f=function(b){function a(){var a=b.call(this,3)||this;a.iconPerPageElementsMap=
new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}l(a,b);a.prototype.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};a.prototype.triangleCount=function(){var a=0;this.iconPerPageElementsMap.forEach(function(b){a+=b[1]});this.glyphPerPageElementsMap.forEach(function(b){a+=b[1]});return a/3};return a}(q);b.SymbolRenderBucket=f;f=function(b){function a(){var a=b.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}
l(a,b);a.prototype.hasData=function(){return 0<this.triangleElementCount};a.prototype.triangleCount=function(){return this.triangleElementCount/3};return a}(q);b.CircleRenderBucket=f;q=function(b){function a(){return b.call(this,0)||this}l(a,b);a.prototype.hasData=function(){return!0};a.prototype.triangleCount=function(){return 2};return a}(q);b.BackgroundRenderBucket=q})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f32 ../DisplayObject ../../tiling/TileKey".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(c,e,f,k){void 0===k&&(k=f);var g=b.call(this)||this;g.transforms={dvs:a.mat3f32.create(),tileMat3:a.mat3f32.create()};g.triangleCount=0;g.key=d.pool.acquire(c);g.bounds=e;g.size=f;g.coordRange=k;return g}l(e,b);e.prototype.destroy=function(){d.pool.release(this.key);this.key=null;this.texture&&(this.texture.dispose(),this.texture=null)};Object.defineProperty(e.prototype,"coords",{get:function(){return this._coords},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"bounds",{get:function(){return this._bounds},set:function(a){this._coords=[a[0],a[3]];this._bounds=a},enumerable:!0,configurable:!0});e.prototype.setTransform=function(a,b){b/=a.resolution*a.pixelRatio;var c=this.transforms.tileMat3,d=a.toScreenNoRotation([0,0],this.coords);h.mat3.set(c,this.size[0]/this.coordRange[0]*b,0,0,0,this.size[1]/this.coordRange[1]*b,0,d[0],d[1],1);h.mat3.multiply(this.transforms.dvs,a.displayViewMat3,c)};
return e}(e.DisplayObject);b.TiledDisplayObject=q})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f32=l})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(9);b[0]=1;b[4]=1;b[8]=1;return b};b.clone=function(b){var f=new Float32Array(9);
f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];return f};b.fromValues=function(b,f,h,a,e,d,k,n,c){var g=new Float32Array(9);g[0]=b;g[1]=f;g[2]=h;g[3]=a;g[4]=e;g[5]=d;g[6]=k;g[7]=n;g[8]=c;return g};b.createView=function(b,f){return new Float32Array(b,f,9)}})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});
q=function(b){function a(){var a=null!==b&&b.apply(this,arguments)||this;a._renderRequestedCalled=!1;a._attached=!1;a._isReady=!1;a._opacity=1;a.renderRequested=!1;a._visible=!0;return a}l(a,b);Object.defineProperty(a.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});a.prototype.attach=function(){this.ready();
return!0};a.prototype.setTransform=function(a){};a.prototype.detach=function(){};a.prototype.processRender=function(a){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(a),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};a.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestRender();a!==this.renderRequested&&this.hasEventListener("will-render")&&
this.emit("will-render")};a.prototype.dispose=function(){};a.prototype.doRender=function(a){};a.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return a}(f);b.DisplayObject=q})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(q,b,l){return function(){function b(b,a,e,d){this.set(b,a,e,d)}b.getId=function(b,a,e,d){return"object"===typeof b?b.level+"/"+b.row+"/"+b.col+"/"+b.world:b+"/"+a+"/"+e+"/"+d};Object.defineProperty(b.prototype,
"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});b.prototype.equals=function(b){return this.level===b.level&&this.row===b.row&&this.col===b.col&&this.world===b.world};b.prototype.release=function(){this.world=this.col=this.row=this.level=0};b.prototype.set=function(b,a,e,d){null==b?this.world=this.col=this.row=this.level=0:"object"===typeof b?(this.level=b.level||0,this.row=
b.row||0,this.col=b.col||0,this.world=b.world||0):"string"===typeof b?(b=b.split("/"),a=b[1],e=b[2],d=b[3],this.level=parseFloat(b[0]),this.row=parseFloat(a),this.col=parseFloat(e),this.world=parseFloat(d)):(this.level=+b,this.row=+a,this.col=+e,this.world=+d||0);return this};b.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};b.prototype.getChildKeys=function(){var f=this.level+1,a=this.row<<1,e=this.col<<1,d=this.world;return[new b(f,a,e,d),new b(f,a,e+1,
d),new b(f,a+1,e,d),new b(f,a+1,e+1,d)]};b.prototype.compareRowMajor=function(b){return this.row<b.row?-1:this.row>b.row?1:this.col<b.col?-1:this.col>b.col?1:0};b.pool=new l(b,!0,null,25,50);return b}()})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./LayerView3D ./TiledLayerView3D ./support/tiledLayerUtils ../../layers/LayerView".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);c.prototype.initialize=function(){var b=this.get("view.map.allLayers"),b=b&&b.includes(this.layer),c=this.get("view.map.ground.layers"),c=c&&c.includes(this.layer);b&&!c&&(b=new h("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(a.reject(b)));this._addTilingSchemeMatchPromise();this.addResolvingPromise(n.checkArcGISServiceVersionCompatibility(this.layer))};
c.prototype.getStats=function(){return{memory:Math.round(this.view.basemapTerrain.getUsedMemoryForLayerView(this)/1024/1024)+" MB (included in Terrain)"}};f([e.property({readOnly:!0,aliasOf:"layer.fullExtent"})],c.prototype,"fullExtent",void 0);f([e.property()],c.prototype,"layer",void 0);f([e.property({readOnly:!0,aliasOf:"layer.tileInfo"})],c.prototype,"tileInfo",void 0);return c=f([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],c)}(e.declared(k.TiledLayerView3D(d.LayerView3D(c))))})},
"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.LayerView3D=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.slicePlaneEnabled=
!1;a.supportsHeightUnitConversion=!1;return a}l(c,b);c.prototype.destroy=function(){this.view=null};c.prototype.postscript=function(a){this.inherited(arguments);d.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};c.prototype._validateHeightModelInfo=function(){var b=this;return h.create(function(c,e){a.whenFalseOnce(b.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var a=d.rejectLayerError(b.layer,b.view.heightModelInfo,b.supportsHeightUnitConversion);
a?e(a):c()})})};f([e.property()],c.prototype,"view",void 0);f([e.property()],c.prototype,"slicePlaneEnabled",void 0);return c=f([e.subclass("esri.views.3d.layers.LayerView3D")],c)}(e.declared(b))}})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./support/layerViewUpdatingProperties ./support/tiledLayerUtils ../terrain/terrainUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});b.TiledLayerView3D=function(b){return function(b){function h(){return null!==b&&b.apply(this,arguments)||this}l(h,b);Object.defineProperty(h.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"dataLevelRange",
{get:function(){var a=this.tileInfo.lods;return this.levelRangeFromScaleRange(a[0].scale,a[a.length-1].scale)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"displayLevelRange",{get:function(){var a=this.tileInfo.lods,a=this.levelRangeFromScaleRange(this.layer.minScale||a[0].scale,this.layer.maxScale||a[a.length-1].scale);this.layer.maxScale&&a.maxLevel++;return a},enumerable:!0,configurable:!0});h.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};h.prototype._addTilingSchemeMatchPromise=
function(){var a=this,b=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);b?this.addResolvingPromise(e.reject(b)):(b=d.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){c.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(b))};h.prototype._getTileInfoSupportError=function(b,c){if(b=g.checkIfTileInfoSupportedForView(b,c,this.view.spatialReference,this.view.basemapTerrain.manifold)){c={layer:this.layer,
error:b};var d=void 0;switch(b.name){case "tilingscheme:local-gcs-not-supported":d=new a("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",c);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":d=new a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",c);break;default:d=new a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",
c)}return d}return null};h.prototype._getTileInfoCompatibilityError=function(b,c){return c.compatibleWith(b)?null:new a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};h.prototype.levelRangeFromScaleRange=function(a,b){var c={minLevel:0,maxLevel:Infinity},d=this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!d)return c;var e=d.levels[0],d=function(a){a=Math.log(e.scale/a)/Math.LN2;return 1E-9>.5-Math.abs(.5-
a%1)?Math.round(a):Math.ceil(a)};null!=a&&0<a&&(c.minLevel=Math.max(0,d(a)));null!=b&&0<b&&(c.maxLevel=Math.max(0,d(b)));return c};h.prototype.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};f([k.property({readOnly:!0})],h.prototype,"imageFormatIsOpaque",null);f([k.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],h.prototype,"updating",void 0);f([k.property(n.updatingProgress)],h.prototype,"updatingProgress",void 0);f([k.property(n.updatingProgressValue)],
h.prototype,"updatingProgressValue",void 0);f([k.property({readOnly:!0})],h.prototype,"fullExtent",void 0);f([k.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],h.prototype,"isOpaque",null);f([k.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],h.prototype,"dataLevelRange",null);f([k.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],h.prototype,"displayLevelRange",null);f([k.property()],
h.prototype,"layer",void 0);f([k.property({readOnly:!0})],h.prototype,"tileInfo",void 0);return h=f([k.subclass("esri.views.3d.layers.TiledLayerView3D")],h)}(k.declared(b))}})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.updatingProgressValue={value:.5,readOnly:!0};b.updatingProgress={dependsOn:["updating","updatingProgressValue"],readOnly:!0,value:.5,get:function(){return this.updating?
this.updatingProgressValue:1}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(q,b,l,f,h,a){function e(a){var b=null,d=a.search(/\/rest\/services\//i);0<d&&(b=a.substring(0,d+6));return b}Object.defineProperty(b,"__esModule",{value:!0});b.checkArcGISServiceVersionCompatibility=function(b){if(!a.isHostedAgolService(b.url)){if(10.22>
b.version)return b=new f("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+b.version,{minVersion:10.22,detectedVersion:b.version}),h.reject(b);if(10.22===b.version&&!a.isHostedSecuredProxyService(b.url,b.get("portalItem.id"))){b=e(b.url);var d=new f("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");return l(b+"self?f\x3djson",{headers:{"X-Requested-With":null},
timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw d;}).catch(function(){throw d;})}return h.resolve()}};b.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),function(q,b,l,f,h,a,e){function d(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function k(a){return a&&
"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function n(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function c(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function g(a,b,c,d){return r["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,c,b)}Object.defineProperty(b,"__esModule",{value:!0});var r={planar:a,spherical:e};b.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};b.autoUpdateSkirtsVisibility=
function(a,b,c,d){var e=r[a.manifold],g=e.isInsideExtent(a,b);g?c=a.getElevation(b[0],b[1],b[1],c):(c=a.elevationBounds,c=.5*(c.min+c.max));c=b[2]-c;d=Math.abs(c)<d?0:0>c?-1:1;g||(e.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?(b=e.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(d=0)):d=0);a.skirtScale=d};b.isVectorTileLayer=function(a){return a&&a instanceof h};b.isTileLayerView=d;b.isVectorTileLayerView=k;b.isWMTSLayerView=n;b.isElevationLayerView=
c;b.isTiledLayerView=function(a){return a&&(d(a)||c(a)||k(a)||n(a))};b.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===f.prototype.fetchTile||a.fetchTile===l.prototype.fetchTile)};b.checkIfTileInfoSupportedForView=g;b.getTiledLayerInfo=function(a,c,d){var e,f;if("wmts"===a.type){if(a=a.activeLayer){var k=a.tileMatrixSet;if(k)e=k.tileInfo,f=k.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==g(a.tileInfo,a.fullExtent,c,d)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else e=
"vector-tile"!==a.type||b.test.force512VTL?a.tileInfo:a.compatibleTileInfo256,f=a.fullExtent;return e&&f&&null==g(e,f,c,d)?{tileInfo:e,fullExtent:f}:{tileInfo:null,fullExtent:null}};b.test={force512VTL:!1}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/deprecate ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C){var E=c.getLogger("esri.layers.ElevationLayer");return function(b){function c(a){a=b.call(this,a)||this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.sourceJSON=null;a.type="elevation";a.url=null;a.version=null;a._lercWorker=C.acquireInstance();return a}f(c,b);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};c.prototype.destroy=
function(){C.releaseInstance(this._lercWorker);this._lercWorker=null};Object.defineProperty(c.prototype,"minScale",{get:function(){},set:function(a){this.constructed&&E.warn(this.declaredClass+".minScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&E.warn(this.declaredClass+".maxScale support has been removed (since 4.5)")},enumerable:!0,configurable:!0});c.prototype.readVersion=
function(a,b){(a=b.currentVersion)||(a=9.3);return a};c.prototype.load=function(a){var b=this,c=g.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var b=0;b<a.typeKeywords.length;b++)if("elevation 3d layer"===a.typeKeywords[b].toLowerCase())return!0;throw new n("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});
}},a).then(function(){return b._fetchImageService(c)},function(){return b._fetchImageService(c)}));return this.when()};c.prototype.fetchTile=function(a,b,c,e){var g=this;void 0===e&&(e={});null!=e&&"number"===typeof e&&(k.deprecated(E,"Passing 'noDataValue' directly as a parameter",{replacement:"use { noDataValue } options object instead",version:"4.12"}),e={noDataValue:e});var f={responseType:"array-buffer",signal:e.signal},h={noDataValue:e.noDataValue,returnFileInfo:!0};return this.load().then(function(){return g._fetchTileAvailability(a,
b,c,e)}).then(function(){return d(g.getTileUrl(a,b,c),f)}).then(function(a){return g._lercWorker.decode(a.data,h,e.signal)}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};c.prototype.getTileUrl=function(a,b,c){var d=u.objectToQuery(l({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+b+"/"+c+
(d?"?"+d:"")};c.prototype.queryElevation=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(c,a,b)})};c.prototype.createElevationSampler=function(a,b){var c=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(c,a,b)})};c.prototype._fetchTileAvailability=function(a,b,c,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,c,d):p.resolve("unknown")};c.prototype._fetchImageService=
function(b){return e(this,void 0,void 0,function(){var c,e;return a(this,function(a){switch(a.label){case 0:if(this.sourceJSON)return[2,this.sourceJSON];c={query:l({f:"json"},this.parsedUrl.query),responseType:"json",signal:b};return[4,d(this.parsedUrl.path,c)];case 1:return e=a.sent(),e.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=e.data,this.read(e.data,{origin:"service",url:this.parsedUrl}),[2]}})})};c.prototype._importElevationQuery=function(){return p.create(function(a){q(["./support/ElevationQuery"],
a)})};h([t.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);h([t.property({readOnly:!0,type:x})],c.prototype,"heightModelInfo",void 0);h([t.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],c.prototype,"path",void 0);h([t.property({type:["show","hide"]})],c.prototype,"listMode",void 0);h([t.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,
"minScale",null);h([t.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],c.prototype,"maxScale",null);h([t.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],c.prototype,"opacity",void 0);h([t.property({type:["ArcGISTiledElevationServiceLayer"]})],c.prototype,"operationalLayerType",void 0);h([t.property()],c.prototype,"sourceJSON",void 0);h([t.property({json:{read:!1},value:"elevation",
readOnly:!0})],c.prototype,"type",void 0);h([t.property(B.url)],c.prototype,"url",void 0);h([t.property()],c.prototype,"version",void 0);h([t.reader("version",["currentVersion"])],c.prototype,"readVersion",null);return c=h([t.subclass("esri.layers.ElevationLayer")],c)}(t.declared(y.ArcGISCachedService(m.ArcGISService(w.OperationalLayer(A.PortalLayer(r.MultiOriginJSONMixin(v)))))))})},"esri/layers/mixins/ArcGISCachedService":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/accessorSupport/decorators ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});b.ArcGISCachedService=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.copyright=null;a.minScale=0;a.maxScale=0;a.spatialReference=null;a.tileInfo=null;a.tilemapCache=null;return a}f(c,b);c.prototype.readMinScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};c.prototype.readMaxScale=function(a,b){return null!=b.minLOD&&null!=b.maxLOD?a:0};Object.defineProperty(c.prototype,
"supportsBlankTile",{get:function(){return 10.2<=this.version},enumerable:!0,configurable:!0});c.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new k.TilemapCache({layer:this}):null};h([e.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);h([e.property()],c.prototype,"minScale",void 0);h([e.reader("service","minScale")],c.prototype,"readMinScale",null);h([e.property()],c.prototype,"maxScale",void 0);h([e.reader("service",
"maxScale")],c.prototype,"readMaxScale",null);h([e.property({type:a.SpatialReference})],c.prototype,"spatialReference",void 0);h([e.property({readOnly:!0,dependsOn:["version"]})],c.prototype,"supportsBlankTile",null);h([e.property(d.serviceTileInfoProperty)],c.prototype,"tileInfo",void 0);h([e.property()],c.prototype,"tilemapCache",void 0);h([e.reader("service","tilemapCache",["capabilities"])],c.prototype,"readTilemapCache",null);h([e.property()],c.prototype,"version",void 0);return c=h([e.subclass("esri.layers.mixins.ArcGISCachedService")],
c)}(e.declared(b))}})},"esri/layers/support/serviceTileInfoProperty":function(){define(["require","exports","../../core/tsSupport/assignHelper","./TileInfo"],function(q,b,l,f){function h(a,b,d,k){if(!a)return null;d=b.minScale;var e=b.maxScale,c=b.minLOD,g=b.maxLOD;if(null!=c&&null!=g)return k&&k.ignoreMinMaxLOD?f.fromJSON(a):f.fromJSON(l({},a,{lods:a.lods.filter(function(a){a=a.level;return null!=a&&a>=c&&a<=g})}));if(0!==d&&0!==e){var h=d?Math.round(1E4*d)/1E4:Infinity,p=e?Math.round(1E4*e)/1E4:
-Infinity;return f.fromJSON(l({},a,{lods:a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=h&&a>=p})}))}return f.fromJSON(a)}Object.defineProperty(b,"__esModule",{value:!0});b.serviceTileInfoProperty={type:f,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:h}}}}};b.readServiceTileInfo=h})},"esri/layers/TileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../geometry ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K){var H="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");return function(a){function b(b,c){b=
a.call(this,b)||this;b.listMode="show";b.isReference=null;b.resampling=!0;b.sourceJSON=null;b.spatialReference=null;b.path=null;b.sublayers=null;b.type="tile";b.url=null;return b}f(b,a);b.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};b.prototype.load=function(a){var b=this,c=g.isSome(a)?a.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service","Map Service"]},a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}));
return this.when()};Object.defineProperty(b.prototype,"attributionDataUrl",{get:function(){return this._getDefaultAttribution(this._getMapName(this.parsedUrl.path.toLowerCase()))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"operationalLayerType",{get:function(){if(this.capabilities&&this.capabilities.operations)return this.capabilities.operations.supportsExportMap?"ArcGISTiledMapServiceLayer":"ArcGISTiledImageServiceLayer";var a=this.url||this.portalItem&&this.portalItem.url;
return a&&/\/ImageServer(\/|\/?$)/i.test(a)?"ArcGISTiledImageServiceLayer":"ArcGISTiledMapServiceLayer"},enumerable:!0,configurable:!0});b.prototype.readSpatialReference=function(a,b){return(a=a||b.tileInfo&&b.tileInfo.spatialReference)&&d.SpatialReference.fromJSON(a)};b.prototype.writeSublayers=function(a,b,c,d){if(this.loaded&&a){a=a.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).toArray();var e=[],g=l({writeSublayerStructure:!1},d);a.forEach(function(a){a=
a.write({},g);e.push(a)});e.some(function(a){return 1<Object.keys(a).length})&&(b.layers=e)}};Object.defineProperty(b.prototype,"tileServers",{get:function(){return this._getDefaultTileServers(this.parsedUrl.path)},enumerable:!0,configurable:!0});b.prototype.castTileServers=function(a){return Array.isArray(a)?a.map(function(a){return u.urlToObject(a).path}):null};b.prototype.fetchTile=function(a,b,c,d){void 0===d&&(d={});var e=d.signal,g=d.timestamp;a=this.getTileUrl(a,b,c);e={responseType:"image",
signal:e};null!=g&&(e.query={_ts:d.timestamp});return k(a,e).then(function(a){return a.data})};b.prototype.getTileUrl=function(a,b,c){var d=u.objectToQuery(l({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null})),e=this.tileServers;return(e&&e.length?e[b%e.length]:this.parsedUrl.path)+"/tile/"+a+"/"+b+"/"+c+(d?"?"+d:"")};b.prototype._fetchService=function(a){var b=this;return p.create(function(c,d){if(b.sourceJSON)c({data:b.sourceJSON});else{if(!b.parsedUrl)throw new n("tile-layer:undefined-url",
"layer's url is not defined");k(b.parsedUrl.path,{query:l({f:"json"},b.parsedUrl.query),responseType:"json",signal:a}).then(c,d)}}).then(function(c){c.ssl&&(b.url=b.url.replace(/^http:/i,"https:"));b.sourceJSON=c.data;b.read(c.data,{origin:"service",url:b.parsedUrl});if(10.1===b.version&&!J.isHostedAgolService(b.url))return b._fetchServerVersion(b.url,a).then(function(a){b.read({currentVersion:a})}).catch(function(){})})};b.prototype._fetchServerVersion=function(a,b){if(!G.isArcGISUrl(a))return p.reject();
a=a.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return k(a,{query:{f:"json"},responseType:"json",signal:b}).then(function(a){if(a.data&&a.data.currentVersion)return a.data.currentVersion;throw new n("tile-layer:version-not-available");})};b.prototype._getMapName=function(a){return(a=a.match(/^(?:https?:)?\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&a[2]};b.prototype._getDefaultAttribution=function(a){if(a){var b;a=a.toLowerCase();for(var c=0,d=
H.length;c<d;c++)if(b=H[c],-1<b.toLowerCase().indexOf(a))return u.makeAbsolute("//static.arcgis.com/attribution/"+b)}};b.prototype._getDefaultTileServers=function(a){var b=-1!==a.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),c=-1!==a.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return b||c?[a,a.replace(b?/server\.arcgisonline/i:/services\.arcgisonline/i,b?"services.arcgisonline":"server.arcgisonline")]:[]};h([t.property({readOnly:!0,dependsOn:["parsedUrl"]})],b.prototype,"attributionDataUrl",
null);h([t.property({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0);h([t.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],b.prototype,"isReference",void 0);h([t.property({readOnly:!0})],b.prototype,"operationalLayerType",null);h([t.property()],b.prototype,"popupTemplates",void 0);h([t.property({type:Boolean})],b.prototype,"resampling",void 0);h([t.property()],b.prototype,"sourceJSON",void 0);h([t.property({type:d.SpatialReference})],
b.prototype,"spatialReference",void 0);h([t.reader("spatialReference",["spatialReference","tileInfo"])],b.prototype,"readSpatialReference",null);h([t.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],b.prototype,"path",void 0);h([t.property({readOnly:!0})],b.prototype,"sublayers",void 0);h([t.writer("sublayers",{layers:{type:[K]}})],b.prototype,"writeSublayers",null);h([t.property({json:{read:!1,write:!1}})],b.prototype,"popupEnabled",void 0);h([t.property({dependsOn:["parsedUrl"]})],
b.prototype,"tileServers",null);h([t.cast("tileServers")],b.prototype,"castTileServers",null);h([t.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);h([t.property(I.url)],b.prototype,"url",void 0);return b=h([t.subclass("esri.layers.TileLayer")],b)}(t.declared(E.SublayersOwner(C.ScaleRangeLayer(B.RefreshableLayer(w.OperationalLayer(A.PortalLayer(v.ArcGISCachedService(y.ArcGISMapService(m.ArcGISService(r.MultiOriginJSONMixin(c.HandleOwnerMixin(x))))))))))))})},"esri/layers/mixins/ArcGISMapService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});b.ArcGISMapService=function(b){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.capabilities=void 0;a.copyright=null;a.fullExtent=null;a.legendEnabled=!0;a.spatialReference=null;a.version=null;return a}l(e,b);e.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});if(!c)return{operations:{supportsQuery:!1,
supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};a=this.type;var d=-1!==c.indexOf("query"),e=-1!==c.indexOf("map"),g=!!b.exportTilesAllowed,c=-1!==c.indexOf("tilemap"),f="tile"!==a&&!!b.supportsDynamicLayers,k="tile"!==a&&(!b.tileInfo||f),h="tile"!==a&&(!b.tileInfo||f);return{operations:{supportsQuery:d,supportsExportMap:e,supportsExportTiles:g,supportsTileMap:c},exportMap:e?{supportsSublayersChanges:"tile"!==a,supportsDynamicLayers:f,supportsSublayerVisibility:k,
supportsSublayerDefinitionExpression:h}:null,exportTiles:g?{maxExportTilesCount:+b.maxExportTilesCount}:null}};e.prototype.readVersion=function(a,b){(a=b.currentVersion)||(a=b.hasOwnProperty("capabilities")||b.hasOwnProperty("tables")?10:b.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return a};e.prototype.fetchSublayerInfo=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return[4,this.fetchAllLayersAndTables(c)];case 1:return a.sent(),
[2,this._allLayersAndTablesMap.get(b)]}})})};e.prototype.fetchAllLayersAndTables=function(b){return a(this,void 0,void 0,function(){var a,c=this;return h(this,function(e){switch(e.label){case 0:return[4,this.load(b)];case 1:return e.sent(),this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=d(n.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json"}}).then(function(a){c._allLayersAndTablesMap=new Map;for(var b=0,d=a.data.layers;b<d.length;b++){var e=d[b];c._allLayersAndTablesMap.set(e.id,
e)}return{result:a.data}},function(a){return{error:a}})),[4,this._allLayersAndTablesPromise];case 2:a=e.sent();k.throwIfAborted(b);if("result"in a)return[2,a.result];throw a.error;}})})};f([c.property({readOnly:!0})],e.prototype,"capabilities",void 0);f([c.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],e.prototype,"readCapabilities",null);f([c.property({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",
void 0);f([c.property({type:g})],e.prototype,"fullExtent",void 0);f([c.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],e.prototype,"id",void 0);f([c.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],e.prototype,"legendEnabled",void 0);f([c.property(p.popupEnabled)],e.prototype,"popupEnabled",void 0);f([c.property({type:r})],e.prototype,"spatialReference",void 0);f([c.property()],e.prototype,"version",
void 0);f([c.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],e.prototype,"readVersion",null);return e=f([c.subclass("esri.layers.mixins.ArcGISMapService")],e)}(c.declared(b))}})},"esri/layers/mixins/SublayersOwner":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../support/Sublayer ../support/sublayerUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a,b){var c=[],d={};if(!a)return c;a.forEach(function(a){var e=new r;e.read(a,b);d[e.id]=e;null!=a.parentLayerId&&-1!==a.parentLayerId?(a=d[a.parentLayerId],a.sublayers||(a.sublayers=[]),a.sublayers.unshift(e)):c.unshift(e)});return c}function t(a,b){a&&a.forEach(function(a){b(a);a.sublayers&&a.sublayers.length&&t(a.sublayers,b)})}Object.defineProperty(b,"__esModule",{value:!0});var x=k.getLogger("esri.layers.TileLayer"),v=a.ofType(r);b.forEachSublayer=
t;b.SublayersOwner=function(b){return function(b){function k(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var g=b.apply(this,c)||this;g.allSublayers=new e({root:g,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return a.sublayers}});g.sublayersSourceJSON=(a={},a[2]={},a[3]={},a[4]={},a[5]={},a);g.watch("sublayers",function(a,b){return g._handleSublayersChange(a,b)},!0);return g}f(k,b);k.prototype.readSublayers=function(a,b){if(b&&a){var d=this.sublayersSourceJSON,
e=c.nameToId(b.origin);2>e||(d[e]={context:b,visibleLayers:a.visibleLayers||d[e].visibleLayers,layers:a.layers||d[e].layers},2<e||(this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers),b=this.createSublayersForOrigin("web-document"),a=b.sublayers,b=b.origin,d=g.getProperties(this),d.setDefaultOrigin(b),this._set("sublayers",new v(a)),d.setDefaultOrigin("user")))}};k.prototype.findSublayerById=function(a){return this.allSublayers.find(function(b){return b.id===a})};k.prototype.createServiceSublayers=
function(){return this.createSublayersForOrigin("service").sublayers};k.prototype.createSublayersForOrigin=function(a){var b="web-document"===a?c.nameToId("web-map"):c.nameToId(a),d=2;a=this.sublayersSourceJSON[2].layers;for(var e=this.sublayersSourceJSON[2].context,g=null,f=0,k=[3,4,5].filter(function(a){return a<=b});f<k.length;f++){var h=k[f],m=this.sublayersSourceJSON[h];p.isSublayerOverhaul(m.layers)&&(d=h,a=m.layers,e=m.context,m.visibleLayers&&(g={visibleLayers:m.visibleLayers,context:m.context}))}for(var n=
null,f=0,k=[3,4,5].filter(function(a){return a>d&&a<=b});f<k.length;f++){var l=this.sublayersSourceJSON[k[f]],h=l.layers,m=l.visibleLayers,l=l.context;h&&(n={layers:h,context:l});m&&(g={visibleLayers:m,context:l})}a=u(a,e);var r=new Map,w=new Set;if(n)for(e=0,f=n.layers;e<f.length;e++)k=f[e],r.set(k.id,k);if(g)for(e=0,f=g.visibleLayers;e<f.length;e++)w.add(f[e]);t(a,function(a){n&&a.read(r.get(a.id),n.context);g&&a.read({defaultVisibility:w.has(a.id)},g.context)});return{origin:c.idToName(d),sublayers:new v({items:a})}};
k.prototype.read=function(a,b){this.inherited(arguments);this.readSublayers(a,b)};k.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.remove("sublayers-owner"));a&&(a.forEach(function(a){a.parent=c;a.layer=c}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(a.on("before-changes",
function(a){x.error(new d("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:c}));a.preventDefault()}),"sublayers-owner"))};h([n.property({readOnly:!0})],k.prototype,"allSublayers",void 0);h([n.property({readOnly:!0,type:a.ofType(r)})],k.prototype,"serviceSublayers",void 0);h([n.property({value:null,type:v,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],k.prototype,"sublayers",void 0);h([n.property({readOnly:!0})],k.prototype,
"sublayersSourceJSON",void 0);return k=h([n.subclass("esri.layers.mixins.SublayersOwner")],k)}(n.declared(b))}})},"esri/layers/support/Sublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/assignHelper ../../geometry ../../PopupTemplate ../../renderers ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/lang ../../core/Loadable ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ./commonProperties ./FeatureType ./Field ./FieldsIndex ./fieldUtils ./LabelClass ./layerSourceUtils ../../renderers/support/jsonUtils ../../support/popupUtils ../../tasks/support/Query".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O){function Q(a){return a&&"esriSMS"===a.type}function T(a,b,c){return{ignoreOrigin:!0,enabled:c&&c.writeSublayerStructure||!1}}function Y(a,b,c){return{enabled:c&&c.writeSublayerStructure||!1}}var N=y.getLogger("esri.layers.support.Sublayer"),Z=0,W=new Set;W.add("layer");W.add("parent");W.add("loaded");W.add("loadStatus");W.add("loadError");W.add("loadWarnings");return function(b){function h(a){a=b.call(this,a)||this;a.fields=
null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.title=null;a.typeIdField=null;a.types=null;return a}l(h,b);m=h;h.prototype.load=function(b){return e(this,void 0,void 0,function(){var c=this;return a(this,function(f){this.addResolvingPromise(function(){return e(c,void 0,void 0,function(){var c,e;return a(this,function(a){switch(a.label){case 0:if(!this.layer)throw new u("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",
{sublayer:this});c=null;return 2<this.originIdOf("url")||P.isDataLayerSource(this.source)?[4,g(this.url,d({responseType:"json",query:{f:"json"}},b))]:[3,2];case 1:return e=a.sent(),c=e.data,[3,4];case 2:return[4,this.layer.fetchSublayerInfo(this.id,b)];case 3:c=a.sent(),a.label=4;case 4:return c&&this.read({layerDefinition:c},{origin:"service"}),[2]}})})}());return[2,this]})})};Object.defineProperty(h.prototype,"definitionExpression",{set:function(a){this._setAndNotifyLayer("definitionExpression",
a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"fieldsIndex",{get:function(){return new K(this.fields||[])},enumerable:!0,configurable:!0});h.prototype.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeGlobalID"===c.type)return c.name}};Object.defineProperty(h.prototype,"id",{get:function(){var a=this._get("id");return null==a?Z++:a},set:function(a){this._get("id")!==
a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"labelingInfo",{set:function(a){this._setAndNotifyLayer("labelingInfo",a)},enumerable:!0,configurable:!0});h.prototype.writeLabelingInfo=function(a,b,c,d){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(function(a){return a.write({},
d)})}})};Object.defineProperty(h.prototype,"labelsVisible",{set:function(a){this._setAndNotifyLayer("labelsVisible",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"layer",{set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(function(b){return b.layer=a})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"listMode",{set:function(a){this._set("listMode",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"minScale",{set:function(a){this._setAndNotifyLayer("minScale",
a)},enumerable:!0,configurable:!0});h.prototype.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&b.layerDefinition.minScale||0};Object.defineProperty(h.prototype,"maxScale",{set:function(a){this._setAndNotifyLayer("maxScale",a)},enumerable:!0,configurable:!0});h.prototype.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};h.prototype.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;
if(b.fields)for(a=0,b=b.fields;a<b.length;a++){var c=b[a];if("esriFieldTypeOID"===c.type)return c.name}};Object.defineProperty(h.prototype,"opacity",{set:function(a){this._setAndNotifyLayer("opacity",a)},enumerable:!0,configurable:!0});h.prototype.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};h.prototype.writeOpacity=function(a,b,c,d){b.layerDefinition={drawingInfo:{transparency:100-100*a}}};h.prototype.writeParent=function(a,
b){b.parentLayerId=this.parent&&this.parent!==this.layer?this.parent.id:-1};Object.defineProperty(h.prototype,"defaultPopupTemplate",{get:function(){return this.createPopupTemplate()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderer",{set:function(a){if(a)for(var b=0,c=a.getSymbols();b<c.length;b++)if(r.isSymbol3D(c[b])){N.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)},enumerable:!0,configurable:!0});h.prototype.readRenderer=
function(a,b,c){if(a=b.layerDefinition.drawingInfo.renderer||void 0)(a=S.read(a,b,c)||void 0)||N.error("Failed to create renderer",{rendererDefinition:b.drawingInfo.renderer,layer:this,context:c});return a};h.prototype.writeRenderer=function(a,b,c,d){b.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};h.prototype.writeWebSceneRenderer=function(a,b,c,d){b.layerDefinition={drawingInfo:{renderer:a.write({},d)}}};Object.defineProperty(h.prototype,"source",{get:function(){return this._get("source")||
{mapLayerId:this.id,type:P.MAPLAYER}},set:function(a){this._setAndNotifyLayer("source",a)},enumerable:!0,configurable:!0});h.prototype.writeSource=function(a,b){b.layerDefinition={source:P.sourceToJSON(a)}};Object.defineProperty(h.prototype,"sublayers",{set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)},enumerable:!0,configurable:!0});h.prototype.castSublayers=function(a){return C.default(p.ofType(m),a)};h.prototype.writeSublayers=function(a,b,c){this.get("sublayers.length")&&
(b[c]=this.sublayers.map(function(a){return a.id}).toArray().reverse())};h.prototype.readTypeIdField=function(a,b){b=b.layerDefinition||b;if(a=b.typeIdField)if(b=H.getField(b.fields,a))return b.name;return null};Object.defineProperty(h.prototype,"url",{get:function(){var a=this.layer,b=this.source;if(!a)return null;if(P.isMapLayerSource(b))return a.parsedUrl.path+"/"+b.mapLayerId;b={layer:JSON.stringify({source:P.sourceToJSON(this.source)})};return a.parsedUrl.path+"/dynamicLayer?"+A.objectToQuery(b)},
set:function(a){a?this._override("url",a):this._clearOverride("url")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"visible",{set:function(a){this._setAndNotifyLayer("visible",a)},enumerable:!0,configurable:!0});h.prototype.writeVisible=function(a,b,c,d){b[c]=this.getAtOrigin("defaultVisibility","service")||a};h.prototype.clone=function(){var a=E.getProperties(this).store,b=new m;E.getProperties(b).store=a.clone(W);return b};h.prototype.createPopupTemplate=function(a){return R.createPopupTemplate(this,
a)};h.prototype.createQuery=function(){return new O({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};h.prototype.createFeatureLayer=function(){return e(this,void 0,void 0,function(){var b,c,d,e,g;return a(this,function(a){switch(a.label){case 0:if(this.hasOwnProperty("sublayers"))return[2,null];b=this.layer&&this.layer.parsedUrl;c=this.source;d=null;b&&(d=P.isMapLayerSource(c)?b.path+"/"+c.mapLayerId:b.path+"/dynamicLayer");return[4,w.create(function(a){return q(["../FeatureLayer"],
a)})];case 1:return e=a.sent(),g=new e({url:d}),this.definitionExpression&&(g.definitionExpression=this.definitionExpression),2<this.originIdOf("labelingInfo")&&(g.labelingInfo=x.clone(this.labelingInfo)),0<this.originIdOf("labelsVisible")&&(g.labelsVisible=this.labelsVisible),0<this.originIdOf("legendEnabled")&&(g.legendEnabled=this.legendEnabled),0<this.originIdOf("visible")&&(g.visible=this.visible),0<this.originIdOf("minScale")&&(g.minScale=this.minScale),0<this.originIdOf("maxScale")&&(g.maxScale=
this.maxScale),0<this.originIdOf("opacity")&&(g.opacity=this.opacity),0<this.originIdOf("popupTemplate")&&(g.popupTemplate=x.clone(this.popupTemplate)),2<this.originIdOf("renderer")&&(g.renderer=x.clone(this.renderer)),P.isDataLayerSource(this.source)&&(g.dynamicDataSource=x.clone(this.source)),0<this.originIdOf("title")&&(g.title=this.title),[2,g]}})})};h.prototype.getFeatureType=function(a){var b=this.typeIdField;if(!b||!a)return null;var c=a.attributes?a.attributes[b]:void 0;if(null==c)return null;
var d=null;this.types.some(function(a){var b=a.id;if(null==b)return!1;b.toString()===c.toString()&&(d=a);return!!d});return d};h.prototype.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};h.prototype.queryFeatures=function(a,b){var c=this;void 0===a&&(a=this.createQuery());return w.all([w.create(function(a){return q(["../../tasks/operations/query"],a)}),w.create(function(a){return q(["../../tasks/support/FeatureSet"],
a)})]).then(function(d){var e=d[0].executeQuery,g=d[1];return e(c.url,O.from(a),b).then(function(a){return g.fromJSON(a.data)})}).then(function(a){a&&a.features&&a.features.forEach(function(a){a.sourceLayer=c});return a})};h.prototype.toExportImageJSON=function(){var a=this,b={id:this.id,source:P.sourceToJSON(this.source)};this.definitionExpression&&(b.definitionExpression=this.definitionExpression);var c=["renderer","labelingInfo","opacity","labelsVisible"].reduce(function(b,c){b[c]=a.originIdOf(c);
return b},{});if(Object.keys(c).some(function(a){return 2<=c[a]})){var d=b.drawingInfo={};2<=c.renderer&&(d.renderer=this.renderer?this.renderer.toJSON():null);2<=c.labelsVisible&&(d.showLabels=this.labelsVisible);this.labelsVisible&&2<=c.labelingInfo&&(d.labelingInfo=this.labelingInfo?this.labelingInfo.map(function(a){return a.write({},{origin:"service"})}):null,d.showLabels=!0);2<=c.opacity&&(d.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(d.renderer)}return b};h.prototype._assignDefaultSymbolColors=
function(a){this._forEachSimpleMarkerSymbols(a,function(a){a.color||"esriSMSX"!==a.style&&"esriSMSCross"!==a.style||(a.color=a.outline&&a.outline.color?a.outline.color:[0,0,0,0])})};h.prototype._forEachSimpleMarkerSymbols=function(a,b){if(a){var c=0,d="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(;c<d.length;c++){var e=d[c];Q(e.symbol)&&b(e.symbol)}"symbol"in a&&Q(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&Q(a.defaultSymbol)&&b(a.defaultSymbol)}};h.prototype._setAndNotifyLayer=
function(a,b){var c=this.layer,d=this._get(a),e;switch(a){case "definitionExpression":e="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":e="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":e="supportsDynamicLayers"}e&&!1===this.get("layer.capabilities.exportMap."+e)?this._logLockedError(a,"capability not available 'layer.capabilities.exportMap."+e+"'"):"source"===a&&"not-loaded"!==this.loadStatus?
this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),d!==b&&c&&c.emit&&c.emit("sublayer-update",{propertyName:a}))};h.prototype._handleSublayersChange=function(a,b){var c=this;b&&(b.forEach(function(a){a.parent=null;a.layer=null}),this.handles.removeAll());a&&(a.forEach(function(a){a.parent=c;a.layer=c.layer}),this.handles.add([a.on("after-add",function(a){a=a.item;a.parent=c;a.layer=c.layer}),a.on("after-remove",function(a){a=a.item;a.parent=null;a.layer=
null}),a.on("before-changes",function(a){var b=c.get("layer.capabilities.exportMap.supportsSublayersChanges");null==b||b||(N.error(new u("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:c,layer:c.layer})),a.preventDefault())})]))};h.prototype._logLockedError=function(a,b){N.error(new u("sublayer:locked","Property '"+a+"' can't be changed on Sublayer from the layer '"+this.layer.id+"'",{reason:b,sublayer:this,layer:this.layer}))};
h.prototype._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};var m;f([B.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],h.prototype,"definitionExpression",null);f([B.property({type:[I],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],h.prototype,"fields",void 0);f([B.property({readOnly:!0,dependsOn:["fields"]})],h.prototype,"fieldsIndex",null);f([B.property({type:k.Extent,
json:{read:{source:"layerDefinition.extent"}}})],h.prototype,"fullExtent",void 0);f([B.property({type:String})],h.prototype,"globalIdField",void 0);f([B.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],h.prototype,"readGlobalIdFieldFromService",null);f([B.property({type:Number,json:{write:{ignoreOrigin:!0}}})],h.prototype,"id",null);f([B.property({value:null,type:[L],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},write:{target:"layerDefinition.drawingInfo.labelingInfo",
overridePolicy:Y}}})],h.prototype,"labelingInfo",null);f([B.writer("labelingInfo")],h.prototype,"writeLabelingInfo",null);f([B.property({type:Boolean,value:!0,json:{read:{source:"showLabels"},write:{target:"showLabels",overridePolicy:Y}}})],h.prototype,"labelsVisible",null);f([B.property({value:null})],h.prototype,"layer",null);f([B.property(G.legendEnabled)],h.prototype,"legendEnabled",void 0);f([B.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,
write:!0}}}})],h.prototype,"listMode",null);f([B.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:T}}})],h.prototype,"minScale",null);f([B.reader("minScale",["minScale","layerDefinition.minScale"])],h.prototype,"readMinScale",null);f([B.property({type:Number,value:0,json:{write:{enabled:!1,overridePolicy:T}}})],h.prototype,"maxScale",null);f([B.reader("maxScale",["maxScale","layerDefinition.maxScale"])],h.prototype,"readMaxScale",null);f([B.property({type:String})],h.prototype,
"objectIdField",void 0);f([B.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],h.prototype,"readObjectIdFieldFromService",null);f([B.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:Y}}})],h.prototype,"opacity",null);f([B.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],h.prototype,"readOpacity",null);f([B.writer("opacity")],h.prototype,"writeOpacity",
null);f([B.property({json:{type:Number,write:{target:"parentLayerId",allowNull:!0,overridePolicy:T}}})],h.prototype,"parent",void 0);f([B.writer("parent")],h.prototype,"writeParent",null);f([B.property(G.popupEnabled)],h.prototype,"popupEnabled",void 0);f([B.property({type:n,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],h.prototype,"popupTemplate",void 0);f([B.property({readOnly:!0,dependsOn:["fields","title"]})],h.prototype,"defaultPopupTemplate",null);f([B.property({types:c.rendererTypes,
value:null,json:{write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:Y}}})],h.prototype,"renderer",null);f([B.reader("renderer",["layerDefinition.drawingInfo.renderer"])],h.prototype,"readRenderer",null);f([B.writer("renderer")],h.prototype,"writeRenderer",null);f([B.writer("web-scene","renderer",{"layerDefinition.drawingInfo.renderer":{types:c.webSceneRendererTypes}})],h.prototype,"writeWebSceneRenderer",null);f([B.property({cast:P.castSource,json:{read:{source:"layerDefinition.source",
reader:P.sourceFromJSON},write:{target:"layerDefinition.source",overridePolicy:T}}})],h.prototype,"source",null);f([B.writer("source")],h.prototype,"writeSource",null);f([B.property({value:null,json:{type:[C.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:T}}})],h.prototype,"sublayers",null);f([B.cast("sublayers")],h.prototype,"castSublayers",null);f([B.writer("sublayers")],h.prototype,"writeSublayers",null);f([B.property({type:String,json:{read:{source:"name"},write:{target:"name",
allowNull:!0}}})],h.prototype,"title",void 0);f([B.property({type:String})],h.prototype,"typeIdField",void 0);f([B.reader("typeIdField",["layerDefinition.typeIdField"])],h.prototype,"readTypeIdField",null);f([B.property({type:[J],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],h.prototype,"types",void 0);f([B.property({type:String,dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:function(){return{enabled:this._isOverridden("url")}}}}})],
h.prototype,"url",null);f([B.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:T}}})],h.prototype,"visible",null);f([B.writer("visible")],h.prototype,"writeVisible",null);return h=m=f([B.subclass("esri.layers.support.Sublayer")],h)}(B.declared(t.HandleOwnerMixin(m.MultiOriginJSONMixin(v))))})},"esri/layers/support/sublayerUtils":function(){define(["require","exports","./layerSourceUtils"],function(q,b,l){function f(a,b,d){return a.some(function(a){var b=
a.source;return!(!b||b.type===l.MAPLAYER&&b.mapLayerId===a.id&&(!b.gdbVersion||b.gdbVersion===d.gdbVersion))||2<a.originIdOf("renderer")||2<a.originIdOf("labelingInfo")||2<a.originIdOf("opacity")||2<a.originIdOf("labelsVisible")})?!0:!h(a,b)}function h(a,b){if(!a||!a.length)return!0;b=b.slice().reverse().flatten(function(a){return(a=a.sublayers)&&a.toArray().reverse()}).map(function(a){return a.id}).toArray();if(a.length>b.length)return!1;for(var d=0,e=b.length,f=0;f<a.length;f++){for(var c=a[f].id;d<
e&&b[d]!==c;)d++;if(d>=e)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.shouldWriteSublayerStructure=function(a,b,d){var e=b.flatten(function(a){return a.sublayers}).length,h=a.some(function(a){return 2<a.originIdOf("minScale")||2<a.originIdOf("maxScale")});return e!==a.length||h||f(a,b,d)};b.isExportDynamic=f;b.isSublayerOverhaul=function(a){return!!a&&a.some(function(a){return null!=a.minScale||a.layerDefinition&&null!=a.layerDefinition.minScale})}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L){return function(b){function c(a,c){a=b.call(this,a)||this;a._spriteSourceMap=new Map;a.currentStyleInfo=null;a.style=null;a.isReference=null;a.operationalLayerType="VectorTileLayer";a.type="vector-tile";a.url=null;return a}f(c,b);c.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};c.prototype.prefetchResources=function(b){return e(this,void 0,void 0,function(){return a(this,function(a){switch(a.label){case 0:return[4,
this.loadSpriteSource(n.devicePixelRatio||1,b)];case 1:return a.sent(),[2]}})})};c.prototype.load=function(b){var c=this,g=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},b).then(function(){return e(c,void 0,void 0,function(){var c,e;return a(this,function(a){switch(a.label){case 0:if(!this.portalItem||!this.portalItem.id)return[2];c=this.portalItem.itemUrl+"/resources/styles/root.json";return[4,d(c,l({},b,{query:{f:"json"}}))];case 1:return e=a.sent(),e.data&&this.read({url:c},
I.createForItem(this.portalItem)),[2]}})})}).then(function(){return c._loadStyle(b)},function(){return c._loadStyle(b)});this.addResolvingPromise(g);return this.when()};Object.defineProperty(c.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&p.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?
a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parsedUrl",{get:function(){return this.serviceUrl?r.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});c.prototype.writeStyleUrl=function(a,b){a&&p.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};Object.defineProperty(c.prototype,
"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileInfo",{get:function(){var a=[],b;for(b in this.sourceNameToSource)a.push(this.sourceNameToSource[b]);b=this._getPrimarySource().tileInfo;if(1<a.length)for(var c=0;c<a.length;c++)H.areSchemasOverlapping(b,
a[c].tileInfo)&&(b=H.unionTileInfos(b,a[c].tileInfo));return b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});c.prototype.readVersion=function(a,b){return b.version?
parseFloat(b.version):parseFloat(b.currentVersion)};Object.defineProperty(c.prototype,"compatibleTileInfo256",{get:function(){return K.create256x256CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"compatibleTileInfo512",{get:function(){return K.create512x512CompatibleTileInfo(this.tileInfo)},enumerable:!0,configurable:!0});c.prototype.loadSpriteSource=function(b,c){void 0===b&&(b=1);return e(this,void 0,void 0,function(){var d,e;return a(this,function(a){this._spriteSourceMap.has(b)||
(d=new C.default(this.styleRepository.sprite,b),this._spriteSourceMap.set(b,d.load()));e=this._spriteSourceMap.get(b);return[2,g.create(function(a,b){e.then(a,b);g.onAbortOrThrow(c,b)})]})})};c.prototype.loadStyle=function(b,c){return e(this,void 0,void 0,function(){var d,e,f,k=this;return a(this,function(a){d=b||this.style||this.url;if(this._loadingPromise&&"string"===typeof d&&this.url===d&&!g.isAborted(this._abortController))return[2,this._loadingPromise];(e=this._abortController)&&e.abort();f=
g.createAbortController();this._loadingPromise=g.create(function(a,b){var e={signal:f.signal};k._spriteSourceMap.clear();k._getSourceAndStyle(d,e).then(a,b);g.onAbort(c,function(){f.abort()})});this._abortController=f;return[2,this._loadingPromise]})})};c.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};c.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};c.prototype.setPaintProperties=function(a,b){var c=this.styleRepository.isPainterDataDriven(a),
d=this.styleRepository.setPaintProperties(a,b),e=this.styleRepository.isPainterDataDriven(a);this.emit("paint-change",{layer:d,paint:b});(c||e)&&this.emit("layout-change",{layer:d,layout:this.styleRepository.getLayoutProperties(a)})};c.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};c.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};c.prototype.getTileUrl=function(a,
b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};c.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new k("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};c.prototype._getSourceAndStyle=function(b,c){return e(this,
void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:if(!b)throw Error("invalid style!");return[4,J.loadMetadata(b,c)];case 1:return d=a.sent(),this._set("currentStyleInfo",{serviceUrl:d.serviceUrl,styleUrl:d.styleUrl,spriteUrl:d.spriteUrl,glyphsUrl:d.glyphsUrl,style:d.style,layerDefinition:d.layerDefinition}),"string"===typeof b?(this.url=b,this.style=null):(this.url=null,this.style=b),this._set("sourceNameToSource",d.sourceNameToSource),this._set("primarySourceName",d.primarySourceName),
this._set("styleRepository",new L(d.style,d)),this.read(d.layerDefinition,{origin:"service"}),[2]}})})};c.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<
d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return p.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};c.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};c.prototype._loadStyle=function(b){return e(this,void 0,void 0,function(){return a(this,function(a){return this._loadingPromise?[2,this._loadingPromise]:[2,this.loadStyle(null,b)]})})};h([u.property({readOnly:!0,
dependsOn:["currentStyleInfo"]})],c.prototype,"attributionDataUrl",null);h([u.property({type:["show","hide"]})],c.prototype,"listMode",void 0);h([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"capabilities",null);h([u.property({readOnly:!0})],c.prototype,"currentStyleInfo",void 0);h([u.property({json:{read:!1},readOnly:!0,type:t,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"fullExtent",null);h([u.property()],c.prototype,
"style",void 0);h([u.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],c.prototype,"isReference",void 0);h([u.property({type:["VectorTileLayer"]})],c.prototype,"operationalLayerType",void 0);h([u.property({readOnly:!0,dependsOn:["serviceUrl"]})],c.prototype,"parsedUrl",null);h([u.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],c.prototype,"serviceUrl",null);h([u.property({type:x,dependsOn:["tileInfo"],readOnly:!0})],c.prototype,"spatialReference",
null);h([u.property({readOnly:!0})],c.prototype,"styleRepository",void 0);h([u.property({readOnly:!0})],c.prototype,"sourceNameToSource",void 0);h([u.property({readOnly:!0})],c.prototype,"primarySourceName",void 0);h([u.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],c.prototype,"styleUrl",null);h([u.writer(["portal-item","web-document"],"styleUrl")],c.prototype,"writeStyleUrl",null);
h([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileIndexType",null);h([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileIndexUrl",null);h([u.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:E,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileInfo",null);h([u.property({json:{read:!1},readOnly:!0,type:G.TilemapCache,dependsOn:["sourceNameToSource",
"primarySourceName"]})],c.prototype,"tilemapCache",null);h([u.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],c.prototype,"tileServers",null);h([u.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],c.prototype,"type",void 0);h([u.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],c.prototype,"url",void 0);h([u.property({readOnly:!0})],c.prototype,"version",void 0);h([u.reader("version",
["version","currentVersion"])],c.prototype,"readVersion",null);h([u.property({readOnly:!0,dependsOn:["tileInfo"]})],c.prototype,"compatibleTileInfo256",null);h([u.property({readOnly:!0,dependsOn:["tileInfo"]})],c.prototype,"compatibleTileInfo512",null);return c=h([u.subclass("esri.layers.VectorTileLayer")],c)}(u.declared(B.ScaleRangeLayer(y.ArcGISCachedService(m.ArcGISService(w.OperationalLayer(A.PortalLayer(c.MultiOriginJSONMixin(v))))))))})},"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/promiseUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});var r=c.getLogger("esri.layers.support.SpriteSource");q=function(){function b(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(b.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});b.prototype.getSpriteInfo=
function(a){return this._spritesData[a]};b.prototype.load=function(b){return e(this,void 0,void 0,function(){return a(this,function(a){switch(a.label){case 0:g.throwIfAborted(b);this.loadStatus="loading";if(!this.baseURL)return[2,g.resolve(this)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._loadSprites(b)];case 2:return a.sent(),this.loadStatus="loaded",[3,4];case 3:return a.sent(),this.loadStatus="failed",[3,4];case 4:return[2,this]}})})};b.prototype._loadSprites=function(a){var b=this;
this._isRetina=1.15<this.devicePixelRatio?!0:!1;var c=this.baseURL,e=this._isRetina?"@2x":"",f=""+c+e+".png";return g.all([d(c+e+".json",a),d(f,h({responseType:"image"},a))]).then(function(a){var d=a[0];a=a[1];var e=Object.keys(d.data);if(!e||0===e.length||1===e.length&&"_ssl"===e[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=b.height=0,g.resolve(null);b._spritesData=d.data;d=a.data;a=Math.max(n("esri-webgl-max-texture-size"),4096);if(d.width>a||d.height>a)throw d="Sprite resource for style "+
c+" is bigger than the maximum allowed of "+a+" pixels}",r.error(d),new k("SpriteSource",d);b.width=d.width;b.height=d.height;a=document.createElement("canvas");e=a.getContext("2d");a.width=d.width;a.height=d.height;e.drawImage(d,0,0,d.width,d.height);d=e.getImageData(0,0,d.width,d.height);d=new Uint8Array(d.data);for(e=0;e<d.length;e+=4)a=d[e+3]/255,d[e]*=a,d[e+1]*=a,d[e+2]*=a;b.image=d})};return b}();b.default=q})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(q,b,l,f,h,a,e,d,k,n){function c(a){a&&(a=k.getOrigin(a),t&&-1===t.indexOf(a)&&t.push(a))}function g(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)k.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=k.isAbsolute(a[c])?a[c]:k.join(b,a[c]);return k.removeTrailingSlash(b)}function r(a,b,g,m,n){return h(this,void 0,void 0,function(){var h,r,w,t,v,y;return f(this,function(f){switch(f.label){case 0:d.throwIfAborted(n);if("string"!==
typeof g)return[3,2];t=k.normalize(g);c(t);v=k.urlToObject(t);return[4,e(v.path,l({query:{f:"json"},responseType:"json"},n))];case 1:return w=f.sent(),r=h=t,[3,3];case 2:w={data:g},h=g.jsonUrl||null,r=m,f.label=3;case 3:return y=w.data,w.ssl&&(h&&(h=h.replace(/^http:/i,"https:")),r&&(r=r.replace(/^http:/i,"https:"))),y.sources?(a.styleUrl=h||null,[2,p(a,y,r,n)]):y.sources?[2,d.reject("You must specify the URL or the JSON for a service or for a style.")]:a.sourceUrl?[2,u(a,y,r,!1,b,n)]:(a.sourceUrl=
h||null,[2,u(a,y,r,!0,b,n)])}})})}function p(a,b,e,m){return h(this,void 0,void 0,function(){var h,n,p,l,t,u;return f(this,function(f){switch(f.label){case 0:h=e?k.removeFile(e):k.appBaseUrl;a.styleBase=h;a.style=b;a.styleUrl&&c(a.styleUrl);n=[];if(!b.sources||!b.sources.esri)return[3,3];p=b.sources.esri;return p.url?[4,r(a,"esri",g(h,p.url),void 0,m)]:[3,2];case 1:return f.sent(),[3,3];case 2:n.push(r(a,"esri",p,h,m)),f.label=3;case 3:l=0;for(t=Object.keys(b.sources);l<t.length;l++)u=t[l],"esri"!==
u&&"vector"===b.sources[u].type&&(b.sources[u].url?n.push(r(a,u,g(h,b.sources[u].url),void 0,m)):n.push(r(a,u,b.sources[u],h,m)));return[4,d.all(n)];case 4:return f.sent(),[2]}})})}function u(a,b,e,m,p,l){return h(this,void 0,void 0,function(){var h,w,t,u;return f(this,function(f){h=e?k.removeTrailingSlash(e)+"/":k.appBaseUrl;f=h;if(b.hasOwnProperty("tileInfo"))w=b;else{for(var v={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},
y=78271.51696400007,x=2.958287637957775E8,A=[],q=b.hasOwnProperty("minzoom")?parseFloat(b.minzoom):0,B=b.hasOwnProperty("maxzoom")?parseFloat(b.maxzoom):16,C=0;C<=B;C++)C>=q&&A.push({level:C,scale:x,resolution:y}),y/=2,x/=2;y=0;for(x=b.tiles;y<x.length;y++)c(g(f,x[y]));w={capabilities:"TilesOnly",initialExtent:v,fullExtent:v,minScale:A[0].scale,maxScale:A[A.length-1].scale,tiles:b.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:A,spatialReference:{wkid:102100}}}}t=
new n(p,h,w);if(!m&&a.primarySourceName in a.sourceNameToSource){u=a.sourceNameToSource[a.primarySourceName];if(!u.isCompatibleWith(t))return[2,d.resolve()];null!=t.fullExtent&&(null!=u.fullExtent?u.fullExtent.union(t.fullExtent):u.fullExtent=t.fullExtent.clone());u.tileInfo.lods.length<t.tileInfo.lods.length&&(u.tileInfo=t.tileInfo)}m?(a.sourceBase=h,a.source=b,a.validatedSource=w,a.primarySourceName=p,a.sourceUrl&&c(a.sourceUrl)):c(h);a.sourceNameToSource[p]=t;return a.style?[2]:null==b.defaultStyles?
[2,d.reject()]:"string"===typeof b.defaultStyles?[2,r(a,"",g(h,b.defaultStyles,"root.json"),void 0,l)]:[2,r(a,"",b.defaultStyles,g(h,"root.json"),l)]})})}Object.defineProperty(b,"__esModule",{value:!0});var t=a.defaults&&a.defaults.io.corsEnabledServers;b.loadMetadata=function(a,b){return h(this,void 0,void 0,function(){var d,e,h,n,p,l;return f(this,function(f){switch(f.label){case 0:return d={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,
sourceNameToSource:{},primarySourceName:""},e="string"===typeof a?[a,null]:[null,a.jsonUrl],h=e[0],n=e[1],p=h?k.urlToObject(h):null,[4,r(d,"esri",a,n,b)];case 1:return f.sent(),l={layerDefinition:d.validatedSource,url:h,parsedUrl:p,serviceUrl:d.sourceUrl,style:d.style,styleUrl:d.styleUrl,spriteUrl:d.style.sprite&&g(d.styleBase,d.style.sprite),glyphsUrl:d.style.glyphs&&g(d.styleBase,d.style.glyphs),sourceNameToSource:d.sourceNameToSource,primarySourceName:d.primarySourceName},c(l.spriteUrl),c(l.glyphsUrl),
[2,l]}})})}})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../../../core/tsSupport/generatorHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/lang ../../../../../core/urlUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),function(q,b,l,f,h,a,e,d,k,n){return function(){function b(b,c,f){this.tileMapURL="";this.fullExtent=
this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=b;if(this.sourceUrl=c)this.parsedUrl=a.urlToObject(this.sourceUrl);b=h.clone(f);var g=b.tiles;c&&g.forEach(function(b,d){a.isAbsolute(b)||(g[d]=a.join(c,b))});this.tileServers=g;f.tileMap&&(this.tileMapURL=a.join(c,f.tileMap));var p=f.capabilities&&f.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),l=!!f.exportTilesAllowed,p=!!p&&-1!==p.indexOf("tilemap"),r=l&&f.hasOwnProperty("maxExportTilesCount")?
f.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:l,supportsTileMap:p},exportTiles:l?{maxExportTilesCount:+r}:null};this.tileInfo=d.readServiceTileInfo(b.tileInfo,b,null,{ignoreMinMaxLOD:!0});p&&(this.type="vector-tile",this.tilemapCache=new k.TilemapCache({layer:this}),this.tileIndex=new n(this.tilemapCache));this.fullExtent=e.fromJSON(f.fullExtent)}b.prototype.getRefKey=function(a,b){return f(this,void 0,void 0,function(){return l(this,function(c){return this.tileIndex?
[2,this.tileIndex.dataKey(a,b)]:[2,a]})})};b.prototype.getSourceTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};b.prototype.isCompatibleWith=function(a){var b=this.tileInfo;a=a.tileInfo;if(!b.spatialReference.equals(a.spatialReference)||!b.origin.equals(a.origin)||Math.round(b.dpi)!==Math.round(a.dpi))return!1;b=b.lods;a=a.lods;for(var c=Math.min(b.length,a.length),
d=0;d<c;d++){var e=b[d],g=a[d];if(e.level!==g.level||Math.round(e.scale)!==Math.round(g.scale))return!1}return!0};return b}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["require","exports","../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(q,b,l,f,h){return function(){function a(a){if(a instanceof f.TilemapCache)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}a.prototype.dataKey=
function(a,b){if(this._tilemapCache){var d=a.level,e=a.row,c=a.col,g=new h(a);return this._tilemapCache.fetchAvailabilityUpsample(d,e,c,g,b).then(function(){return g}).catch(function(a){if(l.isAbortError(a))throw a;g.level=d;g.row=e;g.col=c;return g})}return this._getIndexedDataKey(a)};a.prototype.forEach=function(a,b,f,h,c){this._callback=c;this._maxLevel=b+a;this._forEach(this._tilemap,b,f,h)};a.prototype._forEach=function(a,b,f,h){0!==a&&(this._callback(b,f,h),b!==this._maxLevel&&"object"===typeof a&&
(this._forEach(a[0],b+1,2*f,2*h),this._forEach(a[1],b+1,2*f,2*h+1),this._forEach(a[2],b+1,2*f+1,2*h),this._forEach(a[3],b+1,2*f+1,2*h+1)))};a.prototype._getIndexedDataKey=function(a){var b=[a];if(0>a.level||0>a.row||0>a.col||0<a.row>>a.level||0<a.col>>a.level)return l.resolve(null);for(;0!==a.level;)a=new h(a.level-1,a.row>>1,a.col>>1,a.world),b.push(a);a=this._tilemap;var e=b.pop(),f,c;if(1===a)return l.resolve(e);for(;b.length;)if(f=b.pop(),c=(f.col&1)+((f.row&1)<<1),a){if(0===a[c]){e=null;break}if(1===
a[c]){e=f;break}e=f;a=a[c]}return l.resolve(e)};return a}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.createForItem=function(b){return{origin:"portal-item",url:l.urlToObject(b.itemUrl),portal:b.portal||f.getDefault()}}})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["require","exports","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],
function(q,b,l,f){return function(){function b(a,b){this.lockedSchemaPixelSize=a;this.isGCS=b}b.prototype.getLevelRowColumn=function(a){return this.isGCS?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};b.prototype.adjustLevel=function(a){return this.isGCS?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};b.prototype.getShift=function(a,b){var d=0,e=0;if(256===this.lockedSchemaPixelSize||this.isGCS)a[2]%2&&(d=b),a[1]%2&&(e=b);return[d,e]};b.prototype.getScale=
function(a){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===a)return 1;return 2};b.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.size[0]&&256===a.size[1])return a;for(var b=a.spatialReference.isGeographic,d=[],k=a.lods.length,h=0;h<k;h++){var c=a.lods[h];d.push(new l({level:c.level,scale:c.scale,resolution:b?c.resolution:2*c.resolution}))}return new f({size:[256,256],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,
origin:a.origin,spatialReference:a.spatialReference,lods:d})};b.create512x512CompatibleTileInfo=function(a){if(!a||256===a.size[0]||256===a.size[1])return null;for(var b=[],d=a.lods.length,k=0;k<d;k++){var h=a.lods[k];b.push(new l({level:h.level,scale:h.scale,resolution:.5*h.resolution}))}return new f({size:[512,512],dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:b})};return b}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["require",
"exports","../../../../layers/support/TileInfo"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.areSchemasOverlapping=function(b,h){if(b===h)return!0;if(!b&&null!=h||null!=b&&!h||!b.spatialReference.equals(h.spatialReference)||b.dpi!==h.dpi)return!1;var a=b.origin,e=h.origin;if(1E-6<=Math.abs(a.x-e.x)||1E-6<=Math.abs(a.y-e.y))return!1;b.lods[0].scale>h.lods[0].scale?(a=b,b=h):a=h;for(h=a.lods[0].scale;h>=b.lods[b.lods.length-1].scale-1E-6;h/=2)if(1E-6>Math.abs(h-b.lods[0].scale))return!0;
return!1};b.unionTileInfos=function(b,h){if(b===h)return b;if(!b&&null!=h)return h;if(null!=b&&!h)return b;var a=b.size[0],e=b.format,d=b.dpi,f={x:b.origin.x,y:b.origin.y},n=b.spatialReference.toJSON(),c=b.lods[0].scale>h.lods[0].scale?b.lods[0]:h.lods[0];b=(b.lods[b.lods.length-1].scale<=h.lods[h.lods.length-1].scale?b.lods[b.lods.length-1]:h.lods[h.lods.length-1]).scale;h=[];for(var g=c.scale,c=c.resolution,r=0;g>b;)h.push({level:r,resolution:c,scale:g}),r++,g/=2,c/=2;return new l({size:[a,a],dpi:d,
format:e||"pbf",origin:f,lods:h,spatialReference:n})}})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../../../core/has","./StyleLayer"],function(q,b,l,f){return function(){function b(a,e){this.backgroundBucketIds=[];this._layerByName={};this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=e?e.spriteUrl:a.sprite;this.glyphs=e?e.glyphsUrl:a.glyphs;if(this.layers=(a.layers||[]).map(b._create))for(a=void 0,e=0;e<this.layers.length;e++)a=
this.layers[e],this._layerByName[a.id.toLowerCase()]=a,0===a.type&&this.backgroundBucketIds.push(e);this._identifyRefLayers()}b.prototype.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};b.prototype.getStyleLayerId=function(a){return a>=this.layers.length?null:this.layers[a].id};b.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};b.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?
a.paint:null};b.prototype.setPaintProperties=function(a,e){a=this._layerByName[a.toLowerCase()];if(!a)return"";var d=this.layers.indexOf(a);this.styleJSON.layers[d].paint=e;e=b._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:a.layout,paint:e},a);this.layers[d]=e;this._layerByName[a.id.toLowerCase()]=e;return a.id};b.prototype.setLayoutProperties=function(a,e){a=this._layerByName[a.toLowerCase()];if(!a)return"";
var d=this.layers.indexOf(a);this.styleJSON.layers[d].layout=e;e=b._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:e,paint:a.paint},a);this.layers[d]=e;this._layerByName[a.id.toLowerCase()]=e;return a.id};b.prototype._identifyRefLayers=function(){for(var a=[],b=[],d=0,f=0,h=this.layers;f<h.length;f++){var c=h[f];if(1===c.type){var g=c,l=c.source+"|"+c.sourceLayer,l=l+("|"+JSON.stringify(c.layout&&c.layout.visibility)),
l=l+("|"+JSON.stringify(c.minzoom)),l=l+("|"+JSON.stringify(c.maxzoom)),l=l+("|"+JSON.stringify(c.filter));if(g.hasDataDrivenFill||g.hasDataDrivenOutline)l+="|"+JSON.stringify(d);a.push({key:l,layer:c})}2===c.type&&(g=c,l=c.source+"|"+c.sourceLayer,l+="|"+JSON.stringify(c.layout&&c.layout.visibility),l+="|"+JSON.stringify(c.minzoom),l+="|"+JSON.stringify(c.maxzoom),l+="|"+JSON.stringify(c.filter),l+="|"+JSON.stringify(c.layout&&c.layout["line-cap"]),l+="|"+JSON.stringify(c.layout&&c.layout["line-join"]),
g.hasDataDrivenLine&&(l+="|"+JSON.stringify(d)),b.push({key:l,layer:c}));++d}this._assignRefLayers(a);this._assignRefLayers(b)};b.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,d,f=a.length,h=0;h<f;h++){var c=a[h];if(c.key===b)c.layer.refLayerId=d;else if(b=c.key,d=c.layer.id,1===c.layer.type&&!c.layer.getPaintProperty("fill-outline-color"))for(var g=h+1;g<f;g++){var l=a[g];if(l.key===b){if(l.layer.getPaintProperty("fill-outline-color")){a[h]=
l;a[g]=c;d=l.layer.id;break}}else break}}};b._create=function(a,b,d){b=1-1/(d.length+1)*(1+b);switch(a.type){case "background":return new f.BackgroundStyleLayer(0,a,b);case "fill":return new f.FillStyleLayer(1,a,b);case "line":return new f.LineStyleLayer(2,a,b);case "symbol":return new f.SymbolStyleLayer(3,a,b);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new f.CircleStyleLayer(4,a,b)}throw Error("Unknown vector tile layer");};b._recreateLayer=function(a,
b){switch(a.type){case "background":return new f.BackgroundStyleLayer(0,a,b.z);case "fill":return new f.FillStyleLayer(1,a,b.z);case "line":return new f.LineStyleLayer(2,a,b.z);case "symbol":return new f.SymbolStyleLayer(3,a,b.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new f.CircleStyleLayer(4,a,b.z)}};return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,d){this.type=a;this.typeName=b.type;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=d;switch(a){case 0:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=
h.StyleDefinition.fillLayoutDefinition;this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition;this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=
this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}b.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=f.createFilter(this.filter)};b.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};b.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};b.prototype.getLayoutValue=function(a,b,d){var c,e=this._layoutProperties;e&&(e=e[a])&&(c=e.getValue(b,
d));a=this._layoutDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};b.prototype.getPaintValue=function(a,b,d){var c,e=this._paintProperties;e&&(e=e[a])&&(c=e.getValue(b,d));a=this._paintDefinition[a];void 0===c&&(c=a["default"]);"enum"===a.type&&(c=a.values.indexOf(c));return c};b.prototype.isPainterDataDriven=function(){var a=this._paintProperties;if(a)for(var b in a)if(a[b].isDataDriven)return!0;return!1};b.prototype._parseLayout=function(b){var c={},
d;for(d in b){var e=this._layoutDefinition[d];e&&(c[d]=new a(e,b[d]))}return c};b.prototype._parsePaint=function(b){var c={},d;for(d in b){var e=this._paintDefinition[d];e&&(c[d]=new a(e,b[d]))}return c};return b}();b.StyleLayer=q;var d=function(a){function b(b,d,e){return a.call(this,b,d,e)||this}l(b,a);return b}(q);b.BackgroundStyleLayer=d;d=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;d=b.getPaintProperty("fill-color");b.hasDataDrivenColor=d?d.isDataDriven:!1;d=b.getPaintProperty("fill-opacity");
b.hasDataDrivenOpacity=d?d.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;d=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=!d;b.hasDataDrivenOutlineColor=d?d.isDataDriven:!1;b.hasDataDrivenOutline=(d?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}l(b,a);return b}(q);b.FillStyleLayer=d;d=function(a){function b(b,d,f){b=a.call(this,b,d,f)||this;f=b.getPaintProperty("line-color");b.hasDataDrivenColor=f?f.isDataDriven:
!1;f=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=f?f.isDataDriven:!1;f=b.getPaintProperty("line-width");b.hasDataDrivenWidth=f?f.isDataDriven:!1;b.hasDataDrivenLine=b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;d=d.paint["line-width"];d||(d=h.StyleDefinition.linePaintDefinition["line-width"].default);b.isThinLine=!b.hasDataDrivenWidth&&"number"===typeof d&&d<e.THIN_LINE_THRESHOLD;return b}l(b,a);return b}(q);b.LineStyleLayer=d;d=function(a){function b(b,d,e){b=a.call(this,
b,d,e)||this;d=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=d?d.isDataDriven:!1;d=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=d?d.isDataDriven:!1;d=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=d?d.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;d=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=d?d.isDataDriven:!1;d=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=d?d.isDataDriven:
!1;d=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=d?d.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}l(b,a);return b}(q);b.SymbolStyleLayer=d;q=function(a){function b(b,d,e){b=a.call(this,b,d,e)||this;d=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-color");b.hasDataDrivenColor=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=
d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=d?d.isDataDriven:!1;d=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=d?d.isDataDriven:!1;return b}l(b,a);return b}(q);b.CircleStyleLayer=q;q=function(){return function(a,b,c){this.cap=a.getLayoutValue("line-cap",b,c);
this.join=a.getLayoutValue("line-join",b,c);this.miterLimit=a.getLayoutValue("line-miter-limit",b,c);this.roundLimit=a.getLayoutValue("line-round-limit",b,c)}}();b.LineLayout=q;q=function(){return function(a,b,c,d){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,d);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,d);this.optional=a.getLayoutValue("icon-optional",b,d);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,d);this.size=a.getLayoutValue("icon-size",
b,d);this.rotate=a.getLayoutValue("icon-rotate",b,d);this.padding=a.getLayoutValue("icon-padding",b,d);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,d);this.offset=a.getLayoutValue("icon-offset",b,d);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.IconLayout=q;q=function(){return function(a,b,c,d){this.allowOverlap=a.getLayoutValue("text-allow-overlap",b,d);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,d);this.optional=a.getLayoutValue("text-optional",
b,d);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,d);this.fontArray=a.getLayoutValue("text-font",b,d);this.maxWidth=a.getLayoutValue("text-max-width",b,d);this.lineHeight=a.getLayoutValue("text-line-height",b,d);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,d);this.justify=a.getLayoutValue("text-justify",b,d);this.anchor=a.getLayoutValue("text-anchor",b,d);this.maxAngle=a.getLayoutValue("text-max-angle",b,d);this.size=a.getLayoutValue("text-size",b,d);this.rotate=
a.getLayoutValue("text-rotate",b,d);this.padding=a.getLayoutValue("text-padding",b,d);this.keepUpright=a.getLayoutValue("text-keep-upright",b,d);this.transform=a.getLayoutValue("text-transform",b,d);this.offset=a.getLayoutValue("text-offset",b,d);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.TextLayout=q})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["require","exports"],function(q,b){return function(){function b(f,h,a){this._op=f;"$type"===h?(this._val=a instanceof
Array?a.map(function(a){return b._types.indexOf(a)}):b._types.indexOf(a),this._op+=11):(this._key=h,this._val=a)}b.prototype.filter=function(b){switch(this._op){case 0:return this._val;case 1:return b.values[this._key]===this._val;case 2:return b.values[this._key]!==this._val;case 3:return b.values[this._key]<this._val;case 4:return b.values[this._key]>this._val;case 5:return b.values[this._key]<=this._val;case 6:return b.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(b.values[this._key]);
case 8:return-1===this._val.indexOf(b.values[this._key]);case 9:for(var f=0,a=this._val;f<a.length;f++){var e=a[f];if(e.filter(b))return!0}return!1;case 10:f=0;for(a=this._val;f<a.length;f++)if(e=a[f],!e.filter(b))return!1;return!0;case 11:f=0;for(a=this._val;f<a.length;f++)if(e=a[f],e.filter(b))return!1;return!0;case 12:return b.type===this._val;case 13:return b.type!==this._val;case 14:return b.type<this._val;case 15:return b.type>this._val;case 16:return b.type>=this._val;case 17:return b.type<=
this._val;case 18:return-1!==this._val.indexOf(b.type);case 19:return-1===this._val.indexOf(b.type);case 20:return void 0!==b.values[this._key];case 21:return void 0===b.values[this._key]}};b.createFilter=function(f){if(!f)return new b(0,void 0,!0);var h=f[0];if(1>=f.length)return new b(0,void 0,"any"!==h);switch(h){case "\x3d\x3d":return new b(1,f[1],f[2]);case "!\x3d":return new b(2,f[1],f[2]);case "\x3e":return new b(4,f[1],f[2]);case "\x3c":return new b(3,f[1],f[2]);case "\x3e\x3d":return new b(6,
f[1],f[2]);case "\x3c\x3d":return new b(5,f[1],f[2]);case "in":return new b(7,f[1],f.slice(2));case "!in":return new b(8,f[1],f.slice(2));case "any":return new b(9,void 0,f.slice(1).map(b.createFilter.bind(this)));case "all":return new b(10,void 0,f.slice(1).map(b.createFilter.bind(this)));case "none":return new b(11,void 0,f.slice(1).map(b.createFilter.bind(this)));case "has":return new b(20,f[1],void 0);case "!has":return new b(21,f[1],void 0);default:throw Error("invalid operator: "+h);}};b._types=
["Unknown","Point","LineString","Polygon"];return b}()})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){}b.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.lineLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};b.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",
default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},
"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",
default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};b.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};b.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",
default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};b.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};b.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},
"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,
default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};b.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},
"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};b.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],
default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return b}();b.StyleDefinition=q})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../../../Color","../GeometryUtils"],function(q,b,l,f){return function(){function b(a,e){this.isDataDriven=!1;var d;switch(a.type){case "number":d=!0;break;case "color":d=
!0;e=b._parseColor(e);break;case "array":d="number"===a.value;break;default:d=!1}null==e&&(e=a.default);d&&"interval"===e.type&&(d=!1);var f=e&&e.stops&&0<e.stops.length;if(f)for(var h=0,c=e.stops;h<c.length;h++){var g=c[h];g[1]=this._validate(g[1],a)}if(this.isDataDriven=e?!!e.property:!1)if(void 0!==e.default&&(e.default=this._validate(e.default,a)),f)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,a);break;case "categorical":this.getValue=this._buildCategorical(e,a);break;default:this.getValue=
d?this._buildInterpolate(e,a):this._buildInterval(e,a)}else this.getValue=this._buildIdentity(e,a);else f?this.getValue=d?this._buildZoomInterpolate(e):this._buildZoomInterval(e):(e=this._validate(e,a),this.getValue=this._buildSimple(e))}b.prototype._validate=function(a,b){if("number"===b.type){if(a<b.minimum)return b.minimum;if(a>b.maximum)return b.maximum}return a};b.prototype._buildSimple=function(a){return function(){return a}};b.prototype._buildIdentity=function(a,e){var d=this;return function(f,
h){var c;h&&(c=h.values[a.property],"color"===e.type&&(c=b._parseColor(c)));void 0===c&&(c=a.default);return void 0!==c?d._validate(c,e):e.default}};b.prototype._buildCategorical=function(a,b){var d=this;return function(e,f){var c;f&&(c=f.values[a.property]);c=d._categorical(c,a.stops);return void 0!==c?c:void 0!==a.default?a.default:b.default}};b.prototype._buildInterval=function(a,b){var d=this;return function(e,f){var c;f&&(c=f.values[a.property]);return"number"===typeof c?d._interval(c,a.stops):
void 0!==a.default?a.default:b.default}};b.prototype._buildInterpolate=function(a,b){var d=this;return function(e,f){var c;f&&(c=f.values[a.property]);return"number"===typeof c?d._interpolate(c,a.stops,a.base||1):void 0!==a.default?a.default:b.default}};b.prototype._buildZoomInterpolate=function(a){var b=this;return function(d){return b._interpolate(d,a.stops,a.base||1)}};b.prototype._buildZoomInterval=function(a){var b=this;return function(d){return b._interval(d,a.stops)}};b.prototype._categorical=
function(a,b){for(var d=b.length,e=0;e<d;e++)if(b[e][0]===a)return b[e][1]};b.prototype._interval=function(a,b){for(var d=b.length,e=0,f=0;f<d;f++)if(b[f][0]<=a)e=f;else break;return b[e][1]};b.prototype._interpolate=function(a,b,d){for(var e,h,c=b.length,g=0;g<c;g++){var l=b[g];if(l[0]<=a)e=l;else{h=l;break}}if(e&&h){g=h[0]-e[0];a-=e[0];d=1===d?a/g:(Math.pow(d,a)-1)/(Math.pow(d,g)-1);if(Array.isArray(e[1])){e=e[1];h=h[1];a=[];for(g=0;g<e.length;g++)a.push(f.interpolate(e[g],h[g],d));return a}return f.interpolate(e[1],
h[1],d)}if(e)return e[1];if(h)return h[1]};b._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};b._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a){if(a=new l(a),!this._isEmpty(a))return l.toUnitRGBA(a)}else return a&&a.default&&(a.default=b._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],b._parseColor(a[1])]})),a};return b}()})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["require","exports"],
function(q,b){function l(b,a){b%=a;return 0<=b?b:b+a}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=128/b.C_PI;b.C_256_TO_RAD=b.C_PI/128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var f=1/Math.LN2;b.positiveMod=l;b.radToByte=function(f){return l(f*b.C_RAD_TO_256,256)};b.degToByte=function(f){return l(f*b.C_DEG_TO_256,256)};b.log2=function(b){return Math.log(b)*
f};b.sqr=function(b){return b*b};b.interpolate=function(b,a,e){return b*(1-e)+a*e};b.between=function(b,a,e){return b>=a&&b<=e||b>=e&&b<=a}})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.WEBGL_MAX_STOPS=8;b.WEBGL_MAX_INNER_STOPS=b.WEBGL_MAX_STOPS-2;b.NAN_MAGIC_NUMBER=1E-30;b.EXTRUDE_SCALE=64;b.PICTURE_FILL_COLOR=4294967295;b.TILE_SIZE=512;b.RASTER_TILE_SIZE=256;b.ANGLE_FACTOR_256=256/360;b.DEBUG_LABELS=
!1;b.COLLISION_BUCKET_SIZE=128;b.DOT_DENSITY_MAX_FIELDS=8;b.COLLISION_MAX_ZOOM_DELTA=3;b.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;b.COLLISION_BOX_PADDING=16;b.COLLISION_TILE_BOX_SIZE=b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;b.COLLISION_PLACEMENT_PADDING=8;b.HEURISTIC_GLYPHS_PER_LINE=50;b.HEURISTIC_GLYPHS_PER_FEATURE=10;b.GLYPH_SIZE=24;b.TEXT_LINE_HEIGHT=1.2*b.GLYPH_SIZE;b.TEXT_MAX_WIDTH=10*b.GLYPH_SIZE;b.TEXT_SPACING=0;b.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};b.ATTRIBUTE_STORE_TEXTURE_SIZE=
1024;b.TEXTURE_BINDING_SPRITE_ATLAS=0;b.TEXTURE_BINDING_GLYPH_ATLAS=0;b.TEXTURE_BINDING_BITMAP=0;b.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;b.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;b.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;b.TEXTURE_BINDING_HIGHLIGHT_0=5;b.TEXTURE_BINDING_HIGHLIGHT_1=6;b.TEXTURE_BINDING_RENDERER_0=5;b.TEXTURE_BINDING_RENDERER_1=6;b.ATTRIBUTE_DATA_FILTER_FLAGS=0;b.ATTRIBUTE_DATA_ANIMATION=1;b.ATTRIBUTE_DATA_VV=2;b.ATTRIBUTE_DATA_DD0=3;b.ATTRIBUTE_DATA_DD1=3;b.MAX_FILTERS=
2;b.HIGHLIGHT_FLAG=1;b.FILTER_FLAG_0=2;b.EFFECT_FLAG_0=4;b.THIN_LINE_THRESHOLD=2.5;b.HITTEST_SEARCH_SIZE=24;b.MAX_ANIMATION_TIME_MS=2E3;b.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;b.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;b.VTL_HIGH_RES_CUTOFF=1.15;b.MAX_GPU_UPLOADS_PER_FRAME=2})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),
function(q,b,l,f,h,a,e,d){function k(a,b,d,e){f.vec3.copy(n,d);n[e]=b[e];e=f.vec3.subtract(n,n,b);var g=f.vec3.subtract(c,a,b),g=f.vec3.dot(g,e),k=f.vec3.dot(e,e);b=0>=g?b:k<=g?d:f.vec3.add(n,b,f.vec3.scale(e,e,g/k));a=f.vec3.subtract(n,a,b);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(b,"__esModule",{value:!0});var n=h.vec3f64.create(),c=h.vec3f64.create(),g=h.vec3f64.create(),r=h.vec3f64.create();b.isInsideExtent=function(b,c,d){void 0===d&&(d=0);b=b.extent;
return 0===d?a.containsPoint(b,c):a.containsPointWithMargin(b,c,d*Math.min(b[2]-b[0],b[3]-b[1]))};b.tiltOnEdge=k;b.tiltToExtentEdge=function(a,b){var c=a.elevationBounds;a=a.extent;c=.5*(c.min+c.max);g[0]=a[0];g[1]=a[1];g[2]=c;r[0]=a[2];r[1]=a[3];r[2]=c;a=c=Infinity;b[0]<g[0]?c=k(b,g,r,0):b[0]>r[0]&&(c=k(b,r,g,0));b[1]<g[1]?a=k(b,g,r,1):b[1]>r[1]&&(a=k(b,r,g,1));return Math.min(c,a)};b.checkIfTileInfoSupportedForViewSR=function(b,c,g){if(b.spatialReference.isGeographic)return new l("tilingscheme:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes");var f=d.checkUnsupported(b);if(f)return f;var k=b.lods,f=k[0].resolution*Math.pow(2,k[0].level),h=[f*b.size[0],f*b.size[1]],m=[b.origin.x,b.origin.y];g=a.fromExtent(g);var p=a.create();d.computeRowColExtent(g,h,m,p);h=(p[2]-p[0])*(p[3]-p[1]);h>e.MAX_ROOT_TILES?(k=k[0].scale*Math.pow(2,k[0].level),f=Math.max((g[3]-g[1])/b.size[1],(g[2]-g[0])/b.size[0])*k/f,g=Math.floor(Math.log(f)/Math.log(10)),f=Math.ceil(f/Math.pow(10,g))*Math.pow(10,
g),f=new l("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(k).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+f.toLocaleString()+".",{level0Scale:k,suggestedLevel0Scale:f,requiredNumRootTiles:h,allowedNumRootTiles:e.MAX_ROOT_TILES})):f=null;return f?f:c&&!b.spatialReference.equals(c)?new l("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require",
"exports","../../../core/Error","../support/projectionUtils","./TilingScheme"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.isInsideExtent=function(){return!0};b.tiltToExtentEdge=function(){return 0};b.checkIfTileInfoSupportedForViewSR=function(a,b){var d=a.lods.length-1;if(a.spatialReference.isWebMercator){if(!h.makeWebMercatorAuxiliarySphere(d).compatibleWith(a))return new l("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(f.canProjectToWGS84ComparableLonLat(a.spatialReference)){if(!h.makeGCSWithTileSize(a.spatialReference,
a.size[0],d).compatibleWith(a))return a.spatialReference.isWGS84?new l("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new l("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new l("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(b&&!a.spatialReference.equals(b))return new l("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/ElevationBounds":function(){define(["require","exports","../../../core/tsSupport/extendsHelper"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a){void 0===b&&(b=0);void 0===a&&(a=0);this.min=b;this.max=a;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(b){this.min=b.min;this.max=b.max;this.level=b.level;this.hasNoDataValues=b.hasNoDataValues};
return b}();b.ElevationBounds=q})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a,b,f){this.samplerData=null;this.level=a[0];this.i=a[1];this.j=a[2];this.extent=b;a=f.noDataValue;for(var d=f.values,c=Infinity,e=-Infinity,k=!0,h=!1,l=0;l<d.length;l++){var t=d[l];t!==a?(c=t<c?t:c,e=t>e?t:e,k=!1):h=!0}k&&(e=c=0);
this.samplerData={pixelData:f.values,width:f.width,height:f.height,noDataValue:a,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(b[2]-b[0]),dy:(f.width-1)/(b[3]-b[1]),x0:b[0],y1:b[3]};this.bounds=[c,-3E38<e?e:0];this.hasNoDataValues=h}a.prototype.release=function(){this.bounds=this.samplerData=null};a.prototype.computeMinMaxValue=function(a,b,k,l){l.min=Infinity;l.max=-Infinity;l.hasNoDataValues=!1;a-=this.level;if(0>=a)return l;var c=Math.pow(2,a);if(Math.floor(b/c)!==this.i||Math.floor(k/c)!==this.j)return l;
var d=Infinity,e=-Infinity,p=this.samplerData.width,n=this.samplerData.pixelData,t=.5*h.ELEVATION_NODATA_VALUE;a=(p-1)/c;k=(k-this.j*c)*a;var x=(b-this.i*c)*a;if(1>a){var v=Math.floor(k),y=Math.floor(x),m=v+y*p;b=n[m];var c=n[m+1],w=n[m+p],m=n[m+p+1];if(b+c+w+m<t)return d=k-v,t=x-y,e=f.bilerp(b,c,w,m,d,t),p=f.bilerp(b,c,w,m,d+a,t),n=f.bilerp(b,c,w,m,d,t+a),a=f.bilerp(b,c,w,m,d+a,t+a),l.min=Math.min(e,p,n,a),l.max=Math.max(e,p,n,a),l;k=v;x=y;a=1}else k=Math.floor(k),x=Math.floor(x),a=Math.ceil(a);
for(b=k;b<=k+a;b++)for(c=x;c<=x+a;c++)m=b+c*p,w=n[m],w<t?(d=Math.min(d,w),e=Math.max(e,w)):l.hasNoDataValues=!0;l.min=d;l.max=e;return l};a.sample=function(a,b,f){for(var d=0;d<f.length;d++){var c=f[d];if(c){var e=c.safeWidth,k=c.width,p=c.pixelData,u=l.clamp(c.dy*(c.y1-b),0,e),c=l.clamp(c.dx*(a-c.x0),0,e),e=Math.floor(u),t=Math.floor(c),x=e*k+t,v=x+k,y=p[x],k=p[v],x=p[x+1],p=p[v+1];if(y+k+x+p<.5*h.ELEVATION_NODATA_VALUE)return u-=e,c-=t,a=y+(x-y)*c,a+(k+(p-k)*c-a)*u}}return null};return a}();b.ElevationData=
q})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),function(q,b,l,f,h,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._scaleRangeEnabled=!1;return b}l(b,a);Object.defineProperty(b.prototype,"_desiredMinLevelDelta",{get:function(){return h.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"_loadingLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});b.Pool=new f(b);return b}(a.TileAgent)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=Error("Abstract method called on TileAgent");q=function(){function a(){}Object.defineProperty(a.prototype,"updating",{get:function(){return!!this._tileRequested},
enumerable:!0,configurable:!0});a.prototype.init=function(a,b,e,c){this.tile=a;this._layerIdx=b;this._layerClass=e;this._suspended=c;this._tileLayerInfo=a.getLayerInfo(b,e);this._tileRequested=null;a=this._findAncestorWithData();this._setUpsampleTile(a)};a.prototype.startLoading=function(){return this._requestNext()};a.prototype.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=
null};a.prototype.setSuspension=function(a){a!==this._suspended&&((this._suspended=a)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};a.prototype.update=function(){var a=this._findAncestorWithData();this._setUpsampleTile(a);return this._requestNext()};a.prototype.dataArrived=function(a){this._setUpsampleTile(a);this._tileRequested=null;a===this.tile?this.tile.updateRenderData(this._layerClass):
this._requestNext()};a.prototype.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};a.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};a.prototype._requestNext=function(){if(this._suspended)return!0;var a=this._findNextDownload();f.TILE_LOADING_DEBUGLOG&&console.log(h.tile2str(this.tile),"next",h.tile2str(a));if(this._tileRequested){if(a===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,
this._layerClass,this);this._tileRequested=null}a?a.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=a):this._agentDone();return!!this._tileRequested};a.prototype._findNextDownload=function(){for(var a=this._layerIdx,b=this._layerClass,e=this.tile.surface.layerViewByIndex(a,b),c=e.layer,g=e.dataLevelRange,e=g.minLevel,g=g.maxLevel,l=this._desiredMinLevelDelta,p=this._loadingLevelDelta+l,u=this._scaleRangeEnabled?h.fallsWithinLayer:function(){return!0},t,x=this.tile,v=0,
y=this._tileLayerInfo.upsampleInfo,y=y?y.tile.level:-1,m=this.tile.surface,w=m.getTilemapTile(x);x&&u(x,c,!1)&&x.level>=e;){var A=x.level,q=x.layerInfo[b][a];if(q.data&&v>=l){A>y&&this._setUpsampleTile(x);q.dataInvalidated&&(t=x);break}if((!w||w.hasDataAvailable(x,a,b))&&A<=g&&!q.data&&!q.dataMissing){if(!t||0===A%f.LOADING_LEVEL_MODULO||this.tile.level-t.level<l)t=x;if(v>=p)break}(x=x.parent)&&w&&(w=w.parent||m.getTilemapTile(x));v++}t&&this.tile.level-t.level<l&&this._tileLayerInfo.upsampleInfo&&
(t=null);return t};a.prototype._findAncestorWithData=function(){for(var a=this.tile.vlevel,b=this._desiredMinLevelDelta,e,c=this.tile;c;c=c.parent)if(c.hasLayerData(this._layerIdx,this._layerClass)){if(a-c.level>=b)return c;e=c}return e};a.prototype._setUpsampleTile=function(a){this._tileLayerInfo.setUpsampleInfo(this.tile,a);this.tile.updateRenderData(this._layerClass)};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{findNextDownload:function(){return a._findNextDownload()},
tileLayerInfo:this._tileLayerInfo}},enumerable:!0,configurable:!0});return a}();b.TileAgent=q;q=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);Object.defineProperty(d.prototype,"_desiredMinLevelDelta",{get:function(){throw a;},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_loadingLevelDelta",{get:function(){throw a;},enumerable:!0,configurable:!0});return d}(q);b.TILE_AGENT_DONE=new q})},"esri/views/3d/terrain/tileUtils":function(){define(["require",
"exports","../../../core/PooledArray"],function(q,b,l){function f(a){return a?a[0]+"/"+a[1]+"/"+a[2]:"null"}function h(a,b){b(a);if(!a.isLeaf){var d=0;for(a=a.children;d<a.length;d++)h(a[d],b)}}function a(a,b,f){a=a.screenDepth;b=b.screenDepth;return a<b?-f:a>b?f:0}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){this.q=new l;this._last=null}Object.defineProperty(a.prototype,"done",{get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)},enumerable:!0,
configurable:!0});a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null};a.prototype.skipSubtree=function(){this._last=null};a.prototype.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};return a}();b.IteratorPreorder=q;q=function(){function a(){this.q=new l}Object.defineProperty(a.prototype,"done",{get:function(){return 0===
this.q.length},enumerable:!0,configurable:!0});a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a){var b=this.q.data[a];b.isLeaf||this.q.pushArray(b.children)}};a.prototype.next=function(){return this.q.pop()};return a}();b.IteratorPostorder=q;b.lij2str=f;b.tile2str=function(a){return a?f(a.lij):"null"};b.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)h(a[d],b);else h(a,b)};b.fallsWithinLayer=function(a,b,f){if(!b)return!1;
var d=b.fullExtent,c=a.extent;if(f){if(c[0]<d.xmin||c[1]<d.ymin||c[2]>d.xmax||c[3]>d.ymax)return!1}else if(d.xmin>c[2]||d.ymin>c[3]||d.xmax<c[0]||d.ymax<c[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};b.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};b.getRootTile=function(a){for(;a.parent;)a=a.parent;return a};b.nextTileInAncestry=function(a,b){var d=a.lij[0]-b.lij[0]-1,e=a.lij[2]>>
d,c=0;a.lij[1]>>d&1&&(c+=2);e&1&&(c+=1);return b.children[c]};b.sortTiles=function(b,d){d.sort(function(d,e){return a(d,e,b)})};b.compareTiles=a;b.computeUpsampleInfo=function(a,b,f){for(var d=1,c=0,e=0;a!==b;)if(d*=.5,c*=.5,e*=.5,a.lij[2]&1&&(c+=.5),0===(a.lij[1]&1)&&(e+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");f.init(b,c,e,d)};b.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var e=a[b],f=e.parent;if(f)for(var c=0;4>c;c++){var g=f.children[c];if(g&&
g!==e&&g.visible)return!0}}return!1};b.tilesAreRelated=function(a,b){if(!a||!b)return!1;var d=a[0]<b[0],e=d?a:b;a=d?b:a;b=a[0]-e[0];if(0===b)return!1;b=1<<b;return Math.floor(a[1]/b)===e[1]&&Math.floor(a[2]/b)===e[2]}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(q,b,l,f,h){return function(a){function b(){var b=a.call(this)||this;b._scaleRangeEnabled=!0;return b}l(b,a);Object.defineProperty(b.prototype,
"_desiredMinLevelDelta",{get:function(){return 0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_loadingLevelDelta",{get:function(){return 8},enumerable:!0,configurable:!0});b.Pool=new f(b);return b}(h.TileAgent)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/mathUtils ../../../core/scheduling ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../layers/support/timeUtils ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/animationUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/geometryUtils ../support/mathUtils ../support/projectionUtils ./OverlayRenderer ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin ../../support/Scheduler".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S){function R(a,b){for(var c=C.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(a[2]-a[0],a[3]-a[1],b[2]-b[0],b[3]-b[1]),d=0;4>d;d++)if(Math.abs(b[d]-a[d])>c)return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});var O=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],Q;q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||
this;b._handles=new e;b._overlaySR=null;b._renderSR=null;b._overlaySREqualsRenderSR=!0;b._connectedLayers=new Map;b._overlays=null;b._renderedAltitude=0;b._placementDirty=!1;b._drawTexturesDirty=!1;b._drawTexturesAnimateDirty=!1;b._isSpherical=!1;b._longitudeCyclical=null;b._latestOriginId=0;b._maxResolution=d("esri-mobile")?2048:4096;b._animationTimeLast=0;b.opacity=0;return b}l(b,a);Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,
configurable:!0});b.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=new H.OverlayRenderer(this._stage.renderView);this._stage.renderView.updateLogicClients.add(this._renderer);this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setDrawTexturesDirty()};this.groundIntersector=new L(this.view.viewingMode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=
!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}),this.terrainSurface.on("elevation-change",function(){return a.setOverlayPlacementDirty()}),this.view.on("resize",function(){return a.setOverlayPlacementDirty()}),c.addFrameTask({preRender:function(b){a._renderer.commitChanges();a.hasOverlays()&&(a._dispatchRendererUpdate(b),
a._drawOverlayTextures())}}),this.view.resourceController.scheduler.registerTask(S.Task.OVERLAY_MANAGER,function(){return a.updateOverlays()},function(){return a.needsUpdate()}),this.view._stage.renderView.events.on("force-camera-for-screenshot",function(b){a.updateOverlays(b);a._drawOverlayTextures()})])};b.prototype.destroy=function(){var a=this;this._connectedLayers.forEach(function(b){return a._unregisterLayerView(b.layerView)});this._disposeOverlays();this._stage.renderView.updateLogicClients.remove(this._renderer);
this._renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null)};Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});b.prototype.onHasHighlightsChanged=function(){this.setOverlayPlacementDirty();this.notifyChange("hasHighlights")};b.prototype.hasOverlays=function(){return!!this._overlays};b.prototype.setSpatialReference=function(a,b){this._overlaySR=a;this._longitudeCyclical=null;if(a){if(this._renderSR=this.view.renderSpatialReference,
this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._isSpherical=b)this._longitudeCyclical=a.isWebMercator?new I.Cyclical(-2.0037508342787E7,2.0037508342787E7):new I.Cyclical(-180,180),this._renderer.longitudeCyclical=this._longitudeCyclical}else this._disposeOverlays()};b.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};b.prototype.updateLayerViews=function(a){for(var b=this,c=0,d=this.view.allLayerViews.items;c<d.length;c++){var e=d[c];"supportsDraping"in
e&&e.supportsDraping&&!this._connectedLayers.has(e.uid)&&this._registerLayerView(e)}this._connectedLayers.forEach(function(c,d){c=c.layerView;a.has(d)||b._unregisterLayerView(c)});this._renderer.updateLayerOrder();this.setDrawTexturesDirty()};b.prototype._registerLayerView=function(a){var b=this,c=a.uid,d=a.on("draped-data-change",function(){return b.setOverlayPlacementDirty()});this._connectedLayers.set(c,{eventHandles:[d],layerView:a});a.setDrapingExtent&&this._overlays&&this._overlays.forEach(function(c,
d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin,c.pixelRatio)});this.setOverlayPlacementDirty()};b.prototype._unregisterLayerView=function(a){var b=this;this._connectedLayers.forEach(function(c,d){if(c.layerView===a){if(c.eventHandles)for(var e=0;e<c.eventHandles.length;e++)c.eventHandles[e].remove();b._connectedLayers.delete(d);b.setOverlayPlacementDirty()}})};b.prototype.setOverlayPlacementDirty=function(){this._placementDirty=!0};b.prototype.updateOverlays=function(a){void 0===
a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=k.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var c=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,Z);this._initOverlays();this._updateOverlay(0,Z.inner,c,1);this._updateOverlay(1,Z.outer,c,y.width(Z.inner)/y.width(Z.outer));this.opacity=1;this.terrainSurface.updateTileOverlayParams();this._placementDirty=!1;this.setDrawTexturesDirty();this.terrainSurface.updateOverlayOpacity()}};b.prototype._updateOverlay=
function(a,b,c,d){var e=this,g=this._overlays[a];if(R(b,g.extent)||c!==g.resolution||g.pixelRatio!==d)y.set(g.extent,b),g.resolution=c,g.pixelRatio=d,d=y.center(g.extent),g.renderLocalOrigin=P.fromValues(d[0],d[1],0,"OV_"+this._latestOriginId++),this._connectedLayers.forEach(function(d){d=d.layerView;d.setDrapingExtent&&d.setDrapingExtent(a,b,e._overlaySR,c,g.renderLocalOrigin,g.pixelRatio)})};b.prototype.needsUpdate=function(){return this._placementDirty&&(0<this._connectedLayers.size||0<this.view.graphics.length||
E.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this._get("suspended")&&this.terrainSurface.ready};b.prototype.updateOpacity=function(a){return this._overlays?this._getAltitudeBasedOpacity(a,this._renderedAltitude):1};b.prototype._getAltitudeBasedOpacity=function(a,b){return 3.5*a<b?Math.sqrt(k.clamp((a-b/10)/(b/3.5-b/10),0,1)):1};b.prototype.setTileParameters=function(a,b,c){if(this._overlays){var d=this._overlays[0],e=this._overlays[1];a=y.intersection(a.extent,a.surface.extent,W);this._rectInsideRect(a,
d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]))}else this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]);
b.overlayOpacity=void 0!==c?c:1};b.prototype.overlayPixelSizeInMapUnits=function(a){if(!this._overlays)return 0;var b=this._overlays[0],c=this._overlays[1];a=this._pointIsInExtent(a,b.extent)?b:c;return(a.extent[2]-a.extent[0])/a.resolution};b.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),g=this._longitudeCyclical.minimalMonotonic(d[0],
a[2]);e>g&&(e=g-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null;c.waterMaskRenderTargetId=b.waterMaskValid?b.waterMaskRenderTargetId:null};b.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null;a.waterMaskRenderTargetId=null};b.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+
a,!0,8,9987),c=this._renderer.createRenderTarget("overlayHighlight"+a,!1,8,9987);a=this._renderer.createRenderTarget("overlayWaterMask"+a,!0,8,9987);return{extent:y.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:c,highlightValid:!1,waterMaskRenderTargetId:a,waterMaskValid:!1,renderLocalOrigin:P.fromValues(0,0,0,"O"),pixelRatio:1}};b.prototype._initOverlays=function(){this._overlays||(this._overlays=[this._createEmptyOverlay(0),this._createEmptyOverlay(1)])};b.prototype._disposeOverlays=
function(){var a=this;this._overlays&&(this._overlays.forEach(function(b){a._renderer.disposeRenderTarget(b.renderTargetId);a._renderer.disposeRenderTarget(b.highlightRenderTargetId);a._renderer.disposeRenderTarget(b.waterMaskRenderTargetId)}),this._overlays=null)};b.prototype._dispatchRendererUpdate=function(a){var b=m.Milliseconds(a.time-this._animationTimeLast);b<B.DESIRED_DRAPED_ANIMATION_MS||(this._animationTimeLast=a.time,this._renderer.updateLogic({dt:b,camera:this._stage.getCamera()})&&(this._drawTexturesAnimateDirty=
!0))};b.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};b.prototype._intersectGroundFromView=function(a,b,c,d){c=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(a,V,b,c);b=c.origin;c=p.vec3.add(N,c.origin,c.direction);this.groundIntersector.reset(b,c);this.groundIntersector.intersect([],null,a);this.view.basemapTerrain.intersect(this.groundIntersector,null,b,c);return this.groundIntersector.results.min.getIntersectionPoint(d)};
b.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=u.vec3f64.clone(a.eye);p.vec3.normalize(d,d);p.vec3.negate(d,d);b=p.vec3.length(b);b=Math.asin(b/p.vec3.length(a.eye));var e=Math.acos(p.vec3.dot(a.viewForward,d)),d=k.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=k.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=x.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),d=t.vec4.transformMat4(d,d,a.projectionMatrix)[1],
d=k.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};b.prototype._computeOverlayExtents=function(a,b,c){var d=this.terrainSurface.extent,e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,g=u.vec3f64.create();this._findHorizonBasedPointOfInterest(a,e,g)||p.vec3.copy(g,e);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(a.eye);var f=p.vec3.distance(a.eye,g),e=A.viewAngle(this.view.renderCoordsHelper,
e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/2);if(E.OVERLAY_SHOW_CENTER){var k=new w({color:[255,0,0],outline:{color:[255,255,255],width:2}}),m=new v;K.vectorToPoint(g,this._renderSR,m,this._overlaySR);k=new h({geometry:m,symbol:k});void 0!==Q&&this.view.graphics.remove(Q);this.view.graphics.add(k);Q=k}this._overlaySREqualsRenderSR||K.vectorToVector(g,this._renderSR,g,this._overlaySR);b=b*a.perRenderPixelRatio*f/2;m=!1;f=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(b/=Math.cos(K.webMercator.y2lat(g[1])),
f=this.terrainSurface.extent[3],f*=.999):(m=!0,b/=G.metersPerDegree,f=90),b>=f&&(b=f,g[1]=0,this._overlaySR.isWebMercator&&(g[0]=0)));k=1;m&&(k=1/Math.max(.2,Math.cos(Math.abs(n.deg2rad(g[1])))),180<b*k&&(k=180/b));var l=b*k,m=c.inner;m[0]=g[0]-l;m[1]=g[1]-b;m[2]=g[0]+l;m[3]=g[1]+b;this._isSpherical&&this._shiftExtentToFitBounds(m,Infinity,f);c=c.outer;y.set(c,m);6*l>d[2]-d[0]?y.set(c,d):e<=.25*Math.PI?(c[0]-=l,c[1]-=b,c[2]+=l,c[3]+=b):(K.vectorToVector(a.eye,this._renderSR,N,this._overlaySR),r.vec2.subtract(Y,
g,N),a=-Math.atan2(Y[1],Y[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),t.vec4.scale(Y,O[Math.floor(a/(.25*Math.PI))],2*b),Y[0]*=k,Y[2]*=k,t.vec4.add(c,c,Y));this._isSpherical&&(c[0]=this._longitudeCyclical.clamp(c[0]),c[2]=this._longitudeCyclical.clamp(c[2]),c[1]=Math.max(c[1],-f),c[3]=Math.min(c[3],f));!this._isSpherical&&d&&(a=y.intersection(m,d,W),d=y.intersection(c,d,aa),y.contains(a,d)&&(c[2]=c[0],c[3]=c[1]))};b.prototype._drawOverlayTextures=function(){if(this._drawTexturesDirty||this._drawTexturesAnimateDirty){var a=
this._drawOverlay(0),b=this._drawOverlay(1);0!==a&&0!==b||this.terrainSurface.updateTileOverlayParams();this._drawTexturesDirty?(this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1,this.terrainSurface.requestRender(),this.terrainSurface.setPendingUpdates()):(this._drawTexturesAnimateDirty=!1,this.terrainSurface.requestRender(0))}};b.prototype._setupGeometryViewsCyclical=function(a,b,c){this._setupGeometryViewsDirect(a,b,c);var d=.001*this._longitudeCyclical.range;if(b[0]-d<=this._longitudeCyclical.min){var e=
a.views[a.numViews++];t.vec4.set(e.viewport,0,0,c,c);y.offset(b,this._longitudeCyclical.range,0,e.extent)}b[2]+d>=this._longitudeCyclical.max&&(e=a.views[a.numViews++],t.vec4.set(e.viewport,0,0,c,c),y.offset(b,-this._longitudeCyclical.range,0,e.extent))};b.prototype._setupGeometryViewsDirect=function(a,b,c){a.numViews=1;a=a.views[0];y.set(a.extent,b);t.vec4.set(a.viewport,0,0,c,c)};b.prototype._drawOverlay=function(a){var b=this._overlays[a],c=b.valid,d=b.highlightValid,e=b.waterMaskValid,g=b.extent,
f=b.resolution,k=b.pixelRatio;this._longitudeCyclical?this._setupGeometryViewsCyclical(T,g,f):this._setupGeometryViewsDirect(T,g,f);T.width=f;T.height=f;T.pixelRatio=k*this.view.state.camera.pixelRatio;T.index=a;f=this._renderer;a=f.draw(b.renderTargetId,T);g=f.drawHighlights(b.highlightRenderTargetId,T);f=f.drawNormals(b.waterMaskRenderTargetId,T);b.valid=a;b.highlightValid=g;b.waterMaskValid=f;return a!==c||g!==d||f!==e?0:1};b.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?
(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):y.intersects(a,b)};b.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:y.contains(b,a)};b.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],
b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};b.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);y.offset(a,d,e)};Object.defineProperty(b.prototype,"test",{get:function(){return{overlays:this._overlays,renderer:this._renderer}},enumerable:!0,configurable:!0});f([g.property()],b.prototype,"view",void 0);f([g.property()],b.prototype,"terrainSurface",void 0);f([g.property({readOnly:!0,
aliasOf:"terrainSurface.suspended"})],b.prototype,"suspended",void 0);f([g.property({type:Boolean})],b.prototype,"hasHighlights",null);return b=f([g.subclass("esri.views.3d.terrain.OverlayManager")],b)}(g.declared(a));b.OverlayManager=q;var T={width:0,height:0,pixelRatio:0,views:[{viewport:y.create(),extent:y.create()},{viewport:y.create(),extent:y.create()},{viewport:y.create(),extent:y.create()}],numViews:0,index:0},Y=x.vec4f64.create(),N=u.vec3f64.create(),Z={inner:y.create(),outer:y.create()},
W=y.create(),aa=y.create(),V=J.ray.create()})},"esri/views/3d/support/animationUtils":function(){define(["require","exports","../../../layers/support/timeUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.DESIRED_ANIMATION_FPS=25;b.DESIRED_ANIMATION_MS=l.Milliseconds(1E3/b.DESIRED_ANIMATION_FPS);b.DESIRED_DRAPED_ANIMATION_FPS=20;b.DESIRED_DRAPED_ANIMATION_MS=l.Milliseconds(1E3/b.DESIRED_DRAPED_ANIMATION_FPS)})},"esri/views/3d/terrain/PlanarPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(a,e,f){var c=b.call(this,d.NumSubdivisionsAtLevel)||this;void 0!==a&&c.init(a,e,f);return c}l(d,b);d.prototype.init=function(a,d,e){b.prototype.init.call(this,a,d,e);this._edgeLen=this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=f.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=f.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=
0;this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=function(){this._updateCenter();var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(a*a+b*b)};d.prototype._isVisible=function(){return this.intersectsClippingArea&&a.frustum.intersectsAABB(this.surface.frustum.planes,h.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};d.prototype.createGeometry=
function(a,b){e.createPlanarGlobePatch(a,this.extent,b,this.renderData);this.setMemoryDirty()};d.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return d}(d.Tile);b.PlanarPatch=q})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/earthUtils ../support/buffer/BufferPool ../support/buffer/InterleavedLayout ./ElevationData ./TerrainConst ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(a,b,c,d){var e=0<(c&2),g=b+(d?1024:0)+(e?2048:0),f=A.get(g);if(!f){var f=b-1,k=b-1,h=b*b,m=2*f+2*k,l=f*k*6,p=6*m,n=6*(2*f+k-1);d&&(l*=2,p*=2,n*=2);for(var m=65536<h+m?new Uint32Array(l+p):new Uint16Array(l+p),r=0,w=0,t=l,u,v,x,q,B=0,C=0;C<=k;C++){e&&(B=0===C?n:C===k?-n:0);for(var t=t+B,E=0;E<=f;E++)x=y(E,C,f,k),-1<x&&(q=0===C&&E!==f?1:E===f&&C!==k?f+1:C===k&&0!==E?-1:0===E&&0!==C?-(f+1):0,0!==q&&(u=r,v=h+x,x=h+(0===E&&1===C?0:x+1),q=r+q,d?(m[t+0]=
u,m[t+1]=v,m[t+2]=v,m[t+3]=x,m[t+4]=x,m[t+5]=u,m[t+6]=x,m[t+7]=q,m[t+8]=q,m[t+9]=u,m[t+10]=u,m[t+11]=x,t+=12):(m[t+0]=u,m[t+1]=v,m[t+2]=x,m[t+3]=x,m[t+4]=q,m[t+5]=u,t+=6))),++r,E<f&&C<k&&(u=C*(f+1)+E,v=u+1,x=v+(f+1),q=x-1,d?(m[w+0]=u,m[w+1]=v,m[w+2]=v,m[w+3]=x,m[w+4]=x,m[w+5]=u,m[w+6]=x,m[w+7]=q,m[w+8]=q,m[w+9]=u,m[w+10]=u,m[w+11]=x,w+=12):(m[w+0]=u,m[w+1]=v,m[w+2]=x,m[w+3]=x,m[w+4]=q,m[w+5]=u,w+=6));t-=B}f={values:m,numSurfaceIndices:l,numSkirtIndices:p};A.set(g,f)}a.indices=f.values;a.numSurfaceIndices=
f.numSurfaceIndices;a.numSkirtIndices=f.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function x(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function v(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function y(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(b,"__esModule",{value:!0});var m=c.newLayout().vec3f(p.VertexAttrConstants.POSITION).vec2f(p.VertexAttrConstants.UV0),
w=new n.BufferPool(function(a){return m.createBuffer(a)},function(a){return a.count});b.clearCaches=function(){w.clear();A.clear()};b.releaseGeometry=function(a){w.release(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};b.createSphericalGlobePatch=function(a,b,c,f,h,m,p){var n=h[0],u=h[1],A=h[2];h=h[3];var q=.1*k.earthRadius*(h-u),B=a.numVertsPerRow-1,H=a.numVertsPerRow-1,O=a.numVertsPerRow*a.numVertsPerRow,R=w.acquire(O+(2*B+2*H)),Q=R.position.typedBuffer,L=R.uv0.typedBuffer,I=f.geometryInfo.boundingBox;
d.empty(I);var K=b[2]-b[0],P=b[3]-b[1],S=A-n,A=c[0],qa=c[1];c=c[2];for(var ja=0;ja<=B;ja++){var la=ja/B,ma=n+la*S;C[ja]=Math.sin(ma);E[ja]=Math.cos(ma);G[ja]=la;J[ja]=b[0]+la*K}n=m&&!!(p&1);K=m&&!!(p&2);for(ma=S=0;ma<=H;ma++){var ta=ma/H,ja=l.lerp(u,h,ta),ua=Math.cos(ja),sa=Math.sin(ja),xa=void 0;m?(xa=k.halfEarthRadius*Math.log((1+sa)/(1-sa)),ta=(xa-b[1])/P):xa=180*ja/Math.PI;for(ja=0;ja<=B;ja++){var la=G[ja],ra=C[ja],oa=E[ja],pa=k.earthRadius;a.samplerData&&(pa+=g.ElevationData.sample(J[ja],xa,
a.samplerData)||0);oa=oa*ua*pa-A;ra=ra*ua*pa-qa;pa=sa*pa-c;x(oa,ra,pa,I);var ia=r.GEOMETRY_VERTEX_STRIDE*S;Q[ia+0]=oa;Q[ia+1]=ra;Q[ia+2]=pa;L[ia+0]=la;L[ia+1]=ta;ia=y(ja,ma,B,H);if(-1<ia){var ia=r.GEOMETRY_VERTEX_STRIDE*(O+ia),na=n&&0===ma?-1:K&&ma===H?1:0,oa=0===na?oa:-A,ra=0===na?ra:-qa,pa=0===na?pa:k.earthRadius*na-c;Q[ia+0]=oa;Q[ia+1]=ra;Q[ia+2]=pa;L[ia+0]=0===na?v(la,ta):la;L[ia+1]=0===na?q:ta;0!==na&&x(oa,ra,pa,I)}++S}}f.geometryInfo.numVertsPerRow=a.numVertsPerRow;f.geometryInfo.vertexAttributes=
R;f.geometryInfo.skirtLength=q;e.vec4.set(f.geometryInfo.uvOffsetAndScale,0,0,1,1);t(f.geometryInfo,a.numVertsPerRow,m?p:0,a.wireframe)};b.createPlanarGlobePatch=function(a,b,c,f){var k=b[0],h=b[1],m=b[2]-k,l=b[3]-h,p=a.clippingArea,n=p?Math.max(0,(p[0]-b[0])/m):0,u=p?Math.max(0,(p[1]-b[1])/l):0,A=p?Math.min(1,(p[2]-b[0])/m):1;b=p?Math.min(1,(p[3]-b[1])/l):1;var q=A>n?1/(A-n):1,B=b>u?1/(b-u):1,C=-n*q,E=-u*B,H=.1*m,G=a.numVertsPerRow-1,J=a.numVertsPerRow-1,I=a.numVertsPerRow*a.numVertsPerRow,L=w.acquire(I+
(2*G+2*J)),qa=L.position.typedBuffer,K=L.uv0.typedBuffer,P=f.geometryInfo.boundingBox;d.empty(P);for(var S=0,ta=0;ta<=J;ta++){var ua=ta/J,sa=E+ua*B,ua=h+ua*l;p&&(ua<p[1]?(ua=p[1],sa=0):ua>p[3]&&(ua=p[3],sa=1));for(var xa=0;xa<=G;xa++){var ra=xa/G,oa=C+ra*q,ra=k+ra*m;p&&(ra<p[0]?(ra=p[0],oa=0):ra>p[2]&&(ra=p[2],oa=1));var pa=a.samplerData?g.ElevationData.sample(ra,ua,a.samplerData)||0:0,ra=ra-c[0],ia=ua-c[1],pa=pa-c[2];x(ra,ia,pa,P);var na=r.GEOMETRY_VERTEX_STRIDE*S;qa[na+0]=ra;qa[na+1]=ia;qa[na+2]=
pa;K[na+0]=oa;K[na+1]=sa;na=y(xa,ta,G,G);-1<na&&(na=r.GEOMETRY_VERTEX_STRIDE*(I+na),qa[na+0]=ra,qa[na+1]=ia,qa[na+2]=pa,K[na+0]=v(oa,sa),K[na+1]=H);++S}}f.geometryInfo.numVertsPerRow=a.numVertsPerRow;f.geometryInfo.vertexAttributes=L;f.geometryInfo.skirtLength=H;e.vec4.set(f.geometryInfo.uvOffsetAndScale,n,u,A-n,b-u);t(f.geometryInfo,a.numVertsPerRow,0,a.wireframe)};var A=new Map,B=Math.pow(2,-52);b.intersectSkirts=function(a,b,c,d,e,g,k,m,l){var p,n,r,w=g.position;g=g.uv0;var t=a[0],v=a[1];a=a[2];
var y=b[0]-t,x=b[1]-v;b=b[2]-a;d*=3;for(c*=3;c<d;c+=3){var A=e[c],q=e[c+1],C=e[c+2],E=w.get(A,0),H=w.get(A,1);p=w.get(A,2);var O=w.get(q,0),G=w.get(q,1);n=w.get(q,2);var R=w.get(C,0),T=w.get(C,1);r=w.get(C,2);A=g.get(A,0);q=g.get(q,0);C=g.get(C,0);2<=A&&(h.vec3.set(I,E,H,p),k(I),E+=I[0],H+=I[1],p+=I[2]);2<=q&&(h.vec3.set(I,O,G,n),k(I),O+=I[0],G+=I[1],n+=I[2]);2<=C&&(h.vec3.set(I,R,T,r),k(I),R+=I[0],T+=I[1],r+=I[2]);f.isSome(m)&&(p=m.applyToVertex(E,H,p),E=p[0],H=p[1],p=p[2],n=m.applyToVertex(O,G,
n),O=n[0],G=n[1],n=n[2],r=m.applyToVertex(R,T,r),R=r[0],T=r[1],r=r[2]);O-=E;G-=H;n-=p;R-=E;T-=H;r-=p;var A=x*r-T*b,q=b*R-r*y,J=y*T-R*x,C=O*A+G*q+n*J,E=t-E,Q=v-H,L=a-p,H=Q*n-G*L;p=L*O-n*E;var P=E*G-O*Q;if(C>B){E=E*A+Q*q+L*J;if(0>E||E>C)continue;A=y*H+x*p+b*P;if(0>A||E+A>C)continue}else if(C<-B){E=E*A+Q*q+L*J;if(0<E||E<C)continue;A=y*H+x*p+b*P;if(0<A||E+A<C)continue}else continue;H=(R*H+T*p+r*P)/C;0<=H&&(p=u.computeNormal(O,G,n,R,T,r,K),l(H,p))}};var C=Array(r.MAX_PATCH_TESSELATION+1),E=Array(r.MAX_PATCH_TESSELATION+
1),G=Array(r.MAX_PATCH_TESSELATION+1),J=Array(r.MAX_PATCH_TESSELATION+1),I=a.vec3f64.create(),K=a.vec3f64.create()})},"esri/views/3d/support/buffer/BufferPool":function(){define(["require","exports","../../../../core/PooledArray"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a){this._factoryCallback=b;this._lengthCallback=a;this._pool=new Map}b.prototype.acquire=function(f){if(!b.test.disabled){var a=this._pool.get(f);if(a&&0!==a.length)return a.pop()}try{return this._factoryCallback(f)}catch(d){var a=
window.performance&&window.performance.memory,e="";a&&(e="\n  totalJSHeapSize: "+a.totalJSHeapSize+", usedJSHeapSize: "+a.usedJSHeapSize+", jsHeapSizeLimit: "+a.jsHeapSizeLimit);console.log("Array allocation of size "+f+" failed: "+d+e);throw d;}};b.prototype.release=function(f){if(!b.test.disabled){var a=this._lengthCallback(f),e=this._pool.get(a);e||(e=new l({shrink:!0}),this._pool.set(a,e));e.push(f)}};b.prototype.clear=function(){this._pool.clear()};Object.defineProperty(b.prototype,"test",{get:function(){return{size:this._pool.size}},
enumerable:!0,configurable:!0});b.test={disabled:!1};return b}();b.BufferPool=q})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./tileUtils ../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C){function E(a){a.dispose();a instanceof t?t.Pool.release(a):a instanceof x&&x.Pool.release(a)}Object.defineProperty(b,"__esModule",{value:!0});var G=y.weakAssert,J=k.vec3f64.create(),I=k.vec3f64.create(),K=k.vec3f64.create(),H=c.vec4f64.create();q=function(){return function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0}}();b.SplitLimits=q;q=function(){function b(a){this._numSubdivisionAtLevel=
a;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this.extent=g.create();this._elevationBounds=e.vec2f64.create();this.layerInfo=Array(2);this.extentInRadians=g.create();this.centerAtSeaLevel=k.vec3f64.create();this._center=[k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create()];this.up=k.vec3f64.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=P;this._curvatureHeight=this._radius=this._edgeLen2=
this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}Object.defineProperty(b.prototype,"usedMemory",{get:function(){this._usedMemory===P&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"cachedMemory",{get:function(){return this.isCached?this.mapTileMemory:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mapTileMemory",{get:function(){this._usedMemory===
P&&this._updateMemoryUsed();for(var a=this._mapTileMemory,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b].data;d instanceof r.VectorTile&&(a+=d.getMemoryUsage())}return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isCached",{get:function(){return!this.shouldRender&&0>=this._mapDataRefCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxTesselation",{get:function(){return this._maxTesselation},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"intersectsClippingArea",{get:function(){return this._intersectsClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingArea",{get:function(){return this._clippingArea},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"surface",{get:function(){return this._surface},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"level",{get:function(){return this.lij[0]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"edgeLen",{get:function(){return this._edgeLen},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"screenDepth",{get:function(){return this._screenDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){if(this._dirty){var a=
this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this._visible=a);this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rendered",{get:function(){return!!this.renderData},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"shouldRender",{get:function(){if(!this.visible)return!1;if(0===this.surface.lodSnapping){var a=this.level-this._surface.snapLevel;if(0===a)return!0;if(1===a)return!1}return this.isLeaf},
enumerable:!0,configurable:!0});b.prototype.init=function(b,c,d){this.lij[0]=b[0];this.lij[1]=b[1];this.lij[2]=b[2];d.tilingScheme.getExtent(b[0],b[1],b[2],this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;d.upsampleMapCache.pop(B.tile2str(this));this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=b?b[0]:0;c&&c._elevationBounds?a.vec2.copy(this._elevationBounds,c.elevationBounds):a.vec2.set(this._elevationBounds,
0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._visible=!1;this._parent=c;this.unsetChildren();this._surface=d;this.updateVisibility();for(b=0;2>b;b++){c=d.numLayers(b);var e=this.layerInfo[b];this.layerInfo[b]?e.length=c:(e=Array(c),this.layerInfo[b]=e);for(var f=0;f<c;f++)e[f]=w.TilePerLayerInfo.makeEmptyLayerInfo(b,this._surface.upsampleInfoPool,e[f]),0===b&&this.findElevationBoundsForLayer(f,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(d.tilingScheme.pixelSize,
v.MAX_PATCH_TESSELATION)};b.prototype.release=function(){G(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(B.tile2str(this));for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this._surface=this._parent=null;this._usedMemory=P};b.prototype.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(B.tile2str(this))};b.prototype.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){var a=
this.cachedMemory;0<a&&(this._surface.upsampleMapCache.put(B.tile2str(this),this,a),this.setMemoryDirty())}};b.prototype.setMemoryDirty=function(){this._usedMemory=P};Object.defineProperty(b.prototype,"cpuImageMemorySize",{get:function(){var a=this._surface.tilingScheme.pixelSize;return a*a*4},enumerable:!0,configurable:!0});b.prototype._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;for(var a=this.cpuImageMemorySize,b=0,c=this.layerInfo[1];b<c.length;b++){var d=c[b],d=d.data;
if(d instanceof A.TileTexture)this._mapTileMemory+=C.getGpuMemoryUsage(d.texture);else if(d instanceof HTMLImageElement||d instanceof p.ImageWithType)this._mapTileMemory+=a}b=0;for(c=this.layerInfo[0];b<c.length;b++)d=c[b],this._usedMemory+=d.data?a:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,a=this.renderData.textureDescriptor)&&(this._mapTileMemory+=C.getGpuMemoryUsage(a));this.isCached&&this._surface.upsampleMapCache.updateSize(B.tile2str(this),this,this.cachedMemory)};
b.prototype.getUsedMemoryForLayer=function(a,b){b=this.layerInfo[a][b];if(!b||!b.data)return 0;if(1===a&&!this.isCached){a=b.data;if(a instanceof A.TileTexture)return C.getGpuMemoryUsage(a.texture);if(a instanceof HTMLImageElement||a instanceof p.ImageWithType)return this.cpuImageMemorySize;if(a instanceof r.VectorTile)return a.getMemoryUsage()}else if(0===a)return this.cpuImageMemorySize;return 0};b.prototype.updateScreenDepth=function(a){d.vec3.copy(H,this._center[0]);H[3]=1;n.vec4.transformMat4(H,
H,a);this._screenDepth=0>H[2]?0:H[2]/H[3]};b.prototype.shouldSplit=function(a,b,c){var e=this.level;d.vec3.subtract(J,this._center[0],b);var g=d.vec3.squaredLength(J),k=0;d.vec3.subtract(I,this._center[1],b);var h=d.vec3.squaredLength(I);h<g&&(g=h,k=1);d.vec3.subtract(I,this._center[2],b);h=d.vec3.squaredLength(I);h<g&&(g=h,k=2);if(this._edgeLen2>g&&e<a.maxLod||0===c&&1===this._surface.snapLevel-e)return 1;c=Math.sqrt(g);var h=d.vec3.dot(this.up,J),g=this._elevationBounds[1]-this._elevationBounds[0],
m=g/this.edgeLen;if(a.aboveGround&&0<h&&.001>m&&0<h/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-m)return 0;m=this._edgeLen/(a.fovX*c*2);return m<a.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,2):0:e>=a.maxLod?(a=e+Math.ceil(-f.log2(a.relativeWidthLimit/m)),a!==this.vlevel?(this.vlevel=a,2):0):6<e&&(d.vec3.subtract(I,this._center[k],b),d.vec3.scale(K,this.up,h),d.vec3.subtract(K,K,I),e=d.vec3.squaredLength(K),e>this._radius*this._radius&&(d.vec3.scale(K,
K,this._radius/Math.sqrt(e)),d.vec3.add(K,K,this._center[k]),d.vec3.subtract(K,b,K),Math.min(1,(Math.abs(d.vec3.dot(K,this.up))+.5*g+this._curvatureHeight)/d.vec3.length(K))*(this._edgeLen/(a.fovY*c*2))<.1/a.angledSplitBias*a.relativeHeightLimit))?0:1};b.prototype.setChildren=function(a,b,c,d){G(!!(a&&b&&c&&d),"Null child passed");this._children[0]=a;this._children[1]=b;this._children[2]=c;this._children[3]=d};b.prototype.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=
null;this._children[3]=null};b.prototype.load=function(a){this.refMapData();for(var b=0;2>b;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};b.prototype.unload=function(a){a.unloadTile(this);for(a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];d.loadingAgent&&d.loadingAgent!==m.TILE_AGENT_DONE&&(E(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.resetPendingUpdate(16);this.resetPendingUpdate(32);this.unrefMapData()};b.prototype.unloadMapData=
function(){for(var a=0,b=this.layerInfo[1];a<b.length;a++){var c=b[a];c.loadingAgent&&c.loadingAgent!==m.TILE_AGENT_DONE&&(E(c.loadingAgent),c.loadingAgent=null);c.pendingUpdates=0}this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};b.prototype.updateClippingStatus=function(a){if(g.equals(a,this._clippingArea))return!1;var b=this._intersectsClippingArea,c=this._isWithinClippingArea;a?(this._intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):
this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=a;this.updateVisibility();a=c&&this._isWithinClippingArea;b=!c&&!b&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||a||b||this.setPendingUpdate(16);return!0};b.prototype.updateVisibility=function(){this._dirty=!0;this._surface.setPendingUpdates()};b.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};b.prototype.hasLayerData=function(a,b){a=this.layerInfo[b][a];return!(!a||!a.data||
a.dataInvalidated)};b.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};Object.defineProperty(b.prototype,"updating",{get:function(){if(this.hasPendingUpdates)return!0;for(var a=0;2>a;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++){var d=c[b];if(d.loadingAgent&&d.loadingAgent!==m.TILE_AGENT_DONE&&d.loadingAgent.updating)return!0}return!1},enumerable:!0,configurable:!0});b.prototype.isSuspended=function(a){return this.hasPendingUpdate(1)?
!0:0===a?!1:!this.visible};Object.defineProperty(b.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});b.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};b.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};b.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};b.prototype.requestLayerData=function(a,b,c){v.TILE_LOADING_DEBUGLOG&&
console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),
b,a),c.dataArrived(this),!0;if(d.requestPromise)return!0;d.requestAbort=h.createAbortController();var e=this._surface.requestTileData(this,a,b,d.requestAbort);if(!e)return d.requestAbort=null,!1;a=function(){d.requestPromise===e&&(d.requestPromise=null,d.requestAbort=null)};d.requestPromise=e;e.then(a,a);return!!d.requestPromise};Object.defineProperty(b.prototype,"isLeaf",{get:function(){return null==this._children[0]},enumerable:!0,configurable:!0});b.prototype.hasLij=function(a){return this.lij[0]===
a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};b.prototype.findByLij=function(a){return this.hasLij(a)?this:this.isLeaf?null:(a=this._children[0].findByLij(a)||this._children[1].findByLij(a)||this._children[2].findByLij(a)||this._children[3].findByLij(a))?a:null};b.prototype.distanceToSquared=function(a){return d.vec3.squaredLength(d.vec3.subtract(K,this._center[0],a))};b.prototype.containsPoint=function(a){var b=this.extent;return a[0]>=b[0]&&a[1]>=b[1]&&a[0]<=b[2]&&a[1]<=b[3]};b.prototype.unrequestLayerData=
function(a,b,c){v.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=l.removeUnordered(e,c);G(c,"agent has not requested this piece of map data");1>e.length&&(d.abortRequest(),v.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a),this._updateMemoryUsed())};b.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];
a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile "+this.lij.toString()+" layer "+b+"/"+a+" error "+c);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing();a.waitingAgents.length=0;this._updateMemoryUsed()};b.prototype.updateRenderData=function(a){switch(a){case 1:return this.updateTexture();
case 0:return this.updateGeometry()}};b.prototype.updateTexture=function(){this.renderData&&this.setPendingUpdate(32)};b.prototype.updateGeometry=function(){this.setPendingUpdate(16);for(var a=0,b=this.layerInfo[0];a<b.length;a++)b[a].pendingUpdates|=16};b.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};b.prototype.computeElevationBounds=function(){a.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var b=!0,c=0,d=
this.layerInfo[0];c<d.length;c++){var e=d[c];e.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],e.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],e.elevationBounds.max),e.elevationBounds.hasNoDataValues||(b=!1))}b&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter()};b.prototype._updateCenter=function(){d.vec3.scale(K,this.up,.5*(this._elevationBounds[0]+
this._elevationBounds[1]));d.vec3.add(this._center[0],this.centerAtSeaLevel,K);d.vec3.scale(K,this.up,this._elevationBounds[0]);d.vec3.add(this._center[1],this.centerAtSeaLevel,K);d.vec3.scale(K,this.up,this._elevationBounds[1]);d.vec3.add(this._center[2],this.centerAtSeaLevel,K)};b.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[0][a];if(!c.elevationBounds||c.elevationBounds.level<b)if(b=this._surface.layerViewByIndex(a,0),B.fallsWithinLayer(this,b.layer,!1)){b=L;var d=!1;
if(c.data){var e=c.data;b.min=e.bounds[0];b.max=e.bounds[1];b.hasNoDataValues=e.hasNoDataValues;b.level=this.lij[0];d=!0}else{for(var f=0,g=void 0,e=void 0,k=this._parent;k&&(!e||f<v.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(f=this.vlevel-k.level,g=e||g,e=k.layerInfo[0][a].data,!e&&g&&f>=v.ELEVATION_DESIRED_RESOLUTION_LEVEL);k=k._parent);if(e=e||g)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],b),Infinity!==b.min&&(b.level=e.level,d=!0)}d&&(c.elevationBounds||(c.elevationBounds=new u.ElevationBounds),
c.elevationBounds.copyFrom(b))}};b.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&f.loadingAgent!==m.TILE_AGENT_DONE&&(E(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(1===c)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var g=b[e];f[e]=-1<g?d[g]:w.TilePerLayerInfo.makeEmptyLayerInfo(c,this._surface.upsampleInfoPool)}this.layerInfo[c]=f;this._updateMemoryUsed()};b.prototype.restartAgents=
function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};b.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===m.TILE_AGENT_DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};b.prototype.updateAgentSuspension=function(){for(var a=0;2>a;a++)for(var b=this.isSuspended(a),c=0,d=this.layerInfo[a];c<d.length;c++){var e=d[c];e.loadingAgent&&e.loadingAgent!==m.TILE_AGENT_DONE&&(e.loadingAgent.setSuspension(b),
e.loadingAgent===m.TILE_AGENT_DONE&&this.updateRenderData(a))}};b.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==m.TILE_AGENT_DONE&&a.loadingAgent.dispose();a.loadingAgent=null};b.prototype.agentDone=function(a,b){var c=this.layerInfo[b][a];c.loadingAgent=m.TILE_AGENT_DONE;c.data||c.upsampleInfo||this._createOrUpdateAgents(a+1,b)};b.prototype._createOrUpdateAgents=function(a,b){for(var c=this.isSuspended(b),d=this.layerInfo[b];a<d.length;++a){var e=
d[a],f=!1,g=this._surface.layerViewByIndex(a,b);if(e.loadingAgent)B.fallsWithinLayer(this,g.layer,!1)?(e.loadingAgent!==m.TILE_AGENT_DONE&&(v.TILE_LOADING_DEBUGLOG&&console.log(B.tile2str(this),"update suspended",c),e.loadingAgent.setSuspension(c)),e.loadingAgent!==m.TILE_AGENT_DONE&&(f=e.loadingAgent.update(),v.TILE_LOADING_DEBUGLOG&&console.log(B.tile2str(this),"update"))):e.dispose();else if(B.fallsWithinLayer(this,g.layer,!1)){var f=e,k=a,h=b,l=c,p=0===h?t.Pool.acquire():x.Pool.acquire();p.init(this,
k,h,l);f.loadingAgent=p;f=e.loadingAgent.startLoading();v.TILE_LOADING_DEBUGLOG&&console.log(B.tile2str(this),"start");f?e.loadingAgent===m.TILE_AGENT_DONE&&(v.TILE_LOADING_DEBUGLOG&&console.log(B.tile2str(this),"done"),this.setPendingUpdate(16)):(E(e.loadingAgent),e.loadingAgent=m.TILE_AGENT_DONE,v.TILE_LOADING_DEBUGLOG&&console.log(B.tile2str(this),"done"))}e.loadingAgent===m.TILE_AGENT_DONE&&this.updateRenderData(b);if(f&&g.isOpaque)break}};b.prototype.isWithinExtent=function(a){var b=this.extent;
return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};b.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};Object.defineProperty(b.prototype,"test",{get:function(){return{cachedMemory:this.cachedMemory}},enumerable:!0,configurable:!0});return b}();b.Tile=q;var L=new u.ElevationBounds,P=-1})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require","exports","./TileAgent","./tileUtils"],function(q,b,l,f){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(a,b){this._pool=b;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}b.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequestAbort=this.tilemapRequestPromise=this.tilemap=null;this._unsetUpsampleInfo();
this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===a&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};b.prototype.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),this.requestAbort=this.requestPromise=null)};b.prototype.abortTilemapRequest=function(){this.tilemapRequestPromise&&(this.tilemapRequestAbort.abort(),this.tilemapRequestAbort=
this.tilemapRequestPromise=null)};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==l.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this.abortTilemapRequest();this.tilemap=null;this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){!this.data||this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement||this.data.release();this.data=null};Object.defineProperty(b.prototype,
"upsampleInfo",{get:function(){return this._upsampleInfo},enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};b.prototype.setUpsampleInfo=function(a,b){if(a===b||null==b)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===b)return;this._upsampleInfo.tile.unrefMapData()}b.refMapData();
f.computeUpsampleInfo(a,b,this._upsampleInfo)}};b.makeEmptyLayerInfo=function(a,e,d){return d?(d.init(a),d):new b(a,e)};return b}();b.TilePerLayerInfo=q})},"esri/views/3d/terrain/TileTexture":function(){define(["require","exports","../../webgl","../../webgl/Texture"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,d){this._refCount=1;this._texture=a instanceof l.RenderingContext?new f(a,b,d):a}b.prototype.retain=function(){++this._refCount};b.prototype.release=
function(){--this._refCount;0===this._refCount&&this._texture.dispose()};Object.defineProperty(b.prototype,"texture",{get:function(){return this._texture},enumerable:!0,configurable:!0});b.prototype.generateMipmap=function(){this._texture.generateMipmap()};Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._texture.descriptor},enumerable:!0,configurable:!0});return b}();b.TileTexture=q})},"esri/views/3d/terrain/SphericalPatch":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/projectionUtils ./PatchGeometryFactory ./Tile".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(d,e,f){var g=b.call(this,c.NumSubdivisionsAtLevel)||this;g.obb=Array(8);g.isWebMercator=!1;for(var k=0;8>k;k++)g.obb[k]=a.vec3f64.create();void 0!==d&&g.init(d,e,f);return g}l(c,b);c.prototype.init=function(c,d,g){b.prototype.init.call(this,c,d,g);this.isWebMercator=g.tilingScheme.spatialReference.isWebMercator;d=this.extentInRadians[0];g=this.extentInRadians[1];var l=this.extentInRadians[2],
p=this.extentInRadians[3];c=c[0];var n=f.lerp(g,p,.5),m=f.lerp(d,l,.5);this._edgeLen=(l-d)*Math.cos(0===c?0:Math.min(Math.abs(g),Math.abs(p)))*e.earthRadius;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=e.earthRadius-Math.sqrt(e.earthRadius*e.earthRadius-this._edgeLen2/4);k.wgs84ComparableLonLatToECEF(this.centerAtSeaLevel,m,n,0);d=a.vec3f64.fromArray(this.centerAtSeaLevel);h.vec3.normalize(d,d);this.up=d;this._updateOBB();this.updateRadiusAndCenter()};c.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])h.vec3.set(this._center[0],0,0,0),h.vec3.set(this._center[1],0,0,0),h.vec3.set(this._center[2],0,0,0),this._radius=e.earthRadius+this.elevationBounds[1];else{this._updateCenter();var a=Math.max(h.vec3.squaredDistance(this._center[0],this.obb[0]),h.vec3.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(a)}};c.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return d.frustum.intersectsSphere(a,
d.sphere.wrap(this._radius,this._center[0]));for(var b=this.obb,c=0;6>c;c++){for(var e=void 0,e=0;8>e&&!d.plane.isPointOutside(a[c],b[e]);e++);if(8===e)return!1}return!0};c.prototype.computeElevationBounds=function(){b.prototype.computeElevationBounds.call(this);this._updateOBB()};c.prototype.createGeometry=function(a,b){var c=this._isPole(this.lij[1],this.lij[0]);n.createSphericalGlobePatch(a,this.extent,b,this.renderData,this.extentInRadians,this.isWebMercator,c);this.setMemoryDirty()};c.prototype._updateOBB=
function(){for(var a=this.extentInRadians,b=this.obb,c=0;2>c;c++){var d=this.elevationBounds[c],f=4*c;k.wgs84ComparableLonLatToECEF(b[f++],a[0],a[1],d);k.wgs84ComparableLonLatToECEF(b[f++],a[0],a[3],d);k.wgs84ComparableLonLatToECEF(b[f++],a[2],a[3],d);k.wgs84ComparableLonLatToECEF(b[f++],a[2],a[1],d)}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(h.vec3.set(b[1],0,0,e.earthRadius),h.vec3.set(b[2],0,0,e.earthRadius),h.vec3.set(b[5],0,0,e.earthRadius),h.vec3.set(b[6],0,0,e.earthRadius)):
1===a&&(h.vec3.set(b[0],0,0,-e.earthRadius),h.vec3.set(b[3],0,0,-e.earthRadius),h.vec3.set(b[4],0,0,-e.earthRadius),h.vec3.set(b[7],0,0,-e.earthRadius)))};c.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};c.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return c}(c.Tile);b.SphericalPatch=q})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){function p(a,b){a&&!a.spatialReference.equals(b)&&(a=n.canProject(a.spatialReference,b)?n.project(a,b):null);return a}Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(c){c=b.call(this,c)||this;c._handles=new a;return c}l(c,b);c.prototype.initialize=function(){var a=this;this._handles.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};c.prototype.destroy=function(){this._handles.destroy();this._handles=
null};Object.defineProperty(c.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});c.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var e=a[d].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=p(e.fullExtent,b),null!=e&&c.push(k.fromExtent(e)))}return c};
f([d.property({readOnly:!0})],c.prototype,"layerViewsExtent",null);f([d.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],c.prototype,"tiledLayersExtent",null);f([d.property({readOnly:!0,dependsOn:["spatialReference"]})],c.prototype,"stencilEnabledExtents",null);f([d.property()],c.prototype,"spatialReference",null);f([d.property()],c.prototype,"tilingScheme",null);f([d.property()],c.prototype,"defaultTiledLayersExtent",void 0);f([d.property({constructOnly:!0})],c.prototype,"layers",
void 0);f([d.property({constructOnly:!0})],c.prototype,"layerViews",void 0);return c=f([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],c)}(d.declared(h));h=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?g.WEBMERCATOR_WORLD_EXTENT:
g.GEOGRAPHIC_WORLD_EXTENT};f([d.property({dependsOn:["spatialReference"]})],b.prototype,"layerViewsExtent",void 0);return b=f([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],b)}(d.declared(q));b.SurfaceExtentHelperGlobal=h;q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);b.prototype.initialize=function(){var a=this;this._handles.add([this.layers.on("change",function(b){return a._handleLayersChanged(b)}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};
b.prototype._handleLayersChanged=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++)this._handles.remove(d[c].uid);c=0;for(a=a.added;c<a.length;c++)d=a[c],this._handles.add(e.init(d,"loaded",function(){return b.notifyChange("tiledLayersExtent")}),d.uid)};b.prototype._computeLayerViewsExtent=function(){var a=k.empty(),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=p(c,b))&&k.expand(a,c))});var c=k.allFinite(a)?
a:null,d=this._get("layerViewsExtent");return k.equals(c,d)?d:c};b.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=k.empty();this.layers.forEach(function(e){if(e.loaded&&c.isTiledLayer(e)){var f=r.getTiledLayerInfo(e,b,"local");e=f.tileInfo;f=f.fullExtent;e&&a.compatibleWith(e)&&f&&f.spatialReference.equals(b)&&k.expand(d,f)}});this.defaultTiledLayersExtent&&k.expand(d,this.defaultTiledLayersExtent);var e=k.allFinite(d)?d:null,
f=this._get("tiledLayersExtent");return k.equals(e,f)?f:e};return b=f([d.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],b)}(d.declared(q));b.SurfaceExtentHelperLocal=q})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../layers/support/layerUtils ../support/projectionUtils ./terrainUtils ./TilingScheme".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){return function(b){function g(c){c=b.call(this,c)||this;c._changeHandles=new a;return c}l(g,b);g.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};g.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};g.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b;this.layers.some(function(c){return!d.isTiledLayer(c)||c.isRejected()?!1:!c.isFulfilled()||n.getTiledLayerInfo(c,a.viewSpatialReference,a.manifold).tileInfo?(b=c,"vector-tile"!==c.type):!1});if(b)if(b.isResolved()){var e=n.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,e=new c(e);this._set("tilingSchemeDone",!0);this._lockTilingScheme(e)}else this._updateWhen(b);
else this._set("tilingSchemeDone",!0)}};g.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};g.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var d=a.levels.length-1;a.spatialReference.isWebMercator?a=c.makeWebMercatorAuxiliarySphere(d):k.canProjectToWGS84ComparableLonLat(a.spatialReference)&&(a=c.makeGCSWithTileSize(a.spatialReference,a.pixelSize,d))}this.tilingSchemeLocked=
!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};g.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};g.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var a=this.extentHelper.spatialReference;a.isWebMercator?this.tilingScheme=
c.WebMercatorAuxiliarySphere:k.canProjectToWGS84ComparableLonLat(a)&&(this.tilingScheme=c.makeGCSWithTileSize(a,256));this.extent=this.extentHelper.layerViewsExtent}else if(a=this.extentHelper.layerViewsExtent)this.tilingScheme=c.fromExtent(a,this.extentHelper.spatialReference),this.extent=a};f([e.property()],g.prototype,"tilingScheme",void 0);f([e.property()],g.prototype,"extent",void 0);f([e.property({value:!1})],g.prototype,"tilingSchemeLocked",void 0);f([e.property({readOnly:!0,value:!1})],g.prototype,
"tilingSchemeDone",void 0);f([e.property({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0);f([e.property({constructOnly:!0})],g.prototype,"layers",void 0);f([e.property({constructOnly:!0})],g.prototype,"extentHelper",void 0);f([e.property({constructOnly:!0})],g.prototype,"manifold",void 0);return g=f([e.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],g)}(e.declared(h))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ../support/buffer/BufferView ./PatchGeometryFactory ./PatchRenderData ./TileRenderer ./TileTexture ./tileUtils ../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S){function R(a,b,c){x.vec4.set(c,a[0]*b[2]+b[0],a[1]*b[3]+b[1],a[2]*b[2],a[3]*b[3])}var O=p.vec2f64.create(),Q=y.create(),T=v.vec4f64.create(),Y=v.vec4f64.create(),N=v.vec4f64.create(),Z=function(){return function(){this.extent=v.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();q=function(b){function e(a){a=b.call(this,a)||this;a.type="Terrain";a.tileSize=256;a.rctx=null;a.renderDataPool=new k(B.PatchRenderData);
a.patchGroups=new n({allocator:function(a){return a||{root:null,origin:null,patches:new n}},deallocator:function(a){a.root=null;a.origin=null;a.patches.clear();return a}});a.patchGroupsDirty=!0;a.patchGroupsMap=new Map;a.tileIterator=new G.IteratorPreorder;a.highestVisibleLODTile=null;a.visible=!0;a._opaque=!0;a._skirtScale=1;a._renderingDisabled=!1;a._renderOrder=1;a._velvetOverground=!0;a._wireframe=!1;a.castShadows=!0;a.emptyTex=null;a.tileRenderer=null;a.tileBackgroundInitialized=!1;a.tileBackgroundUpdating=
!1;a.stencilEnabledLayerExtents=[];a.numTrianglesRendered=0;a.numTilesRendered=0;a.numTilesCulled=0;a.numOriginsRendered=0;a.clippingExtent=null;a.needsHighlight=!1;a.visibleScaleRangeQueries=new n({initialSize:10});a.visibleScaleRangeQueriesInvPtr=0;a.visibleScaleRangeQueryQueue=new n({initialSize:30});a.visibleScaleRangeQueryPool=new k(Z,!1);return a}l(e,b);e.prototype.destroy=function(){A.clearCaches()};e.prototype.install=function(a){a.addRenderPlugin([3,8],this)};e.prototype.uninstall=function(a){a.removeRenderPlugin(this)};
Object.defineProperty(e.prototype,"updating",{get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canRender",{get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this._renderingDisabled},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"overlayEnabled",{get:function(){return this.shaderTechniqueConfig.overlayEnabled},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"renderingDisabled",{set:function(a){this._renderingDisabled=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"opaque",{get:function(){return this._opaque&&!this.shaderTechniqueConfig.slice},set:function(a){this._opaque!==a&&(this._opaque=a,this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"renderPatchBorders",{set:function(a){this.shaderTechniqueConfig.tileBorders!==a&&(this.shaderTechniqueConfig.tileBorders=a,this._updateAllProgramsAndPipelines())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"cullBackFaces",{set:function(a){this.shaderTechniqueConfig.backfaceCullingEnabled!==a&&(this.shaderTechniqueConfig.backfaceCullingEnabled=a,this._updateAllProgramsAndPipelines(),this.setNeedsRender())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this._updateAllProgramsAndPipelines())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"intersectionHandlerId",{get:function(){return K.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"slicePlane",{get:function(){return this.shaderTechniqueConfig.slice},set:function(a){this.shaderTechniqueConfig.slice!==a&&(this.shaderTechniqueConfig.slice=a,this._updateAllProgramsAndPipelines())},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"blendingEnabled",{set:function(a){this.shaderTechniqueConfig.blendingEnabled!==a&&(this.shaderTechniqueConfig.blendingEnabled=a,this._updateAllProgramsAndPipelines())},enumerable:!0,configurable:!0});e.prototype.setDebugScreenSizePerspective=
function(a){this.shaderTechniqueConfig.screenSizePerspective!==a&&(this.shaderTechniqueConfig.screenSizePerspective=a,this._updateAllProgramsAndPipelines())};e.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};e.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};e.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};e.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&
(this.tileRenderer.tileSize=a);this.setNeedsRender()};e.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a));this.updateTileGeometry(a);this.updateTileTexture(a)};e.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();x.vec4.copy(e.extent,a);e.minLevel=b?b:-Number.MAX_VALUE;e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);
this.setNeedsRender()};e.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(a),a.resetPendingUpdate(32))};e.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[0];b<c.length;b++)c[b].pendingUpdates&=-17;a.resetPendingUpdate(16);a.renderData.updateGeometry(this.rctx,this._wireframe)&&this.setNeedsRender()};e.prototype.unloadTile=function(a){a.renderData&&(a.renderData.releaseTexture(),this.releaseTileGeometry(a.renderData),
a.renderData=null,a.setMemoryDirty(),this.setNeedsRender())};e.prototype._getLocalOriginOfTile=function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return t.vec3f64.ZEROS;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};e.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};e.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};e.prototype.setWireframe=function(a){var b=this;this._wireframe!==a&&(this._wireframe=a,this.rootTiles&&(G.traverseTilesPreorder(this.rootTiles,function(c){c.renderData&&c.renderData.updateGeometry(b.rctx,a)}),this.setNeedsRender()))};e.prototype.setNeedsRender=function(a){void 0===a&&(a=1);this.patchGroupsDirty=!0;this.initContext.requestRender(a)};e.prototype.setTileBackground=function(a){this.tileBackground=a;this._updateTileBackground()};e.prototype.initializeRenderContext=
function(a){var b=this;this.initContext=a;this.rctx=a.rctx;this.shaderTechniques=a.shaderTechniqueRep;this.shaderTechniqueConfig=new S.TerrainTechniqueConfiguration;this._updateAllProgramsAndPipelines();this.shaderTechniques=a.shaderTechniqueRep;this.tileRenderer=new C(this.rctx,this.tileSize,this.shaderTechniques,function(){return b.setNeedsRender()});this.tileBackground&&this._updateTileBackground();this.emptyTex=new E.TileTexture(I.createEmptyTexture(this.rctx))};e.prototype.uninitializeRenderContext=
function(){null!=this.emptyTex&&(this.emptyTex.release(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};e.prototype.intersect=function(a,b,c,e){if(this.rootTiles&&(!a.options.selectOpaqueTerrainOnly||!a.options.selectionMode||this._opaque)){var f=F,g=ca;u.vec3.subtract(f,e,c);u.vec3.set(g,1/f[0],1/f[1],1/f[2]);var k=a.results.min,h=a.results.max,m=a.results.terrain,l=0===a.options.store,p=null,n=this.clippingExtent,t=this.tileIterator;t.reset(this.rootTiles);
for(var v=d.isSome(a.options.verticalOffset)?a.options.verticalOffset.terrain:null,x=function(){var x=t.next();if(null===x.renderData)return"continue";if(a.options.invisibleTerrain){if(!x.visible&&n&&!x.intersectsExtent(n))return"continue"}else if(!x.visible)return"continue";var B=x.renderData.geometryInfo,C=x.renderData.localOrigin,E=-q._skirtScale*B.skirtLength;y.set(Q,B.boundingBox);d.isSome(v)&&(v.localOrigin=C,v.applyToAABB(Q));if(0!==E){var H=x.up;y.expandWithOffset(Q,E*H[0],E*H[1],E*H[2])}u.vec3.subtract(U,
c,C);if(!P.intersectAabbInvDirBefore(Q,U,g,a.tolerance,l&&null!=k.dist?k.dist:Infinity))return"continue";var O=function(a,b,c,d){a.set(void 0,G.tile2str(b),c,d,r.mat4f64.IDENTITY,void 0);a.intersector=ha;a.target={type:"external",metadata:{tile:b}}},H=function(g,l){0<=g&&(a.options.backfacesTerrain||0>u.vec3.dot(l,f))&&(a.options.invisibleTerrain||!a.options.selectionMode||null==b||b(c,e,g))&&((null==m.dist||g<m.dist)&&O(m,x,g,l),a.options.storeTerrainResults&&(2===a.options.store&&(d.isNone(p)?(p=
new K.IntersectorResult(a.ray),O(p,x,g,l),a.results.all.push(p)):g<p.dist&&O(p,x,g,l)),(null==k.dist||g<k.dist)&&O(k,x,g,l),0!==a.options.store&&(null==h.dist||g>h.dist)&&O(h,x,g,l)))},N=ea;u.vec3.subtract(N,e,C);var C=B.indices,J=B.vertexAttributes,I={data:J.getField("position",w.BufferViewVec3f).typedBuffer,size:3,offsetIdx:0,strideIdx:J.stride/4},B=B.numWithoutSkirtIndices/3;P.intersectTriangles(U,N,0,B,C,I,null,v,H);0!==E&&A.intersectSkirts(U,N,B,C.length/3,C,J,"spherical"===q.manifold?function(a){return u.vec3.scale(a,
a,E/u.vec3.length(a))}:function(a){return u.vec3.set(a,0,0,E)},v,H)},q=this;!t.done;)x()}};e.prototype.render=function(a){if(a.slot!==(this.opaque?3:8))return!1;L.trace("# BEGIN RENDER TERRAIN");var b=a.pass,c=1===a.scenelightingData.globalFactor,d=this._updatePatchGroups();W.overlayEnabled=!1;W.used=!0;switch(b){case 0:W.overlayEnabled=!0;W.used=!1;b=a.shadowMap&&a.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==b&&(this.shaderTechniqueConfig.receiveShadows=b,this._updateAllProgramsAndPipelines());
b=!this.overlayRenderer.isEmpty();this.shaderTechniqueConfig.overlayEnabled!==b&&(this.shaderTechniqueConfig.overlayEnabled=b,this._updateAllProgramsAndPipelines());this._renderMaterialPass(a,0,d,W);break;case 3:this.castShadows&&c&&this._renderAuxiliaryPass(a,3,d,W);break;case 1:this._renderAuxiliaryPass(a,1,d,W);break;case 2:this._renderAuxiliaryPass(a,2,d,W);break;case 4:this.needsHighlight&&(W.overlayEnabled=!0,this._renderAuxiliaryPass(a,4,d,W),a.rctx.clearSafe(256))}L.trace("# END RENDER TERRAIN");
0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};e.prototype._renderMaterialPass=function(a,b,c,d){var e=this,f=a.rctx,g=a.camera;this._setTerrainTechnique(b);var k=this.shaderTechnique.program;a.rctx.bindProgram(k);f.bindProgram(k);a.shadowMap&&a.shadowMap.bind(k);a.ssaoHelper&&a.ssaoHelper.setUniforms(k);k.setUniform1i("tex",0);k.setUniform1i("texOld",1);this._bindOverlayUniforms(k);k.setUniformMatrix4fv("viewNormal",g.viewInverseTransposeMatrix);k.setUniformMatrix4fv("proj",
g.projectionMatrix);a.scenelightingData.setUniforms(k,!0);b=g.viewMatrix;u.vec3.set(V,b[12],b[13],b[14]);u.vec3.normalize(V,V);k.setUniform3fv("viewDirection",V);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(a,k,c,d):a.offscreenRenderingHelper.renderToTargets(function(){return e._renderPatchGroups(a,k,c,d)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,
0,0,0]);this._processScaleRangeQueries()};e.prototype._renderAuxiliaryPass=function(a,b,c,d){this._setTerrainTechnique(b);b=this.shaderTechnique.program;a.rctx.bindProgram(b);if(4===a.pass){var e=a.offscreenRenderingHelper;a.rctx.bindTexture(e.depthTexture,6);b.setUniform1i("depthTex",6);b.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height)}else if(b.setUniformMatrix4fv("viewNormal",a.camera.viewInverseTransposeMatrix),1===a.pass||3===a.pass)O[0]=a.camera.near,O[1]=a.camera.far,b.setUniform2fv("nearFar",
O);this._renderPatchGroupsAuxiliary(a,b,c,d)};e.prototype._updateTileBackground=function(){var b=this;if(this.tileRenderer){this.tileBackgroundUpdating=!0;var c=function(){b.tileBackgroundInitialized=!0;b.tileBackgroundUpdating=!1;b.rootTiles&&G.traverseTilesPreorder(b.rootTiles,function(a){return b.tileRenderer.updateTileTexture(a)});b.setNeedsRender()};if("string"===typeof this.tileBackground){var d=this.tileBackground;m.requestImage(d).then(function(a){d===b.tileBackground&&b.tileRenderer&&(b.tileRenderer.setBackground(a),
c())})}else{var e=this.tileBackground?a.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(e);c()}}};e.prototype._updatePatchGroups=function(){var a=this,b=this.patchGroups;if(!this.patchGroupsDirty)return b;this.highestVisibleLODTile=null;this._renderCollectOrigins(b);if(0!==this.renderOrder){for(var c=0;c<b.length;c++)G.sortTiles(this.renderOrder,b.data[c].patches);b.sort(function(b,c){var d=a.renderOrder;b=0===b.patches.length?-d:0===c.patches.length?d:G.compareTiles(b.patches.data[0],
c.patches.data[0],d);return b})}this.patchGroupsDirty=!1;return b};e.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?t.vec3f64.ZEROS:e.centerAtSeaLevel;f.patches.clear();this._renderCollectOriginsForRoot(a,f)}a.filterInPlace(function(a){return 0<a.patches.length})};e.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.patchGroupsMap;
d.clear();for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.patches.clear()}if(!b.rendered)this.numTilesCulled++;else if(e){(f=d.get(e.localOrigin))&&f.patches.push(b);if(!this.highestVisibleLODTile||b.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=b;c.skipSubtree()}}}};e.prototype._scaleQueriesForTile=
function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};e.prototype._tileIntersectsStencilEnabledLayer=function(a){for(var b=0,c=this.stencilEnabledLayerExtents;b<c.length;b++)if(a.intersectsExtent(c[b]))return!0;
return!1};e.prototype._renderPatchGroupsAuxiliary=function(a,b,c,d){this.shaderTechnique.bindPipelineState(a.rctx);var e=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",a.camera.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d.overlayEnabled&&this._bindOverlayUniforms(b);for(var f=0;f<c.length;f++){var g=c.data[f];this._bindViewForPatchGroup(b,g,a.camera.eye,a.camera.viewMatrix);for(var k=0;k<g.patches.length;k++)this._renderPatch(a.rctx,b,g.patches.data[k],
4,e,d)}a.rctx.bindVAO(null)};e.prototype._renderPatchGroups=function(a,b,c,e){var f=a.rctx,g=a.camera,k=g.viewMatrix;this.shaderTechnique.bindPipelineState(f);if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var h=H.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:g.fovY});P.bindScreenSizePerspective(h,b,"screenSizePerspective")}h=0<this.stencilEnabledLayerExtents.length;b.setUniform1f("skirtScale",
this._skirtScale);for(var m=this._wireframe?1:4,l=0;l<c.length;l++){var p=c.data[l],n=p.patches;if(0!==n.length){this._bindViewForPatchGroup(b,p,g.eye,k);var r=a.sliceHelper&&a.sliceHelper.plane;r&&P.bindSlicePlane(p.origin,r,b);a.shadowMap&&a.shadowMap.bindView(b,p.origin);this.numOriginsRendered++;for(p=0;p<n.length;p++)if(r=n.data[p],!d.isNone(r.renderData.textureReference)){L.trace("# RENDER TILE "+G.tile2str(r)+", screenDepth:"+r.screenDepth);R(r.renderData.geometryInfo.uvOffsetAndScale,r.renderData.texOffsetAndScale,
N);b.setUniform4fv("texOffsetAndScale",N);f.bindTexture(r.renderData.textureReference.texture,0);var w=r.renderData.oldTextureReference;if(this.shaderTechniqueConfig.blendingEnabled&&d.isSome(w)){this.setNeedsRender();var t=r.renderData.textureBlendFactor;R(r.renderData.geometryInfo.uvOffsetAndScale,r.renderData.oldTexOffsetAndScale,N);b.setUniform1f("blend",t);b.setUniform4fv("oldTexOffsetAndScale",N);f.bindTexture(w.texture,1)}else b.setUniform1f("blend",1),f.bindTexture(this.emptyTex.texture,1);
b.setUniform1f("opacity",r.renderData.opacity);w=this._renderPatch(f,b,r,m,h,e);r.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=w/3;this._scaleQueriesForTile(r)}}}f.bindVAO(null)};e.prototype._renderPatch=function(a,b,c,d,e,f){f.overlayEnabled&&(this._bindOverlayTextures(b,c.renderData.overlays,f.used),b.setUniform1f("overlayOpacity",c.renderData.overlayOpacity));e&&(this._tileIntersectsStencilEnabledLayer(c)?this.stencilShaderTechnique.bindPipelineState(a):
this.shaderTechnique.bindPipelineState(a));e=0===this._skirtScale?c.renderData.geometryInfo.numWithoutSkirtIndices:c.renderData.vao.indexBuffer.size;a.bindVAO(c.renderData.vao);b.assertCompatibleVertexAttributeLocations(c.renderData.vao);a.drawElements(d,e,c.renderData.vao.indexBuffer.indexType,0);return e};e.prototype._bindViewForPatchGroup=function(a,b,c,d){a.setUniform3fv("origin",b.origin);g.mat4.translate(aa,d,b.origin);a.setUniformMatrix4fv("view",aa);a.setUniform3f("camPos",c[0]-b.origin[0],
c[1]-b.origin[1],c[2]-b.origin[2])};e.prototype._bindOverlayUniforms=function(a){a.setUniform1i("ovInnerColorTex",2);a.setUniform1i("ovOuterColorTex",3);a.setUniform1i("ovInnerWaterTex",4);a.setUniform1i("ovOuterWaterTex",5)};e.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;g?(T[e]=f.texOffset[0],T[e+1]=f.texOffset[1],Y[e]=f.texScale[0],Y[e+1]=f.texScale[1],e=this.overlayRenderer.getRenderTargetTexture(g),this.rctx.bindTexture(e,
2+d),(f=f.waterMaskRenderTargetId)?(f=this.overlayRenderer.getRenderTargetTexture(f),this.rctx.bindTexture(f,4+d)):this.rctx.bindTexture(this.emptyTex.texture,4+d)):(T[e]=0,T[e+1]=0,Y[e]=0,Y[e+1]=0,this.rctx.bindTexture(this.emptyTex.texture,2+d),this.rctx.bindTexture(this.emptyTex.texture,4+d))}a.setUniform4fv("overlayTexOffset",T);a.setUniform4fv("overlayTexScale",Y)};e.prototype._setTerrainTechnique=function(a){this.shaderTechniqueConfig.output=a;0===a&&(a="spherical"===this.manifold,this.shaderTechniqueConfig.overlayEnabled=
this.overlayEnabled,this.shaderTechniqueConfig.atmosphere=a&&this._velvetOverground);this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(S.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(S.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};e.prototype._updateAllProgramsAndPipelines=
function(){var a=this;J.ShaderOutputTypes.forEach(function(b){b=b.output;0!==b&&1!==b&&3!==b&&2!==b&&4!==b||a._setTerrainTechnique(b)});this.setNeedsRender()};e.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};e.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};
e.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};Object.defineProperty(e.prototype,"test",{get:function(){return{tileRenderer:this.tileRenderer}},enumerable:!0,configurable:!0});h([c.property()],e.prototype,"tileBackgroundInitialized",void 0);h([c.property()],e.prototype,"tileBackgroundUpdating",void 0);
h([c.property({constructOnly:!0})],e.prototype,"manifold",void 0);h([c.property({constructOnly:!0})],e.prototype,"overlayRenderer",void 0);h([c.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],e.prototype,"updating",null);return e=h([c.subclass("esri.views.3d.terrain.TerrainRenderer")],e)}(c.declared(e));var W={overlayEnabled:!1,used:!0},aa=r.mat4f64.create(),V=t.vec3f64.create(),F=t.vec3f64.create(),ca=t.vec3f64.create(),U=t.vec3f64.create(),ea=t.vec3f64.create(),
ha="TerrainRenderer";return q})},"esri/views/3d/terrain/PatchRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../core/now ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/buffer/glUtil ./PatchGeometryFactory ./TerrainConst ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.overlayTexOffset=d.vec2f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:n.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:k.vec4f64.create()};this._textureReferences=[]}b.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=null;n.empty(a.boundingBox);
a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};for(this._vao=null;0<this._textureReferences.length;)this._textureReferences.pop().texture.release();this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetId=null;c.highlightRenderTargetId=null;c.waterMaskRenderTargetId=null;e.vec2.set(c.texScale,1,1);e.vec2.set(c.texOffset,0,0)}}else for(this.overlays=
[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetId:null,highlightRenderTargetId:null,waterMaskRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};b.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a);return!0};b.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};
b.prototype.ensureTexture=function(a,b){h.isSome(this._texture)&&this._texture.descriptor.width!==a&&this.releaseTexture();this._texture||(this._texture=b(),this.tile.setMemoryDirty());return this._texture};b.prototype.releaseTexture=function(){this._expireTextureReference();h.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};b.prototype._expireTextureReference=function(){if(0!==this._textureReferences.length)if(0>=this.tile.surface.textureBlendTime)for(;0<
this._textureReferences.length;)this._textureReferences.pop().texture.release();else{for(;2<this._textureReferences.length;)this._textureReferences.pop().texture.release();var b=this._textureReferences[this._textureReferences.length-1];0===b.age&&(b.age=a())}};b.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),c=this.tile.level,d=8>c?this.tile.numSubdivisionsAtLevel[c]+1:2;b.samplerData&&(d=this.tile.maxTesselation,d=f.clamp((d>>Math.max(c-b.maxTileLevel,r.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-c)))+1,2,d+1));c=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)c=null;var e=this.geometryState,g=!1;e.numVertsPerRow!==d&&(e.numVertsPerRow=d,g=!0);b.changed&&(e.samplerData=b.samplerData,g=!0);l.equals(e.clippingArea,c)||(e.clippingArea=c,g=!0);e.wireframe!==a&&(e.wireframe=a,g=!0);return g};b.prototype._createGeometry=function(a){this.tile.createGeometry(this.geometryState,this.localOrigin);var b=this.geometryInfo.vertexAttributes,
d=this.geometryInfo.indices,e=a.gl;this._vao=new x(a,u.Default3D,{geometry:c.glLayout(b.layout)},{geometry:t.createVertex(a,e.STATIC_DRAW,b.buffer)},t.createIndex(a,e.STATIC_DRAW,d))};b.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;g.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(b.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureReference",{get:function(){if(0===
this._textureReferences.length)return null;var b=this._textureReferences[0];0<b.age&&a()-b.age>this.tile.surface.textureBlendTime&&(b.texture.release(),this._textureReferences.shift(),(b=this._textureReferences[0])&&0<b.age&&(b.age=a()));switch(this._textureReferences.length){case 0:return null;case 1:return this._textureReferences[0].texture;default:return this._textureReferences[1].texture}},enumerable:!0,configurable:!0});b.prototype.setTextureReference=function(a,b,c,d){this._expireTextureReference();
h.isSome(a)&&this._textureReferences.push(new v(a,b,c,d))};Object.defineProperty(b.prototype,"texOffsetAndScale",{get:function(){switch(this._textureReferences.length){case 0:return y;case 1:return this._textureReferences[0].offsetAndScale;default:return this._textureReferences[1].offsetAndScale}},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"oldTextureReference",{get:function(){return 2>this._textureReferences.length?null:this._textureReferences[0].texture},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"oldTexOffsetAndScale",{get:function(){return 2>this._textureReferences.length?y:this._textureReferences[0].offsetAndScale},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureBlendFactor",{get:function(){if(2>this._textureReferences.length)return 1;var b=a()-this._textureReferences[0].age,c=this.tile.surface.textureBlendTime;return b>c?1:b/c},enumerable:!0,configurable:!0});b.prototype._getElevationInfo=function(){for(var a=this.geometryState.samplerData,
b=this.tile.layerInfo[0],c=b.length,d=Array(c),e=0,f=0,g=!1,k=0;k<c;k++){var h=b[k];if(h.upsampleInfo){var h=h.upsampleInfo.tile,m=h.layerInfo[0][k].data,m=m&&m.samplerData;a&&a[e]===m||(g=!0);d[e++]=m;f=Math.max(f,h.lij[0])}else h.data&&(m=this.tile.surface.layerViewByIndex(k,0),p.fallsWithinLayer(this.tile,m.layer,!1)&&(m=h.data,a&&a[e]===m.samplerData||(g=!0),d[e++]=m.samplerData,f=this.tile.lij[0]))}a&&a.length!==e&&(g=!0);0<e?d.length=e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};
Object.defineProperty(b.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureDescriptor",{get:function(){return h.isSome(this._texture)?this._texture.descriptor:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"test",{get:function(){return{hasTexture:null!=this._texture}},enumerable:!0,configurable:!0});return b}();
b.PatchRenderData=q;var v=function(){return function(a,b,c,d){this.texture=a;this.age=0;a.retain();this.offsetAndScale=k.vec4f64.fromValues(b,c,d,d)}}(),y=k.vec4f64.fromValues(0,0,1,1)})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/maybe ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../2d/engine/vectorTiles/tileRendererHelper3D ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./BlendLayersTechnique ./terrainUtils ./TileTexture ./support/FBOPool ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){function x(a,b,c){c.layerIndex=b;var d=a.layerInfo[1][b];return d.data?(h.vec2.set(c.offset,0,0),c.tile=a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=d,c):(a=d.upsampleInfo)?(b=a.tile.layerInfo[1][b],c.tile=a.tile,h.vec2.copy(c.offset,a.offset),c.scale=a.scale,c.sourceLod=a.tile.lij,c.sourceLayerInfo=b,c):null}var v=[],y={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function b(a,b,c,d){this._context=
a;this.tileSize=b;this._setNeedsRender=d;this._blackTex=this._backgroundTexture=null;this._context.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._context.parameters.maxMaxAnisotropy);this._vaoQuad=u.createQuadVAO(this._context,p.Pos3Tex);a=new n.BlendLayersTechniqueConfiguration;a.mode=2;this._blendLayersTechnique=c.acquireAndReleaseExisting(n.BlendLayersTechnique,a,this._blendLayersTechnique);a.mode=1;this._applyOpacityTechnique=c.acquireAndReleaseExisting(n.BlendLayersTechnique,
a,this._applyOpacityTechnique);this._blackTex=new g.TileTexture(u.createColorTexture(this._context,[0,0,0,1]));this._fboPool=new r.FBOPool(this._context)}b.prototype.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);f.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.release(),this._blackTex=null);this._blendLayersTechnique&&(this._blendLayersTechnique.dispose(),
this._blendLayersTechnique=null);this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null)};b.prototype.updateTileTexture=function(a){for(var b=a.layerInfo[1],d=0;d<b.length;d++)b[d].pendingUpdates&=-33;if(a.renderData){var e=a.surface,g=e.baseOpacity,d=0,k=this.tileSize,h=!1,m,p,n=b.length;for(m=0;m<b.length&&!h;m++){var r=e.layerViewByIndex(m,1),w=r.fullOpacity;p=r.view.pixelRatio;v[m]=w;this._isBaseLayer(r.layer)&&n>=b.length&&(n=m);if(0!==w){var t=x(a,
m,y);t&&(c.isVectorTileLayerView(r)?k=Math.max(k,this.tileSize*r.view.pixelRatio):1===g&&1===w&&(r.isOpaque||this._dataToTexture(t)&&f.isSome(t.sourceLayerInfo.data)&&t.sourceLayerInfo.data.descriptor.isOpaque)&&(h=!0),d++)}}this._cleanupFBOPool(p,b.length);e=k;k=l.nextHighestPowerOfTwo(e);b=k*k;p=e*e;b===p?k=e:(e=k/2,k=b-p<p-e*e?k:e);b=k/this.tileSize;--m;0===d&&this._backgroundTexture?this._useBackgroundTexture(a):1===d&&h?this._useLayerTexture(a,m):this._composeMapLayers(a,m,n,h,v,k,b);this._setNeedsRender()}};
b.prototype.setBackground=function(a){f.isSome(this._backgroundTexture)&&this._backgroundTexture.release();this._backgroundTexture=a instanceof HTMLImageElement?this._buildTexture(a):new g.TileTexture(u.createColorTexture(this._context,a))};b.prototype._buildTexture=function(a){if(f.isNone(a))return null;var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if("number"===typeof a)b.width=b.height=
a,d=new g.TileTexture(c,b);else if(a instanceof k.ImageWithType)b.isOpaque="image/jpeg"===a.type,d=new g.TileTexture(c,b,a.image),a.release();else try{d=new g.TileTexture(c,b,a)}catch(E){d=new g.TileTexture(u.createEmptyTexture(c)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}c.bindTexture(d.texture);d.generateMipmap();return d};b.prototype._drawRasterData=function(a,b,c,d,e){void 0===e&&(e=1);if(!f.isNone(b)){var g=this._context,k=a.program,
h=this._vaoQuad;g.setPipelineState(a.pipeline);g.bindProgram(k);g.bindVAO(h);k.assertCompatibleVertexAttributeLocations(h);g.bindTexture(b,0);k.setUniform1i("tex",0);k.setUniform1f("scale",c);k.setUniform2f("offset",d[0],d[1]);k.setUniform1f("opacity",e);g.drawArrays(5,0,t.vertexCount(h,"geometry"))}};b.prototype._drawVectorData=function(a,b,c,d,g,k,h){var m=b.sourceLayerInfo.data;if(f.isNone(m))return h;var l=this._context,p=b.tile.surface.layerViewByIndex(b.layerIndex,1),n;l.setPipelineState(a.pipeline);
var r=1>d;r?(n=this._fboPool.acquire(g),l.bindFramebuffer(n),l.setClearColor(1,1,1,0),l.clearSafe(16640)):h&&l.clearSafe(256);e.renderVectorTile(l,b.sourceLod,m,p.painter,p.layer.styleRepository,p.schemaHelper,Math.round(1/b.scale),b.offset,this.tileSize,c);return r?(l.bindFramebuffer(k),this._drawRasterData(a,n.colorTexture,1,[0,0],d),this._fboPool.release(n),h):!0};b.prototype._useBackgroundTexture=function(a){a.renderData.releaseTexture();a.renderData.opacity=a.surface.baseOpacity;a.renderData.setTextureReference(this._backgroundTexture,
0,0,1)};b.prototype._useLayerTexture=function(a,b){a.renderData.releaseTexture();b=x(a,b,y);if(this._dataToTexture(b)){var c=b.offset;a.renderData.setTextureReference(b.sourceLayerInfo.data,c[0],c[1],b.scale)}a.renderData.opacity=a.surface.baseOpacity};b.prototype._composeMapLayers=function(b,c,e,g,k,h,m){var l=this;b.renderData.releaseTexture();var p=b.renderData.ensureTexture(h,function(){return l._buildTexture(h)});if(!f.isNone(p)){var n=this._context,r=this._fboPool.acquire(h);n.bindFramebuffer(r);
n.setViewport(0,0,h,h);n.setClearColor(0,0,0,0);n.setClearDepth(1);n.clearSafe(16640);var w=!1;!g&&f.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,a.vec2f64.ZEROS);g=b.surface.baseOpacity;for(var t=!1;0<=c;c--){var v=x(b,c,y);v&&(c<e&&1>g&&!t&&(this._drawRasterData(this._applyOpacityTechnique,this._blackTex.texture,1,a.vec2f64.ZEROS,g),t=!0),0!==k[c]&&(v&&v.sourceLayerInfo&&v.sourceLayerInfo.data instanceof d.VectorTile?w=this._drawVectorData(this._blendLayersTechnique,
v,m,k[c],h,r,w):this._dataToTexture(v)&&f.isSome(v.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,v.sourceLayerInfo.data.texture,v.scale,v.offset,k[c])))}n.bindTexture(p.texture);e=p.descriptor;n.gl.copyTexImage2D(n.gl.TEXTURE_2D,0,e.pixelFormat,0,0,e.width,e.height,0);p.generateMipmap();n.bindFramebuffer(null);this._fboPool.release(r);b.renderData.opacity=t?1:g;b.renderData.setTextureReference(p,0,0,1)}};b.prototype._dataToTexture=function(a){var b=a&&a.sourceLayerInfo&&a.sourceLayerInfo.data;
(b instanceof HTMLImageElement||b instanceof k.ImageWithType||b instanceof HTMLCanvasElement)&&this._rasterDataToTexture(a);return a&&a.sourceLayerInfo&&a.sourceLayerInfo.data instanceof g.TileTexture};b.prototype._rasterDataToTexture=function(a){var b=a.sourceLayerInfo;b.data=this._buildTexture(b.data);a.tile.setMemoryDirty()};b.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};b.prototype._cleanupFBOPool=function(a,b){if(a!==
this._lastPixelRatio||b!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=a,this._lastNumLayers=b};return b}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","../../../../geometry","../../../../Viewpoint","../../ViewState"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a={context:null,drawPhase:1,state:null,stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",
styleLayer:null,styleLayerId:-1,painter:null,glyphMosaic:null,spriteMosaic:null,fadeRecorder:null,driverTestResult:null,profiler:null,renderingOptions:null,timeDelta:-1,timeline:null,hasClipping:!1};b.renderVectorTile=function(b,f,h,c,g,l,p,u,t,x){var d=l.adjustLevel(f[0]);a.context=b;a.state=e;a.painter=c;a.glyphMosaic=c.glyphMosaic;a.spriteMosaic=c.spriteMosaic;a.fadeRecorder=c.fadeRecorder;a.pixelRatio=x;a.displayLevel=d;a.requiredLevel=d;c.setContext(b);x=l.getScale(f[0]);l=l.getShift(f,p*x);
f=l[0];l=l[1];x=.125*p*x/t;d=h.transforms.dvs;d[0]=x;d[4]=-x;d[6]=-1-f-u[0]*p*2;d[7]=1+l+(1-u[1])*p*2-2;a.state.size[0]=t;a.state.size[1]=t;h.attached||h.attachWithContext(b);h.triangleCount=0;c.drawTile(a,h,g)};var e=new h({viewpoint:new f({targetGeometry:new l.Point(0,0),scale:1,rotation:0}),size:[256,256]})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){var m=[0,0];return function(b){function e(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];a=b.apply(this,a)||this;a._viewpoint2D={center:x.vec2f64.create(),rotation:0,scale:0,spatialReference:null};a.center=[0,0];a.extent=new h.Extent;a.id=0;a.inverseTransform=g.mat2df64.create();a.resolution=0;a.rotation=0;a.scale=0;a.transform=g.mat2df64.create();a.transformNoRotation=g.mat2df64.create();a.displayMat3=p.mat3f32.create();a.displayViewMat3=
p.mat3f32.create();a.viewMat3=p.mat3f32.create();a.viewMat2d=c.mat2df32.create();a.worldScreenWidth=0;a.size=[0,0];return a}l(e,b);w=e;Object.defineProperty(e.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});e.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=y.copy(c,a.viewpoint),this._set("size",u.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};e.prototype.clone=function(){return new w({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};e.prototype.toMap=function(a,b,c){if(v.isVec2(b))return u.vec2.transformMat2d(a,b,this.inverseTransform);m[0]=b;m[1]=c;return u.vec2.transformMat2d(a,m,this.inverseTransform)};e.prototype.toScreen=function(a,b,c){if(v.isVec2(b))return u.vec2.transformMat2d(a,b,this.transform);m[0]=b;m[1]=c;return u.vec2.transformMat2d(a,m,this.transform)};e.prototype.toScreenNoRotation=function(a,b,c){if(v.isVec2(b))return u.vec2.transformMat2d(a,b,this.transformNoRotation);m[0]=b;m[1]=
c;return u.vec2.transformMat2d(a,m,this.transformNoRotation)};e.prototype.pixelSizeAt=function(a){return y.pixelSizeAt(a,this.viewpoint)};e.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");y.getMatrix(a,c,e,b,0,d);return a};e.prototype._update=function(){var b=this._viewpoint2D,c=b.center,d=b.spatialReference,e=b.scale,f=b.rotation,b=this._get("pixelRatio")||1,g=this._get("size");this._set("id",this.id+1);var m=new a({targetGeometry:new h.Point(c[0],
c[1],d),scale:e,rotation:f});this._set("viewpoint",m);if(g&&d&&e)return this.resolution=y.getResolution(m),this.rotation=f,this.scale=e,this.spatialReference=d,u.vec2.copy(this.center,c),r.mat3.set(this.displayMat3,0!==g[0]?2/g[0]:0,0,0,0,0!==g[1]?-2/g[1]:0,0,-1,1,1),e=r.mat3.identity(this.viewMat3),c=t.vec2f32.fromValues(g[0]/2,g[1]/2),d=t.vec2f32.fromValues(-g[0]/2,-g[1]/2),f=k.common.toRadian(f),r.mat3.translate(e,e,c),r.mat3.rotate(e,e,f),r.mat3.translate(e,e,d),r.mat3.multiply(this.displayViewMat3,
this.displayMat3,e),e=n.mat2d.identity(this.viewMat2d),n.mat2d.translate(e,e,c),n.mat2d.rotate(e,e,f),n.mat2d.translate(e,e,d),y.getExtent(this.extent,m,g),y.getTransform(this.transform,m,g,b),n.mat2d.invert(this.inverseTransform,this.transform),y.getTransformNoRotation(this.transformNoRotation,m,g,b),this.worldScreenWidth=y.getWorldScreenWidth(this.spatialReference,this.resolution),this};var w;f([d.property({readOnly:!0})],e.prototype,"id",void 0);f([d.property({value:1,json:{write:!0}})],e.prototype,
"pixelRatio",null);f([d.property({json:{write:!0}})],e.prototype,"size",null);f([d.property({type:a,json:{write:!0}})],e.prototype,"viewpoint",null);return e=w=f([d.subclass("esri.views.2d.ViewState")],e)}(d.declared(e.JSONSupport))})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.common=l})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(q,
b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2d=l})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(q,b,l){function f(a,b,d){var e=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var l=d[0],u=d[1],t=d[2],x=d[3],v=d[4];d=d[5];a[0]=e*l+c*u;a[1]=f*l+g*u;a[2]=e*t+c*x;a[3]=f*t+g*x;a[4]=e*v+c*d+h;a[5]=f*v+g*d+b;return a}function h(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];a[2]=b[2]-d[2];a[3]=b[3]-d[3];a[4]=b[4]-d[4];a[5]=b[5]-d[5];return a}Object.defineProperty(b,
"__esModule",{value:!0});b.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};b.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};b.set=function(a,b,d,f,h,c,g){a[0]=b;a[1]=d;a[2]=f;a[3]=h;a[4]=c;a[5]=g;return a};b.invert=function(a,b){var d=b[0],e=b[1],f=b[2],c=b[3],g=b[4];b=b[5];var h=d*c-e*f;if(!h)return null;h=1/h;a[0]=c*h;a[1]=-e*h;a[2]=-f*h;a[3]=d*h;a[4]=(f*b-c*g)*h;a[5]=(e*g-d*b)*h;return a};b.determinant=function(a){return a[0]*a[3]-
a[1]*a[2]};b.multiply=f;b.rotate=function(a,b,d){var e=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var l=Math.sin(d);d=Math.cos(d);a[0]=e*d+c*l;a[1]=f*d+g*l;a[2]=e*-l+c*d;a[3]=f*-l+g*d;a[4]=h;a[5]=b;return a};b.scale=function(a,b,d){var e=b[1],f=b[2],c=b[3],g=b[4],h=b[5],l=d[0];d=d[1];a[0]=b[0]*l;a[1]=e*l;a[2]=f*d;a[3]=c*d;a[4]=g;a[5]=h;return a};b.translate=function(a,b,d){var e=b[0],f=b[1],c=b[2],g=b[3],h=b[4];b=b[5];var l=d[0];d=d[1];a[0]=e;a[1]=f;a[2]=c;a[3]=g;a[4]=e*l+c*d+h;a[5]=f*l+g*d+b;return a};
b.fromRotation=function(a,b){var d=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=d;a[2]=-d;a[3]=b;a[4]=0;a[5]=0;return a};b.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};b.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};b.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};b.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],
2)+Math.pow(a[5],2)+1)};b.add=function(a,b,d){a[0]=b[0]+d[0];a[1]=b[1]+d[1];a[2]=b[2]+d[2];a[3]=b[3]+d[3];a[4]=b[4]+d[4];a[5]=b[5]+d[5];return a};b.subtract=h;b.multiplyScalar=function(a,b,d){a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*d;a[5]=b[5]*d;return a};b.multiplyScalarAndAdd=function(a,b,d,f){a[0]=b[0]+d[0]*f;a[1]=b[1]+d[1]*f;a[2]=b[2]+d[2]*f;a[3]=b[3]+d[3]*f;a[4]=b[4]+d[4]*f;a[5]=b[5]+d[5]*f;return a};b.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&
a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};b.equals=function(a,b){var d=a[0],e=a[1],f=a[2],c=a[3],g=a[4];a=a[5];var h=b[0],p=b[1],u=b[2],t=b[3],x=b[4];b=b[5];return Math.abs(d-h)<=l.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-p)<=l.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(f-u)<=l.EPSILON*Math.max(1,Math.abs(f),Math.abs(u))&&Math.abs(c-t)<=l.EPSILON*Math.max(1,Math.abs(c),Math.abs(t))&&Math.abs(g-x)<=l.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(a-b)<=l.EPSILON*Math.max(1,
Math.abs(a),Math.abs(b))};b.mul=f;b.sub=h})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df32=l})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(6);b[0]=1;b[3]=1;return b};b.clone=function(b){var f=new Float32Array(6);f[0]=b[0];
f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];return f};b.fromValues=function(b,f,h,a,e,d){var k=new Float32Array(6);k[0]=b;k[1]=f;k[2]=h;k[3]=a;k[4]=e;k[5]=d;return k};b.createView=function(b,f){return new Float32Array(b,f,6)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df64=l})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[1,0,0,1,0,0]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5]]};b.fromValues=function(b,f,h,a,e,d){return[b,f,h,a,e,d]};b.createView=function(b,f){return new Float64Array(b,f,6)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require","exports"],function(q,b){function l(b){return b instanceof Float32Array&&2<=b.length}function f(b){return Array.isArray(b)&&2<=b.length}Object.defineProperty(b,
"__esModule",{value:!0});b.isVec2f32=l;b.isVec2f64=f;b.isVec2=function(b){return l(b)||f(b)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){function B(a,b,d,e){return e&&d&&!e.equals(d)&&w.canProject(e,d)&&e.isWebMercator?(e.isWebMercator?(d=b[1],89.99999<d?d=89.99999:-89.99999>d&&(d=-89.99999),d=Math.sin(c.common.toRadian(d)),a=p.vec2.set(a,c.common.toRadian(b[0])*Y,.5*Y*Math.log((1+d)/(1-d)))):(d=c.common.toDegree(b[0]/Y),a=p.vec2.set(a,d-360*Math.floor((d+180)/360),c.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/Y))))),a):p.vec2.copy(a,b)}function C(a){return a.wkid?a:
a.spatialReference||y.WGS84}function E(a,b){return b.type?p.vec2.set(a,b.x,b.y):p.vec2.copy(a,b)}function G(a,b){return Math.max(a.width/b[0],a.height/b[1])*Q(a.spatialReference)}function J(b,c,g,k){return f(this,void 0,void 0,function(){var f,h,m,p,n,r,u,y,q,A,B,C,E,H,G,O,N,T,L,I,P,K,Q,R,Y,z,Z,S;return l(this,function(l){switch(l.label){case 0:if(!b||Array.isArray(b)&&!b.length)return[2,null];a.isCollection(b)&&(b=b.toArray());if(!Array.isArray(b)||!b.length||"object"!==typeof b[0])return[3,7];h=
b.every(function(a){return"attributes"in a});m=b.some(function(a){return!a.geometry});p=b;if(!(h&&m&&c&&c.allLayerViews))return[3,2];n=new Map;r=0;for(u=b;r<u.length;r++)y=u[r],q=y.layer,A=n.get(q)||[],B=y.attributes[q.objectIdField],null!=B&&A.push(B),n.set(q,A);C=[];n.forEach(function(a,b){var d=c.allLayerViews.find(function(a){return a.layer.id===b.id});if("queryFeatures"in d){var e=b.createQuery();e.objectIds=a;e.returnGeometry=!0;C.push(d.queryFeatures(e))}});return[4,d.all(C)];case 1:E=l.sent();
H=[];G=0;for(O=E;G<O.length;G++)if((N=O[G])&&N.features&&N.features.length)for(T=0,L=N.features;T<L.length;T++)y=L[T],e.isSome(y.geometry)&&H.push(y.geometry);p=H;l.label=2;case 2:I=0,P=p,l.label=3;case 3:if(!(I<P.length))return[3,6];K=P[I];return[4,J(K,c,g,k)];case 4:k=l.sent(),l.label=5;case 5:return I++,[3,3];case 6:return[2,k];case 7:if(!Array.isArray(b)||2!==b.length||"number"!==typeof b[0]||"number"!==typeof b[1])return[3,8];f=new v(b);return[3,12];case 8:if(!(b instanceof x))return[3,9];f=
b;return[3,12];case 9:if(!("geometry"in b))return[3,12];if(!b.geometry)return[3,10];f=b.geometry;return[3,12];case 10:if(!b.layer)return[3,12];Q=b.layer;R=c.allLayerViews.find(function(a){return a.layer.id===Q.id});if(!("queryFeatures"in R))return[3,12];Y=Q.createQuery();Y.objectIds=[b.attributes[Q.objectIdField]];Y.returnGeometry=!0;return[4,R.queryFeatures(Y)];case 11:z=l.sent(),f=e.get(z,"features",0,"geometry"),l.label=12;case 12:if(e.isNone(f))return[2,null];Z="point"===f.type?new t({xmin:f.x,
ymin:f.y,xmax:f.x,ymax:f.y,spatialReference:f.spatialReference}):f.extent;if(!Z)return[2,null];S=w.canProject(Z,g);if(!Z.spatialReference.equals(g)&&S)Z=w.project(Z,g);else if(!S)return[2,null];k=k?k.union(Z):Z.clone();return[2,k]}})})}function I(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&
a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function K(a,b){return f(this,void 0,void 0,function(){var c,d,e,f,g,k,m,p,n,r,y,x,q,H,O,N;return l(this,function(l){switch(l.label){case 0:if(!a||!b)return[2,new h({targetGeometry:new v,scale:0,rotation:0})];c=b.spatialReference;d=b.size;e=b.viewpoint;f=b.constraints;g=null;a instanceof h?g=a:
a.viewpoint?g=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(g=a.target);k=null;if(!g||!g.targetGeometry)return[3,1];k=g.targetGeometry;return[3,10];case 1:if(!(a instanceof t))return[3,2];k=a;return[3,10];case 2:return a||a&&("center"in a||"extent"in a||"target"in a)?[4,J(a.center,b,c)]:[3,10];case 3:return(n=l.sent())?[3,5]:[4,J(a.extent,b,c)];case 4:n=l.sent(),l.label=5;case 5:return(p=n)?[3,7]:[4,J(a.target,b,c)];case 6:p=l.sent(),l.label=7;case 7:return(m=p)?[3,9]:[4,J(a,b,
c)];case 8:m=l.sent(),l.label=9;case 9:k=m,l.label=10;case 10:!k&&e&&e.targetGeometry?k=e.targetGeometry:!k&&b.extent&&(k=b.extent);r=C(k);c||(c=C(b.spatialReference||b.extent||k));if(!A.canProject(k,c)&&r&&!r.equals(c))return[2,null];y=E(u.vec2f64.create(),k.center?k.center:k);x=new v(B(y,y,r,c),c);q=null;q=g&&g.targetGeometry&&"point"===g.targetGeometry.type?g.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&f&&f.effectiveLODs?f.zoomToScale(a.zoom):Array.isArray(k)||
"point"===k.type||"extent"===k.type&&0===k.width&&0===k.height?b.extent&&w.canProject(b.extent,c)?G(w.project(b.extent,c),d):b.extent?G(b.extent,d):e.scale:w.canProject(k.extent,c)?G(w.project(k.extent,c),d):G(k.extent,d);if(H=I(a))H.min&&H.min>q?q=H.min:H.max&&H.max<q&&(q=H.max);O=0;g?O=g.rotation:a.hasOwnProperty("rotation")?O=a.rotation:e&&(O=e.rotation);N=new h({targetGeometry:x,scale:q,rotation:O});f&&(N=f.fit(N),f.rotationEnabled||(N.rotation=O));return[2,N]}})})}function H(a,b){var c=a.targetGeometry,
d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function L(a,b,c){return c?p.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):p.vec2.scale(a,b,.5)}function P(a,c,d,e){b.getTransform(a,c,d,e);return g.mat2d.invert(a,a)}function S(a,b,c){var d=O(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return p.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function R(a){var b=a.scale;a=a.targetGeometry.spatialReference;
a=m.isValid(a)?1/(39.37*k.getMetersPerUnitForSR(a)*96):1;return b*a}function O(a){return c.common.toRadian(a.rotation)||0}function Q(a){return m.isValid(a)?39.37*k.getMetersPerUnitForSR(a)*96:1}function T(a){return a.isWrappable?(a=m.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(b,"__esModule",{value:!0});var Y=n.wgs84Radius,N=180/Math.PI;b.extentToScale=G;b.create=K;b.copy=H;b.getAnchor=L;b.getExtent=function(){var a=u.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;E(a,
e);c=.5*R(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();b.setExtent=function(a,c,d,e,f){b.centerAt(a,c,d.center);a.scale=G(d,e);f&&f.constraints&&f.constraints.constrain(a);return a};b.getOuterExtent=function(){var a=u.vec2f64.create(),b=u.vec2f64.create();return function(c,d,e){E(a,d.targetGeometry);S(b,d,e);e=.5*R(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});
return c}}();b.getOuterSize=S;b.getPaddingScreenTranslation=function(){var a=u.vec2f64.create();return function(b,c,d){return p.vec2.sub(b,p.vec2.scale(b,c,.5),L(a,c,d))}}();b.getPaddingMapTranslation=function(){var a=r.mat2df64.create(),c=u.vec2f64.create();return function(d,e,f,k){var h=R(e);e=O(e);p.vec2.set(c,h,h);g.mat2d.fromScaling(a,c);g.mat2d.rotate(a,a,e);g.mat2d.translate(a,a,b.getPaddingScreenTranslation(c,f,k));g.mat2d.translate(a,a,[0,k.top-k.bottom]);return p.vec2.set(d,a[4],a[5])}}();
b.getResolution=R;b.getResolutionToScaleFactor=Q;b.getMatrix=function(){var a=u.vec2f64.create(),b=u.vec2f64.create(),c=u.vec2f64.create();return function(d,e,f,k,h,m){p.vec2.negate(a,e);p.vec2.scale(b,f,.5*m);p.vec2.set(c,1/k*m,-1/k*m);g.mat2d.identity(d);g.mat2d.translate(d,d,b);h&&g.mat2d.rotate(d,d,h);g.mat2d.scale(d,d,c);g.mat2d.translate(d,d,a);return d}}();b.getTransform=function(){var a=u.vec2f64.create();return function(c,d,e,f){var g=R(d),k=O(d);E(a,d.targetGeometry);return b.getMatrix(c,
a,e,g,k,f)}}();b.getTransformNoRotation=function(){var a=u.vec2f64.create();return function(c,d,e,f){var g=R(d);E(a,d.targetGeometry);return b.getMatrix(c,a,e,g,0,f)}}();b.getWorldWidth=T;b.getWorldScreenWidth=function(a,b){return Math.round(T(a)/b)};b.createAsync=function(a,b){return K(a,b)};b.angleBetween=function(){var a=u.vec2f64.create(),b=u.vec2f64.create(),c=[0,0,0];return function(d,e,f){p.vec2.subtract(a,d,e);p.vec2.normalize(a,a);p.vec2.subtract(b,d,f);p.vec2.normalize(b,b);p.vec2.cross(c,
a,b);d=Math.acos(p.vec2.dot(a,b)/(p.vec2.length(a)*p.vec2.length(b)))*N;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();b.addPadding=function(){var a=u.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;H(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x+=a[0];g.y+=a[1];return c}}();b.removePadding=function(){var a=u.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;H(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x-=a[0];g.y-=a[1];return c}}();b.centerAt=function(){var a=u.vec2f64.create();
return function(b,c,d){H(b,c);c=b.targetGeometry;var e=C(d),f=C(c);E(a,d);B(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();b.pixelSizeAt=function(a,b){return R(b)};b.resize=function(){var a=u.vec2f64.create();return function(c,d,e,f,g){g||(g="center");p.vec2.sub(a,e,f);p.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(g){case "center":p.vec2.set(a,0,0);break;case "left":p.vec2.set(a,-e,0);break;case "top":p.vec2.set(a,0,f);break;case "right":p.vec2.set(a,e,0);break;case "bottom":p.vec2.set(a,0,-f);break;case "top-left":p.vec2.set(a,
-e,f);break;case "bottom-left":p.vec2.set(a,-e,-f);break;case "top-right":p.vec2.set(a,e,f);break;case "bottom-right":p.vec2.set(a,e,-f)}b.translateBy(c,d,a);return c}}();b.rotateBy=function(a,b,c){H(a,b);a.rotation+=c;return a};b.rotateTo=function(a,b,c){H(a,b);a.rotation=c;return a};b.scaleBy=function(){var a=u.vec2f64.create();return function(c,d,e,f,g){H(c,d);isNaN(e)||0===e||(b.toMap(a,f,d,g),c.scale=d.scale*e,b.toScreen(a,a,c,g),b.translateBy(c,c,p.vec2.set(a,a[0]-f[0],f[1]-a[1])));return c}}();
b.scaleTo=function(a,b,c){H(a,b);a.scale=c;return a};b.scaleAndRotateBy=function(){var a=u.vec2f64.create();return function(c,d,e,f,g,k){H(c,d);isNaN(e)||0===e||(b.toMap(a,g,d,k),c.scale=d.scale*e,c.rotation+=f,b.toScreen(a,a,c,k),b.translateBy(c,c,p.vec2.set(a,a[0]-g[0],g[1]-a[1])));return c}}();b.padAndScaleAndRotateBy=function(){var a=u.vec2f64.create(),c=u.vec2f64.create();return function(d,e,f,g,k,h,m){b.getPaddingScreenTranslation(c,h,m);p.vec2.add(a,k,c);return g?b.scaleAndRotateBy(d,e,f,g,
a,h):b.scaleBy(d,e,f,a,h)}}();b.toMap=function(){var a=r.mat2df64.create();return function(b,c,d,e){return p.vec2.transformMat2d(b,c,P(a,d,e,1))}}();b.toScreen=function(){var a=r.mat2df64.create();return function(c,d,e,f){return p.vec2.transformMat2d(c,d,b.getTransform(a,e,f,1))}}();b.translateBy=function(){var a=u.vec2f64.create(),b=r.mat2df64.create();return function(c,d,e){H(c,d);var f=R(d),k=c.targetGeometry;g.mat2d.fromRotation(b,O(d));g.mat2d.scale(b,b,u.vec2f64.fromValues(f,f));p.vec2.transformMat2d(a,
e,b);k.x+=a[0];k.y+=a[1];return c}}()})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get().build();return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),n.Default3D)};d.prototype.initializePipeline=function(){switch(this.configuration.mode){case 2:return g.makePipelineState({blending:g.simpleBlendingParams(1,771),colorWrite:g.defaultColorWriteParams});
case 1:return g.makePipelineState({blending:g.simpleBlendingParams(0,770),colorWrite:g.defaultColorWriteParams});default:return g.makePipelineState({colorWrite:g.defaultColorWriteParams})}};d.shader=new e.ReloadableShaderModule(a,"../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl",q);return d}(d.ShaderTechnique);b.BlendLayersTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.mode=0;return b}l(b,a);f([k.parameter({count:3})],b.prototype,"mode",void 0);return b}(k.ShaderTechniqueConfiguration);
b.BlendLayersTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendLayers.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/PositionAttribute.glsl ../../shaderModules/interfaces ../../shaderModules/ShaderBuilder".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(){var b=new a.ShaderBuilder;b.include(f.PositionAttribute);b.attributes.add("uv0","vec2");b.vertex.uniforms.add("scale",
"float");b.vertex.uniforms.add("offset","vec2");b.varyings.add("uv","vec2");b.vertex.code.add(h.glsl(e||(e=l(["\n    void main(void) {\n      gl_Position \x3d vec4(positionModel(), 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "],["\n    void main(void) {\n      gl_Position \x3d vec4(positionModel(), 1.0);\n      uv \x3d uv0 * scale + offset;\n    }\n  "]))));b.fragment.uniforms.add("tex","sampler2D");b.fragment.uniforms.add("opacity","float");b.fragment.code.add(h.glsl(d||(d=l(["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "],
["\n    void main() {\n      vec4 color \x3d texture2D(tex, uv);\n\n      // Note: output in pre-multiplied alpha for correct alpha compositing\n      gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\n    }\n  "]))));return b};var e,d})},"esri/views/3d/terrain/support/FBOPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.renderingContext=
a;this._pools=new Map}b.prototype.acquire=function(a){return this.getPool(a).acquire()};b.prototype.release=function(a){this.getPool(a.width).release(a)};b.prototype.clear=function(){this._pools.forEach(function(a){a.destroy()});this._pools.clear()};b.prototype.getPool=function(a){var b=this._pools.get(a);b||(b=f.bind(f,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:a,height:a}),b=new l(b),this._pools.set(a,b));return b};return b}();b.FBOPool=q})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require",
"exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=null,a=[];b.enabled=!1;b.setEnabled=function(a){b.enabled=a};b.begin=function(){b.enabled&&(h=[])};b.trace=function(a){b.enabled&&null!=h&&h.push(a)};b.end=function(){if(b.enabled){var e=h;h=null;e&&(a.forEach(function(a){return a(e)}),a.length=0);return e}return null};b.instrumentContext=function(a){return b.enabled?f.default(a)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),
a):l.makeDebugContext(a,void 0,function(a,e){b.enabled&&h&&h.push("gl."+a+"("+l.glFunctionArgsToString(a,e)+")")}):a};b.request=function(b){a.push(b)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function q(a){if(null==k){k={};n={};for(var b in a)"number"==typeof a[b]&&(k[a[b]]=b,n[b]=a[b])}}function b(){if(null==k)throw"WebGLDebugUtils.init(ctx) not called";}function l(a){b();var c=k[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function f(a,
b,e,f){a=d[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[e])){if("object"===typeof a[e]&&void 0!==a[e].enumBitwiseOr){b=a[e].enumBitwiseOr;e=0;a=[];for(var c=0;c<b.length;++c){var g=n[b[c]];0!==(f&g)&&(e|=g,a.push(l(g)))}return e===f?a.join(" | "):l(f)}return l(f)}return null===f?"null":void 0===f?"undefined":f.toString()}function h(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function a(b,d,e,k){function c(a,b){return function(){e&&e(b,arguments);var c=
a[b].apply(a,arguments),f=k.getError();0!=f&&(g[f]=!0,d(f,b,arguments));return c}}k=k||b;q(b);d=d||function(a,b,c){for(var d="",e=c.length,g=0;g<e;++g)d+=(0==g?"":", ")+f(b,e,g,c[g]);a="WebGL error "+l(a)+" in "+b+"("+d+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var g={},p={},n;for(n in b)if("function"==typeof b[n])if("getExtension"!=n)p[n]=c(b,n);else{var r=c(b,n);p[n]=function(){var c=r.apply(b,arguments);return a(c,
d,e,k)}}else h(p,b,n);p.getError=function(){for(var a in g)if(g.hasOwnProperty(a)&&g[a])return g[a]=!1,a;return b.NO_ERROR};return p}function e(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),
a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);
a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);
a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},
vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},
bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},
depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},k=null,n=null;return{init:q,mightBeEnum:function(a){b();
return void 0!==k[a]},glEnumToString:l,glFunctionArgToString:f,glFunctionArgsToString:function(a,b){for(var c="",d=b.length,e=0;e<d;++e)c+=(0==e?"":", ")+f(a,d,e,b[e]);return c},makeDebugContext:a,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=Object.keys(K),b=0;b<a.length;++b)delete K[a]}function d(){++G;B||E==G&&a.loseContext()}function f(a,b){var c=a[b];return function(){d();if(!B)return c.apply(a,arguments)}}
function k(a){return{statusMessage:a,preventDefault:function(){J=!0}}}function l(a){for(var b in a)"function"==typeof a[b]?y[b]=f(a,b):h(y,a,b);y.getError=function(){d();if(!B)for(var a;a=n.getError();)K[a]=!0;for(a in K)if(K[a])return delete K[a],a;return y.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<c.length;++b){var e=c[b];y[e]=function(b){return function(){d();if(B)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=
q;C.push(c);return c}}(a[e])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(b=0;b<c.length;++b)e=c[b],y[e]=function(b){return function(){d();return B?null:b.apply(a,arguments)}}(y[e]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");
for(b=0;b<c.length;++b)e=c[b],y[e]=function(b){return function(){d();return B?!1:b.apply(a,arguments)}}(y[e]);y.checkFramebufferStatus=function(b){return function(){d();return B?y.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(y.checkFramebufferStatus);y.getAttribLocation=function(b){return function(){d();return B?-1:b.apply(a,arguments)}}(y.getAttribLocation);y.getVertexAttribOffset=function(b){return function(){d();return B?0:b.apply(a,arguments)}}(y.getVertexAttribOffset);y.isContextLost=function(){return B};
return y}var n,y,m=[],w=[];y={};var q=1,B=!1,C=[],E=0,G=0,J=!1,I=0,K={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=n){if(n)throw"got different context";n=c;y=l(n)}return y}return c}}(a.getContext);(function(a){var c=a.addEventListener;a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":m.push(b(e));break;case "webglcontextrestored":w.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!B){B=
!0;E=0;for(++q;n.getError(););c();K[n.CONTEXT_LOST_WEBGL]=!0;var b=k("context lost"),d=m.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=I&&setTimeout(function(){a.restoreContext()},I)},0)}};a.restoreContext=function(){B&&w.length&&setTimeout(function(){if(!J)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var a=0;a<C.length;++a){var b=C[a];b instanceof WebGLBuffer?n.deleteBuffer(b):b instanceof WebGLFramebuffer?n.deleteFramebuffer(b):b instanceof
WebGLProgram?n.deleteProgram(b):b instanceof WebGLRenderbuffer?n.deleteRenderbuffer(b):b instanceof WebGLShader?n.deleteShader(b):b instanceof WebGLTexture&&n.deleteTexture(b)}e(n);B=!1;G=0;J=!1;for(var a=w.slice(),b=k("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(B)throw"You can not ask a lost contet to be lost";E=G+a};a.getNumCalls=function(){return G};a.setRestoreTimeout=function(a){I=a};return a},resetToInitialState:e}})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./Terrain.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get(),e=this.configuration,b=b.build({overlayEnabled:e.overlayEnabled,output:e.output,viewingMode:a.viewingMode,slicePlaneEnabled:e.slice,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,blendingEnabled:e.blendingEnabled,receiveShadows:e.receiveShadows,receiveAmbientOcclusion:!1,
useOldSceneLightInterface:!0,atmosphere:e.atmosphere,tileBorders:e.tileBorders,screenSizePerspective:e.screenSizePerspective,usePBR:!1});return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),k.Default3D)};d.prototype.initializePipeline=function(){var a=this.configuration,b={function:{func:517,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7680}};return g.makePipelineState({culling:a.backfaceCullingEnabled&&g.backFaceCullingParams,depthTest:{func:513},depthWrite:g.defaultDepthWriteParams,
colorWrite:g.defaultColorWriteParams,stencilTest:a.stencilEnabled?b:null})};d.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};d.shader=new a.ReloadableShaderModule(n,"./Terrain.glsl",q);return d}(e.ShaderTechnique);b.TerrainTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.overlayEnabled=!1;b.atmosphere=!1;b.receiveShadows=!1;b.slice=!1;b.backfaceCullingEnabled=!1;b.stencilEnabled=!1;b.blendingEnabled=!1;b.tileBorders=!1;b.screenSizePerspective=
!1;return b}l(b,a);f([d.parameter({count:7})],b.prototype,"output",void 0);f([d.parameter()],b.prototype,"overlayEnabled",void 0);f([d.parameter()],b.prototype,"atmosphere",void 0);f([d.parameter()],b.prototype,"receiveShadows",void 0);f([d.parameter()],b.prototype,"slice",void 0);f([d.parameter()],b.prototype,"backfaceCullingEnabled",void 0);f([d.parameter()],b.prototype,"stencilEnabled",void 0);f([d.parameter()],b.prototype,"blendingEnabled",void 0);f([d.parameter()],b.prototype,"tileBorders",void 0);
f([d.parameter()],b.prototype,"screenSizePerspective",void 0);return b}(d.ShaderTechniqueConfiguration);b.TerrainTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/Terrain.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/Transform.glsl ../core/shaderLibrary/output/OutputDepth.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../core/shaderLibrary/shading/NormalUtils.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ./Overlay.glsl ./Skirts.glsl".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new g.ShaderBuilder;q.include(p.Skirts);q.attributes.add("position","vec3");q.attributes.add("uv0","vec2");q.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");0===b.output&&(q.include(h.Transform,{linearDepth:!1}),q.include(k.NormalUtils,b),b.overlayEnabled&&q.include(r.Overlay,{usePBR:!1,usePBRforWater:!0,useCustomDTRExponentForWater:!1}),
q.varyings.add("vnormal","vec3"),q.varyings.add("vpos","vec3"),q.varyings.add("vtc","vec2"),q.vertex.uniforms.add("viewNormal","mat4"),q.vertex.uniforms.add("texOffsetAndScale","vec4"),q.vertex.uniforms.add("oldTexOffsetAndScale","vec4"),b.receiveShadows&&q.varyings.add("linearDepth","float"),b.tileBorders&&q.varyings.add("vuv","vec2"),b.atmosphere&&(q.vertex.uniforms.add("lightingMainDirection","vec3"),q.varyings.add("wnormal","vec3"),q.varyings.add("wlight","vec3")),b.overlayEnabled&&(q.varyings.add("tbnTangent",
"vec3"),q.varyings.add("tbnBiTangent","vec3")),b.blendingEnabled&&q.varyings.add("ovtc","vec2"),b.screenSizePerspective&&(q.vertex.uniforms.add("screenSizePerspective","vec4"),q.varyings.add("screenSizeDistanceToCamera","float"),q.varyings.add("screenSizeCosAngle","float")),q.vertex.code.add(c.glsl(u||(u=l(["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n      "],
["\n      void main(void) {\n        vpos \x3d position;\n        vnormal \x3d getLocalUp(vpos, origin);\n\n        vec2 uv \x3d uv0;\n        vpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\n      "])))),b.atmosphere&&q.vertex.code.add(c.glsl(t||(t=l(["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;\n      "],["\n        wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\n        wlight \x3d (view  * vec4(-lightingMainDirection, 1.0)).xyz;\n      "])))),
b.tileBorders&&q.vertex.code.add(c.glsl(x||(x=l(["\n        vuv \x3d uv;\n      "],["\n        vuv \x3d uv;\n      "])))),b.screenSizePerspective&&q.vertex.code.add(c.glsl(v||(v=l(["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n      "],["\n        vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\n        screenSizeDistanceToCamera \x3d length(viewPos);\n        vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\n        screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\n      "])))),
q.vertex.code.add(c.glsl(y||(y=l(["\n        gl_Position \x3d transformPosition(proj, view, vpos);\n      "],["\n        gl_Position \x3d transformPosition(proj, view, vpos);\n      "])))),b.receiveShadows&&q.vertex.code.add(c.glsl(m||(m=l(["\n        linearDepth \x3d gl_Position.w;\n      "],["\n        linearDepth \x3d gl_Position.w;\n      "])))),q.vertex.code.add(c.glsl(w||(w=l(["\n        vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n      "],["\n        vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\n      "])))),
b.overlayEnabled&&(q.vertex.code.add(c.glsl(A||(A=l(["\n        setOverlayVTC(uv);\n      "],["\n        setOverlayVTC(uv);\n      "])))),0===b.viewingMode?q.vertex.code.add(c.glsl(B||(B=l(["\n          tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n          tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n          "],["\n          tbnTangent \x3d normalize(cross(vec3(0.0, 0.0, 1.0), vnormal));\n          tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n          "])))):
q.vertex.code.add(c.glsl(C||(C=l(["\n          tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n          tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n        "],["\n          tbnTangent \x3d vec3(1.0, 0.0, 0.0);\n          tbnBiTangent \x3d normalize(cross(vnormal, tbnTangent));\n        "]))))),b.blendingEnabled&&q.vertex.code.add(c.glsl(E||(E=l(["\n        ovtc \x3d uv * oldTexOffsetAndScale.zw + oldTexOffsetAndScale.xy;\n    "],["\n        ovtc \x3d uv * oldTexOffsetAndScale.zw + oldTexOffsetAndScale.xy;\n    "])))),
q.vertex.code.add(c.glsl(G||(G=l(["\n      }\n    "],["\n      }\n    "])))),q.extensions.add("GL_OES_standard_derivatives"),q.extensions.add("GL_EXT_shader_texture_lod"),q.include(f.Slice,b),q.include(d.EvaluateSceneLighting,b),q.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("tex","sampler2D").add("opacity","float"),b.screenSizePerspective&&q.fragment.uniforms.add("screenSizePerspective","vec4"),q.fragment.code.add(c.glsl(J||
(J=l(["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n    "],["\n      const vec3 ambient \x3d vec3(0.2, 0.2, 0.2);\n      const vec3 diffuse \x3d vec3(0.8, 0.8, 0.8);\n      const float diffuseHardness \x3d 2.5;\n      const float sliceOpacity \x3d 0.2;\n    "])))),b.overlayEnabled&&(q.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),q.fragment.uniforms.add("ovOuterWaterTex",
"sampler2D")),b.blendingEnabled&&q.fragment.uniforms.add("texOld","sampler2D").add("blend","float"),q.fragment.code.add(c.glsl(I||(I=l(["\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "],["\n      float lum(vec3 c) {\n        float max \x3d max(max(c.r, c.g), c.b);\n        float min \x3d min(min(c.r, c.g), c.b);\n        return (min + max) * 0.5;\n      }\n      "])))),
b.atmosphere&&q.fragment.code.add(c.glsl(K||(K=l(["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "],
["\n      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\n        vec3 surfaceColor   \x3d vec3(0.0);\n        vec3 fuzzySpecColor \x3d vec3(1.0);\n        vec3 subColor       \x3d vec3(0.0);\n        float rollOff       \x3d 1.0;\n\n        vec3 Ln \x3d normalize(lightPos);\n        vec3 Nn \x3d normalize(normal);\n        vec3 Hn \x3d normalize(view + Ln);\n\n        float ldn \x3d dot(Ln, Nn);\n        float diffComp \x3d max(0.0, ldn);\n        // clamp necessary here because values might cause flickering: #21549\n        float vdn \x3d clamp(1.0 - dot(view, Nn), 0.0, 1.0);\n        float ndv \x3d dot(view, Ln);\n\n        vec3 diffContrib \x3d surfaceColor * diffComp;\n        float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\n\n        vec3 subContrib \x3d subLamb * subColor;\n        vec3 vecColor \x3d vec3(vdn);\n\n        vec3 diffuseContrib \x3d (subContrib + diffContrib);\n        vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\n\n        return (diffContrib + specularContrib) * rollOff;\n      }\n      "])))),
q.fragment.code.add(c.glsl(H||(H=l(["\n      void main() {\n      "],["\n      void main() {\n      "])))),b.receiveShadows?q.fragment.code.add(c.glsl(L||(L=l(["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "],["\n        float shadow \x3d readShadowMap(vpos, linearDepth);\n      "])))):q.fragment.code.add(c.glsl(P||(P=l(["\n        float shadow \x3d 0.0;\n      "],["\n        float shadow \x3d 0.0;\n      "])))),q.fragment.code.add(c.glsl(S||(S=l(["\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      "],
["\n        float vndl \x3d dot(normalize(vnormal), -lightingMainDirection);\n        float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\n        vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\n\n        float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\n      "])))),b.blendingEnabled?q.fragment.code.add(c.glsl(R||(R=l(["\n        vec4 tileColor \x3d (blend \x3c 1.0 ? mix(texture2D(texOld, ovtc), texture2D(tex, vtc), blend) : texture2D(tex, vtc)) * opacity;\n      "],
["\n        vec4 tileColor \x3d (blend \x3c 1.0 ? mix(texture2D(texOld, ovtc), texture2D(tex, vtc), blend) : texture2D(tex, vtc)) * opacity;\n      "])))):q.fragment.code.add(c.glsl(O||(O=l(["\n        vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\n      "],["\n        vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\n      "])))),b.overlayEnabled&&q.fragment.code.add(c.glsl(Q||(Q=l(["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n        tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\n      "],
["\n        vec4 overlayColor \x3d getCombinedOverlayColor();\n        tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\n      "])))),q.fragment.code.add(c.glsl(T||(T=l(["\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n      "],["\n        if (rejectBySlice(vpos)) {\n          tileColor *\x3d sliceOpacity;\n        }\n        vec3 atm \x3d vec3(0.0);\n      "])))),b.atmosphere&&q.fragment.code.add(c.glsl(Y||
(Y=l(["\n        float ndotl \x3d max(0.0, min(1.0, vndl));\n        atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n        atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n        atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n        atm *\x3d tileColor.a; // premultiply with tile alpha\n      "],["\n        float ndotl \x3d max(0.0, min(1.0, vndl));\n        atm \x3d atmosphere(wlight, wnormal, -viewDirection);\n        atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\n        atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\n        atm *\x3d tileColor.a; // premultiply with tile alpha\n      "])))),
q.fragment.code.add(c.glsl(N||(N=l(["\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n      "],
["\n        vec3 albedo \x3d atm + tileColor.rgb;\n        vec3 normal \x3d normalize(vnormal);\n\n        // heuristic shading function used in the old terrain, now used to add ambient lighting\n        float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\n        vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\n\n        gl_FragColor \x3d vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\n      "])))),
b.overlayEnabled&&q.fragment.code.add(c.glsl(Z||(Z=l(["\n        vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n\n        float waterNormalLength \x3d length(overlayWaterMask);\n        if (waterNormalLength \x3e 0.95) {\n          mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n          vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(tileColor, overlayWaterMask, overlayColor, vpos, shadow, vnormal, camPos, tbnMatrix);\n          // un-gamma the ground color to mix in linear space\n          vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n          waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n          gl_FragColor \x3d delinearizeGamma(waterColor);\n        }\n      "],
["\n        vec4 overlayWaterMask \x3d getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);\n\n        float waterNormalLength \x3d length(overlayWaterMask);\n        if (waterNormalLength \x3e 0.95) {\n          mat3 tbnMatrix \x3d mat3(tbnTangent, tbnBiTangent, vnormal);\n          vec4 waterColor \x3d overlayOpacity * getOverlayWaterColor(tileColor, overlayWaterMask, overlayColor, vpos, shadow, vnormal, camPos, tbnMatrix);\n          // un-gamma the ground color to mix in linear space\n          vec4 groundColor \x3d vec4(pow(gl_FragColor.rgb, vec3(2.2)), gl_FragColor.w);\n          waterColor \x3d mix(groundColor, waterColor, waterColor.a);\n          gl_FragColor \x3d delinearizeGamma(waterColor);\n        }\n      "])))),
b.screenSizePerspective&&q.fragment.code.add(c.glsl(W||(W=l(["\n        float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n        if (perspectiveScale \x3c\x3d 0.25) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n        }\n        else if (perspectiveScale \x3c\x3d 0.5) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n        }\n        else if (perspectiveScale \x3e\x3d 0.99) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n        }\n        else {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n        }\n      "],
["\n        float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\n        if (perspectiveScale \x3c\x3d 0.25) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\n        }\n        else if (perspectiveScale \x3c\x3d 0.5) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\n        }\n        else if (perspectiveScale \x3e\x3d 0.99) {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\n        }\n        else {\n          gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\n        }\n      "])))),
b.tileBorders&&q.fragment.code.add(c.glsl(aa||(aa=l(["\n        vec2 dVuv \x3d fwidth(vuv);\n        vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n        float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n        gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n      "],["\n        vec2 dVuv \x3d fwidth(vuv);\n        vec2 edgeFactors \x3d smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));\n        float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\n\n        gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\n      "])))),
q.fragment.code.add(c.glsl(V||(V=l(["\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "],["\n        gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\n      }\n    "])))));if(1===b.output||3===b.output)q.include(h.Transform,{linearDepth:!0}),q.include(n.RgbaFloatEncoding),q.include(a.OutputDepth,{output:b.output}),q.include(k.NormalUtils,b),q.varyings.add("linearDepth","float"),q.vertex.uniforms.add("nearFar","vec2"),q.vertex.code.add(c.glsl(F||(F=l(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vec3 vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\n\n          gl_Position \x3d transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);\n        }\n    "])))),q.fragment.code.add(c.glsl(ca||(ca=l(["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "],["\n        void main() {\n          outputDepth(linearDepth);\n        }\n    "]))));
2===b.output&&(q.include(h.Transform,{linearDepth:!1}),q.include(k.NormalUtils,b),q.varyings.add("vnormal","vec3"),q.varyings.add("vpos","vec3"),q.vertex.uniforms.add("viewNormal","mat4"),q.vertex.code.add(c.glsl(U||(U=l(["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "],
["\n        void main(void) {\n          vec3 normal \x3d getLocalUp(position, origin);\n          vec2 uv \x3d uv0;\n          vpos \x3d applySkirts(uv, position, normal, skirtScale);\n\n          gl_Position \x3d transformPosition(proj, view, vpos);\n          vnormal \x3d normalize((viewNormal * vec4(normal, 1.0)).xyz);\n        }\n    "])))),q.fragment.code.add(c.glsl(ea||(ea=l(["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "],
["\n        void main() {\n          vec3 normal \x3d normalize(vnormal);\n          if (gl_FrontFacing \x3d\x3d false) {\n            normal \x3d -normal;\n          }\n          gl_FragColor \x3d vec4(vec3(0.5) + 0.5 * normal, 0.0);\n        }\n    "])))));4===b.output&&(q.include(h.Transform,{linearDepth:!1}),q.include(k.NormalUtils,b),q.include(r.Overlay,{usePBR:!1,usePBRforWater:!1}),q.vertex.code.add(c.glsl(ha||(ha=l(["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "],
["\n          void main() {\n            vec3 vnormal \x3d getLocalUp(position, origin);\n            vec2 uv \x3d uv0;\n            vec3 vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\n            setOverlayVTC(uv);\n\n            gl_Position \x3d transformPosition(proj, view, vpos);\n          }\n      "])))),q.include(e.OutputHighlight),q.fragment.code.add(c.glsl(ka||(ka=l(["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            // Here we have to write black, instead of discarding the fragment in order to overwrite\n            // the highlights which might have been written by skirts of other tiles.\n            // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "],
["\n        void main() {\n          vec4 overlayColor \x3d getCombinedOverlayColor();\n\n          if (overlayColor.a \x3d\x3d 0.0) {\n            // Here we have to write black, instead of discarding the fragment in order to overwrite\n            // the highlights which might have been written by skirts of other tiles.\n            // As a consequence skirts are not visible, but terrain overwrites draped highlights.\n            gl_FragColor \x3d vec4(0.0);\n            return;\n          }\n\n          outputHighlight();\n        }\n      "])))));
return q};var u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca,U,ea,ha,ka})},"esri/views/3d/webgl-engine/shaders/Overlay.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/shading/Water.glsl ../core/shaderLibrary/util/ColorConversion.glsl ../core/shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.Overlay=function(b,g){g.usePBRforWater&&b.include(f.Water,g);b.include(h.ColorConversion,
{stages:1});b.vertex.uniforms.add("overlayTexOffset","vec4");b.vertex.uniforms.add("overlayTexScale","vec4");b.varyings.add("vtcOverlay","vec4");b.vertex.code.add(a.glsl(e||(e=l(["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "],["\n    void setOverlayVTC(in vec2 uv) {\n      vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\n    }\n  "]))));b.fragment.uniforms.add("ovInnerColorTex","sampler2D");b.fragment.uniforms.add("ovOuterColorTex",
"sampler2D");b.fragment.uniforms.add("overlayOpacity","float");b.fragment.code.add(a.glsl(d||(d=l(["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "],
["\n    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {\n      vec4 color \x3d vec4(0.0);\n\n      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\n      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\n      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\n      vec4 color0 \x3d texture2D(ov0Tex, texCoords.xy);\n      vec4 color1 \x3d texture2D(ov1Tex, texCoords.zw);\n\n      if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\n        color \x3d color0;\n      } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\n        color \x3d color1;\n      }\n\n      return color;\n    }\n  "]))));
b.fragment.code.add(a.glsl(k||(k=l(["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "],["\n    vec4 getCombinedOverlayColor() {\n      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);\n    }\n  "]))));!0===g.usePBRforWater&&b.fragment.code.add(a.glsl(n||(n=l(["\n    vec4 getOverlayWaterColor( in vec4 tileColor, vec4 maskInput, vec4 colorInput,\n                        vec3 vpos, float shadow, vec3 localUp, vec3 eye, mat3 tbn) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d -normalize(vpos - eye);\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return premultiplyAlpha(vec4(final, colorInput.w));\n    }\n    "],
["\n    vec4 getOverlayWaterColor( in vec4 tileColor, vec4 maskInput, vec4 colorInput,\n                        vec3 vpos, float shadow, vec3 localUp, vec3 eye, mat3 tbn) {\n\n      // reproject normal from 0...1 \x3d\x3e -1...1\n      // and project it to worldspace.\n      vec3 n \x3d normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));\n      vec3 v \x3d -normalize(vpos - eye);\n      vec3 l \x3d normalize(-lightingMainDirection);\n      vec3 final \x3d getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow);\n\n      // the terrain renderer assumes a premultiplied color output without gamma.\n      return premultiplyAlpha(vec4(final, colorInput.w));\n    }\n    "]))))};
var e,d,k,n})},"esri/views/3d/webgl-engine/shaders/Skirts.glsl":function(){define(["require","exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.Skirts=function(a){a.vertex.code.add(f.glsl(h||(h=l(['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    '],
['\n    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\n      float skirtLength \x3d 0.0;\n\n      if (uv.x \x3e\x3d 2.0) {\n        skirtLength \x3d uv.y * skirtScale;\n        // decode original uv-coordinates (see "encodeSkirtPos")\n        vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\n        uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\n      }\n\n      return vpos - vnormal * skirtLength;\n    }\n    ']))))};var h})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require",
"exports","./TilePerLayerInfo"],function(q,b,l){return function(){function b(b,a,e){this.lij=b;this._pool=a;this.layerInfo=Array(2);this.parent=null;for(b=0;2>b;b++)if(a=e[b],0<a){this.layerInfo[b]=[];for(var d=0;d<a;++d)this.layerInfo[b][d]=l.TilePerLayerInfo.makeEmptyLayerInfo(b,this._pool)}}b.prototype.hasDataAvailable=function(b,a,e){return(a=this.layerInfo[e][a].tilemap)?"unavailable"!==a.getAvailability(b.lij[1],b.lij[2]):!0};b.prototype.modifyLayers=function(b,a,e){b=this.layerInfo[e];for(var d=
a.length,f=Array(d),h=0;h<d;h++){var c=a[h];f[h]=-1<c?b[c]:l.TilePerLayerInfo.makeEmptyLayerInfo(e,this._pool)}this.layerInfo[e]=f};return b}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(q,b,l){return function(){function b(){this.offset=l.vec2f64.create();this.scale=0;this.tile=null}b.prototype.init=function(b,a,e,d){this.tile=b;this.offset[0]=a;this.offset[1]=e;this.scale=d};b.prototype.dispose=function(){this.tile=
null;this.offset[0]=0;this.scale=this.offset[1]=0};return b}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./lib/AutoDisposable ./lib/GeometryRecord ./lighting/Lightsources ./parts/Model ./parts/RenderView".split(" "),function(q,
b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a){return"function"===typeof a.addParentStage&&"function"===typeof a.removeParentStage}Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._viewContent=[];a._mainLightDirection=k.vec3f64.fromValues(0,1,0);return a}f(h,b);t=h;h.prototype.initialize=function(){this.model=new r;this._set("renderView",new p(this.container,this,this.options));this.setLighting({lights:[new g.MainLight(k.vec3f64.fromValues(.7,
.7,.7)),new g.AmbientLight(k.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})};h.prototype.destroy=function(){c.pool.prune(0);this.dispose()};Object.defineProperty(h.prototype,"dirty",{get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mainLightDirection",{get:function(){return this._mainLightDirection},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"lighting",{get:function(){return this._lighting},
enumerable:!0,configurable:!0});h.prototype.setLighting=function(a){d.vec3.set(this._mainLightDirection,0,0,0);for(var b=0,c=a.lights;b<c.length;b++){var e=c[b];if(e instanceof g.MainLight){d.vec3.negate(this._mainLightDirection,e.direction);break}}this._lighting=a;this.renderView.setNeedsRender()};h.prototype.forceAllAnimations=function(b){this.getAll(3).forEach(function(c){a.applySome(c.animation,function(a){return a.forceTime(b)})});this.renderView.setNeedsRender()};h.prototype.add=function(a,
b){this.model.add(a,b);u(b)&&b.addParentStage(this);this.renderView.setNeedsRender()};h.prototype.remove=function(a,b){this.renderView.setNeedsRender();a=this.model.remove(a,b);u(a)&&a.removeParentStage(this);return a};h.prototype.notifyDirty=function(a,b,c){this.model.notifyDirty(a,b,c);this.renderView.setNeedsRender()};h.prototype.processDirty=function(){var a=this.model.getDirtySet();if(a.hasDirtyGeometryRecords()){t.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));
var b=a.commitLayers(this._viewContent);0<b[0].length+b[1].length+b[2].length&&this.renderView.modify(b[0],b[1],b[2]);t.DebugSettings.logDirtySet&&(console.log("RGs add: "+b[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+b[1].map(function(a){return a.uniqueName})));a.commit();this.renderView.setNeedsRender()}};h.prototype.processDirtyLayer=function(a){a=this.model.getDirtySet().commitLayers([a]);0<a[0].length+a[1].length+a[2].length&&this.renderView.modify(a[0],a[1],a[2]);this.renderView.setNeedsRender()};
h.prototype.getContent=function(a,b){return this.model.get(a,b)};h.prototype.getAll=function(a){return this.model.getAll(a)};h.prototype.getCount=function(a){return this.model.getAll(a).size};h.prototype.getCamera=function(){return this.renderView.getCamera()};h.prototype.setCamera=function(a){this.renderView.setCamera(a)};h.prototype.getLayers=function(){return this.model.getAll(0)};h.prototype.getViewContent=function(){return this._viewContent.slice(0)};h.prototype.addToViewContent=function(a){for(var b=
[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.renderView.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};h.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);
this.renderView.modify([],a,[])};h.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);this.renderView.renderPlugins.add(a,b)};h.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);this.renderView.renderPlugins.remove(a)};h.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};var t;h.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};l([e.property({constructOnly:!0})],
h.prototype,"options",void 0);l([e.property({constructOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);l([e.property({constructOnly:!0})],h.prototype,"viewingMode",void 0);l([e.property({constructOnly:!0})],h.prototype,"container",void 0);l([n.autoDispose()],h.prototype,"model",void 0);l([n.autoDispose(),e.property()],h.prototype,"renderView",void 0);return h=t=l([e.subclass("esri.views.3d.webgl-engine.Stage")],h)}(e.declared(n.AutoDisposableMixin(h)));b.Stage=q})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports ../../../../core/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),
function(q,b,l,f,h,a,e,d,k){var n=k.assert,c=k.logWithBase;return function(){function b(){var b=this;this.dirtySet=new e(this);this._uniqueIdx=0;this._id2origin={};this._content=new Map;a.allModelContentTypes.forEach(function(a){b._content.set(a,new Map)})}b.prototype.getAll=function(a){a=this._content.get(a);n(void 0!==a);return a};b.prototype.get=function(a,b){return this.getAll(a).get(b)};b.prototype.add=function(a,b){var c=this._content.get(a);n(void 0!==c);var d=b.id;n(!c.has(d),"Model/Stage already contains object to be added");
c.set(d,b);0===a&&this.notifyDirty(b,"layerAdded")};b.prototype.remove=function(a,b){var c=this._content.get(a);n(void 0!==c);var d=c.get(b);n(void 0!==d,"Model/Stage doesn't contain object to be removed");c.delete(b);4===a&&d.unload();0===a&&this.notifyDirty(d,"layerRemoved");return d};b.prototype.getDirtySet=function(){return this.dirtySet};b.prototype.notifyDirty=function(a,b,c){this.dirtySet.handleUpdate(a,b,c)};b.prototype.getOrigin=function(a,b,d){void 0===d&&(d=10);var e=0;b=b*d/1E4;1<b&&(e=
Math.ceil(c(b,2)));b=1E4*Math.pow(2,e);d=Math.round(a[0]/b);var f=Math.round(a[1]/b);a=Math.round(a[2]/b);var e=e+"_"+d+"_"+f+"_"+a,g=this._id2origin[e];null==g&&(g=h.fromValues(d*b,f*b,a*b,e),this._id2origin[e]=g);return g};b.prototype.getGeometryRenderGeometries=function(a,b,c){var e=a.id,g=b.geometry,k=a.getCombinedStaticTransformation(b),h=f.maxScale(k),m=b.origin,l=b.id,n=this._uniqueIdx++;a=new d(g.data,g.boundingInfo,b.material,k,b.shaderTransformation,h,a.castShadow,e,l,n);a.origin=m||this.getOrigin(a.center,
a.bsRadius);a.instanceParameters=b.instanceParameters;c.push(a)};b.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,c.transformation);c.updateTransformation(c.transformation);a=this.getOrigin(c.center,c.bsRadius);return c.origin!==a};b.prototype.formatDebugInfo=function(b){var c=[];if(b){c[0]="\x3ctable\x3e";for(var d=0,e=a.allModelContentTypes;d<e.length;d++)b=e[d],c[0]+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+
this.getAll(b).size+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";d=0;for(e=a.allModelContentTypes;d<e.length;d++)b=e[d],c[0]+=l.padStart(String(this.getAll(b).size),6," ")+" "+b+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};b.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];n(null!=this.get(2,c.geometry.id));n(null!=this.get(3,c.material.id))}};b.prototype.validateLayer=function(a){a=a.getObjects();
for(var b=0;b<a.length;++b){var c=this.get(1,a[b].id);n(null!=c)}};return b}()})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.allModelContentTypes=[0,1,2,3,4];b.modelContentTypes={LAYER:0,OBJECT:1,GEOMETRY:2,MATERIAL:3,TEXTURE:4}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","../../../../core/arrayUtils","../../../../core/iteratorUtils","./Util"],
function(q,b,l,f,h){return function(){function a(a){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});a.prototype.hasDirtyGeometryRecords=function(){return f.someMap(this._dirtyGeomRecords,
function(a){return f.someMap(a,function(a){return a&&0<a.size})})};a.prototype.handleUpdate=function(a,b,f){h.assert(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,f)};a.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,d){(d=b._model.get(1,d))&&d.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};a.prototype.commit=function(){return this.commitLayers(l.keysOfMap(this._dirtyGeomRecords))};
a.prototype.commitLayers=function(a){for(var b=this,e=[],f=[],c=[],g=function(d){var g=a[d];d=l._dirtyGeomRecords.get(g);if(!d)return"continue";d.forEach(function(a,d){var k=b._ensureGeomRecord(g,d);a.forEach(function(a,g){var m=a[0],l=a[1];a=a[2];var n=!1;if(l&2){var p=k.get(g);if(p){p=p[1];if(a&4)for(var r=b._model.get(1,d),w=0;w<p.length;w++){var t=p[w];if(b._model.updateRenderGeometryTransformation(r,m,t)){n=!0;break}}if(!n)for(r=0;r<p.length;r++)t=p[r],c.push({renderGeometry:t,updateType:a})}else h.assert(!1,
"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l&4||n)(p=k.get(g))?f.push.apply(f,p[1]):4===l&&h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),p&&k.delete(g);if(l&1||n)l=[m,[]],r=b._model.get(1,d),b._model.getGeometryRenderGeometries(r,m,l[1]),e.push.apply(e,l[1]),k.set(g,l)});0===k.size&&b._residentGeomRecords.get(g).delete(d)});0===l._residentGeomRecords.get(g).size&&l._residentGeomRecords.delete(g);l._dirtyGeomRecords.delete(g)},l=this,p=0;p<
a.length;p++)g(p);return[e,f,c]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(l.keysOfMap(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],e=0;e<a.length;e++){var f=this._residentGeomRecords.get(a[e]);f&&f.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};a.prototype.visibilityChanged=function(a,b,f){if(null!=b)this._componentPropertyChanged(a,b,f,1);
else{b=0;for(var d=a.geometryRecords;b<d.length;b++)this._componentPropertyChanged(a,d[b],f,1)}};a.prototype.componentHighlightChanged=function(a,b,f){if(null!=b)this._componentPropertyChanged(a,b,f,16);else{b=0;for(var d=a.geometryRecords;b<d.length;b++)this._componentPropertyChanged(a,d[b],f,16)}};a.prototype.vertexAttrsUpdated=function(a,b,f){this._updateOrCreateDirtyRecord(a,b,f,2,0,0,2,5,2)};a.prototype.layerAdded=function(a){for(var b=a.getObjects(),e=0;e<b.length;e++)this.layerObjectAdded(a,
b[e])};a.prototype.layerRemoved=function(a){for(var b=a.getObjects(),e=0;e<b.length;e++)this.layerObjectRemoved(a,b[e])};a.prototype.layerObjectAdded=function(a,b){a=a.id;for(var d=b.geometryRecords,e=0;e<d.length;e++)this.objGeometryAdded(b,d[e],a)};a.prototype.layerObjectRemoved=function(a,b){a=a.id;for(var d=b.geometryRecords,e=0;e<d.length;e++)this.objGeometryRemoved(b,d[e],a)};a.prototype.layObjectReplaced=function(a,b){this.layerObjectRemoved(a,b[0]);this.layerObjectAdded(a,b[1])};a.prototype.objTransformation=
function(a,b){var d=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(e){d._updateOrCreateDirtyRecord(a,e[0],b,2,0,0,2,5,4)})};a.prototype.objGeometryAdded=function(a,b,f){this._updateOrCreateDirtyRecord(a,b,f,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,b,f){this._updateOrCreateDirtyRecord(a,b,f,4,1,2,0,0)};a.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};a.prototype.objGeometryTransformation=function(a,
b){this.objGeometryReplaced(a,b)};a.prototype._componentPropertyChanged=function(a,b,f,h){this._updateOrCreateDirtyRecord(a,b,f,2,0,0,2,5,h)};a.prototype._updateOrCreateDirtyRecord=function(a,b,f,l,c,g,r,p,u){f=f||this._getParentLayerId(a);var d=b.id;a=this._ensureDirtyRecord(f,a.id);(f=a.get(d))?(b=f[1],b&c?a.delete(d):b&g?(f[1]=l,f[2]=u):b&r?f[2]|=u:b&p||h.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(d,[b,l,u])};a.prototype._ensureGeomRecord=function(a,b){var d=this._residentGeomRecords.get(a);
d||(d=new Map,this._residentGeomRecords.set(a,d));a=d.get(b);a||(a=new Map,d.set(b,a));return a};a.prototype._ensureDirtyRecord=function(a,b){var d=this._dirtyGeomRecords.get(a);d||(d=new Map,this._dirtyGeomRecords.set(a,d));a=d.get(b);a||(a=new Map,d.set(b,a));return a};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],e="";this._dirtyGeomRecords.forEach(function(a,c){a.forEach(function(a,d){0<
e.length&&(e+="\n");e+=c+"."+d;var f=[];a.forEach(function(a){var b=a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(a=0;a<f.length;a++)if(f[a])for(e+=" "+b[a-1]+": ",d=0;d<f[a].length;d++)e+=f[a][d]+", "})});return e};return a}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/now ../../../../core/scheduling ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../layers/support/timeUtils ../../support/animationUtils ../collections/Component/interface ../core/renderPasses/RenderPassManager ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/Camera ../lib/GLMaterialRep ../lib/ProgramRepository ../lib/Renderer ../lib/TextureRepository ../lib/tracer ../materials/lineStippleUtils ./ScreenshotManager ../shaders/globalOptions ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O){var Q=g.getLogger("esri.views.3d.webgl-engine.parts.View");return function(b){function d(a,c,d){var e=b.call(this)||this;e._stage=c;e.events=new n;e.updateLogicClients=new k;e._camera=new E.default(x.vec3f64.fromValues(0,100,-100));e._componentObjectCollection=null;e._needsUpdate=!0;e._needsRender=!0;e._idleSuspend=!0;e._logicUpdateLast=0;e._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,
frameCount:0};e._container=a;e._initializeContext(d);a=S.glslifyGlobalOptions({viewingMode:d.viewingMode});e._programRepository=new J(e._rctx,a);e._stippleTextureRepository=new L.StippleTextureRepository;e._commonUniformStore=new A.CommonUniformStore;e._shaderTechniqueRepository=new B.ShaderTechniqueRepository({rctx:e._rctx,viewingMode:"local"===d.viewingMode?1:0,commonUniformStore:e._commonUniformStore,stippleTextureRepository:e._stippleTextureRepository});e._textureRepository=new K.TextureRepository(e._stage.getAll(4),
e._shaderTechniqueRepository,e._rctx);e._textureRepository.events.on("changed",function(a){return e.setNeedsRender(a.requestType)});e._materialRepository=new G(e._textureRepository,e._shaderTechniqueRepository);e._initializeViewportCamera();e._renderer=new I(e._programRepository,e._materialRepository,e._textureRepository,e._shaderTechniqueRepository,e._rctx,function(a){void 0===a&&(a=1);return e.setNeedsRender(a)},e._stage);e.updateLogicClients.add(e._renderer);e._screenshotManager=new P.ScreenshotManager(e._rctx,
function(a,b,c){return e._render(a,b,c)},function(){return e.setNeedsRender()},d.screenshot.renderOverlay,function(a){return e.events.emit("force-camera-for-screenshot",a)});e._renderPassManager=new w.RenderPassManager(e,e._rctx,e._shaderTechniqueRepository);e.renderPlugins.add(e._renderPassManager.slots(),e._renderPassManager);e._registerFrameTask();return e}f(d,b);d.prototype.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&(this._frameTask.remove(),
this._frameTask=null);this.inherited(arguments)};d.prototype.getCombinedStats=function(){var a=this._rctx.gl,b={};b.scene=this._renderer.getStats();b.renderGeometriesTotal=this._stats.renderGeometriesTotal;b.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==a.getUsedTextureMemory&&(b.textureMemory=a.getUsedTextureMemory());void 0!==a.getUsedRenderbufferMemory&&(b.renderbufferMemory=a.getUsedRenderbufferMemory());void 0!==a.getUsedVBOMemory&&(b.VBOMemory=a.getUsedVBOMemory());if(void 0!==
a.getUsedTextureMemoryStats){var a=a.getUsedTextureMemoryStats(),c;for(c in a)b["texMem type: "+c]=a[c]}return b};d.prototype.setNeedsRender=function(a){void 0===a&&(a=1);1===a?(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};Object.defineProperty(d.prototype,"canRender",{get:function(){var a=this._camera;return 0<a.fullWidth&&0<a.fullHeight&&this._renderer.canRender},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"needsUpdate",{get:function(){return this._needsUpdate||
!this._idleSuspend},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this._stage.dirty},enumerable:!0,configurable:!0});d.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(d.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"textureRepository",
{get:function(){return this._textureRepository},enumerable:!0,configurable:!0});d.prototype.setRenderParameters=function(a){this.setNeedsRender();void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);void 0!==a.shadowMap&&(this._renderPassManager.shadowCastingEnabled=a.shadowMap);this._renderer.setRenderParams(a)};d.prototype.getRenderParameters=function(){var a=this._renderer.getRenderParams();a.anisotropicFiltering=this._rctx.parameters.maxMaxAnisotropy;a.idleSuspend=this._idleSuspend;return a};
Object.defineProperty(d.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});d.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};d.prototype.modify=function(a,b,c){this._renderer.modify(a,a.length,b,b.length,c,c.length)};d.prototype.setCamera=function(a){this._camera.copyFrom(a);this.setNeedsRender()};d.prototype.getCamera=function(){return this._camera};
d.prototype.getCanvas=function(){return this._canvas};d.prototype.takeScreenshot=function(a){return this._screenshotManager.takeScreenshot(a)};Object.defineProperty(d.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});d.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};d.prototype.hotReloadShaders=
function(){return a(this,void 0,void 0,function(){return e(this,function(a){switch(a.label){case 0:return[4,this._shaderTechniqueRepository.hotReload()];case 1:return a.sent(),this.setNeedsRender(),[2]}})})};d.prototype._registerFrameTask=function(){var a=this,b={viewCamera:this._camera,frameHasSlicePlane:!1};this._frameTask=u.addFrameTask({preRender:function(b){H.begin();var c=!1;a._stage.processDirty();var d=v.Milliseconds(b.time-a._logicUpdateLast);if(d>y.DESIRED_ANIMATION_MS){var e={camera:a._stage.getCamera(),
dt:d};a.updateLogicClients.forEach(function(a){a.updateLogic(e)&&(c=!0)});a._logicUpdateLast=b.time}c&&a.setNeedsRender(0)},render:function(){(a.needsUpdate||a._needsRender)&&a.canRender&&(a._needsRender=!1,a._needsUpdate=!1,a._render(null,a._camera,!1))},postRender:function(){a.notifyChange("updating");H.end()},update:function(){b.viewCamera=a._camera;b.frameHasSlicePlane=a._renderer.hasSlicePlane;a._textureRepository.update();a._screenshotManager.update(b)}})};d.prototype._initializeViewportCamera=
function(){var a=this._container.getBoundingClientRect(),b=this.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this.setCamera(b)};d.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=H.instrumentContext(R.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:
a.stencil},a.renderContext));this._rctx=new O(b,{disabledExtensions:a.deactivatedWebGLExtensions||{},debugWebGLExtensions:a.debugWebGLExtensions||{}});null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,8));this._loadShaderOnlyExtensions(this._rctx);!a.alpha&&this._rctx.contextAttributes.alpha&&Q.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&
11<=c("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};d.prototype._render=function(a,b,c){this._renderer.setLighting(this._stage.lighting);this._rctx.bindFramebuffer(a);b.setGLViewport(this._rctx);this._renderer.render({fbo:a,camera:b,disableSlice:c,lightDirection:this._stage.mainLightDirection})};d.prototype._loadShaderOnlyExtensions=function(a){a=a.capabilities;a.standardDerivatives;a.shaderTextureLOD};Object.defineProperty(d.prototype,"componentObjectCollection",
{get:function(){r.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=m.createComponentObjectCollection(this._renderPassManager));return this._componentObjectCollection},enumerable:!0,configurable:!0});h([t.property({type:Boolean,readOnly:!0})],d.prototype,"updating",null);h([C.autoDispose()],d.prototype,"_rctx",void 0);h([C.autoDispose()],d.prototype,"_container",void 0);h([C.autoDispose()],d.prototype,"_canvas",void 0);h([C.autoDispose()],d.prototype,"_programRepository",void 0);
h([C.autoDispose()],d.prototype,"_stippleTextureRepository",void 0);h([C.autoDispose()],d.prototype,"_textureRepository",void 0);h([C.autoDispose()],d.prototype,"_commonUniformStore",void 0);h([C.autoDispose()],d.prototype,"_renderer",void 0);h([C.autoDispose()],d.prototype,"_screenshotManager",void 0);h([C.autoDispose()],d.prototype,"componentObjectCollection",null);h([C.autoDispose()],d.prototype,"_componentObjectCollection",void 0);return d=h([t.subclass("esri.views.3d.webgl-engine.parts.RenderView")],
d)}(t.declared(C.AutoDisposableMixin(d)))})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["require","exports","./ComponentObjectCollection"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.createComponentObjectCollection=function(b){return new l.ComponentObjectCollection(b)};b.isVaryingComponentParameters=function(b){return"function"===typeof b}})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f32 ../../../../../geometry/support/aaBoundingBox ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./interface ./RenderSubmitSystem ./SourceGeometry ./IndexRange/ComponentRangeRunLengthEncoded ./Material/ComponentMaterial ./Material/ComponentTechnique ../../core/util/BucketedObjectStore ../../core/util/TwoVectorPosition ../../lib/AutoDisposable ../../lib/geometryDataUtils ../../lib/Util ../../lib/TextureBackedBuffer/BufferManager ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R){function O(a,b,c){var d=[],e=c.length;b.forEachComponent(function(b){0<a[b]&&(e!==b-1&&(d.length&&d.push(c[e+1]-d[d.length-1]),d.push(c[b])),e=b);return!0});d.length&&d.push(c[e+1]-d[d.length-1]);return d}Object.defineProperty(b,"__esModule",{value:!0});var Q=a.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");q=function(){function a(a){this._renderManager=a;this._objects=new G.BucketedObjectStore;
this._renderSubmit=new w.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new L.BufferManager(a.rctx)}a.prototype.dispose=function(){H.assert(0===this.count,"ObjectCollection should be empty upon disposal")};a.prototype.createObject=function(a){var b=new aa;b.transform=a.transform;b.obb=t.clone(a.obb);b.components=new T(this._componentBufferManager,a.geometry.componentOffsets);b.renderable=this._createRenderable(a,b.components);b.intersectionGeometry=
new Y(a.geometry.positionData,b.components);this._objects.add(a.visible?ha:0,b);return b};a.prototype.destroyObject=function(a){this._objects.remove(a);a.dispose();this._notifyDirty()};a.prototype.setObjectVisibility=function(a,b){b!==a.visible&&(this._objects.updateKey(a,b?a.bucketKey|ha:a.bucketKey&~ha),this._notifyDirty())};Object.defineProperty(a.prototype,"count",{get:function(){return this._objects.count},enumerable:!0,configurable:!0});a.prototype.preSubmit=function(a){var b=a.camera.eye;this._objects.forEach(function(a,
d){d&ha&&a.forEach(function(a){var d=c.vec3.squaredDistance(b,a.transform.position);a.renderable.meta.cameraDepthSquared=d})})};a.prototype.updateMaterial=function(a,b){a=a.renderable.material;b(a);a.dirty&&this._notifyDirty()};a.prototype.setAllComponentVisibilities=function(a,b){a.components.visibility.reset(b);a.components.visibilityDirty();this._notifyDirty()};a.prototype.forEachVisibleComponent=function(a,b){return a.components.visibility.forEachComponent(b)};a.prototype.getComponentCount=function(a){var b=
a.components.visibility.componentCount();return{visible:b,invisible:a.components.count-b}};a.prototype.setComponentData=function(a,b){var c=a.renderable.material;if(m.isVaryingComponentParameters(b)){a=a.components;for(var d=a.materialDataBuffer,e=a.materialDataIndices,f={castShadows:!0,externalColor:r.vec4f32.create(),externalColorMixMode:1},d=d.textureBuffer,g=new Uint8Array(4),h=new Uint32Array(g.buffer),k=0,l=0,p=0,n=0,w=!1,t=0,v=0;v<a.count;v++)b(v,f),k+=+(1>f.externalColor[3]),l+=+(3===f.externalColorMixMode&&
1===f.externalColor[3]),p+=+(0<f.externalColor[3]),n+=+f.castShadows,u.encodeSymbolColor(f.externalColor,f.externalColorMixMode,g),g[2]=g[2]&254|+f.castShadows,d.setData(e[v],0,g[0],g[1],g[2],g[3]),w=w||0<v&&t!==h[0],t=h[0];w?(c.componentParameters=new C.ComponentParametersVarying,c.componentParameters.castShadows=n===a.count?0:0===n?2:1,c.componentParameters.transparent=k===a.count?0:0===k?2:1,c.componentParameters.opaqueOverride=l===a.count?0:0===l?2:1,c.componentParameters.visible=p===a.count?
0:0===p?2:1,c.componentParameters.texture=d,d.updateTexture()):(c.componentParameters=new C.ComponentParametersUniform,c.componentParameters.castShadows=f.castShadows?0:2,c.componentParameters.externalColor=f.externalColor,c.componentParameters.externalColorMixMode=f.externalColorMixMode)}else c.componentParameters=new C.ComponentParametersUniform,c.componentParameters.castShadows=b.castShadows?0:2,c.componentParameters.externalColor=b.externalColor,c.componentParameters.externalColorMixMode=b.externalColorMixMode;
this._notifyDirty()};a.prototype.getComponentAABB=function(a,b,c){return a.intersectionGeometry.getComponentAABB(b,c)};a.prototype.getObjectTransform=function(a){return a.transform};a.prototype.getComponentPositions=function(a,b,c){return a.intersectionGeometry.getComponentPositions(b,c)};a.prototype.intersect=function(a,b,d,f,g,h){e.isSome(g)&&(g.localOrigin=a.transform.position);var m=k.mat3.invert(V,a.transform.rotationScale);c.vec3.sub(ca,b,a.transform.position);c.vec3.sub(U,d,a.transform.position);
c.vec3.transformMat3(ca,ca,m);c.vec3.transformMat3(U,U,m);b=k.mat3.transpose(V,m);return a.intersectionGeometry.intersect(ca,U,f,b,g,h)};a.prototype.addEdges=function(a,b,c,d){return b.addComponentObject(a,a.transform,a.obb.center,a.intersectionGeometry.positions,a.intersectionGeometry.indices,a.components.offsets,c,d)};a.prototype.addComponentHighlight=function(a,b){a=a.components;e.isNone(a.highlightCounts)&&(a.highlightCounts=new Uint32Array(a.count+1));0===a.highlightCounts[b]++&&(a.highlightsDirty(),
this._notifyDirty());a.highlightCounts[a.count]++};a.prototype.removeComponentHighlight=function(a,b){a=a.components;if(e.isNone(a.highlightCounts))Q.warn("Removing non-existing highlight.");else{var c=a.highlightCounts[b],d=a.highlightCounts[a.count];0===c?Q.warn("Removing non-existing highlight."):1<c?(a.highlightCounts[b]=c-1,a.highlightCounts[a.count]=d-1):(a.highlightCounts[b]=0,a.highlightsDirty(),this._notifyDirty(),1===d?a.highlightCounts=null:a.highlightCounts[a.count]=d-1)}};a.prototype.clearHighlights=
function(a){a=a.components;e.isSome(a.highlightCounts)&&(a.highlightCounts=null,a.highlightsDirty(),this._notifyDirty())};a.prototype.getObjectMemoryUsageGPU=function(a){return a.renderable.meta.gpuMemoryEstimate};Object.defineProperty(a.prototype,"visibleObjects",{get:function(){return this._objects.getBucket(ha)},enumerable:!0,configurable:!0});a.prototype._createRenderable=function(a,b){for(var d=this._renderManager.rctx,f=a.geometry,g=f.vertices.layoutParameters,h=S.createVertex(d,35044,f.vertices.data),
m=e.applySome(f.indices,function(a){return S.createIndex(d,35044,a)}),l=v.glLayout(A.createVertexBufferLayout(g)),p=new Uint16Array(f.vertices.count),r=0;r<b.count;r++){var w=b.offsets[r],t=b.offsets[r+1],u=b.materialDataIndices[r];if(e.isSome(f.indices))for(;w<t;w++)p[f.indices[w]]=u;else for(;w<t;w++)p[w]=u}b=S.createVertex(d,35044,p.buffer);r=new J.TwoVectorPosition(a.transform.position);t=n.mat3f32.clone(a.transform.rotationScale);k.mat3.invert(t,t);k.mat3.transpose(t,t);p=new E.ComponentDrawParameters;
c.vec3.copy(p.worldFromModel_TL,r.low);c.vec3.copy(p.worldFromModel_TH,r.high);k.mat3.copy(p.worldFromModel_RS,a.transform.rotationScale);k.mat3.copy(p.transformNormal_GlobalFromModel,t);a=new C.ComponentMaterial;l=new R(d,a.attributeLocations,{data:l,componentIndices:W},{data:h,componentIndices:b},e.unwrap(m));r=new Z;r.material=a;r.drawParameters=p;r.geometry=new N(l,f.primitiveType,g,e.isSome(m));r.meta.cameraDepthSquared=.5;r.meta.gpuMemoryEstimate=h.byteSize+b.byteSize+(e.isSome(m)?m.byteSize:
0);return r};a.prototype._notifyDirty=function(){this._renderManager.notifyDirty()};return a}();b.ComponentObjectCollection=q;var T=function(a){function b(b,c){var e=a.call(this)||this;e.highlightCounts=null;e.cachedGeometryRanges=null;e.cachedHighlightRanges=null;e.offsets=d.slice(c);c=e.count;e.visibility=new B.ComponentRangeRunLengthEncoded(c);e.materialDataBuffer=b.getBuffer(c);e.materialDataIndices=new Uint16Array(c);for(b=0;b<c;b++)e.materialDataIndices[b]=e.materialDataBuffer.acquireIndex();
return e}f(b,a);b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b=0;b<this.count;b++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[b])};Object.defineProperty(b.prototype,"count",{get:function(){return this.offsets.length-1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryRanges",{get:function(){e.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightRanges",{get:function(){if(e.isNone(this.highlightCounts))return null;e.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=O(this.highlightCounts,this.visibility,this.offsets));return this.cachedHighlightRanges},enumerable:!0,configurable:!0});b.prototype.highlightsDirty=function(){this.cachedHighlightRanges=null};b.prototype.visibilityDirty=function(){this.cachedHighlightRanges=this.cachedGeometryRanges=null};
return b}(I.AutoDisposable),Y=function(){function a(a,b){this._indices=e.isSome(a.indices)?a.indices:K.generateDefaultIndexArray(a.positions.length/3);this._positions=new x.BufferViewVec3f(a.positions);this._components=b}a.prototype.getComponentAABB=function(a,b){if(e.isSome(this._perComponentAABBs)){for(var c=0;6>c;c++)b[c]=this._perComponentAABBs[6*a+c];return b}this._computePerComponentAABBs();return this.getComponentAABB(a,b)};a.prototype.getComponentPositions=function(a,b){b.indices=this._indices;
b.data=this._positions.typedBuffer;b.stride=this._positions.typedBufferStride;b.startIndex=this._components.offsets[a];b.endIndex=this._components.offsets[a+1]};a.prototype.intersect=function(a,b,d,f,g,h){var k=this,m={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},l=this._indices,p=this._components.offsets,n=P.computeInvDir(a,b,F);this._components.visibility.forEachComponent(function(r){var w=k.getComponentAABB(r,ea);e.isSome(g)&&g.applyToAABB(w);
if(!P.intersectAabbInvDir(w,a,n,d))return!0;P.intersectTriangles(a,b,p[r]/3,p[r+1]/3,l,m,void 0,g,function(a,b,d){return h(r,a,c.vec3.transformMat3(b,b,f),d)});return!0})};a.prototype._computePerComponentAABBs=function(){var a=this._components.count;this._perComponentAABBs=new Float32Array(6*a);for(var b=0;b<a;b++)this._computeAABB(b)};a.prototype._computeAABB=function(a){for(var b=this._indices,d=this._positions,e=this._components.offsets,f=e[a+1],g=[0,0,0],h=[Infinity,Infinity,Infinity],k=[-Infinity,
-Infinity,-Infinity],e=e[a];e<f;e++)d.getVec(b[e],g),c.vec3.min(h,h,g),c.vec3.max(k,k,g);a*=6;this._perComponentAABBs[a++]=h[0];this._perComponentAABBs[a++]=h[1];this._perComponentAABBs[a++]=h[2];this._perComponentAABBs[a++]=k[0];this._perComponentAABBs[a++]=k[1];this._perComponentAABBs[a]=k[2]};Object.defineProperty(a.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indices",{get:function(){return this._indices},enumerable:!0,
configurable:!0});return a}(),N=function(a){function b(b,c,d,e){var f=a.call(this)||this;f.vao=b;f.primitiveType=c;f.parameters=d;f.indexed=e;return f}f(b,a);h([I.autoDispose()],b.prototype,"vao",void 0);return b}(I.AutoDisposable);b.RenderGeometry=N;var Z=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return b}f(b,a);h([I.autoDispose()],b.prototype,"geometry",void 0);return b}(I.AutoDisposable);b.Renderable=Z;var W=v.glLayout(y.newLayout().u16("componentIndex")),
aa=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);Object.defineProperty(b.prototype,"visible",{get:function(){return!!(this.bucketKey&ha)},enumerable:!0,configurable:!0});h([I.autoDispose()],b.prototype,"renderable",void 0);h([I.autoDispose()],b.prototype,"components",void 0);return b}(G.BucketStorable);b.ComponentObject=aa;var V=n.mat3f32.create(),F=g.vec3f64.create(),ca=g.vec3f64.create(),U=g.vec3f64.create(),ea=p.create(),ha=1})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(b,c,d){return{center:n.vec3f64.clone(b),halfSize:k.vec3f32.clone(c),quaternion:a.quatf32.clone(d)}}function x(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,b);return c>a?1:c<-a?-1:0}function v(a,b){h.quat.conjugate(y,a.quaternion);d.vec3.transformQuat(m,b,y);a=a.halfSize;return Math.abs(m[0]*a[0])+Math.abs(m[1]*a[1])+Math.abs(m[2]*a[2])}Object.defineProperty(b,"__esModule",{value:!0});var y=e.quatf64.create(),m=n.vec3f64.create(),w=n.vec3f64.create(),
A=g.vec4f64.create(),B=f.mat3f64.create();q=function(){return function(b){this.buffer=new ArrayBuffer(56*b);this.obbs=Array(b);for(var c=0;c<b;c++)this.obbs[c]={center:n.vec3f64.createView(this.buffer,56*c+0),halfSize:k.vec3f32.createView(this.buffer,56*c+24),quaternion:a.quatf32.createView(this.buffer,56*c+36)}}}();b.ObbArray=q;b.create=t;b.clone=function(a){return t(a.center,a.halfSize,a.quaternion)};b.set=function(a,b){d.vec3.copy(b.center,a.center);d.vec3.copy(b.halfSize,a.halfSize);h.quat.copy(b.quaternion,
a.quaternion)};b.compute=function(a,b){b||(b=t([0,0,0],[-1,-1,-1],[0,0,0,1]));p.computeOBB(a,b);return b};b.intersectPlane=x;b.toAaBoundingBox=function(a,b){b||(b=r.create());var c=l.mat3.fromQuat(B,a.quaternion),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),e=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=
a.center[1]-e;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+e;b[5]=a.center[2]+c;return b};b.minimumDistancePlane=function(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,b);return c-a};b.maximumDistancePlane=function(a,b){var c=u.plane.signedDistance(b,a.center);a=v(a,b);return c+a};b.isVisible=function(a,b){return 0>=x(a,b.planes[0])&&0>=x(a,b.planes[1])&&0>=x(a,b.planes[2])&&0>=x(a,b.planes[3])&&0>=x(a,b.planes[4])&&0>=x(a,b.planes[5])};b.intersectLine=function(a,b,c,e){void 0===e&&
(e=0);h.quat.conjugate(y,a.quaternion);d.vec3.subtract(m,b,a.center);b=d.vec3.transformQuat(m,m,y);c=d.vec3.transformQuat(w,c,y);for(var f=-Infinity,g=Infinity,k=0;3>k;k++)if(1E-6<Math.abs(c[k]))var l=(e+a.halfSize[k]-b[k])/c[k],p=(-e-a.halfSize[k]-b[k])/c[k],f=Math.max(f,Math.min(l,p)),g=Math.min(g,Math.max(l,p));else if(b[k]>a.halfSize[k]+e||b[k]<-a.halfSize[k]-e)return!1;return f<=g};b.projectedArea=function(a,b,e,f,g){h.quat.conjugate(y,a.quaternion);d.vec3.sub(m,b,a.center);d.vec3.transformQuat(m,
m,y);var k=m[0]<-a.halfSize[0]?-1:m[0]>a.halfSize[0]?1:0,p=m[1]<-a.halfSize[1]?-1:m[1]>a.halfSize[1]?1:0,n=m[2]<-a.halfSize[2]?-1:m[2]>a.halfSize[2]?1:0;b=Math.abs(k)+Math.abs(p)+Math.abs(n);if(0===b)return Infinity;b=1===b?4:6;p=6*(k+3*p+9*n+13);l.mat3.fromQuat(B,a.quaternion);l.mat3.scale(B,B,a.halfSize);for(k=0;k<b;k++)n=E[p+k],d.vec3.set(m,((n&1)<<1)-1,(n&2)-1,((n&4)>>1)-1),d.vec3.transformMat3(m,m,B),d.vec3.add(A,a.center,m),A[3]=1,c.vec4.transformMat4(A,A,e),n=1/Math.max(1E-6,A[3]),C[2*k]=A[0]*
n,C[2*k+1]=A[1]*n;a=2*b-2;e=C[0]*(C[3]-C[a+1])+C[a]*(C[1]-C[a-1]);for(k=2;k<a;k+=2)e+=C[k]*(C[k+3]-C[k-1]);return Math.abs(e)*f*g*.125};var C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],E=function(){var a=new Int8Array(162),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=6};c([6,2,3,1,5,4]);c([0,2,3,1,5,4]);c([0,2,3,7,5,4]);c([0,1,3,2,6,4]);c([0,1,3,2,0,0]);c([0,1,5,7,3,2]);c([0,1,3,7,6,4]);c([0,1,3,7,6,2]);c([0,1,5,7,6,2]);c([0,1,5,4,6,2]);c([0,1,5,4,0,0]);c([0,1,3,7,5,4]);c([0,2,6,4,0,0]);
c([0,0,0,0,0,0]);c([1,3,7,5,0,0]);c([2,3,7,6,4,0]);c([2,3,7,6,0,0]);c([2,3,1,5,7,6]);c([0,1,5,7,6,2]);c([0,1,5,7,6,4]);c([0,1,3,7,6,4]);c([4,5,7,6,2,0]);c([4,5,7,6,0,0]);c([4,5,1,3,7,6]);c([0,2,3,7,5,4]);c([6,2,3,7,5,4]);c([6,2,3,1,5,4]);return a}();b.projectedRadius=v})},"esri/core/libs/gl-matrix-2/quatf32":function(){define(["require","exports","./factories/quatf32"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.quatf32=l})},"esri/core/libs/gl-matrix-2/factories/quatf32":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(4);b[3]=1;return b};b.clone=function(b){var f=new Float32Array(4);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];return f};b.fromValues=function(b,f,h,a){var e=new Float32Array(4);e[0]=b;e[1]=f;e[2]=h;e[3]=a;return e};b.createView=function(b,f){return new Float32Array(b,f,4)}})},"esri/views/3d/support/dito":function(){define(["require","exports"],function(q,b){function l(a,b,c,e,h,k){if(!(1E-6>
b[0]*b[0]+b[1]*b[1]+b[2]*b[2]))for(r(I,c,b),r(K,e,b),r(H,h,b),f(a,b,J),P[1]=J[0],L[1]=J[1],S[1]=L[1]-P[1],c=[c,e,h],e=[I,K,H],h=0;3>h;++h){f(a,c[h],J);P[0]=J[0];L[0]=J[1];f(a,e[h],J);P[2]=J[0];L[2]=J[1];S[0]=L[0]-P[0];S[2]=L[2]-P[2];var m=d(S);m<k.quality&&(g(k.b0,c[h]),g(k.b1,b),g(k.b2,e[h]),k.quality=m)}}function f(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],
f);c[1]=Math.max(c[1],f)}}function h(a,b,d){g(d.center,a);c(d.halfSize,b,.5);d.quaternion[0]=0;d.quaternion[1]=0;d.quaternion[2]=0;d.quaternion[3]=1}function a(a,b,c,d,e,g){f(a,b,J);e[0]=J[0];g[0]=J[1];f(a,c,J);e[1]=J[0];g[1]=J[1];f(a,d,J);e[2]=J[0];g[2]=J[1]}function e(a,b,d,e,f,g,h){aa[0]=a[0];aa[1]=a[1];aa[2]=a[2];aa[3]=b[0];aa[4]=b[1];aa[5]=b[2];aa[6]=d[0];aa[7]=d[1];aa[8]=d[2];var m=h.quaternion,l=aa,p=l[0]+l[4]+l[8];if(0<p)p=Math.sqrt(p+1),m[3]=.5*p,p=.5/p,m[0]=(l[5]-l[7])*p,m[1]=(l[6]-l[2])*
p,m[2]=(l[1]-l[3])*p;else{var n=0;l[4]>l[0]&&(n=1);l[8]>l[3*n+n]&&(n=2);var r=(n+1)%3,w=(n+2)%3,p=Math.sqrt(l[3*n+n]-l[3*r+r]-l[3*w+w]+1);m[n]=.5*p;p=.5/p;m[3]=(l[3*r+w]-l[3*w+r])*p;m[r]=(l[3*r+n]+l[3*n+r])*p;m[w]=(l[3*w+n]+l[3*n+w])*p}k(V,e,f);c(V,V,.5);c(h.center,a,V[0]);c(W,b,V[1]);k(h.center,h.center,W);c(W,d,V[2]);k(h.center,h.center,W);c(h.halfSize,g,.5)}function d(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}function k(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2]}function n(a,b,c){a[0]=b[0]-
c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2]}function c(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}function g(a,b,c){void 0===c&&(c=0);a[0]=b[c+0];a[1]=b[c+1];a[2]=b[c+2]}function r(a,b,c){var d=b[0],e=b[1];b=b[2];var f=c[0],g=c[1];c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f}function p(a,b){var c=b[0]*b[0]+b[1]*b[1]+b[2]*b[2];0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c)}function u(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}Object.defineProperty(b,"__esModule",{value:!0});
var t=[0,0,0],x=[0,0,0];b.computeOBB=function(b,f){var q=b.data.length/b.strideIdx;if(!(0>=q)){var H=new F(b);k(t,H.minProj,H.maxProj);c(t,t,.5);n(x,H.maxProj,H.minProj);var K=d(x),L=new ca;L.quality=K;14>q&&(b={data:new Float64Array(H.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var P=[0,0,0],I=[0,0,0],S=[0,0,0],q=[0,0,0],U=[0,0,0],W=[0,0,0],V=[0,0,0],aa;aa=b;for(var ea=u(H.maxVert[0],H.minVert[0]),oa=0,pa=1;7>pa;++pa){var ia=u(H.maxVert[pa],H.minVert[pa]);ia>ea&&(ea=ia,oa=pa)}g(P,H.minVert[oa]);
g(I,H.maxVert[oa]);if(1E-6>u(P,I))aa=1;else{n(q,P,I);p(q,q);H=aa.data;ea=aa.strideIdx;oa=Number.NEGATIVE_INFINITY;pa=0;for(ia=aa.offsetIdx;ia<H.length;ia+=ea){G[0]=H[ia]-P[0];G[1]=H[ia+1]-P[1];G[2]=H[ia+2]-P[2];var na=q[0]*G[0]+q[1]*G[1]+q[2]*G[2],na=G[0]*G[0]+G[1]*G[1]+G[2]*G[2]-na*na/(q[0]*q[0]+q[1]*q[1]+q[2]*q[2]);na>oa&&(oa=na,pa=ia)}g(S,H,pa);1E-6>oa?aa=2:(n(U,I,S),p(U,U),n(W,S,P),p(W,W),r(V,U,q),p(V,V),l(aa,V,q,U,W,L),aa=0)}switch(aa){case 1:h(t,x,f);return;case 2:K=b;g(O,q);Math.abs(q[0])>
Math.abs(q[1])&&Math.abs(q[0])>Math.abs(q[2])?O[0]=0:Math.abs(q[1])>Math.abs(q[2])?O[1]=0:O[2]=0;1E-6>O[0]*O[0]+O[1]*O[1]+O[2]*O[2]&&(O[0]=O[1]=O[2]=1);r(Q,q,O);p(Q,Q);r(T,q,Q);p(T,T);a(K,q,Q,T,Y,N);n(Z,N,Y);e(q,Q,T,Y,N,Z,f);return}aa=b;H=v;ea=y;oa=J;pa=aa.data;na=aa.offsetIdx;ia=aa.strideIdx;g(ea,pa,na);g(H,ea);oa[0]=R[0]*V[0]+R[1]*V[1]+R[2]*V[2];oa[1]=oa[0];for(na+=ia;na<pa.length;na+=ia){var ya=pa[na]*V[0]+pa[na+1]*V[1]+pa[na+2]*V[2];ya<oa[0]&&(oa[0]=ya,g(ea,pa,na));ya>oa[1]&&(oa[1]=ya,g(H,pa,
na))}V=P[0]*V[0]+P[1]*V[1]+P[2]*V[2];J[1]-1E-6<=V&&(H[0]=void 0);J[0]+1E-6>=V&&(ea[0]=void 0);void 0!==v[0]&&(n(m,v,P),p(m,m),n(w,v,I),p(w,w),n(A,v,S),p(A,A),r(B,w,q),p(B,B),r(C,A,U),p(C,C),r(E,m,W),p(E,E),l(aa,B,q,w,m,L),l(aa,C,U,A,w,L),l(aa,E,W,m,A,L));void 0!==y[0]&&(n(m,y,P),p(m,m),n(w,y,I),p(w,w),n(A,y,S),p(A,A),r(B,w,q),p(B,B),r(C,A,U),p(C,C),r(E,m,W),p(E,E),l(aa,B,q,w,m,L),l(aa,C,U,A,w,L),l(aa,E,W,m,A,L));a(b,L.b0,L.b1,L.b2,Y,N);b=[0,0,0];n(b,N,Y);L.quality=d(b);L.quality<K?e(L.b0,L.b1,L.b2,
Y,N,b,f):h(t,x,f)}};var v=[0,0,0],y=[0,0,0],m=[0,0,0],w=[0,0,0],A=[0,0,0],B=[0,0,0],C=[0,0,0],E=[0,0,0],G=[0,0,0],J=[0,0],I=[0,0,0],K=[0,0,0],H=[0,0,0],L=[0,0,0],P=[0,0,0],S=[0,0,0],R=[0,0,0],O=[0,0,0],Q=[0,0,0],T=[0,0,0],Y=[0,0,0],N=[0,0,0],Z=[0,0,0],W=[0,0,0],aa=[1,0,0,0,1,0,0,0,1],V=[0,0,0],F=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,
b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.maxVert[c]=new Float64Array(this.buffer,b,3),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,f=a.strideIdx,c=a.offsetIdx;c<e.length;c+=f)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&
(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&
(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=c);for(c=0;7>c;++c)a=b[c],g(this.minVert[c],e,a),a=d[c],g(this.maxVert[c],e,a)}}(),ca=function(){return function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0}}()})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["require","exports","./DepthRange"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._objects=b}b.prototype.submit=
function(b,a){this._objects.preSubmit(a);a=this._objects.visibleObjects;for(var e=0;e<a.length;e++){var d=a[e];d.renderable.material.submit(b,d)}};b.prototype.queryShadowCasterDepthRange=function(b){return this._objects.visibleObjects.length?l.computeDepthRange(b,this._objects.visibleObjects):null};return b}();b.RenderSubmitSystem=q})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("require exports ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/quat ../../../../../core/libs/gl-matrix-2/quatf64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/orientedBoundingBox ../../../support/geometryUtils/plane ../../lib/depthRange".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a,b,c){return d.vec3.set(a,b.data[c+0],b.data[c+1],b.data[c+2])}function p(a,b){a.push(b[0]);a.push(b[1]);a.push(b[2])}function u(b,c,e,g){a.quat.conjugate(G,b.quaternion);d.vec3.sub(J,c,b.center);d.vec3.transformQuat(J,J,G);var h=8*((J[0]<-b.halfSize[0]?-1:J[0]>b.halfSize[0]?1:0)+3*(J[1]<-b.halfSize[1]?-1:J[1]>b.halfSize[1]?1:0)+9*(J[2]<-b.halfSize[2]?-1:J[2]>b.halfSize[2]?1:0)+13);c=B[h];if(0===c)return c;f.mat3.fromQuat(E,b.quaternion);f.mat3.scale(E,
E,b.halfSize);var k=function(a,c){c=B[h+c+1];d.vec3.set(a,((c&1)<<1)-1,(c&2)-1,((c&4)>>1)-1);d.vec3.transformMat3(a,a,E);return d.vec3.add(a,b.center,a)};e.length=0;p(e,k(I,0));p(e,k(K,1));p(e,k(J,2));p(e,k(H,3));g(e);if(1===c)return c;e.length=0;p(e,I);p(e,H);p(e,k(J,4));p(e,k(L,5));g(e);if(2===c)return c;e.length=0;p(e,I);p(e,L);p(e,k(J,6));p(e,K);g(e);return c}function t(a,b){for(var c=0,d=0;d<C;d++){var e=n.intersectPlane(a,b[d]);if(0<e)return-1;0===e&&(c|=1<<d)}return c}Object.defineProperty(b,
"__esModule",{value:!0});b.computeDepthRange=function(a,b){var e=g.empty(),f=a.eye,h=a.viewForward,k=a.frustum.planes;for(a=0;a<b.length;a++){var l=b[a].obb,q=d.vec3.dot(d.vec3.sub(J,l.center,f),h),B=n.projectedRadius(l,h);if(!g.within(e,q-B)||!g.within(e,q+B))if(l=t(l,k),-1!==l)if(0===l)v.far=q+B,v.near=q-B,g.union(e,v);else{var E=x.pushNew();E.near=q-B;E.far=q+B;E.mask=l;E.object=b[a]}}b=function(a){var b=x.data[a];if(g.within(e,b.near)&&g.within(e,b.far))return"continue";v.far=b.far;v.near=Infinity;
0===u(b.object.obb,f,w,function(a){for(var e=A,g=0;g<C&&0<a.length;g++)if(0!==(b.mask&1<<g)){var l=k[g],n=a,w=e;w.length=0;var t=n.length-3;r(y,n,t);var u=c.signedDistance(l,y);0>=u&&(w.push(y[0]),w.push(y[1]),w.push(y[2]));var q=0,x=u;for(q;q<t;q+=3){r(m,n,q);var B=c.signedDistance(l,m);0>x*B&&(d.vec3.lerp(y,m,y,B/(B-x)),p(w,y));0>=B&&p(w,m);x=B;d.vec3.copy(y,m)}0>x*u&&(r(m,n,t),d.vec3.lerp(y,m,y,u/(u-x)),p(w,y));l=a;a=e;e=l}for(e=0;e<a.length;e+=3)d.vec3.set(y,a.data[e+0],a.data[e+1],a.data[e+2]),
g=d.vec3.dot(d.vec3.sub(y,y,f),h),v.near=Math.min(v.near,g)})&&(v.near=0);g.union(e,v)};for(a=0;a<x.length;a++)b(a);x.length=0;return e};var x=new l({allocator:function(a){return a||{near:Infinity,far:-Infinity,mask:0,object:null}},deallocator:function(a){a.object=null;return a}}),v=g.empty(),y=k.vec3f64.create(),m=k.vec3f64.create(),w=new l({deallocator:null}),A=new l({deallocator:null}),B=function(){var a=new Int8Array(216),b=0,c=function(c){for(var d=0;d<c.length;d++)a[b+d]=c[d];b+=8};c([3,0,6,
2,3,1,5,4]);c([2,0,2,3,1,5,4,0]);c([3,1,0,2,3,7,5,4]);c([2,0,1,3,2,6,4,0]);c([1,0,1,3,2,0,0,0]);c([2,1,5,7,3,2,0,0]);c([3,2,0,1,3,7,6,4]);c([2,2,0,1,3,7,6,0]);c([3,3,0,1,5,7,6,2]);c([2,0,1,5,4,6,2,0]);c([1,0,1,5,4,0,0,0]);c([2,1,3,7,5,4,0,0]);c([1,0,2,6,4,0,0,0]);c([0,0,0,0,0,0,0,0]);c([1,1,3,7,5,0,0,0]);c([2,2,3,7,6,4,0,0]);c([1,2,3,7,6,0,0,0]);c([2,3,1,5,7,6,2,0]);c([3,4,0,1,5,7,6,2]);c([2,5,7,6,4,0,1,0]);c([3,5,0,1,3,7,6,4]);c([2,4,5,7,6,2,0,0]);c([1,4,5,7,6,0,0,0]);c([2,5,1,3,7,6,4,0]);c([3,6,
0,2,3,7,5,4]);c([2,6,2,3,7,5,4,0]);c([3,7,6,2,3,1,5,4]);return a}(),C=4,E=h.mat3f64.create(),G=e.quatf64.create(),J=k.vec3f64.create(),I=k.vec3f64.create(),K=k.vec3f64.create(),H=k.vec3f64.create(),L=k.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(q,b){function l(b,a){return{near:b,far:a}}function f(b,a,e){b.near=a;b.far=e;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.empty=function(b){return b?f(b,Infinity,
-Infinity):l(Infinity,-Infinity)};b.set=f;b.union=function(b,a,e){void 0===e&&(e=b);e.near=Math.min(b.near,a.near);e.far=Math.max(b.far,a.far);return e};b.within=function(b,a){return b.near<=a&&a<=b.far}})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["require","exports","../../../support/buffer/InterleavedLayout"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.createVertexBufferLayout=function(b){var f=l.newLayout().vec3f("position");b.normals&&
f.vec2i16("normalCompressed",{glNormalized:!0});1===b.textureCoordinates?f.vec2f("uv0"):2===b.textureCoordinates&&(f.vec2f("uv0"),f.vec4u16("uvRegion",{glNormalized:!0}));b.colors&&f.vec4u8("color",{glNormalized:!0});return f.alignTo(4)}})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._totalCount=b;this._indexRanges=
[0,b]}b.prototype.componentCount=function(){for(var b=this._indexRanges,h=0,a=0;a<b.length;a+=2)h+=b[a+1];return h};b.prototype.reset=function(b){if("all"===b||b.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{var f=[];if(0!==b.length){for(var a=b[0],e=1,d=1;d<b.length;d++){var k=b[d];a+e===k?e+=1:(f.push(a),f.push(e),a=k,e=1)}f.push(a);f.push(e)}this._indexRanges=f}};b.prototype.forEachComponent=function(b){for(var f=this._indexRanges,a=0;a<f.length;a+=2)for(var e=f[a],d=e+
f[a+1];e<d;e++)if(!b(e))return!1;return!0};b.prototype.forEachComponentRange=function(b){for(var f=this._indexRanges,a=0;a<f.length;a+=2){var e=f[a];if(!b(e,e+f[a+1]))return!1}return!0};b.prototype.computeOffsetRanges=function(b){for(var f=Array(this._indexRanges.length),a=this._indexRanges,e=0;e<a.length;e+=2){var d=a[e],k=b[d],d=b[d+a[e+1]];f[e]=k;f[e+1]=d-k}return f};return b}();b.ComponentRangeRunLengthEncoded=q})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/vec3 ../../../../../../core/libs/gl-matrix-2/vec3f32 ../../../../../../core/libs/gl-matrix-2/vec4 ../../../../../../core/libs/gl-matrix-2/vec4f32 ./ComponentTechnique ./shader/ComponentShader.glsl ../../../core/material/MaterialBase ../../../core/shaderLibrary/DiscardOrAdjustAlpha.glsl".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){function p(a){switch(a){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 7}}Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function v(){var a=b.call(this)||this;a.baseColor=k.vec4f32.fromValues(1,1,1,1);a.usePBR=!1;a.roughnessFactor=1;a.metallicFactor=1;a.reflectanceFactor=.5;a.emissiveFactor=e.vec3f32.fromValues(0,0,0);a.baseColorTexture=null;a.metallicRoughnessTexture=null;a.emissionTexture=null;a.occlusionTexture=null;a.normalTexture=
null;a.objectOpacity=1;a.commonMaterialParameters=new u;a.componentParameters=new t;a.alphaCutoff=r.TEXTURE_ALPHA_CUTOFF_DEFAULT;a.alphaDiscardMode=1;a.transparencyHint=null;a.isIntegratedMesh=!1;a.polygonOffsetEnabled=!1;a._techniqueConfig=new n.ComponentTechniqueConfiguration;return a}l(v,b);v.prototype.dispose=function(a){this._technique&&(a.release(this._technique),this._technique=void 0);this.baseColorTexture=null};Object.defineProperty(v.prototype,"hasTransparency",{get:function(){return 0!==
this._computeWhichMaterialPass()},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"hasVisibleComponents",{get:function(){return 0===this.objectOpacity?!1:2!==this.componentParameters.visible},enumerable:!0,configurable:!0});v.prototype.getTechnique=function(a,b,c){var d=this._techniqueConfig;d.vertexColors=c.colors;d.normalMode=this.isIntegratedMesh?2:c.normals?1:3;d.vertexTextureCoordinates=c.textureCoordinates;d.usePBR=this.usePBR;d.hasMetalnessAndRoughnessTexture=h.isSome(this.metallicRoughnessTexture);
d.hasEmissionTexture=h.isSome(this.emissionTexture);d.hasOcclusionTexture=h.isSome(this.occlusionTexture);d.hasNormalTexture=h.isSome(this.normalTexture);this.dirty&&(d.componentData=this.componentParameters.type,d.cullFace=this.commonMaterialParameters.cullFace,d.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,d.baseColorTexture=h.isSome(this.baseColorTexture),c=this._computeWhichMaterialPass(),d.blendingEnabled=1===c||2===c,d.alphaDiscardMode=this.alphaDiscardMode,d.stencilWriteEnabled=
this.isIntegratedMesh,d.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());d.slicePlaneEnabled=b.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===b.identifier?(d.output=3,d.vertexDiscardMode=0):2===b.identifier?(d.output=4,d.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?d.vertexDiscardMode=b.transparent?2:1:d.vertexDiscardMode=0,d.output=p(b.subPass),0===b.subPass?(d.receiveAmbientOcclusion=b.ambientOcclusionEnabled,d.receiveShadows=b.shadowsEnabled):
(d.receiveAmbientOcclusion=!1,d.receiveShadows=!1));return this._technique=a.repository.acquireAndReleaseExisting(n.ComponentTechnique,d,this._technique)};v.prototype.submit=function(a,b){var c=b.renderable.geometry,d=b.components,e=b.renderable.drawParameters;b=b.renderable.meta.cameraDepthSquared;var f=d.geometryRanges,d=d.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:a.materialOpaque.submitDraw(this,c,f,e,b);break;case 1:a.materialTransparent.submitDraw(this,c,f,e,b);break;case 2:a.materialOpaque.submitDraw(this,
c,f,e,b);a.materialTransparent.submitDraw(this,c,f,e,b);break;case 3:a.materialIntegratedMesh.submitDraw(this,c,f,e,b)}h.isSome(a.shadowMap)&&2!==this.componentParameters.castShadows&&a.shadowMap.submitDraw(this,c,f,e,b);h.isSome(a.highlight)&&h.isSome(d)&&a.highlight.submitDraw(this,c,d,e,b)};Object.defineProperty(v.prototype,"attributeLocations",{get:function(){return c.attributeLocations},enumerable:!0,configurable:!0});v.prototype._computeWhichMaterialPass=function(){return this.isIntegratedMesh?
3:0===this.componentParameters.transparent?1:1===this.componentParameters.transparent?2:1===this.objectOpacity&&0===this.componentParameters.opaqueOverride?0:h.isSome(this.transparencyHint)?this.transparencyHint?1:0:1>this.baseColor[3]||1>this.objectOpacity||h.isSome(this.baseColorTexture)?1:2===this.componentParameters.transparent?0:2};f([g.parameter({vectorOps:d.vec4})],v.prototype,"baseColor",void 0);f([g.parameter()],v.prototype,"usePBR",void 0);f([g.parameter()],v.prototype,"roughnessFactor",
void 0);f([g.parameter()],v.prototype,"metallicFactor",void 0);f([g.parameter()],v.prototype,"reflectanceFactor",void 0);f([g.parameter({vectorOps:a.vec3})],v.prototype,"emissiveFactor",void 0);f([g.parameter({dispose:!0})],v.prototype,"baseColorTexture",void 0);f([g.parameter({dispose:!0})],v.prototype,"metallicRoughnessTexture",void 0);f([g.parameter({dispose:!0})],v.prototype,"emissionTexture",void 0);f([g.parameter({dispose:!0})],v.prototype,"occlusionTexture",void 0);f([g.parameter({dispose:!0})],
v.prototype,"normalTexture",void 0);f([g.parameter()],v.prototype,"objectOpacity",void 0);f([g.parameterBlock()],v.prototype,"commonMaterialParameters",void 0);f([g.parameterBlock()],v.prototype,"componentParameters",void 0);f([g.parameter()],v.prototype,"alphaCutoff",void 0);f([g.parameter()],v.prototype,"alphaDiscardMode",void 0);f([g.parameter()],v.prototype,"transparencyHint",void 0);f([g.parameter()],v.prototype,"isIntegratedMesh",void 0);f([g.parameter()],v.prototype,"polygonOffsetEnabled",
void 0);return v}(g.MaterialBase);b.ComponentMaterial=q;var u=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.doubleSided=!1;b.cullFace=2;b.slicePlaneEnabled=!0;return b}l(b,a);f([g.parameter()],b.prototype,"doubleSided",void 0);f([g.parameter()],b.prototype,"cullFace",void 0);f([g.parameter()],b.prototype,"slicePlaneEnabled",void 0);return b}(g.MaterialParameterBlock);b.CommonMaterialParameters=u;var t=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;
b.externalColor=k.vec4f32.fromValues(1,1,1,1);b.externalColorMixMode=1;b.castShadows=0;return b}l(b,a);Object.defineProperty(b.prototype,"transparent",{get:function(){return 1>this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opaqueOverride",{get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return 0<this.externalColor[3]?0:2},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"type",{get:function(){return 0},enumerable:!0,configurable:!0});f([g.parameter({vectorOps:d.vec4})],b.prototype,"externalColor",void 0);f([g.parameter()],b.prototype,"externalColorMixMode",void 0);f([g.parameter()],b.prototype,"castShadows",void 0);return b}(g.MaterialParameterBlock);b.ComponentParametersUniform=t;q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.texture=null;b.transparent=2;b.opaqueOverride=2;b.castShadows=
2;b.visible=2;return b}l(b,a);Object.defineProperty(b.prototype,"type",{get:function(){return 1},enumerable:!0,configurable:!0});f([g.parameter()],b.prototype,"texture",void 0);f([g.parameter()],b.prototype,"transparent",void 0);f([g.parameter()],b.prototype,"opaqueOverride",void 0);f([g.parameter()],b.prototype,"castShadows",void 0);f([g.parameter()],b.prototype,"visible",void 0);return b}(g.MaterialParameterBlock);b.ComponentParametersVarying=q})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../core/tsSupport/assignHelper ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/tsSupport/decorateHelper ../../../../../../core/maybe ../../../../../../core/libs/gl-matrix-2/mat3f64 ./shader/ComponentShader.glsl ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/DefaultTextureUnits ../../../materials/internal/MaterialUtil ../../../../../webgl/Program ../../../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){Object.defineProperty(b,"__esModule",{value:!0});l=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}f(e,b);e.prototype.bindPass=function(a,b){var c=this.program;n.VertexPosition.bindViewProjTransform(c,b.viewTransform);k.Slice.bindUniforms(this.program,this.configuration,b.slicePlane);0===b.identifier&&(c.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",b.transformNormal_ViewFromGlobal),1===b.subPass&&c.setUniform2fv("uCameraNearFar",
b.cameraNearFar),0===b.subPass&&(b.ambientOcclusionEnabled&&b.ambientOcclusion.bind(c),b.shadowsEnabled&&b.shadowMap.bind(c),b.lighting.setUniforms(this.program,b.integratedMesh)));1===b.identifier&&this.program.setUniform2fv("uCameraNearFar",b.cameraNearFar);2===b.identifier&&x.bindHighlightRendering(a,b,this.program)};e.prototype.bindDraw=function(a){n.VertexPosition.bindModelTransform(this.program,a);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",a.transformNormal_GlobalFromModel)};
e.prototype.bindMaterial=function(b,d){var e=this.program;e.setUniform4fv("uBaseColor",d.baseColor);e.setUniform1f("uObjectOpacity",d.objectOpacity);e.setUniform1f("textureAlphaCutoff",d.alphaCutoff);1===d.componentParameters.type?d.componentParameters.texture.bind(e,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}):(e.setUniform4fv("uExternalColor",d.componentParameters.externalColor),e.setUniform1i("uExternalColorMixMode",d.componentParameters.externalColorMixMode));a.isSome(d.baseColorTexture)&&
d.baseColorTexture.bind(b,e,"uBaseColorTexture",t.DefaultTextureUnits.DIFFUSE,"uBaseColorTextureSize");0===this.configuration.output&&(c.PhysicallyBasedRenderingParameters.bindUniforms(this.program,d),a.isSome(d.metallicRoughnessTexture)&&d.metallicRoughnessTexture.bind(b,e,"texMetallicRoughness",t.DefaultTextureUnits.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),a.isSome(d.emissionTexture)&&d.emissionTexture.bind(b,e,"texEmission",t.DefaultTextureUnits.EMISSION,"texEmissionSize"),a.isSome(d.occlusionTexture)&&
d.occlusionTexture.bind(b,e,"texOcclusion",t.DefaultTextureUnits.OCCLUSION,"texOcclusionSize"),a.isSome(d.normalTexture)&&d.normalTexture.bind(b,e,"normalTexture",t.DefaultTextureUnits.NORMAL,"normalTextureSize"))};e.prototype.initializeProgram=function(a){var b=e.shader.get(),c=this.configuration,c=b.build({output:c.output,normalType:c.normalMode,attributeColor:c.vertexColors,attributeTextureCoordinates:c.vertexTextureCoordinates,componentData:c.componentData,alphaDiscardMode:c.alphaDiscardMode,
baseColorTexture:c.baseColorTexture,doubleSidedMode:c.doubleSidedMode,receiveAmbientOcclusion:c.receiveAmbientOcclusion,receiveShadows:c.receiveShadows,slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,viewingMode:a.viewingMode,vertexDiscardMode:c.vertexDiscardMode,usePBR:c.usePBR,hasMetalnessAndRoughnessTexture:c.hasMetalnessAndRoughnessTexture,hasEmissionTexture:c.hasEmissionTexture,hasOcclusionTexture:c.hasOcclusionTexture,hasNormalTexture:c.hasNormalTexture,
vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:g.doublePrecisionRequiresObfuscation(a.rctx)});return new v(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.attributeLocations)};e.prototype.initializePipeline=function(){var a=this.configuration;return y.makePipelineState({blending:0===a.output&&a.blendingEnabled?m:null,culling:C[a.cullFace],depthTest:{func:513},depthWrite:y.defaultDepthWriteParams,colorWrite:y.defaultColorWriteParams,
stencilWrite:a.stencilWriteEnabled?w:null,stencilTest:a.stencilWriteEnabled?A:null,polygonOffset:a.polygonOffsetEnabled?B:null})};e.shader=new r.ReloadableShaderModule(d,"./shader/ComponentShader.glsl",q);return e}(p.ShaderTechnique);b.ComponentTechnique=l;var m=y.separateBlendingParams(770,1,771,771),w={mask:255},A={function:{func:519,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7681}},B={factor:2,units:2},C=[null,{face:1028,mode:2305},{face:1029,mode:2305}];l=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.transformNormal_GlobalFromModel=e.mat3f64.create();return b}f(b,a);return b}(n.VertexPosition.ModelTransform);b.ComponentDrawParameters=l;l=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.vertexColors=!1;b.normalMode=3;b.vertexTextureCoordinates=0;b.componentData=0;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.cullFace=2;b.baseColorTexture=!1;b.receiveAmbientOcclusion=!0;b.receiveShadows=!0;b.vertexDiscardMode=0;
b.doubleSidedMode=2;b.blendingEnabled=!0;b.alphaDiscardMode=1;b.stencilWriteEnabled=!1;b.polygonOffsetEnabled=!1;b.usePBR=!1;b.hasMetalnessAndRoughnessTexture=!1;b.hasEmissionTexture=!1;b.hasOcclusionTexture=!1;b.hasNormalTexture=!1;return b}f(b,a);h([u.parameter({count:7})],b.prototype,"output",void 0);h([u.parameter()],b.prototype,"vertexColors",void 0);h([u.parameter({count:4})],b.prototype,"normalMode",void 0);h([u.parameter({count:3})],b.prototype,"vertexTextureCoordinates",void 0);h([u.parameter({count:2})],
b.prototype,"componentData",void 0);h([u.parameter()],b.prototype,"slicePlaneEnabled",void 0);h([u.parameter()],b.prototype,"sliceHighlightDisabled",void 0);h([u.parameter({count:3})],b.prototype,"cullFace",void 0);h([u.parameter()],b.prototype,"baseColorTexture",void 0);h([u.parameter()],b.prototype,"receiveAmbientOcclusion",void 0);h([u.parameter()],b.prototype,"receiveShadows",void 0);h([u.parameter({count:3})],b.prototype,"vertexDiscardMode",void 0);h([u.parameter({count:3})],b.prototype,"doubleSidedMode",
void 0);h([u.parameter()],b.prototype,"blendingEnabled",void 0);h([u.parameter({count:4})],b.prototype,"alphaDiscardMode",void 0);h([u.parameter()],b.prototype,"stencilWriteEnabled",void 0);h([u.parameter()],b.prototype,"polygonOffsetEnabled",void 0);h([u.parameter()],b.prototype,"usePBR",void 0);h([u.parameter()],b.prototype,"hasMetalnessAndRoughnessTexture",void 0);h([u.parameter()],b.prototype,"hasEmissionTexture",void 0);h([u.parameter()],b.prototype,"hasOcclusionTexture",void 0);h([u.parameter()],
b.prototype,"hasNormalTexture",void 0);return b}(u.ShaderTechniqueConfiguration);b.ComponentTechniqueConfiguration=l})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentShader.glsl":function(){define("require exports ../../../../../../../core/tsSupport/makeTemplateObjectHelper ./ComponentData.glsl ./VertexDiscardByOpacity.glsl ../../../../core/shaderLibrary/DiscardOrAdjustAlpha.glsl ../../../../core/shaderLibrary/ForwardLinearDepth.glsl ../../../../core/shaderLibrary/Slice.glsl ../../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../../core/shaderLibrary/attributes/VertexColor.glsl ../../../../core/shaderLibrary/attributes/VertexNormal.glsl ../../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../core/shaderLibrary/output/OutputDepth.glsl ../../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../../core/shaderLibrary/shading/ComputeMaterialColor.glsl ../../../../core/shaderLibrary/shading/ComputeNormalTexture.glsl ../../../../core/shaderLibrary/shading/ComputeShadingNormal.glsl ../../../../core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../../../../core/shaderLibrary/shading/ReadShadowMap.glsl ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};b.build=function(b){var q=new B.ShaderBuilder;q.include(g.VertexPosition,b);q.include(c.VertexNormal,b);q.include(n.VertexColor,b);q.include(k.TextureCoordinateAttribute,b);q.include(e.ForwardLinearDepth,b);q.include(f.ComponentData,b);q.include(a.DiscardOrAdjustAlpha,b);q.include(d.Slice,b);
q.include(m.ReadBaseColorTexture,b);q.include(h.VertexDiscardByOpacity,b);b.usePBR&&(q.include(y.PhysicallyBasedRenderingParameters,b),q.include(t.ComputeNormalTexture,b));3===b.output&&1===b.componentData?q.vertex.code.add(A.glsl(C||(C=l(["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "],["\n      #define discardShadows(castShadows) { if(!castShadows) { gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n    "])))):
q.vertex.code.add(A.glsl(E||(E=l(["\n      #define discardShadows(castShadows) {}\n    "],["\n      #define discardShadows(castShadows) {}\n    "]))));q.vertex.code.add(A.glsl(G||(G=l(["\n    #define SYMBOL_ALPHA_CUTOFF 0.001\n\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c SYMBOL_ALPHA_CUTOFF) {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n\n      forwardPosition();\n      forwardNormal();\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "],
["\n    #define SYMBOL_ALPHA_CUTOFF 0.001\n\n    void main() {\n      bool castShadows;\n      vec4 externalColor \x3d forwardExternalColor(castShadows);\n      discardShadows(castShadows);\n\n      vertexDiscardByOpacity(externalColor.a);\n\n      if (externalColor.a \x3c SYMBOL_ALPHA_CUTOFF) {\n        // Discard this vertex\n        gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\n        return;\n      }\n\n      forwardPosition();\n      forwardNormal();\n      forwardTextureCoordinates();\n      forwardVertexColor();\n      forwardLinearDepth(); // depends on forwardPosition()\n    }\n  "]))));
0===b.output&&(q.include(u.ComputeMaterialColor,b),q.include(x.ComputeShadingNormal,b),q.include(v.EvaluateSceneLighting,b),b.receiveShadows?(q.include(w.ReadShadowMap,b),q.fragment.code.add(A.glsl(J||(J=l(["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "],["\n        float evaluateShadow() {\n          return readShadowMap(vPositionWorldCameraRelative, linearDepth);\n        }\n      "]))))):q.fragment.code.add(A.glsl(I||
(I=l(["\n        float evaluateShadow() { return 0.0; }\n      "],["\n        float evaluateShadow() { return 0.0; }\n      "])))),q.fragment.code.add(A.glsl(K||(K=l(["\n      // ShaderOutput.Color\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        "],
["\n      // ShaderOutput.Color\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        vec4 externalColor;\n        int externalColorMixMode;\n        readExternalColor(externalColor, externalColorMixMode);\n\n        vec4 materialColor \x3d computeMaterialColor(\n          textureColor,\n          externalColor,\n          externalColorMixMode\n        );\n        "])))),
b.usePBR?(q.fragment.code.add(A.glsl(H||(H=l(["\n        applyPBRFactors();\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];;\n      "],["\n        applyPBRFactors();\n        vec3 normalVertex \x3d shadingNormalWorld();\n        float additionalIrradiance \x3d 0.02 * lightingMainIntensity[2];;\n      "])))),q.fragment.code.add(A.glsl(L||(L=l(["\n        if (int(externalColorMixMode) \x3d\x3d 3 /* replace */) {\n          reflectance \x3d 0.2;\n          roughness \x3d 0.6;\n          metalness \x3d 0.0;\n        }\n      "],
["\n        if (int(externalColorMixMode) \x3d\x3d 3 /* replace */) {\n          reflectance \x3d 0.2;\n          roughness \x3d 0.6;\n          metalness \x3d 0.0;\n        }\n      "])))),b.hasNormalTexture?q.fragment.code.add(A.glsl(P||(P=l(["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "],["\n        mat3 tangentSpace \x3d computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);\n        vec3 shadingNormal \x3d computeTextureNormal(tangentSpace, vuv0);\n        "])))):
q.fragment.code.add(A.glsl(S||(S=l(["\n        vec3 shadingNormal \x3d normalVertex;\n        "],["\n        vec3 shadingNormal \x3d normalVertex;\n        "])))),q.fragment.code.add(A.glsl(R||(R=l(["\n        vec3 normalGround \x3d normalize(positionWorld());\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec3 shadedColor \x3d evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, roughness, metalness, emission, reflectance, additionalIrradiance);\n        "],
["\n        vec3 normalGround \x3d normalize(positionWorld());\n        vec3 viewDir \x3d normalize(vPositionWorldCameraRelative);\n        float ssao \x3d 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());\n        vec3 additionalLight \x3d evaluateAdditionalLighting(ssao, positionWorld());\n        vec3 shadedColor \x3d evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, roughness, metalness, emission, reflectance, additionalIrradiance);\n        "]))))):
(b.receiveShadows?q.fragment.code.add(A.glsl(O||(O=l(["\n      float shadow \x3d evaluateShadow();\n        "],["\n      float shadow \x3d evaluateShadow();\n        "])))):0===b.viewingMode?q.fragment.code.add(A.glsl(Q||(Q=l(["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "],["\n      float additionalAmbientScale \x3d _oldHeuristicLighting(positionWorld());\n      float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\n        "])))):
q.fragment.code.add(A.glsl(T||(T=l(["\n      float shadow \x3d 0.0;\n      "],["\n      float shadow \x3d 0.0;\n      "])))),q.fragment.code.add(A.glsl(Y||(Y=l(["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec3 shadedColor \x3d evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight);\n      "],
["\n      float ambientOcclusion \x3d evaluateAmbientOcclusion();\n      // At global scale we create some additional ambient light based on the main light to simulate global illumination\n      vec3 additionalLight \x3d evaluateAdditionalLighting(ambientOcclusion, positionWorld());\n      vec3 shadedColor \x3d evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight);\n      "]))))),q.fragment.code.add(A.glsl(N||(N=l(["\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, materialColor.a), vPositionWorldCameraRelative);\n      }\n    "],
["\n        gl_FragColor \x3d highlightSlice(vec4(shadedColor, materialColor.a), vPositionWorldCameraRelative);\n      }\n    "])))));if(1===b.output||3===b.output)q.include(r.OutputDepth,b),q.fragment.code.add(A.glsl(Z||(Z=l(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputDepth(linearDepth);\n      }\n    "]))));
2===b.output&&(q.include(x.ComputeShadingNormal,b),q.fragment.code.add(A.glsl(W||(W=l(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "],
["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        // note: the alpha component needs to be 1.0 in order for this material\n        // to influence ambient occlusion, see the ssao fragment shader\n        float alpha \x3d ",";\n        gl_FragColor \x3d vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);\n      }\n    "])),2===b.normalType?"0.0":"1.0")));4===
b.output&&(q.include(p.OutputHighlight),q.fragment.code.add(A.glsl(aa||(aa=l(["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputHighlight();\n      }\n    "],["\n      void main() {\n        discardBySlice(vPositionWorldCameraRelative);\n\n        vec4 textureColor \x3d readBaseColorTexture();\n        discardOrAdjustAlpha(textureColor);\n\n        outputHighlight();\n      }\n    "])))));
return q};var C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["require","exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","./DecodeSymbolColor.glsl","../../../../core/shaderModules/interfaces"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.ComponentData=function(b,c){1===c.componentData&&(b.vertex.uniforms.add("uComponentColorTex","sampler2D"),b.vertex.uniforms.add("uComponentColorTexInvDim",
"vec2"),b.attributes.add("componentIndex","float"),b.varyings.add("vExternalColorMixMode","mediump float"),b.varyings.add("vExternalColor","vec4"),b.include(f.DecodeSymbolColor),b.vertex.code.add(h.glsl(a||(a=l(["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "],
["\n      vec4 _readComponentColor() {\n        float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\n        vec2 indexCoord \x3d vec2(\n          mod(normalizedIndex, 1.0),\n          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\n        );\n        return texture2D(uComponentColorTex, indexCoord);\n       }\n\n      vec4 forwardExternalColor(out bool castShadows) {\n        vec4 componentColor \x3d _readComponentColor() * 255.0;\n\n        float shadowFlag \x3d mod(componentColor.b * 255.0, 2.0);\n        componentColor.b -\x3d shadowFlag;\n        castShadows \x3d shadowFlag \x3e\x3d 1.0;\n\n        int decodedColorMixMode;\n        vExternalColor \x3d decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // \x3d 1/255;\n        vExternalColorMixMode \x3d float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\n\n        return vExternalColor;\n      }\n    "])))),
b.fragment.code.add(h.glsl(e||(e=l(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d int(vExternalColorMixMode);\n      }\n    "])))));0===c.componentData&&(b.vertex.uniforms.add("uExternalColor",
"vec4"),b.fragment.uniforms.add("uExternalColorMixMode","int"),b.varyings.add("vExternalColor","vec4"),b.vertex.code.add(h.glsl(d||(d=l(["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "],["\n      vec4 forwardExternalColor(out bool castShadows) {\n        vExternalColor \x3d uExternalColor;\n        castShadows \x3d true;\n        return uExternalColor;\n      }\n    "])))),
b.fragment.code.add(h.glsl(k||(k=l(["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "],["\n      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {\n        externalColor \x3d vExternalColor;\n        externalColorMixMode \x3d uExternalColorMixMode;\n      }\n    "])))))};var a,e,d,k})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["require",
"exports","../../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.VertexDiscardByOpacity=function(b,n){b=b.vertex;b.code.add(f.glsl(h||(h=l(["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "],["\n  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)\n  "]))));switch(n.vertexDiscardMode){case 0:b.code.add(f.glsl(a||(a=l(["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) {}\n      "]))));break;case 2:b.code.add(f.glsl(e||(e=l(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3e  VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))));break;case 1:b.code.add(f.glsl(d||(d=l(["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "],
["\n        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ \x3c\x3d VERTEX_DISCARD_CUTOFF) {  gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0); return; } }\n      "]))))}};var h,a,e,d})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../../core/libs/gl-matrix-2/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a,e,d,k){function n(a,b){a.include(e.PositionAttribute);a.include(d.DoublePrecision,b);a.varyings.add("vPositionWorldCameraRelative","vec3");a.varyings.add("vPosition_view","vec3");a.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");a.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");a.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");a.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");a.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");
a.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS","mat3");a.vertex.uniforms.add("uTransform_ProjFromView","mat4");a.vertex.code.add(k.glsl(c||(c=l(["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n  "],
["\n    // compute position in world space orientation, but relative to the camera position\n    vec3 positionWorldCameraRelative() {\n      vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * positionModel();\n\n      vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n        uTransform_WorldFromModel_TL,\n        uTransform_WorldFromModel_TH,\n        -uTransform_WorldFromView_TL,\n        -uTransform_WorldFromView_TH\n      );\n\n      return transform_CameraRelativeFromModel + rotatedModelPosition;\n    }\n\n    // position in view space, that is relative to the camera position and orientation\n    vec3 position_view() {\n      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();\n    }\n\n    // compute gl_Position and forward related varyings to fragment shader\n    void forwardPosition() {\n      vPositionWorldCameraRelative \x3d positionWorldCameraRelative();\n      vPosition_view \x3d position_view();\n      gl_Position \x3d uTransform_ProjFromView * vec4(vPosition_view, 1.0);\n    }\n  "]))));
a.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");a.fragment.code.add(k.glsl(g||(g=l(["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "],["\n    vec3 positionWorld() {\n      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.VertexPosition=n;(function(b){var c=function(){return function(){this.worldFromModel_RS=f.mat3f64.create();this.worldFromModel_TH=
a.vec3f64.create();this.worldFromModel_TL=a.vec3f64.create()}}();b.ModelTransform=c;c=function(){return function(){this.worldFromView_TH=a.vec3f64.create();this.worldFromView_TL=a.vec3f64.create();this.viewFromCameraRelative_RS=f.mat3f64.create();this.projFromView=h.mat4f64.create()}}();b.ViewProjectionTransform=c;b.bindModelTransform=function(a,b){a.setUniformMatrix3fv("uTransform_WorldFromModel_RS",b.worldFromModel_RS);a.setUniform3fv("uTransform_WorldFromModel_TH",b.worldFromModel_TH);a.setUniform3fv("uTransform_WorldFromModel_TL",
b.worldFromModel_TL)};b.bindViewProjTransform=function(a,b){a.setUniform3fv("uTransform_WorldFromView_TH",b.worldFromView_TH);a.setUniform3fv("uTransform_WorldFromView_TL",b.worldFromView_TL);a.setUniformMatrix4fv("uTransform_ProjFromView",b.projFromView);a.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",b.viewFromCameraRelative_RS)}})(n=b.VertexPosition||(b.VertexPosition={}));var c,g})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/interfaces".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeMaterialColor=function(b,c){b.include(f.VertexColor,c);b.include(h.MixExternalColor,{stages:1});b=b.fragment;b.uniforms.add("uBaseColor","vec4");b.uniforms.add("uObjectOpacity","float");c.attributeColor?b.code.add(a.glsl(e||(e=l(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "],
["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb * vColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a * vColor.a;\n      }\n    "])))):b.code.add(a.glsl(d||(d=l(["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "],["\n      vec3 _baseColor() {\n        // combine the old material parameters into a single one\n        return uBaseColor.rgb;\n      }\n\n      float _baseOpacity() {\n        return uBaseColor.a;\n      }\n    "]))));
b.code.add(a.glsl(k||(k=l(["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "],
["\n    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {\n      vec3 baseColor \x3d _baseColor();\n      float baseOpacity \x3d _baseOpacity();\n\n      vec3 color \x3d mixExternalColor(\n        baseColor,\n        textureColor.rgb,\n        externalColor.rgb,\n        externalColorMixMode\n      );\n      float opacity \x3d uObjectOpacity * mixExternalOpacity(\n        baseOpacity,\n        textureColor.a,\n        externalColor.a,\n        externalColorMixMode\n      );\n\n      return vec4(color, opacity);\n    }\n  "]))))};
var e,d,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ../../shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.ComputeShadingNormal=function(b,t){var q=b.fragment;0===t.doubleSidedMode?q.code.add(a.glsl(e||(e=l(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "],
["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return normal;\n      }\n    "])))):1===t.doubleSidedMode?(b.include(h.VertexPosition,t),q.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),q.code.add(a.glsl(d||(d=l(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        vec3 viewDir \x3d vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;\n        return dot(normal, viewDir) \x3e 0.0 ? -normal : normal;\n      }\n    "]))))):
2===t.doubleSidedMode&&q.code.add(a.glsl(k||(k=l(["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],["\n      vec3 _adjustDoublesided(vec3 normal) {\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))));0===t.normalType||1===t.normalType?(b.include(f.VertexNormal,t),q.code.add(a.glsl(n||(n=l(["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return _adjustDoublesided(normalize(vNormalWorld));\n      }\n\n      vec3 shadingNormal_view() {\n        vec3 normal \x3d normalize(vNormalView);\n        return gl_FrontFacing ? normal : -normal;\n      }\n    "]))))):3===t.normalType?(b.extensions.add("GL_OES_standard_derivatives"),b.include(h.VertexPosition,t),q.code.add(a.glsl(c||(c=l(["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "],
["\n      vec3 shadingNormalWorld() {\n        return normalize(cross(\n          dFdx(vPositionWorldCameraRelative),\n          dFdy(vPositionWorldCameraRelative)\n        ));\n      }\n\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));\n      }\n    "]))))):2===t.normalType&&(0===t.viewingMode?(b.include(h.VertexPosition,t),q.code.add(a.glsl(g||(g=l(["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "],
["\n        vec3 shadingNormalWorld() {\n          return normalize(positionWorld());\n        }\n      "]))))):1===t.viewingMode&&q.code.add(a.glsl(r||(r=l(["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "],["\n        vec3 shadingNormalWorld() {\n          return vec3(0.0, 0.0, 1.0);\n        }\n      "])))),b.extensions.add("GL_OES_standard_derivatives"),q.code.add(a.glsl(p||(p=l(["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "],
["\n      vec3 shadingNormal_view() {\n        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;\n      }\n    "])))))};var e,d,k,n,c,g,r,p})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,
"__esModule",{value:!0});b.ReadBaseColorTexture=function(b,c){var g=b.fragment;c.baseColorTexture?(b.include(f.VertexTextureCoordinates,c),g.uniforms.add("uBaseColorTexture","sampler2D"),g.uniforms.add("uBaseColorTextureSize","vec2"),2===c.attributeTextureCoordinates?(b.include(h.TextureAtlasLookup),g.code.add(a.glsl(e||(e=l(["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "],
["\n        vec4 readBaseColorTexture() {\n          return textureAtlasLookup(\n            uBaseColorTexture,\n            uBaseColorTextureSize,\n            vuv0,\n            vuvRegion\n          );\n        }\n      "]))))):g.code.add(a.glsl(d||(d=l(["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "],["\n        vec4 readBaseColorTexture() {\n          return texture2D(uBaseColorTexture, vuv0);\n        }\n      "]))))):g.code.add(a.glsl(k||
(k=l(["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "],["\n      vec4 readBaseColorTexture() { return vec4(1.0); }\n    "]))))};var e,d,k})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this._dirty=!0}b.prototype._setDirty=function(){this._dirty=!0};b.prototype._setClean=function(){this._dirty=!1;for(var b=0,h=this.__proto__.__parameterBlocks||
[];b<h.length;b++)this[h[b]]._setClean()};Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty||this._checkParameterBlocksDirty()},enumerable:!0,configurable:!0});b.prototype._checkParameterBlocksDirty=function(){for(var b=0,h=this.__proto__.__parameterBlocks||[];b<h.length;b++)if(this[h[b]].dirty)return!0;return!1};return b}();b.MaterialBase=q;q=function(){function b(){this._dirty=!0}b.prototype._setDirty=function(){this._dirty=!0};b.prototype._setClean=function(){this._dirty=
!1};Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});return b}();b.MaterialParameterBlock=q;b.parameter=function(b){void 0===b&&(b={});return function(f,h){f.__materialParameters=f.__materialParameters||[];f.__materialParameters.push(h);var a="_"+h;if(b.vectorOps){var e=b.vectorOps;Object.defineProperty(f,h,{get:function(){return this[a]},set:function(b){if(this[a]){if(e.equals(this[a],b))return;e.copy(this[a],b)}else this[a]=b;this._setDirty()}})}else Object.defineProperty(f,
h,{get:function(){return this[a]},set:function(d){this[a]!==d&&(b.dispose&&this[a]&&this[a].dispose(),this[a]=d,this._setDirty())}})}};b.parameterBlock=function(){return function(b,f){b.__parameterBlocks=b.__parameterBlocks||[];b.__parameterBlocks.push(f);var h="_"+f;Object.defineProperty(b,f,{get:function(){return this[h]},set:function(a){this[h]!==a&&(this[h]=a,this._setDirty())}})}}})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper",
"../../lib/AutoDisposable"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}l(b,a);Object.defineProperty(b.prototype,"bucketKey",{get:function(){return this._bucket.key},enumerable:!0,configurable:!0});return b}(f.AutoDisposable);b.BucketStorable=q;q=function(){function a(){this._buckets=new Map;this._count=0}a.prototype.add=function(a,b){a=this._getBucket(a);b._bucket=a;b._bucketIndex=a.count;a._data.push(b);
this._count++};a.prototype.remove=function(a){var b=a._bucket._data,e=b[b.length-1];b[a._bucketIndex]=e;e._bucketIndex=a._bucketIndex;b.pop();this._count--};a.prototype.updateKey=function(a,b){this.remove(a);this.add(b,a)};a.prototype.getBucket=function(a){return this._getBucket(a).data};a.prototype.forEach=function(a){this._buckets.forEach(function(b){a(b.data,b.key)})};Object.defineProperty(a.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});a.prototype._getBucket=
function(a){var b=this._buckets.get(a);if(b)return b;b=new h(a);this._buckets.set(a,b);return b};return a}();b.BucketedObjectStore=q;var h=function(){function a(a){this.key=a;this._data=[]}Object.defineProperty(a.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this._data.length},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/vec3","../../../../../core/libs/gl-matrix-2/vec3f32","../../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this._low=f.vec3f32.create();this._high=f.vec3f32.create();a&&this.set(a)}Object.defineProperty(b.prototype,"low",{get:function(){return this._low},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"high",{get:function(){return this._high},
enumerable:!0,configurable:!0});b.prototype.set=function(a){var b=this._low,d=this._high;l.vec3.copy(b,a);l.vec3.sub(d,a,b)};b.prototype.setElements=function(b,e,f){l.vec3.set(a,b,e,f);this.set(a)};b.prototype.get=function(a){return l.vec3.add(a,this._low,this._high)};b.prototype.getLowScaled=function(a){return l.vec3.scale(a,this._low,1)};return b}();b.TwoVectorPosition=q;var a=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports",
"./ManagedTextureBackedBuffer"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,a){void 0===a&&(a=1);this.rctx=b;this.fieldCount=a;this.buffers=[]}b.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(b){return 0===b.activeCount?(b.dispose(),!1):!0})};b.prototype.getBuffer=function(b){for(var a=0,e=this.buffers;a<e.length;a++){var d=e[a];if(d.availableCount>=b)return d}if(b>l.MAX_INDEX_COUNT)return null;b=new l.ManagedTextureBackedBuffer(this.rctx,
this.fieldCount);this.buffers.push(b);return b};b.prototype.updateTextures=function(){for(var b=0,a=this.buffers;b<a.length;b++)a[b].textureBuffer.updateTexture()};return b}();b.BufferManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.MAX_INDEX_COUNT=65536;q=function(){function h(a,e){void 0===e&&(e=1);
this.textureBuffer=new f.TextureBackedBuffer(a,e);this.indexManager=new l.SimpleIndexManager(b.MAX_INDEX_COUNT)}h.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(h.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});h.prototype.acquireIndex=function(){var a=
this.indexManager.acquire();this.textureBuffer.resizeToFit(a);return a};h.prototype.releaseIndex=function(a){this.indexManager.release(a)};return h}();b.ManagedTextureBackedBuffer=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.maxCount=b;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(b.prototype,"activeCount",{get:function(){return this._nextIndex-
this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});b.prototype.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};b.prototype.release=function(b){this.recycledIndices.push(b)};return b}();b.SimpleIndexManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require",
"exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.textureWidth=4096;this.dirty=!0;this.texture=new f(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new l.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}b.prototype.dispose=function(){this.texture.dispose();
this.data=this.texture=void 0};b.prototype.setData=function(a,b,d,f,h,c){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,0,d);this.data.set(a,1,f);this.data.set(a,2,h);this.data.set(a,3,c)};b.prototype.setDataElement=function(a,b,d,f){a=a*this.fieldCount+b;this.dirty=!0;this.data.set(a,d,f)};b.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new l.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),
this.data=a)};b.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};b.prototype.bind=function(a,b){this.rctx.bindTexture(this.texture,b.unit);a.setUniform1i(b.texName,b.unit);a.setUniform2f(b.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return b}();b.TextureBackedBuffer=q})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("require exports ../../../../../core/maybe ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../support/geometryUtils ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c){this._renderView=a;this.rctx=b;this.shaderTechniqueRepository=c;this.canRender=!0;this._materialPassParams=new g.MaterialPassesParameters;this._shadowPassParams=new g.ShadowMapPassParameters;this._highlightPassParams=new g.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new r.RenderPass(b,this.shaderTechniqueRepository));this.passes=
{materialOpaque:this._registerPass(new r.RenderPass(b,this.shaderTechniqueRepository)),materialTransparent:this._registerPass(new r.RenderPass(b,this.shaderTechniqueRepository)),materialIntegratedMesh:this._registerPass(new r.RenderPass(b,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new r.RenderPass(b,this.shaderTechniqueRepository))}}b.prototype.register=function(a){this._systems.add(a)};b.prototype.prepareRender=function(){var a=this;this._passes.forEach(function(a){return a.prepareSubmit()});
var b={camera:this._renderView.getCamera()};this._systems.forEach(function(c){c.submit(a.passes,b)});this._passes.forEach(function(a){return a.finishSubmit()});this.shaderTechniqueRepository.frameUpdate()};b.prototype.render=function(a){if(5===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialOpaque.dispatch(this._materialPassParams);
break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 4:this.passes.highlight.dispatch(this._highlightPassParams);break;case 3:this._shadowMapPass.dispatch(this._shadowPassParams)}if(7===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialTransparent.dispatch(this._materialPassParams);
break;case 2:this._materialPassParams.subPass=2,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(2===a.slot)switch(this._configure(a),a.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(a);this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2,this.passes.materialIntegratedMesh.dispatch(this._materialPassParams)}return!0};
b.prototype.notifyDirty=function(){this._renderView.setNeedsRender()};b.prototype.slots=function(){return[5,7,2]};b.prototype.initializeRenderContext=function(){};b.prototype.uninitializeRenderContext=function(){};b.prototype.queryDepthRange=function(a){var b={near:Infinity,far:-Infinity};this._systems.forEach(function(c){c=c.queryShadowCasterDepthRange(a);l.isSome(c)&&u.union(b,c,b)});return b};Object.defineProperty(b.prototype,"shadowCastingEnabled",{get:function(){return l.isSome(this.passes.shadowMap)},
set:function(a){a?(this._materialPassParams.shadowsEnabled=!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)},enumerable:!0,configurable:!0});b.prototype._configureMaterialColorPass=function(a){var b=this;this._materialPassParams.shadowMap={bind:function(c){a.shadowMap.bind(c);var e=b._materialPassParams.viewTransform;d.vec3.add(t,e.worldFromView_TL,e.worldFromView_TH);a.shadowMap.bindView(c,t)}};this._materialPassParams.ambientOcclusion=
{bind:function(b){a.ssaoHelper.setUniforms(b)}};this._materialPassParams.ambientOcclusionEnabled=a.ssaoHelper.enabled};b.prototype._configure=function(a){this._updateParameters(a,3===a.pass?this._shadowPassParams:4===a.pass?this._highlightPassParams:this._materialPassParams)};b.prototype._updateParameters=function(b,g){var k=b.camera,h=k.viewInverseTransposeMatrix;d.vec3.set(t,h[3],h[7],h[11]);v.set(t);d.vec3.copy(g.viewTransform.worldFromView_TH,v.high);d.vec3.copy(g.viewTransform.worldFromView_TL,
v.low);f.mat3.fromMat4(g.viewTransform.viewFromCameraRelative_RS,k.viewMatrix);a.mat4.copy(g.viewTransform.projFromView,k.projectionMatrix);0===g.identifier?(this._materialPassParams.transparent=7===b.slot,this._materialPassParams.integratedMesh=2===b.slot,this._materialPassParams.lighting=b.scenelightingData,f.mat3.transpose(x,g.viewTransform.viewFromCameraRelative_RS),f.mat3.invert(g.transformNormal_ViewFromGlobal,x),e.vec2.set(g.cameraNearFar,k.near,k.far)):1===g.identifier?e.vec2.set(g.cameraNearFar,
k.near,k.far):2===g.identifier&&(g.highlightDepthTexture=b.highlightDepthTexture,n.vec4.copy(g.viewport,k.viewport));c.boundedPlane.copy(b.sliceHelper.plane,g.slicePlane);d.vec3.subtract(g.slicePlane.origin,g.slicePlane.origin,t);g.slicePlaneEnabled=b.sliceHelper.isEnabled};b.prototype._registerPass=function(a){this._passes.push(a);return a};Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return 0<this.passes.highlight.count},enumerable:!0,configurable:!0});return b}();b.RenderPassManager=
q;var t=k.vec3f64.create(),x=h.mat3f64.create(),v=new p.TwoVectorPosition})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(){this.identifier=
0;this.integratedMesh=this.transparent=!1;this.viewTransform=new e.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=l.mat3f64.create();this.cameraNearFar=f.vec2f64.create();this.slicePlane=a.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0}}();b.MaterialPassesParameters=q;q=function(){return function(){this.identifier=1;this.viewTransform=new e.VertexPosition.ViewProjectionTransform;this.cameraNearFar=f.vec2f64.create();this.slicePlane=
a.boundedPlane.create()}}();b.ShadowMapPassParameters=q;q=function(){return function(){this.identifier=2;this.viewTransform=new e.VertexPosition.ViewProjectionTransform;this.slicePlane=a.boundedPlane.create();this.viewport=h.vec4f64.create()}}();b.HighlightPassParameters=q})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["require","exports","../../../../../core/PooledArray"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b){this._rctx=
a;this._techniqueRepository=b;this._draws=new l({initialSize:32,allocator:function(a){return a||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}b.prototype.submitDraw=function(a,b,d,f,h){var c=this._draws.pushNew();c.geometry=b;c.geometryRanges=d;c.material=a;c.bindDrawParams=f;c.depthSquaredHint=h;c.indexType=b.indexed?b.vao.indexBuffer.indexType:
0};b.prototype.dispatch=function(a){var b=this._rctx;this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();for(var d=null,k={repository:this._techniqueRepository},h=this._draws.length,c=0;c<h;c++){var g=this._draws.data[c],l=g.geometry,p=g.material.getTechnique(k,a,l.parameters);this._passBoundTechniques.has(p)||(p.bindPass(b,a),this._passBoundTechniques.add(p));b.bindVAO(l.vao);p!==d&&(b.bindProgram(p.program),b.setPipelineState(p.pipeline),d=
p);this._previouslyBoundMaterials.get(p)!==g.material&&(p.bindMaterial(b,g.material),this._previouslyBoundMaterials.set(p,g.material));this._previouslyBoundDraw.get(p)!==g.bindDrawParams&&(p.bindDraw(g.bindDrawParams),this._previouslyBoundMaterials.set(p,g.material));if(0!==g.indexType)for(var p=f.get(g.indexType),q=0;q<g.geometryRanges.length;q+=2){var t=g.geometryRanges[q],x=g.geometryRanges[q+1];b.drawElements(l.primitiveType,x,g.indexType,t*p)}else for(q=0;q<g.geometryRanges.length;q+=2)t=g.geometryRanges[q],
x=g.geometryRanges[q+1],b.drawArrays(l.primitiveType,t,x)}};b.prototype.prepareSubmit=function(){this._draws.clear()};b.prototype.finishSubmit=function(){this._draws.sort(function(a,b){return a.depthSquaredHint-b.depthSquaredHint})};Object.defineProperty(b.prototype,"count",{get:function(){return this._draws.length},enumerable:!0,configurable:!0});return b}();b.RenderPass=q;var f=new Map;f.set(5121,1);f.set(5123,2);f.set(5125,4)})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require",
"exports","../core/shaderTechnique/CommonUniformStore","../../../webgl/programUtils"],function(q,b,l,f){return function(){function b(a,b){void 0===b&&(b="");this._rctx=a;this._shaderPrefix=b;this._programCacheByTemplate=new Map;this._commonUniformStore=new l.CommonUniformStore;this._programRefCount=[]}Object.defineProperty(b.prototype,"context",{get:function(){return this._rctx},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});
this._programRefCount=this._programCacheByTemplate=null;this._commonUniformStore.dispose();this._rctx=null};b.prototype.getProgram=function(a,b){var d=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(b){return f.createProgram(d._rctx,a,b,d._shaderPrefix)});return this.getProgramTemplateInstance(a,b)};b.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};b.prototype.getProgramTemplateInstance=function(a,b){if(a=
this._programCacheByTemplate.get(a)){var d=b?JSON.stringify(b):"default";a.programs.has(d)||(b=a.constructor(b),a.programs.set(d,b));return a.programs.get(d)}return null};b.prototype.getProgramsUsingUniform=function(a){return this._commonUniformStore.getPrograms(a)};b.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._commonUniformStore.subscribeProgram(a))};b.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?
this._programRefCount[b]--:(this._commonUniformStore.unsubscribeProgram(a),this._programRefCount[b]=0)};return b}()})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ../core/shaderLibrary/hud/HUD.glsl ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./glUtil3D ./HighlightHelper ./OffscreenRenderingHelper ./RenderContext ./rendererUtils ./RenderPluginManager ./renderStats ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../materials/internal/waterMaterialUtils ../../../webgl/Profiling".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H){function L(a,b){return a.isVisible()&&a.isVisibleInPass(b.pass)&&0!==(a.renderOccluded&b.renderOccludedMask)}q=function(){function b(a,b,c,d,f,g,h){var n=this;this._programRep=a;this._materialRep=b;this._rctx=f;this.requestRender=g;this._stage=h;this._materialRenderers=new Map;this._hasHighlights=!1;this._lighting=new J.SceneLighting;this._content=new Map;this._isRendering=!1;this._fallbackDepthStencilTexture=null;this._stats=new w.RenderStatsAggregator;
this._edgeView=null;this._handles=new l;this.renderOptions={antialiasing:"smaa"};this.renderHiddenTransparentEdges=function(){};this._shaderTechniqueRepository=d;this._fxaaPass=new p(this._rctx);this._smaaPass=new C(this._rctx);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._offscreenRendering=new x(this._programRep,this._rctx);this._sliceHelper=new B;this._shadowMap=
new A(this._rctx);this._ssaoHelper=new E(d,this._rctx,function(){return n.requestRender()});this._highlightHelper=new t(d,this._rctx);this._renderPlugins=new m.RenderPluginManager({rctx:this._rctx,programRep:this._programRep,shaderTechniqueRep:d,textureRep:c,materialRep:this._materialRep,requestRender:this.requestRender});this._renderContext=new v(this._rctx,this._offscreenRendering,this._lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._handles.add(e.init(k,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",
function(a){n.renderHiddenTransparentEdges=a?function(){return n.renderEdges(1)}:function(){};n.requestRender()}))}b.prototype.dispose=function(){this._handles.destroy();this._materialRenderers.forEach(function(a){a.dispose()});this._materialRenderers=null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=
!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);c.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(b.prototype,"updating",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources||K.waterTextureRepo.loading()},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&
(this._edgeView=new G.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:function(){return a.requestRender()}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});b.prototype.setLighting=function(a){this._lighting.set(a)};b.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);
void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&
(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this.requestRender()};Object.defineProperty(b.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,
configurable:!0});b.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(b.prototype,
"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"canRender",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.getStats=function(){return this._stats.getAggregatedStats()};b.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();
case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture}return null};b.prototype.isEmpty=function(){return 0===this._materialRenderers.size};b.prototype.modify=function(a,b,c,d,e,g){var k=this;void 0===b&&(b=a?a.length:0);void 0===d&&(d=c?c.length:0);void 0===g&&(g=e?e.length:0);this._isRendering&&console.warn("Renderer.modify called while rendering");for(var h=
0;h<d;++h)this._content.delete(c[h].uniqueName);for(h=0;h<b;++h)this._content.set(a[h].uniqueName,a[h]);if(b||d||g){var m=!1;y.splitRenderGeometryChangeSetByMaterial({toAdd:a,numToAdd:b,toRemove:c,numToRemove:d,toUpdate:e,numToUpdate:g}).forEach(function(a,b){var c=k._materialRenderers.get(b);!c&&0<a.toAdd.length&&(c=b.createRenderer(k._rctx,k._materialRep),k._materialRenderers.set(b,c));c&&(c.modify(a),c.isEmpty&&(m=!0))});m&&this._materialRenderers.forEach(function(a,b){a.isEmpty&&(k._materialRenderers.delete(b),
a.dispose())});this._hasHighlights=f.someMap(this._materialRenderers,function(a){return a.hasHighlights});this.requestRender()}};b.prototype.updateLogic=function(a){var b=!1;this._materialRenderers.forEach(function(c){c.updateLogic&&(b=c.updateLogic(a)||b)});return b};b.prototype.render=function(a){this.renderScene(a);if(this.onPostRender)this.onPostRender()};b.prototype.renderScene=function(a){var b=this;this._isRendering=!0;var c=this._rctx,d=this._offscreenRendering,e=a.camera,f=a.fbo,g=this._sliceHelper.plane;
a.disableSlice&&(this._sliceHelper.plane=null);this._renderPlugins.prepareRender(e);this.renderShadowMap(a);d.enabled=!0;d.initializeFrame(e,f);this.renderLinearDepth(a);this.renderNormal(a);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(e,d.linearDepthTexture,d.normalTexture);this._ssaoHelper.bindToAllPrograms(this._programRep);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this._stats.reset();this.updateGlobalUniforms(e.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=
e;this._renderContext.options=this.renderOptions;d.bindTarget(d.mainColor,d.mainDepth);this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.renderEdges(2);this.renderHiddenTransparentEdges();this.renderTransparentGeometry(this._renderContext);this.renderEdges(1);var k=e=!1,e=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(17,this._renderContext);(k=this.renderTransparentTerrain(this._renderContext))&&e&&(d.compositeTransparentTerrainOntoHUDVisibility(),
d.renderToTargets(function(){return b.renderHUD(n.HUD.TransparentRenderStyle.OCCLUDED)},d.mainColor,d.tmpDepth,void 0,!0));k&&d.compositeTransparentTerrainOntoMain();d.renderToTargets(function(){b.renderInternalSlot(9,b._renderContext);b._renderPlugins.render(13,b._renderContext);b._renderPlugins.render(14,b._renderContext)},d.mainColor,d.mainDepth);this.renderOccluded();this.renderAntiAliasing(f);c.bindFramebuffer(f);c.clearSafe(256);this.renderHUD(n.HUD.TransparentRenderStyle.NOTOCCLUDED);this.renderHighlights(a,
f);this._sliceHelper.plane=g;this._isRendering=!1};b.prototype.renderEdges=function(a){var b=this,c=this._edgeView;c&&c.shouldRender()&&this._offscreenRendering.renderAndComposite(function(){return c.render(b._bindParameters,a)},"alpha")};b.prototype.renderShadowMap=function(b){var c=this._shadowMap;if(c.enabled){k.ENABLE_PROFILE_DEPTH_RANGE&&a.begin("depthRange");var d=b.camera,e=b.fbo,f=b.lightDirection,g=this.computeDepthRange(d);k.ENABLE_PROFILE_DEPTH_RANGE&&a.end("depthRange");c.prepare(d,f,
g);f=c.getCascades();for(g=0;g<f.length;++g){var h=f[g];h.camera.setGLViewport(this._rctx);b.camera=h.camera;this.renderGeometryPass(3,b)}b.camera=d;c.finish(e);d.setGLViewport(this._rctx)}c.bindToAllPrograms(this._programRep);c.bindToAllPrograms(this._shaderTechniqueRepository)};b.prototype.renderLinearDepth=function(a){var b=this;this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?this._offscreenRendering.renderToTargets(function(){return b.renderGeometryPass(1,a)},this._offscreenRendering.linearDepth,
this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};b.prototype.renderNormal=function(a){var b=this;this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(function(){b.renderGeometryPass(2,a)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};b.prototype.computeDepthRange=function(a){var b=r.depthRangeFromScene(a,
this._content,this._stage.getLayers());g.union(b,this.renderPlugins.queryDepthRange(a));b.near=Math.max(a.near,b.near);b.far=Math.min(a.far,b.far);return b};b.prototype.renderGeometryPass=function(a,b){this._isRendering=!0;b=b.camera;this.updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this.renderGeometryPassScene(this._renderContext);this._isRendering=!1};b.prototype.renderGeometryPassScene=function(a){this.renderGeometry(a);this.renderTransparentTerrain(a)};
b.prototype.renderGeometry=function(a){this.renderOpaqueGeometry(a);this.renderTransparentGeometry(a)};b.prototype.renderOpaqueGeometry=function(a){this._renderPlugins.render(1,a);this._renderPlugins.render(2,a);this._renderPlugins.render(3,a);this.renderInternalSlot(4,a);this._renderPlugins.render(5,a);a.ssaoHelper&&(a.ssaoHelper.bindToAllPrograms(this._programRep),a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository));this._renderPlugins.render(12,this._renderContext)};b.prototype.renderTransparentGeometry=
function(a){this.renderInternalSlot(6,a);this._renderPlugins.render(7,a);a.ssaoHelper&&(a.ssaoHelper.bindToAllPrograms(this._programRep),a.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository))};b.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(8,a)};b.prototype.renderHUDVisibility=function(a){var b=this,c=I.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=
b.renderInternalSlot(10,a)});return e};b.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(15,this._renderContext);this.renderInternalSlot(16,this._renderContext)};b.prototype.renderHighlights=function(a,b){var c=this,d=this._highlightHelper;if(d&&d.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight())){var e=null;d.profilingCallback&&(e=H.startMeasurement(this._renderContext.rctx));
var f=this._offscreenRendering;this._renderContext.highlightDepthTexture=this._bindParameters.highlightDepthTexture;f=f.renderToTargets(function(){c.renderGeometryPass(4,a);c._rctx.clearSafe(256);c.renderHUD(n.HUD.TransparentRenderStyle.BOTH)},f.highlight,f.tmpDepth,[0,0,0,0],!0);d.render(a.camera,f,b);null!==e&&d.profilingCallback&&e.stop(function(a){d.profilingCallback&&d.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};b.prototype.renderOccluded=
function(){var a=this;this._materialRenderers.forEach(function(a,b){b&&b.isVisible()&&1!==b.renderOccluded&&S.push(b)});if(0!==S.length){var b=this._offscreenRendering,c=this._renderContext,d=function(d,e){c.renderOccludedMask=e;b.renderToTargets(function(){a.renderInternalSlot(4,c,S);a.renderInternalSlot(6,c,S);a.renderInternalSlot(9,c,S)},b.tmpColor,b.tmpDepth,[0,0,0,0],!0);c.resetRenderOccludedMask();b.compositeOccludedOntoMain(d)};c.pass=0;d(.4,4);d(.5,2);d(1,8);S.length=0}};b.prototype.renderAntiAliasing=
function(a){var b=this;switch(this.renderOptions.antialiasing){case "smaa":this._smaaPass.loadResources(function(){return b.requestRender()});this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();break;case "fxaa":this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:this._offscreenRendering.colorTexture},a)):this._offscreenRendering.composite();break;default:this._offscreenRendering.composite(),
this._fxaaPass.disable(),this._smaaPass.disable()}};b.prototype.renderInternalSlot=function(a,b,c){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;P[0]=b.camera.near;P[1]=b.camera.far;var d=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=P;this._bindParameters.viewport=
b.camera.fullViewport;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.camera.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=d?d.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=d&&d.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,
b,c)};b.prototype.renderInternalSlotMaterials=function(a,b,c){var d=this,e=0===b.pass?this._stats:null,f=!1;h.isSome(c)?c.forEach(function(c){L(c,b)&&(c=d._materialRenderers.get(c),h.isSome(c)&&(f=c.render(a,b,d._bindParameters)||f))}):this._materialRenderers.forEach(function(c,g){L(g,b)&&(g=e?e.getMaterialRenderStatsObject(c.type):null,f=c.render(a,b,d._bindParameters,g)||f)});return f};b.prototype.updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<
b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting)for(b=this._programRep.getProgramsUsingUniform("lightingMainDirection"),c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._shaderTechniqueRepository.getProgramsUsingUniform("proj");for(c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting)for(b=this._shaderTechniqueRepository.getProgramsUsingUniform("lightingMainDirection"),c=0;c<b.length;c++)this._lighting.setUniforms(b[c])};b.prototype.getFallbackDepthTexture=
function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=u.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};return b}();
var P=d.vec2f64.create(),S=[];return q})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(q,b){q=function(){function b(b,h){void 0===h&&(h=.9);this._alpha=.9;this._name=b;this._alpha=h;this.reset()}b.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this._count},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.begin=
function(){this._startTime=performance.now()};b.prototype.end=function(){var b=performance.now()-this._startTime;this._count+=1;this._sum+=b;this._smooth=this._alpha*b+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,b);this._max=Math.max(this._max,b)};b.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return b}();(function(b){function f(d){d in a||(a[d]=new b(d));return a[d]}function h(a){console.log(f(a).toJSON())}
var a={},e={};b.get=f;b.begin=function(a){f(a).begin()};b.end=function(a,b){void 0===b&&(b=!0);f(a).end();var d=performance.now();!b||a in e&&!(d>=e[a]+1E3)||(h(a),e[a]=d)};b.log=h;b.logAll=function(){for(var b in a)h(b)}})(q||(q={}));return q})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){function u(a,b){if(b.isVisible){var c=r.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?t(c,a,b.getSpatialQueryAccelerator()):x(c,a,d);return c}}function t(a,b,c){var d=b.eye,e=b.viewForward,f=b.frustum,g=function(a){return!a.areAllComponentsHidden()},k=c.objectCount;500>k?(r.set(E,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(d,e,"front-to-back",E,function(c,d){v(a,b,c);E.far=a.near;d.setRange(E)},f,g),r.set(E,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(d,
e,"back-to-front",E,function(c,d){v(a,b,c);E.near=a.far;d.setRange(E)},f,g)):(k=Math.max(Math.min(k,500),Math.ceil(.1*k)),d=c.findClosest(e,"front-to-back",f,g,k),c=c.findClosest(e,"back-to-front",f,g,k),d&&c&&(m(a,b,d.getCenter(),d.getBSRadius()),m(a,b,c.getCenter(),c.getBSRadius())))}function x(a,b,c){G.clear();c.forEach(function(a){a.areAllComponentsHidden()||G.add(a)});G.empty||(G.sort(b),r.set(E,b.near,Math.min(a.near,b.far)),G.forEachInDepthRange(E,"front-to-back",function(c,d){d<a.near&&v(a,
b,c)}),r.set(E,Math.max(a.far,b.near),b.far),G.forEachInDepthRange(E,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function v(a,b,d){if(!d.areAllComponentsHidden()&&n.frustum.intersectsSphere(b.frustum.planes,n.sphere.wrap(d.getBSRadius(),d.getCenter()))){var e=d.objectTransformation,g=C;d.geometryRecords.forEach(function(d){f.mat4.multiply(g,e,d.getShaderTransformation());var k=c.maxScale(g);y(a,b,d.geometry.boundingInfo,g,k)})}}function y(b,c,d,e,f){var g=c.eye,k=c.viewForward;a.vec3.transformMat4(B,
d.center,e);g=k[0]*(B[0]-g[0])+k[1]*(B[1]-g[1])+k[2]*(B[2]-g[2]);k=d.bsRadius*f;if(!(g-k>b.near&&g+k<b.far)&&n.frustum.intersectsSphere(c.frustum.planes,n.sphere.wrap(k,B)))if(100<d.bsRadius&&d.getChildren())for(d=d.getChildren(),g=0;8>g;++g)d[g]&&y(b,c,d[g],e,f);else I.unionDepthRangeWithAABB(b,c.viewProjectionMatrix,e,d.bbMin,d.bbMax)}function m(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(b,
"__esModule",{value:!0});b.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return J.compute(a,b);var d=r.empty();c.forEach(function(b){b.isVisible&&r.union(d,u(a,b))});return d};b.depthRangeFromLayer=u;q=function(){function a(){this._items=new l({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-
b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var w=function(){function b(){this.view=h.mat4f64.create();this.viewProj=h.mat4f64.create();this.frustum=n.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=
[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}b.prototype.compute=function(a,b){var c=this;this.reset();f.mat4.copy(this.view,a.viewMatrix);f.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);n.frustum.copy(a.frustum,this.frustum);a=this.view;var d=a[2],e=a[6],k=a[10],h=a[14];a=this.range;var m=0;b.forEach(function(a){if(!g.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,f;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),
1,B),f=B):(b=a.bsRadius,f=a.center);f=d*f[0]+e*f[1]+k*f[2]+h;c.geometries[m]=a;c.near[m]=-(f+b);c.far[m]=-(f-b);++m}});if(0===this.geometries.length)return a;for(b=0;b<this.geometries.length;++b)this.near[b]>a.far&&(a.far=this.near[b]),2<this.near[b]&&this.far[b]<a.near&&(a.near=this.far[b]);var l=this.looseRange;l.near=Math.max(.5*a.near,2);l.far=2*a.far;var p=0,r=0;for(b=0;b<this.geometries.length;++b)this.near[b]<a.near&&(this.near[b]>=l.near?a.near=this.near[b]:this.nearCandidates[p++]=b),this.far[b]>
a.far&&(this.far[b]<=l.far?a.far=this.far[b]:this.farCandidates[r++]=b);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,b){return c.near[a]<c.near[b]?-1:c.near[a]>c.near[b]?1:0});this.farCandidates.sort(function(a,b){return c.far[a]<c.far[b]?1:c.far[a]>c.far[b]?-1:0});for(b=0;b<this.nearCandidates.length;++b)l=this.nearCandidates[b],this.near[l]<a.near&&(l=this.geometries[l],p=l.boundingInfo,this.includeNearBoundingInfoRec(p,l.getShaderTransformation()));
for(b=0;b<this.farCandidates.length;++b)l=this.farCandidates[b],this.far[l]>a.far&&(l=this.geometries[l],p=l.boundingInfo,this.includeFarBoundingInfoRec(p,l.getShaderTransformation()));return a};b.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};b.prototype.includeNearBoundingInfoRec=function(b,d){var e=b.getBSRadius(),f=b.getCenter();
a.vec3.transformMat4(B,f,d);var g=c.maxScale(d),f=B[0],k=B[1],h=B[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*k+g[0][2]*h+g[0][3]>e||g[1][0]*f+g[1][1]*k+g[1][2]*h+g[1][3]>e||g[2][0]*f+g[2][1]*k+g[2][2]*h+g[2][3]>e||g[3][0]*f+g[3][1]*k+g[3][2]*h+g[3][3]>e||(f=this.view[2]*f+this.view[6]*k+this.view[10]*h+this.view[14],k=f+e,2>-(f-e)||-k>=this.range.near)))if(-k>this.looseRange.near)this.range.near=-k;else{if(100<e&&(e=b.getChildren(),void 0!==e)){for(b=0;8>b;++b)void 0!==e[b]&&this.includeNearBoundingInfoRec(e[b],
d);return}I.unionDepthRangeWithAABB(this.range,this.viewProj,d,b.getBBMin(),b.getBBMax())}};b.prototype.includeFarBoundingInfoRec=function(b,d){var e=b.getBSRadius(),f=b.getCenter();a.vec3.transformMat4(B,f,d);var g=c.maxScale(d),f=B[0],k=B[1],h=B[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*k+g[0][2]*h+g[0][3]>e||g[1][0]*f+g[1][1]*k+g[1][2]*h+g[1][3]>e||g[2][0]*f+g[2][1]*k+g[2][2]*h+g[2][3]>e||g[3][0]*f+g[3][1]*k+g[3][2]*h+g[3][3]>e||(f=this.view[2]*f+this.view[6]*k+this.view[10]*h+this.view[14]-
e,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<e&&(e=b.getChildren(),void 0!==e)){for(b=0;8>b;++b)void 0!==e[b]&&this.includeFarBoundingInfoRec(e[b],d);return}I.unionDepthRangeWithAABB(this.range,this.viewProj,d,b.getBBMin(),b.getBBMax())}};return b}();b.DepthRangeFromRenderGeometries=w;b=function(){function a(){this.modelViewProj=h.mat4f64.create();this.clipPosition=[k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),k.vec4f64.create(),
k.vec4f64.create(),k.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,b,c,d,e){var g=this.modelViewProj;f.mat4.multiply(g,b,c);b=!1;for(c=0;8>c;++c){var k=this.clipPosition[c],h=0===c||3===c||4===c||7===c?d[0]:e[0],m=0===c||1===c||4===c||5===c?d[1]:e[1],l=4>c?d[2]:e[2];k[0]=g[0]*h+g[4]*m+g[8]*l+g[12];k[1]=g[1]*h+g[5]*m+g[9]*l+g[13];k[2]=g[2]*h+g[6]*m+g[10]*l+g[14];k[3]=g[3]*h+g[7]*m+g[11]*l+g[15]}for(c=0;12>c;++c){d=this.clipTriangle(this.clipPosition[A[c][0]],this.clipPosition[A[c][1]],
this.clipPosition[A[c][2]]);e=!0;for(g=0;g<d.length;++g)if(k=d[g][3],2<=k){e=!1;break}if(!e)for(b=!0,g=0;g<d.length;++g)k=d[g][3],k<a.near&&(a.near=k),k>a.far&&(a.far=k)}return b};a.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];p.assert(!1)};a.prototype.intersect=function(a,b,c){var e=0;0===c?e=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===c?e=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===c?e=(a[3]-a[0])/(b[0]-a[0]-b[3]+
a[3]):3===c&&(e=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return d.vec4.lerp(k.vec4f64.create(),a,b,e)};a.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,b)&&a.push(this.intersect(e,f,b))}}return a};return a}();var A=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],B=e.vec3f64.create(),
C=h.mat4f64.create(),E=r.empty(),G=new q,J=new w,I=new b})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../../core/maybe ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(q,b,l,f,h,a,e){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=
a}b.prototype.enable=function(){if(this.isEnabled)return!0;var b=this.rctx;this.program=new h(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=a.makePipelineState({colorWrite:a.defaultColorWriteParams});var d=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new e(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new f(b,34962,35044,d)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(b);var d=0,e=0;l.isSome(b)?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/d,1/e);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightTechnique ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){return function(){function b(a,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=h.vec4f64.create();this.defaultOptions={color:f.vec4f32.fromValues(1,0,1,1),haloColor:f.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};b=new c.HighlightCompositionTechniqueConfiguration;
b.highlightStage=0;b.gridOptimization=!1;this.blurTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.blurTechnique);b.highlightStage=0;b.gridOptimization=!0;this.blurGridTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.blurGridTechnique);b.highlightStage=1;b.gridOptimization=!1;this.applyTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.applyTechnique);b.highlightStage=1;b.gridOptimization=!0;this.applyGridTechnique=
a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.applyGridTechnique);b.highlightStage=2;b.gridOptimization=!1;this.downsampleTechnique=a.acquireAndReleaseExisting(c.HighlightCompositionTechnique,b,this.downsampleTechnique)}Object.defineProperty(b.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?
function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});b.prototype.setDefaultOptions=function(a){this.defaultOptions=a};b.prototype.render=function(b,c,d){var e=b.pixelRatio,f=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,g=this._rctx;n.assert(this.enabled);l.vec4.copy(this.viewportToRestore,b.fullViewport);var k=Math.ceil(b.fullWidth/e),e=Math.ceil(b.fullHeight/e);this.blur0Fbo.resize(k,e);this.blur1Fbo.resize(k,e);g.bindVAO(this.quadVAO);var h=b=null;f&&(this._gridUpdateResources(c,
32),this._gridComputeMipmap());f?(b=this._grid.vao,h=this.blurGridTechnique,g.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),h.program.setUniform1i("coverageTex",1)):(b=this.quadVAO,h=this.blurTechnique);h.bindPipelineState(g);g.bindProgram(h.program);g.bindVAO(b);g.bindFramebuffer(this.blur0Fbo);g.setViewport(0,0,k,e);g.setClearColor(0,0,0,0);g.clear(16384);h.program.setUniform1i("tex",0);g.bindTexture(c.colorTexture,0);h.program.setUniform2f("blurSize",1/k,0);g.drawArrays(h.primitiveType,
0,p.vertexCount(b,"geometry"));g.bindFramebuffer(this.blur1Fbo);g.clear(16384);g.bindTexture(this.blur0Fbo.colorTexture,0);h.program.setUniform2f("blurSize",0,1/e);g.drawArrays(h.primitiveType,0,p.vertexCount(b,"geometry"));k=f?this.applyGridTechnique:this.applyTechnique;g.bindFramebuffer(d);k.bindPipelineState(g);g.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);g.bindProgram(k.program);g.bindTexture(this.blur1Fbo.colorTexture,
0);g.bindTexture(c.colorTexture,1);f&&g.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);k.bindApplyPass(this.defaultOptions);g.drawArrays(k.primitiveType,0,p.vertexCount(b,"geometry"));g.bindVAO(null)};b.prototype.enable=function(){if(!this.enabled){this.quadVAO=k.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new r(this._rctx,
a,b);this.blur1Fbo=new r(this._rctx,a,b)}};b.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};b.prototype._gridUpdateResources=function(a,b){var c=this._rctx,f=this._grid,k=!1;null===f.coverageMipmap&&(f.coverageMipmap=[a],k=!0);if(f.viewportWidth!==a.width||f.viewportHeight!==a.height)k=!0,f.viewportWidth=a.width,f.viewportHeight=a.height;f.coverageMipmap[0]=a;f.cellPixelSize!==b&&
(f.cellPixelSize=b,k=!0);if(k){for(b=1;b<f.coverageMipmap.length;b++)f.coverageMipmap[b].dispose();f.mipmapLevels=Math.ceil(Math.log(f.cellPixelSize)*Math.LOG2E);f.coverageMipmap.length=f.mipmapLevels+1;for(b=0;b<f.mipmapLevels;b++)k=f.coverageMipmap[b],k=new r(c,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)},{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)}),f.coverageMipmap[b+
1]=k}var k=Math.ceil(a.height/f.cellPixelSize),h=Math.ceil(a.width/f.cellPixelSize);if(!f.vao||f.verticalCellCount!==k||f.horizontalCellCount!==h){f.verticalCellCount=k;f.horizontalCellCount=h;a=k+1;b=h+1;for(var k=1/k,h=1/h,l=new Float32Array(24*a*b),p=0,n=0;n<a;n++)for(var t=0;t<b;t++)l[p+0]=(t-.5)*h*2-1,l[p+1]=(n-.5)*k*2-1,l[p+2]=t*h,l[p+3]=n*k,l[p+4]=(t+.5)*h*2-1,l[p+5]=(n-.5)*k*2-1,l[p+6]=t*h,l[p+7]=n*k,l[p+8]=(t-.5)*h*2-1,l[p+9]=(n+.5)*k*2-1,l[p+10]=t*h,l[p+11]=n*k,l[p+12]=(t-.5)*h*2-1,l[p+
13]=(n+.5)*k*2-1,l[p+14]=t*h,l[p+15]=n*k,l[p+16]=(t+.5)*h*2-1,l[p+17]=(n-.5)*k*2-1,l[p+18]=t*h,l[p+19]=n*k,l[p+20]=(t+.5)*h*2-1,l[p+21]=(n+.5)*k*2-1,l[p+22]=t*h,l[p+23]=n*k,p+=24;f.vao&&f.vao.dispose(!0);f.vao=new u(c,e.Default3D,{geometry:d.Pos2Tex},{geometry:g.createVertex(c,35044,l)})}};b.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.downsampleTechnique.program;this.downsampleTechnique.bindPipelineState(a);a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+
1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,p.vertexCount(this.quadVAO,"geometry"))}};b.prototype.getGpuMemoryUsage=function(){var a=p.getGpuMemoryUsage(this.blur0Fbo)+p.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var b=0,c=this._grid.coverageMipmap;b<c.length;b++)a+=
p.getGpuMemoryUsage(c[b]);return a};return b}()})},"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./HighlightComposition.glsl ../../../webgl/Program ../../../webgl/renderState ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get().build(this.configuration);return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),k.Default3D)};d.prototype.bindApplyPass=function(a){this.program.setUniform1i("tex",0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",
2);this.program.setUniform4fv("color",a.color);this.program.setUniform4fv("haloColor",a.haloColor);this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",a.haloOpacity,a.haloOpacityOccluded,a.fillOpacity,a.fillOpacityOccluded)};d.prototype.initializePipeline=function(){return 1===this.configuration.highlightStage?r.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),colorWrite:r.defaultColorWriteParams}):r.makePipelineState({colorWrite:r.defaultColorWriteParams})};
d.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};Object.defineProperty(d.prototype,"primitiveType",{get:function(){return this.configuration.gridOptimization?4:5},enumerable:!0,configurable:!0});d.shader=new a.ReloadableShaderModule(n,"./HighlightComposition.glsl",q);return d}(e.ShaderTechnique);b.HighlightCompositionTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.highlightStage=0;b.gridOptimization=!1;return b}l(b,a);f([d.parameter({count:3})],
b.prototype,"highlightStage",void 0);f([d.parameter()],b.prototype,"gridOptimization",void 0);return b}(d.ShaderTechniqueConfiguration);b.HighlightCompositionTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/HighlightComposition.glsl":function(){define(["require","exports","../../../../core/tsSupport/makeTemplateObjectHelper","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=
new h.ShaderBuilder,y=q.vertex.code,m=q.fragment.code;q.attributes.add("position","vec2");2===b.highlightStage&&(y.add(f.glsl(a||(a=l(["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);\n    }"])))),q.fragment.uniforms.add("tex","sampler2D"),q.fragment.uniforms.add("invFramebufferDim","vec2"),m.add(f.glsl(e||(e=l(["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"],
["\n      void main() {\n        vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\n        vec4 value \x3d texture2D(tex, coord);\n        float mx \x3d floor(max(value.g, value.b));\n        gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\n      }"])))));0===b.highlightStage&&(q.attributes.add("uv0","vec2"),b.gridOptimization?(q.vertex.uniforms.add("coverageTex","sampler2D"),q.fragment.uniforms.add("blurSize","vec2"),q.varyings.add("blurCoordinate","vec3")):(q.vertex.uniforms.add("blurSize",
"vec2"),q.varyings.add("blurCoordinates[5]","vec2")),y.add(f.glsl(n||(n=l(["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"],["\n    void main() {\n      gl_Position \x3d vec4(position, 0.0, 1.0);\n      ","\n    }"])),b.gridOptimization?f.glsl(d||(d=l(["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "],
["\n      vec4 cov \x3d texture2D(coverageTex, uv0);\n      if (cov.r \x3d\x3d 0.0) {\n        gl_Position \x3d vec4(0.0);\n      }\n      blurCoordinate \x3d vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));\n      "]))):f.glsl(k||(k=l(["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "],
["\n      vec2 uv \x3d position.xy * 0.5 + vec2(0.5);\n      blurCoordinates[0] \x3d uv;\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\n          "]))))),q.fragment.uniforms.add("tex","sampler2D"),m.add(f.glsl(r||(r=l(["\n    void main() {\n      ","\n    }"],["\n    void main() {\n      ","\n    }"])),b.gridOptimization?
f.glsl(c||(c=l(["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"],
["\n          vec2 uv \x3d blurCoordinate.xy;\n          vec4 center \x3d texture2D(tex, uv);\n\n          // do not blur if no pixel or all pixels in neighborhood are set\n          if (blurCoordinate.z \x3d\x3d 1.0) {\n            gl_FragColor \x3d center;\n          } else {\n            vec4 sum \x3d vec4(0.0);\n            sum +\x3d center * 0.204164;\n            sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\n            sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\n            sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\n            gl_FragColor \x3d sum;\n          }"]))):
f.glsl(g||(g=l(["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"],["\n          vec4 sum \x3d vec4(0.0);\n          sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\n          sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\n          sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\n          sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\n          gl_FragColor \x3d sum;"]))))));
1===b.highlightStage&&(q.varyings.add("uv","vec2"),b.gridOptimization&&(q.attributes.add("uv0","vec2"),q.vertex.uniforms.add("coverageTex","sampler2D")),y.add(f.glsl(u||(u=l(["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"],["\n      void main() {\n        ","\n        gl_Position \x3d vec4(position, 0.0, 1.0);\n        uv \x3d position.xy * 0.5 + vec2(0.5);\n      }"])),b.gridOptimization?f.glsl(p||
(p=l(["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"],["\n            vec4 cov \x3d texture2D(coverageTex, uv0);\n            // if no highlight pixel set in this block, hide block\n            if (cov.r \x3d\x3d 0.0) {\n              gl_Position \x3d vec4(0.0);\n              return;\n            }"]))):
"")),q.fragment.uniforms.add("tex","sampler2D"),q.fragment.uniforms.add("origin","sampler2D"),q.fragment.uniforms.add("color","vec4"),q.fragment.uniforms.add("haloColor","vec4"),q.fragment.uniforms.add("outlineSize","float"),q.fragment.uniforms.add("blurSize","float"),q.fragment.uniforms.add("opacities","vec4"),m.add(f.glsl(t||(t=l(["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"],
["\n      void main() {\n        // Read the highlight intensity from the blurred highlight image\n        vec4 blurredHighlightValue \x3d texture2D(tex, uv);\n        float highlightIntensity \x3d blurredHighlightValue.a;\n\n        // Discard all pixels which are not affected by highlight\n        if (highlightIntensity \x3d\x3d 0.0) {\n          discard;\n        }\n\n        vec4 origin_color \x3d texture2D(origin, uv);\n\n        float outlineIntensity;\n        float fillIntensity;\n\n        // if occluded\n        if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\n          outlineIntensity \x3d haloColor.w * opacities[1];\n          fillIntensity \x3d color.w * opacities[3];\n        }\n        // if unoccluded\n        else {\n          outlineIntensity \x3d haloColor.w * opacities[0];\n          fillIntensity \x3d color.w * opacities[2];\n        }\n\n        float inner \x3d 1.0 - outlineSize / 9.0;\n        float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\n\n        float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\n        //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\n        float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\n        float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\n\n        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        // I.e., color should not be premultiplied with alpha\n        gl_FragColor \x3d vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);\n      }"])))));
return q};var a,e,d,k,n,c,g,r,p,u,t})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/renderState ../../../webgl/Util".split(" "),function(q,b,l,f,h,a,e,d){var k=[0,0,0,0],n=[0,1,0,1];return function(){function b(b,c){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._compositePipelineState=new Map;this._rctx=c;c=this.renderTargetHelper=
new f.RenderTargetHelper(c);this.mainColor=c.registerColorTarget({name:"mainColor"});this.mainDepth=c.registerDepthTarget({name:"mainDepth"});this.linearDepth=c.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=c.registerColorTarget({name:"normal"});this.highlight=c.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=c.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=c.registerColorTarget({name:"tmpColor"});this.tmpDepth=c.registerDepthTarget({name:"tmpDepth"});
this._compositeProgram=b.getProgram(a.composite);this._compositePipelineState.set("none",e.makePipelineState({colorWrite:e.defaultColorWriteParams}));this._compositePipelineState.set("alpha",e.makePipelineState({blending:e.separateBlendingParams(770,1,771,771),colorWrite:e.defaultColorWriteParams}));this._compositePipelineState.set("premultiplied-alpha",e.makePipelineState({blending:e.simpleBlendingParams(1,771),colorWrite:e.defaultColorWriteParams}));this._compositeTransparentToHUDVisibilityProgram=
b.getProgram(a.compositeTransparentToHUDVisibility);this._compositeTransparentToHUDVisibilityPipelineState=e.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});this._compositeOccludedProgram=b.getProgram(a.compositeOccluded);this._compositeOccludedPipelineState=e.makePipelineState({blending:e.simpleBlendingParams(1,771),colorWrite:e.defaultColorWriteParams})}Object.defineProperty(b.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,
this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"highlightTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});b.prototype.initializeFrame=function(a,b){h.assert(this.enabled);var c=this._rctx;this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.outputFramebuffer=b;this.bindTarget(this.mainColor,this.mainDepth);c.setClearStencil(0);a=this._background.color;c.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);c.clearSafe(17664)};b.prototype.renderAndComposite=
function(a,b){this.renderToTargets(a,this.tmpColor,this.mainDepth,k);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,b)};b.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,n)};b.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._compositeTransparentToHUDVisibilityProgram;b.bindProgram(c);b.setPipelineState(a._compositeTransparentToHUDVisibilityPipelineState);
c.setUniform1i("tex",1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,d.vertexCount(a.quadVAO,"geometry"))},this.hudVisibility,this.mainDepth)};b.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};b.prototype.compositeOccludedOntoMain=function(a){var b=this._rctx,c=this._compositeOccludedProgram;this.bindFramebuffer();b.bindProgram(c);b.setPipelineState(this._compositeOccludedPipelineState);
b.bindVAO(this.quadVAO);b.bindTexture(this.getColorTexture(this.tmpColor),0);c.setUniform1i("occludedColorMap",0);c.setUniform1f("opacity",a);b.drawArrays(5,0,d.vertexCount(this.quadVAO,"geometry"));b.bindVAO(null)};b.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};b.prototype.renderDepthDetached=function(a){var b=this.bindTarget(this.mainColor);a(b);this.bindTarget(this.mainColor,this.mainDepth)};b.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);
void 0===b&&(b=this.outputFramebuffer);void 0===c&&(c="none");var e=this._rctx,f=this._compositeProgram;e.bindFramebuffer(b);e.bindProgram(f);e.setPipelineState(this._compositePipelineState.get(c));f.setUniform1i("tex",1);e.bindTexture(a,1);e.bindVAO(this.quadVAO);e.drawArrays(5,0,d.vertexCount(this.quadVAO,"geometry"))};b.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};b.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=l.createQuadVAO(this._rctx))};
b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};b.prototype.renderToTargets=function(a,b,c,d,e){var f=this._rctx;b=this.bindTarget(b,c);c=0;d&&(f.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),c|=16384);e&&(c|=1280);f.clearSafe(c);a(b);f.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return b};b.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,
a,b);this._rctx.bindFramebuffer(a);return a};b.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};b.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return b}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});var d={dataType:5121},k={};q=function(){function b(a){this.rctx=a;this.activeTargets=new Set;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}b.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});
this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};b.prototype.disposeTargetResource=function(a){a=a.id;this.activeTargets.has(a)&&(this.activeTargets.delete(a),this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};
b.prototype.getDepthTexture=function(b,d){if(this.depthTextureSupported){var c=this.depthTextures.get(b.id);!c||c.descriptor.width===d.width&&c.descriptor.height===d.height||(c.dispose(),c=void 0);c||(c=new a(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height}),this.depthTextures.set(b.id,c),this.activeTargets.add(b.id));return c}};b.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=this.depthBuffers.get(a.id);
c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new h(this.rctx,l({internalFormat:34041},b)),this.depthBuffers.set(a.id,c),this.activeTargets.add(a.id));return c}};b.prototype.getColorTexture=function(b,d){var c=this.colorTextures.get(b.id);!c||c.descriptor.width===d.width&&c.descriptor.height===d.height||(c.dispose(),c=void 0);c||(c=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:b.dataType,samplingMode:null!=b.samplingMode?b.samplingMode:9729,
wrapMode:33071,width:d.width,height:d.height}),this.colorTextures.set(b.id,c),this.activeTargets.add(b.id));return c};b.prototype.getAllocatedColorTexture=function(a){return this.colorTextures.get(a.id)};b.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return l({id:b},k,a)};b.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return l({id:b},d,a)};b.prototype.getFramebuffer=function(a,b,d){var c=this.getKey(b,d),e=this.framebuffers.get(c);
b=this.getColorTexture(b,a);if(this.depthTextureSupported){var g=d?this.getDepthTexture(d,a):void 0;if(!e)return e=d?new f(this.rctx,{colorTarget:0,depthStencilTarget:4},b,g):new f(this.rctx,{colorTarget:0,depthStencilTarget:0},b),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b||e.depthStencilTexture!==g)e.detachColorTexture(),e.detachDepthStencilTexture(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilTexture(g);return e}g=d?this.getDepthBuffer(d,
a):void 0;if(!e)return e=new f(this.rctx,{colorTarget:0,depthStencilTarget:d?3:0},b,g),this.framebuffers.set(c,e),e;if(d=e.width!==a.width||e.height!==a.height||e.colorTexture!==b)e.detachColorTexture(),e.detachDepthStencilBuffer(),e.resize(a.width,a.height),e.attachColorTexture(b),e.attachDepthStencilBuffer(g);return e};b.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};b.prototype.getGpuMemoryUsage=function(){var a=0,b=new Set,d=function(c){b.has(c)||(b.add(c),
a+=e.getGpuMemoryUsage(c))};this.depthTextures.forEach(d);this.colorTextures.forEach(d);this.depthBuffers.forEach(d);this.framebuffers.forEach(d);return a};return b}();b.RenderTargetHelper=q})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.composite={name:"offscreen-composite",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),
fragmentShader:f.resolveIncludes("renderer/offscreen/composite.frag")},attributes:l.Default3D};b.compositeTransparentToHUDVisibility={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:f.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:l.Default3D};b.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),
fragmentShader:f.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},attributes:l.Default3D}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=new f(function(a){var b=l;a.split("/").forEach(function(a){b&&(b=b[a])});return b});b.resolveIncludes=function(a){return h.resolveIncludes(a)}})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require",
"exports","./depthRange","./Util"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a){this.pluginContext=a;this.renderPlugins=[];this.slots=[];for(a=0;20>a;++a)this.slots[a]=[]}a.prototype.add=function(a,b){this.renderPlugins.push(b);for(var d=0;d<a.length;++d)this.slots[a[d]].push(b);b.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};a.prototype.remove=function(a){var b=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(function(b){return b!==
a});f.assert(this.renderPlugins.length<b,"Removing non-added render plugin");for(b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});a.uninitializeRenderContext();this.pluginContext.requestRender()};a.prototype.prepareRender=function(a){for(var b=0,e=this.renderPlugins;b<e.length;b++){var f=e[b];f.prepareRender&&f.prepareRender(a)}};a.prototype.render=function(a,b){b.slot=a;var d=!1,e=0;for(a=this.slots[a];e<a.length;e++){var c=a[e];c.canRender&&c.render(b)&&
(d=!0)}return d};a.prototype.queryDepthRange=function(a){var b=h;b.near=Infinity;b.far=-Infinity;for(var e=0,f=this.renderPlugins;e<f.length;e++){var c=f[e];c.queryDepthRange&&(c=c.queryDepthRange(a))&&l.union(b,c,b)}return b};a.prototype.needsHighlight=function(){return this.renderPlugins.some(function(a){return a.needsHighlight})};a.prototype.needsLinearDepth=function(){return this.renderPlugins.some(function(a){return a.needsLinearDepth})};return a}();b.RenderPluginManager=q;var h={near:0,far:0}})},
"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ./Camera ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v){function y(a,b){e.vec2.set(ha,a[b],a[b+3]);return ha}var m=function(){return function(){this.camera=new r.default;this.lightMat=a.mat4f64.create()}}();q=function(){function a(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.splitSchemeLambda=.1;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=p.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new m)}
a.prototype.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null};Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=l.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},
set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)O[a]=this.cascades[a];O.length=this.numCascades;return O};a.prototype.prepare=function(a,b,d){u.assert(this.enabled);h.mat4.multiply(A,a.projectionMatrix,a.viewMatrix);var f=d.near;d=d.far;2>f&&(f=2);2>d&&(d=2);f>=d&&(f=2,d=4);this.numCascades=Math.min(1+Math.floor(u.logWithBase(d/f,4)),
this.maxNumCascades);for(var g=(d-f)/this.numCascades,m=Math.pow(d/f,1/this.numCascades),p=f,n=0;n<this.numCascades+1;++n)this.cascadeDistances[n]=l.lerp(p,f,this.splitSchemeLambda),p*=m,f+=g;h.mat4.invert(B,A);h.mat4.lookAt(S,[0,0,0],[-b[0],-b[1],-b[2]],a.up);g=a.viewMatrix;a=a.projectionMatrix;for(n=0;n<this.numCascades;++n){m=this.cascades[n];f=-this.cascadeDistances[n];p=-this.cascadeDistances[n+1];f=(a[10]*f+a[14])/Math.abs(a[11]*f+a[15]);p=(a[10]*p+a[14])/Math.abs(a[11]*p+a[15]);u.assert(f<
p);for(var r=0;8>r;++r){c.vec4.set(C,0===r%4||3===r%4?-1:1,0===r%4||1===r%4?-1:1,4>r?f:p,1);c.vec4.transformMat4(E[r],C,B);for(var q=0;3>q;++q)E[r][q]/=E[r][3]}k.vec3.negate(R,E[0]);h.mat4.translate(w,S,R);m.camera.viewMatrix=w;for(r=0;8>r;++r)k.vec3.transformMat4(E[r],E[r],m.camera.viewMatrix);k.vec3.copy(G,E[0]);k.vec3.copy(J,E[0]);for(r=1;8>r;++r)for(q=0;3>q;++q)G[q]=Math.min(G[q],E[r][q]),J[q]=Math.max(J[q],E[r][q]);G[2]-=200;J[2]+=200;m.camera.near=-J[2];m.camera.far=-G[2];if(this.warp){f=1/
E[0][3];d=1/E[4][3];u.assert(f<d);var r=f+Math.sqrt(f*d),p=Math.sin(l.acosClamped(g[2]*b[0]+g[6]*b[1]+g[10]*b[2])),r=r/p,f=E,t=r,v=p,p=I,x=K,O=H,q=L,r=P;e.vec2.set(Y,0,0);for(var T=0;4>T;++T)e.vec2.add(Y,Y,f[T]);e.vec2.scale(Y,Y,.25);e.vec2.set(N,0,0);for(T=4;8>T;++T)e.vec2.add(N,N,f[T]);e.vec2.scale(N,N,.25);e.vec2.lerp(Z[0],f[4],f[5],.5);e.vec2.lerp(Z[1],f[5],f[6],.5);e.vec2.lerp(Z[2],f[6],f[7],.5);e.vec2.lerp(Z[3],f[7],f[4],.5);for(var Q=0,ja=e.vec2.squaredDistance(Z[0],Y),T=1;4>T;++T){var z=e.vec2.squaredDistance(Z[T],
Y);z<ja&&(ja=z,Q=T)}e.vec2.subtract(W,Z[Q],f[Q+4]);T=W[0];W[0]=-W[1];W[1]=T;e.vec2.subtract(aa,N,Y);e.vec2.lerp(W,W,aa,v);e.vec2.normalize(W,W);Q=v=void 0;v=Q=e.vec2.dot(e.vec2.subtract(V,f[0],Y),W);for(T=1;8>T;++T)ja=e.vec2.dot(e.vec2.subtract(V,f[T],Y),W),ja<v?v=ja:ja>Q&&(Q=ja);e.vec2.copy(p,Y);e.vec2.scale(V,W,v-t);e.vec2.add(p,p,V);for(var z=-1,qa=1,T=t=ja=0;8>T;++T){e.vec2.subtract(F,f[T],p);e.vec2.normalize(F,F);var la=W[0]*F[1]-W[1]*F[0];0<la?la>z&&(z=la,ja=T):la<qa&&(qa=la,t=T)}u.verify(0<
z,"leftArea");u.verify(0>qa,"rightArea");e.vec2.scale(ca,W,v);e.vec2.add(ca,ca,Y);e.vec2.scale(U,W,Q);e.vec2.add(U,U,Y);ea[0]=-W[1];ea[1]=W[0];x=u.rayRay2D(p,f[t],U,e.vec2.add(V,U,ea),1,x);O=u.rayRay2D(p,f[ja],U,V,1,O);q=u.rayRay2D(p,f[ja],ca,e.vec2.add(V,ca,ea),1,q);f=u.rayRay2D(p,f[t],ca,V,1,r);u.verify(x,"rayRay");u.verify(O,"rayRay");u.verify(q,"rayRay");u.verify(f,"rayRay");O=I;f=K;p=L;q=P;r=m.camera.projectionMatrix;e.vec2.subtract(ka,p,q);e.vec2.scale(ka,ka,.5);ba[0]=ka[0];ba[1]=ka[1];ba[2]=
0;ba[3]=ka[1];ba[4]=-ka[0];ba[5]=0;ba[6]=ka[0]*ka[0]+ka[1]*ka[1];ba[7]=ka[0]*ka[1]-ka[1]*ka[0];ba[8]=1;ba[6]=-e.vec2.dot(y(ba,0),O);ba[7]=-e.vec2.dot(y(ba,1),O);O=e.vec2.dot(y(ba,0),p)+ba[6];x=e.vec2.dot(y(ba,1),p)+ba[7];T=e.vec2.dot(y(ba,0),q)+ba[6];q=e.vec2.dot(y(ba,1),q)+ba[7];O=-(O+T)/(x+q);ba[0]+=ba[1]*O;ba[3]+=ba[4]*O;ba[6]+=ba[7]*O;O=1/(e.vec2.dot(y(ba,0),p)+ba[6]);x=1/(e.vec2.dot(y(ba,1),p)+ba[7]);ba[0]*=O;ba[3]*=O;ba[6]*=O;ba[1]*=x;ba[4]*=x;ba[7]*=x;ba[2]=ba[1];ba[5]=ba[4];ba[8]=ba[7];ba[7]+=
1;O=e.vec2.dot(y(ba,1),f)+ba[7];x=e.vec2.dot(y(ba,2),f)+ba[8];T=e.vec2.dot(y(ba,1),p)+ba[7];q=e.vec2.dot(y(ba,2),p)+ba[8];O=-.5*(O/x+T/q);ba[1]+=ba[2]*O;ba[4]+=ba[5]*O;ba[7]+=ba[8]*O;O=e.vec2.dot(y(ba,1),f)+ba[7];x=e.vec2.dot(y(ba,2),f)+ba[8];T=-x/O;ba[1]*=T;ba[4]*=T;ba[7]*=T;r[0]=ba[0];r[1]=ba[1];r[2]=0;r[3]=ba[2];r[4]=ba[3];r[5]=ba[4];r[6]=0;r[7]=ba[5];r[8]=0;r[9]=0;r[10]=1;r[11]=0;r[12]=ba[6];r[13]=ba[7];r[14]=0;r[15]=ba[8];m.camera.projectionMatrix[10]=2/(G[2]-J[2]);m.camera.projectionMatrix[14]=
-(G[2]+J[2])/(G[2]-J[2])}else h.mat4.ortho(m.camera.projectionMatrix,G[0],J[0],G[1],J[1],m.camera.near,m.camera.far);h.mat4.multiply(m.lightMat,m.camera.projectionMatrix,m.camera.viewMatrix);f=this.textureRes/2;m.camera.viewport[0]=0===n%2?0:f;m.camera.viewport[1]=0===Math.floor(n/2)?0:f;m.camera.viewport[2]=f;m.camera.viewport[3]=f}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*d;b=this.rctx;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clearSafe(16640)};
a.prototype.finish=function(a){u.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var b=this.rctx,c=this.enabled;b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],
this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};a.prototype.bindView=function(a,b){if(this.enabled){var c=this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||n.vec3f64.create(),k.vec3.copy(this.lastOrigin,b),c=0;c<this.numCascades;++c){h.mat4.translate(Q,this.cascades[c].lightMat,b);for(var d=0;16>d;++d)T[16*c+d]=Q[d]}a.setUniformMatrix4fv("shadowMapMatrix",
T)}};a.prototype.enable=function(){this.enabled||(this.depthTexture=new x(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes}),this.fbo=new t(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes},this.depthTexture))};a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};a.prototype.getGpuMemoryUsage=function(){return v.getGpuMemoryUsage(this.fbo)};
return a}();var w=a.mat4f64.create(),A=a.mat4f64.create(),B=a.mat4f64.create(),C=g.vec4f64.create(),E=[];for(b=0;8>b;++b)E.push(g.vec4f64.create());var G=n.vec3f64.create(),J=n.vec3f64.create(),I=d.vec2f64.create(),K=d.vec2f64.create(),H=d.vec2f64.create(),L=d.vec2f64.create(),P=d.vec2f64.create(),S=a.mat4f64.create(),R=n.vec3f64.create(),O=[],Q=a.mat4f64.create(),T=new Float32Array(64),Y=d.vec2f64.create(),N=d.vec2f64.create(),Z=[d.vec2f64.create(),d.vec2f64.create(),d.vec2f64.create(),d.vec2f64.create()],
W=d.vec2f64.create(),aa=d.vec2f64.create(),V=d.vec2f64.create(),F=d.vec2f64.create(),ca=d.vec2f64.create(),U=d.vec2f64.create(),ea=d.vec2f64.create(),ha=d.vec2f64.create(),ka=d.vec2f64.create(),ba=f.mat3f64.create();return q})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(q,b,l){var f=l.boundedPlane.create();return function(){function b(){this._worldPlane=f}Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this.plane!==
f},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=a?a:f},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../core/maybe ../../../../core/promiseUtils ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){return function(){function b(a){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;if(!this.data||!this.textureArea||!this.textureSearch){var c=this.resourceLoadingPromise||this.loadDataModule().then(function(){return b.loadTextures()});a&&c.then(a);this.resourceLoadingPromise||
(this.resourceLoadingPromise=c,c.then(function(){return b.resourceLoadingPromise=null}));return!1}return!0};b.prototype.loadDataModule=function(){var a=this;return this.data?f.resolve():f.create(function(b){return q(["./SmaaRenderPassData"],function(c){a.data=c;b()})})};b.prototype.loadTextures=function(){var a=this;return f.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(function(b){var c=b[1];a.textureArea=b[0];
a.textureSearch=c})};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return null!=this.resourceLoadingPromise},enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var b=this.rctx;this.programEdgeDetect=new d(b,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new d(b,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,
this.vertexAttributeLocations);this.programBlur=new d(b,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=k.makePipelineState({colorWrite:k.defaultColorWriteParams});var f=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new a(b,34962,35044,f)});this.tmpFramebufferEdges=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,
samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new e(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=
null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;l.isSome(b)?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setPipelineState(this.pipelineState);c.setViewport(0,
0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,1);c.clear(16384);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(16384);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",
1/d,1/e,d,e);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(16384);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",
0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3)};b.prototype.loadTextureFromBase64=function(a,b,c){var d=new n(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);return h.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a);return d})};return b}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./glUtil3D ./SSAOTechnique ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){var u=l.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");b=function(){function b(a,b,c){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=e.vec4f64.create();this._rctx=b;this._techniqueRep=a;this._requestRender=c;this._ssaoTechniqueConfig=new n.SSAOTechniqueConfiguration;this._emptyTexture=k.createColorTexture(b,[1,1,1,1])}b.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=
null};Object.defineProperty(b.prototype,"isSupported",{get:function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=
a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});b.prototype.computeSSAO=function(b,
d,e){if(this._noiseTexture){c.assert(this.enabled);var f=this._rctx,g=b.fullViewport,m=g[2],l=g[3],g=m/this._BLUR_F,n=l/this._BLUR_F;this._ssaoFBO.resize(m,l);this._blur0FBO.resize(g,n);this._blur1FBO.resize(g,n);g=1*m;n=1*l;f.bindFramebuffer(this._ssaoFBO);a.vec4.copy(this._viewportToRestore,b.fullViewport);f.setViewport(0,0,m,l);var r=this._ssaoTechnique.program,q=this._blurTechnique.program;f.bindProgram(r);f.setPipelineState(this._ssaoTechnique.pipeline);r.setUniform2f("rnmScale",m/this._noiseTexture.descriptor.width,
l/this._noiseTexture.descriptor.height);r.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);m=this._data.minDiscrepancy;r.setUniform1f("numSpiralTurns",this._samples<m.length?m[this._samples]:5779);m=x;l=t;c.inverseProjectionInfo(b.projectionMatrix,b.fullWidth,b.fullHeight,m,l);r.setUniform4fv("projInfo",m);r.setUniform2fv("zScale",l);r.setUniform2f("nearFar",b.near,b.far);m=1/b.computeRenderPixelSizeAtDist(1);
r.setUniform1f("projScale",1*m);r.setUniform2f("screenDimensions",g,n);var w=2*this._radius,l=h.vec3.distance(b.eye,b.center),w=20*b.computeRenderPixelSizeAtDist(l),w=Math.max(.1,w);r.setUniform1f("radius",w);r.setUniform1f("intensity",4*this._attenuation/Math.pow(w,6));r.setUniform1i("rnm",0);r.setUniform1i("normalMap",1);r.setUniform1i("depthMap",2);f.bindTexture(this._noiseTexture,0);f.bindTexture(e,1);f.bindTexture(d,2);d=k.createQuadVAO(this._rctx);f.bindVAO(d);f.drawArrays(5,0,p.vertexCount(d,
"geometry"));f.bindTexture(this._ssaoFBO.colorTexture,0);f.setViewport(0,0,g/this._BLUR_F,n/this._BLUR_F);f.bindFramebuffer(this._blur0FBO);f.bindProgram(q);q.setUniform2f("screenDimensions",g,n);q.setUniform1i("tex",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);q.setUniform2f("blurSize",0,1*this._BLUR_F/n);q.setUniform1i("radius",4);q.setUniform1f("g_BlurFalloff",.08);q.setUniform2f("nearFar",b.near,b.far);5E4<l&&(m=Math.max(0,m-(l-5E4)));q.setUniform1f("projScale",m);q.setUniform2f("zScale",
1,0);f.drawArrays(5,0,p.vertexCount(d,"geometry"));q.setUniform2f("blurSize",1*this._BLUR_F/g,0);f.bindFramebuffer(this._blur1FBO);f.bindTexture(this._blur0FBO.colorTexture,0);f.drawArrays(5,0,p.vertexCount(d,"geometry"));f.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};b.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);
c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};b.prototype.bindToAllPrograms=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};b.prototype.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?16:32>=this._samples?
32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(n.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(n.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};b.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&
a.initialize()})):u.warn("SSAO is not supported for this browser or hardware"))};b.prototype.loadResources=function(a){var b=this;this._data?a():q(["./SSAOHelperData"],function(c){b._data=c;a()})};b.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=new g(this._rctx,c,b);this._blur0FBO=new g(this._rctx,c,b);this._blur1FBO=new g(this._rctx,c,b);d.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&
(a._noiseTexture=new r(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};b.prototype.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};b.prototype.getGpuMemoryUsage=
function(){return p.getGpuMemoryUsage(this._blur0FBO)+p.getGpuMemoryUsage(this._blur1FBO)+p.getGpuMemoryUsage(this._ssaoFBO)};return b}();var t=f.vec2f64.create(),x=e.vec4f64.create();return b})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../shaders/SSAO.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get(),e=this.configuration,b=b.build({output:e.output,samples:e.samples,radius:e.radius});return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),k.Default3D)};d.prototype.initializePipeline=function(){return g.makePipelineState({colorWrite:g.defaultColorWriteParams})};
d.shader=new a.ReloadableShaderModule(n,"../shaders/SSAO.glsl",q);return d}(e.ShaderTechnique);b.SSAOTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.samples=64;b.radius=4;return b}l(b,a);f([d.parameter({count:2})],b.prototype,"output",void 0);f([d.parameter()],b.prototype,"samples",void 0);f([d.parameter()],b.prototype,"radius",void 0);return b}(d.ShaderTechniqueConfiguration);b.SSAOTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/SSAO.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/output/ReadLinearDepth.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ./Skirts.glsl".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new a.ShaderBuilder;q.include(e.Skirts);q.attributes.add("position","vec2");q.varyings.add("uv","vec2");q.vertex.code.add(h.glsl(d||(d=l(["\n      void main(void) {\n        gl_Position \x3d vec4(position.x, position.y, 0.0, 1.0);\n        uv \x3d position * 0.5 + vec2(0.5);\n      }\n  "],["\n      void main(void) {\n        gl_Position \x3d vec4(position.x, position.y, 0.0, 1.0);\n        uv \x3d position * 0.5 + vec2(0.5);\n      }\n  "]))));
1===b.output&&(q.include(f.ReadLinearDepth),q.fragment.code.add(h.glsl(k||(k=l([" \n      #ifndef RADIUS\n        #define RADIUS "],[" \n      #ifndef RADIUS\n        #define RADIUS "])))+b.radius+"\n      #endif\n    "),q.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),q.fragment.code.add(h.glsl(n||(n=l(["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "],
["\n      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\n        float c \x3d texture2D(tex, uv).r;\n        float d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float ddiff \x3d d - center_d;\n\n        float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\n\n        w_total +\x3d w;\n\n        return w*c;\n      }\n\n      void main(void) {\n        float b \x3d 0.0;\n        float w_total \x3d 0.0;\n\n        float center_d \x3d linearDepth(depthMap, uv, nearFar);\n\n        float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\n        for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\n          float rf \x3d float(r);\n          vec2 uvOffset \x3d uv + rf*blurSize;\n          b +\x3d blurFunction(uvOffset, rf, center_d, w_total, sharpness);\n        }\n\n        gl_FragColor \x3d vec4(b/w_total);\n      }\n    "])))));
0===b.output&&(q.include(f.ReadLinearDepth),q.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("projInfo","vec4").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D").add("zScale","vec2"),q.fragment.code.add(h.glsl(c||(c=l([" \n      #ifndef SAMPLES\n        #define SAMPLES "],[" \n      #ifndef SAMPLES\n        #define SAMPLES "])))+
b.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),q.fragment.code.add(h.glsl(g||(g=l(["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "],
["\n      float fallOffFunction(float vv, float vn, float bias) {\n        float radius2 \x3d radius * radius;\n\n        // A: From the HPG12 paper\n        // Note large epsilon to avoid overdarkening within cracks\n        // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\n\n        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\n        float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\n\n        // C: Medium contrast (which looks better at high radii), no division.  Note that the\n        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\n        // more computationally efficient and happens to be aesthetically pleasing.\n        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\n\n        // D: Low contrast, no division operation\n        // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\n      }\n    "])))),
q.fragment.code.add(h.glsl(r||(r=l(["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "],["\n      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\n        vec3 v \x3d Q - C;\n        float vv \x3d dot(v, v);\n        float vn \x3d dot(normalize(v), n_C);\n        return fallOffFunction(vv, vn, 0.1);\n      }\n    "])))),
q.fragment.code.add(h.glsl(p||(p=l(["\n      vec3 reconstructCSPosition(vec2 S, float z) {\n        return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n      }\n\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "],
["\n      vec3 reconstructCSPosition(vec2 S, float z) {\n        return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\n      }\n\n      void main(void) {\n        //Hash function used in the HPG12 AlchemyAO paper\n        //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\n        //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\n        //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\n        vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\n\n        float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\n\n        if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\n          gl_FragColor \x3d vec4(0.0);\n          return;\n        }\n\n        vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\n\n        // get the normal of current fragment\n        vec4 norm4 \x3d texture2D(normalMap, uv);\n        vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\n        bool isTerrain \x3d norm4.w\x3c0.5;\n\n        float sum \x3d .0;\n\n        vec4 occluderFragment;\n        vec3 ray;\n\n        vec3 tapPixelPos;\n\n        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\n        // bug or deviation from CE somewhere else?\n        float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\n\n        for(int i \x3d 0; i \x3c SAMPLES; ++i) {\n          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\n          //float ssR;\n          //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\n          // get the depth of the occluder fragment\n          //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\n\n          vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\n          vec2 offset \x3d vec2(-unitOffset*radius*ps);\n\n          //don't use current or very nearby samples\n          if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\n\n          vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\n          if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\n          vec2 tcTap \x3d tc/screenDimensions;\n          float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\n\n          if (isTerrain) {\n            bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\n            if (isTerrainTap) {\n              continue;\n            }\n          }\n\n          tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\n\n          sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\n        }\n\n        // output the result\n\n        float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\n\n        // Anti-tone map to reduce contrast and drag dark region farther\n        // (x^0.2 + 1.2 * x^4)/2.2\n        A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\n\n        //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\n        //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\n        //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\n        gl_FragColor \x3d vec4(A);\n      }\n    "])))));
return q};var d,k,n,c,g,r,p})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/promiseUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/utils ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c){this.rctx=a;this.techniqueRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new A.LocalOriginManager(new m);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new I;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=t.vec3f64.create();this.tmpCameraPosition=
t.vec3f64.create();this.componentColorManager=new E.BufferManager(this.rctx,2)}b.prototype.initialize=function(){var a=this;n.open("EdgeProcessingWorker").then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=G.VertexLayout.createBuffer(4),c=0;4>c;c++)b.sideness.set(c,0,0===c||3===c?0:1),b.sideness.set(c,1,0===c||1===c?0:1);this.verticesBufferObject=P.createVertex(this.rctx,35044,b.buffer)};b.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),
this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};b.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(b.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});b.prototype.shouldRender=function(){return 0<this.renderers.size};b.prototype.addComponentObject=function(a,b,c,e,g,k,m,l){return f(this,void 0,void 0,
function(){var f,p,n;return h(this,function(h){switch(h.label){case 0:if(this.hasObject(a))return[2];f=[];n={loaded:d.create(function(a){return p=a}),renderables:[],center:c};this.perObjectData.set(a,n);f.push(this.addComponentGeometry(b,n,e,g,k,m,l));return[4,d.all(f)];case 1:return h.sent(),this.callbacks.setNeedsRender(),p(),[2]}})})};b.prototype.addObject=function(a,b,c,e,g){return f(this,void 0,void 0,function(){var f,k,m,l,p,n,r;return h(this,function(h){switch(h.label){case 0:if(this.hasObject(a))return[2];
f=[];m={loaded:d.create(function(a){return k=a}),renderables:[]};this.perObjectData.set(a,m);if(g&&g.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))f.push(this.addObjectMergedGeometries(a,m,b,c));else for(l=0;l<a.geometries.length;l++)if(p=a.geometries[l],n=a.geometryRecords[l],r=n.material,r.supportsEdges){if(p.data instanceof C)throw Error("Deprecated");f.push(this.addGeometryNonPreinterleaved(a,m,p.data,n,b[0],c,e))}return[4,d.all(f)];case 1:return h.sent(),this.callbacks.setNeedsRender(),
k(),[2]}})})};b.prototype.hasObject=function(a){return this.perObjectData.has(a)};b.prototype.updateAllComponentOpacities=function(a,b){return f(this,void 0,void 0,function(){var c,d,e=this;return h(this,function(f){switch(f.label){case 0:return c=b instanceof Array?function(a){return b[a]}:function(){return b},[4,this.getObjectEntry(a)];case 1:return d=f.sent(),d.renderables.forEach(function(a){for(var b=a.components.meta.length,d=0;d<b;d++){var f=c(d),g=a.components.meta[d],k=g.index;g.material.opacity=
f;a.components.buffer.textureBuffer.setDataElement(k,1,3,255*f)}e.updateTransparency(a)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateAllComponentMaterials=function(a,b,c,d){return f(this,void 0,void 0,function(){var e,f,g,k,m,l=this;return h(this,function(h){switch(h.label){case 0:return e=a instanceof B,f=!!c.slicePlaneEnabled,g=L.determineRendererType(b),k=K.EdgeRenderer.getKey(g,f,e),[4,this.getObjectEntry(a)];case 1:return m=h.sent(),m.renderables.forEach(function(c){if(k!==c.rendererKey){var e=
l.renderers.get(c.rendererKey),h=l.acquireRenderer(g,f,a instanceof B);e.removeRenderable(c);e.refCount.decrement();c.rendererKey=k;h.addRenderable(c)}for(e=0;e<b.length;e++)c.components.meta[e].material=b[e];d&&l.updateComponentBuffer(c.components);l.updateTransparency(c)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateObjectVisibility=function(a,b){return f(this,void 0,void 0,function(){var c;return h(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return c=
d.sent(),c.renderables.forEach(function(a){a.visible=b}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};b.prototype.getObjectEntry=function(a){return f(this,void 0,void 0,function(){var b;return h(this,function(c){switch(c.label){case 0:b=this.perObjectData.get(a);if(!b)throw"no object";
return[4,b.loaded];case 1:return c.sent(),[2,b]}})})};b.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};b.prototype.render=function(a,b){var d=this;this.localOrigins.updateViewMatrices(a.view);var e=a.viewInvTransp,f=t.vec3f64.create(),k=new y.TwoVectorPosition,h=new v.VertexPosition.ViewProjectionTransform,m=g.mat3f64.create();u.vec3.set(f,e[3],e[7],e[11]);k.set(f);u.vec3.copy(h.worldFromView_TH,k.high);u.vec3.copy(h.worldFromView_TL,k.low);
c.mat3.fromMat4(h.viewFromCameraRelative_RS,a.view);r.mat4.copy(h.projFromView,a.proj);e=g.mat3f64.create();c.mat3.transpose(e,h.viewFromCameraRelative_RS);c.mat3.invert(m,e);this.renderers.forEach(function(a){0===a.refCount.value&&(d.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var l=0,p=0;this.renderers.forEach(function(a){return a.forEachRenderable(function(a){l+=a.statistics.averageEdgeLength;p++},b)});if(0!==p){var e=
a.view,f=40*l/p,k=L.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5*a.pixelRatio),n={distanceFalloffFactor:f,minimumEdgeLength:k,transparency:b,viewProjectionTransform:h,transformNormal_ViewFromGlobal:m};this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){d.renderRegularEdges(b,a,n);d.renderSilhouetteEdges(b,a,n)});a.view=e}};b.prototype.updateTransparency=function(a){var b=L.determineEdgeTransparency(a.components.meta),c=L.determineObjectTransparency(a.components.meta);
if(b!==a.edgeTransparency||c!==a.objectTransparency)a.edgeTransparency=b,a.objectTransparency=c,this.renderers.get(a.rendererKey).setRenderablesDirty()};b.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=u.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.acquire(a));w.applyToModelMatrix(b.origin.vec3,c);return c};b.prototype.updateComponentBuffer=function(a){var b=a.meta;
a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,f=b[c].index,g=e.clamp(Math.round(d.size*K.LINE_WIDTH_FRACTION_FACTOR),0,255),k=e.clamp(d.extensionLength,-K.EXTENSION_LENGTH_OFFSET,255-K.EXTENSION_LENGTH_OFFSET)+K.EXTENSION_LENGTH_OFFSET,h="solid"===d.type?0:1,m=255*d.opacity,d=d.color;a.textureBuffer.setData(f,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(f,1,g,k,h,m)}};b.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),
d=0;d<a.length;d++){var e=a[d],f=c.acquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};b.prototype.extractEdges=function(a,b,c,d,e){return this.worker.process({data:b,originalIndices:e,writerSettings:a,skipDeduplicate:c},d?null:this.workerThread)};b.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new S(this.rctx,G.EdgeShaderAttributeLocations,{vertices:G.glVertexLayout,instances:J.RegularEdgeBufferWriter.glLayout},
{vertices:this.verticesBufferObject,instances:P.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new S(this.rctx,G.EdgeShaderAttributeLocations,{vertices:G.glVertexLayout,instances:J.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:P.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};b.prototype.disposeEdgeResources=
function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};b.prototype.addGeometryNonPreinterleaved=function(a,b,c,d,e,g,k){return f(this,void 0,void 0,function(){var f,m,l,n;return h(this,function(h){f=c.getAttribute("position");m=this.computeModelTransformWithLocalOrigin(a,d,p.mat4f64.create());l=d.origin;n={position:f,
indices:c.getIndices("position"),modelTransform:m,origin:l};return[2,this.addNonPreinterleaved(b,n,e,g,k)]})})};b.prototype.addNonPreinterleaved=function(a,b,c,d,e){void 0===e&&(e=!1);return f(this,void 0,void 0,function(){var f,g,k,m,l,p,n,r,q,w,t,v,u,y,x;return h(this,function(h){switch(h.label){case 0:f=this.acquireRenderer(c.type,d.slicePlaneEnabled||!1);g=b.modelTransform;k=b.origin;m=b.indices;l=b.position;p=l.data.length/l.strideIdx;n=G.EdgeInputBufferLayout.createBuffer(p);for(r=0;r<p;r++)n.position.set(r,
0,l.data[l.offsetIdx+r*l.strideIdx+0]),n.position.set(r,1,l.data[l.offsetIdx+r*l.strideIdx+1]),n.position.set(r,2,l.data[l.offsetIdx+r*l.strideIdx+2]);q=this.createComponentBuffers([c]);L.fillComponenBufferIndices(q.meta,[0,n.componentIndex.count],n.componentIndex);return[4,this.extractEdges(f.writerSettings,n,!1,e,m)];case 1:return w=h.sent(),t=this.createEdgeResources(w),v=t.regular,u=t.silhouette,y=(v?v.vao.size:0)+(u?u.vao.size:0),x={regular:v,silhouette:u,transform:{modelMatrix:g,origin:k},statistics:{gpuMemoryUsage:y,
averageEdgeLength:w.averageEdgeLength},components:q,visible:!0,edgeTransparency:L.determineEdgeTransparency(q.meta),objectTransparency:L.determineObjectTransparency(q.meta),distanceToCamera:0,rendererKey:f.key},a.renderables.push(x),f.addRenderable(x),this.gpuMemoryUsage+=y,[2]}})})};b.prototype.addComponentGeometry=function(a,b,c,d,e,g,k){return f(this,void 0,void 0,function(){var f,m,l,p,n,r,q,w,t,v,u;return h(this,function(h){switch(h.label){case 0:return f=L.determineRendererType(g),m=this.acquireRenderer(f,
k.slicePlaneEnabled||!1,!1),l=G.EdgeInputBufferLayout.createBuffer(c.count),x.vec3.copy(l.position,c),p=this.createComponentBuffers(g),L.fillComponenBufferIndices(p.meta,e,l.componentIndex,d),n=m.writerSettings,[4,this.extractEdges(n,l,!0,!1,d)];case 1:return r=h.sent(),q=this.createEdgeResources(r),w=q.regular,t=q.silhouette,v=(w?w.vao.size:0)+(t?t.vao.size:0),u={regular:w,silhouette:t,transform:a,statistics:{gpuMemoryUsage:v,averageEdgeLength:r.averageEdgeLength},components:p,visible:!0,edgeTransparency:L.determineEdgeTransparency(p.meta),
objectTransparency:L.determineObjectTransparency(p.meta),distanceToCamera:0,rendererKey:m.key},b.renderables.push(u),m.addRenderable(u),this.gpuMemoryUsage+=v,[2]}})})};b.prototype.canMergeGeometries=function(b){for(var c=null,d=null,e=0;e<b.geometries.length;e++){var f=b.geometryRecords[e];if(f.material.supportsEdges){if(b.geometries[e].data instanceof C)return!1;if(!c)c=f.transformation;else if(!a.equals(c,f.transformation))return!1;if(!d&&f.origin)d=f;else if(d&&f.origin&&d.origin.id!==f.origin.id)return!1}}return!0};
b.prototype.addObjectMergedGeometries=function(a,b,c,d){return f(this,void 0,void 0,function(){var e,f,g,m,l,n,r,q,w,t,v,u,y,x,A,B,C,E,H,G,O;return h(this,function(h){switch(h.label){case 0:e=new Map;f=0;m=g=null;for(l=0;l<a.geometries.length;l++)if(n=a.geometries[l],r=a.geometryRecords[l],q=r.material,q.supportsEdges&&(!m&&r.origin&&(m=r),w=n.data.getIndices("position"),f+=w?w.length:0,w&&null==g||g===Uint16Array))g=k.isUint16Array(w)?Uint16Array:Uint32Array;t=f?new g(f):null;v=[];for(l=u=0;l<a.geometries.length;l++)if(n=
a.geometries[l],y=a.geometryRecords[l],q=y.material,q.supportsEdges){x=n.data.getAttribute("position");w=n.data.getIndices("position");A=e.get(x.data);if(null==A){A=v.length/3;for(B=x.offsetIdx;B<x.data.length;B+=x.strideIdx)v.push(x.data[B+0]),v.push(x.data[B+1]),v.push(x.data[B+2]);e.set(x.data,A)}if(w)for(C=0;C<w.length;C++)t[u++]=A+w[C]}E=m||a.geometryRecords[0];H=this.computeModelTransformWithLocalOrigin(a,E,p.mat4f64.create());G=E.origin;for(l=0;l<a.geometryRecords.length;l++)a.geometryRecords[l].origin=
G;O={position:{data:v,offsetIdx:0,strideIdx:3},indices:t,modelTransform:H,origin:G};return[4,this.addNonPreinterleaved(b,O,c[0],d)];case 1:return h.sent(),[2]}})})};b.prototype.acquireRenderer=function(a,b,c){void 0===c&&(c=!0);var d=K.EdgeRenderer.getKey(a,b,c),e=this.renderers.get(d);this.strokesTexture||(this.strokesTexture=H.generateStrokesTexture(this.rctx));e||(e=new K.EdgeRenderer(this.rctx,this.techniqueRepository,{type:a,slicePlaneEnabled:b,strokesTexture:this.strokesTexture,legacy:c}),this.renderers.set(d,
e));e.refCount.increment();return e};b.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);"origin"in a.transform&&this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};b.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;u.vec3.set(this.tmpCameraPosition,
a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){c="getCenter"in c?c.getCenter():a.center;var d=u.vec3.distance(c,b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};b.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.regular){var f=L.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));
a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};b.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette){var f=L.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);"origin"in e.transform&&(b.view=d.localOrigins.getViewMatrix(e.transform.origin));a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}},c.transparency)};return b}();b.EdgeView=q})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.applyToModelMatrix=function(b,f){var h=-b[0],a=-b[1];b=-b[2];var e=f[3],d=f[7],k=f[11],l=f[15];f[0]+=e*h;f[1]+=e*a;f[2]+=e*b;f[4]+=d*h;f[5]+=d*a;f[6]+=d*b;f[8]+=k*h;f[9]+=k*a;f[10]+=k*b;f[12]+=l*h;f[13]+=l*a;f[14]+=l*b};b.applyToViewMatrix=function(b,f){var h=b[0],a=b[1];b=b[2];f[12]+=h*f[0]+a*f[4]+b*f[8];f[13]+=h*f[1]+a*f[5]+b*f[9];f[14]+=h*f[2]+a*f[6]+b*f[10];f[14]+=h*f[3]+a*f[7]+b*f[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a){this.factory=a;this.originData=new Map}a.prototype.acquire=function(a){return this.register(this.factory.getOrigin(a))};a.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:f.mat4f64.create(),origin:a});
return a};a.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};a.prototype.updateViewMatrices=function(a){this.originData.forEach(function(b){l.mat4.copy(b.viewMatrix,a);h.applyToViewMatrix(b.origin.vec3,b.viewMatrix)})};a.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return a}();b.LocalOriginManager=q})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define("require exports ../../../../core/compilerUtils ./ComponentUtils ./geometryDataUtils ../../../webgl/Util".split(" "),
function(q,b,l,f,h,a){function e(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:l.neverReached(a)}}return function(){function b(d,l,c,g,r){void 0===c&&(c=null);void 0===g&&(g=b.DefaultOffsets);void 0===r&&(r=b.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var k=a.getStride(l)/4,k=
d.length/k;this._hasDefaultIndices=r===b.DefaultIndices;this.indexCount=r.length;this._hasDefaultIndices&&(r=h.generateDefaultIndexArray(k),this.indexCount=k);for(var k={},n=0;n<l.length;n++){var q=l[n],x=new (e(q.type))(d.buffer),v=a.getBytesPerElement(q.type);k[q.name]={data:x,size:q.count,offsetIdx:q.offset/v,strideIdx:q.stride/v}}c&&(this._positionData=c,k.position={data:c.data,size:3,offsetIdx:0,strideIdx:3});this._id=h.getNewId();this._vertexData=d;this._vertexAttributes=k;this._layout=l;this._indexData=
r;this._componentOffsets=f.createOffsets(g);this._gpuMemoryUsage=d.byteLength+(this._hasDefaultIndices?0:r.byteLength)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});b.prototype.toRenderData=function(){var a=
{id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this.indexCount,vertexData:this._vertexData,layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};b.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=
function(){return this._gpuMemoryUsage};Object.defineProperty(b.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});b.DefaultOffsets=new Uint32Array(0);b.DefaultIndices=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.EdgeInputBufferLayout=
f.newLayout().vec3f("position").u16("componentIndex").u16("_padding");b.VertexLayout=f.newLayout().vec2u8("sideness");b.glVertexLayout=l.glLayout(b.VertexLayout);b.CommonInstancesLayout=f.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0});b.RegularEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normal");b.SilhouetteEdgeInstancesLayout=
b.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");b.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});var n=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,d){var e=c;e[0]=d.position0[0];e[1]=d.position0[1];e[2]=d.position0[2];e[3]=d.position1[0];e[4]=d.position1[1];e[5]=d.position1[2];r[0]=5381;for(e=0;e<g.length;e++)r[0]=31*r[0]+g[e];p.seed=r[0];var e=p.getIntRange(0,255),f=p.getIntRange(0,this.settings.variants-1),k=p.getFloat(),k=-(1-Math.min(k/.7,1))+Math.max(0,
k-.7)/(1-.7),k=255*(Math.pow(Math.abs(k),1.2)*(0>k?-1:1)*.5+.5);a.position0.setVec(b,d.position0);a.position1.setVec(b,d.position1);a.componentIndex.set(b,d.componentIndex);a.variantOffset.set(b,e);a.variantStroke.set(b,f);a.variantExtension.set(b,k)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();b.CommonBufferWriter=n;var c=new Float32Array(6),g=new Uint32Array(c.buffer),r=new Uint32Array(1),p=new h;q=function(){function b(){this.commonWriter=new n}b.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
b.prototype.allocate=function(a){return k.RegularEdgeInstancesLayout.createBuffer(a)};b.prototype.write=function(b,c,d){this.commonWriter.write(b,c,d);a.vec3.add(u,d.faceNormal0,d.faceNormal1);a.vec3.normalize(u,u);b.normal.setVec(c,u)};b.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};b.Layout=k.RegularEdgeInstancesLayout;b.glLayout=d.glLayout(k.RegularEdgeInstancesLayout,{divisor:1});return b}();b.RegularEdgeBufferWriter=q;q=function(){function a(){this.commonWriter=new n}a.prototype.updateSettings=
function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return k.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=k.SilhouetteEdgeInstancesLayout;a.glLayout=d.glLayout(k.SilhouetteEdgeInstancesLayout,{divisor:1});return a}();b.SilhouetteEdgeBufferWriter=q;var u=e.vec3f64.create()})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(q,b,l,f,h,a,e,d,k,n,c){return function(){function b(){this.regularWriter=
new n.RegularEdgeBufferWriter;this.silhouetteWriter=new n.SilhouetteEdgeBufferWriter}b.prototype.process=function(a,b){return l(this,void 0,void 0,function(){var c,d,e;return f(this,function(f){switch(f.label){case 0:if(!b)return[3,2];c=[];d=this.packInput(a,c);this.wrappedWork;return[4,b.invoke("wrappedWork",d,{transferList:c})];case 1:return e=f.sent(),[2,this.unpackOutput(e)];case 2:return[2,this.work(a)]}})})};b.prototype.wrappedWork=function(a){return l(this,void 0,void 0,function(){var b,c,
d,e;return f(this,function(f){b=this.unpackInput(a);c=this.work(b);d=[];this.packInputTransferables(b,d);e=this.packOutput(c,d);return[2,{result:e,transferList:d}]})})};b.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return c.extractEdges(b,this.regularWriter,this.silhouetteWriter)};b.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};
b.prototype.packInput=function(a,b){this.packInputTransferables(a,b);b={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(b.originalIndicesBuffer=a.originalIndices.buffer,b.originalIndicesType=h.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return b};b.prototype.unpackInput=function(a){return{data:k.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):
"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};b.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:d.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:d.packInterleavedBuffer(a.silhouette.instancesData,b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},
averageEdgeLength:a.averageEdgeLength}};b.prototype.unpackOutput=function(a){return{regular:{instancesData:d.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:d.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};b.prototype.extractEdgeInformation=function(b,c,d){if(c&&d)return c=e.computeNeighbors(d,b.count),
{faces:d,neighbors:c,vertices:b};b=a.default(b.buffer,b.stride/4,{originalIndices:d});c=e.computeNeighbors(b.indices,b.uniqueCount);return{faces:b.indices,neighbors:c,vertices:k.EdgeInputBufferLayout.createView(b.buffer)}};return b}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeNeighbors=function(b,f){for(var h=b.length/3,a=new Uint32Array(f+1),e=new Uint32Array(f+1),d=function(b,c){b<c?a[b+
1]++:e[c+1]++},k=0;k<h;k++){var l=b[3*k],c=b[3*k+1],g=b[3*k+2];d(l,c);d(c,g);d(g,l)}for(k=c=l=0;k<f;k++)g=a[k+1],d=e[k+1],a[k+1]=l,e[k+1]=c,l+=g,c+=d;for(var r=new Uint32Array(6*h),p=a[f],d=function(b,c,d){if(b<c){var f=a[b+1]++;r[2*f]=c;r[2*f+1]=d}else f=e[c+1]++,r[2*p+2*f]=b,r[2*p+2*f+1]=d},k=0;k<h;k++)l=b[3*k],c=b[3*k+1],g=b[3*k+2],d(l,c,k),d(c,g,k),d(g,l,k);l=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=r[c+2*b],e=r[c+2*b+1],f=b-1;for(f;0<=f&&r[c+2*f]>d;f--)r[c+2*f+2]=r[c+2*f],r[c+2*f+
3]=r[c+2*f+1];r[c+2*f+2]=d;r[c+2*f+3]=e}};for(k=0;k<f;k++)l(a[k],a[k+1]),l(p+e[k],p+e[k+1]);for(var q=new Int32Array(3*h),t=function(a,c){return a===b[3*c]?0:a===b[3*c+1]?1:a===b[3*c+2]?2:-1},h=function(a,b){a=t(a,b);q[3*b+a]=-1},l=function(a,b,c,d){a=t(a,b);q[3*b+a]=d;c=t(c,d);q[3*d+c]=b},k=0;k<f;k++){for(var c=a[k],g=a[k+1],d=e[k],x=e[k+1];c<g&&d<x;){var v=r[2*c],y=r[2*p+2*d];v===y?(l(k,r[2*c+1],y,r[2*p+2*d+1]),c++,d++):v<y?(h(k,r[2*c+1]),c++):(h(y,r[2*p+2*d+1]),d++)}for(;c<g;)h(k,r[2*c+1]),c++;
for(;d<x;)y=r[2*p+2*d],h(y,r[2*p+2*d+1]),d++}return q}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(q,b,l,f,h){function a(a){var b=[];a.fields.forEach(function(a,d){var c=a.constructor;a=l({},a,{constructor:c.ElementType+"_"+c.ElementCount});b.push([d,a])});return{stride:a.stride,fields:b,fieldNames:a.fieldNames}}function e(a){var b=h.newLayout();b.stride=a.stride;b.fieldNames=
a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],l({},a[1],{constructor:d.get(a[1].constructor)}))});return b}Object.defineProperty(b,"__esModule",{value:!0});b.packInterleavedBuffer=function(b,d){d.push(b.buffer);return{buffer:b.buffer,layout:a(b.layout)}};b.unpackInterleavedBuffer=function(a){return e(a.layout).createView(a.buffer)};b.packLayout=a;b.unpackLayout=e;q=[f.BufferViewFloat,f.BufferViewVec2f,f.BufferViewVec3f,f.BufferViewVec4f,f.BufferViewMat3f,f.BufferViewMat4f,f.BufferViewFloat64,
f.BufferViewVec2f64,f.BufferViewVec3f64,f.BufferViewVec4f64,f.BufferViewMat3f64,f.BufferViewMat4f64,f.BufferViewUint8,f.BufferViewVec2u8,f.BufferViewVec3u8,f.BufferViewVec4u8,f.BufferViewUint16,f.BufferViewVec2u16,f.BufferViewVec3u16,f.BufferViewVec4u16,f.BufferViewUint32,f.BufferViewVec2u32,f.BufferViewVec3u32,f.BufferViewVec4u32,f.BufferViewInt8,f.BufferViewVec2i8,f.BufferViewVec3i8,f.BufferViewVec4i8,f.BufferViewInt16,f.BufferViewVec2i16,f.BufferViewVec3i16,f.BufferViewVec4i16,f.BufferViewInt32,
f.BufferViewVec2i32,f.BufferViewVec3i32,f.BufferViewVec4i32];var d=new Map;q.forEach(function(a){return d.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),function(q,b,l,f,h,a,e,d){function k(b,
c){var e=f.acosClamped(b.cosAngle),k=g.fwd,h=g.ortho;d.directionFromTo(k,b.position1,b.position0);b=0<a.vec3.dot(a.vec3.cross(h,b.faceNormal0,b.faceNormal1),k)?-1:1;return e*b>c}function n(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],g=a[3*e+1],k=a[3*e+2],h=c[3*e+0],l=c[3*e+1],p=c[3*e+2],d=d+(-1===f||h<l?1:0),d=d+(-1===g||l<p?1:0),d=d+(-1===k||p<h?1:0);for(var d=new Int32Array(4*d),n=0,e=0;e<b;e++){f=a[3*e+0];g=a[3*e+1];k=a[3*e+2];h=c[3*e+0];l=c[3*e+1];
p=c[3*e+2];if(-1===f||h<l)d[n++]=h,d[n++]=l,d[n++]=e,d[n++]=f;if(-1===g||l<p)d[n++]=l,d[n++]=p,d[n++]=e,d[n++]=g;if(-1===k||p<h)d[n++]=p,d[n++]=h,d[n++]=e,d[n++]=k}return d}function c(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var e=r.v0,f=r.v1,g=r.v2,k=new Float32Array(3*c),h=0;h<c;h++){var l=b[3*h+1],p=b[3*h+2];d.getVec(b[3*h+0],e);d.getVec(l,f);d.getVec(p,g);a.vec3.subtract(f,f,e);a.vec3.subtract(g,g,e);a.vec3.cross(e,f,g);a.vec3.normalize(e,e);k[3*h+0]=e[0];k[3*h+1]=e[1];k[3*
h+2]=e[2]}return k}Object.defineProperty(b,"__esModule",{value:!0});b.extractEdges=function(b,d,e,r){void 0===r&&(r=p);var q=b.vertices.position,m=b.vertices.componentIndex,w=f.deg2rad(r.anglePlanar);r=f.deg2rad(r.angleSignificantEdge);var t=Math.cos(r),v=Math.cos(w),u=g.edge,x=u.position0,G=u.position1,J=u.faceNormal0,I=u.faceNormal1,K=c(b),H=n(b),L=H.length/4;b=d.allocate(L);r=0;var P=e.allocate(L),S=0,R=0,O=0,Q=l.range(0,L),T=new Float32Array(L);h.forEach(T,function(b,c,d){q.getVec(H[4*c+0],x);
q.getVec(H[4*c+1],G);d[c]=a.vec3.distance(x,G)});Q.sort(function(a,b){return T[b]-T[a]});for(var Y=[],N=[],Z=0;Z<L;Z++){var W=Q[Z],aa=T[W],V=H[4*W+0],F=H[4*W+1],ca=H[4*W+2],W=H[4*W+3],U=-1===W;q.getVec(V,x);q.getVec(F,G);if(U)a.vec3.set(J,K[3*ca+0],K[3*ca+1],K[3*ca+2]),a.vec3.copy(I,J),u.componentIndex=m.get(V),u.cosAngle=a.vec3.dot(J,I);else{a.vec3.set(J,K[3*ca+0],K[3*ca+1],K[3*ca+2]);a.vec3.set(I,K[3*W+0],K[3*W+1],K[3*W+2]);u.componentIndex=m.get(V);u.cosAngle=a.vec3.dot(J,I);if(u.cosAngle>v)continue;
-.9999>u.cosAngle&&a.vec3.copy(I,J)}R+=aa;O++;U||u.cosAngle<t?(d.write(b,r++,u),Y.push(aa)):k(u,w)&&(e.write(P,S++,u),N.push(aa))}m=new Float32Array(Y.reverse());w=new Float32Array(N.reverse());return{regular:{instancesData:d.trim(b,r),lodInfo:{lengths:m}},silhouette:{instancesData:e.trim(P,S),lodInfo:{lengths:w}},averageEdgeLength:R/O}};var g={edge:{position0:e.vec3f64.create(),position1:e.vec3f64.create(),faceNormal0:e.vec3f64.create(),faceNormal1:e.vec3f64.create(),componentIndex:0,cosAngle:0},
ortho:e.vec3f64.create(),fwd:e.vec3f64.create()},r={v0:e.vec3f64.create(),v1:e.vec3f64.create(),v2:e.vec3f64.create()},p={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/mathUtils ../../../../../core/PooledArray ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f32 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../collections/Component/Material/ComponentTechnique ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});b.LINE_WIDTH_FRACTION_FACTOR=8;b.EXTENSION_LENGTH_OFFSET=128;var x={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0},v=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}(),
y={solid:0,sketch:1,uber:2};q=function(){function d(b,c,e){var f,g,k;this.rctx=b;this.shaderTechniqueRepository=c;this.config=new t.EdgeShaderTechnique.Configuration;this.technique=null;this.refCount=new v;this.renderables=new Set;this.sortedRenderables=(f={},f[1]=(g={},g[1]=new a,g[2]=new a,g),f[2]=(k={},k[1]=new a,k[2]=new a,k),f);this.renderablesDirty=!1;this.settings=l({},x,e);this.key=d.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants};
this.config.legacy=this.settings.legacy;this.config.mode=y[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=p.doublePrecisionRequiresObfuscation(b)}d.prototype.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};d.prototype.addRenderable=function(a){this.renderables.add(a);
this.renderablesDirty=!0};d.prototype.removeRenderable=function(a){this.renderables.delete(a);this.renderablesDirty=!0};d.prototype.setRenderablesDirty=function(){this.renderablesDirty=!0};d.prototype.forEachRenderable=function(a,b){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[b][1].forEach(a);this.sortedRenderables[b][2].forEach(a)};d.prototype.bindRegularEdges=function(a,b){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(t.EdgeShaderTechnique,
this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};d.prototype.bindSilhouetteEdges=function(a,b){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(t.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{renderParameters:a,edgeRenderParameters:b});this.rctx.setPipelineState(this.technique.pipeline);
this.rctx.bindProgram(this.technique.program)};d.prototype.renderRegularEdges=function(a,b,c){this.render(this.technique.program,a,a.regular.vao,b,c)};d.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.technique.program,a,a.silhouette.vao,b,c)};d.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);this.rctx.bindVAO(c);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,e)};d.prototype.setUniforms=function(a,d,f){d.components.buffer.textureBuffer.bind(a,b.componentDataBindParameters);
if("origin"in d.transform)a.setUniformMatrix4fv("uView",f.view),a.setUniformMatrix4fv("uModel",d.transform.modelMatrix),g.Slice.bindUniforms(a,this.settings,f.slicePlane,d.transform.origin.vec3);else{var h=new u.TwoVectorPosition(d.transform.position),l=e.mat3.transpose(m,e.mat3.invert(m,d.transform.rotationScale)),p=new c.ComponentDrawParameters;k.vec3.copy(p.worldFromModel_TL,h.low);k.vec3.copy(p.worldFromModel_TH,h.high);e.mat3.copy(p.worldFromModel_RS,d.transform.rotationScale);e.mat3.copy(p.transformNormal_GlobalFromModel,
l);r.VertexPosition.bindModelTransform(a,p);a.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",p.transformNormal_GlobalFromModel);d=f.viewInvTransp;d=k.vec3.set(w,d[3],d[7],d[11]);g.Slice.bindUniforms(a,this.settings,f.slicePlane,d)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(f.fovY/2)/(f.viewport[3]/2))};d.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,c=b.texture;this.rctx.bindTexture(c,
0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/c.descriptor.width,1/c.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",h.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};d.prototype.sortRenderables=function(){var a=this;this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();
this.sortedRenderables[2][2].clear();this.renderables.forEach(function(b){switch(b.objectTransparency){case 1:case 2:switch(b.edgeTransparency){case 1:case 2:a.sortedRenderables[b.objectTransparency][b.edgeTransparency].push(b)}}});var b=function(a,b){return"origin"in a.transform&&"origin"in b.transform?a.transform.origin.id<b.transform.origin.id?-1:a.transform.origin.id>b.transform.origin.id?1:0:0};this.sortedRenderables[1][1].sort(b);this.sortedRenderables[1][2].sort(b);this.sortedRenderables[2][1].sort(b);
this.sortedRenderables[2][2].sort(b)};d.getKey=function(a,b,c){return"edges-t:"+a+":"+b+":"+c};return d}();b.EdgeRenderer=q;b.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2};var m=d.mat3f32.create(),w=n.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../webgl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl ../../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});d=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);d.prototype.bindPass=function(b,c){b=this.program;var d=c.edgeRenderParameters;c=c.renderParameters;a.VertexPosition.bindViewProjTransform(b,d.viewProjectionTransform);b.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",d.transformNormal_ViewFromGlobal);b.setUniformMatrix4fv("uProj",c.proj);b.setUniform2f("uDepthBias",.5,-4E-4);b.setUniform2f("uPixelToNDC",
2/c.viewport[2],2/c.viewport[3]);b.setUniform2f("uNDCToPixel",c.viewport[2]/2,c.viewport[3]/2);b.setUniform1f("uDistanceFalloffFactor",d.distanceFalloffFactor);b.setUniform2f("uViewportDimInv",1/c.viewport[2],1/c.viewport[3]);b.setUniform1f("uPixelRatio",c.pixelRatio||1)};d.prototype.initializeProgram=function(a){var b=d.shader.get(),c=this.configuration,c=b.build({slicePlaneEnabled:c.slicePlaneEnabled,sliceHighlightDisabled:c.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,silhouette:c.silhouette,
legacy:c.legacy,antialiasing:c.antialiasing,mode:c.mode,doublePrecisionRequiresObfuscation:c.doublePrecisionRequiresObfuscation});return new h.Program(a.rctx,c.generateSource("vertex"),c.generateSource("fragment"),b.attributeLocations)};d.prototype.initializePipeline=function(a){return(a=a.rctx.capabilities.blendMinMax)?c.makePipelineState({blending:c.separateBlendingParams(1,1,0,1,32774,a.MAX),depthTest:{func:515},colorWrite:c.defaultColorWriteParams}):c.makePipelineState({depthTest:{func:515},depthWrite:c.defaultDepthWriteParams,
colorWrite:c.defaultColorWriteParams})};d.shader=new e.ReloadableShaderModule(n,"../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl",q);return d}(d.ShaderTechnique);b.EdgeShaderTechnique=d;(function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.slicePlaneEnabled=!1;b.sliceHighlightDisabled=!1;b.silhouette=!1;b.legacy=!1;b.antialiasing=!1;b.mode=0;b.doublePrecisionRequiresObfuscation=!1;return b}l(b,a);f([k.parameter()],b.prototype,"slicePlaneEnabled",void 0);
f([k.parameter()],b.prototype,"sliceHighlightDisabled",void 0);f([k.parameter()],b.prototype,"silhouette",void 0);f([k.parameter()],b.prototype,"legacy",void 0);f([k.parameter()],b.prototype,"antialiasing",void 0);f([k.parameter({count:3})],b.prototype,"mode",void 0);f([k.parameter()],b.prototype,"doublePrecisionRequiresObfuscation",void 0);return b}(k.ShaderTechniqueConfiguration);a.Configuration=b})(d=b.EdgeShaderTechnique||(b.EdgeShaderTechnique={}));b.EdgeShaderTechnique=d})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeShaderProgram.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderModules/interfaces ../../../core/shaderModules/ShaderBuilder ./AdjustProjectedPosition.glsl ./DiscardByCoverage.glsl ./DiscardNonSilhouetteEdges.glsl ./DiscardShortEdges.glsl ./EdgeUtil.glsl ./LineAmplitude.glsl ./LineOffset.glsl ./UnpackAttributes.glsl".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLocations={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};b.build=function(b){var m=new a.ShaderBuilder,q=m.vertex,y=m.fragment;b.legacy&&q.uniforms.add("uModel","mat4");b.antialiasing&&(q.code.add(h.glsl(u||(u=l(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))),
y.code.add(h.glsl(t||(t=l(["\n      #define ANTIALIASING 1\n    "],["\n      #define ANTIALIASING 1\n    "])))));m.include(e.AdjustProjectedPosition,b);m.include(g.LineAmplitude,b);m.include(c.EdgeUtil,b);m.include(p.UnpackAttributes,b);m.include(r.LineOffset,b);m.include(f.Slice,b);m.include(k.DiscardNonSilhouetteEdges,b);m.include(d.DiscardByCoverage,b);m.include(n.DiscardShortEdges,b);m.varyings.add("vColor","vec4");m.varyings.add("vRadius","float");m.varyings.add("vPosition","vec3");m.varyings.add("vWorldPosition",
"vec3");m.varyings.add("vLineLengthPixels","float");m.varyings.add("vSizeFalloffFactor","float");q.uniforms.add("uPixelToNDC","vec2");q.uniforms.add("uNDCToPixel","vec2");q.uniforms.add("uPixelRatio","float");m.attributes.add("position0","vec3");m.attributes.add("position1","vec3");m.attributes.add("variantOffset","float");m.attributes.add("variantStroke","float");m.attributes.add("variantExtension","float");q.code.add(h.glsl(x||(x=l(["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n      }\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "],
["\n    const float opaqueCutoff \x3d 1.0 / 255.0;\n\n    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\n      vec2 sideness \x3d unpackedAttributes.sideness;\n      vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n      vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\n\n      vec3 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\n\n      vec4 projPosV0 \x3d projFromViewPosition(viewPosV0);\n      vec4 projPosV1 \x3d projFromViewPosition(viewPosV1);\n      vec4 projPos \x3d projFromViewPosition(viewPos);\n\n      vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\n      vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\n      float lineLengthPixels \x3d length(screenSpaceLinePixels);\n\n      float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\n      vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\n\n      float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\n      float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\n\n      float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\n      float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\n\n      vSizeFalloffFactor \x3d falloffFactor;\n\n      float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\n      float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\n\n    #ifdef ANTIALIASING\n      const float aaPaddingPixels \x3d 1.0;\n\n      // Line size with padding\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\n      float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\n    #else /* ANTIALIASING */\n\n      // Even if there is no AA, we still want to do proper \x3c1px rendering,\n      // so we effectively clamp the pixel sizes to minimum of 1px and compute\n      // coverage in the fragment shader\n      float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\n      float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\n    #endif /* ANTIALIASING */\n\n      // Half line width in NDC including padding for anti aliasing\n      vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\n      vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\n      vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\n\n      // Compute screen space position of vertex, offsetting for line size and end caps\n      vec2 ndcOffset \x3d (\n          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\n        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\n      );\n\n      projPos.xy +\x3d ndcOffset * projPos.w;\n      projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\n\n      projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\n\n      // Line length with end caps\n      float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\n\n      float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\n\n      // Position in pixels with origin at first vertex of line segment\n      vPosition \x3d vec3(\n        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\n        pixelPositionAlongLine,\n        pixelPositionAlongLine / extendedLineLengthPixels\n      );\n\n      // The line width radius in pixels\n      vRadius \x3d lineWidthPixels * 0.5;\n      vLineLengthPixels \x3d extendedLineLengthPixels;\n\n      // Discard fully transparent edges\n      if (vColor.a \x3c opaqueCutoff) {\n        gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n      }\n\n      // discard edges below a certain length threshold\n      discardShortEdges(unpackedAttributes, lineLengthPixels);\n\n      gl_Position \x3d projPos;\n    }\n\n    void main() {\n      ComponentData component \x3d readComponentData();\n      UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\n\n      vec3 worldPosV0 \x3d worldFromModelPosition(position0);\n      vec3 worldPosV1 \x3d worldFromModelPosition(position1);\n      vec3 viewPosV0 \x3d viewFromModelPosition(position0);\n      vec3 viewPosV1 \x3d viewFromModelPosition(position1);\n\n      // Component color\n      vColor \x3d component.color;\n\n      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {\n        return;\n      }\n\n      // General geometric computation for all types of edges\n      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);\n\n      // Specific computation for different edge styles\n      calculateStyleOutputs(unpackedAttributes);\n    }\n  "]))));
m.fragment.code.add(h.glsl(v||(v=l(["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "],
["\n    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\n      float lineOffset \x3d calculateLineOffset();\n      float positionX \x3d position.x - lineOffset;\n\n      if (radius \x3c 1.0) {\n        // Handle this specifically for subpixel sizes:\n        // 1. Compute correct coverage (note coverage is computed by\n        //    0.5 - dist, so we make sure that that will lead to correct\n        //    subpixel coverage\n        // 2. Ignore rounded caps\n        float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\n        float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\n\n        float coverage \x3d min(coverageX, coverageY);\n\n        return vec2(0.5 - coverage, 0.0);\n      }\n      else {\n        // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\n        float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\n\n        vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\n        return vec2(length(lineToPosition) - radius, positionOnCap / radius);\n      }\n    }\n\n    void main() {\n      float radius \x3d vRadius * calculateLinePressure();\n\n      vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\n      float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\n\n      discardByCoverage(radius, coverage);\n      discardBySlice(vWorldPosition);\n\n      float alpha \x3d vColor.a * coverage;\n\n      gl_FragColor \x3d vec4(vColor.rgb, alpha);\n\n    }\n  "]))));
return m};var u,t,x,v})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/interfaces".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.AdjustProjectedPosition=function(b,c){b.include(h.IsNaN);b.include(f.VertexPosition,
c);b=b.vertex;b.uniforms.add("uDepthBias","vec2");b.uniforms.add("uViewportDimInv","vec2");c.legacy?(b.uniforms.add("uView","mat4"),b.uniforms.add("uProj","mat4")):b.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");c.legacy?b.code.add(a.glsl(e||(e=l(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uProj * uView * vec4(globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "])))):
b.code.add(a.glsl(d||(d=l(["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "],
["\n      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {\n        float offsetXY \x3d uDepthBias.x;\n        float offsetZ  \x3d uDepthBias.y;\n\n        // screen space pixel offset\n        // we multiply by two to account for the fact that NDC go from -1 to 1\n        // we multiply by projPos.w to compensate for the perspective division that happens later\n        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\n        // towards the camera\n        vec4 projNormal \x3d uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);\n\n        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\n      }\n    "]))));
b.code.add(a.glsl(k||(k=l(["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "],
["\n    // A z-offset, using a depth based heuristic.\n    float _calculateProjectedBiasZ(vec4 projPos) {\n      float offsetZ \x3d uDepthBias.y;\n      return sqrt(projPos.z) * offsetZ;\n    }\n\n    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\n      vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\n\n      // we currently have to do this check because some geometries come with 0 length edge normals.\n      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\n      if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\n        projPos.xy +\x3d offsetXY;\n      }\n\n      projPos.z +\x3d _calculateProjectedBiasZ(projPos);\n\n      return projPos;\n    }\n  "]))))};
var e,d,k})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.IsNaN=function(a){var b=f.glsl(h||(h=l(["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "],
["\n    bool isNaN( float val )\n    {\n      return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\n      // important: some nVidias failed to cope with version below.\n      // Probably wrong optimization.\n      /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\n    }\n  "])));a.fragment.code.add(b);a.vertex.code.add(b)};var h})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper",
"../../../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardByCoverage=function(b,d){b=b.fragment;b.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01);d.antialiasing?b.code.add(f.glsl(h||(h=l(["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { if (coverage \x3c COVERAGE_TEST_THRESHOLD) discard; }\n    "])))):b.code.add(f.glsl(a||
(a=l(["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "],["\n      #define discardByCoverage(radius, coverage) { float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage \x3c coverageLimit) discard; }\n    "]))))};var h,a})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardNonSilhouetteEdges=function(b,n){b=b.vertex;n.silhouette?(b.code.add(f.glsl(h||(h=l(["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "],
["\n      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {\n        float faceAVisible \x3d dot(viewDir, normalA);\n        float faceBVisible \x3d dot(viewDir, normalB);\n        return faceAVisible * faceBVisible \x3c 0.0;\n      }\n    "])))),n.legacy?b.code.add(f.glsl(a||(a=l(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 viewNormalA \x3d _modelToViewNormal(normalA);\n          vec3 viewNormalB \x3d _modelToViewNormal(normalB);\n          vec3 viewDir \x3d -viewPos;\n\n          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "])))):b.code.add(f.glsl(e||(e=l(["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "],
["\n        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n          vec3 worldNormalA \x3d _modelToWorldNormal(normalA);\n          vec3 worldNormalB \x3d _modelToWorldNormal(normalB);\n          vec3 viewDir \x3d -worldPos;\n\n          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {\n            return false;\n          }\n\n          gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\n          return true;\n        }\n      "]))))):b.code.add(f.glsl(d||(d=l(["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "],
["\n      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {\n        return false;\n      }\n    "]))))};var h,a,e,d})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.DiscardShortEdges=function(b,k){b=b.vertex;switch(k.mode){case 1:b.code.add(f.glsl(h||
(h=l(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 2:b.code.add(f.glsl(a||(a=l(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "],
["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) { gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0); return; }}\n      "]))));break;case 0:b.code.add(f.glsl(e||(e=l(["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "],["\n        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}\n      "]))))}};var h,a,e})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["require",
"exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderLibrary/util/DoublePrecision.glsl","../../../core/shaderModules/interfaces"],function(q,b,l,f,h){function a(a,b){var q=a.vertex;q.uniforms.add("uDistanceFalloffFactor","float");q.code.add(h.glsl(e||(e=l(["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "],["\n    float distanceBasedPerspectiveFactor(float distance) {\n      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\n    }\n  "]))));
q.uniforms.add("uComponentDataTex","sampler2D");q.uniforms.add("uComponentDataTexInvDim","vec2");a.attributes.add("componentIndex","float");q.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0);q.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1);q.defines.addFloat("COMPONENT_FIELD_COUNT",2);q.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8);q.defines.addFloat("EXTENSION_LENGTH_OFFSET",128);q.defines.addFloat("COMPONENT_TEX_WIDTH",4096);q.code.add(h.glsl(d||(d=l(["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "],
["\n    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {\n      float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\n\n      float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\n      float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\n\n      vec2 linearIndex \x3d vec2(\n        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\n        (rowIndex + 0.5) * uComponentDataTexInvDim.y\n      );\n\n      return linearIndex;\n    }\n\n    struct ComponentData {\n      vec4 color;\n      float lineWidth;\n      float extensionLength;\n      float type;\n    };\n\n    ComponentData readComponentData() {\n      vec2 colorIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);\n      vec2 otherIndex \x3d _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\n\n      vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\n      vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\n\n      return ComponentData(\n        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\n        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\n        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\n        -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\n      );\n    }\n  "]))));
b.legacy?q.code.add(h.glsl(k||(k=l(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return (uModel * vec4(normal, 0.0)).xyz;\n      }\n\n      vec3 _modelToViewNormal(vec3 normal) {\n        return (uView * uModel * vec4(normal, 0.0)).xyz;\n      }\n    "])))):
(q.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),q.code.add(h.glsl(n||(n=l(["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "],["\n      vec3 _modelToWorldNormal(vec3 normal) {\n        return uTransformNormal_GlobalFromModel * normal;\n      }\n    "])))));b.silhouette?(a.attributes.add("normalA","vec3"),a.attributes.add("normalB","vec3"),q.code.add(h.glsl(c||(c=l(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "],
["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normalize(normalA + normalB));\n      }\n    "]))))):(a.attributes.add("normal","vec3"),q.code.add(h.glsl(g||(g=l(["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "],["\n      vec3 worldNormal() {\n        return _modelToWorldNormal(normal);\n      }\n    "])))));b.legacy?q.code.add(h.glsl(r||(r=l(["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        return (uModel * vec4(position, 1.0)).xyz;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uProj * vec4(position, 1.0);\n      }\n    "])))):(a.include(f.DoublePrecision,b),q.code.add(h.glsl(p||(p=l(["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "],
["\n      vec3 worldFromModelPosition(vec3 position) {\n        vec3 rotatedModelPosition \x3d uTransform_WorldFromModel_RS * position;\n\n        vec3 transform_CameraRelativeFromModel \x3d dpAdd(\n          uTransform_WorldFromModel_TL,\n          uTransform_WorldFromModel_TH,\n          -uTransform_WorldFromView_TL,\n          -uTransform_WorldFromView_TH\n        );\n\n        return transform_CameraRelativeFromModel + rotatedModelPosition;\n      }\n\n      vec3 viewFromModelPosition(vec3 position) {\n        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);\n      }\n\n      vec4 projFromViewPosition(vec3 position) {\n        return uTransform_ProjFromView * vec4(position, 1.0);\n      }\n    "])))));
q.code.add(h.glsl(u||(u=l(["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "],["\n    float calculateExtensionLength(float extensionLength, float lineLength) {\n      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\n    }\n  "]))))}Object.defineProperty(b,"__esModule",{value:!0});b.EdgeUtil=a;(function(a){a.usesSketchLogic=function(a){return 1===a.mode||
2===a.mode};a.usesSolidLogic=function(a){return 0===a.mode||2===a.mode}})(a=b.EdgeUtil||(b.EdgeUtil={}));var e,d,k,n,c,g,r,p,u})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.LineAmplitude=function(b,c){var g=b.vertex;
b.include(a.UnpackAttributes,c);h.EdgeUtil.usesSketchLogic(c)&&g.uniforms.add("uStrokesAmplitude","float");switch(c.mode){case 0:g.code.add(f.glsl(e||(e=l(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return 0.0;\n        }\n      "]))));break;case 1:g.code.add(f.glsl(d||(d=l(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "],
["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          return uStrokesAmplitude;\n        }\n      "]))));break;case 2:g.code.add(f.glsl(k||(k=l(["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "],["\n        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\n          float type \x3d unpackedAttributes.type;\n\n          if (type \x3c\x3d 0.0) {\n            return uStrokesAmplitude;\n          }\n          else {\n            return 0.0;\n          }\n        }\n      "]))))}};
var e,d,k})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["require","exports","../../../../../../core/tsSupport/makeTemplateObjectHelper","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.UnpackAttributes=function(b,g){var c=b.vertex;b.include(h.EdgeUtil,g);b.attributes.add("sideness","vec2");2===g.mode?c.code.add(f.glsl(a||(a=l(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "],
["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n        float type;\n      };\n    "])))):c.code.add(f.glsl(e||(e=l(["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "],["\n      struct UnpackedAttributes {\n        vec2 sideness;\n        vec2 sidenessNorm;\n        float lineWidthPixels;\n        float extensionLengthPixels;\n      };\n  "]))));
switch(g.mode){case 2:c.code.add(f.glsl(d||(d=l(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float fType \x3d component.type;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          if (fType \x3c\x3d 0.0) {\n            extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          }\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\n        }\n      "]))));
break;case 1:c.code.add(f.glsl(k||(k=l(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],
["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))));break;case 0:c.code.add(f.glsl(n||
(n=l(["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "],["\n        UnpackedAttributes unpackAttributes(ComponentData component) {\n          vec2 sidenessNorm \x3d sideness;\n          vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\n          float extensionLengthPixels \x3d component.extensionLength;\n          float lineWidth \x3d component.lineWidth;\n\n          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\n        }\n      "]))))}};
var a,e,d,k,n})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("require exports ../../../../../../core/tsSupport/makeTemplateObjectHelper ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/interfaces ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});b.LineOffset=function(b,q){var t=b.vertex;b.include(e.UnpackAttributes,q);var y=b.fragment;b.include(f.RgbaFloatEncoding);
a.EdgeUtil.usesSketchLogic(q)&&(t.uniforms.add("uStrokesTextureScale","vec2"),t.uniforms.add("uStrokesLog2Resolution","float"),t.uniforms.add("uStrokeVariants","float"),b.varyings.add("vStrokeUV","vec2"),y.uniforms.add("uStrokesTexture","sampler2D"),y.uniforms.add("uStrokesNormalizationScale","float"),t.code.add(h.glsl(d||(d=l(["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "],
["\n      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\n        vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\n\n        float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\n\n        vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\n        vStrokeUV.x +\x3d variantOffset;\n      }\n    "])))),y.code.add(h.glsl(k||(k=l(["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "],
["\n      float calculateLineOffsetSketch() {\n        float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\n        return (offsetNorm - 0.5) * uStrokesNormalizationScale;\n      }\n\n      float calculateLinePressureSketch() {\n        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\n      }\n    "])))));switch(q.mode){case 0:t.code.add(h.glsl(n||(n=l(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}\n      "]))));
y.code.add(h.glsl(c||(c=l(["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "],["\n        float calculateLineOffset() {\n          return 0.0;\n        }\n\n        float calculateLinePressure() {\n          return 1.0;\n        }\n      "]))));break;case 1:t.code.add(h.glsl(g||(g=l(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "],
["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n        }\n      "]))));y.code.add(h.glsl(r||(r=l(["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "],["\n        float calculateLineOffset() {\n          return calculateLineOffsetSketch();\n        }\n\n        float calculateLinePressure() {\n          return calculateLinePressureSketch();\n        }\n      "]))));
break;case 2:b.varyings.add("vType","float"),t.code.add(h.glsl(p||(p=l(["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "],["\n        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)\n        {\n          vType \x3d unpackedAttributes.type;\n\n          if (unpackedAttributes.type \x3c\x3d 0.0) {\n            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\n          }\n        }\n      "])))),
y.code.add(h.glsl(u||(u=l(["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "],["\n        float calculateLineOffset() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLineOffsetSketch();\n          }\n          else {\n            return 0.0;\n          }\n        }\n\n        float calculateLinePressure() {\n          if (vType \x3c\x3d 0.0) {\n            return calculateLinePressureSketch();\n          }\n          else {\n            return 1.0;\n          }\n        }\n      "]))))}};
var d,k,n,c,g,r,p,u})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(q,b,l,f,h,a){function e(a,b){if(!a)return null;var c=a.length/2,e=d*c,c=Array(c),f=0;b=1===b;for(var h=0;h<a.length;h+=2){var l=(a[h]+a[h+1])/2;b?c[f++]=Math.min(e,1-(1-l)*k):c[f++]=Math.min(e,l*k)}return c}Object.defineProperty(b,"__esModule",{value:!0});b.generateStrokesTexture=
function(d){for(var c=b.strokesDefinition.resolution,g=c/2,k=new Uint8Array(4*c*c),l=4*c*g,g=b.strokesDefinition.amplitude,n=2*g,q=4*c,x=f.log2(c)+1,v=b.strokesDefinition.strokes.length,y=(x-1)*v*q,m=0,w=b.strokesDefinition.strokes;m<w.length;m++){for(var A=w[m],B=A.distance,A=A.pressure,C=y,E=0;E<x;E++){0!==E&&(B=e(B,0),A=e(A,1));for(var G=0;G<b.strokesDefinition.resolution;G++){var J=A?A[G%A.length]:1;h.packFloatRGBA((B?B[G%B.length]/n:0)+.5,k,C);h.packFloatRGBA(J,k,C+l);C+=4}C-=q*(v+1)}y+=q}d=
new a(d,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:c,height:c,wrapMode:10497},k);return{resolution:c,texture:d,normalizationScale:n,amplitude:g,variants:v}};b.rasterizeStrokes=function(){for(var a=b.strokesDefinition.resolution,c=f.log2(a)+1,d=b.strokesDefinition.strokes.length,k=b.strokesDefinition.amplitude,h=Math.ceil(2*k+.5),l=0;1<=a;)l+=a,a/=2;var l=l+6*(c+1),d=d*h,a=new Uint8ClampedArray(4*l*d),q=4*l;a.fill(255);for(var x=24,v=0,y=b.strokesDefinition.strokes;v<y.length;v++){for(var m=
y[v],w=m.distance,m=m.pressure,A=x,B=0;B<c;B++){0!==B&&(w=e(w,0),m=e(m,1));for(var C=0;C<w.length;C++){for(var E=w?w[C]:0,G=m?f.clamp(m[C],0,1):1,J=A,I=-k;I<h-k;I++){var K=255-255*f.clamp(1-(Math.abs(I-E+.5)-.5*G),0,1);a[J+0]=K;a[J+1]=K;a[J+2]=K;a[J+3]=255;J+=q}A+=4}A+=24}x+=h*q}return new ImageData(a,l,d)};var d=.1,k=.5;b.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,
-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,
.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,
.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,
-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,
.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,
.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,
.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,
-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,
-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,
1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,
.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,
-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,
.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,
.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,
.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,
.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,
4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,
3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,
.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,
.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,
.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,
.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,
.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,
1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,
-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,
.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,
2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,
.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,
.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,
.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,
-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,
1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,
.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,
-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,
.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,
.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,
.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,
.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,
4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,
.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,
-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(q,b,l,f,h){function a(a){return 0<
a.size*a.color[3]*a.opacity}function e(a,b){var d=l.binaryIndexOf(a,b,!0);return-1===d?b<a[0]?0:a.length:d}Object.defineProperty(b,"__esModule",{value:!0});b.determineRendererType=function(b){for(var d=null,e=0;e<b.length;e++){var c=b[e],g=c.type;if(a(c))if(f.isNone(d))d=g;else if(d!==g)return"uber"}return f.isSome(d)?d:"solid"};b.determineEdgeTransparency=function(b){for(var d=0,e=0;e<b.length;e++){var c=b[e].material;if(a(c)){if(1>c.color[3]*c.opacity)return 1;d=2}}return d};b.determineObjectTransparency=
function(b){for(var d=0,e=0;e<b.length;e++){var c=b[e].material;if(a(c)){switch(c.objectTransparency){case 1:case 0:return 1}d=2}}return d};b.cloneIndices=function(a){if(Uint16Array.from)return h.isUint16Array(a)?Uint16Array.from(a):Uint32Array.from(a);for(var b=h.isUint16Array(a)?new Uint16Array(a.length):new Uint32Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b};b.estimateLengthAtDistance=function(a,b,e,c){return c/a*e*2*Math.tan(.5*b)};b.findLowerBoundIndex=e;b.computeEdgeCount=function(a,
b,f){return a.length-e(a,b*f.minimumEdgeLength)};b.fillComponenBufferIndices=function(a,b,e,c){for(var d=0;d<a.length;d++){var f=a[d].index,h=b[d],k=b[d+1];if(c)for(;h<k;h++)e.set(c[h],f);else for(;h<k;h++)e.set(h,f)}}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.startMeasurement=function(b){return(b=b.capabilities.disjointTimerQuery)?new l(b):null};b.getTimestamp=function(b,h,a){void 0===a&&(a=50);var e=b.capabilities.disjointTimerQuery;
if(!e||0>=e.timestampBits())return!1;var d=e.createQuery();e.createTimestamp(d);var f=function(){var b=e.resultAvailable(d),c=e.disjoint();b&&!c?(b=e.getResult(d),h(b/1E6)):c?h():setTimeout(f,a)};f();return!0};b.supportsTimestamps=function(b){b=b.capabilities.disjointTimerQuery;if(!b)return!1;b=b.timestampBits();console.log({bits:b});return 0<b};var l=function(){function b(b){this.timer=b;this.query=b.createQuery();this.timer.beginTimeElapsed(this.query)}b.prototype.stop=function(b,a){void 0===a&&
(a=50);this.cb=b;this.checkInterval=a;this.timer.endTimeElapsed();this.checkQueryResult()};b.prototype.checkQueryResult=function(){var b=this.timer.resultAvailable(this.query),a=this.timer.disjoint();b&&!a?(b=this.timer.getResult(this.query),this.cb(b/1E6)):a?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return b}()})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("require exports ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/scheduling ./TextureTechnique ./Util ../../../webgl/Texture".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});var c=f.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");q=function(){function b(a,b,c){this.textures=a;this.rctx=c;this._loadingCount=0;this.frameUpdates=new Map;this._unloadDeferredHandle=this._fallbackTextureTransparent=this._fallbackTexture=null;this._texturesToUnload=[];this.events=new l;this.textureTechniqueConfig=new d.TextureTechniqueConfiguration;this.textureTechnique=b.acquireAndReleaseExisting(d.TextureTechnique,
this.textureTechniqueConfig,this.textureTechnique);this.rctx=c;this.idToRefCountedTexture=new Map;this.initializeFallbackTextures()}b.prototype.dispose=function(){h.isSome(this._unloadDeferredHandle)&&(this._unloadDeferredHandle.remove(),this._unloadDeferredHandle=null);this.textures.forEach(function(a){a.unload()})};b.prototype.initializeFallbackTextures=function(){this.fallbackTextureData=new Uint8Array(256);this.fallbackTextureTransparentData=new Uint8Array(256);for(var a=0;a<this.fallbackTextureData.length;++a)this.fallbackTextureData[a]=
255,this.fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this.fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy}};b.prototype.acquire=function(a,b,c){a=this.getOrCreateRef(a,b,c);a.ref();return a};b.prototype.update=function(){var a=this,b=!1;this.frameUpdates.forEach(function(c){var d=c.texture.frameUpdate(a.rctx,a.textureTechnique,c.previousToken);0<=d&&d!==c.previousToken&&(c.previousToken=
d,b=!0)});b&&this.events.emit("changed",{requestType:0})};b.prototype.getOrCreateRef=function(a,b,c){var d=this.idToRefCountedTexture.get(a);return d?d:this.createNewRef(a,b,c)};b.prototype.createNewRef=function(b,d,e){var f=this,h=this.textures.get(b);k.assert(void 0!==h);var l=h.events.on("unloaded",function(){l.remove();f._onTextureUnloaded(b)});d=!0===d;var m=new g;this.idToRefCountedTexture.set(b,m);var p=h.load(this.rctx,this.textureTechnique);this._loadingCount++;var n=function(a){f._loadingCount--;
f.updateGLTexture(m,a);e&&e(m);h.requiresFrameUpdates&&f.frameUpdates.set(b,{texture:h,previousToken:-1});return m},r=function(b){f._loadingCount--;a.isAbortError(b)||c.error(b)};a.isThenable(p)?(this.updateGLTexture(m,d?this.fallbackTextureTransparent:this.fallbackTexture),p.then(n,r)):n(p);return m};b.prototype.updateGLTexture=function(a,b){a.glTexture=b;this.events.emit("changed",{requestType:1})};b.prototype.release=function(a){var b=this,c=this.idToRefCountedTexture.get(a);c&&(c.unref(),c.isUnreferenced&&
(this._texturesToUnload.push(a),h.isNone(this._unloadDeferredHandle)&&(this._unloadDeferredHandle=e.schedule(function(){return b.unloadDeferred()}))))};b.prototype.unloadDeferred=function(){for(var a=this._texturesToUnload,b=this._texturesToUnload.length=0;b<a.length;b++){var c=a[b],d=this.textures.get(c),c=this.idToRefCountedTexture.get(c);d&&c&&c.isUnreferenced&&d.unload()}};b.prototype.getTexture=function(a){return this.textures.get(a)};Object.defineProperty(b.prototype,"loadingCount",{get:function(){return this._loadingCount},
enumerable:!0,configurable:!0});b.prototype._onTextureUnloaded=function(a){this.idToRefCountedTexture.delete(a);this.frameUpdates.delete(a)};Object.defineProperty(b.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new n(this.rctx,this.fallbackTextureDesc,this.fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=
new n(this.rctx,this.fallbackTextureDesc,this.fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return b}();b.TextureRepository=q;var g=function(){function a(){this._refCount=0;this.glTexture=null}Object.defineProperty(a.prototype,"isUnreferenced",{get:function(){return 0===this._refCount},enumerable:!0,configurable:!0});a.prototype.ref=function(){++this._refCount};a.prototype.unref=function(){0===this._refCount?c.error("Cannot dereference texture that has no references!"):
--this._refCount};return a}();b.RefCountedTexture=g})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/AutoDisposable ../../../support/screenshotUtils ../../../webgl/FramebufferObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function p(a,c,d,e,f,g){void 0===e&&(e=null);void 0===g&&(g=!0);var h=b.call(this)||this;h._rctx=a;h._renderScene=c;h._requestRenderScene=d;h._renderOverlay=e;h.forceCameraHook=f;h.supersample=g;h._screenshotQueue=[];return h}f(p,b);p.prototype.dispose=function(){this._rctx=null};p.prototype.takeScreenshot=function(a){var b=this;this._requestRenderScene();var c=e.createResolver(function(){b._screenshotQueue=
b._screenshotQueue.filter(function(a){return a.resolver!==c})});this._screenshotQueue.push({settings:a,resolver:c});return c.promise};p.prototype.update=function(a){if(0!==this._screenshotQueue.length){for(var b=0,d=this._screenshotQueue;b<d.length;b++){var e=d[b];if(this.isDisposed)e.resolver.reject();else{var f=l({},e.settings,{pixelRatio:e.settings.pixelRatio*a.viewCamera.pixelRatio}),g=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(a,f),f=c.encodeResult(h,f,g,{flipY:!0,premultipliedAlpha:!0});
e.resolver(f)}}this._screenshotQueue=[]}};p.prototype._renderScreenshotOverlay=function(b,c,d){if(!a.isNone(this._renderOverlay)){b.width=c.width;b.height=c.height;var e=b.getContext("2d"),f=d.pixelRatio;e.save();e.translate(0,c.height);e.scale(1,-1);d.region&&e.translate(-d.region.x,-d.region.y);e.scale(f,f);this._renderOverlay(b,c);e.restore()}};p.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};p.prototype._readbackScreenshotResampled=
function(a){var b=a.framebufferWidth,d=a.framebufferHeight,e=a.region,f=a.resample,g=this._ensureScreenshotEncodeCanvas(),h=c.createEmptyImageData(b,d,g);this._rctx.gl.readPixels(0,0,b,d,6408,5121,new Uint8Array(h.data.buffer));this._renderScreenshotOverlay(g,h,l({},a,{region:null}));a=c.createEmptyImageData(e.width,e.height,g);return c.resampleHermite(h,a,!0,f.region.x,d-(f.region.y+f.region.height),f.region.width,f.region.height)};p.prototype._readbackScreenshotImmediate=function(a){var b=a.framebufferHeight,
d=a.region,e=this._ensureScreenshotEncodeCanvas(),f=c.createEmptyImageData(d.width,d.height,e);this._rctx.gl.readPixels(d.x,b-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(f.data.buffer));this._renderScreenshotOverlay(e,f,a);return f};p.prototype._renderScreenshot=function(a,b){var c=null,d=a.viewCamera,e=b.framebufferWidth,f=b.framebufferHeight,h=!1;a=a.frameHasSlicePlane&&b.disableSlice;var l=b.ignorePadding&&d.pixelRatio!==b.pixelRatio;if(a=e!==d.fullWidth||f!==d.fullHeight||a||l){l=
d.clone();if(b.ignorePadding){for(var c=k.vec4f64.clone(l.padding),p=0;4>p;p++)c[p]=Math.round(c[p]/l.pixelRatio*b.pixelRatio);l.padding=c}l.fullWidth=e;l.fullHeight=f;l.pixelRatio=b.pixelRatio;c=d.fovX-l.fovX;e=d.fovY-l.fovY;0>c&&c<e?l.fovX=d.fovX:0>e&&e<c&&(l.fovY=d.fovY);this.forceCameraHook(l);h=!0;c=new g(this._rctx,{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(c,l,b.disableSlice)}b=this._readbackScreenshot(b);if(a&&!this._rctx.contextAttributes.alpha)for(p=
3;p<b.data.length;p+=4)b.data[p]=255;c&&c.dispose();this._rctx.bindFramebuffer(null);h&&this.forceCameraHook(d);return b};p.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return p=h([d.subclass("esri.views.3d.webgl-engine.parts.ScreenshotManager")],p)}(d.declared(n.AutoDisposable));b.ScreenshotManager=q})},"esri/views/3d/webgl-engine/shaders/globalOptions":function(){define(["require",
"exports","../../../webgl/programUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.glslifyGlobalOptions=function(b){return l.glslifyDefineMap({VIEWING_MODE:{value:b.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",local:"VIEWING_MODE_LOCAL"}}})}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a=
{supportsMajorWebPerformanceCaveat:!1};b.check=function(b){b=l({},a,b);return h("esri-webgl")?!b.supportsMajorWebPerformanceCaveat&&h("esri-webgl-major-performance-caveat")?new f("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):h("esri-webgl-high-precision-fragment")?h("esri-webgl-vertex-shader-samplers")?h("esri-webgl-element-index-uint")?h("esri-webgl-standard-derivatives")?
h("esri-webgl-instanced-arrays")?null:new f("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new f("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new f("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new f("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):
new f("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new f("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(q,b,l,f,h,a){return function(a){function b(b){b=a.call(this,b)||this;b.components=
["attribution","zoom","navigation-toggle","compass"];return b}l(b,a);f([h.property()],b.prototype,"components",void 0);return b=f([h.subclass("esri.views.ui.3d.DefaultUI3D")],b)}(h.declared(a))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){return function(b){function d(a){a=b.call(this,a)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};a.components=[];return a}l(d,b);d.prototype.initialize=function(){this._handles.add([h.init(this,"components",this._componentsWatcher.bind(this)),h.init(this,"view",this._updateViewAwareWidgets.bind(this))])};d.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=
b._find(a))b.remove(a),a.destroy()})};d.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b._find(c))&&c.widget)&&void 0!==c.view&&(c.view=a)})};d.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};d.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};d.prototype._addComponents=function(a){var b=this;this.initialized&&
a.forEach(function(a){return b.add(b._createComponent(a),b._defaultPositionLookup[a])})};d.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new e({id:a,node:b})};d.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};d.prototype._createAttribution=function(){return new k({view:this.view})};
d.prototype._createCompass=function(){return new n({view:this.view})};d.prototype._createNavigationToggle=function(){return new c({view:this.view})};d.prototype._createZoom=function(){return new g({view:this.view})};f([a.property()],d.prototype,"components",void 0);return d=f([a.subclass("esri.views.ui.DefaultUI")],d)}(a.declared(d))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.widget=null;return a}l(d,b);d.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(d.prototype,"id",{get:function(){return this.get("widget.id")||this.get("node.id")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&a.classList.add("esri-component"),b&&b.classList.remove("esri-component"),
this._set("node",a))},enumerable:!0,configurable:!0});d.prototype.castNode=function(b){if(!b)return this._set("widget",null),null;if("string"===typeof b||b&&"nodeType"in b)return this._set("widget",null),a.byId(b);b&&"function"===typeof b.render&&!b.domNode&&(b.domNode=document.createElement("div"));this._set("widget",b);return b.domNode};f([e.property()],d.prototype,"id",null);f([e.property()],d.prototype,"node",null);f([e.cast("node")],d.prototype,"castNode",null);f([e.property({readOnly:!0})],
d.prototype,"widget",void 0);return d=f([e.subclass("esri.views.ui.Component")],d)}(e.declared(h))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),function(q,b,l,f,h,a,e,d,k,n,c,g){function r(a){return"object"!==
typeof a||a instanceof c||"declaredClass"in a||!("component"in a||"index"in a||"position"in a)?null:a}function p(a,b){var c=b.bottom,d=b.left,e=b.right;a.style.top=b.top;a.style.bottom=c;a.style.left=d;a.style.right=e}var u={left:0,top:0,bottom:0,right:0},t={bottom:30,top:15,right:15,left:15};return function(b){function e(a){a=b.call(this,a)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._componentToKey=new Map;a._handles=new d;a.view=null;a._initContainers();
return a}f(e,b);e.prototype.initialize=function(){this._handles.add([k.init(this,"view.padding, container",this._applyViewPadding.bind(this)),k.init(this,"padding",this._applyUIPadding.bind(this))])};e.prototype.destroy=function(){this.container=null;for(var a=0,b=this._components;a<b.length;a++)b[a].destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};Object.defineProperty(e.prototype,"container",{set:function(b){var c=this._get("container");b!==c&&(b&&(b.classList.add("esri-ui"),
this._attachContainers(b)),c&&(c.classList.remove("esri-ui"),p(c,{top:"",bottom:"",left:"",right:""}),a.empty(c)),this._set("container",b))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",
a):this._clearOverride("padding")},enumerable:!0,configurable:!0});e.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:l({},t,a)};Object.defineProperty(e.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});e.prototype.add=function(a,b){var d=this,e,f;if(Array.isArray(a))a.forEach(function(a){return d.add(a,b)});else{var g=r(a);
g&&(e=g.index,b=g.position,a=g.component,f=g.key);b&&"object"===typeof b&&(e=b.index,f=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a instanceof c||(a=new c({node:a})),this._place({component:a,position:b,index:e}),this._components.push(a),f&&this._componentToKey.set(a,f))}};e.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this._find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),
d.node.parentNode&&d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};e.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";return"manual"===a?Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!a.classList.contains("esri-ui-corner")}).map(function(a){return b.remove(a)}):this._isValidPosition(a)?Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this):null};e.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};e.prototype.find=function(a){return a?(a=this._findById(a))&&(a.widget||a.node):null};e.prototype._find=function(a){return a?a instanceof c?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||
a):null};e.prototype._getViewPadding=function(){return this.get("view.padding")||u};e.prototype._attachContainers=function(a){a.appendChild(this._innerContainer);a.appendChild(this._manualContainer)};e.prototype._initContainers=function(){var a=document.createElement("div");a.classList.add("esri-ui-inner-container");a.classList.add("esri-ui-corner-container");var b=document.createElement("div");b.classList.add("esri-ui-inner-container");b.classList.add("esri-ui-manual-container");var c=document.createElement("div");
c.classList.add("esri-ui-top-left");c.classList.add("esri-ui-corner");a.appendChild(c);var d=document.createElement("div");d.classList.add("esri-ui-top-right");d.classList.add("esri-ui-corner");a.appendChild(d);var e=document.createElement("div");e.classList.add("esri-ui-bottom-left");e.classList.add("esri-ui-corner");a.appendChild(e);var f=document.createElement("div");f.classList.add("esri-ui-bottom-right");f.classList.add("esri-ui-corner");a.appendChild(f);this._innerContainer=a;this._manualContainer=
b;a=g.isRTL();this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":e,"bottom-right":f,"top-leading":a?d:c,"top-trailing":a?c:d,"bottom-leading":a?f:e,"bottom-trailing":a?e:f};this._positionNameToContainerLookup=l({manual:b},this._cornerNameToContainerLookup)};e.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};e.prototype._place=function(b){var c=b.component,d=b.index;b=this._positionNameToContainerLookup[b.position||"manual"];var e=-1<d,
f=c.widget;f&&!f._started&&"function"===typeof f.postMixInProperties&&"function"===typeof f.buildRendering&&"function"===typeof f.postCreate&&"function"===typeof f.startup&&c.widget.startup();e?(e=Array.prototype.slice.call(b.children),0===d?b.firstChild?a.insertBefore(c.node,b.firstChild):b.appendChild(c.node):d>=e.length?b.appendChild(c.node):a.insertBefore(c.node,e[d])):b.appendChild(c.node)};e.prototype._applyViewPadding=function(){var a=this.container;a&&p(a,this._toPxPosition(this._getViewPadding()))};
e.prototype._applyUIPadding=function(){var a=this._innerContainer;a&&p(a,this._toPxPosition(this.padding))};e.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};e.prototype._toPxUnit=function(a){return 0===a?"0":a+"px"};e.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};e.prototype._findById=function(a){var b=null,
c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};e.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};h([n.property()],e.prototype,"container",null);h([n.property({dependsOn:["view.height"]})],e.prototype,"height",null);h([n.property({value:t})],e.prototype,"padding",null);h([n.cast("padding")],e.prototype,"castPadding",null);h([n.property()],e.prototype,"view",void 0);h([n.property({dependsOn:["view.width"]})],
e.prototype,"width",null);return e=h([n.subclass("esri.views.ui.UI")],e)}(n.declared(e.EventedAccessor))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(a){a=b.call(this,a)||this;a._isOpen=
!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=h.widgetLabel;a.view=null;a.viewModel=new k;return a}l(c,b);c.prototype.postInitialize=function(){var b=this;this.own(a.on(this,"viewModel.items","change",function(){return b.scheduleRender()}))};Object.defineProperty(c.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},
enumerable:!0,configurable:!0});c.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return n.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),n.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",n.tsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri")))};
c.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),d=c?0:-1,e=this.attributionText,f=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return n.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:e,role:f,tabIndex:d})};c.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};c.prototype._afterSourcesNodeUpdate=
function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};c.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};c.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};f([e.property({dependsOn:["viewModel.items.length",
"itemDelimiter"],readOnly:!0}),n.renderable()],c.prototype,"attributionText",null);f([e.property()],c.prototype,"iconClass",void 0);f([e.property(),n.renderable()],c.prototype,"itemDelimiter",void 0);f([e.property()],c.prototype,"label",void 0);f([e.aliasOf("viewModel.view")],c.prototype,"view",void 0);f([e.property({type:k}),n.renderable(["state","view.size"])],c.prototype,"viewModel",void 0);f([n.accessibleHandler()],c.prototype,"_toggleState",null);return c=f([e.subclass("esri.widgets.Attribution")],
c)}(e.declared(d))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/awaiterHelper ../../core/tsSupport/generatorHelper ../../geometry ../../core/arrayUtils ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})}function x(a,b,c){c&&b&&(d.find(a,function(a){return a.layerView===b&&a.text===c})||a.push({text:c,layerView:b}))}var v=[];return function(b){function c(a){var c=b.call(this,a)||this;c.clear=function(){c._fetchedAttributionData.clear();c._pendingAttributions.clear();c.handles.remove("suspension");c.notifyChange("state")};c._pendingAttributions=new Set;c._fetchedAttributionData=
new Map;c.items=new n;c.view=null;c._allLayerViewsChange=function(a){c.handles.remove("suspension");var b=c.get("view.allLayerViews");b&&c.handles.add(b.map(function(a){return a.watch(["suspended","attributionVisible"],c._updateAttributionItems)}),"suspension");a&&a.removed&&a.removed.forEach(function(a){c._pendingAttributions.delete(a);c._fetchedAttributionData.delete(a)});c._updateAttributionItems()};c._updateAttributionItems=function(){var a=c.get("view.allLayerViews");v.length=0;a?(a.forEach(function(a){if(!a.suspended&&
a.get("layer.attributionVisible")){var b=a.layer;if(b&&"copyright"in b&&"function"===typeof b.originOf&&"user"===b.originOf("copyright"))x(v,a,b.copyright);else if(b.hasAttributionData)if(c._fetchedAttributionData.has(a)){var d=c._fetchedAttributionData.get(a);d&&x(v,a,c._getDynamicAttribution(d,c.view,b))}else c._fetchAttributionData(a);else(d=b.get("portalItem.accessInformation"))?x(v,a,d):x(v,a,b.copyright)}}),t(c.items,v)&&(c.items.removeAll(),c.items.addMany(v)),c.notifyChange("state")):c.clear()};
c.handles.add([g.on(c,"view.allLayerViews","change",c._allLayerViewsChange,c._allLayerViewsChange,c.clear),g.whenTrue(c,"view.stationary",function(){return c._updateAttributionItems()})]);return c}l(c,b);c.prototype.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear()};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"},enumerable:!0,configurable:!0});
c.prototype._fetchAttributionData=function(b){return h(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:if(this._pendingAttributions.has(b))return[2];this._pendingAttributions.add(b);return[4,k.result(b.layer.fetchAttributionData())];case 1:return c=a.sent(),this._pendingAttributions.has(b)&&(d=c.ok?this._createContributionIndex(c.value,"bing-maps"===b.layer.type):null,this._pendingAttributions.delete(b),this._fetchedAttributionData.set(b,d)),this._updateAttributionItems(),
[2]}})})};c.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var d=0;d<a.length;d++){var f=a[d],g=f.coverageAreas;if(!g)return;for(var h=0;h<g.length;h++)for(var k=g[h],m=k.bbox,l=k.zoomMin-(b&&k.zoomMin?1:0),p=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:u.geographicToWebMercator({xmin:m[1],ymin:m[0],xmax:m[3],ymax:m[2],spatialReference:e.SpatialReference.WGS84}),attribution:f.attribution||"",score:null!=k.score?k.score:100,id:d};l<=p;l++)c[l]=c[l]||[],c[l].push(k)}c.maxKey=
Math.max.apply(null,Object.keys(c));return c};c.prototype._getDynamicAttribution=function(a,b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=u.project(d.center.clone().normalize(),b.spatialReference),f={};return a?a.filter(function(a){var b=!f[a.id]&&e&&p.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", "):
""};f([r.property({readOnly:!0,type:n})],c.prototype,"items",void 0);f([r.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);f([r.property()],c.prototype,"view",void 0);return c=f([r.subclass("esri.widgets.Attribution.AttributionViewModel")],c)}(r.declared(c.HandleOwner))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(q,b,l,f,h,a,e,d,k){return function(b){function c(a){a=b.call(this,a)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=h.widgetLabel;a.view=null;a.viewModel=new d;return a}l(c,b);c.prototype.reset=function(){};c.prototype.render=function(){var a,b,c=this.viewModel,d=c.orientation,c=c.state,e="disabled"===c,f="compass"===("rotation"===c?"rotation":"compass"),c=e?-1:0,e=(a={},a["esri-disabled"]=e,a["esri-interactive"]=!e,a);a=(b={},b["esri-icon-compass"]=f,b["esri-icon-dial"]=
!f,b);return k.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",e),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":h.reset,title:h.reset},k.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(d)}),k.tsx("span",{class:"esri-icon-font-fallback-text"},h.reset))};c.prototype._reset=function(){this.viewModel.reset()};c.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+
a.z+"deg)"}};f([a.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);f([a.property()],c.prototype,"iconClass",void 0);f([a.property()],c.prototype,"label",void 0);f([a.aliasOf("viewModel.view")],c.prototype,"view",void 0);f([a.property({type:d}),k.renderable(["viewModel.orientation","viewModel.state"])],c.prototype,"viewModel",void 0);f([a.aliasOf("viewModel.reset")],c.prototype,"reset",null);f([k.accessibleHandler()],c.prototype,"_reset",null);return c=f([a.subclass("esri.widgets.Compass")],
c)}(a.declared(e))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),function(q,b,l,f,h,a,e,d,k){return function(b){function c(c){c=b.call(this,c)||this;c._handles=new a;c.orientation={x:0,y:0,z:0};c.view=null;c._updateForCamera=c._updateForCamera.bind(c);c._updateForRotation=
c._updateForRotation.bind(c);c._updateRotationWatcher=c._updateRotationWatcher.bind(c);c.view;return c}l(c,b);c.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._updateRotationWatcher))};c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return!(!a||!a.isWebMercator&&!a.isGeographic)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});c.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};c.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};c.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};c.prototype._updateRotationWatcher=function(a){this._handles.removeAll();
a&&("2d"===a.type?this._handles.add(e.init(this,"view.rotation",this._updateForRotation)):this._handles.add(e.init(this,"view.camera",this._updateForCamera)))};f([d.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],c.prototype,"canShowNorth",null);f([d.property()],c.prototype,"orientation",void 0);f([d.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],c.prototype,"state",null);f([d.property()],c.prototype,"view",void 0);f([d.property()],
c.prototype,"reset",null);return c=f([d.subclass("esri.widgets.CompassViewModel")],c)}(d.declared(k.GoToMixin(h)))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),function(q,b,l,f,h,a,e,d,k){return function(b){function c(a){a=b.call(this,a)||
this;a.iconClass="esri-icon-pan2";a.label=h.widgetLabel;a.view=null;a.viewModel=new d;return a}l(c,b);Object.defineProperty(c.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});c.prototype.toggle=function(){};c.prototype.render=function(){var a,b,c,d="disabled"===this.get("viewModel.state"),e="pan"===this.get("viewModel.navigationMode"),f=(a={},a["esri-disabled"]=d,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,
a);a=(b={},b["esri-navigation-toggle__button--active"]=e,b);b=(c={},c["esri-navigation-toggle__button--active"]=!e,c);c=d?-1:0;return k.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",f),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":h.toggle,title:h.toggle},k.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",a)},k.tsx("span",{class:"esri-icon-pan"})),k.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",b)},k.tsx("span",{class:"esri-icon-rotate"})))};c.prototype._toggle=function(){this.toggle()};f([a.property()],c.prototype,"iconClass",void 0);f([a.property()],c.prototype,"label",void 0);f([a.property({value:"vertical"}),k.renderable()],c.prototype,"layout",null);f([a.aliasOf("viewModel.view"),k.renderable()],c.prototype,"view",void 0);f([a.property({type:d}),k.renderable(["viewModel.state","viewModel.navigationMode"])],c.prototype,"viewModel",void 0);f([a.aliasOf("viewModel.toggle")],
c.prototype,"toggle",null);f([k.accessibleHandler()],c.prototype,"_toggle",null);return c=f([a.subclass("esri.widgets.NavigationToggle")],c)}(a.declared(e))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a,e,d){return function(b){function h(c){c=
b.call(this,c)||this;c._handles=new a;c.navigationMode="pan";c.view=null;c.toggle=c.toggle.bind(c);return c}l(h,b);h.prototype.initialize=function(){this._handles.add(e.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};h.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};h.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};f([d.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);f([d.property()],h.prototype,"navigationMode",void 0);f([d.property()],h.prototype,"view",void 0);f([d.property()],h.prototype,"toggle",null);return h=f([d.subclass("esri.widgets.NavigationToggleViewModel")],
h)}(d.declared(h))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(a){a=b.call(this,a)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";a.label=h.widgetLabel;a.view=null;a.viewModel=new k;return a}l(c,b);c.prototype.postInitialize=
function(){this._zoomInButton=new d({action:this.zoomIn,iconClass:"esri-icon-plus",title:h.zoomIn});this._zoomOutButton=new d({action:this.zoomOut,iconClass:"esri-icon-minus",title:h.zoomOut})};Object.defineProperty(c.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});c.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]="horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&
b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return n.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};c.prototype.zoomIn=function(){};c.prototype.zoomOut=function(){};f([a.property()],c.prototype,"iconClass",void 0);f([a.property()],c.prototype,"label",void 0);f([a.property({value:"vertical"}),n.renderable()],c.prototype,"layout",null);f([a.aliasOf("viewModel.view"),n.renderable()],c.prototype,"view",void 0);
f([a.property({type:k}),n.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],c.prototype,"viewModel",void 0);f([a.aliasOf("viewModel.zoomIn")],c.prototype,"zoomIn",null);f([a.aliasOf("viewModel.zoomOut")],c.prototype,"zoomOut",null);return c=f([a.subclass("esri.widgets.Zoom")],c)}(a.declared(e))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(q,b,l,f,h,a,e){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.enabled=!0;b.iconClass="";b.title="";return b}l(b,a);b.prototype.render=function(){var a,b,d=this.enabled?0:-1,f=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",f),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,
title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};b.prototype._triggerAction=function(){this.action.call(this)};f([h.property()],b.prototype,"action",void 0);f([h.property(),e.renderable()],b.prototype,"enabled",void 0);f([h.property(),e.renderable()],b.prototype,"iconClass",void 0);f([h.property(),e.renderable()],b.prototype,"title",void 0);f([e.accessibleHandler()],b.prototype,
"_triggerAction",null);return b=f([h.subclass("esri.widgets.IconButton")],b)}(h.declared(a))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(q,b,l,f,h,a,e,d){return function(b){function h(a){a=b.call(this,a)||this;a.canZoomIn=!1;a.canZoomOut=!1;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=a.zoomOut.bind(a);
return a}l(h,b);h.prototype.destroy=function(){this.view=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new e({view:a}):"3d"===a.type&&(this._zoomConditions=new d({view:a})):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});h.prototype.zoomIn=function(){if(this.canZoomIn){var a=
this.view;"2d"===a.type?a.mapViewNavigation.zoomIn():a.goTo({zoomFactor:2})}};h.prototype.zoomOut=function(){if(this.canZoomOut){var a=this.view;"2d"===a.type?a.mapViewNavigation.zoomOut():a.goTo({zoomFactor:.5})}};f([a.property()],h.prototype,"_zoomConditions",void 0);f([a.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],h.prototype,"canZoomIn",void 0);f([a.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],h.prototype,"canZoomOut",void 0);f([a.property({dependsOn:["view.ready"],
readOnly:!0})],h.prototype,"state",null);f([a.property()],h.prototype,"view",null);f([a.property()],h.prototype,"zoomIn",null);f([a.property()],h.prototype,"zoomOut",null);return h=f([a.subclass("esri.widgets.Zoom.ZoomViewModel")],h)}(a.declared(h))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){return function(b){function d(){return null!==
b&&b.apply(this,arguments)||this}l(d,b);Object.defineProperty(d.prototype,"canZoomIn",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canZoomOut",{get:function(){if(!this.get("view.ready"))return!1;var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");
return 0===b||a<b},enumerable:!0,configurable:!0});f([a.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],d.prototype,"canZoomIn",null);f([a.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],d.prototype,"canZoomOut",null);f([a.property()],d.prototype,"view",void 0);return d=f([a.subclass("esri.widgets.Zoom.ZoomConditions2D")],d)}(a.declared(h))})},
"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){return function(b){function d(){return null!==b&&b.apply(this,arguments)||this}l(d,b);Object.defineProperty(d.prototype,"canZoomIn",{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canZoomOut",
{get:function(){return!!this.get("view.ready")},enumerable:!0,configurable:!0});f([a.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"canZoomIn",null);f([a.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"canZoomOut",null);f([a.property()],d.prototype,"view",void 0);return d=f([a.subclass("esri.widgets.Zoom.ZoomConditions3D")],d)}(a.declared(h))})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../PopupTemplate ../renderers ../request ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa){function V(a,b,c){a&&((a=N.read(a,b,c)||void 0)||ca.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var F=["3DObject","Point"],ca=g.getLogger("esri.layers.SceneLayer"),U=L.defineFieldProperties(),ea={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",
polygons:"polygons","features-polygons":"polygons"},ha={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(b){function g(a,c){a=b.call(this,a)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=null;a.outFields=null;a.nodePages=null;a.materialDefinitions=null;a.textureSetDefinitions=null;a.geometryDefinitions=null;a.serviceUpdateTimeStamp=null;a.definitionExpression=null;a.path=null;a.labelsVisible=
!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=!0;return a}f(g,b);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?l({url:a},b):a};g.prototype.getField=function(a){return this.fieldsIndex.get(a)};g.prototype.getFieldDomain=function(a){return(a=this.getField(a))&&a.domain?a.domain:null};Object.defineProperty(g.prototype,
"fieldsIndex",{get:function(){return new P(this.fields)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"geometryType",{get:function(){return ha[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderer",{set:function(a){S.fixRendererFields(a,this.fields);this._set("renderer",
a)},enumerable:!0,configurable:!0});g.prototype.readCachedDrawingInfo=function(a){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};Object.defineProperty(g.prototype,"defaultPopupTemplate",{get:function(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null},enumerable:!0,configurable:!0});g.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};
g.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&ea[a])return ea[a];ca.error("Unknown or missing profile",{profile:a,layer:this});return"mesh-pyramids"};g.prototype.load=function(a){var b=this,c=r.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).then(function(){return b._fetchService(c)},function(){return b._fetchService(c)}).then(function(){return u.all([b._verifyRootNodeAndUpdateExtent(b.nodePages,c),b._setAssociatedFeatureLayer(c)])}).then(function(){return b._validateElevationInfo()}).then(function(){return b._applyAssociatedLayerOverrides()}).then(function(){return b._populateFieldUsageInfo()}).then(function(){return Z.loadStyleRenderer(b,
{origin:"service"},c)}).then(function(){return S.fixRendererFields(b.renderer,b.fields)});this.addResolvingPromise(a);return this.when()};g.prototype.createQuery=function(){var a=new aa;"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};g.prototype.queryExtent=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryExtent(a||c.createQuery(),b)})};g.prototype.queryFeatureCount=
function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatureCount(a||c.createQuery(),b)})};g.prototype.queryFeatures=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryFeatures(a||c.createQuery(),b)}).then(function(a){if(a&&a.features)for(var b=0,d=a.features;b<d.length;b++){var e=d[b];e.layer=c;e.sourceLayer=c}return a})};g.prototype.queryObjectIds=function(a,b){var c=this;return this._getAssociatedLayerForQuery().then(function(d){return d.queryObjectIds(a||
c.createQuery(),b)})};g.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(ca.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};g.prototype.createPopupTemplate=function(a){return W.createPopupTemplate(this,a)};g.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});
var b=this.associatedLayer;return null!=b?u.resolve(b):u.reject(new c("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};g.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};g.prototype.queryCachedStatistics=function(b,d){return e(this,void 0,void 0,function(){var e,f,g,h,k;return a(this,function(a){switch(a.label){case 0:return[4,this.load(d)];case 1:a.sent();
if(!this.statisticsInfo)throw new c("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");e=this.fieldsIndex.get(b);if(!e)throw new c("scenelayer:field-unexisting","Field '"+b+"' does not exist on the layer");f=0;for(g=this.statisticsInfo;f<g.length;f++)if(h=g[f],h.name===e.name)return k=t.join(this.parsedUrl.path,h.href),[2,n(k,{query:{f:"json"},responseType:"json",signal:d?d.signal:null}).then(function(a){return a.data})];throw new c("scenelayer:no-cached-statistics",
"Cached statistics for this attribute are not available");}})})};g.prototype.validateLayer=function(a){if(a.layerType&&-1===F.indexOf(a.layerType))throw new c("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new c("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new c("layer:service-version-too-new",
"Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,d=!1,e=!1;if(null==a)e=d=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":d=!0;e=b;break;case "vertex-reference-frame":d=!0;e=!b;break;default:d=!1}if(!d)throw new c("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new c("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");};g.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},
b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};g.prototype._applyAssociatedLayerOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields){for(var a=null,b=0,c=this.associatedLayer.fields;b<c.length;b++){var d=c[b];this.getField(d.name)||(a||(a=this.fields?this.fields.slice():[]),a.push(d.clone()))}a&&this._set("fields",a)}a=["popupTemplate","popupEnabled"];b=y.getProperties(this);for(c=0;c<a.length;c++)d=a[c],this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),
b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}};g.prototype._setAssociatedFeatureLayer=function(b){return e(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return[4,this._fetchAssociatedFeatureLayer(b)];case 1:return this.associatedLayer=c=a.sent(),[2]}})})};g.prototype._fetchAssociatedFeatureLayer=function(b){return e(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:if(-1===["mesh-pyramids","points"].indexOf(this.profile))return[2,
null];a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this.portalItem&&this.portalItem.isResolved()?this._fetchAssociatedFeatureLayerFromRelatedItems(this.portalItem,b):this._fetchAssociatedFeatureLayerFromUrl(b)];case 2:return c=a.sent(),[4,c.load({signal:b})];case 3:return[2,a.sent()];case 4:return a.sent(),this._logWarningOnPopupEnabled(),[2,null];case 5:return[2]}})})};g.prototype._logWarningOnPopupEnabled=function(){var a=this;x.whenValidOnce(this,["popupTemplate","popupEnabled"],function(){return a.popupEnabled&&
null!=a.popupTemplate}).then(function(){return function(){var b="this SceneLayer: "+a.title;null==a.attributeStorageInfo?ca.warn("Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on "+b):ca.info("Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on "+b)}})};g.prototype._fetchAssociatedFeatureLayerFromRelatedItems=function(b,c){return e(this,void 0,void 0,function(){var d,e;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,
4,,5]),[4,b.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:c})];case 1:return d=a.sent(),(e=d.filter(function(a){return"Feature Service"===a.type})[0])?[4,this._fetchAssociatedFeatureLayerFromPortalItem(new Y({id:e.id,portal:e.portal}),c)]:[3,3];case 2:return[2,a.sent()];case 3:throw Error();case 4:return a.sent(),[2,this._fetchAssociatedFeatureLayerFromUrl(c)];case 5:return[2]}})})};g.prototype._fetchAssociatedFeatureLayerFromPortalItem=function(b,c){return e(this,
void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return[4,b.load({signal:c})];case 1:return a.sent(),[4,this._findMatchingAssociatedSublayerUrl(b.url,c)];case 2:return d=a.sent(),[2,new m({url:d,portalItem:b})]}})})};g.prototype._fetchAssociatedFeatureLayerFromUrl=function(b){return e(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return[4,this._findMatchingAssociatedSublayerUrl(null,b)];case 1:return c=a.sent(),[2,new m({url:c})]}})})};
g.prototype._findMatchingAssociatedSublayerUrl=function(b,c){void 0===b&&(b=null);return e(this,void 0,void 0,function(){var d,e,f,g,h,k,m,l,p,r,q,w,t,v;return a(this,function(a){switch(a.label){case 0:d=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!d)return[2,u.reject()];null==b&&(b=d[1]+"/FeatureServer");e=b.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");f={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:c};g=d[1]+"/SceneServer";h=parseInt(d[2],10);
k=n(g,f).catch(function(){return{data:{layers:null}}});m=n(e,f);return[4,u.all([m,k])];case 1:l=a.sent();p=l[0];r=l[1];q=r.data&&r.data.layers;w=p.data&&p.data.layers;if(!Array.isArray(w))throw Error("expected layers array");if(Array.isArray(q))for(t=0;t<Math.min(q.length,w.length);t++){if(v=q[t],v.id===h)return[2,e+"/"+w[t].id]}else if(h<w.length)return[2,e+"/"+w[h].id];throw Error("could not find matching associated sublayer");}})})};g.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;
var b=this.originIdOf(a);a=this.associatedLayer.originIdOf(a);return null!=a&&2>=a?null==b||2>b:null!=a&&3>=a?null==b||3>b:!1};g.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&ca.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&ca.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
h([v.property({types:{key:"type",base:K.default,typeMap:{selection:H.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],g.prototype,"featureReduction",void 0);h([v.property({type:[T.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],g.prototype,"rangeInfos",void 0);h([v.property({json:{read:!1}})],g.prototype,"associatedLayer",
void 0);h([v.property({type:["show","hide"]})],g.prototype,"listMode",void 0);h([v.property({type:["ArcGISSceneServiceLayer"]})],g.prototype,"operationalLayerType",void 0);h([v.property({json:{read:!1},readOnly:!0})],g.prototype,"type",void 0);h([v.property(l({},U.fields,{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],g.prototype,"fields",void 0);h([v.property({readOnly:!0,dependsOn:["fields"]})],g.prototype,"fieldsIndex",null);h([v.property(U.outFields)],g.prototype,"outFields",void 0);
h([v.property({type:R.I3SNodePageDefinition,readOnly:!0})],g.prototype,"nodePages",void 0);h([v.property({type:[R.I3SMaterialDefinition],readOnly:!0})],g.prototype,"materialDefinitions",void 0);h([v.property({type:[R.I3STextureSetDefinition],readOnly:!0})],g.prototype,"textureSetDefinitions",void 0);h([v.property({type:[R.I3SGeometryDefinition],readOnly:!0})],g.prototype,"geometryDefinitions",void 0);h([v.property({readOnly:!0})],g.prototype,"serviceUpdateTimeStamp",void 0);h([v.property({readOnly:!0})],
g.prototype,"attributeStorageInfo",void 0);h([v.property({readOnly:!0})],g.prototype,"statisticsInfo",void 0);h([v.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],g.prototype,"definitionExpression",void 0);h([v.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],g.prototype,"path",void 0);h([v.property(J.elevationInfo)],g.prototype,"elevationInfo",
null);h([v.property({type:String,dependsOn:["profile"]})],g.prototype,"geometryType",null);h([v.property(J.labelsVisible)],g.prototype,"labelsVisible",void 0);h([v.property({type:[O],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:Q.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:Q.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],g.prototype,"labelingInfo",void 0);h([v.property(J.legendEnabled)],
g.prototype,"legendEnabled",void 0);h([v.property(J.opacityDrawingInfo)],g.prototype,"opacity",void 0);h([v.property({types:k.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:V}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:V},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],g.prototype,"renderer",null);h([v.property({json:{read:!1}})],g.prototype,"cachedDrawingInfo",void 0);h([v.reader("service","cachedDrawingInfo")],g.prototype,
"readCachedDrawingInfo",null);h([v.property(J.popupEnabled)],g.prototype,"popupEnabled",void 0);h([v.property({type:d,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],g.prototype,"popupTemplate",void 0);h([v.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],g.prototype,"defaultPopupTemplate",null);h([v.property({type:String,json:{read:!1}})],g.prototype,"objectIdField",void 0);h([v.reader("service","objectIdField",["objectIdField",
"fields"])],g.prototype,"readObjectIdField",null);h([v.property({json:{read:!1}})],g.prototype,"objectIdFilter",void 0);h([v.property({type:String,json:{read:!1}})],g.prototype,"profile",void 0);h([v.reader("service","profile",["store.profile"])],g.prototype,"readProfile",null);h([v.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],g.prototype,"normalReferenceFrame",void 0);h([v.property(I.screenSizePerspectiveEnabled)],g.prototype,
"screenSizePerspectiveEnabled",void 0);return g=h([v.subclass("esri.layers.SceneLayer")],g)}(v.declared(E.ScaleRangeLayer(G.SceneService(A.ArcGISService(B.OperationalLayer(C.PortalLayer(p.MultiOriginJSONMixin(w))))))))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../request ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x){Object.defineProperty(b,"__esModule",{value:!0});var v=k.getLogger("esri.layers.mixins.SceneService");b.SceneService=function(b){return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.minScale=0;a.maxScale=0;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}
l(k,b);k.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};k.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return u.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new u(a):null};k.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return a<
y})?null:new r({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};k.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};k.prototype.readTitlePortalItem=function(a){return"item-title"!==this.sublayerTitleMode?void 0:a};k.prototype.readTitleService=function(a,b){a=this.portalItem&&
this.portalItem.title;if("item-title"===this.sublayerTitleMode)return t.titleFromUrlAndName(this.url,b.name);b=b.name||t.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return t.cleanTitle(b)};k.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(k.prototype,"url",{set:function(a){a=t.sanitizeUrlWithLayerId(this,a,v);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});k.prototype.writeUrl=
function(a,b,c,d){t.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(k.prototype,"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=c.urlToObject(a);null!=this.layerId&&t.isArcGISUrl(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});k.prototype._verifyRootNodeAndUpdateExtent=function(b,c){return a(this,void 0,void 0,function(){var a,d,e;return h(this,function(f){switch(f.label){case 0:if(!b)return[3,4];f.label=1;case 1:return f.trys.push([1,
3,,4]),a=this._updateExtentFromRootPage,d=[b],[4,this._fetchRootPage(b,c)];case 2:return[2,a.apply(this,d.concat([f.sent()]))];case 3:return f.sent(),[3,4];case 4:return e=this._updateExtentFromRootNode,[4,this._fetchRootNode(c)];case 5:return[2,e.apply(this,[f.sent()])]}})})};k.prototype._fetchRootPage=function(b,c){return a(this,void 0,void 0,function(){var a,d,f;return h(this,function(g){switch(g.label){case 0:if(!b)return[2,n.reject()];a=Math.floor(b.rootIndex/b.nodesPerPage);d=this.parsedUrl.path+
"/nodepages/"+a;return[4,e(d,{responseType:"json",signal:c})];case 1:return f=g.sent(),[2,f.data]}})})};k.prototype._updateExtentFromRootPage=function(a,b){if(null==b||null==b.nodes)throw new d("sceneservice:invalid-node-page","Inavlid node page.");b=b.nodes[a.rootIndex%a.nodesPerPage];if(null==b||null==b.obb||null==b.obb.center||null==b.obb.halfSize)throw new d("sceneservice:invalid-node-page","Inavlid node page.");a=b.obb.halfSize;b=b.obb.center[2];a=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);this.fullExtent.zmin=
b-a;this.fullExtent.zmax=b+a};k.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};k.prototype._fetchRootNode=function(b){return a(this,void 0,void 0,function(){var a,f,g;return h(this,function(h){switch(h.label){case 0:if(!this.rootNode)return[2];a=c.join(this.parsedUrl.path,this.rootNode);h.label=1;case 1:return h.trys.push([1,
3,,4]),[4,e(a,{query:{f:"json"},responseType:"json",signal:b})];case 2:return f=h.sent(),[2,f.data];case 3:throw g=h.sent(),new d("sceneservice:root-node-missing","Root node missing.",{error:g,url:a});case 4:return[2]}})})};k.prototype._fetchService=function(b){return a(this,void 0,void 0,function(){var a;return h(this,function(c){switch(c.label){case 0:return null==this.layerId&&/SceneServer\/*$/i.test(this.url)?[4,this._fetchFirstLayerId(b)]:[3,2];case 1:a=c.sent(),null!=a&&(this.layerId=a),c.label=
2;case 2:return[2,this._fetchServiceLayer(b)]}})})};k.prototype._fetchFirstLayerId=function(b){return a(this,void 0,void 0,function(){var a;return h(this,function(c){switch(c.label){case 0:return[4,e(this.url,{query:{f:"json"},responseType:"json",signal:b})];case 1:return a=c.sent(),a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length?[2,a.data.layers[0].id]:[2,void 0]}})})};k.prototype._fetchServiceLayer=function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,function(d){switch(d.label){case 0:return[4,
e(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:b})];case 1:return a=d.sent(),a.ssl&&(this.url=this.url.replace(/^http:/i,"https:")),c=a.data,this.read(c,{origin:"service",url:this.parsedUrl}),this.validateLayer(c),[2]}})})};k.prototype.validateLayer=function(a){};f([g.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],k.prototype,"properties",void 0);f([g.property({type:u})],k.prototype,"spatialReference",void 0);f([g.reader("spatialReference",["spatialReference",
"store.indexCRS","store.geographicCRS"])],k.prototype,"readSpatialReference",null);f([g.property({type:r})],k.prototype,"fullExtent",void 0);f([g.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],k.prototype,"readFullExtent",null);f([g.property({readOnly:!0,type:p})],k.prototype,"heightModelInfo",void 0);f([g.property({type:Number,json:{read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"},origins:{service:{read:{source:"minScale"},
write:!1}}}})],k.prototype,"minScale",void 0);f([g.property({type:Number,json:{read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"},origins:{service:{read:{source:"maxScale"},write:!1}}}})],k.prototype,"maxScale",void 0);f([g.property({readOnly:!0})],k.prototype,"version",void 0);f([g.reader("version",["store.version"])],k.prototype,"readVersion",null);f([g.property({type:String,json:{read:{source:"copyrightText"}}})],k.prototype,"copyright",void 0);f([g.property({type:String,
json:{read:!1}})],k.prototype,"sublayerTitleMode",void 0);f([g.property({type:String})],k.prototype,"title",void 0);f([g.reader("portal-item","title")],k.prototype,"readTitlePortalItem",null);f([g.reader("service","title",["name"])],k.prototype,"readTitleService",null);f([g.property({type:Number})],k.prototype,"layerId",void 0);f([g.reader("service","layerId",["id"])],k.prototype,"readLayerId",null);f([g.property(x.url)],k.prototype,"url",null);f([g.writer("url")],k.prototype,"writeUrl",null);f([g.property({dependsOn:["layerId"]})],
k.prototype,"parsedUrl",null);f([g.property({readOnly:!0})],k.prototype,"store",void 0);f([g.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],k.prototype,"rootNode",void 0);return k=f([g.subclass("esri.layers.mixins.SceneService")],k)}(g.declared(b))};var y=-1E38})},"esri/layers/support/I3SLayerDefinitions":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.nodesPerPage=null;a.rootIndex=0;a.lodSelectionMetricType=null;return a}l(c,b);f([a.property({type:Number})],c.prototype,"nodesPerPage",void 0);f([a.property({type:Number})],c.prototype,"rootIndex",void 0);f([a.property({type:String})],c.prototype,"lodSelectionMetricType",void 0);return c=f([a.subclass("esri.layer.support.I3SNodePageDefinition")],c)}(a.declared(h.JSONSupport));
b.I3SNodePageDefinition=q;var e=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.factor=1;return a}l(c,b);f([a.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],c.prototype,"id",void 0);f([a.property({type:Number})],c.prototype,"factor",void 0);return c=f([a.subclass("esri.layer.support.I3SMaterialTexture")],c)}(a.declared(h.JSONSupport));b.I3SMaterialTexture=e;var d=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.baseColorFactor=
[1,1,1,1];a.baseColorTexture=null;a.metallicRoughnessTexture=null;a.metallicFactor=1;a.roughnessFactor=1;return a}l(c,b);f([a.property({type:[Number]})],c.prototype,"baseColorFactor",void 0);f([a.property({type:e})],c.prototype,"baseColorTexture",void 0);f([a.property({type:e})],c.prototype,"metallicRoughnessTexture",void 0);f([a.property({type:Number})],c.prototype,"metallicFactor",void 0);f([a.property({type:Number})],c.prototype,"roughnessFactor",void 0);return c=f([a.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],
c)}(a.declared(h.JSONSupport));b.I3SMaterialPBRMetallicRoughness=d;q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.alphaMode="opaque";a.alphaCutoff=.25;a.doubleSided=!1;a.cullFace="none";a.normalTexture=null;a.occlusionTexture=null;a.emissiveTexture=null;a.emissiveFactor=null;a.pbrMetallicRoughness=null;return a}l(c,b);f([a.enumeration.serializable()({opaque:"opaque",mask:"mask",blend:"blend"})],c.prototype,"alphaMode",void 0);f([a.property({type:Number})],c.prototype,"alphaCutoff",
void 0);f([a.property({type:Boolean})],c.prototype,"doubleSided",void 0);f([a.enumeration.serializable()({none:"none",back:"back",front:"front"})],c.prototype,"cullFace",void 0);f([a.property({type:e})],c.prototype,"normalTexture",void 0);f([a.property({type:e})],c.prototype,"occlusionTexture",void 0);f([a.property({type:e})],c.prototype,"emissiveTexture",void 0);f([a.property({type:[Number]})],c.prototype,"emissiveFactor",void 0);f([a.property({type:d})],c.prototype,"pbrMetallicRoughness",void 0);
return c=f([a.subclass("esri.layer.support.I3SMaterialDefinition")],c)}(a.declared(h.JSONSupport));b.I3SMaterialDefinition=q;var k=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);f([a.property({type:String,json:{read:{source:["name","index"],reader:function(a,b){return null!=a?a:""+b.index}}}})],c.prototype,"name",void 0);f([a.enumeration.serializable()({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],c.prototype,"format",void 0);return c=f([a.subclass("esri.layer.support.I3STextureFormat")],
c)}(a.declared(h.JSONSupport));b.I3STextureFormat=k;q=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.atlas=!1;return a}l(c,b);f([a.property({type:[k]})],c.prototype,"formats",void 0);f([a.property({type:Boolean})],c.prototype,"atlas",void 0);return c=f([a.subclass("esri.layer.support.I3STextureSetDefinition")],c)}(a.declared(h.JSONSupport));b.I3STextureSetDefinition=q;var n=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);f([a.enumeration.serializable()({Float32:"Float32",
UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],c.prototype,"type",void 0);f([a.property({type:Number})],c.prototype,"component",void 0);return c=f([a.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(a.declared(h.JSONSupport));b.I3SGeometryAttribute=n;var c=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);f([a.enumeration.serializable()({draco:"draco"})],c.prototype,"encoding",void 0);f([a.property({type:[String]})],c.prototype,"attributes",void 0);
return c=f([a.subclass("esri.layer.support.I3SGeometryAttribute")],c)}(a.declared(h.JSONSupport));b.I3SGeometryCompressedAttributes=c;q=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.offset=0;return a}l(d,b);f([a.property({type:Number})],d.prototype,"offset",void 0);f([a.property({type:n})],d.prototype,"position",void 0);f([a.property({type:n})],d.prototype,"normal",void 0);f([a.property({type:n})],d.prototype,"uv0",void 0);f([a.property({type:n})],d.prototype,"color",void 0);
f([a.property({type:n})],d.prototype,"uvRegion",void 0);f([a.property({type:n})],d.prototype,"featureId",void 0);f([a.property({type:n})],d.prototype,"faceRange",void 0);f([a.property({type:c})],d.prototype,"compressedAttributes",void 0);return d=f([a.subclass("esri.layer.support.I3SGeometryBuffer")],d)}(a.declared(h.JSONSupport));b.I3SGeometryBuffer=q;h=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);f([a.enumeration.serializable()({triangle:"triangle"})],c.prototype,
"topology",void 0);f([a.property()],c.prototype,"geometryBuffers",void 0);return c=f([a.subclass("esri.layer.support.I3SMeshDefinition")],c)}(a.declared(h.JSONSupport));b.I3SGeometryDefinition=h})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}l(d,b);f([a.property({type:String,json:{read:!0,write:!0}})],d.prototype,"name",void 0);f([a.property({type:String,json:{read:!0,write:!0}})],d.prototype,"field",void 0);f([a.property({type:[Number],json:{read:!0,write:!0}})],d.prototype,"currentRangeExtent",void 0);f([a.property({type:[Number],json:{read:!0,write:!0}})],d.prototype,"fullRangeExtent",void 0);
f([a.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],d.prototype,"type",void 0);return d=f([a.subclass("esri.layers.support.RangeInfo")],d)}(a.declared(h.JSONSupport));b.RangeInfo=q;b.default=q})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ./support/layerViewUpdatingProperties ../support/EventedSet ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){return function(b){function m(a){a=b.call(this,a)||this;a._controllerTotal=0;a._graphicsCoreTotal=0;a.suspendResumeExtentMode="data";return a}l(m,b);m.prototype.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};Object.defineProperty(m.prototype,"updatingProgressValue",{get:function(){var a=1;if(this.controller&&this.controller.updating){var b=this.controller.updatingRemaining,c=this.controller.updatingTotal;
0<c&&(this._controllerTotal=Math.max(c,this._controllerTotal),a=(c-b)/c)}var d=1;this.graphics3d&&this.graphics3d.graphicsCore&&(b=this.graphics3d.graphicsCore.updatingRemaining,c=this.graphics3d.graphicsCore.updatingTotal,0<c&&(this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal),d=(c-b)/c));1===a&&1===d&&(this._graphicsCoreTotal=this._controllerTotal=0);return.5*(a+d)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.controller?
!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":return 5E3<this.controller.serviceDataCount;case "tiles":break;default:d.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"hasZ",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;
return b&&b.supportsZ?"returnZ"in a&&null!=a.returnZ?a.returnZ:b.supportsZ:!1},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"hasM",{get:function(){var a=this.layer,b=a.capabilities&&a.capabilities.data;return b&&b.supportsM?"returnM"in a&&null!=a.returnM?a.returnM:!1:!1},enumerable:!0,configurable:!0});m.prototype.fetchPopupFeatures=function(b,c){return e(this,void 0,void 0,function(){var b;return a(this,function(a){return(b=this.validateFetchPopupFeatures(c))?[2,n.reject(b)]:
[2,this.fetchClientPopupFeatures(c)]})})};m.prototype.setVisibility=function(a,b){this.graphics3d.graphicsCore.setObjectIdVisibility(a,b)};m.prototype.createQuery=function(){return this.inherited(arguments)};m.prototype.queryFeatures=function(a,b){var c=this,d=arguments,e=function(){return c.inherited(d,[a,b])};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(a),e):e()};m.prototype.createController=function(){return e(this,void 0,void 0,function(){var b,d=this;return a(this,
function(a){this.fetcherContext=new x.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});b=new p({layerView:this,context:this.fetcherContext,graphics:new y.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(b,"serviceDataExtent",function(a){d.graphics3d&&(d.graphics3d.dataExtent=a)},2);this.handles.add(c.init(this,"suspended",function(a){a?b.suspend():b.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",
function(){return d.updateDisplayFeatureLimit(b)},2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return d.updateDisplayFeatureLimit()}));return[2,b]})})};m.prototype.doRefresh=function(){return e(this,void 0,void 0,function(){return a(this,function(a){!this.suspended&&this.controller&&this.controller.refetch();return[2]})})};m.prototype.getStats=function(){var a=this.inherited(arguments);if(this.controller&&a.features){var b=this.controller.debug;
a.features+="/"+b.storedFeatures+"/"+b.totalFeatures;a.totalVertices=b.totalVertices}b=(b=this.controller&&this.controller.displayFeatureLimit)&&b.maximumSymbolComplexity;a.numTiles=this.controller?this.controller.tileDescriptors.length:0;a.partial=this.maximumNumberOfFeaturesExceeded;a.mode=this.controller?this.controller.mode:"n/a";a.symbolComplexity=b?"f:"+b.primitivesPerFeature+",v:"+b.primitivesPerCoordinate:"n/a";var c=this.graphics3d&&this.graphics3d.graphicsCore,b=c?c.unprocessedMemoryEstimate:
0,c=this.controller?this.controller.expectedFeatureDiff*c.usedMemoryPerGraphic:0;a.memory="u:"+(this.getUsedMemory()/1024/1024).toFixed(1)+", pc:"+(""+(b/1024/1024).toFixed(1))+", pf:"+(""+(c/1024/1024).toFixed(1))+" MB";return a};m.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};m.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?
a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};m.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};m.prototype.updateDisplayFeatureLimit=function(a){void 0===a&&(a=this.controller);if(a&&this.graphics3d&&this.graphics3d.graphicsCore){var b=this.graphics3d.graphicsCore.displayFeatureLimit,c=this.view.resourceController.memoryController.memoryFactor;a.displayFeatureLimit=
1===c?b:h({},b,{maximumNumberOfFeatures:Math.ceil(b.maximumNumberOfFeatures*c),maximumTotalNumberOfFeatures:Math.ceil(b.maximumTotalNumberOfFeatures*c),minimumTotalNumberOfFeatures:Math.ceil(b.minimumTotalNumberOfFeatures*c)})}};m.prototype._queryFeaturesMesh=function(b,c){return e(this,void 0,void 0,function(){var d,e,f,g,h,k,m,l;return a(this,function(a){switch(a.label){case 0:return[4,this._validateQueryFeaturesMesh(b)];case 1:return a.sent(),[4,c()];case 2:d=a.sent();if(b&&b.outStatistics)return[2,
d];e=this.layer.objectIdField;f=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID;g=[];h=0;for(k=d.features;h<k.length;h++)if(m=k[h],m.geometry){if(l=f.get(m.attributes[e]))m.geometry=r.hydrateGeometry(l.graphic.geometry),g.push(m)}else g.push(m);d.features=g;return[2,d]}})})};m.prototype._validateQueryFeaturesMesh=function(b){return e(this,void 0,void 0,function(){var c,d,e,f,g;return a(this,function(a){if(!b)return[2];c=function(a){throw new k("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+
a+"'");};d=["quantizationParameters","geometryPrecision","maxAllowableOffset"];e=0;for(f=d;e<f.length;e++)g=f[e],null!=b[g]&&c(g);"returnM"in b&&b.returnM&&c("returnM");"returnCentroid"in b&&b.returnCentroid&&c("returnCentroid");b.outSpatialReference&&!b.outSpatialReference.equals(this.view.spatialReference)&&c("outSpatialReference");return[2]})})};f([g.property()],m.prototype,"layer",void 0);f([g.property()],m.prototype,"controller",void 0);f([g.property({readOnly:!0,dependsOn:["controller.updatingRemaining",
"controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],m.prototype,"updatingProgressValue",null);f([g.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],m.prototype,"maximumNumberOfFeatures",void 0);f([g.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],m.prototype,"maximumNumberOfFeaturesExceeded",null);f([g.property(v.updatingProgress)],m.prototype,"updatingProgress",void 0);f([g.property({readOnly:!0,
dependsOn:["controller.mode"]})],m.prototype,"asyncGraphicsUpdates",null);f([g.property({readOnly:!0})],m.prototype,"hasZ",null);f([g.property({readOnly:!0})],m.prototype,"hasM",null);f([g.property()],m.prototype,"suspendResumeExtentMode",void 0);return m=f([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],m)}(g.declared(A.RefreshableLayerView(m.FeatureLayerView(u.FeatureLikeLayerView3D(t.LayerView3D(w))))))})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags ../../../views/support/WatchUpdatingTracking".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I){function K(a,b){if(a&&-1!==a.indexOf("*"))return!1;if(!a)return!!b;if(!b)return!1;a=p.createSetFromValues(a);for(var c=0;c<b.length;c++)if(!a.has(b[c]))return!0;return!1}var H=t.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");q=function(b){function d(a){a=b.call(this,a)||this;a.type="feature-tile-3d";a.watchUpdatingTracking=new I.WatchUpdatingTracking;a.serviceDataExtent=null;a.serviceDataCount=h.constants.NO_SERVICE_DATA_COUNT;
a.vertexLimitExceeded=!1;a.displayFeatureLimit=null;a.suspended=!1;a.tileFetcher=null;a.handles=new r;a.fetchDataInfoPromise=null;a.fetchDataInfoAbortController=null;a.lifeCycleAbortController=y.createAbortController();return a}l(d,b);h=d;Object.defineProperty(d.prototype,"extent",{set:function(a){if(a&&!a.spatialReference.equals(this.layerView.view.spatialReference))H.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||
(a=a?a.clone():null,this._set("extent",a))}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingTotal",{get:function(){return this.updating&&
this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryForUnusedFeatures",
{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?
this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(a){a!==this.maximumNumberOfFeatures&&(null==a?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",a))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"mode",{get:function(){if(this.serviceDataCount===h.constants.NO_SERVICE_DATA_COUNT||
this.vertexLimitExceeded)return"tiles";var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>h.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"maxTotalSnapshotVertices",{get:function(){var a=this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0)},enumerable:!0,configurable:!0});d.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize+c.height/b.pixelSize)/2)};Object.defineProperty(d.prototype,"tileDescriptors",{get:function(){return"snapshot"===
this.mode?new n([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new n},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.watchUpdatingTracking.add(this,"vertexLimitInfo",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,
a.lifeCycleAbortController.signal))});this.watchUpdatingTracking.add(this,"mode",function(){return a.modeChanged()},2);var b=y.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.watchUpdatingTracking.addPromise(a.fetchServiceDataInfo())}).then(function(){return a.initializeTileFetcher()});this.addResolvingPromise(b)};d.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new g("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:a});};d.prototype.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null);this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",
null)};d.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())};d.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};d.prototype.restart=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,b))};d.prototype.refetch=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(b,
b))};d.prototype.initializeTileFetcher=function(){var a=this,b=this.layerView.view,c=m.whenOnce(b.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(c);c.then(function(){var c=a.layerView,d=c.layer;a.tileFetcher=new E.FeatureTileFetcher3D({context:a.context,filterExtent:a.filteredDataExtent,tileDescriptors:a.tileDescriptors,features:a.graphics});a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();var e=a.layerView.view.resourceController;
e&&(a.handles.add(e.memoryController.events.on("quality-changed",function(b){a.tileFetcher.memoryFactor=b})),a.tileFetcher.memoryFactor=e.memoryController.memoryFactor);(e="polygon"===a.context.geometryType?"polygonLodFactor":"polyline"===a.context.geometryType?"polylineLodFactor":null)&&a.handles.add(m.init(a.layerView.view,"qualitySettings.graphics3D."+e,function(b){a.tileFetcher.lodFactor=b||1}));a.watchUpdatingTracking.add(d,"definitionExpression",function(){return a.definitionExpressionChanged()});
a.watchUpdatingTracking.add(c,"availableFields",function(b,c){return a.availableFieldsChanged(c,b)});a.watchUpdatingTracking.add(c,"requiredFields",function(b,c){return a.requiredFieldsChanged(c,b)});"gdbVersion"in d&&a.watchUpdatingTracking.add(d,"gdbVersion",function(){return a.refetch()});a.handles.add([d.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=
b},!0),m.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=b;a.tileFetcher.useTileCount=a.serviceDataCount>b},!0),m.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),m.init(J,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new G.FeatureTileFetcher3DDebugger(a.tileFetcher,b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&
a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=null)})]);a.supportsExceedsLimitQuery||a.watchUpdatingTracking.add(a,"maxTotalSnapshotVertices",function(){return a.watchUpdatingTracking.addPromise(a.updateVertexLimitExceeded(null,a.lifeCycleAbortController.signal))})}).catch(function(){})};d.prototype.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:H.warn("Unhandled feature layer mode "+
this.mode);case "snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}};d.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};d.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||a.addedFeatures.length)&&b.watchUpdatingTracking.addPromise(b.updateServiceDataExtent(b.lifeCycleAbortController.signal))})};
d.prototype.availableFieldsChanged=function(a,b){K(a,b)&&this.refetch()};d.prototype.requiredFieldsChanged=function(a,b){K(a,b)&&this.restart()};d.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer,c=b.createQuery();c.outStatistics=[new C({statisticType:"exceedslimit",maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];b.capabilities.query.supportsCacheHint&&(c.cacheHint=!0);return c};d.prototype.createDataInfoQuery=function(){var a=
this.layerView.layer,b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsCacheHint&&(b.cacheHint=!0);return b};d.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":case "stream":return A.isHostedAgolService(a.url);case "csv":case "geojson":return!0;default:c.neverReached(a)}};d.prototype.updateServiceDataExtent=function(b){return e(this,void 0,void 0,function(){var c;
return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(b)];case 1:return a.sent(),[3,3];case 2:return c=a.sent(),y.isAbortError(c)||this._set("serviceDataExtent",u.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})};d.prototype.tryUpdateServiceDataExtent=function(b){return e(this,void 0,void 0,function(){var c,d,e,f,g,k,m,l,p,n,r,q;return a(this,function(a){switch(a.label){case 0:c=this.layerView;d=c.layer;
e=d.capabilities.query.supportsExtent;f=u.clone(c.fullExtentInLocalViewSpatialReference);g=d.fullExtent;k=this.fullExtentIsAccurate();m=this.serviceDataCount;l=e&&m<=h.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!f||!k);if(!l)return[3,2];p=this.createDataInfoQuery();return[4,d.queryExtent(p,{timeout:h.constants.QUERY_EXTENT_TIMEOUT,signal:b})];case 1:return n=a.sent(),this._set("serviceDataExtent",n.extent),[3,6];case 2:if(!f)return[3,3];this._set("serviceDataExtent",f);return[3,6];case 3:if(!g)return[3,
5];r="portalItem"in d?d.portalItem:null;return[4,B.projectGeometry(g,c.view.spatialReference,r,b)];case 4:return q=a.sent(),this._set("serviceDataExtent",q),[3,6];case 5:this._set("serviceDataExtent",null),a.label=6;case 6:return[2]}})})};d.prototype.updateServiceDataCount=function(b){return e(this,void 0,void 0,function(){var c,d,e;return a(this,function(a){switch(a.label){case 0:return c=this.layerView.layer,[4,k.result(c.queryFeatureCount(this.createDataInfoQuery(),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT,
signal:b}))];case 1:d=a.sent();if(!0===d.ok)this._set("serviceDataCount",d.value);else{if(y.isAbortError(d.error))throw d.error;e=h.constants.NO_SERVICE_DATA_COUNT;this._set("serviceDataCount",e)}return[2]}})})};Object.defineProperty(d.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=this.displayFeatureLimit,b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,
d=this._get("vertexLimitInfo");return x.isNone(d)||d.maximumTotalNumberOfPrimitives!==a||d.primitivesPerCoordinate!==c||d.primitivesPerFeature!==b?{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}:d},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;return a.capabilities&&a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return c.neverReached(a),0}},enumerable:!0,configurable:!0});d.prototype.updateVertexLimitExceeded=function(b,c){return e(this,void 0,void 0,function(){var d,e,f,g,m,l,p,n,r,q,w,t,v,u,A;return a(this,function(a){switch(a.label){case 0:d=
x.isSome(this.vertexLimitInfo)&&0>=this.vertexLimitInfo.primitivesPerFeature;e=1<this.minimumNumberOfVerticesForGeometry;f=this.layerView.layer;g=this.supportsExceedsLimitQuery;if(x.isNone(this.vertexLimitInfo)||!d&&!e)return this._set("vertexLimitExceeded",!1),[2];m=this.vertexLimitInfo;l=m.primitivesPerFeature;p=m.primitivesPerCoordinate;n=m.maximumTotalNumberOfPrimitives;return(r=0!==l)&&x.isSome(b)?[4,b]:[3,2];case 1:a.sent(),a.label=2;case 2:return q=this.serviceDataCount,w=(t=q!==h.constants.NO_SERVICE_DATA_COUNT)?
Math.ceil((n-q*l)/(p||1)):Math.ceil(n/(p||1)),e&&(w=Math.min(w,L)),t&&this.minimumNumberOfVerticesForGeometry*q>w?(this._set("vertexLimitExceeded",!0),[2]):g?[4,k.result(f.queryFeatures(this.createVertexLimitExceededQuery(w),{timeout:h.constants.QUERY_STATISTICS_TIMEOUT,signal:c}))]:(this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>w),[2]);case 3:v=a.sent();if(!1===v.ok){if(y.isAbortError(v.error))throw v.error;this._set("vertexLimitExceeded",!1);return[2]}u=v.value;(A=u.features[0])&&
A.attributes?this._set("vertexLimitExceeded",!!A.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);return[2]}})})};d.prototype.fetchServiceDataInfo=function(){return e(this,void 0,void 0,function(){var b,c,d,e,f,g=this;return a(this,function(a){this.cancelFetchServiceDataInfo();b=y.createAbortController();c=b.signal;d=this.updateServiceDataCount(c);e=y.eachAlways([d,this.updateVertexLimitExceeded(d,c)]);f=e.then(function(){return g.updateServiceDataExtent(c)}).catch(function(a){y.isAbortError(a)||
H.error("#fetchServiceDataInfo()",a)}).then(function(){f===g.fetchDataInfoPromise&&(g.fetchDataInfoPromise=null,g.fetchDataInfoAbortController=null);b=null});b&&(this.fetchDataInfoPromise=f);this.fetchDataInfoAbortController=b;return[2,e.then(function(){},function(){})]})})};d.prototype.cancelFetchServiceDataInfo=function(){var a=this.fetchDataInfoAbortController;a&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,a.abort())};Object.defineProperty(d.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?
this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0});var h;f([w.property({readOnly:!0})],d.prototype,"type",void 0);f([w.property({constructOnly:!0})],d.prototype,"graphics",void 0);f([w.property({constructOnly:!0})],d.prototype,"layerView",void 0);f([w.property({constructOnly:!0})],d.prototype,"context",void 0);f([w.property()],d.prototype,"extent",null);
f([w.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],d.prototype,"updating",null);f([w.property({readOnly:!0})],d.prototype,"watchUpdatingTracking",void 0);f([w.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],d.prototype,"updatingTotal",null);f([w.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],d.prototype,"updatingRemaining",null);f([w.property({dependsOn:["updating",
"tileFetcher.expectedFeatureDiff"]})],d.prototype,"expectedFeatureDiff",null);f([w.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],d.prototype,"memoryForUnusedFeatures",null);f([w.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],d.prototype,"maximumNumberOfFeaturesExceeded",null);f([w.property({readOnly:!0})],d.prototype,"serviceDataExtent",void 0);f([w.property({readOnly:!0})],d.prototype,"serviceDataCount",void 0);f([w.property({readOnly:!0})],d.prototype,"vertexLimitExceeded",
void 0);f([w.property({readOnly:!0,dependsOn:["extent"]})],d.prototype,"filteredDataExtent",null);f([w.property()],d.prototype,"displayFeatureLimit",void 0);f([w.property({type:Number,dependsOn:["displayFeatureLimit"]})],d.prototype,"maximumNumberOfFeatures",null);f([w.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],d.prototype,"mode",
null);f([w.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],d.prototype,"maxTotalSnapshotVertices",null);f([w.property({readOnly:!0,dependsOn:["mode"]})],d.prototype,"tileDescriptors",null);f([w.property()],d.prototype,"tileFetcher",void 0);f([w.property()],d.prototype,"fetchDataInfoPromise",void 0);f([w.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],d.prototype,"vertexLimitInfo",null);return d=h=f([w.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
d)}(w.declared(v.EsriPromiseMixin(d)));var L=5E6;(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(q||(q={}));q.constants.reset();return q})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/now ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/index ../../../support/QueueProcessor".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G){function J(a){return"dummy-tile-full-extent"===a.id}function I(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}Object.defineProperty(b,"__esModule",{value:!0});var K=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");q=function(b){function c(a){a=b.call(this,a)||this;a.useTileCount=!1;a.updating=!1;a.updatingTotal=0;a.updatingRemaining=0;
a.expectedFeatureDiff=0;a.maximumNumberOfFeaturesExceeded=!1;a.maximumNumberOfFeaturesExceededThrottle=1E3;a.maximumNumberOfFeaturesExceededNext=0;a._fullRatio=1;a._farRatio=1;a.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};a.handles=new n;a._dirty=!1;a.idToFeatureTile=new Map;a.displayingFeatureReferences=new Map;a.numDisplayingFeatureReferences=0;a.suspended=!0;a.pendingEdits=null;return a}l(c,b);Object.defineProperty(c.prototype,"maximumNumberOfFeatures",{set:function(a){a=a||Infinity;
var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryFactor",{set:function(a){this.memoryFactor!==a&&(this._set("memoryFactor",a),this.setDirty())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodFactor",{set:function(a){this.lodFactor!==a&&(this._set("lodFactor",a),this.supportsResolution&&this.refetch())},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"memoryForUnusedFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"totalVertices",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.numVertices});return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"totalFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.numFeatures});
return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"filterExtent",{set:function(a){if(a&&this.context.tilingScheme&&!a.spatialReference.equals(this.context.tilingScheme.spatialReference))K.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=
this;this.fetchQueue=this.createFetchQueue();this.handles.add(t.on(this,"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?A.MultiFeatureReference:A.SingleFeatureReference;var b=this.context.scheduler;g.isSome(b)&&this.handles.add(b.registerTask(E.Task.FEATURE_TILE_FETCHER,function(b){return a.update(b)},function(){return a._dirty||
0<a.maximumNumberOfFeaturesExceededNext}));this.setDirty()};c.prototype.destroy=function(){var a=this;this.handles&&(this.handles.destroy(),this.handles=null);this.forEachFeatureTile(function(b){a.cancelFetchTile(b);a.removeTile(b)});this.idToFeatureTile.clear();this.displayingFeatureReferences.clear();this.fetchQueue.destroy();this.fetchQueue=null;this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Object.defineProperty(c.prototype,"paused",{get:function(){return this.suspended||
!!this.pendingEdits},enumerable:!0,configurable:!0});c.prototype.restart=function(){var a=this;this.fetchQueue.clear();this.forEachFeatureTile(function(b){a.clearTile(b);a.resetFetchTile(b)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};c.prototype.refetch=function(){var a=this;this.fetchQueue.clear();this.forEachFeatureTile(function(b){a.cancelFetchTile(b);a.resetFetchTile(b)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};
c.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};c.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};c.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())};c.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())};c.prototype.getFeatureTileById=function(a){return this.idToFeatureTile.get(a)||null};c.prototype.forEachFeatureTile=
function(a){this.idToFeatureTile.forEach(a)};c.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:p.resolve(),count:0,controller:p.createAbortController()},this.pause());this.pendingEdits.count++;var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(p.isAbortError(a))throw a;return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures,b.pendingEdits.controller.signal).then(function(){return a})):
a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,g.isSome(b.context.memoryCache)&&b.context.memoryCache.clear(),b.unpause(),b.updated());return a})});this.pendingEdits.edits=c;this.updated();return c};c.prototype.applyEditsDeleteFeatures=function(a){var b=this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});this.forEachFeatureTile(function(a){if(a.features){var d=a.features.filter(function(a){return!c.has(y.getObjectId(a,b.objectIdField))});d.length!==
a.features.length&&(a.setFeatures(d,0),b.invalidateCounts())}})}};c.prototype.applyEditsAddUpdateFeatures=function(b,c,d){return a(this,void 0,void 0,function(){var a,f,g,h=this;return e(this,function(e){switch(e.label){case 0:a=[];f=new Set;b.forEach(function(b){return a.push(b.objectId)});c.forEach(function(b){a.push(b.objectId);f.add(b.objectId)});if(0===a.length)return[2];g=[];this.forEachFeatureTile(function(b){(b=h.applyEditsAddUpdateTile(b,a,f,d))&&g.push(b)});return[4,p.eachAlways(g)];case 1:return e.sent(),
[2]}})})};c.prototype.applyEditsAddUpdateTile=function(b,c,d,f){return a(this,void 0,void 0,function(){var a,g,h,k,m,l,p,n=this;return e(this,function(e){switch(e.label){case 0:if(!b.features)return[2];a=this.createQuery(b);a.resultType=void 0;a.cacheHint=!1;a.objectIds=c;return[4,this.queryFeatures(a,f)];case 1:g=e.sent();h=null;0<d.size&&(k=b.features.filter(function(a){return!d.has(y.getObjectId(a,n.objectIdField))}),k.length!==b.features.length&&(h=k));if(0<g.features.length)for(h||(h=b.features.slice()),
this.context.adjustVerticalScale(g.features),m=0,l=g.features;m<l.length;m++)p=l[m],h.push(p);h&&(b.setFeatures(h,0),this.invalidateCounts());return[2]}})})};c.prototype.queryFeatures=function(a,b){return this.context.query.queryFeaturesDehydrated(a,{signal:b,timeout:S})};c.prototype.createFetchQueue=function(){var a=this;return new G.QueueProcessor({concurrency:6,task:E.Task.FEATURE_FETCH_QUEUE,scheduler:this.context.scheduler,peeker:function(b){return a.highestPriorityTile(b)},process:function(b,
c){return a.fetchTile(b,c)}})};c.prototype.highestPriorityTile=function(a){var b=this;if(this.useTileCount){var c=k.find(a,function(a){return b.needsNumFeatures(a)});if(c)return c}return a.reduce(function(a,b){return a&&a.descriptor.loadPriority<=b.descriptor.loadPriority?a:b},null)};c.prototype.setDirty=function(){this._dirty=!0;this.updated()};c.prototype.update=function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&r()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();
if(this._dirty&&this.constructed){this._dirty=!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);if(a.run(function(){return b.addTiles(c,a)})&&a.run(function(){return b.filterExtentTiles(c,a)})&&a.run(function(){return b.removeTiles(c,a)})&&!a.done){var d=this.sortTiles(c);a.run(function(){return b.displayTiles(d,a)})&&a.run(function(){return b.queueFetchTiles(d,a)})&&a.run(function(){return b.updateMemoryEstimates(d,a)})||this.setDirty();this.updated()}else this.setDirty()}};c.prototype.markTilesNotAlive=
function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};c.prototype.addTiles=function(a,b){var c=this;if(this.suspended)return!1;this.tileDescriptors.forEach(function(d){var e=c.getFeatureTileById(d.id);e?e.alive=!0:b.done||(a.push(c.addTile(d)),b.madeProgress())});return b.hasProgressed};c.prototype.filterExtentTiles=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b.done)break;d.alive&&(d.filtered=!d.intersects(this.filterExtent),d.filtered&&(this.clearTile(d),b.madeProgress()))}return b.hasProgressed};
c.prototype.removeTiles=function(a,b){for(var c=a.length-1;0<=c&&!b.done;c--){var d=a[c];d.alive||(this.removeTile(d),c!==a.length-1&&(a[c]=a[a.length-1]),a.pop(),b.madeProgress())}return b.hasProgressed};c.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};c.prototype.displayTiles=function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.run(function(){var b=1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,
c.memoryFactor,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return f.setDirty(),"break"},f=this,g=0;g<a.length&&"break"!==e(a[g]);g++);return b.hasProgressed};c.prototype.queueFetchTiles=function(a,b){for(var c=this,d=function(a){if(!b.run(function(){return c.queueFetchTile(a)}))return e.setDirty(),{value:!0}},e=this,f=0;f<a.length;f++){var g=d(a[f]);if("object"===typeof g)return g.value}return b.hasProgressed};c.prototype.updateMemoryEstimates=function(a,b){var c=this;a.some(function(a){return b.run(function(){return a.updateMemoryEstimates()})?
!1:(c.setDirty(),!0)});return b.hasProgressed};c.prototype.reclip=function(a,b){var c=this;this.constructed&&(this.forEachFeatureTile(function(d){d.displayingFeatures&&0!==d.displayingFeatures.length&&(d.intersection(b,L),d.intersection(a,P),v.equals(L,P)||c.hideTileFeatures(d))}),this.forEachFeatureTile(function(a){return c.showTile(a)}),this.updated())};c.prototype.updated=function(){var a=this,b=this._dirty||0<this.fetchQueue.length&&!this.paused||!!this.pendingEdits;this._set("updating",b);if(b){var c=
b=0,d=0,e=0,f=0,g=0,h=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(b){++d;if(b.isFetching&&b.hasPreciseFeatureCount){var k=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);g+=k-(b.displayingFeatures?b.displayingFeatures.length*h:0)}b.needsFetching?++f:0<b.numFeatures&&(++e,c+=b.numFeatures)});var f=f+(this.fetchQueue?this.fetchQueue.length:0),k=0;c?(b=c,k=Math.min(f*c/e,c)):(b=d,k=f);g=Math.min(this.maximumNumberOfFeatures-this.features.length,
g);this._set("updatingTotal",b);this._set("updatingRemaining",k);this._set("expectedFeatureDiff",g)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||r()+this.maximumNumberOfFeaturesExceededThrottle)};c.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.forEachFeatureTile(function(b){a=
a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",a)}};c.prototype.updateRatio=function(a){for(var b=I(a),c=function(a){return 1/(1<<Math.max(0,b-a.descriptor.lij[0]))},d=0,e=0,f=0;f<a.length;f++)var g=a[f],h=g.numFeatures,d=d+h,e=e+h*c(g);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};c.prototype.maximumFeaturesUpdated=function(a,
b){var c=this;a!==b&&(b>a&&this.forEachFeatureTile(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&(a.features.length>=b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};c.prototype.addTile=function(a){a=new B.FeatureTile(a);this.idToFeatureTile.set(a.id,a);this.resetFetchTile(a);this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};c.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;
this.forEachFeatureTile(function(d){if(d.displayingFeatures&&a!==d&&(!a.descriptor.lij||!d.descriptor.lij||C.tilesAreRelated(a.descriptor.lij,d.descriptor.lij))){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<d.length;e++){var f=d[e];a.displayingFeatures.push(f);f=b.displayingFeatureReferences.get(y.getObjectId(f,b.objectIdField));f.ref(f.feature,c);b.numDisplayingFeatureReferences++}}});a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};c.prototype.removeTile=
function(a){this.clearTile(a);this.idToFeatureTile.delete(a.id)};c.prototype.resetFetchTile=function(a){a.filtered=!a.intersects(this.filterExtent);a.filtered?a.needsFetching&&(a.fetchStatus=4):a.fetchStatus=0};c.prototype.cancelFetchTile=function(a){a.fetchRequest&&(a.fetchRequest=null,a.fetchStatus=0,this.fetchQueue.abort(a))};c.prototype.fetchTile=function(b,c){return a(this,void 0,void 0,function(){var a,d,f,g,h,k,m,l,n,r,q,t;return e(this,function(e){switch(e.label){case 0:if(!this.needsNumFeatures(b))return[3,
5];e.label=1;case 1:return e.trys.push([1,3,,4]),a=b,[4,this.fetchCount(b,c)];case 2:return a.numFeatures=e.sent(),this.updateRatio(this.getListOfTiles()),[3,4];case 3:d=e.sent();if(p.isAbortError(d))return[2,void 0];b.numFeatures=B.FAILED_FEATURE_COUNT;return[3,4];case 4:return[2,0];case 5:f=this.maximumFeaturesForTile(b);if(0>=f)return b.setFeatures([],0),b.featuresMissing=!1,[2,4];g=this.getMaxRecordCount(b);h=Math.ceil(f/g);if(J(b)||!this.context.capabilities.supportsMaxRecordCountFactor||b.numFeatures<=
f&&h>w.MAX_MAX_RECORD_COUNT_FACTOR)return[2,this.fetchPagedTile(b,c)];k=this.createQuery(b);k.maxRecordCountFactor=Math.ceil(f/g);b.isRefetching&&b.features&&0<b.features.length&&(m=Math.ceil(b.features.length/(1-b.emptyFeatureRatio)/g),k.maxRecordCountFactor=Math.max(m+1,k.maxRecordCountFactor));return[4,this.queryFeatures(k,c)];case 6:return l=e.sent(),n=l.features,q=(r=l.exceededTransferLimit)?k.maxRecordCountFactor>=w.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,b.featuresMissing=n.length<b.numFeatures||
r,t=this._removeEmptyFeatures(n),this.context.adjustVerticalScale(n),b.setFeatures(n,t),this.invalidateCounts(),[2,q]}})})};c.prototype.fetchCount=function(b,c){return a(this,void 0,void 0,function(){return e(this,function(a){return[2,this.context.query.queryFeatureCount(this.createFeatureCountQuery(b),{signal:c})]})})};c.prototype.fetchPagedTile=function(b,c){return a(this,void 0,void 0,function(){var a,d,f,g,h,k,m,l,p,n,r;return e(this,function(e){switch(e.label){case 0:g=d=a=0,h=this.maximumFeaturesForTile(b)-
g,k=this.getMaxRecordCount(b),e.label=1;case 1:return m=this.createQuery(b),l=this.setPagingParameters(m,a,h,k),[4,this.queryFeatures(m,c)];case 2:return p=e.sent(),n=p.features,r=p.exceededTransferLimit,l&&(a+=m.num),g+=n.length,d+=this._removeEmptyFeatures(n),this.context.adjustVerticalScale(n),b.featuresMissing=a<b.numFeatures||r,f=f?f.concat(n):n,b.setFeatures(f,d),this.invalidateCounts(),this.setDirty(),h=this.maximumFeaturesForTile(b)-g,!l||!r||0>=h?[2,r?4:5]:[3,1];case 3:return[2]}})})};c.prototype.createFeatureCountQuery=
function(a){a=this.createQuery(a);this.context.capabilities.supportsCacheHint&&(a.resultType=void 0,a.cacheHint=!0);return a};c.prototype.createQuery=function(a){var b=this.context.createQuery(),c=a.descriptor.extent;c&&(b.geometry=v.toExtent(c,this.context.tilingScheme.spatialReference));this.setResolutionParams(b,a);this.useTileQuery(a)?b.resultType="tile":this.context.capabilities.supportsCacheHint&&(b.cacheHint=!0);return b};c.prototype.setPagingParameters=function(a,b,c,d){if(!this.context.capabilities.supportsPagination)return!1;
a.start=b;0<c&&this.context.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/d),a.num=Math.min(a.maxRecordCountFactor*d,c)):a.num=Math.min(d);return!0};c.prototype.getEffectiveTileResolution=function(a){if(null==a.descriptor.resolution)return null;var b="global"===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)/this.lodFactor};Object.defineProperty(c.prototype,"supportsResolution",{get:function(){return this.context.capabilities.supportsMultipleResolutions&&
"point"!==this.context.geometryType},enumerable:!0,configurable:!0});c.prototype.setResolutionParams=function(a,b){this.supportsResolution&&(b=this.getEffectiveTileResolution(b),null!=b&&(this.context.capabilities.supportsQuantization?a.quantizationParameters=new m.default({mode:"view",originPosition:"upper-left",tolerance:b,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(a.maxAllowableOffset=b)))};c.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)y.hasVertices(a[c].geometry)?
++c:(a[c]=a[a.length-1],--a.length);return b-a.length};c.prototype.needsNumFeatures=function(a){return this.useTileCount&&a.needsFeatureCount&&!J(a)};c.prototype.getMaxRecordCount=function(a){var b=this.context,c=b.tileMaxRecordCount,b=b.maxRecordCount;return this.useTileQuery(a)&&g.isSome(c)&&0<c&&this.context.capabilities.supportsResultType?c:g.isSome(b)&&0<b?b:H};c.prototype.useTileQuery=function(a){return J(a)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};
c.prototype.queueFetchTile=function(a){var b=this;if(!a.needsFetching)return!1;var c=g.isSome(this.context.memoryCache)&&this.context.memoryCache.pop(a.id);if(c)return a.loadCache(c),this.setDirty(),this.scheduleUpdated(),!0;a.fetchStatus=a.needsRefetching?3:2;var d=!1,e=!1,f=this.fetchQueue.push(a).then(function(b){a.fetchRequest=null;a.fetchStatus=b}).catch(function(c){a.fetchRequest===f&&(a.fetchRequest=null,a.fetchStatus=4);p.isAbortError(c)?d=!0:(a.setFeatures([],0),b.invalidateCounts(),a.featuresMissing=
!1,b.context.logFetchError(K,c))}).then(function(){e=!0;d||b.setDirty();b.scheduleUpdated()});e||(a.fetchRequest=f);return!0};c.prototype.scheduleUpdated=function(){var a=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(u.schedule(function(){a.handles.remove("scheduleUpdated");a.updated()}),"scheduleUpdated")};c.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;var b=a.features;if(0===a.featureLimit||!b)return b=a.displayingFeatures&&0<
a.displayingFeatures.length,this.hideTileFeatures(a),a.displayingFeatures=[],b;var c=a.descriptor.resolution,d=this.changes.updates,e=this.changes.adds,f=Math.min(a.featureLimit,b.length);a.featureLimit=f;for(var g=0;g<f;++g){var h=b[g],k=y.getObjectId(h,this.objectIdField),m=this.displayingFeatureReferences.get(k);m?(h=m.ref(h,c),h.oldVersion!==h.newVersion&&(d.removes.push(h.oldVersion),d.adds.push(h.newVersion))):(this.displayingFeatureReferences.set(k,new this.FeatureReferenceClass(h,c)),e.push(h));
this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=b.slice(0,f);return!0};c.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};c.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,d=0,e=a.displayingFeatures;d<e.length;d++){var f=y.getObjectId(e[d],this.objectIdField),g=this.displayingFeatureReferences.get(f);g&&((g=g.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,
g)?g.oldVersion!==g.newVersion&&(null==g.newVersion?(this.displayingFeatureReferences.delete(f),c.push(g.oldVersion)):(b.adds.push(g.newVersion),b.removes.push(g.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};c.prototype.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,
b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+R,c);this.features.addMany(a.slice(d,e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=0};c.prototype.clearTile=function(a){this.hideTile(a);a.features&&g.isSome(this.context.memoryCache)&&this.context.memoryCache.put(a.id,a.cacheItem,16+a.estimatedSize);a.setFeatures(null,0);this.invalidateCounts()};
c.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};c.prototype.getListOfTiles=function(){var a=Array(this.idToFeatureTile.size),b=0;this.forEachFeatureTile(function(c){return a[b++]=c});return a};Object.defineProperty(c.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!0,configurable:!0});c.prototype.maximumFeaturesForTile=
function(a){var b=a.hasPreciseFeatureCount?a.numFeatures:Infinity;return Math.min(Math.ceil((a.hasPreciseFeatureCount?b:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{update:function(b){a.fetchQueue.test.update(b);a.update(b)}}},enumerable:!0,configurable:!0});f([x.property({constructOnly:!0})],c.prototype,"features",void 0);f([x.property()],c.prototype,"tileDescriptors",void 0);
f([x.property({value:Infinity})],c.prototype,"maximumNumberOfFeatures",null);f([x.property({value:1})],c.prototype,"memoryFactor",null);f([x.property({value:1})],c.prototype,"lodFactor",null);f([x.property()],c.prototype,"useTileCount",void 0);f([x.property({readOnly:!0})],c.prototype,"updating",void 0);f([x.property({readOnly:!0})],c.prototype,"updatingTotal",void 0);f([x.property({readOnly:!0})],c.prototype,"updatingRemaining",void 0);f([x.property({readOnly:!0})],c.prototype,"expectedFeatureDiff",
void 0);f([x.property({readOnly:!0})],c.prototype,"memoryForUnusedFeatures",null);f([x.property({readOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceeded",void 0);f([x.property({constructOnly:!0})],c.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);f([x.property({readOnly:!0})],c.prototype,"totalVertices",null);f([x.property({readOnly:!0})],c.prototype,"totalFeatures",null);f([x.property()],c.prototype,"filterExtent",null);f([x.property({constructOnly:!0})],c.prototype,"context",void 0);
return c=f([x.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],c)}(x.declared(d));b.FeatureTileFetcher3D=q;b.contextCapabilitiesFromLayer=function(a){var b=a.capabilities.query;a:switch(a.geometryType){case "polyline":a=!0;break a;case "polygon":a=a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;break a;default:a=!1}return{supportsMultipleResolutions:a,supportsPagination:!(!b||!b.supportsPagination),supportsResultType:!(!b||!b.supportsResultType),supportsCacheHint:!(!b||
!b.supportsCacheHint),supportsQuantization:!(!b||!b.supportsQuantization),supportsQuantizationEditMode:!(!b||!b.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!b||!b.supportsMaxRecordCountFactor),supportsFormatPBF:!(!b||!b.supportsFormatPBF)}};var H=2E3,L=v.create(),P=v.create(),S=6E5,R=200;b.default=q})},"esri/views/3d/layers/support/featureReference":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures"],function(q,b,l){Object.defineProperty(b,"__esModule",
{value:!0});q=function(){function b(a,b){this.highestResolutionVersion=null;this.versions=[];this.ref(a,b)}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(a,b){var d=this.feature;f.oldVersion=d;this.feature&&(a.uid=this.feature.uid);for(var e=
0,h=this.versions;e<h.length;e++){var c=h[e];if(c.resolution===b){c.refCount++;if((b=this.highestResolutionVersion===c&&!l.equals(a,c.feature))||this.highestResolutionVersion!==c)c.feature=a;f.newVersion=b?a:d;return f}}c={feature:a,resolution:b,refCount:1};this.versions.push(c);!this.highestResolutionVersion||b<this.highestResolutionVersion.resolution?(f.newVersion=a,this.highestResolutionVersion=c):f.newVersion=d;return f};b.prototype.unref=function(a){for(var b=0;b<this.versions.length;b++){var d=
this.versions[b];if(d.resolution===a)return d.refCount--,f.oldVersion=this.feature,0===d.refCount&&(this.versions[b]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===d&&(this.recalculateHighestResolutionVersion(),f.oldVersion=d.feature)),f.newVersion=this.feature,f}return null};Object.defineProperty(b.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0});b.prototype.recalculateHighestResolutionVersion=
function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var a=this.versions[0],b=1;b<this.versions.length;b++){var d=this.versions[b];d.resolution<a.resolution&&(a=d)}this.highestResolutionVersion=a}};return b}();b.MultiFeatureReference=q;q=function(){function b(a){this._feature=a;this.refCount=1}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===
this.refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(a){++this.refCount;f.oldVersion=this._feature;this.feature&&(a.uid=this.feature.uid);l.equals(this._feature,a)||(this._feature=a);f.newVersion=this._feature;return f};b.prototype.unref=function(){f.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return f.newVersion=null,f;f.newVersion=this._feature;return f};Object.defineProperty(b.prototype,"feature",{get:function(){return this._feature},enumerable:!0,
configurable:!0});return b}();b.SingleFeatureReference=q;var f={oldVersion:null,newVersion:null}})},"esri/views/3d/layers/support/FeatureTile":function(){define(["require","exports","../../../../core/arrayUtils","../../../../geometry/support/aaBoundingRect","../../../../layers/graphics/dehydratedFeatures"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.descriptor=b;this.fetchRequest=null;this.fetchStatus=0;this._features=null;this._featureLimit=
this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=a;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}Object.defineProperty(b.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"features",{get:function(){return this._features},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(a){this._featureLimit!==a&&(this._featureLimit=a,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0});b.prototype.setFeatures=function(a,b){this._features=a;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;a&&0<a.length?(this._emptyFeatureRatio=b/(a.length+b),this._numVertices=
a.reduce(function(a,b){return a+h.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=0};Object.defineProperty(b.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numFeatures",{get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(a){this._numFeatures=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasPreciseFeatureCount",{get:function(){return this._numFeatures>a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsFeatureCount",{get:function(){return this._numFeatures===a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"estimatedSize",{get:function(){this.updateMemoryEstimates();return this._estimatedSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0});b.prototype.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var a=0;a<this._features.length;++a){var b=h.estimateSize(this._features[a]);this._estimatedSize+=b;a>=
this.featureLimit&&(this._estimatedUnusedSize+=b)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(a=this.featureLimit;a<this._features.length;++a)this._estimatedUnusedSize+=h.estimateSize(this._features[a]);return!0}return!1};Object.defineProperty(b.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isRefetching",
{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"needsDisplayUpdate",{get:function(){var a;if(a=!!this._features){a:{a=this._features;var b=this.displayingFeatures,c=this.featureLimit;if(!b||!a||c!==b.length||c>a.length)a=!1;else{for(var d=0;d<c;++d)if(a[d]!==b[d]){a=!1;break a}a=!0}}a=!a}return a},enumerable:!0,configurable:!0});b.prototype.intersects=function(a){if(!a||!this.descriptor.extent)return!0;f.fromExtent(a,e);return f.intersects(this.descriptor.extent,e)};b.prototype.intersection=function(a,b){if(!a&&!this.descriptor.extent)return f.set(b,
f.POSITIVE_INFINITY),b;a?(f.fromExtent(a,b),this.descriptor.extent&&f.intersection(b,this.descriptor.extent,b)):f.set(b,this.descriptor.extent);return b};b.prototype._shuffle=function(a){this._features.sort(function(b,c){return h.getObjectId(b,a)-h.getObjectId(c,a)});l.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};b.prototype.reduceFeatures=function(a,b,c){if(0>=a)return!1;var d=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*a),this.featureLimit>
this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,d=!0)),!this._shuffled&&1>a&&this._shuffle(c),a=Math.max(this.featureLimit,Math.ceil(b*this.numFeatures)),this._features.length>a&&(this._features.length=a,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4))):this.featureLimit=0;return d};Object.defineProperty(b.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,
emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0});b.prototype.loadCache=function(a){this.fetchRequest=null;this._features=a.features;this._numFeatures=a.numFeatures;this._emptyFeatureRatio=a.emptyFeatureRatio;this.fetchStatus=a.fetchStatus;this.featuresMissing=a.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0};return b}();b.FeatureTile=q;var a=-1;b.FAILED_FEATURE_COUNT=-2;var e=f.create()})},
"esri/views/support/QueueProcessor":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/maybe ../../core/promiseUtils ../../core/Queue ../../core/scheduling".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=function(){return function(a,b){this.item=a;this.controller=b;this.promise=null}}();q=function(){function b(a){var b=this;this._deferreds=new Map;this._controllers=new Map;this._processingItems=
new Map;this._isPaused=!1;this._task=this._schedule=null;this.concurrency=1;a.concurrency&&(this.concurrency=a.concurrency);this._queue=new e({peeker:a.peeker});this.process=a.process;var c=a.scheduler;a.task&&h.isSome(c)&&(this._task=c.registerTask(a.task,function(a){return b.update(a)},function(){return b.needsUpdate()}))}b.prototype.destroy=function(){this.clear();this._schedule&&(this._schedule.remove(),this._schedule=null);this._task&&(this._task.remove(),this._task=null)};Object.defineProperty(b.prototype,
"length",{get:function(){return this._processingItems.size+this._queue.length},enumerable:!0,configurable:!0});b.prototype.abort=function(a){(a=this._controllers.get(a))&&a.abort()};b.prototype.clear=function(){this._queue.clear();var a=[];this._controllers.forEach(function(b){return a.push(b)});this._controllers.clear();a.forEach(function(a){return a.abort()});this._processingItems.clear();this._cancelNext()};b.prototype.get=function(a){return(a=this._deferreds.get(a))?a.promise:void 0};b.prototype.isOngoing=
function(a){return this._processingItems.has(a)};b.prototype.has=function(a){return this._deferreds.has(a)};b.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())};b.prototype.push=function(b){return f(this,void 0,void 0,function(){var c,d,e,f,h,k,n=this;return l(this,function(g){if(c=this.get(b))return[2,c];e=a.createAbortController();f=function(){var c=n._processingItems.get(b);c&&c.controller.abort();h();d.reject(a.createAbortError())};h=function(){k.remove();n._deferreds.delete(b);
n._controllers.delete(b);n._queue.remove(b);n._processingItems.delete(b);n._scheduleNext()};k=a.onAbortOrThrow(e.signal,f);d=a.createDeferred();this._deferreds.set(b,d);this._controllers.set(b,e);d.promise.then(h,h);this._queue.push(b);this._scheduleNext();return[2,d.promise]})})};b.prototype.reset=function(){var a=[];this._processingItems.forEach(function(b){return a.push(b)});this._processingItems.clear();for(var b=0;b<a.length;b++){var d=a[b];this._queue.push(d.item);d.controller.abort()}this._scheduleNext()};
b.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};b.prototype.needsUpdate=function(){return!this._isPaused&&0<this._queue.length&&this._processingItems.size<this.concurrency};b.prototype.update=function(a){for(;!a.done&&0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),a.madeProgress()};b.prototype._scheduleNext=function(){var a=this;this._task||this._isPaused||this._schedule||(this._schedule=d.schedule(function(){a._schedule=
null;a._next()}))};b.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};b.prototype._cancelNext=function(){this._schedule&&(this._schedule.remove(),this._schedule=null)};b.prototype._processResult=function(a,b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).resolve(b))};b.prototype._processError=function(a,b){this._canProcessFulfillment(a)&&(this._scheduleNext(),this._deferreds.get(a.item).reject(b))};
b.prototype._canProcessFulfillment=function(a){return this._deferreds.get(a.item)&&this._processingItems.get(a.item)===a?!0:!1};b.prototype._process=function(b){var c=this;if(!h.isNone(b)){var d,e=a.createAbortController(),f=new k(b,e);this._processingItems.set(b,f);try{d=this.process(b,e.signal)}catch(t){this._processError(f,t)}d&&"function"===typeof d.then?(f.promise=d,d.then(function(a){return c._processResult(f,a)},function(a){return c._processError(f,a)})):this._processResult(f,d)}};Object.defineProperty(b.prototype,
"test",{get:function(){var a=this;return{update:function(b){return a.update(b)}}},enumerable:!0,configurable:!0});return b}();b.QueueProcessor=q})},"esri/core/Queue":function(){define(["require","exports"],function(q,b){return function(){function b(b){this._items=[];this._itemSet=new Set;this._peeker=function(b){return b[0]};this._length=0;b&&b.peeker&&(this._peeker=b.peeker)}Object.defineProperty(b.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});b.prototype.clear=
function(){this._itemSet.clear();this._length=this._items.length=0};b.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};b.prototype.push=function(b){this.contains(b)||this._add(b)};b.prototype.contains=function(b){return 0<this._length&&this._itemSet.has(b)};b.prototype.pop=function(){if(0!==this._length){var b=this.peek();this._remove(b);return b}};b.prototype.remove=function(b){this.contains(b)&&this._remove(b)};b.prototype._add=function(b){this._items.push(b);this._itemSet.add(b);
this._length++};b.prototype._remove=function(b){this._itemSet.delete(b);this._items.splice(this._items.indexOf(b),1);this._length--};return b}()})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),function(q,b,l,f,h,a,e,d,
k){Object.defineProperty(b,"__esModule",{value:!0});var n=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];q=function(){function b(a,b,c){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=a;this.view=c;this.tilingScheme=new k(b);this.loadedSymbols=
n.map(function(a){return new e(new h({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new e(new h({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new e(new h({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new e(new h({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}b.prototype.destroy=function(){this.enabled=!1};Object.defineProperty(b.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});b.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},symbols:this.pendingSymbols}),
this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};b.prototype.showDataExtent=function(a){this.dataExtentGraphic&&
(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);a&&(a=f.fromExtent(a),this.dataExtentGraphic=new l({geometry:a,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};b.prototype.synchronizeMaps=function(b,c){var e=this,f=[];b.forEach(function(a,b){var d=e.tileFetcher.getFeatureTileById(b);d&&c.filter(d)||(e.view.graphics.removeMany(a),f.push(b))});f.forEach(function(a){return b.delete(a)});this.tileFetcher.forEachFeatureTile(function(f){if(c.filter(f)&&
!b.has(f.id)){var g=f.descriptor.lij,h=g[0],k=g[1],m=g[2];e.tilingScheme.ensureMaxLod(h);var p=e.tilingScheme.getExtentGeometry(h,k,m),g=new l({geometry:p,symbol:c.symbols[h%c.symbols.length]}),h=new l({geometry:p.center,symbol:new a({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new d({text:h+"/"+k+"/"+m,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),h=[g,h];b.set(f.id,h);e.view.graphics.addMany(h)}})};return b}();
b.FeatureTileFetcher3DDebugger=q;b.default=q})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./graphics/Graphics3DFeatureLikeLayerView ./graphics/QueryEngine ./support/projectExtentUtils ../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y){Object.defineProperty(b,"__esModule",{value:!0});b.FeatureLikeLayerView3D=function(b){return function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._controllerCreated=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;a.pendingController=
null;a.queryEngine=null;return a}l(m,b);m.prototype.initialize=function(){var a=this;this.layer.isTable?this.addResolvingPromise(n.reject(new d("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new t({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?
1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}})),this.updatingHandles.add(this,"asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.preferredUpdatePolicy=b?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=b}),this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return a.queryEngine=new x.default({layerView:a,
task:y.Task.FEATURE_QUERY_ENGINE})}).then(function(){return v.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()})),this.notifyChange("updating"))};m.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null);
this.loadedGraphics=null};m.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};m.prototype.getRenderingInfo=function(a,b,c){(a=p.getRenderingInfo(a,{renderer:b,arcade:c}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};m.prototype.getRenderingInfoAsync=function(b,c,d,f){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,p.getRenderingInfoAsync(b,e({renderer:c,arcade:d},f))]})})};
m.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===a&&(c=r.hydrateGraphic(d,b.layer))});return c};Object.defineProperty(m.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:
null},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});m.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};m.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b):null};m.prototype.getSymbolLayerSize=
function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(a,b):null};m.prototype.queryFeatures=function(a,b){return this.queryEngine.executeQuery(this._ensureQuery(a),k.get(b,"signal"))};m.prototype.queryObjectIds=function(a,b){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),k.get(b,"signal"))};m.prototype.queryFeatureCount=function(a,b){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),k.get(b,"signal"))};m.prototype.queryExtent=function(a,
b){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),k.get(b,"signal"))};m.prototype._ensureQuery=function(a){return k.isNone(a)?this.createQuery():u.from(a)};m.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};m.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.features=this.loadedGraphics.length;a.updating=this.updating;a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=
!this.graphics3d.frustumVisibility.suspended;a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};m.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};m.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)};m.prototype.initializeController=
function(){return a(this,void 0,void 0,function(){var a;return h(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return this.pendingController=a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};m.prototype.setControllerWhenInitialized=function(b){return a(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.when()];case 1:return a.sent(),[3,3];case 2:return a.sent(),
[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,c.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return a.sent(),this.pendingController=null,this.controller=b,this.loadedGraphics=b.graphics,this.notifyChange("updating"),[2]}})})};m.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
a,!0}};m.prototype.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return n.reject(new d("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};f([g.property()],m.prototype,"loadedGraphics",void 0);f([g.property({dependsOn:["graphics3d.suspended"]})],m.prototype,"suspended",void 0);f([g.property({dependsOn:["graphics3d.updating","controller.updating"]})],m.prototype,"updating",
void 0);f([g.property()],m.prototype,"controller",void 0);f([g.property()],m.prototype,"graphics3d",void 0);f([g.property({readOnly:!0})],m.prototype,"asyncGraphicsUpdates",void 0);f([g.property({readOnly:!0})],m.prototype,"suspendResumeExtentMode",void 0);f([g.property({type:Boolean})],m.prototype,"slicePlaneEnabled",void 0);f([g.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],m.prototype,"hasDraped",void 0);f([g.property({readOnly:!0,type:Boolean})],m.prototype,"supportsDraping",void 0);
return m=f([g.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],m)}(g.declared(b))}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../../support/WatchUpdatingTracking".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G){var J={remove:function(){},pause:function(){},resume:function(){}};return function(b){function d(a){a=b.call(this,a)||this;a._handles=new c;a.watchUpdatingTracking=new G.WatchUpdatingTracking;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}l(d,b);Object.defineProperty(d.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)},enumerable:!0,configurable:!0});d.prototype.normalizeCtorArgs=function(a){var b=a.frustumVisibilityEnabled?new w:null,c=a.scaleVisibilityEnabled?new B:null,d=(a.filterVisibilityEnabled||a.timeExtentVisibilityEnabled)&&"multipatch"!==
a.layer.geometryType?new m.Graphics3DFilterVisibility:null,e=a.elevationAlignmentEnabled?new y:null;return{graphicsCore:new v({owner:a.owner,layer:a.layer,preferredUpdatePolicy:a.preferredUpdatePolicy,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:a.owner.hasZ,hasM:a.owner.hasM}),frustumVisibility:b,scaleVisibility:c,filterVisibility:d,elevationAlignment:e,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,
dataExtent:a.dataExtent}};d.prototype.initialize=function(){var a=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()});this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",function(){return a.filterVisibility.filterChanged()}),this.watchUpdatingTracking.add(this.owner,"timeExtent",function(){return a.filterVisibility.filterChanged()}));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,
"elevationInfo",function(b,c){p.diff(b,c)&&a.watchUpdatingTracking.addPromise(a.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()});this.watchUpdatingTracking.add(this.layer,"labelingInfo",function(b,c){p.diff(b,c)&&a.graphicsCore.updateLabelingInfo()})};d.prototype.setup=function(){return a(this,void 0,void 0,function(){var a,b,c,d,e=this;return h(this,function(f){switch(f.label){case 0:return this.frustumVisibility&&
this.frustumVisibility.setup(this.owner),a=this.owner,b=this.owner.view.basemapTerrain,c=function(a,b,c){return e.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(a,b,c)},this.scaleVisibility&&this.scaleVisibility.setup(a,this.layer,c,this.graphicsCore,b),this.filterVisibility&&("filter"in a||"timeExtent"in a)&&this.filterVisibility.setup(a,this.graphicsCore),this.elevationAlignment&&(d=a.view.elevationProvider,this.elevationAlignment.setup(a,c,this.graphicsCore,d)),this._set("highlights",new A.Graphics3DHighlights(this.graphicsCore)),
this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",a.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,k.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return f.sent(),this.watchUpdatingTracking.add(this.layer,"renderer",
function(a){return e.watchUpdatingTracking.addPromise(e.graphicsCore.rendererChange(a))}),this.watchUpdatingTracking.add(a,"fullOpacity",function(){return e.graphicsCore.opacityChange()}),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(a.view,"clippingArea",function(){return e._updateClippingExtent()}),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,k.result(this.graphicsCore.updateLabelingInfo())]:
[3,3];case 2:f.sent(),f.label=3;case 3:return[2]}})})};d.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var a=0,b="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment highlights graphicsCore".split(" ");a<b.length;a++){var c=b[a],d=this[c];d&&(d.destroy(),this._set(c,null))}this._set("layer",null);this._set("owner",null)};d.prototype.highlight=function(a,b,c){var d=this;if(a instanceof t){b=this.highlights.acquireSet(b,
c);var f=b.set,g=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(f,a)});return g}if("number"===typeof a||a instanceof e)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof e)if(g=a,c&&g[0].attributes&&null!==E.attributeLookup(g[0].attributes,c))a=g.map(function(a){return E.attributeLookup(a.attributes,c)});else return a=g.map(function(a){return a.uid}),g=this.highlights.acquireSet(b,null),b=g.set,
g=g.handle,this.highlights.setUids(b,a),g;if("number"===typeof a[0])return g=this.highlights.acquireSet(b,c),b=g.set,g=g.handle,this.highlights.setObjectIds(b,a),g}return J};d.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};d.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&
this._handles.add(g.init(this,"suspendResumeExtentMode",function(){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(g.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(g.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;default:n.neverReached(a.suspendResumeExtentMode)}}))};d.prototype.updateSuspendResumeExtent=
function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};d.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!u.canProject(a,c))return;a=u.project(a,c)}return C.enlargeExtent(a,b,x.SUSPEND_RESUME_EXTENT_OPTIMISM)};d.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&
this.scaleVisibility.setExtent(a)};f([r.property({aliasOf:"graphicsCore.layer"})],d.prototype,"layer",void 0);f([r.property({aliasOf:"graphicsCore.owner"})],d.prototype,"owner",void 0);f([r.property({constructOnly:!0})],d.prototype,"updateClippingExtent",void 0);f([r.property({constructOnly:!0})],d.prototype,"graphicsCore",void 0);f([r.property({constructOnly:!0})],d.prototype,"scaleVisibility",void 0);f([r.property({constructOnly:!0})],d.prototype,"filterVisibility",void 0);f([r.property({constructOnly:!0})],
d.prototype,"elevationAlignment",void 0);f([r.property({constructOnly:!0})],d.prototype,"frustumVisibility",void 0);f([r.property({readOnly:!0})],d.prototype,"deconfliction",void 0);f([r.property({readOnly:!0})],d.prototype,"labeling",void 0);f([r.property({readOnly:!0})],d.prototype,"highlights",void 0);f([r.property({readOnly:!0})],d.prototype,"watchUpdatingTracking",void 0);f([r.property()],d.prototype,"suspendResumeExtentMode",void 0);f([r.property()],d.prototype,"dataExtent",void 0);f([r.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],d.prototype,"suspended",null);f([r.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],d.prototype,"updating",null);return d=f([r.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],d)}(r.declared(d))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/accessorSupport/diffUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphic ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca,U,ea,ha,ka,ba,qa){var ja=J.vec3f64.create(),la=I.create(),ma=t.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");q=function(b){function n(a){a=b.call(this,a)||this;a.propertiesPool=new ha.PropertiesPool({computedExtent:e.Extent},a);a.computedExtent=null;a.currentRenderer=null;a.rendererHasGeometryOperations=!1;a.symbolCreationContext=new Z.Graphics3DSymbolCreationContext;a.graphics3DGraphics=
new Map;a.stageLayer=null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol=new Map;a.graphicsWaitingForSymbol=new Set;a.handles=new p;a.suspendSymbolCleanup=!1;a._spatialReference=null;a.arcadeOnDemand=null;a.rendererChangeAbortController=null;a.elevationInfoChangeAbortController=null;a.elevationAlignment=null;a.scaleVisibility=null;a.filterVisibility=null;a._spatialIndex=null;a._updatingPendingLoadedGraphicsChange=
null;a.featureStore=null;a.deconflictor=null;a.labeler=null;a.highlights=null;a.viewElevationProvider=null;a.stageLayerElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.numberOfGraphics=0;a.numberOfGraphicsProvidingElevation=0;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new m({allocator:function(a){return a||{add:null,renderingInfo:null,abortController:null,state:0,remove:null}},deallocator:function(a){a.add=null;
a.renderingInfo=null;a.remove=null;a.state=0;a.abortController=null;return a}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.objectIdInvisibleSet=new Set;a._whenSymbolRemoved=new m;a.preferredUpdatePolicy=0;a._asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.getRenderingInfoWithoutRenderer=!1;a.hasZ=null;a.hasM=null;a._usedMemory=0;a._visible=void 0;a._startCreateGraphics=!1;a.maxPendingUpdates=0;return a}l(n,b);
q=n;Object.defineProperty(n.prototype,"spatialIndex",{get:function(){if(!this._spatialIndex){this._spatialIndex=new F.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});var a=0,b=Array(this.graphics3DGraphics.size);this.graphics3DGraphics.forEach(function(c){return b[a++]=c});this._spatialIndex.addMany(b)}return this._spatialIndex},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"asyncUpdates",
{get:function(){return this._asyncUpdates},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange)},enumerable:!0,
configurable:!0});Object.defineProperty(n.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"displayFeatureLimit",{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?
a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,d?d.primitivesPerFeature:1)))),f=this._get("displayFeatureLimit");return f&&f.minimumTotalNumberOfFeatures===b&&f.maximumTotalNumberOfFeatures===c&&f.maximumTotalNumberOfPrimitives===a&&f.maximumSymbolComplexity===d&&f.maximumNumberOfFeatures===e?f:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,maximumTotalNumberOfPrimitives:a,
maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=this.symbolComplexities,c=this._get("maxSymbolComplexity"),d=!1,e=0;e<b.length;e++){var f=b[e];if(!a||0===a.primitivesPerCoordinate&&f.primitivesPerFeature>a.primitivesPerFeature||0!==a.primitivesPerCoordinate&&f.primitivesPerCoordinate>a.primitivesPerCoordinate)a=f;d=d||f.estimated}return!a||d&&c&&(c.primitivesPerFeature>=a.primitivesPerFeature||
c.primitivesPerCoordinate>=a.primitivesPerCoordinate)||c&&c.primitivesPerFeature===a.primitivesPerFeature&&c.primitivesPerCoordinate===a.primitivesPerCoordinate?c:a},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"spatialReference",{get:function(){return this._spatialReference},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"usedMemory",{get:function(){return this._usedMemory+(this.maxSymbolComplexity&&this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel*
this.numberOfGraphics:0)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.maxSymbolComplexity.memory.bytesPerFeatureLabel:0):0},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-
this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"symbolComplexities",{get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()},enumerable:!0,configurable:!0});n.prototype.getConvertedSymbol=function(a){if("web-style"===a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=O.to3D(a,!0,!1,this.hasLabelingContext(a)),
c=b.symbol||null;c||b.error&&ma.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};n.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){if(v.isNone(a))return[];var b=a.getSymbols(),c="backgroundFillSymbol"in a&&a.backgroundFillSymbol;if(!(c||b&&b.length))return[];a=[];c=this.getSymbolComplexityUsedOrRenderer(c);v.isSome(c)&&a.push(c);for(c=0;c<b.length;c++){var d=this.getSymbolComplexityUsedOrRenderer(b[c]);v.isSome(d)&&a.push(d)}return a};n.prototype.getSymbolComplexityUsedOrRenderer=
function(a){if(v.isNone(a))return null;var b=this.symbols.get(a.id);return b?b.complexity:(a=this.getConvertedSymbol(a))?ca.defaultSymbolComplexity(a):null};n.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){b&&a.push(b.complexity)});return a};n.prototype.initialize=function(){var a=this;this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new Y.default({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,
hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return a.spatialIndex},forAllGraphics:function(b){return a.graphics3DGraphics.forEach(b)}}))};n.prototype.setup=function(b){return a(this,void 0,void 0,function(){var a,c,d,e,f,g=this;return h(this,function(h){switch(h.label){case 0:return this._set("elevationAlignment",b.elevationAlignment),this._set("scaleVisibility",b.scaleVisibility),this._set("filterVisibility",b.filterVisibility),this._set("deconflictor",b.deconflictor),
this._set("labeler",b.labeler),this._set("highlights",b.highlights),a=this.owner.view,this.viewElevationProvider=new Q.ViewElevationProvider(this._spatialReference,a),this.initializeStage(a,this.layer.uid),this.symbolCreationContext.sharedResources=a.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=a.sharedSymbolResources.addGraphicsOwner(this.owner),v.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=
a.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=a.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.localOriginFactory=new ka,this.symbolCreationContext.elevationProvider=a.elevationProvider,c=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),d=this.symbolCreationContext,[4,T.createContext(c,this._spatialReference,ma)];case 1:return d.featureExpressionInfoContext=
h.sent(),this.symbolCreationContext.screenSizePerspectiveEnabled=a.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,this.handles.add(this.owner.watch("suspended",function(){return g.updateLayerVisibility()})),e="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:
"view.screenSizePerspectiveEnabled",this.handles.add([this.owner.watch(e,function(){var b=a.screenSizePerspectiveEnabled&&g.layer.screenSizePerspectiveEnabled;b!==g.symbolCreationContext.screenSizePerspectiveEnabled&&(g.symbolCreationContext.screenSizePerspectiveEnabled=b,g.recreateAllGraphics())}),B.init(this,"preferredUpdatePolicy",function(){return g.updateUpdatePolicy()},!0),this.owner.watch("slicePlaneEnabled",function(a){return g.slicePlaneEnabledChange(!!a)}),this.owner.view.watch("pixelRatio",
function(){return g.pixelRatioChange()}),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",function(a){return g.physicalBasedRenderingChange(a)}),B.when(a.basemapTerrain,"tilingScheme",function(b){b.spatialReference.equals(g.symbolCreationContext.overlaySR)||(g.symbolCreationContext.overlaySR=a.basemapTerrain.spatialReference);g.handles.has("loaded-graphics")?g.recreateAllGraphics():g.handles.add([B.on(g.owner,"loadedGraphics","change",function(a){return g.graphicsCollectionChanged(a)},
function(){return g.recreateAllGraphics()}),B.on(g.owner,"loadedGraphics","after-changes",function(){return g._signalUpdatingDuringAsyncLoadedGraphicsChange()},function(){return g._signalUpdatingDuringAsyncLoadedGraphicsChange()})],"loaded-graphics")}),a.resourceController.scheduler.registerTask(qa.Task.GRAPHICS_CORE,function(a){return g.update(a)},function(){return g.needsUpdate()})]),this.owner.layer&&"featureReduction"in this.owner.layer&&this.handles.add(this.owner.watch("layer.featureReduction",
function(){return g.deconflictor.featureReductionChange()})),f=this.rendererChange(this.layer.renderer),this.notifyChange("maxSymbolComplexity"),[2,f.catch(function(){})]}})})};n.prototype.destroy=function(){this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=
null);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(0,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this._spatialReference=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new r("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),
this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};n.prototype.clear=function(){this.highlights&&this.highlights.allGraphicsDeleted();this.graphics3DGraphics.forEach(function(a){return a.destroy()});
this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){a&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");
this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};n.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new ba(b,{isPickable:!this.owner.suspended},b);this.stage.add(0,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};n.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*xa,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=
a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};n.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};n.prototype.getGraphics3DGraphicById=function(a){return this.graphics3DGraphics.get(a)};n.prototype._getGraphicObjectID=function(a,b){void 0===b&&(b=this.owner.layer&&this.owner.layer.objectIdField);
return L.getObjectId(a,b)};Object.defineProperty(n.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=this,b=this.owner.layer&&this.owner.layer.objectIdField;if(!b)return null;var c=new Map;this.graphics3DGraphics.forEach(function(d){if(d){var e=a._getGraphicObjectID(d.graphic,b);v.isSome(e)&&c.set(e,d)}});return c},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"labelsEnabled",{get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())},enumerable:!0,
configurable:!0});n.prototype.updateLabelingInfo=function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,function(d){switch(d.label){case 0:return a=this.deconflictor&&this.deconflictor.labelingInfoChange(b),c=this.labeler&&this.labeler.labelingInfoChange(b),[4,w.eachAlways([a,c])];case 1:return d.sent(),[2]}})})};n.prototype.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Object.defineProperty(n.prototype,
"symbolUpdateType",{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,c=0;return u.someMap(this.symbols,function(d,e){if(d){d=d.getFastUpdateStatus();if(0<d.loading)return!0;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}return!1})?"unknown":0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed"},enumerable:!0,configurable:!0});n.prototype.needsUpdate=function(){return 0<this.pendingUpdates.size};n.prototype.update=function(a){this._applyPendingUpdates(a);this.needsUpdate()||
this.notifyChange("updating")};n.prototype.setObjectIdVisibility=function(a,b){b?this.objectIdInvisibleSet.delete(a):this.objectIdInvisibleSet.add(a);a=this._findGraphics3DGraphicByObjectId(a);v.isSome(a)&&this._updateUserVisibility(a)};n.prototype._findGraphics3DGraphicByObjectId=function(a){var b=this,c;u.someMap(this.graphics3DGraphics,function(d){return b._getGraphicObjectID(d.graphic)===a?(c=d,!0):!1});return c};n.prototype._updateUserVisibility=function(a){if(v.isNone(a))return!1;var b=a.graphic,
c=this._getGraphicObjectID(b),b=b.visible&&!this.owner.suspended&&(v.isNone(c)||!this.objectIdInvisibleSet.has(c));return a.setVisibilityFlag(0,b,0)};n.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics3DGraphics.get(a.uid);if(b)return w.resolve(b);if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=w.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};n.prototype.boundsForGraphics3DGraphic=function(b,c){return a(this,void 0,void 0,function(){var a,
d,e,f,g,k,m,l,n,p;return h(this,function(h){switch(h.label){case 0:return a=this._spatialReference,d=this.owner.view.renderSpatialReference,e=this.owner.view.basemapTerrain.spatialReference,f=function(b,c,e){return ea.bufferToBuffer(b,d,c,b,a,c,e)},g=function(b,c,d){return ea.bufferToBuffer(b,e,c,b,a,c,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:v.isSome(c)&&c.useViewElevation,minDemResolution:v.isSome(c)&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:
null,[4,b.getProjectedBoundingBox(f,g,k,v.get(c,"signal"))];case 1:m=h.sent();if(!m)return[2,null];l=m.boundingBox;m.requiresDrapedElevation&&(n=this.symbolCreationContext.elevationProvider)&&(I.center(l,ja),p=n.getElevation(ja[0],ja[1],0,a)||0,l[2]=Math.min(l[2],p),l[5]=Math.max(l[5],p));return[2,{boundingBox:l,screenSpaceObjects:m.screenSpaceObjects}]}})})};n.prototype.whenGraphicBounds=function(a,b){var c=this;return B.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&
c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new r("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};n.prototype.computeAttachmentOrigin=function(a,b){a=this.graphics3DGraphics.get(a.uid);if(!a)return null;var c=a.computeAttachmentOrigin();if(0===c.render.num&&0===
c.draped.num)return null;G.vec3.set(ra,0,0,0);a=0;if(0<c.render.num){if(!ea.vectorToVector(c.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,oa,b))return null;G.vec3.add(ra,ra,oa);a++}if(0<c.draped.num){var d=c.draped.origin,c=d[0],d=d[1],f=this.viewElevationProvider.getElevation(c,d,"ground")||0;G.vec3.set(oa,c,d,f);if(!ea.vectorToVector(oa,this.viewElevationProvider.spatialReference,oa,b))return null;G.vec3.add(ra,ra,oa);a++}1<a&&G.vec3.scale(ra,ra,1/a);return new e.Point({x:ra[0],
y:ra[1],z:ra[2],spatialReference:b})};n.prototype.getSymbolLayerSize=function(a,b){var c=this.symbols.get(a.id);if(null==c)throw new r("internal:symbol-not-part-of-view","Symbol is not part of this view");a=a.symbolLayers.indexOf(b);if(-1===a)throw new r("internal:missing-symbol-layer","Symbol layer is not in symbol");c=c.getSymbolLayerSize(a);if(null==c)throw new r("internal:missing-size","Symbol layer has no valid size");return c};n.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&
(this.add(a.added),this.remove(a.removed))};n.prototype.graphicUpdateHandler=function(a){var b=a.graphic.uid,c=this.graphics3DGraphics.get(b),b=this.graphicsWithoutSymbol.get(b);if(c||b)switch(a.property){case "visible":this.graphicUpdateVisibleHandler(c);break;case "geometry":this.graphicUpdateGeometryHandler(c,a);break;case "symbol":this.graphicUpdateSymbolHandler(c,a);break;case "attributes":break;default:g.neverReached(a)}};n.prototype.graphicUpdateGeometryHandler=function(a,b){var c=b.graphic.geometry;
if(v.isNone(c))this.recreateGraphic(b.graphic);else if(v.isNone(a)){if((a=b.graphic.symbol&&b.graphic.symbol.id)&&(a=this.symbols.get(a))&&0===a.loadStatus)return;this.recreateGraphic(b.graphic)}else a.graphics3DSymbol.updateGeometry(a,b.newValue)||this.recreateGraphic(a.graphic),this.expandComputedExtent(c)};n.prototype.graphicUpdateSymbolHandler=function(a,b){var c=b.graphic,d=v.isSome(a)?a.graphics3DSymbol:b.oldValue&&this.symbols.get(b.oldValue.id);if(d){var e=d.symbol;b=this.getConvertedSymbol(b.newValue);
if(b.type!==e.type||"web-style"===b.type||"web-style"===e.type)this.recreateGraphic(c);else{var f=this.graphicsBySymbol.get(e.id);if(f&&1!==f.size)this.recreateGraphic(c);else if(f=E.diff(e,b),v.isNone(f))this.updateSymbolMapping(e.id,b);else if(f={diff:f,graphics3DGraphicPatches:[],symbolStatePatches:[]},d.prepareSymbolPatch(f),E.isEmpty(f.diff)){for(var g=0,h=f.symbolStatePatches;g<h.length;g++)d=h[g],d();c=this._getRenderingInfo(c);if(v.isSome(a))for(g=0,f=f.graphics3DGraphicPatches;g<f.length;g++)d=
f[g],d(a,c);this.updateSymbolMapping(e.id,b)}else this.recreateGraphic(c)}}else this.recreateGraphic(c)};n.prototype.graphicUpdateVisibleHandler=function(a){(a=this._updateUserVisibility(a))&&this.labeler&&this.owner.view.labeler.setDirty();a&&this.owner.view.deconflictor.setDirty()};n.prototype.recreateGraphic=function(a){a=[a];this.suspendSymbolCleanup=!0;this.remove(a);this.add(a);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};n.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);
1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};n.prototype._endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};n.prototype.expandComputedExtent=function(a){var b=a.spatialReference;L.computeAABB(a,
la);a=this._spatialReference;var c=q.tmpVec;!b.equals(a)&&ea.xyzToVector(la[0],la[1],0,b,c,a)&&(la[0]=c[0],la[1]=c[1],ea.xyzToVector(la[3],la[4],0,b,c,a),la[3]=c[0],la[4]=c[1]);if(x.isFinite(la[0])&&x.isFinite(la[3])&&x.isFinite(la[1])&&x.isFinite(la[4])){var b=this.computedExtent,c=null,d=x.isFinite(la[2])&&x.isFinite(la[5]),e=d&&(!b||null==b.zmin||la[2]<b.zmin),d=d&&(!b||null==b.zmax||la[5]>b.zmax);if(b){if(la[0]<b.xmin||la[1]<b.ymin||la[3]>b.xmax||la[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),
c.xmin=Math.min(la[0],b.xmin),c.ymin=Math.min(la[1],b.ymin),c.xmax=Math.max(la[3],b.xmax),c.ymax=Math.max(la[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=la[0],c.ymin=la[1],c.xmax=la[3],c.ymax=la[4],c.spatialReference=a;c&&(e&&(c.zmin=la[2]),d&&(c.zmax=la[5]),this._set("computedExtent",c))}};n.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};n.prototype.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&
(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};n.prototype.elevationInfoChange=function(){return a(this,void 0,void 0,function(){var a,b,c,d=this;return h(this,function(e){switch(e.label){case 0:return this.abortElevationInfoChange(),this.elevationInfoChangeAbortController=a=w.createAbortController(),b=T.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),c=this.symbolCreationContext,[4,T.createContext(b,this._spatialReference,
ma)];case 1:return c.featureExpressionInfoContext=e.sent(),w.throwIfAborted(a),this.elevationInfoChangeAbortController=null,this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol(function(a,b,c){a.globalPropertyChanged("elevationInfo",b)?b.forEach(function(a){var b=a.graphic;a=a._labelGraphics;for(var c=0;c<a.length;c++){var d=a[c];d.graphics3DSymbolLayer.updateGraphicElevationContext(b,d)}}):d._recreateSymbol(c)}),this.updateStageLayerElevationProvider(),this.elevationAlignment&&
this.elevationAlignment.elevationInfoChange(),[2]}})})};n.prototype.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==
this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new U.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};n.prototype.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&
this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};n.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};n.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",
null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};n.prototype._recreateSymbol=function(a){var b=this,c=[];this.graphicsBySymbol.get(a).forEach(function(a,d){var e=a.usedMemory;
b._conditionalRemove(a,d);b._spatialIndex&&b._spatialIndex.remove(a);c.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(d,e);b.updateLayerVisibility();b.featureStore.events.emit("changed")});this.graphicsBySymbol.set(a,new Map);var d=this.symbols.get(a);d&&d.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(c)};n.prototype._conditionalRemove=function(a,b){a.isDraped()&&this.graphicsDrapedUids.delete(b);this.highlights&&this.highlights.removeGraphic(a);this.labeler&&this.labeler.removeGraphic(a);
this.deconflictor&&this.deconflictor.removeGraphic(a)};n.prototype.add=function(a){a&&0!==a.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):ma.error("#add()","Cannot add graphics before terrain surface has been initialized"))};n.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;ta.clear();for(var c=0;c<a.length;c++){var d=
a[c];this._startAddGraphic(d,this._getRenderingInfo(d,ma),ta)}ta.forEach(function(a){return b._finishAddGraphics(a)});ta.clear();this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty();this._cleanupSymbols()};n.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add?0!==e.state&&e.abortController.abort():this.pendingAdds++:(e=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(d,e));e.add=
c}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};n.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};n.prototype._removeImmediate=function(a){for(var b=0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};n.prototype._removeDelayed=function(a){for(var b=
0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d),1===e.state&&e.abortController.abort(),this.pendingAdds--):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};n.prototype._finishPendingUpdates=
function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&ma.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};n.prototype._applyPendingUpdates=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;var c=a.idleFrame?1E3:100,d=0;ta.clear();u.someMap(this.pendingUpdates,function(e,f){e.add&&0===e.state&&b._startAddRenderingInfo(e);!e.remove||e.add&&2!==e.state||
(b.pendingRemoves--,b._removeGraphic(e.remove),e.remove=null);if(e.add)switch(e.state){case 2:b._startAddGraphic(e.add,e.renderingInfo,ta)&&d++;e.add=null;b.pendingAdds--;break;case 3:e.add=null,b.pendingAdds--}d>c&&(ta.forEach(function(a){return b._finishAddGraphics(a)}),ta.clear(),d=0);null==e.remove&&null==e.add&&(b.pendingUpdates.delete(f),a.madeProgress());return a.done});ta.forEach(function(a){return b._finishAddGraphics(a)});ta.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();
this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.updateHasDraped()};n.prototype._startAddRenderingInfo=function(a){var b=this;v.isSome(this.layer.renderer)&&"dictionary"===this.layer.renderer.type?(a.state=1,a.abortController=w.createAbortController(),this._getRenderingInfoAsync(a.add,{signal:a.abortController.signal}).then(function(c){v.isNone(c)||v.isNone(c.symbol)?(ma&&!b.symbolWarningLogged&&(b.symbolWarningLogged=!0,ma.warn("Graphic in layer "+b.layer.id+" has no symbol and will not render")),
a.renderingInfo=null):a.renderingInfo=c;a.state=2},function(b){a.abortController=null;w.isAbortError(b)?a.state=0:a.state=3})):(a.renderingInfo=this._getRenderingInfo(a.add,ma),a.state=2)};n.prototype._startAddGraphic=function(a,b,c){this.graphicsWithoutSymbol.set(a.uid,a);if(!b||v.isNone(b.symbol)||!L.hasGeometry(a))return!1;var d=this.getOrCreateGraphics3DSymbol(b.symbol,b.renderer);if(!d)return!1;this.expandComputedExtent(a.geometry);this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:b,layer:this.layer};
b=d.symbol.id;var e=c.get(b);e?e.graphics.push(a):(e=sa.acquire(),e.clear(),e.push(a),c.set(b,{asyncSymbol:d,graphics:e}));return!0};n.prototype._finishAddGraphics=function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);a.asyncSymbol.load(function(){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);ua.clear();for(var e=0;e<a.graphics.length;e++){var f=a.graphics.data[e],g=f.graphic;c||a.asyncSymbol.destroyed||b.graphicSymbolSupported&&
g.symbol&&g.symbol.id!==a.asyncSymbol.symbol.id||(b.graphicsWaitingForSymbol.has(g.uid)&&(f=b.createGraphics3DGraphic(a.asyncSymbol,f),b._spatialIndex&&f&&ua.push(f)),b._endGraphicUpdate(g));--a.asyncSymbol.referenced}0<ua.length&&(b._spatialIndex.addMany(ua.data,ua.length),ua.clear());b.featureStore.events.emit("changed");a.graphics.clear();sa.release(a.graphics);b.labeler&&b.owner.view.labeler.setDirty()}},function(){if(!b.destroyed){b._whenSymbolRemoved.removeUnordered(d);if(!c&&!a.asyncSymbol.destroyed)for(var e=
0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();sa.release(a.graphics)}})};n.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics3DGraphics.get(a);if(b){b.graphics3DSymbol.onRemoveGraphic(b);var c=b.usedMemory,d=b.isElevationSource;this._conditionalRemove(b,a);this._spatialIndex&&this._spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);this.graphicsWithoutSymbol.delete(a);this.removeGraphics3DGraphic(a,
c,d);b.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(a),this.graphicsWaitingForSymbol.delete(a)};n.prototype.hasLabelingContext=function(a){if(a instanceof k.LabelSymbol3D||a instanceof k.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};n.prototype.hasValidSymbolCreationContext=function(a){return a instanceof k.LabelSymbol3D&&!this.hasLabelingContext(a)?(ma.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0};n.prototype._getRenderingInfo=function(a,b){if(v.isNone(a.geometry))return b&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&v.isSome(a.symbol))return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?L.hydrateGraphic(a,
this.layer):a;a=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||v.isSome(this.currentRenderer))?this.owner.getRenderingInfo(a,this.currentRenderer,v.unwrap(this.arcadeOnDemand)):{symbol:a.symbol||R.getDefaultSymbol3D(a.geometry)};return!a||v.isNone(a.symbol)?(b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null):a};n.prototype._getRenderingInfoAsync=function(a,b){if(v.isNone(a.geometry))return ma&&
!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ma.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&v.isSome(a.symbol))return ma&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ma.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.rendererHasGeometryOperations?L.hydrateGraphic(a,this.layer):a;return this.owner.getRenderingInfoAsync(a,v.unwrap(this.currentRenderer),
v.unwrap(this.arcadeOnDemand),b)};n.prototype.createGraphics3DSymbol=function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;v.isSome(b)&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=O.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));d=W.make(a,this.symbolCreationContext,d);d.load(function(){return c.notifyChange("maxSymbolComplexity")},function(){});return d};
n.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,d=this.symbols.get(a.id);void 0===d&&(d=a instanceof k.WebStyleSymbol?new aa(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,d));d&&++d.referenced;return d};n.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;this.graphics3DGraphics.set(a.graphic.uid,a);this.numberOfGraphics++;a.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());
this.updateLayerVisibility()};n.prototype.removeGraphics3DGraphic=function(a,b,c){void 0===c&&(c=!1);this._usedMemory-=b;this.graphics3DGraphics.delete(a);this.numberOfGraphics--;c&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};n.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;this.graphicsWithoutSymbol.delete(c.uid);if(!this.symbols.has(a.symbol.id))this.add([c]);else if(!this.graphics3DGraphics.has(c.uid)){b=a.createGraphics3DGraphic(b);
a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.isDraped()&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;v.isSome(c.geometry)&&"point"!==c.geometry.type&&b instanceof N&&(b.centroid=V.computeCentroid(c.geometry,this._spatialReference));this._updateUserVisibility(b);this.scaleVisibility&&this.scaleVisibility.updateVisibility(b);this.filterVisibility&&this.filterVisibility.updateVisibility(b);
this.deconflictor&&this.deconflictor.addGraphic(b);this.labeler&&this.labeler.addGraphic(b);this.highlights&&this.highlights.addGraphic(b);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);b.initialize(this.stage,this.stageLayer,this.owner);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);return b}};n.prototype.abortRendererChange=function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),
this.rendererChangeAbortController=null)};n.prototype.rendererChange=function(b){return a(this,void 0,void 0,function(){var a,c;return h(this,function(d){switch(d.label){case 0:this.abortRendererChange();if(b===this.currentRenderer)return[2];this.validateRenderer(b);if(!P.isSupportedRenderer3D(b))return this.currentRendererChange(null,!1),[2];if(!v.isSome(b)||!b.arcadeRequired)return[3,4];this.rendererChangeAbortController=a=w.createAbortController();return[4,this.ensureArcade()];case 1:return c=
d.sent().arcadeUtils,w.throwIfAborted(a),c.hasGeometryOperations(b)?[4,c.enableGeometryOperations()]:[3,3];case 2:d.sent(),w.throwIfAborted(a),d.label=3;case 3:return this.rendererChangeAbortController=null,this.currentRendererChange(b,!0),[3,5];case 4:this.currentRendererChange(b,!1),d.label=5;case 5:return[2]}})})};n.prototype.ensureArcade=function(){return a(this,void 0,void 0,function(){var a;return h(this,function(b){switch(b.label){case 0:if(!v.isNone(this.arcadeOnDemand))return[3,2];a=this;
return[4,S.loadArcade()];case 1:return a.arcadeOnDemand=b.sent(),[2,this.arcadeOnDemand];case 2:return[2,this.arcadeOnDemand]}})})};n.prototype.currentRendererChange=function(a,b){this.currentRenderer=a;this.rendererHasGeometryOperations=b;this.symbolCreationContext.arcade=v.unwrap(this.arcadeOnDemand);b=this.symbolCreationContext.renderer;if(a!==b)if(this.updateUpdatePolicy(),this.symbolConversionCache.clear(),v.isNone(a))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var c=
E.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;v.isNone(c)||("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};n.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];
break;default:return!0}return!1};n.prototype.applySymbolSetDiff=function(a,b,c){var d=this;a=a||[];b=b||[];for(var e=[],f=function(b){var f=g.graphicsBySymbol.get(b.id);f&&f.forEach(function(g,h){var k=g.graphic,m=d.layer instanceof H?d.layer:null,l=v.unwrap(d.arcadeOnDemand);if(b!==c.defaultSymbol||c.getSymbol(L.hydrateGraphic(k,m),{arcade:l})!==c.defaultSymbol)m=g.usedMemory,a.length||c.defaultSymbol?e.push(k):d.graphicsWithoutSymbol.set(h,k),k=d.graphics3DGraphics.get(h),d._conditionalRemove(k,
h),g.destroy(),f.delete(h),d.removeGraphics3DGraphic(h,m),d.updateLayerVisibility()});g._whenSymbolRemoved.forEach(function(a){return a(b.id)})},g=this,h=0;h<b.length;h++)f(b[h]);if(a.length||e.length)this.graphicsWithoutSymbol.forEach(function(a){return e.push(a)}),this.graphicsWithoutSymbol.clear(),this.add(e);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};n.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;
if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,b);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};n.prototype.calculateUnchangedSymbolMapping=
function(a,b,c){var e=function(a){return v.isSome(a)?a.id:null};if(b instanceof d.UniqueValueRenderer&&c instanceof d.UniqueValueRenderer&&(v.isNone(a)||"partial"===a.type)){var f=a&&a.diff;a=f&&f.defaultSymbol;var f=f&&f.uniqueValueInfos,g=void 0,g=f?f.unchanged.map(function(a){return{oldId:e(a.oldValue.symbol),newId:e(a.newValue.symbol)}}):c.uniqueValueInfos.map(function(a,c){return{oldId:e(a.symbol),newId:e(b.uniqueValueInfos[c].symbol)}});!a&&c.defaultSymbol&&g.push({oldId:e(c.defaultSymbol),
newId:e(b.defaultSymbol)});return g}return[]};n.prototype.updateSymbolMapping=function(a,b){var c=b?"string"===typeof b?b:b.id:null;b="string"===typeof b?null:b;if(a&&a!==c){var d=this.graphicsBySymbol.get(a);this.graphicsBySymbol.delete(a);void 0!==d&&this.graphicsBySymbol.set(c,d);d=this.symbols.get(a);this.symbols.delete(a);void 0!==d&&(this.symbols.set(c,d),b?d.symbol=b:d.symbol.id=c)}};n.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,
b,c);d<a.length;d++)b=a[d],this.updateSymbolMapping(b.oldId,b.newId)};n.prototype.applyRendererDiff=function(a,b,c){var e=this;return this.diffHasSymbolChange(a)?!1:b instanceof d.UniqueValueRenderer&&c instanceof d.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length?!0:!u.someMap(this.graphicsBySymbol,function(c,d){return(c=e.symbols.get(d))&&!c.applyRendererDiff(a,b)})};n.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("opacity",
b)});this.updateStageLayerVisibility()};n.prototype.updateUpdatePolicy=function(){var a=v.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;this._asyncUpdates=1===this.preferredUpdatePolicy||a;(this.symbolCreationContext.isAsync=this._asyncUpdates)||this.update(qa.noBudget)};n.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,
b){return a.globalPropertyChanged("slicePlaneEnabled",b)}),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};n.prototype.physicalBasedRenderingChange=function(a){a!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=a,this.forEachGraphics3DSymbol(function(a,b){return a.globalPropertyChanged("physicalBasedRenderingEnabled",b)}))};n.prototype.pixelRatioChange=function(){var a=
this;this.forEachGraphics3DSymbol(function(b,c,d){b.globalPropertyChanged("pixelRatio",c)||a._recreateSymbol(d)})};n.prototype._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){var a=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=A.schedule(function(){a._updatingPendingLoadedGraphicsChange=null})};n.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,d=K.create();
ea.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=I.fromRect(I.create(),d):this.symbolCreationContext.clippingExtent=null;return!I.equals(this.symbolCreationContext.clippingExtent,c)};n.prototype.notifyVisibilityChanged=function(){this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};n.prototype.modifyGraphics3DGraphicVisibilities=function(a){var b=!1;this.graphics3DGraphics.forEach(function(c){a(c)&&(b=!0)});b&&this.notifyVisibilityChanged()};n.prototype.forEachGraphics3DSymbol=
function(a){for(var b=0,d=c.keysOfMap(this.symbols);b<d.length;b++){var e=d[b],f=this.symbols.get(e),g=this.graphicsBySymbol.get(e);a(f,g||pa,e)}};n.prototype.updateAllGraphicsVisibility=function(){var a=this;this.filterVisibility&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(function(b){var c=a._updateUserVisibility(b);b=a.scaleVisibility&&a.scaleVisibility.updateVisibility(b);return c||b})};n.prototype.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(function(a){return a.setVisibilityFlag(0,
!1,0)})};n.prototype.validateRenderer=function(a){(a=P.validateTo3D(a))&&ma.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};n.prototype.volatileGraphicsUpdated=function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};n.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size||
this.suspendSymbolCleanup)){var b=!1;this.symbols.forEach(function(c,d){if(c&&!(0<c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};n.prototype.snapshotInternals=function(){var a=this;return{graphics:c.keysOfMap(this.graphics3DGraphics).sort(),symbols:c.keysOfMap(this.symbols).sort(),graphicsBySymbol:c.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,
graphics:c.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),graphicsWithoutSymbol:c.keysOfMap(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:c.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(n.prototype,"test",{get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size}},enumerable:!0,configurable:!0});n.prototype.getStats=function(){return{"core.visible":this.graphics3DGraphics.size,
"core.missing":this.graphicsWithoutSymbol.size,"core.pending":this.pendingUpdates.size}};var q;n.tmpVec=J.vec3f64.create();f([C.property({readOnly:!0})],n.prototype,"computedExtent",void 0);f([C.property()],n.prototype,"currentRenderer",void 0);f([C.property()],n.prototype,"rendererHasGeometryOperations",void 0);f([C.property()],n.prototype,"rendererChangeAbortController",void 0);f([C.property()],n.prototype,"elevationInfoChangeAbortController",void 0);f([C.property({readOnly:!0})],n.prototype,"elevationAlignment",
void 0);f([C.property({readOnly:!0})],n.prototype,"scaleVisibility",void 0);f([C.property({readOnly:!0})],n.prototype,"filterVisibility",void 0);f([C.property()],n.prototype,"_updatingPendingLoadedGraphicsChange",void 0);f([C.property({readOnly:!0})],n.prototype,"featureStore",void 0);f([C.property({readOnly:!0})],n.prototype,"deconflictor",void 0);f([C.property({readOnly:!0})],n.prototype,"labeler",void 0);f([C.property({readOnly:!0})],n.prototype,"highlights",void 0);f([C.property()],n.prototype,
"preferredUpdatePolicy",void 0);f([C.property({constructOnly:!0})],n.prototype,"elevationFeatureExpressionEnabled",void 0);f([C.property({constructOnly:!0})],n.prototype,"owner",void 0);f([C.property({constructOnly:!0})],n.prototype,"layer",void 0);f([C.property({readOnly:!0})],n.prototype,"hasDraped",void 0);f([C.property({readOnly:!0})],n.prototype,"symbolsUpdating",void 0);f([C.property({constructOnly:!0})],n.prototype,"graphicSymbolSupported",void 0);f([C.property({constructOnly:!0})],n.prototype,
"getRenderingInfoWithoutRenderer",void 0);f([C.property({readOnly:!0,dependsOn:"elevationAlignment.updating scaleVisibility.updating filterVisibility.updating rendererChangeAbortController elevationInfoChangeAbortController _updatingPendingLoadedGraphicsChange".split(" ")})],n.prototype,"updating",null);f([C.property({readOnly:!0})],n.prototype,"updatingRemaining",null);f([C.property({readOnly:!0})],n.prototype,"updatingTotal",null);f([C.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives",
"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],n.prototype,"displayFeatureLimit",null);f([C.property({readOnly:!0})],n.prototype,"maxSymbolComplexity",null);f([C.property({constructOnly:!0})],n.prototype,"hasZ",void 0);f([C.property({constructOnly:!0})],n.prototype,"hasM",void 0);return n=q=f([C.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],n)}(C.declared(n));var ta=new Map,ua=new m,sa=new y(m);(function(){return function(){this.renderingInfo=
this.add=null;this.state=0;this.remove=null}})();var xa=10,ra=J.vec3f64.create(),oa=J.vec3f64.create(),pa=new Map;return q})},"esri/renderers/support/rendererConversion":function(){define("require exports ../../core/compilerUtils ../../core/Error ../../core/maybe ../../symbols/support/symbolConversion".split(" "),function(q,b,l,f,h,a){function e(a){return h.isNone(a)||"simple"===a.type||"unique-value"===a.type||"class-breaks"===a.type||"dictionary"===a.type}function d(a,b){if(!b)return null;b=Array.isArray(b)?
b:[b];if(0<b.length){var c=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});c.sort();var d=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||d.push(a)});return new f("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function k(b){var c=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),
e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return d(b,c)}function n(b){var c=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return d(b,c)}Object.defineProperty(b,"__esModule",{value:!0});b.isSupportedRenderer3D=e;b.validateTo3D=function(b){if(h.isNone(b))return null;if(!e(b))return new f("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(b.type||b.declaredClass)+
"'",{renderer:b});switch(b.type){case "simple":return d(b,a.to3D(b.symbol).error);case "unique-value":return k(b);case "class-breaks":return n(b);case "dictionary":break;default:l.neverReached(b)}return null}})},"esri/symbols/support/defaults3D":function(){define("require exports ../../core/compilerUtils ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaults ./defaultsJSON".split(" "),function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,
"__esModule",{value:!0});var g=d.fromSimpleMarkerSymbol(n.defaultPointSymbol2D),r=a.fromSimpleLineSymbol(n.defaultPolylineSymbol2D),p=k.fromSimpleFillSymbol(n.defaultPolygonSymbol2D),u=new e({symbolLayers:[new h({material:{color:c.defaultColor},edges:{type:"solid",size:"1px",color:c.defaultOutlineColor}})]});b.getDefaultSymbol3D=function(a){if(f.isNone(a))return null;switch(a.type){case "mesh":return u;case "point":case "multipoint":return g;case "polyline":return r;case "polygon":case "extent":return p;
default:l.neverReached(a)}return null}})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(d){var f=b.call(this,d)||this;f.events=new a;f.hasZ=null;f.hasM=null;f.objectIdField=null;f.spatialReference=null;f.featureAdapter={getAttribute:function(a,b){return"graphic"in a?a.graphic.attributes[b]:g.default.getAttribute(a,b)},getAttributes:function(a){return"graphic"in a?a.graphic.attributes:g.default.getAttributes(a)},getObjectId:function(a){return"graphic"in a?k.getObjectId(a.graphic,
f.objectIdField):g.default.getObjectId(a)},getGeometry:function(a){return"graphic"in a?a.getAsOptimizedGeometry(f.hasZ,f.hasM):g.default.getGeometry(a)},getCentroid:function(a,b){if("graphic"in a){var d=null;e.isSome(a.centroid)?d=a.centroid:"point"===a.graphic.geometry.type&&r.pointToPoint(a.graphic.geometry,p,f.spatialReference)&&(d=p);a=Array(2+(b.hasZ?1:0)+(b.hasM?1:0));e.isNone(d)?(a[0]=0,a[1]=0,a[2]=0,a[3]=0):(a[0]=d.x,a[1]=d.y,b.hasZ&&(a[2]=d.hasZ?d.z:0),b.hasM&&(a[b.hasZ?3:2]=d.hasM?d.m:0));
return new c.default([],a)}return g.default.getCentroid(a,b)},cloneWithGeometry:function(a,b){return"graphic"in a?new n.default(b,f.featureAdapter.getAttributes(a),null,f.featureAdapter.getObjectId(a)):g.default.cloneWithGeometry(a,b)}};return f}l(h,b);h.prototype.forEach=function(a){this.forAllGraphics(function(b){a(b)})};h.prototype.forEachInBounds=function(a,b){this.getSpatialIndex().forEachInBounds(a,b)};h.prototype.forEachBounds=function(a,b,c){for(var d=this.getSpatialIndex(),f=0;f<a.length;f++){var g=
this.featureAdapter.getObjectId(a[f]);e.isSome(d.getBounds(g,c))&&b(c)}};f([d.property({constructOnly:!0})],h.prototype,"getSpatialIndex",void 0);f([d.property({constructOnly:!0})],h.prototype,"forAllGraphics",void 0);f([d.property({constructOnly:!0})],h.prototype,"hasZ",void 0);f([d.property({constructOnly:!0})],h.prototype,"hasM",void 0);f([d.property({constructOnly:!0})],h.prototype,"objectIdField",void 0);f([d.property({constructOnly:!0})],h.prototype,"spatialReference",void 0);return h=f([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],
h)}(d.declared(h));b.Graphics3DFeatureStore=q;var p={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};b.default=q})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["require","exports","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.optimizedFeatureQueryEngineAdapter={getObjectId:function(a){return a.objectId},getAttributes:function(a){return a.attributes},getAttribute:function(a,
b){return a.attributes[b]},cloneWithGeometry:function(a,b){return new f.default(b,a.attributes,null,a.objectId)},getGeometry:function(a){return a.geometry},getCentroid:function(a,b){a.centroid||(a.centroid=l.getCentroidOptimizedGeometry(new h.default,a.geometry,b.hasZ,b.hasM));return a.centroid}};b.default=b.optimizedFeatureQueryEngineAdapter})},"esri/layers/graphics/centroid":function(){define(["require","exports"],function(q,b){function l(b,a,e,d,f,l){l=f?l?4:3:l?3:2;var c=e,g=e+l,h=0,k=0,n=e=0,
q=0,x=0;for(--d;x<d;x++,c+=l,g+=l){var v=a[c],y=a[c+1],m=a[c+2],w=a[g],A=a[g+1],B=a[g+2],C=v*A-w*y,n=n+C,h=h+(v+w)*C,k=k+(y+A)*C;f&&(C=v*B-w*m,e+=(m+B)*C,q+=C);v<b[0]&&(b[0]=v);v>b[1]&&(b[1]=v);y<b[2]&&(b[2]=y);y>b[3]&&(b[3]=y);f&&(m<b[4]&&(b[4]=m),m>b[5]&&(b[5]=m))}0<n&&(n*=-1);0<q&&(q*=-1);if(!n)return null;b=[h,k,.5*n];f&&(b[3]=e,b[4]=.5*q);return b}function f(b,a,e,d,f){f=d?f?4:3:f?3:2;for(var h=a,c=a+f,g=0,k=0,l=0,q=0,t=0,x=e-1;t<x;t++,h+=f,c+=f){var v=b[h],y=b[h+1],m=b[h+2],w=b[c],A=b[c+1],
B=b[c+2],C;if(d){C=w-v;var E=A-y,G=B-m;C=Math.sqrt(C*C+E*E+G*G)}else C=w-v,E=A-y,C=Math.sqrt(C*C+E*E);C&&(g+=C,d?(v=[v+.5*(w-v),y+.5*(A-y),m+.5*(B-m)],k+=C*v[0],l+=C*v[1],q+=C*v[2]):(v=[v+.5*(w-v),y+.5*(A-y)],k+=C*v[0],l+=C*v[1]))}return 0<g?d?[k/g,l/g,q/g]:[k/g,l/g]:0<e?d?[b[a],b[a+1],b[a+2]]:[b[a],b[a+1]]:null}Object.defineProperty(b,"__esModule",{value:!0});b.getCentroidOptimizedGeometry=function(b,a,e,d){if(!a||!a.lengths.length)return null;b.lengths.length&&(b.lengths.length=0);b.coords.length&&
(b.coords.length=0);for(var h=b.coords,n=[],c=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],g=a.lengths,r=a.coords,p=e?d?4:3:d?3:2,q=0,t=0;t<g.length;t++){var x=g[t],v=l(c,r,q,x,e,d);v&&n.push(v);q+=x*p}n.sort(function(a,b){var c=a[2]-b[2];0===c&&e&&(c=a[4]-b[4]);return c});n.length&&(p=6*n[0][2],
h[0]=n[0][0]/p,h[1]=n[0][1]/p,e&&(p=6*n[0][4],h[2]=0!==p?n[0][3]/p:0),h[0]<c[0]||h[0]>c[1]||h[1]<c[2]||h[1]>c[3]||e&&(h[2]<c[4]||h[2]>c[5]))&&(h.length=0);if(!h.length)if(a=a.lengths[0]?f(r,0,g[0],e,d):null)h[0]=a[0],h[1]=a[1],e&&2<a.length&&(h[2]=a[2]);else return null;return b};b.lineCentroid=f})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(){this.featureExpressionInfoContext=
this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1}}();b.Graphics3DSymbolCreationContext=q;q=function(){return function(){}}();b.Graphics3DSymbolLayerCreationContext=q})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require",
"exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});b.make=function(b,a,e){var d;switch(b.type){case "point-3d":d=l;break;default:d=f}return new d(b,a,e)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),
function(q,b,l,f,h,a,e,d){return function(b){function d(a,d,f){a=b.call(this,a,d,f)||this;a.calloutSymbolLayer=null;a.symbol.hasVisibleCallout()&&(a.calloutSymbolLayer=e.make(a.symbol,d));return a}l(d,b);d.prototype.doLoad=function(c){return h(this,void 0,void 0,function(){return f(this,function(d){switch(d.label){case 0:return[4,b.prototype.doLoad.call(this,c)];case 1:return d.sent(),this.calloutSymbolLayer?[4,this.calloutSymbolLayer.load()]:[3,3];case 2:d.sent(),d.label=3;case 3:if(a.isAborted(c))throw a.createAbortError();
return[2]}})})};d.prototype.destroy=function(){b.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};d.prototype.createGraphics3DGraphic=function(a,d){d=b.prototype.createGraphics3DGraphic.call(this,a,d);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&d.addAuxiliaryGraphic(a);return d};d.prototype.globalPropertyChanged=function(a,d){var c=this;return b.prototype.globalPropertyChanged.call(this,a,d)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(a,
d,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===c.calloutSymbolLayer)return d}}):!0:!1};d.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};return d}(d)})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(q,b,l,f,h,a,e,d,k,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(c){c=b.call(this,c)||this;c.index=new d.default(9,a("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);c.boundsByFeature=new Map;c.spatialReference=null;c.hasZ=null;c.hasM=null;c.objectIdField=null;return c}l(g,b);g.prototype.destroy=function(){this.index.destroy();this.index=null;this.boundsByFeature.clear();
this.boundsByFeature=null};g.prototype.queryGraphicUIDsInExtent=function(a,b,d){b.equals(this.spatialReference)&&(c.minX=a[0],c.minY=a[1],c.maxX=a[2],c.maxY=a[3],this.index.search(c,function(a){return d(a.graphic.uid)}))};g.prototype.add=function(a){a.computeExtent(this.spatialReference);this.index.insert(a);var b=n.getObjectId(a.graphic,this._get("objectIdField"));null!=b&&this.boundsByFeature.set(b,a.extent)};g.prototype.addMany=function(a,b){void 0===b&&(b=a.length);for(var c=this._get("objectIdField"),
d=0;d<b;d++){var e=a[d];e.computeExtent(this.spatialReference);var f=n.getObjectId(e.graphic,c);null!=f&&this.boundsByFeature.set(f,e.extent)}this.index.load(a,b)};g.prototype.remove=function(a){this.index.remove(a);a=n.getObjectId(a.graphic,this._get("objectIdField"));null!=a&&this.boundsByFeature.delete(a)};g.prototype.clear=function(){this.index.clear();this.boundsByFeature.clear()};g.prototype.forEachInBounds=function(a,b){c.minX=a[0];c.minY=a[1];c.maxX=a[2];c.maxY=a[3];this.index.search(c,function(a){b(a)})};
g.prototype.getBounds=function(a,b){return(a=this.boundsByFeature.get(a))?k.fromRect(b,a):null};f([e.property({constructOnly:!0})],g.prototype,"spatialReference",void 0);f([e.property({constructOnly:!0})],g.prototype,"hasZ",void 0);f([e.property({constructOnly:!0})],g.prototype,"hasM",void 0);f([e.property({constructOnly:!0})],g.prototype,"objectIdField",void 0);return g=f([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],g)}(e.declared(h));b.SpatialIndex2D=q;var c={minX:0,minY:0,maxX:0,
maxY:0};b.default=q})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(q,b,l,f){function h(b,c){a(b,0,b.children.length,c,b)}function a(a,b,c,d,f){f||(f=p(null,!0));f.minX=Infinity;f.minY=Infinity;f.maxX=-Infinity;f.maxY=-Infinity;for(var g=void 0;b<c;b++)g=a.children[b],e(f,a.leaf?d(g):g);return f}function e(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=
Math.max(a.maxY,b.maxY);return a}function d(a,b){return a.minX-b.minX}function k(a,b){return a.minY-b.minY}function n(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function c(a){return a.maxX-a.minX+(a.maxY-a.minY)}function g(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function r(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function p(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function u(a,
b,c,d,e){for(var g=[b,c];g.length;)if(c=g.pop(),b=g.pop(),!(c-b<=d)){var h=b+Math.ceil((c-b)/d/2)*d;f(a,h,b,c,e);g.push(b,h,h,c)}}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b){void 0===a&&(a=9);this.compareMinX=d;this.compareMinY=k;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}b.prototype.destroy=function(){this.clear();
t.prune();x.prune();v.prune();y.prune()};b.prototype.all=function(a){this._all(this.data,a)};b.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(r(a,c))for(t.clear();c;){for(var e=0,f=c.children.length;e<f;e++){var h=c.children[e],k=c.leaf?d(h):h;r(a,k)&&(c.leaf?b(h):g(a,k)?this._all(h,b):t.push(h))}c=t.pop()}};b.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!r(a,b))return!1;for(t.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var f=b.children[d],h=b.leaf?c(f):
f;if(r(a,h)){if(b.leaf||g(a,h))return!0;t.push(f)}}b=t.pop()}return!1};b.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this};b.prototype.insert=function(a){a&&
this._insert(a,this.data.height-1);return this};b.prototype.clear=function(){this.data=p([],!0);return this};b.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,f,h,k=this.toBBox(a);v.clear();for(y.clear();c||v.length;){c||(c=v.pop(),d=v.data[v.length-1],e=y.pop(),f=!0);if(c.leaf){a:{h=a;var m=c.children,l=b;if(l){for(var n=0;n<m.length;n++)if(l(h,m[n])){h=n;break a}h=-1}else h=m.indexOf(h)}if(-1!==h){c.children.splice(h,1);v.push(c);this._condense(v);break}}f||c.leaf||!g(c,k)?
d?(e++,c=d.children[e],f=!1):c=null:(v.push(c),y.push(e),e=0,d=c,c=c.children[0])}return this};b.prototype.toJSON=function(){return this.data};b.prototype.fromJSON=function(a){this.data=a;return this};b.prototype._all=function(a,b){for(x.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else x.pushArray(a.children);a=x.pop()}};b.prototype._build=function(a,b,c,d){var e=c-b+1,f=this._maxEntries,g;if(e<=f)return g=p(a.slice(b,c+1),!0),h(g,this.toBBox),g;d||(d=Math.ceil(Math.log(e)/
Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));g=p([],!1);g.height=d;e=Math.ceil(e/f);f=e*Math.ceil(Math.sqrt(f));for(u(a,b,c,f,this.compareMinX);b<=c;b+=f){var k=Math.min(b+f-1,c);u(a,b,k,e,this.compareMinY);for(var m=b;m<=k;m+=e)g.children.push(this._build(a,m,Math.min(m+e-1,k),d-1))}h(g,this.toBBox);return g};b.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=Infinity,f=Infinity,g=void 0,h=0,k=b.children.length;h<k;h++){var m=b.children[h],
l=n(m),p=(Math.max(m.maxX,a.maxX)-Math.min(m.minX,a.minX))*(Math.max(m.maxY,a.maxY)-Math.min(m.minY,a.minY))-l;p<f?(f=p,e=l<e?l:e,g=m):p===f&&l<e&&(e=l,g=m)}b=g||b.children[0]}return b};b.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);v.clear();d=this._chooseSubtree(c,this.data,b,v);d.children.push(a);for(e(d,c);0<=b;)if(v.data[b].children.length>this._maxEntries)this._split(v,b),b--;else break;this._adjustParentBBoxes(c,v,b)};b.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,
e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=p(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;h(c,this.toBBox);h(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};b.prototype._splitRoot=function(a,b){this.data=p([a,b],!1);this.data.height=a.height+1;h(this.data,this.toBBox)};b.prototype._chooseSplitIndex=function(b,c,d){var e,f,g;e=f=Infinity;for(var h=c;h<=d-c;h++){var k=a(b,0,h,this.toBBox),m=a(b,h,d,this.toBBox),l;l=Math.max(0,
Math.min(k.maxX,m.maxX)-Math.max(k.minX,m.minX))*Math.max(0,Math.min(k.maxY,m.maxY)-Math.max(k.minY,m.minY));k=n(k)+n(m);l<e?(e=l,g=h,f=k<f?k:f):l===e&&k<f&&(f=k,g=h)}return g};b.prototype._chooseSplitAxis=function(a,b,c){var e=a.leaf?this.compareMinX:d,f=a.leaf?this.compareMinY:k,g=this._allDistMargin(a,b,c,e);b=this._allDistMargin(a,b,c,f);g<b&&a.children.sort(e)};b.prototype._allDistMargin=function(b,d,f,g){b.children.sort(g);g=this.toBBox;for(var h=a(b,0,d,g),k=a(b,f-d,f,g),m=c(h)+c(k),l=d;l<
f-d;l++){var n=b.children[l];e(h,b.leaf?g(n):n);m+=c(h)}for(l=f-d-1;l>=d;l--)n=b.children[l],e(k,b.leaf?g(n):n),m+=c(k);return m};b.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)e(b.data[c],a)};b.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():h(a.data[b],this.toBBox)};b.prototype._initFormat=function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a",
"b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return b}();b.PooledRBush=q;var t=new l,x=new l,v=new l,y=new l({deallocator:null});b.default=q})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function q(f,h,a,e,d){for(;e>a;){if(600<e-a){var k=e-a+1,l=h-a+1,c=Math.log(k),g=.5*Math.exp(2*c/3),c=.5*Math.sqrt(c*g*(k-g)/k)*(0>l-k/2?-1:1);q(f,h,
Math.max(a,Math.floor(h-l*g/k+c)),Math.min(e,Math.floor(h+(k-l)*g/k+c)),d)}k=f[h];l=a;g=e;b(f,a,h);for(0<d(f[e],k)&&b(f,a,e);l<g;){b(f,l,g);l++;for(g--;0>d(f[l],k);)l++;for(;0<d(f[g],k);)g--}0===d(f[a],k)?b(f,a,g):(g++,b(f,g,e));g<=h&&(a=g+1);h<=g&&(e=g-1)}}function b(b,h,a){var e=b[h];b[h]=b[a];b[a]=e}function l(b,h){return b<h?-1:b>h?1:0}return function(b,h,a,e,d){q(b,h,a||0,e||b.length-1,d||l)}})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/unitUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){Object.defineProperty(b,"__esModule",{value:!0});var t=e.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");q=function(a){function b(b){b=a.call(this,b)||this;b.elevationOffset=0;b.layerDirtyNotificationHandle=null;return b}l(b,a);b.prototype.initialize=function(){var a=this;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new u(this.view.viewingMode);this.intersector.options.store=
0;var b=this.computeLayerExtent(this.stageLayer);this.zmin=b[2];this.zmax=b[5];this.layerDirtyNotificationHandle=this.stageLayer.on("dirty",function(b){return a.stageLayerChanged(b.origin,b.dirtyType,b.subObject)})};b.prototype.dispose=function(){this.layerDirtyNotificationHandle.remove()};b.prototype.elevationInfoChanged=function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"on-the-ground"!==a.mode){var b=d.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=p.getMetersPerUnit(a.unit);
this.elevationOffset=(a.offset||0)*c/b}else this.elevationOffset=0};b.prototype.getElevation=function(a,b,c,d){m[0]=a;m[1]=b;m[2]=c;if(!this.renderCoordsHelper.toRenderCoords(m,d,m))return t.error("could not project point for elevation alignment"),null;b=this.elevationOffset;a=this.zmin+b;b=this.zmax+b;n.vec3.copy(w,m);n.vec3.copy(A,m);this.renderCoordsHelper.setAltitude(b,w);this.renderCoordsHelper.setAltitude(a,A);this.intersector.reset(w,A);this.intersector.intersect(this.intersectLayers,null,
null,1,null,function(a){return a.metadata&&a.metadata.isElevationSource});return this.intersector.results.min.getIntersectionPoint(m)?this.renderCoordsHelper.getAltitude(m):null};b.prototype.stageLayerChanged=function(a,b,c){switch(b){case "layerObjectAdded":case "layerObjectRemoved":case "objGeometryAdded":a=c;a.metadata&&a.metadata.isElevationSource&&this.objectChanged(a);break;case "objGeometryRemoved":case "objGeometryReplaced":case "objGeometryTransformation":case "vertexAttrsUpdated":case "objTransformation":a.metadata&&
a.metadata.isElevationSource&&this.objectChanged(a)}};b.prototype.objectChanged=function(a){if(this.spatialReference){g.empty(x);a.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(a.metadata.lastValidElevationBB.bbMin,a.metadata.lastValidElevationBB.bbMax,x);var b=a.getBBMin(!1),c=a.getBBMax(!1);this.expandExtent(b,c,x);g.toRect(x,v);this.zmin=Math.min(this.zmin,x[2]);this.zmax=Math.max(this.zmax,x[5]);y.extent=v;y.spatialReference=this.spatialReference;this.emit("elevation-change",y);n.vec3.copy(a.metadata.lastValidElevationBB.bbMin,
b);n.vec3.copy(a.metadata.lastValidElevationBB.bbMax,c)}};b.prototype.computeLayerExtent=function(a){g.empty(x);var b=0;for(a=a.getObjects();b<a.length;b++){var c=a[b];this.expandExtent(c.getBBMin(!1),c.getBBMax(!1),x)}return x};b.prototype.expandExtent=function(a,b,c){for(var d=0;8>d;++d)m[0]=d&1?a[0]:b[0],m[1]=d&2?a[1]:b[1],m[2]=d&4?a[2]:b[2],this.renderCoordsHelper.fromRenderCoords(m,m,this.spatialReference),g.expand(c,m);return c};f([k.property({constructOnly:!0})],b.prototype,"layer",void 0);
f([k.property({constructOnly:!0})],b.prototype,"stageLayer",void 0);f([k.property({constructOnly:!0})],b.prototype,"view",void 0);f([k.property({readOnly:!0,aliasOf:"view.spatialReference"})],b.prototype,"spatialReference",void 0);return b=f([k.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],b)}(k.declared(a.EventedMixin(h)));b.StageLayerElevationProvider=q;var x=g.empty(),v=r.empty(),y={spatialReference:null,extent:v,context:"scene"},m=c.vec3f64.create(),w=c.vec3f64.create(),
A=c.vec3f64.create()})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/accessorSupport/decorators ./ExtentSet ../../../support/index".split(" "),function(q,b,l,f,h,a,e,d,k,n,c){return function(b){function g(){var c=null!==b&&b.apply(this,
arguments)||this;c.dirtyExtents=new n.ExtentSet;c.globalDirty=!1;c.dirtyGraphicsSet=new Set;c.handles=new e;c.updateElevation=!1;c.layerView=null;c.graphicsCore=null;c.events=new a;return c}l(g,b);Object.defineProperty(g.prototype,"updating",{get:function(){return this.needsUpdate()},enumerable:!0,configurable:!0});g.prototype.setup=function(a,b,d,e){var f=this;this.layerView=a;this.queryGraphicUIDsInExtent=b;this.graphicsCore=d;this.elevationProvider=e;a=this.layerView.view.resourceController.scheduler;
this.handles.add([e.on("elevation-change",function(a){("scene"!==a.context||d.layer.elevationInfo&&"relative-to-scene"===d.layer.elevationInfo.mode)&&f.elevationUpdateHandler(a)}),this.layerView.watch("suspended",function(){return f.suspendedChange()}),a.registerTask(c.Task.ELEVATION_ALIGNMENT,function(a){return f.update(a)},function(){return f.needsUpdate()})])};g.prototype.destroy=function(){this.dirtyGraphicsSet=null;this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=
this.handles=null};g.prototype.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};g.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};g.prototype.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};g.prototype.needsUpdate=function(){return this.dirtyGraphicsSet&&0<this.dirtyGraphicsSet.size||this.dirtyExtents&&
!this.dirtyExtents.empty||this.globalDirty};g.prototype.update=function(a){var b=this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,a.madeProgress());for(a.run(function(){return b.dirtyExtents.merge(a)});this.needsUpdate()&&!a.done;)this._updateDirtyGraphics(a),this._updateDirtyExtents(a);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};g.prototype._updateDirtyGraphics=function(a){for(var b=this,c=this.layerView.view,e=this.graphicsCore.stageLayer.id,
f=this.layerView.labeling,g=function(){var g=Math.min(h.dirtyGraphicsSet.size,100);d.someSet(h.dirtyGraphicsSet,function(d){var e=b.graphicsCore.getGraphics3DGraphicById(d);b.dirtyGraphicsSet.delete(d);e&&e.alignWithElevation(b.elevationProvider,c.renderCoordsHelper,b.graphicsCore.asyncUpdates);a.madeProgress();return 0>=--g||a.done});c._stage.processDirtyLayer(e);f&&f.processStageDirty()},h=this;0<this.dirtyGraphicsSet.size&&!a.done;)g()};g.prototype._updateDirtyExtents=function(a){for(var b=this;!this.dirtyExtents.empty&&
100>this.dirtyGraphicsSet.size&&!a.done;){var c=this.dirtyExtents.pop();this.events.hasEventListener("invalidate-elevation")&&this.events.emit("invalidate-elevation",{extent:c,spatialReference:this.spatialReference});this.queryGraphicUIDsInExtent(c,this.spatialReference,function(a){var c=b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsSet.add(a)});a.madeProgress()}};g.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();
this.graphicsCore.graphics3DGraphics.forEach(function(b,c){a.dirtyGraphicsSet.add(c)})};g.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};f([k.property({readOnly:!0})],g.prototype,"updating",
null);return g=f([k.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],g)}(k.declared(h))})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["require","exports","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){this.extents=new l({allocator:function(a){return a||f.create()}});this.tempExtent=f.create();this.dirty=
!1}Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this.extents.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),f.set(this.extents.pushNew(),a),this.dirty=!0)};a.prototype.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};a.prototype.merge=function(a){this.mergeTight(a);return a.hasProgressed};a.prototype.mergeTight=function(a){var b=this;void 0===
a&&(a=h.noBudget);for(var e=this.extents,l=new Set,c=0;c!==e.length;){e.sort(function(a,b){return a[0]-b[0]});c=e.length;l.clear();for(var g=function(c){if(a.done)return{value:void 0};var d=e.getItemAt(c);for(c+=1;c<e.length;++c){var g=e.getItemAt(c);if(g[0]>=d[2])break;l.add(g)}l.forEach(function(c){if(d!==c)if(c[2]<=d[0])l.delete(c);else{var g=f.area(d),h=f.area(c),k=b.tempExtent;f.expand(d,c,k);g+=h;.05>(f.area(k)-g)/g&&(f.set(d,k),l.delete(c),e.remove(c),a.madeProgress())}});l.add(d)},r=0;r<e.length;++r){var p=
g(r);if("object"===typeof p)return p.value}}this.dirty=!1};a.prototype.contains=function(a){return this.extents.some(function(b){return f.contains(b,a)})};a.prototype.removeContained=function(a){this.extents.filterInPlace(function(b){return!f.contains(a,b)})};Object.defineProperty(a.prototype,"test",{get:function(){var a=this;return{containsPoint:function(b){return a.extents.some(function(a){return f.containsPoint(a,b)})}}},enumerable:!0,configurable:!0});return a}();b.ExtentSet=q})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ./QueryEngine ../../../layers/support/FeatureFilter ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});var p=e.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");q=function(b){function e(){var c=b.call(this)||this;c.filter=null;c._dirty=!1;c._querying=!1;c._handles=new a;return c}l(e,b);Object.defineProperty(e.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0});e.prototype.setup=function(a,b){var d=this;this._layerView=
a;this._core=b;this._objectIdField=a.layer.objectIdField;this._queryEngine=new c.default({layerView:this._layerView,task:r.Task.FILTER_VISIBILITY});this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(r.Task.FILTER_VISIBILITY,function(a){return d._update(a)},function(){return d._needsUpdate()}));this._handles.add(k.on(b.owner,"loadedGraphics","after-changes",function(a){return d._graphicsChanged(a)},function(){return d.dirty=!0}));this.filterChanged()};e.prototype.destroy=
function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};e.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};e.prototype._graphicsChanged=function(a){this._queryEngine&&0===(a.type&1)||(this.dirty=!0)};e.prototype.updateVisibility=function(a){this.active&&(a.hasVisibilityFlag(2,
0)||a.setVisibilityFlag(2,!1,0),this.dirty=!0)};e.prototype.filterChanged=function(){var a=this.recomputeFilter();a!==this.filter&&(this.filter=a,this.dirty=!0)};Object.defineProperty(e.prototype,"active",{get:function(){return this.filter&&0<this._core.graphics3DGraphics.size},enumerable:!0,configurable:!0});e.prototype.recomputeFilter=function(){var a="filter"in this._layerView?this._layerView.filter:null,b="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!b)return a;a=d.isSome(a)?
a.clone():new g;a.timeExtent=a.timeExtent?a.timeExtent.intersection(b):b;return a};e.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};e.prototype._update=function(a){var b=this;this.active?(!this._dirty||this._querying||a.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(a){b._queryResult=a;b._querying=!1}).catch(function(a){p.warn("FeatureFilter query failed: "+a);b._queryResult=new Set;b._core.graphics3DGraphics.forEach(function(a){return b._queryResult.add(b._getFeatureId(a.graphic))});
b._querying=!1}),a.madeProgress()),this._queryResult&&!a.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(c){if(a.done)return!1;var d=b._queryResult.has(b._getFeatureId(c.graphic));return c.setVisibilityFlag(2,d,0)?(a.madeProgress(),!0):!1}),a.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};e.prototype._getFeatureId=function(a){return null==a.objectId?a.attributes[this._objectIdField]:a.objectId};Object.defineProperty(e.prototype,"dirty",{set:function(a){this._dirty!==
a&&(this._dirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});f([n.property({readOnly:!0})],e.prototype,"updating",null);return e=f([n.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],e)}(n.declared(h));b.Graphics3DFilterVisibility=q})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});var u=g.default;q=function(b){function d(a){a=b.call(this,a)||this;a._dataQueryEngineInstance=null;return a}f(d,b);Object.defineProperty(d.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"defaultQueryJSON",
{get:function(){return(new p({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0});d.prototype.destroy=function(){this.clear()};d.prototype.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};d.prototype.executeQueryForIdSet=function(b,c){return a(this,
void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(b),c)]})})};d.prototype.executeQueryForCount=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};d.prototype.executeQueryForExtent=function(b,d){return a(this,void 0,void 0,function(){var a,e,f,g;return h(this,function(h){switch(h.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),
d)];case 1:return a=h.sent(),e=a.count,f=a.extent,g=c.fromJSON(f),[2,{count:e,extent:g}]}})})};d.prototype.executeQueryForIds=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};d.prototype.executeQuery=function(b,c){return a(this,void 0,void 0,function(){var a,d,e=this;return h(this,function(f){switch(f.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(b),c)];
case 1:return a=f.sent(),d=r.fromJSON(a),d.features.forEach(function(a){a.layer=e.layer;a.sourceLayer=e.layer}),[2,d]}})})};d.prototype._ensureQueryJSON=function(a){if(k.isNone(a))return this.defaultQueryJSON;"outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference);return a.toJSON()};d.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||
null,b=this.layer.objectIdField,c=e.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),d=this.layer.fields.map(function(a){return a.toJSON()}),f=this.layerView.view.resourceController.scheduler,g=this.task,h=this.spatialReference.toJSON(),k=this.layerView;return this._dataQueryEngineInstance=new u({hasZ:k.hasZ,hasM:k.hasM,geometryType:c,fields:d,timeInfo:a,spatialReference:h,objectIdField:b,featureStore:this.layerView.graphics3d.graphicsCore.featureStore,scheduler:f,task:g})};l([n.property({constructOnly:!0})],
d.prototype,"layerView",void 0);l([n.property({constructOnly:!0})],d.prototype,"task",void 0);l([n.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],d.prototype,"spatialReference",void 0);l([n.property({readOnly:!0,aliasOf:"layerView.layer"})],d.prototype,"layer",void 0);l([n.property({readOnly:!0,dependsOn:["layer.geometryType"]})],d.prototype,"queryGeometryType",null);l([n.property({readOnly:!0,dependsOn:["spatialReference"]})],d.prototype,"defaultQueryJSON",null);return d=l([n.subclass("esri.views.3d.layers.graphics.QueryEngine")],
d)}(n.declared(d));b.QueryEngine=q;b.default=q})},"esri/layers/graphics/data/QueryEngine":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../support/PromiseQueue".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G){Object.defineProperty(b,"__esModule",{value:!0});var J=k.getLogger("esri.layers.graphics.data.QueryEngine");q=function(){return function(a,b,c,d,e){void 0===b&&(b=null);this.attributes=a;this.geometry=c;this.centroid=d;this.filterFlags=e;this.groupId=-1;this.localId=b}}();b.Feature=q;var I=new Set,K=new n.MemCacheStorage(2E6),H=0;q=function(){function b(a){var b=this;this.capabilities={query:m.queryCapabilities};this.geometryType=a.geometryType;
this.hasM=a.hasM;this.hasZ=a.hasZ;this.objectIdField=a.objectIdField;this.spatialReference=a.spatialReference;this.definitionExpression=a.definitionExpression;this.cacheSpatialQueries=a.cacheSpatialQueries||!1;this.featureStore=a.featureStore;this._changeHandle=this.featureStore.events.on("changed",function(){return b.clearCache()});this.timeInfo=a.timeInfo;this.cacheSpatialQueries&&(this._geometryQueryCache=new n.MemCache(H++ +"$$",K));this.fieldsIndex=new E(a.fields);a.scheduler&&a.task&&(this._frameQueue=
new G.PromiseQueue,this._frameTask=a.scheduler.registerTask(a.task,function(a){return b._update(a)},function(){return 0<b._frameQueue.length}))}b.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};Object.defineProperty(b.prototype,
"featureAdapter",{get:function(){return this.featureStore.featureAdapter},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",{get:function(){var a=this.featureStore.fullBounds;return a?{xmin:a[0],ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:C.cleanFromGeometryEngine(this.spatialReference)}:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"timeExtent",{get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=B.getTimeExtent(this.timeInfo,
this.featureStore):null},enumerable:!0,configurable:!0});b.prototype.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};b.prototype.executeQuery=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,e;return f(this,function(f){switch(f.label){case 0:b=d.clone(a),f.label=1;case 1:return f.trys.push([1,14,,15]),[4,this._schedule()];case 2:return f.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];
case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._checkQuerySupport(b)];case 5:return b=f.sent(),[4,this._reschedule()];case 6:return f.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=f.sent(),[4,this._reschedule()];case 10:return f.sent(),[4,c.executeTimeQuery(b)];case 11:return c=f.sent(),[4,this._reschedule()];case 12:return f.sent(),[4,c.executeAttributesQuery(b)];
case 13:return c=f.sent(),[3,15];case 14:e=f.sent();if(e!==C.QUERY_ENGINE_EMPTY_RESULT)throw e;c=new w.default([],null,this);return[3,15];case 15:return[2,c.createQueryResponse(b)]}})})};b.prototype.executeQueryForCount=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,e;return f(this,function(f){switch(f.label){case 0:b=d.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,f.label=1;case 1:return f.trys.push([1,14,,15]),[4,this._schedule()];case 2:return f.sent(),
[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._checkQuerySupport(b)];case 5:return b=f.sent(),[4,this._reschedule()];case 6:return f.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=f.sent(),[4,this._reschedule()];case 10:return f.sent(),[4,c.executeTimeQuery(b)];case 11:return c=f.sent(),
[4,this._reschedule()];case 12:return f.sent(),[4,c.executeAttributesQuery(b)];case 13:return c=f.sent(),[2,c.size];case 14:e=f.sent();if(e!==C.QUERY_ENGINE_EMPTY_RESULT)throw e;return[2,0];case 15:return[2]}})})};b.prototype.executeQueryForExtent=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,e,h,k,m,l,n;return f(this,function(f){switch(f.label){case 0:b=d.clone(a),e=b.outSR,f.label=1;case 1:return f.trys.push([1,14,,15]),[4,this._schedule()];case 2:return f.sent(),
[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._checkQuerySupport(b)];case 5:return b=f.sent(),b.returnGeometry=!0,b.returnCentroid=!1,b.outSR=null,[4,this._reschedule()];case 6:return f.sent(),[4,this._executeGeometryQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 9:return c=f.sent(),[4,this._reschedule()];case 10:return f.sent(),
[4,c.executeTimeQuery(b)];case 11:return c=f.sent(),[4,this._reschedule()];case 12:return f.sent(),[4,c.executeAttributesQuery(b)];case 13:c=f.sent();h=c.size;if(!h)return[2,{count:h,extent:null}];r.set(P,r.NEGATIVE_INFINITY);this.featureStore.forEachBounds(c.items,function(a){return r.expand(P,a)},L);k={xmin:P[0],ymin:P[1],xmax:P[3],ymax:P[4],spatialReference:C.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(P[2])&&isFinite(P[5])&&(k.zmin=P[2],k.zmax=P[5]);m=y.project(k,c.spatialReference,
e);m.spatialReference=C.cleanFromGeometryEngine(e||this.spatialReference);0===m.xmax-m.xmin&&(l=g.getMetersPerUnitForSR(m.spatialReference),m.xmin-=l,m.xmax+=l);0===m.ymax-m.ymin&&(l=g.getMetersPerUnitForSR(m.spatialReference),m.ymin-=l,m.ymax+=l);this.hasZ&&null!=m.zmin&&null!=m.zmax&&0===m.zmax-m.zmin&&(l=g.getMetersPerUnitForSR(m.spatialReference),m.zmin-=l,m.zmax+=l);return[2,{count:h,extent:m}];case 14:n=f.sent();if(n===C.QUERY_ENGINE_EMPTY_RESULT)return[2,{count:0,extent:null}];throw n;case 15:return[2]}})})};
b.prototype.executeQueryForIds=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){return f(this,function(c){return[2,this.executeQueryForIdSet(a,b).then(function(a){return e.valuesOfSet(a)})]})})};b.prototype.executeQueryForIdSet=function(a,b){void 0===a&&(a={});return h(this,void 0,void 0,function(){var b,c,e,g,h,k,m,l;return f(this,function(f){switch(f.label){case 0:b=d.clone(a),b.returnGeometry=!1,b.returnCentroid=!1,b.outSR=null,f.label=1;case 1:return f.trys.push([1,13,,
14]),[4,this._schedule()];case 2:return f.sent(),[4,C.normalizeQuery(b,this.definitionExpression,this.spatialReference)];case 3:return b=f.sent(),[4,this._reschedule()];case 4:return f.sent(),[4,this._executeGeometryQuery(b)];case 5:return c=f.sent(),[4,this._reschedule()];case 6:return f.sent(),[4,c.executeObjectIdsQuery(b)];case 7:return c=f.sent(),[4,this._reschedule()];case 8:return f.sent(),[4,c.executeTimeQuery(b)];case 9:return c=f.sent(),[4,this._reschedule()];case 10:return f.sent(),[4,c.executeAttributesQuery(b)];
case 11:return c=f.sent(),[4,this._reschedule()];case 12:f.sent();e=c.items;g=new Set;h=0;for(k=e;h<k.length;h++)m=k[h],g.add(c.featureAdapter.getObjectId(m));return[2,g];case 13:l=f.sent();if(l===C.QUERY_ENGINE_EMPTY_RESULT)return[2,new Set];throw l;case 14:return[2]}})})};b.prototype.executeQueryForLatestObservations=function(b,c){var d=this;if(this.timeInfo)return this.executeQuery(b,c).then(function(a){return d._filterLatest(a,d.timeInfo)});J.error(new a("invalid-query","Unable to make time-based query as the underlying service does include TimeInfo"))};
b.prototype._schedule=function(a){return h(this,void 0,void 0,function(){return f(this,function(b){return this._frameQueue?[2,this._frameQueue.push(a).then(function(a){return a})]:[2,a]})})};b.prototype._reschedule=function(a){return h(this,void 0,void 0,function(){return f(this,function(b){return this._frameQueue?[2,this._frameQueue.unshift(a).then(function(a){return a})]:[2,a]})})};b.prototype._update=function(a){for(this._budget=a;!a.done&&this._frameQueue&&this._frameQueue.process();)a.madeProgress();
this._budget=null};b.prototype._filterLatest=function(a,b){var c=b.trackIdField,d=b.startTimeField;b=b.endTimeField||d;for(var d=new Map,e=[],f=0,g=a.features;f<g.length;f++){var h=g[f],k=h.attributes[c],m=h.attributes[b];(!d.has(k)||d.get(k).attributes[b]<m)&&d.set(k,h)}d.forEach(function(a){return e.push(a)});return l({},a,{features:e})};b.prototype._getAll=function(){if(!this._allItems){var a=[];this.featureStore.forEach(function(b){return a.push(b)});this._allItems=new w.default(a,null,this)}return this._allItems};
b.prototype._executeGeometryQuery=function(a){return h(this,void 0,void 0,function(){var b,c,d,e,g,k,m,l,n,p,r,q,t,v,u,y,B,C,E,H,G,I,K,L,J=this;return f(this,function(N){switch(N.label){case 0:b=a.geometry;c=a.outSR;d=a.spatialRel;e=x.isValid(c)&&!x.equals(this.spatialReference,c);if(g=this.cacheSpatialQueries?e?JSON.stringify({geometry:b,spatialRelationship:d,outSpatialReference:c}):JSON.stringify({geometry:b,spatialRelationship:d}):null)if(k=this._geometryQueryCache.get(g),void 0!==k)return[2,k];
m=function(b){return h(J,void 0,void 0,function(){var d;return f(this,function(f){switch(f.label){case 0:return e&&(a.returnGeometry||a.returnCentroid)?[4,b.project(c)]:[3,2];case 1:return d=f.sent(),g&&this._geometryQueryCache.put(g,d,d.size||1),[2,d];case 2:return g&&this._geometryQueryCache.put(g,b,b.size||1),[2,b]}})})};if(!b)return[2,m(this._getAll())];l=this.featureAdapter;if("esriSpatialRelDisjoint"!==d)return[3,5];n=this._searchFeatures(this._getQueryBBoxes(b));if(!n.length)return[2,m(this._getAll())];
q=new Set;t=0;for(v=n;t<v.length;t++)u=v[t],q.add(l.getObjectId(u));return[4,this._reschedule(q)];case 1:return q=N.sent(),y=0,p=Array(q.size),this.featureStore.forEach(function(a){return p[y++]=a}),r=q,[4,this._reschedule()];case 2:return N.sent(),[4,A.getSpatialQueryOperator(d,b,this)];case 3:return B=N.sent(),C=function(a){return!r.has(l.getObjectId(a))||B(l.getGeometry(a))},H=w.default.bind,[4,this._runSpatialFilter(p,C)];case 4:return E=new (H.apply(w.default,[void 0,N.sent(),b,this])),[2,m(E)];
case 5:return G=this._searchFeatures(this._getQueryBBoxes(b)),G.length?(I=this._canExecuteSoloPass(b,a))?[2,m(new w.default(G,b,this))]:[4,A.getSpatialQueryOperator(d,b,this)]:(E=new w.default([],b,this),g&&this._geometryQueryCache.put(g,E,E.size||1),[2,E]);case 6:return K=N.sent(),[4,this._runSpatialFilter(G,function(a){return K(l.getGeometry(a))})];case 7:return L=N.sent(),[2,m(new w.default(L,b,this))]}})})};b.prototype._runSpatialFilter=function(a,b){return h(this,void 0,void 0,function(){var c,
d,e,g=this;return f(this,function(k){if(!b)return[2,a];if(!this._budget)return[2,a.filter(function(a){return b(a)})];c=0;d=[];e=function(){return h(g,void 0,void 0,function(){var g;return f(this,function(f){switch(f.label){case 0:if(!(c<a.length))return[3,3];g=a[c];b(g)&&d.push(g);return this._budget.done?[4,this._reschedule()]:[3,2];case 1:return f.sent(),[2,e()];case 2:return++c,[3,0];case 3:return[2]}})})};return[2,this._reschedule().then(function(){return e()}).then(function(){return d})]})})};
b.prototype._canExecuteSoloPass=function(a,b){var c=this.geometryType;b=b.spatialRel;return A.canQueryWithRBush(a)&&("esriSpatialRelEnvelopeIntersects"===b||"esriGeometryPoint"===c&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b||"esriSpatialRelWithin"===b))};b.prototype._getQueryBBoxes=function(a){if(A.canQueryWithRBush(a)){if(t.isExtent(a))return[p.fromValues(a.xmin,a.ymin,a.xmax,a.ymax)];if(t.isPolygon(a))return a.rings.map(function(a){return p.fromValues(Math.min(a[0][0],a[2][0]),
Math.min(a[0][1],a[2][1]),Math.max(a[0][0],a[2][0]),Math.max(a[0][1],a[2][1]))})}return[u.getBoundsXY(p.create(),a)]};b.prototype._searchFeatures=function(a){for(var b=0;b<a.length;b++)this.featureStore.forEachInBounds(a[b],function(a){I.add(a)});var c=Array(I.size),d=0;I.forEach(function(a){return c[d++]=a});I.clear();return c};b.prototype._checkQuerySupport=function(b){return h(this,void 0,void 0,function(){return f(this,function(d){if(0>b.distance||null!=b.geometryPrecision||b.multipatchOption||
b.pixelSize||b.relationParam||b.text)throw new a("feature-store:unsupported-query","Unsupported query options",{query:b});return[2,c.all([this._checkAttributesQuerySupport(b),this._checkStatisticsQuerySupport(b),A.checkSpatialQuerySupport(b,this.geometryType,this.spatialReference),y.checkProjectionSupport(this.spatialReference,b.outSR)]).then(function(){return b})]})})};b.prototype._checkAttributesQuerySupport=function(b){var c=b.outFields,d=b.orderByFields,e=b.returnDistinctValues;d&&0<d.length&&
(d=d.map(function(a){return-1<a.indexOf(" ASC")?a.split(" ASC")[0]:-1<a.indexOf(" DESC")?a.split(" DESC")[0]:a}),v.validateFields(this.fieldsIndex,d,"orderByFields contains missing fields"));if(c&&0<c.length)v.validateFields(this.fieldsIndex,c,"outFields contains missing fields");else if(e)throw new a("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:b});v.validateWhere(this.fieldsIndex,b.where)};b.prototype._checkStatisticsQuerySupport=function(b){return h(this,
void 0,void 0,function(){var c,d,e,g,h,k,m,l,n,p,r,q;return f(this,function(f){c=b.outStatistics;d=b.groupByFieldsForStatistics;e=b.having;g=d&&d.length;h=c&&c.length;if(e){if(!g||!h)throw new a("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:b});v.validateHaving(this.fieldsIndex,e,c)}if(h){if(k=c.some(function(a){return"exceedslimit"===a.statisticType}))return[2];m=c.map(function(a){return a.onStatisticField});v.validateFields(this.fieldsIndex,
m,"onStatisticFields contains missing fields");g&&v.validateFields(this.fieldsIndex,d,"groupByFieldsForStatistics contains missing fields");l=0;for(n=c;l<n.length;l++)if(p=n[l],r=p.onStatisticField,q=p.statisticType,(!g||"count"!==q)&&r&&v.hasInvalidFieldType(r,this.fieldsIndex))throw new a("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:p,query:b});}return[2]})})};return b}();b.default=q;var L=r.create(),P=r.create()})},"esri/layers/graphics/data/attributeSupport":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/iteratorUtils ../../../core/sql/WhereClauseCache".split(" "),
function(q,b,l,f,h,a){function e(a,b){return a?n.get(a,b):null}function d(a,b,c,h){void 0===h&&(h=!0);for(var g=[],l=0;l<b.length;l++){var n=b[l];if("*"!==n&&!a.has(n))if(h){var p=k(n);try{var m=e(p,a);if(!m)throw new f("feature-store:unsupported-query","invalid SQL expression",{where:p});if(!m.isStandardized)throw new f("feature-store:unsupported-query","expression is not standard",{clause:m});d(a,m.fieldNames,"expression contains missing fields")}catch(w){if((p=w&&w.details)&&(p.clause||p.where))throw w;
p&&p.missingFields?g.push.apply(g,p.missingFields):g.push(n)}}else g.push(n)}if(g.length)throw new f("feature-store:unsupported-query",c,{missingFields:g});}function k(a){return a.split(" as ")[0]}Object.defineProperty(b,"__esModule",{value:!0});var n=new a.WhereClauseCache(50,500),c=h.createSetFromValues("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));b.validateWhere=function(a,b){if(!b)return!0;
var c=n.get(b,a);if(!c)throw new f("feature-store:unsupported-query","invalid SQL expression",{where:b});if(!c.isStandardized)throw new f("feature-store:unsupported-query","where clause is not standard",{where:b});d(a,c.fieldNames,"where clause contains missing fields");return!0};b.validateHaving=function(a,b,c){if(!b)return!0;var e=n.get(b,a);if(!e)throw new f("feature-store:unsupported-query","invalid SQL expression",{having:b});if(!e.isAggregate)throw new f("feature-store:unsupported-query","having does not contain a valid aggregate function",
{having:b});d(a,e.fieldNames,"having contains missing fields");if(!e.getExpressions().every(function(b){var d=b.aggregateType;b=b.field;var e=a.has(b)&&a.get(b).name;return c.some(function(b){var c=b.onStatisticField;b=b.statisticType;return(a.has(c)&&a.get(c).name)===e&&b.toLowerCase().trim()===d})}))throw new f("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:b});return!0};b.getWhereClause=e;b.validateFields=d;b.getExpressionFromFieldName=k;b.getAliasFromFieldName=
function(a){return a.split(" as ")[1]};b.hasInvalidFieldType=function(a,b){return(a=b.get(a))?!c.has(a.type):!1}})},"esri/core/sql/WhereClauseCache":function(){define(["require","exports","../ItemCache","./WhereClause"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b){this._cache=new l(a);this._invalidCache=new l(b)}b.prototype.get=function(a,b){var d=b.uid+":"+a,e=this._cache.get(d);if(e)return e;if(void 0!==this._invalidCache.get(d))return null;try{var h=
f.WhereClause.create(a,b);this._cache.put(d,h);return h}catch(c){return this._invalidCache.put(d,null),null}};return b}();b.WhereClauseCache=q})},"esri/core/sql/WhereClause":function(){define("require exports ../has ../iteratorUtils ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(q,b,l,f,h,a,e){function d(a,b){a+="";return a.length>=b?a:Array(b-a.length+1).join("0")+a}function k(a,b,c,e,f,g,h,k,m){void 0===c&&(c="0");void 0===e&&(e="0");void 0===f&&(f="0");void 0===
g&&(g="0");void 0===h&&(h="");void 0===k&&(k="0");void 0===m&&(m="0");return"+"===h||"-"===h?(a=d(parseInt(a,10),4)+"-"+d(parseInt(b,10),2)+"-"+d(parseInt(c,10),2),b="",10>parseFloat(g)&&(b="0"),e=d(parseInt(e,10),2)+":"+d(parseInt(f,10),2)+":"+(b+parseFloat(g).toString()),h=""+h+d(parseInt(k,10),2)+":"+d(parseInt(m,10),2),new Date(a+"T"+e+h)):new Date(parseInt(a,10),parseInt(b,10),parseInt(c,10),parseInt(e,10),parseInt(f,10),parseFloat(g))}function n(a){var b=C.exec(a);if(null!==b){a=b[1];var c=
b[2],d=b[3],e=b[4],f=b[5],g=b[6];return k(a,c,d,e,f,g)}b=E.exec(a);if(null!==b){a=b[1];var c=b[2],d=b[3],e=b[4],f=b[5],g=b[6],h=b[7],m=b[8],b=b[9];return k(a,c,d,e,f,g,h,m,b)}b=G.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],h=b[6],m=b[7],b=b[8],k(a,c,d,e,f,"0",h,m,b);b=J.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],e=b[4],f=b[5],k(a,c,d,e,f);b=B.exec(a);if(null!==b)return a=b[1],c=b[2],d=b[3],k(a,c,d);throw Error("SQL Invalid Timestamp");}function c(a){a=B.exec(a);if(null===a)throw Error("SQL Invalid Date");
var b=a[2],c=a[3];return new Date(parseInt(a[1],10),parseInt(b,10)-1,parseInt(c,10))}function g(a){return Array.isArray(a)?a:[a]}function r(a){return null!==a?!0!==a:null}function p(a,b){return null!=a&&null!=b?!0===a&&!0===b:!1===a||!1===b?!1:null}function u(a,b){return null!=a&&null!=b?!0===a||!0===b:!0===a||!0===b?!0:null}function t(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==e)c=null;else if(a===e){c=!0;break}}return c}function x(a,b,c){if(null==a)return null;
for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function v(a){return a instanceof Date?a.valueOf():a}function y(a,b,c){if(null==b||null==c)return null;b=v(b);c=v(c);switch(a){case "\x3c\x3e":return b!==c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=
c;case "\x3c\x3d":return b<=c}}function m(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}function w(b,c,d){if(c instanceof a.SqlInterval)if(d instanceof Date)switch(b){case "+":return new Date(c.valueInMilliseconds()+d.getTime());case "-":return c.valueInMilliseconds()-d.getTime();case "*":return c.valueInMilliseconds()*d.getTime();case "/":return c.valueInMilliseconds()/d.getTime()}else if(d instanceof a.SqlInterval)switch(b){case "+":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()+
d.valueInMilliseconds());case "-":return a.SqlInterval.createFromMilliseconds(c.valueInMilliseconds()-d.valueInMilliseconds());case "*":return c.valueInMilliseconds()*d.valueInMilliseconds();case "/":return c.valueInMilliseconds()/d.valueInMilliseconds()}else c=c.valueInMilliseconds();else if(d instanceof a.SqlInterval)if(c instanceof Date)switch(b){case "+":return new Date(d.valueInMilliseconds()+c.getTime());case "-":return new Date(c.getTime()-d.valueInMilliseconds());case "*":return c.getTime()*
d.valueInMilliseconds();case "/":return c.getTime()/d.valueInMilliseconds()}else d=d.valueInMilliseconds();else if(c instanceof Date&&"number"===typeof d)switch(d*=864E5,c=c.getTime(),b){case "+":return new Date(c+d);case "-":return new Date(c-d);case "*":return new Date(c*d);case "/":return new Date(c/d)}else if(d instanceof Date&&"number"===typeof c)switch(c*=864E5,d=d.getTime(),b){case "+":return new Date(c+d);case "-":return new Date(c-d);case "*":return new Date(c*d);case "/":return new Date(c/
d)}switch(b){case "+":return c+d;case "-":return c-d;case "*":return c*d;case "/":return c/d}}function A(a,b,c,d){a=d.getAttribute(a,b);return null!=a&&1===c[b]?new Date(a):a}Object.defineProperty(b,"__esModule",{value:!0});var B=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,C=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,E=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,G=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,
J=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,I=function(){function b(){}b.makeBool=function(a){return!0===a};b.featureValue=function(a,b,c,d){return A(a,b,c,d)};b.equalsNull=function(a){return null===a};b.applyLike=function(a,b,c){return x(a,b,c)};b.ensureArray=function(a){return g(a)};b.applyIn=function(a,b){return t(a,b)};b.currentDate=function(){var a=new Date;a.setHours(0,0,0,0);return a};b.makeSqlInterval=function(b,c,d){return a.SqlInterval.createFromValueAndQualifer(b,c,d)};b.convertInterval=
function(b){return b instanceof a.SqlInterval?b.valueInMilliseconds():b};b.currentTimestamp=function(){return new Date};b.compare=function(a,b,c){return y(a,b,c)};b.calculate=function(a,b,c){return w(a,b,c)};b.makeComparable=function(a){return v(a)};b.evaluateFunction=function(b,c){return a.evaluateFunction(b,c)};b.lookup=function(a,b){a=b[a];return void 0===a?null:a};b.between=function(a,b){return null==a||null==b[0]||null==b[1]?null:a>=b[0]&&a<=b[1]};b.notbetween=function(a,b){return null==a||null==
b[0]||null==b[1]?null:a<b[0]||a>b[1]};b.ternaryNot=function(a){return r(a)};b.ternaryAnd=function(a,b){return p(a,b)};b.ternaryOr=function(a,b){return u(a,b)};return b}();q=function(){function d(a,b){this.fieldsIndex=b;this.datefields={};this.parameters={};this.parseTree=e.WhereGrammar.parse(a);a=this.extractExpressionInfo(b);b=a.isStandardized;var c=a.isAggregate;this.referencedFieldNames=a.referencedFieldNames;this.isStandardized=b;this.isAggregate=c}d.create=function(a,b){return new d(a,b)};Object.defineProperty(d.prototype,
"fieldNames",{get:function(){return this.referencedFieldNames},enumerable:!0,configurable:!0});d.prototype.testSet=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);for(var d={},e=function(b){d[b]=a.map(function(a){return c.getAttribute(a,b)})},f=0,g=this.fieldNames;f<g.length;f++)e(g[f]);return!!this.evaluateNode(this.parseTree,{attributes:d},b.defaultAttributeAdapter)};d.prototype.calculateValue=function(c,d){void 0===d&&(d=b.defaultAttributeAdapter);c=this.evaluateNode(this.parseTree,c,d);
return c instanceof a.SqlInterval?c.valueInMilliseconds()/864E5:c};d.prototype.calculateValueCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(a,this.parameters,c,this.datefields);if(l("csp-restrictions"))return this.calculateValue(a,c);this.compileMe();return this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};d.prototype.testFeature=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);
return!!this.evaluateNode(this.parseTree,a,c)};d.prototype.testFeatureCompiled=function(a,c){void 0===c&&(c=b.defaultAttributeAdapter);if(void 0===this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields);if(l("csp-restrictions"))return this.testFeature(a,c);this.compileMe();return!!this.parseTree._compiledVersion(a,this.parameters,c,this.datefields)};d.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===
b.type&&a.push(b.name.toLowerCase())});return m(a)};d.prototype.getExpressions=function(){var a=new Map;this.visitAll(this.parseTree,function(b){if("function"===b.type){var c=b.name.toLowerCase();b=b.args.value[0];if("column_ref"===b.type){b=b.column;var d=c+"-"+b;a.has(d)||a.set(d,{aggregateType:c,field:b})}}});return f.valuesOfMap(a)};d.prototype.getVariables=function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return m(a)};d.prototype.compileMe=
function(){var a="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",a)).bind(I)};d.prototype.extractExpressionInfo=function(b){var c=this,d=[],e=!0,f=!0;this.visitAll(this.parseTree,function(g){switch(g.type){case "column_ref":var k=g.column.toUpperCase();if("CURRENT_DATE"!==k&&"CURRENT_TIMESTAMP"!==k){var m=(k=b.get(g.column))&&k.name;!k||"date"!==k.type&&"esriFieldTypeDate"!==
k.type||(c.datefields[k.name]=1);void 0!==m?(d.push(m),g.column=m):d.push(g.column)}break;case "function":k=g.name,g=g.args.value.length,e&&(e=a.isStandardized(k,g)),f&&(f=h.isAggregate(k,g))}});return{referencedFieldNames:m(d),isStandardized:e,isAggregate:f}};d.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===
a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};d.prototype.evaluateNodeToJavaScript=function(a){switch(a.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(a.value)+", "+JSON.stringify(a.qualifier)+
","+JSON.stringify(a.op)+")";case "case_expression":var b="";if("simple"===a.format)for(var d="this.makeComparable("+this.evaluateNodeToJavaScript(a.operand)+")",b="( ",e=0;e<a.clauses.length;e++)b+=" ("+d+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")) ? ("+this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";else for(b="( ",e=0;e<a.clauses.length;e++)b+=" this.makeBool("+this.evaluateNodeToJavaScript(a.clauses[e].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(a.clauses[e].value)+") : ";b=null!==a.else?b+this.evaluateNodeToJavaScript(a.else):b+"null";return b+" )";case "param":return"this.lookup("+JSON.stringify(a.value.toLowerCase())+",lookups)";case "expr_list":b="[";d=0;for(a=a.value;d<a.length;d++)e=a[d],"["!==b&&(b+=","),b+=this.evaluateNodeToJavaScript(e);return b+"]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(a.expr)+")";case "binary_expr":switch(a.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+" )";case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")";case "ISNOT":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(a.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(a.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(a.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+","+JSON.stringify(a.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+
this.evaluateNodeToJavaScript(a.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(a.operator)+","+this.evaluateNodeToJavaScript(a.left)+","+this.evaluateNodeToJavaScript(a.right)+")"}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(a.value);case "date":return"(new Date("+c(a.value).getTime().toString()+"))";case "timestamp":return"(new Date("+n(a.value).getTime().toString()+"))";case "column_ref":return"CURRENT_DATE"===
a.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===a.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(a.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(a.name)+","+this.evaluateNodeToJavaScript(a.args)+")"}throw Error("Unsupported sql syntax "+a.type);};d.prototype.evaluateNode=function(b,d,e){switch(b.type){case "interval":return d=this.evaluateNode(b.value,d,e),a.SqlInterval.createFromValueAndQualifer(d,
b.qualifier,b.op);case "case_expression":if("simple"===b.format)for(var f=v(this.evaluateNode(b.operand,d,e)),k=0;k<b.clauses.length;k++){if(f===v(this.evaluateNode(b.clauses[k].operand,d,e)))return this.evaluateNode(b.clauses[k].value,d,e)}else for(k=0;k<b.clauses.length;k++)if(!0===this.evaluateNode(b.clauses[k].operand,d,e))return this.evaluateNode(b.clauses[k].value,d,e);return null!==b.else?this.evaluateNode(b.else,d,e):null;case "param":return this.parameters[b.value.toLowerCase()];case "expr_list":f=
[];k=0;for(b=b.value;k<b.length;k++){var m=b[k];f.push(this.evaluateNode(m,d,e))}return f;case "unary_expr":return r(this.evaluateNode(b.expr,d,e));case "binary_expr":switch(b.operator){case "AND":return p(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e));case "OR":return u(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e));case "IS":if("null"!==b.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(b.left,d,e);case "ISNOT":if("null"!==b.right.type)throw Error("Unsupported RHS for IS");
return null!==this.evaluateNode(b.left,d,e);case "IN":return f=g(this.evaluateNode(b.right,d,e)),t(this.evaluateNode(b.left,d,e),f);case "NOT IN":return f=g(this.evaluateNode(b.right,d,e)),r(t(this.evaluateNode(b.left,d,e),f));case "BETWEEN":return f=this.evaluateNode(b.left,d,e),b=this.evaluateNode(b.right,d,e),null==f||null==b[0]||null==b[1]?null:f>=v(b[0])&&f<=v(b[1]);case "NOTBETWEEN":return f=this.evaluateNode(b.left,d,e),b=this.evaluateNode(b.right,d,e),null==f||null==b[0]||null==b[1]?null:
f<v(b[0])||f>v(b[1]);case "LIKE":return x(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e),b.escape);case "NOT LIKE":return r(x(this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e),b.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return y(b.operator,this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e));case "-":case "+":case "*":case "/":return w(b.operator,this.evaluateNode(b.left,d,e),this.evaluateNode(b.right,d,e))}throw Error("Not Supported Operator "+
b.operator);case "null":case "bool":case "string":case "number":return b.value;case "date":return c(b.value);case "timestamp":return n(b.value);case "column_ref":return"CURRENT_DATE"===b.column.toUpperCase()?(m=new Date,m.setHours(0,0,0,0),m):"CURRENT_TIMESTAMP"===b.column.toUpperCase()?new Date:A(d,b.column,this.datefields,e);case "function":return d=this.evaluateNode(b.args,d,e),this.isAggregate?h.aggregateFunction(b.name,d):a.evaluateFunction(b.name,d)}throw Error("Unsupported sql syntax "+b.type);
};return d}();b.WhereClause=q;b.defaultAttributeAdapter={getAttribute:function(a,b){return(a&&"object"===typeof a.attributes?a.attributes:a)[b]}}})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(q,b){function l(a){for(var b=0,d=0;d<a.length;d++)b+=a[d];return b/a.length}function f(a){for(var b=l(a),d=a.length,f=0,h=0;h<a.length;h++)f+=Math.pow(a[h]-b,2);return 1<d?f/(d-1):0}Object.defineProperty(b,"__esModule",{value:!0});b.aggregateFunction=function(a,b){var d=
h[a.toLowerCase()];if(null==d)throw Error("Function Not Recognised");if(b.length<d.minParams||b.length>d.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return d.evaluate(b)};b.isAggregate=function(a,b){a=h[a.toLowerCase()];return null!=a&&b>=a.minParams&&b<=a.maxParams};var h={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,
a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:l(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,d=0;d<a.length;d++)b+=a[d];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sqrt(f(a[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:f(a[0])}}}})},
"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","../string"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}b.fixDefaults=function(a){if(null!==a.precision||null!==a.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};b.createFromMilliseconds=function(a){var e=new b;e.second=a/1E3;return e};b.createFromValueAndQualifer=
function(a,e,d){var f=null,h=new b;h.op="-"===d?"-":"+";if("interval-period"===e.type){b.fixDefaults(e);if("year"===e.period||"month"===e.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(a))h[e.period]=parseFloat(a);else throw Error("Illegal Interval");}else{b.fixDefaults(e.start);b.fixDefaults(e.end);if("year"===e.start.period||"month"===e.start.period)throw Error("Year-Month Intervals not supported");if("year"===e.end.period||"month"===e.end.period)throw Error("Year-Month Intervals not supported");
switch(e.start.period){case "day":switch(e.end.period){case "hour":f=/^[0-9]{1,} [0-9]{1,}$/;if(f.test(a))h[e.start.period]=parseFloat(a.split(" ")[0]),h[e.end.period]=parseFloat(a.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":f=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(f.test(a))h[e.start.period]=parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),h.hour=parseFloat(a[0]),h.minute=parseFloat(a[1]);else throw Error("Illegal Interval");break;case "second":f=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(f.test(a))h[e.start.period]=parseFloat(a.split(" ")[0]),a=a.split(" ")[1].split(":"),h.hour=parseFloat(a[0]),h.minute=parseFloat(a[1]),h.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(e.end.period){case "minute":f=/^[0-9]{1,}:[0-9]{1,}$/;if(f.test(a))h.hour=parseFloat(a.split(":")[0]),h.minute=parseFloat(a.split(":")[1]);else throw Error("Illegal Interval");break;case "second":f=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(f.test(a))a=a.split(":"),h.hour=parseFloat(a[0]),h.minute=parseFloat(a[1]),h.second=parseFloat(a[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(e.end.period){case "second":f=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(f.test(a))a=a.split(":"),h.minute=parseFloat(a[0]),h.second=parseFloat(a[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return h};b.prototype.valueInMilliseconds=
function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return b}();b.SqlInterval=q;b.evaluateFunction=function(b,a){var e=f[b.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(a.length<e.minParams||a.length>e.maxParams)throw Error("Invalid Parameter count for call to "+b.toUpperCase());return e.evaluate(a)};b.isStandardized=function(b,a){b=f[b.toLowerCase()];return null!=b&&a>=b.minParams&&
a<=b.maxParams};var f={extract:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];if(null==b)return null;if(b instanceof Date)switch(a.toUpperCase()){case "SECOND":return b.getSeconds();case "MINUTE":return b.getMinutes();case "HOUR":return b.getHours();case "DAY":return b.getDate();case "MONTH":return b.getMonth()+1;case "YEAR":return b.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(b){if(2===b.length){var a=
b[0],e=b[1];return null==a||null==e?null:a.toString().substring(e-1)}if(3===b.length)return a=b[0],e=b[1],b=b[2],null==a||null==e||null==b?null:0>=b?"":a.toString().substring(e-1,e+b-1)}},position:{minParams:2,maxParams:2,evaluate:function(b){var a=b[0];b=b[1];return null==a||null==b?null:b.indexOf(a)+1}},trim:{minParams:2,maxParams:3,evaluate:function(b){var a=3===b.length,e=a?b[1]:" ",a=a?b[2]:b[1];if(null==e||null==a)return null;e="("+l.escapeRegExpString(e)+")";switch(b[0]){case "BOTH":return a.replace(new RegExp("^"+
e+"*|"+e+"*$","g"),"");case "LEADING":return a.replace(new RegExp("^"+e+"*","g"),"");case "TRAILING":return a.replace(new RegExp(e+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.abs(b[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.ceil(b[0])}},floor:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.floor(b[0])}},log:{minParams:1,maxParams:1,
evaluate:function(b){return null==b[0]?null:Math.log(b[0])}},log10:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.log(b[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sin(b[0])}},cos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.cos(b[0])}},tan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.tan(b[0])}},asin:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?
null:Math.asin(b[0])}},acos:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.acos(b[0])}},atan:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.atan(b[0])}},sign:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:0<b[0]?1:0>b[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:Math.pow(b[0],b[1])}},mod:{minParams:2,maxParams:2,evaluate:function(b){return null==b[0]||null==b[1]?null:b[0]%
b[1]}},round:{minParams:1,maxParams:2,evaluate:function(b){var a=b[0];b=2===b.length?Math.pow(10,b[1]):1;return null==a?null:Math.round(a*b)/b}},truncate:{minParams:1,maxParams:2,evaluate:function(b){return null==b[0]?null:1===b.length?parseInt(b[0].toFixed(0),10):parseFloat(b[0].toFixed(b[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(b){return"string"===typeof b[0]||b[0]instanceof String?b[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(b){for(var a="",e=0;e<
b.length;e++){if(null==b[e])return null;a+=b[e].toString()}return a}},lower:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:b[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){}b.parse=function(b){return l.parse(b)};
return b}();b.WhereGrammar=q})},"esri/core/sql/sql92grammar":function(){define([],function(){function q(b,l,f,h){this.message=b;this.expected=l;this.found=f;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,q)}(function(b,l){function f(){this.constructor=b}f.prototype=l.prototype;b.prototype=new f})(q,Error);q.buildMessage=function(b,l){function f(a){return a.charCodeAt(0).toString(16).toUpperCase()}function h(a){return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+f(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+f(a)})}function a(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+f(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(a){return"\\x"+f(a)})}var e={literal:function(a){return'"'+h(a.text)+'"'},"class":function(b){var d="",e;for(e=0;e<b.parts.length;e++)d+=b.parts[e]instanceof Array?a(b.parts[e][0])+"-"+a(b.parts[e][1]):a(b.parts[e]);return"["+(b.inverted?"^":"")+d+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),d;for(d=0;d<a.length;d++){var c=d,f;f=a[d];f=e[f.type](f);b[c]=f}b.sort();
if(0<b.length){for(a=d=1;d<b.length;d++)b[d-1]!==b[d]&&(b[a]=b[d],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(l?'"'+h(l)+'"':"end of input")+" found."};return{SyntaxError:q,parse:function(b,l){function f(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function a(a){var c=Za[a],d;if(!c){for(d=a-1;!Za[d];)d--;c=Za[d];
for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;Za[a]=c}return c}function e(b,c){var d=a(b),e=a(c);return{start:{offset:b,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function d(a){D<fb||(D>fb&&(fb=D,nb=[]),nb.push(a))}function k(){var a,b,d;a=D;b=da();b!==z?(b=c(),b!==z?(d=da(),d!==z?a=b:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);return a}function n(){var a,b,d,e,f,g,h,k;a=D;b=c();if(b!==z){d=[];e=D;f=da();f!==z?(g=ia(),g!==z?(h=
da(),h!==z?(k=c(),k!==z?e=f=[f,g,h,k]:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z);for(;e!==z;)d.push(e),e=D,f=da(),f!==z?(g=ia(),g!==z?(h=da(),h!==z?(k=c(),k!==z?e=f=[f,g,h,k]:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z);if(d!==z){a={type:"expr_list"};b=[b];for(e=0;e<d.length;e++)b.push(d[e][3]);a.value=b}else D=a,a=z}else D=a,a=z;return a}function c(){var a,b,c,d,e,f,h,k;a=D;b=g();if(b!==z){c=[];d=D;e=da();e!==z?(f=ea(),f!==z?(h=da(),h!==z?(k=g(),k!==z?d=e=[e,f,h,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):
(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=da(),e!==z?(f=ea(),f!==z?(h=da(),h!==z?(k=g(),k!==z?d=e=[e,f,h,k]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=Ma(b,c):(D=a,a=z)}else D=a,a=z;return a}function g(){var a,b,c,d,e,f,g,h;a=D;b=r();if(b!==z){c=[];d=D;e=da();e!==z?(f=U(),f!==z?(g=da(),g!==z?(h=r(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=da(),e!==z?(f=U(),f!==z?(g=da(),g!==z?(h=r(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=
z);c!==z?a=b=Ma(b,c):(D=a,a=z)}else D=a,a=z;return a}function r(){var a,c,e,f,g;a=D;c=ca();c===z&&(c=D,33===b.charCodeAt(D)?(e=Wa,D++):(e=z,0===fa&&d(jb)),e!==z?(f=D,fa++,61===b.charCodeAt(D)?(g=va,D++):(g=z,0===fa&&d(bb)),fa--,g===z?f=void 0:(D=f,f=z),f!==z?c=e=[e,f]:(D=c,c=z)):(D=c,c=z));c!==z?(e=da(),e!==z?(f=r(),f!==z?a=c={type:"unary_expr",operator:"NOT",expr:f}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);if(a===z)if(a=D,c=x(),c!==z)if(e=da(),e!==z){var h,k,m;e=[];f=D;g=da();g!==z?(h=p(),h!==z?(k=da(),k!==
z?(m=x(),m!==z?f=g=[g,h,k,m]:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z);if(f!==z)for(;f!==z;)e.push(f),f=D,g=da(),g!==z?(h=p(),h!==z?(k=da(),k!==z?(m=x(),m!==z?f=g=[g,h,k,m]:(D=f,f=z)):(D=f,f=z)):(D=f,f=z)):(D=f,f=z);else e=z;e!==z&&(e={type:"arithmetic",tail:e});e===z&&(e=D,f=t(),f!==z?(g=da(),g!==z?(g=na(),g!==z?(g=da(),g!==z?(g=n(),g!==z?(h=da(),h!==z?(h=ya(),h!==z?e=f={op:f,right:g}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=t(),f!==z?(g=da(),g!==
z?(g=na(),g!==z?(g=da(),g!==z?(g=ya(),g!==z?e=f={op:f,right:{type:"expr_list",value:[]}}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=t(),f!==z?(g=da(),g!==z?(g=G(),g!==z?e=f={op:f,right:g}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z))),e===z&&(e=D,g=ca(),g!==z?(f=da(),f!==z?(f=ha(),f!==z?(h=da(),h!==z?(h=x(),h!==z?(k=da(),k!==z?(k=U(),k!==z?(g=da(),g!==z?(g=x(),g!==z?e=g={op:"NOT"+f,right:{type:"expr_list",value:[h,g]}}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):
(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,g=ha(),g!==z?(f=da(),f!==z?(f=x(),f!==z?(h=da(),h!==z?(h=U(),h!==z?(k=da(),k!==z?(k=x(),k!==z?e=g={op:g,right:{type:"expr_list",value:[f,k]}}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)),e===z&&(e=D,f=V(),f!==z?(g=da(),g!==z?(g=ca(),g!==z?(g=da(),g!==z?(g=x(),g!==z?e=f={op:f+"NOT",right:g}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=V(),f!==z?(g=da(),g!==z?(g=x(),g!==z?e=f={op:f,right:g}:(D=e,e=z)):
(D=e,e=z)):(D=e,e=z)),e===z&&(e=D,f=u(),f!==z?(g=da(),g!==z?(g=P(),g!==z?(h=da(),h!==z?(h=D,b.substr(D,6).toLowerCase()===kc?(k=b.substr(D,6),D+=6):(k=z,0===fa&&d(Ac)),k!==z?(k=D,fa++,m=C(),fa--,m===z?k=void 0:(D=k,k=z),k!==z?h="ESCAPE":(D=h,h=z)):(D=h,h=z),h!==z?(h=da(),h!==z?(h=S(),h!==z?e=f={op:f,right:g,escape:h.value}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=u(),f!==z?(g=da(),g!==z?(g=P(),g!==z?e=f={op:f,right:g,escape:""}:(D=e,e=z)):(D=e,e=z)):
(D=e,e=z))))));e===z&&(e=null);e!==z?(a=c,c=e,""==c||void 0==c||null==c?c=a:(e=null,c=e="arithmetic"==c.type?Ma(a,c.tail):Ja(c.op,a,c.right,c.escape)),a=c):(D=a,a=z)}else D=a,a=z;else D=a,a=z;return a}function p(){var a;b.substr(D,2)===Na?(a=Na,D+=2):(a=z,0===fa&&d(lb));a===z&&(62===b.charCodeAt(D)?(a=kb,D++):(a=z,0===fa&&d(Xa)),a===z&&(b.substr(D,2)===Sa?(a=Sa,D+=2):(a=z,0===fa&&d(Va)),a===z&&(b.substr(D,2)===ub?(a=ub,D+=2):(a=z,0===fa&&d(sb)),a===z&&(60===b.charCodeAt(D)?(a=Rb,D++):(a=z,0===fa&&
d(Gb)),a===z&&(61===b.charCodeAt(D)?(a=va,D++):(a=z,0===fa&&d(bb)),a===z&&(b.substr(D,2)===Ab?(a=Ab,D+=2):(a=z,0===fa&&d(Da))))))));return a}function u(){var a,b,c,d;a=a=D;b=ca();b!==z?(c=da(),c!==z?(d=F(),d!==z?a=b=[b,c,d]:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);a!==z&&(a=a[0]+" "+a[2]);a===z&&(a=F());return a}function t(){var a,b,c,d;a=a=D;b=ca();b!==z?(c=da(),c!==z?(d=aa(),d!==z?a=b=[b,c,d]:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);a!==z&&(a=a[0]+" "+a[2]);a===z&&(a=aa());return a}function x(){var a,b,c,d,e,f,g,
h;a=D;b=y();if(b!==z){c=[];d=D;e=da();e!==z?(f=v(),f!==z?(g=da(),g!==z?(h=y(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=da(),e!==z?(f=v(),f!==z?(g=da(),g!==z?(h=y(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=Ma(b,c):(D=a,a=z)}else D=a,a=z;return a}function v(){var a;43===b.charCodeAt(D)?(a=lc,D++):(a=z,0===fa&&d(Ba));a===z&&(45===b.charCodeAt(D)?(a=Ia,D++):(a=z,0===fa&&d(gb)));return a}function y(){var a,b,c,d,e,f,g,h;
a=D;b=w();if(b!==z){c=[];d=D;e=da();e!==z?(f=m(),f!==z?(g=da(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);for(;d!==z;)c.push(d),d=D,e=da(),e!==z?(f=m(),f!==z?(g=da(),g!==z?(h=w(),h!==z?d=e=[e,f,g,h]:(D=d,d=z)):(D=d,d=z)):(D=d,d=z)):(D=d,d=z);c!==z?a=b=Ma(b,c):(D=a,a=z)}else D=a,a=z;return a}function m(){var a;42===b.charCodeAt(D)?(a=Pa,D++):(a=z,0===fa&&d(Nb));a===z&&(47===b.charCodeAt(D)?(a=Ob,D++):(a=z,0===fa&&d(Ub)));return a}function w(){var a,e,f,g,h,k,m;m=S();
if(m===z){var l,p,r,q;l=D;var t,w,v,u;t=D;w=T();w!==z?(v=Y(),v!==z?(u=N(),u!==z?t=w=parseFloat(w+v+u):(D=t,t=z)):(D=t,t=z)):(D=t,t=z);t===z&&(t=D,w=T(),w!==z?(v=Y(),v!==z?t=w=parseFloat(w+v):(D=t,t=z)):(D=t,t=z),t===z&&(t=D,w=T(),w!==z?(v=N(),v!==z?t=w=parseFloat(w+v):(D=t,t=z)):(D=t,t=z),t===z&&(t=D,w=T(),w!==z&&(w=parseFloat(w)),t=w)));p=t;p!==z?(r=D,fa++,q=B(),fa--,q===z?r=void 0:(D=r,r=z),r!==z?l=p={type:"number",value:p}:(D=l,l=z)):(D=l,l=z);m=l;if(m===z){var x,y;x=D;var F,H,K,L;F=D;b.substr(D,
4).toLowerCase()===dc?(H=b.substr(D,4),D+=4):(H=z,0===fa&&d(Pc));H!==z?(K=D,fa++,L=C(),fa--,L===z?K=void 0:(D=K,K=z),K!==z?F=H=[H,K]:(D=F,F=z)):(D=F,F=z);y=F;y!==z&&(y={type:"bool",value:!0});x=y;if(x===z){x=D;var jb,U,M,W;jb=D;b.substr(D,5).toLowerCase()===gd?(U=b.substr(D,5),D+=5):(U=z,0===fa&&d(hd));U!==z?(M=D,fa++,W=C(),fa--,W===z?M=void 0:(D=M,M=z),M!==z?jb=U=[U,M]:(D=jb,jb=z)):(D=jb,jb=z);y=jb;y!==z&&(y={type:"bool",value:!1});x=y}m=x;if(m===z){var ca,V,Z,sb,Rb;V=D;b.substr(D,4).toLowerCase()===
Cc?(Z=b.substr(D,4),D+=4):(Z=z,0===fa&&d(wd));Z!==z?(sb=D,fa++,Rb=C(),fa--,Rb===z?sb=void 0:(D=sb,sb=z),sb!==z?V=Z=[Z,sb]:(D=V,V=z)):(D=V,V=z);ca=V;ca!==z&&(ca={type:"null",value:null});m=ca;if(m===z){var va,ea,bb,ha;va=D;var X,ub,Na,Gb;X=D;b.substr(D,4).toLowerCase()===xd?(ub=b.substr(D,4),D+=4):(ub=z,0===fa&&d(yd));ub!==z?(Na=D,fa++,Gb=C(),fa--,Gb===z?Na=void 0:(D=Na,Na=z),Na!==z?X=ub="DATE":(D=X,X=z)):(D=X,X=z);ea=X;ea!==z?(bb=da(),bb!==z?(ha=P(),ha!==z?va=ea={type:"date",value:ha.value}:(D=va,
va=z)):(D=va,va=z)):(D=va,va=z);m=va;if(m===z){var Wa,lb,ga,oa;Wa=D;var ia,pa,Sa,Ab;ia=D;b.substr(D,9).toLowerCase()===Ic?(pa=b.substr(D,9),D+=9):(pa=z,0===fa&&d(id));pa!==z?(Sa=D,fa++,Ab=C(),fa--,Ab===z?Sa=void 0:(D=Sa,Sa=z),Sa!==z?ia=pa="TIMESTAMP":(D=ia,ia=z)):(D=ia,ia=z);lb=ia;lb!==z?(ga=da(),ga!==z?(oa=P(),oa!==z?Wa=lb={type:"timestamp",value:oa.value}:(D=Wa,Wa=z)):(D=Wa,Wa=z)):(D=Wa,Wa=z);m=Wa;if(m===z){var Da,kb,Xa,Va,Oa,Ja,wa,tb;Da=D;kb=qa();kb!==z?(Xa=da(),Xa!==z?(45===b.charCodeAt(D)?(Va=
Ia,D++):(Va=z,0===fa&&d(gb)),Va===z&&(43===b.charCodeAt(D)?(Va=lc,D++):(Va=z,0===fa&&d(Ba))),Va!==z?(Oa=da(),Oa!==z?(Ja=P(),Ja!==z?(wa=da(),wa!==z?(tb=I(),tb!==z?Da=kb={type:"interval",value:Ja,qualifier:tb,op:Va}:(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z);Da===z&&(Da=D,kb=qa(),kb!==z?(Xa=da(),Xa!==z?(Va=P(),Va!==z?(Oa=da(),Oa!==z?(Ja=I(),Ja!==z?Da=kb={type:"interval",value:Va,qualifier:Ja,op:""}:(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=Da,Da=z)):(D=
Da,Da=z));m=Da}}}}}}a=m;if(a===z){var Ca,Aa,Ma,Jc,Fa,Ga,Ka,tc,vc,Ua,Za,eb;Ca=D;var Ra,ab,Ya,ib;Ra=D;b.substr(D,7).toLowerCase()===mc?(ab=b.substr(D,7),D+=7):(ab=z,0===fa&&d(Qc));ab!==z?(Ya=D,fa++,ib=C(),fa--,ib===z?Ya=void 0:(D=Ya,Ya=z),Ya!==z?Ra=ab="EXTRACT":(D=Ra,Ra=z)):(D=Ra,Ra=z);Aa=Ra;if(Aa!==z)if(Ma=da(),Ma!==z)if(Jc=na(),Jc!==z)if(Fa=da(),Fa!==z){var La;La=ja();La===z&&(La=la(),La===z&&(La=ma(),La===z&&(La=ta(),La===z&&(La=ua(),La===z&&(La=sa())))));Ga=La;Ga!==z?(Ka=da(),Ka!==z?(tc=ka(),tc!==
z?(vc=da(),vc!==z?(Ua=c(),Ua!==z?(Za=da(),Za!==z?(eb=ya(),eb!==z?Ca=Aa={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Ga},Ua]}}:(D=Ca,Ca=z)):(D=Ca,Ca=z)):(D=Ca,Ca=z)):(D=Ca,Ca=z)):(D=Ca,Ca=z)):(D=Ca,Ca=z)):(D=Ca,Ca=z)}else D=Ca,Ca=z;else D=Ca,Ca=z;else D=Ca,Ca=z;else D=Ca,Ca=z;a=Ca;if(a===z){var $a,fb,kd,qb,rb,Pa,Mb,xb,db,pb,md,Qa,Db,Nb,ic,Fb;$a=D;var nb,Ob,Cb,Sb;nb=D;b.substr(D,9).toLowerCase()===Vb?(Ob=b.substr(D,9),D+=9):(Ob=z,0===fa&&d(ec));Ob!==z?(Cb=D,fa++,
Sb=C(),fa--,Sb===z?Cb=void 0:(D=Cb,Cb=z),Cb!==z?nb=Ob="SUBSTRING":(D=nb,nb=z)):(D=nb,nb=z);fb=nb;if(fb!==z)if(kd=da(),kd!==z)if(qb=na(),qb!==z)if(rb=da(),rb!==z)if(Pa=c(),Pa!==z)if(Mb=da(),Mb!==z)if(xb=ka(),xb!==z)if(db=da(),db!==z)if(pb=c(),pb!==z)if(md=da(),md!==z){Qa=D;var cb,Pb,yb,Lb;cb=D;b.substr(D,3).toLowerCase()===jd?(Pb=b.substr(D,3),D+=3):(Pb=z,0===fa&&d(Bb));Pb!==z?(yb=D,fa++,Lb=C(),fa--,Lb===z?yb=void 0:(D=yb,yb=z),yb!==z?cb=Pb="FOR":(D=cb,cb=z)):(D=cb,cb=z);Db=cb;Db!==z?(Nb=da(),Nb!==
z?(ic=c(),ic!==z?(Fb=da(),Fb!==z?Qa=Db=[Db,Nb,ic,Fb]:(D=Qa,Qa=z)):(D=Qa,Qa=z)):(D=Qa,Qa=z)):(D=Qa,Qa=z);Qa===z&&(Qa=null);Qa!==z?(Db=ya(),Db!==z?$a=fb={type:"function",name:"substring",args:{type:"expr_list",value:Qa?[Pa,pb,Qa[2]]:[Pa,pb]}}:(D=$a,$a=z)):(D=$a,$a=z)}else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;else D=$a,$a=z;a=$a;if(a===z){var za,Tb,Bc,uc,wc,nc,Qb,Eb,kc,Ac,Ec,Kb,gc,hc;za=D;Tb=ba();Tb!==z?(Bc=
da(),Bc!==z?(uc=na(),uc!==z?(wc=da(),wc!==z?(nc=J(),nc===z&&(nc=null),nc!==z?(Qb=da(),Qb!==z?(Eb=c(),Eb!==z?(kc=da(),kc!==z?(Ac=ka(),Ac!==z?(Ec=da(),Ec!==z?(Kb=c(),Kb!==z?(gc=da(),gc!==z?(hc=ya(),hc!==z?za=Tb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==nc?"BOTH":nc},Eb,Kb]}}:(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z);za===z&&(za=D,Tb=
ba(),Tb!==z?(Bc=da(),Bc!==z?(uc=na(),uc!==z?(wc=da(),wc!==z?(nc=J(),nc===z&&(nc=null),nc!==z?(Qb=da(),Qb!==z?(Eb=c(),Eb!==z?(kc=da(),kc!==z?(Ac=ya(),Ac!==z?za=Tb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==nc?"BOTH":nc},Eb]}}:(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z)):(D=za,za=z));a=za;if(a===z){var hb,Yb,Kc,Nc,nd,fc,Jb,rc,sc,zb,Lc,Mc;hb=D;var $b,Fc,xc,Wc;$b=D;b.substr(D,8).toLowerCase()===zd?(Fc=
b.substr(D,8),D+=8):(Fc=z,0===fa&&d(Ad));Fc!==z?(xc=D,fa++,Wc=C(),fa--,Wc===z?xc=void 0:(D=xc,xc=z),xc!==z?$b=Fc="POSITION":(D=$b,$b=z)):(D=$b,$b=z);Yb=$b;Yb!==z?(Kc=da(),Kc!==z?(Nc=na(),Nc!==z?(nd=da(),nd!==z?(fc=c(),fc!==z?(Jb=da(),Jb!==z?(rc=aa(),rc!==z?(sc=da(),sc!==z?(zb=c(),zb!==z?(Lc=da(),Lc!==z?(Mc=ya(),Mc!==z?hb=Yb={type:"function",name:"position",args:{type:"expr_list",value:[fc,zb]}}:(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z)):
(D=hb,hb=z)):(D=hb,hb=z)):(D=hb,hb=z);a=hb;if(a===z){var Hb,Xc,pd,Ub,Xb,Ib,ld,Vc;Hb=D;var oc,bc,cc,Dc;oc=D;oc=bc=A();if(oc===z)if(oc=D,96===b.charCodeAt(D)?(bc=ad,D++):(bc=z,0===fa&&d(Rc)),bc!==z){cc=[];bd.test(b.charAt(D))?(Dc=b.charAt(D),D++):(Dc=z,0===fa&&d(Sc));if(Dc!==z)for(;Dc!==z;)cc.push(Dc),bd.test(b.charAt(D))?(Dc=b.charAt(D),D++):(Dc=z,0===fa&&d(Sc));else cc=z;cc!==z?(96===b.charCodeAt(D)?(Dc=ad,D++):(Dc=z,0===fa&&d(Rc)),Dc!==z?oc=bc=cc.join(""):(D=oc,oc=z)):(D=oc,oc=z)}else D=oc,oc=z;
Xc=oc;Xc!==z?(pd=da(),pd!==z?(Ub=na(),Ub!==z?(Xb=da(),Xb!==z?(Ib=n(),Ib===z&&(Ib=null),Ib!==z?(ld=da(),ld!==z?(Vc=ya(),Vc!==z?Hb=Xc={type:"function",name:Xc,args:Ib?Ib:{type:"expr_list",value:[]}}:(D=Hb,Hb=z)):(D=Hb,Hb=z)):(D=Hb,Hb=z)):(D=Hb,Hb=z)):(D=Hb,Hb=z)):(D=Hb,Hb=z)):(D=Hb,Hb=z);a=Hb;if(a===z){var Wb,Ha,Zb,Yc,ac,zc,Tc,pc,jc,Hc,od;Ha=D;Zb=xa();if(Zb!==z)if(Yc=da(),Yc!==z)if(ac=c(),ac!==z)if(zc=da(),zc!==z){Tc=[];for(pc=O();pc!==z;)Tc.push(pc),pc=O();Tc!==z?(pc=da(),pc!==z?(jc=ra(),jc!==z?Ha=
Zb={type:"case_expression",format:"simple",operand:ac,clauses:Tc,else:null}:(D=Ha,Ha=z)):(D=Ha,Ha=z)):(D=Ha,Ha=z)}else D=Ha,Ha=z;else D=Ha,Ha=z;else D=Ha,Ha=z;else D=Ha,Ha=z;if(Ha===z)if(Ha=D,Zb=xa(),Zb!==z)if(Yc=da(),Yc!==z)if(ac=c(),ac!==z)if(zc=da(),zc!==z){Tc=[];for(pc=O();pc!==z;)Tc.push(pc),pc=O();Tc!==z?(pc=da(),pc!==z?(jc=Q(),jc!==z?(Hc=da(),Hc!==z?(od=ra(),od!==z?Ha=Zb={type:"case_expression",format:"simple",operand:ac,clauses:Tc,else:jc.value}:(D=Ha,Ha=z)):(D=Ha,Ha=z)):(D=Ha,Ha=z)):(D=Ha,
Ha=z)):(D=Ha,Ha=z)}else D=Ha,Ha=z;else D=Ha,Ha=z;else D=Ha,Ha=z;else D=Ha,Ha=z;Wb=Ha;if(Wb===z){var Ta,Gc,Zc,Uc,qc,yc,qd,rd;Ta=D;Gc=xa();if(Gc!==z)if(Zc=da(),Zc!==z){Uc=[];for(qc=R();qc!==z;)Uc.push(qc),qc=R();Uc!==z?(qc=da(),qc!==z?(yc=ra(),yc!==z?Ta=Gc={type:"case_expression",format:"searched",clauses:Uc,else:null}:(D=Ta,Ta=z)):(D=Ta,Ta=z)):(D=Ta,Ta=z)}else D=Ta,Ta=z;else D=Ta,Ta=z;if(Ta===z)if(Ta=D,Gc=xa(),Gc!==z)if(Zc=da(),Zc!==z){Uc=[];for(qc=R();qc!==z;)Uc.push(qc),qc=R();Uc!==z?(qc=da(),qc!==
z?(yc=Q(),yc!==z?(qd=da(),qd!==z?(rd=ra(),rd!==z?Ta=Gc={type:"case_expression",format:"searched",clauses:Uc,else:yc.value}:(D=Ta,Ta=z)):(D=Ta,Ta=z)):(D=Ta,Ta=z)):(D=Ta,Ta=z)):(D=Ta,Ta=z)}else D=Ta,Ta=z;else D=Ta,Ta=z;Wb=Ta}a=Wb;if(a===z){var Oc,cd,dd,$c,Hd;cd=D;dd=B();if(dd!==z){$c=[];for(Hd=E();Hd!==z;)$c.push(Hd),Hd=E();$c!==z?cd=dd+=$c.join(""):(D=cd,cd=z)}else D=cd,cd=z;Oc=cd;Oc!==z&&(Oc={type:"column_ref",table:"",column:Oc});a=Oc;a===z&&(a=G(),a===z&&(a=D,e=na(),e!==z?(f=da(),f!==z?(g=c(),g!==
z?(h=da(),h!==z?(k=ya(),k!==z?(g.paren=!0,a=e=g):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)))}}}}}}}return a}function A(){var a,b,c,d;a=D;b=B();if(b!==z){c=[];for(d=C();d!==z;)c.push(d),d=C();c!==z?a=b+=c.join(""):(D=a,a=z)}else D=a,a=z;return a}function B(){var a;Wb.test(b.charAt(D))?(a=b.charAt(D),D++):(a=z,0===fa&&d(fc));return a}function C(){var a;Cb.test(b.charAt(D))?(a=b.charAt(D),D++):(a=z,0===fa&&d(Qa));return a}function E(){var a;xb.test(b.charAt(D))?(a=b.charAt(D),D++):(a=z,0===
fa&&d(ab));return a}function G(){var a,c,e;a=D;64===b.charCodeAt(D)?(c=Ua,D++):(c=z,0===fa&&d(Sb));c!==z?(e=A(),e!==z?a=c=[c,e]:(D=a,a=z)):(D=a,a=z);a!==z&&(a={type:"param",value:a[1]});return a}function J(){var a,c,e;a=D;b.substr(D,7).toLowerCase()===Ec?(c=b.substr(D,7),D+=7):(c=z,0===fa&&d(X));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="LEADING":(D=a,a=z)):(D=a,a=z);a===z&&(a=D,b.substr(D,8).toLowerCase()===Jc?(c=b.substr(D,8),D+=8):(c=z,0===fa&&d(Ka)),c!==z?(c=D,fa++,e=C(),fa--,
e===z?c=void 0:(D=c,c=z),c!==z?a="TRAILING":(D=a,a=z)):(D=a,a=z),a===z&&(a=D,b.substr(D,4).toLowerCase()===Aa?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(Fa)),c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="BOTH":(D=a,a=z)):(D=a,a=z)));return a}function I(){var a,c,e;a=D;var f,g;c=D;e=K();e!==z?(f=da(),f!==z?(f=na(),f!==z?(f=da(),f!==z?(f=L(),f!==z?(g=da(),g!==z?(g=ya(),g!==z?c=e={type:"interval-period",period:e.value,precision:f,secondary:null}:(D=c,c=z)):(D=c,c=z)):(D=c,c=z)):(D=c,c=z)):
(D=c,c=z)):(D=c,c=z)):(D=c,c=z);c===z&&(c=D,e=K(),e!==z&&(e=Pb(e)),c=e);if(c!==z)if(e=da(),e!==z)if(e=D,b.substr(D,2).toLowerCase()===Ga?(f=b.substr(D,2),D+=2):(f=z,0===fa&&d(kd)),f!==z?(f=D,fa++,g=C(),fa--,g===z?f=void 0:(D=f,f=z),f!==z?e="TO":(D=e,e=z)):(D=e,e=z),e!==z)if(e=da(),e!==z){var h;e=D;f=K();f!==z&&(f={type:"interval-period",period:f.value,precision:null,secondary:null});e=f;e===z&&(e=D,f=sa(),f!==z?(f=da(),f!==z?(f=na(),f!==z?(f=da(),f!==z?(f=L(),f!==z?(g=da(),g!==z?(g=ia(),g!==z?(g=
da(),g!==z?(g=H(),g!==z?(h=da(),h!==z?(h=ya(),h!==z?e=f=Xb(f,g):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=sa(),f!==z?(f=da(),f!==z?(f=na(),f!==z?(f=da(),f!==z?(f=L(),f!==z?(g=da(),g!==z?(g=ya(),g!==z?e=f={type:"interval-period",period:"second",precision:f,secondary:null}:(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z)):(D=e,e=z),e===z&&(e=D,f=sa(),f!==z&&(f={type:"interval-period",period:"second",
precision:null,secondary:null}),e=f)));e!==z?a=c={type:"interval-qualifier",start:c,end:e}:(D=a,a=z)}else D=a,a=z;else D=a,a=z;else D=a,a=z;else D=a,a=z;a===z&&(a=D,e=K(),e!==z?(c=da(),c!==z?(c=na(),c!==z?(c=da(),c!==z?(c=H(),c!==z?(f=da(),f!==z?(f=ya(),f!==z?a=e={type:"interval-period",period:e.value,precision:c,secondary:null}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z),a===z&&(a=D,e=K(),e!==z&&(e=Pb(e)),a=e,a===z&&(a=D,e=sa(),e!==z?(c=da(),c!==z?(c=na(),c!==z?(c=
da(),c!==z?(c=L(),c!==z?(f=da(),f!==z?(f=ia(),f!==z?(e=da(),e!==z?(e=H(),e!==z?(f=da(),f!==z?(f=ya(),f!==z?a=e=Xb(c,e):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z),a===z&&(a=D,e=sa(),e!==z?(c=da(),c!==z?(c=na(),c!==z?(c=da(),c!==z?(c=H(),c!==z?(f=da(),f!==z?(f=ya(),f!==z?a=e={type:"interval-period",period:"second",precision:c,secondary:null}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z),a===z&&
(a=D,e=sa(),e!==z&&(e={type:"interval-period",period:"second",precision:null,secondary:null}),a=e)))));return a}function K(){var a;a=D;a=ma();a!==z&&(a={type:"string",value:"day"});a===z&&(a=D,a=ta(),a!==z&&(a={type:"string",value:"hour"}),a===z&&(a=D,a=ua(),a!==z&&(a={type:"string",value:"minute"}),a===z&&(a=D,a=la(),a!==z&&(a={type:"string",value:"month"}),a===z&&(a=D,a=ja(),a!==z&&(a={type:"string",value:"year"})))));return a}function H(){var a;a=Z();a!==z&&(a=parseFloat(a));return a}function L(){var a;
a=Z();a!==z&&(a=parseFloat(a));return a}function P(){var a;a=S();a===z&&(a=G());return a}function S(){var a,c,e;a=D;39===b.charCodeAt(D)?(c=yb,D++):(c=z,0===fa&&d(Ib));c===z&&(b.substr(D,2)===Jb?(c=Jb,D+=2):(c=z,0===fa&&d(Kb)));if(c!==z){c=[];e=D;b.substr(D,2)===gc?(e=gc,D+=2):(e=z,0===fa&&d(hc));e!==z&&(e="'");e===z&&(Yb.test(b.charAt(D))?(e=b.charAt(D),D++):(e=z,0===fa&&d(M)));for(;e!==z;)c.push(e),e=D,b.substr(D,2)===gc?(e=gc,D+=2):(e=z,0===fa&&d(hc)),e!==z&&(e="'"),e===z&&(Yb.test(b.charAt(D))?
(e=b.charAt(D),D++):(e=z,0===fa&&d(M)));c!==z?(39===b.charCodeAt(D)?(e=yb,D++):(e=z,0===fa&&d(Ib)),e!==z?a=c={type:"string",value:c.join("")}:(D=a,a=z)):(D=a,a=z)}else D=a,a=z;return a}function R(){var a,b,d;a=D;b=oa();b!==z?(b=da(),b!==z?(b=c(),b!==z?(d=da(),d!==z?(d=pa(),d!==z?(d=da(),d!==z?(d=c(),d!==z?a=b={type:"when_clause",operand:b,value:d}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z);return a}function O(){var a,b,d;a=D;b=oa();b!==z?(b=da(),b!==z?(b=c(),b!==z?
(d=da(),d!==z?(d=pa(),d!==z?(d=da(),d!==z?(d=c(),d!==z?a=b={type:"when_clause",operand:b,value:d}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z)):(D=a,a=z);return a}function Q(){var a,e;a=D;var f,g;e=D;b.substr(D,4).toLowerCase()===ld?(f=b.substr(D,4),D+=4):(f=z,0===fa&&d(Zb));f!==z?(f=D,fa++,g=C(),fa--,g===z?f=void 0:(D=f,f=z),f!==z?e="ELSE":(D=e,e=z)):(D=e,e=z);e!==z?(e=da(),e!==z?(e=c(),e!==z?a={type:"else_clause",value:e}:(D=a,a=z)):(D=a,a=z)):(D=a,a=z);return a}function T(){var a,
c,e;a=Z();a===z&&(a=D,45===b.charCodeAt(D)?(c=Ia,D++):(c=z,0===fa&&d(gb)),c===z&&(43===b.charCodeAt(D)?(c=lc,D++):(c=z,0===fa&&d(Ba))),c!==z?(e=Z(),e!==z?a=c=c[0]+e:(D=a,a=z)):(D=a,a=z));return a}function Y(){var a,c;a=D;46===b.charCodeAt(D)?(c=wa,D++):(c=z,0===fa&&d(Lb));c!==z?(c=Z(),c===z&&(c=null),c!==z?a="."+(null!=c?c:""):(D=a,a=z)):(D=a,a=z);return a}function N(){var a,c,e;c=a=D;ga.test(b.charAt(D))?(e=b.charAt(D),D++):(e=z,0===fa&&d(cb));e!==z?(rc.test(b.charAt(D))?(e=b.charAt(D),D++):(e=z,
0===fa&&d(sc)),e===z&&(e=null),e!==z?c="e"+(null===e?"":e):(D=c,c=z)):(D=c,c=z);c!==z?(e=Z(),e!==z?a=c+e:(D=a,a=z)):(D=a,a=z);return a}function Z(){var a,b;a=[];b=W();if(b!==z)for(;b!==z;)a.push(b),b=W();else a=z;a!==z&&(a=a.join(""));return a}function W(){var a;db.test(b.charAt(D))?(a=b.charAt(D),D++):(a=z,0===fa&&d(zb));return a}function aa(){var a,c,e;a=D;b.substr(D,2).toLowerCase()===Tb?(c=b.substr(D,2),D+=2):(c=z,0===fa&&d(Kc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="IN":
(D=a,a=z)):(D=a,a=z);return a}function V(){var a,c,e;a=D;b.substr(D,2).toLowerCase()===Mb?(c=b.substr(D,2),D+=2):(c=z,0===fa&&d(tc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="IS":(D=a,a=z)):(D=a,a=z);return a}function F(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===Bc?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(uc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="LIKE":(D=a,a=z)):(D=a,a=z);return a}function ca(){var a,c,e;a=D;b.substr(D,3).toLowerCase()===Lc?(c=b.substr(D,
3),D+=3):(c=z,0===fa&&d(Db));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="NOT":(D=a,a=z)):(D=a,a=z);return a}function U(){var a,c,e;a=D;b.substr(D,3).toLowerCase()===Mc?(c=b.substr(D,3),D+=3):(c=z,0===fa&&d(vc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="AND":(D=a,a=z)):(D=a,a=z);return a}function ea(){var a,c,e;a=D;b.substr(D,2).toLowerCase()===ic?(c=b.substr(D,2),D+=2):(c=z,0===fa&&d(wc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="OR":(D=a,a=z)):
(D=a,a=z);return a}function ha(){var a,c,e;a=D;b.substr(D,7).toLowerCase()===Vc?(c=b.substr(D,7),D+=7):(c=z,0===fa&&d(Nc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="BETWEEN":(D=a,a=z)):(D=a,a=z);return a}function ka(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===$b?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(Fc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="FROM":(D=a,a=z)):(D=a,a=z);return a}function ba(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===xc?(c=b.substr(D,4),
D+=4):(c=z,0===fa&&d(Wc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="TRIM":(D=a,a=z)):(D=a,a=z);return a}function qa(){var a,c,e;a=D;b.substr(D,8).toLowerCase()===Ya?(c=b.substr(D,8),D+=8):(c=z,0===fa&&d(pb));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="INTERVAL":(D=a,a=z)):(D=a,a=z);return a}function ja(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===ib?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(md));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="YEAR":(D=
a,a=z)):(D=a,a=z);return a}function la(){var a,c,e;a=D;b.substr(D,5).toLowerCase()===La?(c=b.substr(D,5),D+=5):(c=z,0===fa&&d(qb));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="MONTH":(D=a,a=z)):(D=a,a=z);return a}function ma(){var a,c,e;a=D;b.substr(D,3).toLowerCase()===rb?(c=b.substr(D,3),D+=3):(c=z,0===fa&&d(Xc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="DAY":(D=a,a=z)):(D=a,a=z);return a}function ta(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===nd?(c=b.substr(D,
4),D+=4):(c=z,0===fa&&d(od));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="HOUR":(D=a,a=z)):(D=a,a=z);return a}function ua(){var a,c,e;a=D;b.substr(D,6).toLowerCase()===Yc?(c=b.substr(D,6),D+=6):(c=z,0===fa&&d(Oc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="MINUTE":(D=a,a=z)):(D=a,a=z);return a}function sa(){var a,c,e;a=D;b.substr(D,6).toLowerCase()===dd?(c=b.substr(D,6),D+=6):(c=z,0===fa&&d(Gc));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="SECOND":
(D=a,a=z)):(D=a,a=z);return a}function xa(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===Zc?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(pd));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="CASE":(D=a,a=z)):(D=a,a=z);return a}function ra(){var a,c,e;a=D;b.substr(D,3).toLowerCase()===Qb?(c=b.substr(D,3),D+=3):(c=z,0===fa&&d(Eb));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="END":(D=a,a=z)):(D=a,a=z);return a}function oa(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===ac?(c=b.substr(D,
4),D+=4):(c=z,0===fa&&d($c));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="WHEN":(D=a,a=z)):(D=a,a=z);return a}function pa(){var a,c,e;a=D;b.substr(D,4).toLowerCase()===bc?(c=b.substr(D,4),D+=4):(c=z,0===fa&&d(eb));c!==z?(c=D,fa++,e=C(),fa--,e===z?c=void 0:(D=c,c=z),c!==z?a="THEN":(D=a,a=z)):(D=a,a=z);return a}function ia(){var a;44===b.charCodeAt(D)?(a=yc,D++):(a=z,0===fa&&d(zc));return a}function na(){var a;40===b.charCodeAt(D)?(a=qd,D++):(a=z,0===fa&&d(jc));return a}function ya(){var a;
41===b.charCodeAt(D)?(a=rd,D++):(a=z,0===fa&&d(Ra));return a}function da(){var a,b;a=[];for(b=Oa();b!==z;)a.push(b),b=Oa();return a}function Oa(){var a;cc.test(b.charAt(D))?(a=b.charAt(D),D++):(a=z,0===fa&&d(Hc));return a}function Ja(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function Ma(a,b){for(var c=0;c<b.length;c++)a=Ja(b[c][1],a,b[c][3]);return a}l=void 0!==l?l:{};var z={},tb={start:k},Ca=k,Wa="!",jb=f("!",!1),va="\x3d",bb=f("\x3d",!1),Na="\x3e\x3d",
lb=f("\x3e\x3d",!1),kb="\x3e",Xa=f("\x3e",!1),Sa="\x3c\x3d",Va=f("\x3c\x3d",!1),ub="\x3c\x3e",sb=f("\x3c\x3e",!1),Rb="\x3c",Gb=f("\x3c",!1),Ab="!\x3d",Da=f("!\x3d",!1),lc="+",Ba=f("+",!1),Ia="-",gb=f("-",!1),Pa="*",Nb=f("*",!1),Ob="/",Ub=f("/",!1),Wb=/^[A-Za-z_\x80-\uFFFF]/,fc=h([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Cb=/^[A-Za-z0-9_]/,Qa=h([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),xb=/^[A-Za-z0-9_.\x80-\uFFFF]/,ab=h([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
Ua="@",Sb=f("@",!1),Pb=function(a){return{type:"interval-period",period:a.value,precision:null,secondary:null}},Xb=function(a,b){return{type:"interval-period",period:"second",precision:a,secondary:b}},yb="'",Ib=f("'",!1),Jb="N'",Kb=f("N'",!1),gc="''",hc=f("''",!1),Yb=/^[^']/,M=h(["'"],!0,!1),wa=".",Lb=f(".",!1),db=/^[0-9]/,zb=h([["0","9"]],!1,!1),ga=/^[eE]/,cb=h(["e","E"],!1,!1),rc=/^[+\-]/,sc=h(["+","-"],!1,!1),Cc="null",wd=f("NULL",!0),dc="true",Pc=f("TRUE",!0),gd="false",hd=f("FALSE",!0),Tb="in",
Kc=f("IN",!0),Mb="is",tc=f("IS",!0),Bc="like",uc=f("LIKE",!0),kc="escape",Ac=f("ESCAPE",!0),Lc="not",Db=f("NOT",!0),Mc="and",vc=f("AND",!0),ic="or",wc=f("OR",!0),Vc="between",Nc=f("BETWEEN",!0),$b="from",Fc=f("FROM",!0),jd="for",Bb=f("FOR",!0),Vb="substring",ec=f("SUBSTRING",!0),mc="extract",Qc=f("EXTRACT",!0),xc="trim",Wc=f("TRIM",!0),zd="position",Ad=f("POSITION",!0),Ic="timestamp",id=f("TIMESTAMP",!0),xd="date",yd=f("DATE",!0),Ec="leading",X=f("LEADING",!0),Jc="trailing",Ka=f("TRAILING",!0),Aa=
"both",Fa=f("BOTH",!0),Ga="to",kd=f("TO",!0),Ya="interval",pb=f("INTERVAL",!0),ib="year",md=f("YEAR",!0),La="month",qb=f("MONTH",!0),rb="day",Xc=f("DAY",!0),nd="hour",od=f("HOUR",!0),Yc="minute",Oc=f("MINUTE",!0),dd="second",Gc=f("SECOND",!0),Zc="case",pd=f("CASE",!0),Qb="end",Eb=f("END",!0),ac="when",$c=f("WHEN",!0),bc="then",eb=f("THEN",!0),ld="else",Zb=f("ELSE",!0),yc=",",zc=f(",",!1),qd="(",jc=f("(",!1),rd=")",Ra=f(")",!1),cc=/^[ \t\n\r]/,Hc=h([" ","\t","\n","\r"],!1,!1),ad="`",Rc=f("`",!1),bd=
/^[^`]/,Sc=h(["`"],!0,!1),D=0,Za=[{line:1,column:1}],fb=0,nb=[],fa=0,Fb;if("startRule"in l){if(!(l.startRule in tb))throw Error("Can't start parsing from rule \""+l.startRule+'".');Ca=tb[l.startRule]}Fb=Ca();if(Fb!==z&&D===b.length)return Fb;Fb!==z&&D<b.length&&d({type:"end"});throw function(a,b,c){return new q(q.buildMessage(a,b),a,b,c)}(nb,fb<b.length?b.charAt(fb):null,fb<b.length?e(fb,fb+1):e(fb,fb));}}})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(q,b,l,f,h,a,e,d,k){function n(a,b){var d;if(!b)return null;if("x"in b){var e={x:0,y:0};a=a(b.x,b.y,p);e.x=a[0];e.y=a[1];null!=b.z&&(e.z=b.z);null!=b.m&&(e.m=b.m);return e}if("xmin"in b)return e={xmin:0,ymin:0,xmax:0,ymax:0},d=a(b.xmin,b.ymin,p),e.xmin=d[0],e.ymin=d[1],a=a(b.xmax,b.ymax,p),e.xmax=a[0],e.ymax=a[1],b.hasZ&&(e.zmin=b.zmin,e.zmax=b.zmax,e.hasZ=!0),b.hasM&&(e.mmin=b.mmin,e.mmax=b.mmax,e.hasM=!0),e;if("rings"in b)return{rings:c(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:c(b.paths,
a),hasM:b.hasM,hasZ:b.hasZ};if("points"in b)return{points:g(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function c(a,b){for(var c=[],d=0;d<a.length;d++)c.push(g(a[d],b));return c}function g(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d],f=b(e[0],e[1],[0,0]);c.push(f);2<e.length&&f.push(e[2]);3<e.length&&f.push(e[3])}return c}function r(a,b){return!d.isValid(a)||!d.isValid(b)||d.equals(a,b)||k.canProject(a,b)?!1:!0}Object.defineProperty(b,"__esModule",{value:!0});var p=[0,0];b.doesBrowserSupportProjection=
function(a,b){return r(a,b)?e.isSupported():!0};b.checkProjectionSupport=function(a,b){return f(this,void 0,void 0,function(){var c,d,f;return l(this,function(g){if(!b)return[2];if(Array.isArray(a)){c=0;for(d=a;c<d.length;c++)if(f=d[c],r(f.geometry&&f.geometry.spatialReference,b)){if(e.isSupported())return[2,e.load()];throw new h("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});}return[2]}if(!r(a,b))return[2];if(e.isSupported())return[2,e.load()];
throw new h("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:b});})})};var u=n.bind(null,k.lngLatToXY),t=n.bind(null,k.xyToLngLat);b.project=function(a,b,c){if(!a)return a;c||(c=b,b=a.spatialReference);return d.isValid(b)&&d.isValid(c)&&!d.equals(b,c)?k.canProject(b,c)?d.isWebMercator(c)?u(a):t(a):e.projectMany([a],b,c,null,!0)[0]:a};var x=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=
function(b,c,e){return f(this,void 0,void 0,function(){var f,g=this;return l(this,function(h){b&&b.length&&c&&e&&!d.equals(c,e)||a.resolve(b);f={geometries:b,inSpatialReference:c,outSpatialReference:e,resolve:null};this._jobs.push(f);return[2,a.create(function(a){f.resolve=a;null===g._timer&&(g._timer=setTimeout(g._process,10))},function(){var a=g._jobs.indexOf(f);-1<a&&g._jobs.splice(a,1)})]})})};b.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=
a.inSpatialReference,f=a.outSpatialReference,a=a.resolve;k.canProject(c,f)?d.isWebMercator(f)?a(b.map(u)):a(b.map(t)):a(e.projectMany(b,c,f,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());b.projectMany=function(a,b,c){return f(this,void 0,void 0,function(){return l(this,function(d){return[2,x.push(a,b,c)]})})}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),
function(q,b,l,f,h,a){function e(b,e,f,l,n){void 0===l&&(l=null);void 0===n&&(n=!1);if(null===l){var g=a.cacheKey(e,f);void 0!==c[g]?l=c[g]:(l=d(e,f,null),null===l&&(l=new a),c[g]=l)}return k._project(b,e,f instanceof h||!1===n?f:new h(f),l,n)}function d(b,c,d){void 0===d&&(d=null);b=k._getTransformation(b,c,d);return null!==b?a.fromGE(b):null}Object.defineProperty(b,"__esModule",{value:!0});var k=null;b.isLoaded=function(){return!!k&&f.isLoaded()};b.isSupported=function(){return f.isSupported()};
var n=null;b.load=function(){return n?n:n=l.create(function(a,b){var c=f.load();q(["./geometryEngine"],function(d){k=d;c.then(function(){k._enableProjection(f);a()},function(a){b(a)})})})};b.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:e(a,a[0].spatialReference,b,c):e([a],a.spatialReference,b,c)[0]};var c={};b.projectMany=e;b.getTransformation=d;b.getTransformations=function(b,c,d){void 0===d&&(d=null);b=k._getTransformationBySuitability(b,c,d);if(null!==
b){c=[];for(d=0;d<b.length;d++)c.push(a.fromGE(b[d]));return c}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(q,b,l,f,h){function a(a){function c(a,b,c){a[b]=c(a[b])}b._pe=a;g.init();r.init();p.init();u.init();t.init();b.PeGCSExtent=function(a){function c(){return null!==a&&a.apply(this,arguments)||this}l(c,a);c.prototype.destroy=function(){b._pe.destroy(this)};return c}(b._pe.PeGCSExtent);for(var d=
0,e=[b._pe.PeDatum,b._pe.PeGeogcs,b._pe.PeGeogtran,b._pe.PeObject,b._pe.PeParameter,b._pe.PePrimem,b._pe.PeProjcs,b._pe.PeSpheroid,b._pe.PeUnit];d<e.length;d++)a=e[d],c(a.prototype,"getName",function(a){return function(){return a.call(this,Array(g.PE_NAME_MAX))}});d=0;for(e=[b._pe.PeGeogtran,b._pe.PeProjcs];d<e.length;d++)a=e[d],c(a.prototype,"getParameters",function(a){return function(){for(var c=Array(g.PE_PARM_MAX),d=a.call(this),e=0;e<c.length;e++){var f=b._pe.getValue(d,"*");c[e]=f?b._pe.wrapPointer(f,
b._pe.PeParameter):null;d+=Int32Array.BYTES_PER_ELEMENT}return c}});c(b._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],d=a.call(this);n(c,b,d);return c}});c(b._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(a){var c=b._pe._pe_getPeGTlistExtendedGTsSize();return function(){var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=[e],f=this.getSteps();if(1<f)for(var e=b._pe.getPointer(e),g=1;g<f;g++)d.push(b._pe.wrapPointer(e+
c*g,b._pe.PeGTlistExtendedGTs))}return d}});var f=b._pe._pe_getPeHorizonSize();a=function(a){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(a))return c.get(a);var d=null,e=a.call(this);if(!b._pe.compare(e,b._pe.NULL)){var d=[e],g=e.getNump();if(1<g)for(var e=b._pe.getPointer(e),h=1;h<g;h++)d.push(b._pe.wrapPointer(e+f*h,b._pe.PeHorizon))}c.set(a,d);return d}};c(b._pe.PeProjcs.prototype,"horizonGcsGenerate",a);c(b._pe.PeProjcs.prototype,"horizonPcsGenerate",a);b._pe.PeObject.prototype.toString=
function(a){void 0===a&&(a=g.PE_STR_OPTS_NONE);b._pe.ensureCache.prepare();var c=b._pe.getPointer(this),d=b._pe.ensureInt8(Array(g.PE_BUFFER_MAX));return b._pe.UTF8ToString(b._pe._pe_object_to_string_ext(c,a,d))}}function e(a){if(a){var c=b._pe.getClass(a);c&&(c=b._pe.getCache(c))&&(a=b._pe.getPointer(a))&&delete c[a]}}function d(a,c){var d=[];c=Array(c);for(var e=0;e<a;e++)d.push(b._pe.ensureInt8(c));return d}function k(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):
b=a;return b}function n(a,c,d,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)a[e]=b._pe.getValue(d+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var f=0===a.length;for(e=0;e<c;e++)f&&(a[e]=Array(2)),a[e][0]=b._pe.getValue(d,"double"),a[e][1]=b._pe.getValue(d+Float64Array.BYTES_PER_ELEMENT,"double"),d+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(b,"__esModule",{value:!0});var c;b._pe=null;b.isLoaded=function(){return!!b._pe};b.isSupported=function(){return!!f("esri-wasm")};b.load=function(){return c?
c:c=h.create(function(b,c){q(["./support/pe-wasm"],function(d){d({locateFile:function(a){return q.toUrl("./support/"+a)},onAbort:function(a){c(Error(a))}}).then(function(c){a(c);b()})})})};(function(a){function c(a,c,d){b._pe.ensureCache.prepare();var e=k(d),f=d===e,e=b._pe.ensureFloat64(e);(a=b._pe._pe_geog_to_proj(b._pe.getPointer(a),c,e))&&n(d,c,e,f);return a}function d(a,b,c){return e(a,b,c,0)}function e(a,c,d,e){b._pe.ensureCache.prepare();var f=k(d),g=d===f,f=b._pe.ensureFloat64(f);(a=b._pe._pe_proj_to_geog_center(b._pe.getPointer(a),
c,f,e))&&n(d,c,f,g);return a}a.geogToProj=c;a.projGeog=function(a,b,e,f){switch(f){case g.PE_TRANSFORM_P_TO_G:return d(a,b,e);case g.PE_TRANSFORM_G_TO_P:return c(a,b,e)}return 0};a.projToGeog=d;a.projToGeogCenter=e})(b.PeCSTransformations||(b.PeCSTransformations={}));var g;(function(a){a.init=function(){a.PE_BUFFER_MAX=b._pe.PeDefs.prototype.PE_BUFFER_MAX;a.PE_NAME_MAX=b._pe.PeDefs.prototype.PE_NAME_MAX;a.PE_MGRS_MAX=b._pe.PeDefs.prototype.PE_MGRS_MAX;a.PE_USNG_MAX=b._pe.PeDefs.prototype.PE_USNG_MAX;
a.PE_DD_MAX=b._pe.PeDefs.prototype.PE_DD_MAX;a.PE_DDM_MAX=b._pe.PeDefs.prototype.PE_DDM_MAX;a.PE_DMS_MAX=b._pe.PeDefs.prototype.PE_DMS_MAX;a.PE_UTM_MAX=b._pe.PeDefs.prototype.PE_UTM_MAX;a.PE_PARM_MAX=b._pe.PeDefs.prototype.PE_PARM_MAX;a.PE_TYPE_NONE=b._pe.PeDefs.prototype.PE_TYPE_NONE;a.PE_TYPE_GEOGCS=b._pe.PeDefs.prototype.PE_TYPE_GEOGCS;a.PE_TYPE_PROJCS=b._pe.PeDefs.prototype.PE_TYPE_PROJCS;a.PE_TYPE_GEOGTRAN=b._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;a.PE_TYPE_COORDSYS=b._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
a.PE_TYPE_UNIT=b._pe.PeDefs.prototype.PE_TYPE_UNIT;a.PE_STR_OPTS_NONE=b._pe.PeDefs.prototype.PE_STR_OPTS_NONE;a.PE_STR_AUTH_NONE=b._pe.PeDefs.prototype.PE_STR_AUTH_NONE;a.PE_STR_AUTH_TOP=b._pe.PeDefs.prototype.PE_STR_AUTH_TOP;a.PE_STR_NAME_CANON=b._pe.PeDefs.prototype.PE_STR_NAME_CANON;a.PE_PARM_X0=b._pe.PeDefs.prototype.PE_PARM_X0;a.PE_PARM_ND=b._pe.PeDefs.prototype.PE_PARM_ND;a.PE_TRANSFORM_1_TO_2=b._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;a.PE_TRANSFORM_2_TO_1=b._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
a.PE_TRANSFORM_P_TO_G=b._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;a.PE_TRANSFORM_G_TO_P=b._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;a.PE_HORIZON_RECT=b._pe.PeDefs.prototype.PE_HORIZON_RECT;a.PE_HORIZON_POLY=b._pe.PeDefs.prototype.PE_HORIZON_POLY;a.PE_HORIZON_LINE=b._pe.PeDefs.prototype.PE_HORIZON_LINE;a.PE_HORIZON_DELTA=b._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(g=b.PeDefs||(b.PeDefs={}));(function(a){function c(a,c){var f=null,g=e[a];g||(g={},e[a]=g);g.hasOwnProperty(String(c))?f=g[c]:(a=b._pe.PeFactory.prototype.factoryByType(a,
c),b._pe.compare(a,b._pe.NULL)||(f=a,g[c]=f));return f=d(f)}function d(a){if(a){var c=a.getType();switch(c){case g.PE_TYPE_GEOGCS:a=b._pe.castObject(a,b._pe.PeGeogcs);break;case g.PE_TYPE_PROJCS:a=b._pe.castObject(a,b._pe.PeProjcs);break;case g.PE_TYPE_GEOGTRAN:a=b._pe.castObject(a,b._pe.PeGeogtran);break;default:c&g.PE_TYPE_UNIT&&(a=b._pe.castObject(a,b._pe.PeUnit))}}return a}var e={},f={};a.initialize=function(){b._pe.PeFactory.prototype.initialize(null)};a.coordsys=function(a){return c(g.PE_TYPE_COORDSYS,
a)};a.factoryByType=c;a.fromString=function(a,c){var e=null,g=f[a];g||(g={},f[a]=g);g.hasOwnProperty(c)?e=g[c]:(a=b._pe.PeFactory.prototype.fromString(a,c),b._pe.compare(a,b._pe.NULL)||(e=a,g[c]=e));return e=d(e)};a.geogcs=function(a){return c(g.PE_TYPE_GEOGCS,a)};a.geogtran=function(a){return c(g.PE_TYPE_GEOGTRAN,a)};a.getCode=function(a){return b._pe.PeFactory.prototype.getCode(a)};a.projcs=function(a){return c(g.PE_TYPE_PROJCS,a)};a.unit=function(a){return c(g.PE_TYPE_UNIT,a)}})(b.PeFactory||(b.PeFactory=
{}));b.PeGCSExtent=null;var r;(function(a){var c;a.init=function(){a.PE_GTLIST_OPTS_COMMON=b._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=b._pe._pe_getPeGTlistExtendedEntrySize()};a.getGTlist=function(a,d,e,f,g,h){var k=null,m=new b._pe.PeInteger(h);try{var l=b._pe.PeGTlistExtended.prototype.getGTlist(a,d,e,f,g,m);if(h=m.val)if(k=[l],1<h){var n=b._pe.getPointer(l);for(a=1;a<h;a++)k.push(b._pe.wrapPointer(n+c*a,b._pe.PeGTlistExtendedEntry))}}finally{b._pe.destroy(m)}return k}})(r=b.PeGTlistExtended||
(b.PeGTlistExtended={}));(function(a){a.destroy=function(a){if(a&&a.length){for(var c=0;c<a.length;c++){var d=a[c];e(d);d.getEntries().forEach(function(a){e(a);a=a.getGeogtran();e(a);a.getParameters().forEach(e);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){e(a);var b=a.getDatum();e(b);e(b.getSpheroid());e(a.getPrimem());e(a.getUnit())})})}b._pe.PeGTlistExtendedEntry.prototype.Delete(a[0])}}})(b.PeGTlistExtendedEntry||(b.PeGTlistExtendedEntry={}));(function(a){a.geogToGeog=function(a,c,d,e,
f){b._pe.ensureCache.prepare();var g=k(d),h=d===g,g=b._pe.ensureFloat64(g),m=0;e&&(m=b._pe.ensureFloat64(e));(a=b._pe._pe_geog_to_geog(b._pe.getPointer(a),c,g,m,f))&&n(d,c,g,h);return a}})(b.PeGTTransformations||(b.PeGTTransformations={}));(function(a){function c(a,c,e,f,h,l){b._pe.ensureCache.prepare();var m,n;switch(a){case "dd":m=b._pe._pe_geog_to_dd;n=g.PE_DD_MAX;break;case "ddm":m=b._pe._pe_geog_to_ddm;n=g.PE_DDM_MAX;break;case "dms":m=b._pe._pe_geog_to_dms,n=g.PE_DMS_MAX}a=0;c&&(a=b._pe.getPointer(c));
c=k(f);c=b._pe.ensureFloat64(c);n=d(e,n);f=b._pe.ensureInt32(n);if(h=m(a,e,c,h,f))for(m=0;m<e;m++)l[m]=b._pe.UTF8ToString(n[m]);return h}function e(a,c,d,e,f){b._pe.ensureCache.prepare();var g;switch(a){case "dd":g=b._pe._pe_dd_to_geog;break;case "ddm":g=b._pe._pe_ddm_to_geog;break;case "dms":g=b._pe._pe_dms_to_geog}a=0;c&&(a=b._pe.getPointer(c));c=e.map(function(a){return b._pe.ensureString(a)});e=b._pe.ensureInt32(c);c=b._pe.ensureFloat64(Array(2*d));(g=g(a,d,e,c))&&n(f,d,c);return g}a.geog_to_dms=
function(a,b,d,e,f){return c("dms",a,b,d,e,f)};a.dms_to_geog=function(a,b,c,d){return e("dms",a,b,c,d)};a.geog_to_ddm=function(a,b,d,e,f){return c("ddm",a,b,d,e,f)};a.ddm_to_geog=function(a,b,c,d){return e("ddm",a,b,c,d)};a.geog_to_dd=function(a,b,d,e,f){return c("dd",a,b,d,e,f)};a.dd_to_geog=function(a,b,c,d){return e("dd",a,b,c,d)}})(b.PeNotationDms||(b.PeNotationDms={}));var p;(function(a){a.init=function(){a.PE_MGRS_STYLE_NEW=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;a.PE_MGRS_STYLE_OLD=
b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;a.PE_MGRS_STYLE_AUTO=b._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;a.PE_MGRS_180_ZONE_1_PLUS=b._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;a.PE_MGRS_ADD_SPACES=b._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};a.geog_to_mgrs_extended=function(a,c,e,f,h,l,n){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));a=k(e);e=b._pe.ensureFloat64(a);a=d(c,g.PE_MGRS_MAX);var p=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_mgrs_extended(m,
c,e,f,h,l,p))for(h=0;h<c;h++)n[h]=b._pe.UTF8ToString(a[h]);return f};a.mgrs_to_geog_extended=function(a,c,d,e,f){b._pe.ensureCache.prepare();var g=0;a&&(g=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(e=b._pe._pe_mgrs_to_geog_extended(g,c,d,e,a))&&n(f,c,a);return e}})(p=b.PeNotationMgrs||(b.PeNotationMgrs={}));(function(a){a.geog_to_usng=function(a,c,e,f,h,l,n){b._pe.ensureCache.prepare();var m=0;a&&(m=b._pe.getPointer(a));
a=k(e);e=b._pe.ensureFloat64(a);a=d(c,g.PE_MGRS_MAX);var p=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_usng(m,c,e,f,h,l,p))for(h=0;h<c;h++)n[h]=b._pe.UTF8ToString(a[h]);return f};a.usng_to_geog=function(a,c,d,e){b._pe.ensureCache.prepare();var f=0;a&&(f=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(f=b._pe._pe_usng_to_geog(f,c,d,a))&&n(e,c,a);return f}})(b.PeNotationUsng||(b.PeNotationUsng={}));var u;(function(a){a.init=
function(){a.PE_UTM_OPTS_NONE=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;a.PE_UTM_OPTS_ADD_SPACES=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;a.PE_UTM_OPTS_NS=b._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};a.geog_to_utm=function(a,c,e,f,h){b._pe.ensureCache.prepare();var l=0;a&&(l=b._pe.getPointer(a));a=k(e);e=b._pe.ensureFloat64(a);a=d(c,g.PE_UTM_MAX);var m=b._pe.ensureInt32(a);if(f=b._pe._pe_geog_to_utm(l,c,e,f,m))for(l=0;l<c;l++)h[l]=b._pe.UTF8ToString(a[l]);return f};a.utm_to_geog=
function(a,c,d,e,f){b._pe.ensureCache.prepare();var g=0;a&&(g=b._pe.getPointer(a));a=d.map(function(a){return b._pe.ensureString(a)});d=b._pe.ensureInt32(a);a=b._pe.ensureFloat64(Array(2*c));(e=b._pe._pe_utm_to_geog(g,c,d,e,a))&&n(f,c,a);return e}})(u=b.PeNotationUtm||(b.PeNotationUtm={}));var t;(function(a){var c=new Map;a.init=function(){a.PE_PCSINFO_OPTION_NONE=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;a.PE_PCSINFO_OPTION_DOMAIN=b._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;a.PE_POLE_OUTSIDE_BOUNDARY=
b._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;a.PE_POLE_POINT=b._pe.PePCSInfo.prototype.PE_POLE_POINT};a.generate=function(d,e){void 0===e&&(e=a.PE_PCSINFO_OPTION_DOMAIN);var f,g;c.has(d)&&(g=c.get(d),g[e]&&(f=g[e]));f||(f=b._pe.PePCSInfo.prototype.generate(d,e),g||(g=[],c.set(d,g)),g[e]=f);return f}})(t=b.PePCSInfo||(b.PePCSInfo={}));(function(a){a.version_string=function(){return b._pe.PeVersion.prototype.version_string()}})(b.PeVersion||(b.PeVersion={}));b._init=a})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(q,b,l){return function(){function b(b){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(b&&b.steps){var a=0;for(b=b.steps;a<b.length;a++){var e=b[a];e instanceof l?this.steps.push(e):this.steps.push(new l({wkid:e.wkid,wkt:e.wkt,isInverse:e.isInverse}))}}}b.cacheKey=function(b,a){return[void 0!==b.wkid&&null!==b.wkid?b.wkid.toString():"-1",void 0!==b.wkt&&null!==b.wkt?b.wkt.toString():"",void 0!==a.wkid&&null!==a.wkid?
a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():""].join()};b.fromGE=function(f){var a=new b,e="",d=0;for(f=f.steps;d<f.length;d++){var h=l.fromGE(f[d]);a.steps.push(h);e+=h.uid.toString()+","}a._cached_projection={};a._gtlistentry=null;a._chain=e;return a};b.prototype.getInverse=function(){var f=new b;f.steps=[];for(var a=this.steps.length-1;0<=a;a--)f.steps.push(this.steps[a].getInverse());return f};b.prototype.getGTListEntry=function(){for(var b="",a=0,e=this.steps;a<e.length;a++)b+=
e[a].uid.toString()+",";b!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=b);return this._gtlistentry};b.prototype.assignCachedGe=function(f,a,e){this._cached_projection[b.cacheKey(f,a)]=e};b.prototype.getCachedGeTransformation=function(f,a){for(var e="",d=0,h=this.steps;d<h.length;d++)e+=h[d].uid.toString()+",";e!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=e);f=this._cached_projection[b.cacheKey(f,a)];return void 0===f?null:f};return b}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(q,b){var l=0;return function(){function b(b){void 0===b&&(b=null);this.uid=l++;b?(this._wkt=void 0!==b.wkt?b.wkt:null,this._wkid=void 0!==b.wkid?b.wkid:-1,this._isInverse=void 0!==b.isInverse?!0===b.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}b.fromGE=function(f){var a=new b;a._wkt=f.wkt;a._wkid=f.wkid;a._isInverse=f.isInverse;return a};Object.defineProperty(b.prototype,"wkt",
{get:function(){return this._wkt},set:function(b){this._wkt=b;this.uid=l++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wkid",{get:function(){return this._wkid},set:function(b){this._wkid=b;this.uid=l++},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isInverse",{get:function(){return this._isInverse},set:function(b){this._isInverse=b;this.uid=l++},enumerable:!0,configurable:!0});b.prototype.getInverse=function(){var f=new b;f._wkt=this.wkt;f._wkid=this._wkid;
f._isInverse=!this.isInverse;return f};return b}()})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,
supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/iteratorUtils ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./AttributesBuilder ./attributeSupport ./projectionSupport ./timeSupport ./utils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c){this.items=a;this.queryGeometry=b;this.definitionExpression=c.definitionExpression;this.geometryType=c.geometryType;this.hasM=c.hasM;this.hasZ=c.hasZ;this.objectIdField=c.objectIdField;this.spatialReference=c.spatialReference;this.fieldsIndex=c.fieldsIndex;this.timeInfo=c.timeInfo;this.featureAdapter=c.featureAdapter}Object.defineProperty(b.prototype,"size",{get:function(){return this.items.length},
enumerable:!0,configurable:!0});b.prototype.createQueryResponse=function(a){var b;b=a.outStatistics?a.outStatistics.some(function(a){return"exceedslimit"===a.statisticType})?this._createExceedsLimitQueryResponse(a):this._createStatisticsQueryResponse(a):this._createFeatureQueryResponse(a);a.returnQueryGeometry&&(n.isValid(a.outSR)&&!n.equals(this.queryGeometry.spatialReference,a.outSR)?b.queryGeometry=t.cleanFromGeometryEngine(l({spatialReference:a.outSR},p.project(this.queryGeometry,this.queryGeometry.spatialReference,
a.outSR))):b.queryGeometry=t.cleanFromGeometryEngine(l({spatialReference:a.outSR},this.queryGeometry)));return b};b.prototype.executeAttributesQuery=function(a){var c=r.getWhereClause(a.where,this.fieldsIndex);if(!c)return d.resolve(this);if(c.isStandardized){for(var e=0,f=[],g=0,h=this.items;g<h.length;g++){var k=h[g];c.testFeature(k,this.featureAdapter)&&(f[e++]=k)}c=new b(f,this.queryGeometry,this);c.definitionExpression=a.where;return d.resolve(c)}return d.reject(new TypeError("Where clause is not standardized"))};
b.prototype.executeObjectIdsQuery=function(c){if(!c.objectIds||!c.objectIds.length)return d.resolve(this);var e=a.createSetFromValues(c.objectIds),f=this.featureAdapter.getObjectId;return d.resolve(new b(this.items.filter(function(a){return e.has(f(a))}),this.queryGeometry,this))};b.prototype.executeTimeQuery=function(a){a=u.getTimeOperator(this.timeInfo,a.timeExtent,this.featureAdapter);if(!e.isSome(a))return d.resolve(this);a=this.items.filter(a);return d.resolve(new b(a,this.queryGeometry,this))};
b.prototype.project=function(a){return h(this,void 0,void 0,function(){var d,e,g,h=this;return f(this,function(f){switch(f.label){case 0:if(!a||n.equals(this.spatialReference,a))return[2,this];d=this.featureAdapter;return[4,p.projectMany(this.items.map(function(a){return t.getGeometry(h,d.getGeometry(a))}),this.spatialReference,a)];case 1:return e=f.sent(),g=e.map(function(a,b){return d.cloneWithGeometry(h.items[b],c.convertFromGeometry(a,h.hasZ,h.hasM))}),[2,new b(g,this.queryGeometry,{definitionExpression:this.definitionExpression,
geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:a,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})]}})})};b.prototype._createFeatureQueryResponse=function(a){var b=this,c=this.items,d=this.geometryType,e=this.hasM,f=this.hasZ,g=this.objectIdField,h=this.spatialReference,l=a.outFields,n=a.outSR,p=a.quantizationParameters,q=a.resultRecordCount,r=a.resultOffset,u=a.returnZ,v=a.returnM,x=!1;null!=q&&
null!=r&&(q=r+q,x=c.length>q,c=c.slice(r,Math.min(c.length,q)));return{exceededTransferLimit:x,features:this._createFeatures(a,c),fields:l&&l.map(function(a){return b.fieldsIndex.get(a)}),geometryType:d,hasM:e&&v,hasZ:f&&u,objectIdFieldName:g,spatialReference:t.cleanFromGeometryEngine(n?n:h),transform:p&&k.toQuantizationTransform(p)||null}};b.prototype._createFeatures=function(a,b){var c=new g.default(a,this.featureAdapter,this.fieldsIndex),d=a.orderByFields,e=a.quantizationParameters,f=a.returnGeometry,
h=a.returnCentroid,l=a.maxAllowableOffset,n=a.returnZ;a=a.returnM;var p=this.hasZ&&(void 0===n?!1:n),q=this.hasM&&(void 0===a?!1:a),n=[];a=0;if(b.length&&d&&d.length){var d=d[0].split(" "),r=d[0],u=this.fieldsIndex.get(r),v="DESC"===d[1];b.sort(function(a,b){a=c.getFieldValue(a,r,u);b=c.getFieldValue(b,r,u);if("number"===typeof a&&"number"===typeof b)return v?b-a:a-b;if("string"===typeof a&&"string"===typeof b)return a=a.toUpperCase(),b=b.toUpperCase(),(v?a>b:a<b)?-1:(v?a<b:a>b)?1:0})}if(f||h)if(e=
k.toQuantizationTransform(e),f&&!h)for(h=0;h<b.length;h++)f=b[h],n[a++]={attributes:c.getAttributes(f),geometry:t.getGeometry(this,this.featureAdapter.getGeometry(f),l,e,p,q)};else if(!f&&h)for(l=0;l<b.length;l++)f=b[l],n[a++]={attributes:c.getAttributes(f),centroid:t.transformCentroid(this,this.featureAdapter.getCentroid(f,this),e)};else for(h=0;h<b.length;h++)f=b[h],n[a++]={attributes:c.getAttributes(f),centroid:t.transformCentroid(this,this.featureAdapter.getCentroid(f,this),e),geometry:t.getGeometry(this,
this.featureAdapter.getGeometry(f),l,e,p,q)};else for(l=0;l<b.length;l++)f=b[l],(p=c.getAttributes(f))&&(n[a++]={attributes:p});return n};b.prototype._createExceedsLimitQueryResponse=function(a){var b=!1,c=Number.POSITIVE_INFINITY,d=Number.POSITIVE_INFINITY,b=Number.POSITIVE_INFINITY,e=0;for(a=a.outStatistics;e<a.length;e++){var f=a[e];if("exceedslimit"===f.statisticType){c=null!=f.maxPointCount?f.maxPointCount:Number.POSITIVE_INFINITY;d=null!=f.maxRecordCount?f.maxRecordCount:Number.POSITIVE_INFINITY;
b=null!=f.maxVertexCount?f.maxVertexCount:Number.POSITIVE_INFINITY;break}}if("esriGeometryPoint"===this.geometryType)b=this.items.length>c;else if(this.items.length>d)b=!0;else var c=this.hasZ?this.hasM?4:3:this.hasM?3:2,g=this.featureAdapter,b=this.items.reduce(function(a,b){b=g.getGeometry(b);return a+(b&&b.coords.length||0)},0)/c>b;return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(b)}}]}};
b.prototype._createStatisticsQueryResponse=function(a){var b=new g.default(a,this.featureAdapter,this.fieldsIndex),c=a.outStatistics,d=[],e=[],f=a.groupByFieldsForStatistics;a=a.having;for(var h=f&&f.length,f=h&&f[0],k=this.fieldsIndex.get(f),l=!k,n={},p={},q={},r={attributes:{}},t=0;t<c.length;t++){var u=c[t],v=u.outStatisticFieldName,x=u.statisticType,u="exceedslimit"!==x?u.onStatisticField:void 0,O=this.fieldsIndex.get(u),Q=h&&(u===f||l)&&"count"===x;if(h){n[u]||(n[u]=this._calculateUniqueValues(b,
f,k));var T=n[u],Y;for(Y in T){var N=T[Y],Z=N.count,W=N.data,aa=N.items;if(!a||b.validateItems(aa,a)){var N=p[W]||{attributes:{}},V=null;Q?V=Z:(Z=this._calculateStatistics(aa,b,u,O),aa="var"===x?"variance":x,V=Z[aa]);N.attributes[v]=V;N.attributes[l?"EXPR_1":f]=W;p[W]=N}}}else q[u]||(q[u]=this._calculateStatistics(this.items,b,u,O)),Z=q[u],aa="var"===x?"variance":x,r.attributes[v]=Z[aa];e.push({name:v,alias:v,type:"esriFieldTypeDouble"})}if(h)for(var F in p)d.push(p[F]);else d.push(r);return{fields:e,
features:d}};b.prototype._calculateStatistics=function(a,b,c,d){for(var e=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,g=null,h=null,k=null,l=null,m=[],n=0,p=0;p<a.length;p++){var q=b.getFieldValue(a[p],c,d);"string"===typeof q?n++:null==q||isNaN(q)||(g+=q,e=Math.min(e,q),f=Math.max(f,q),m.push(q),n++)}if(n){h=g/n;for(b=a=0;b<m.length;b++)q=m[b],a+=Math.pow(q-h,2);l=1<n?a/(n-1):0;k=Math.sqrt(l)}else f=e=null;return{avg:h,count:n,max:f,min:e,stddev:k,sum:g,variance:l}};b.prototype._calculateUniqueValues=
function(a,b,c){for(var d={},e=0,f=this.items;e<f.length;e++){var g=f[e],h=a.getFieldValue(g,b,c);if(null==h||"string"===typeof h&&""===h.trim())h=null;null==d[h]?d[h]={count:1,data:h,items:[g]}:(d[h].count++,d[h].items.push(g))}return d};return b}();b.default=q})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["require","exports","../../../core/maybe","./attributeSupport"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,d){this._fieldDataCache=
new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=a.returnDistinctValues;this.fieldsIndex=d;this.featureAdapter=b;if((a=a.outFields)&&-1===a.indexOf("*")){this.outFields=a;for(var e=b=0;e<a.length;e++){var h=a[e],c=f.getExpressionFromFieldName(h),g=this.fieldsIndex.get(c),c=g?null:f.getWhereClause(c,d),g=g?g.name:f.getAliasFromFieldName(h)||"FIELD_EXP_"+b++;this._fieldDataCache.set(h,{alias:g,clause:c})}}}b.prototype.getAttributes=function(a){a=this._processAttributesForOutFields(a);
return this._processAttributesForDistinctValues(a)};b.prototype.getFieldValue=function(a,b,d){var e=d?d.name:b,h=null;this._fieldDataCache.has(e)?h=this._fieldDataCache.get(e).clause:d||(h=f.getWhereClause(b,this.fieldsIndex),this._fieldDataCache.set(e,{alias:e,clause:h}));return d?this.featureAdapter.getAttribute(a,e):h.calculateValue(a,this.featureAdapter)};b.prototype.validateItem=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:f.getWhereClause(b,this.fieldsIndex)});
return this._fieldDataCache.get(b).clause.testFeature(a,this.featureAdapter)};b.prototype.validateItems=function(a,b){this._fieldDataCache.has(b)||this._fieldDataCache.set(b,{alias:b,clause:f.getWhereClause(b,this.fieldsIndex)});return this._fieldDataCache.get(b).clause.testSet(a,this.featureAdapter)};b.prototype._processAttributesForOutFields=function(a){var b=this.outFields;if(!b||!b.length)return this.featureAdapter.getAttributes(a);for(var d={},f=0;f<b.length;f++){var h=this._fieldDataCache.get(b[f]),
c=h.alias,h=h.clause;d[c]=h?h.calculateValue(a,this.featureAdapter):this.featureAdapter.getAttribute(a,c)}return d};b.prototype._processAttributesForDistinctValues=function(a){if(l.isNone(a)||!this.returnDistinctValues)return a;var b=this.outFields,d=[];if(b)for(var f=0;f<b.length;f++){var h=this._fieldDataCache.get(b[f]).alias;d.push(a[h])}else for(h in a)d.push(a[h]);b=(b||["*"]).join(",")+"\x3d"+d.join(",");d=this._returnDistinctMap.get(b)||0;this._returnDistinctMap.set(b,++d);return 1<d?null:
a};return b}();b.default=q})},"esri/layers/graphics/data/timeSupport":function(){define(["require","exports"],function(q,b){function l(b,a,e,d,f){if(null!=d&&null!=f&&d===f)return function(f){return d>=b.getAttribute(f,a)&&d<=b.getAttribute(f,e)};if(null!=d&&null!=f)return function(h){var c=b.getAttribute(h,a);h=b.getAttribute(h,e);return!(c>f||h<d)};if(null!=d)return function(a){return!(b.getAttribute(a,e)<d)};if(null!=f)return function(d){return!(b.getAttribute(d,a)>f)}}function f(b,a,e,d){if(null!=
e&&null!=d&&e===d)return function(d){return b.getAttribute(d,a)===e};if(null!=e&&null!=d)return function(f){return b.getAttribute(f,a)>=e&&b.getAttribute(f,a)<=d};if(null!=e)return function(d){return b.getAttribute(d,a)>=e};if(null!=d)return function(e){return b.getAttribute(e,a)<=d}}Object.defineProperty(b,"__esModule",{value:!0});b.getTimeExtent=function(b,a){if(!b)return null;var e=a.featureAdapter,d=b.startTimeField,f=b.endTimeField,h=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(d&&
f)a.forEach(function(a){var b=e.getAttribute(a,d);a=e.getAttribute(a,f);null==b||isNaN(b)||(h=Math.min(h,b));null==a||isNaN(a)||(c=Math.max(c,a))});else{var g=d||f;a.forEach(function(a){a=e.getAttribute(a,g);null==a||isNaN(a)||(h=Math.min(h,a),c=Math.max(c,a))})}return{start:h,end:c}};b.getTimeOperator=function(b,a,e){if(!a||!b)return null;var d=b.startTimeField;b=b.endTimeField;if(!d&&!b)return null;var h=a.start;a=a.end;return null==h&&null==a?null:d&&b?l(e,d,b,h,a):f(e,d||b,h,a)}})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/jsonMap ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./spatialQuerySupport".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x){function v(a,b,c,d,e){void 0===d&&(d=a.hasZ);void 0===e&&(e=a.hasM);var f=a.hasZ&&d,g=a.hasM&&e;return c?(a=p.quantizeOptimizedGeometry(C,b,a.hasZ,a.hasM,"esriGeometryPoint",c,d,e),p.convertToPoint(a,f,g)):p.convertToPoint(b,f,g)}function y(d,e,g){return f(this,void 0,void 0,function(){var f,h,p,q,r,w;return l(this,function(l){switch(l.label){case 0:if(!d)return[2,null];f=d.where;d.where=f=f&&f.trim();if(!f||/^1 *= *1$/.test(f)||e&&e===f)d.where=null;return d.geometry?
[4,m(d)]:[2,d];case 1:return h=l.sent(),d.distance=0,d.units=null,"esriSpatialRelEnvelopeIntersects"===d.spatialRel&&(p=d.geometry.spatialReference,h=k.getGeometryExtent(h),h.spatialReference=p),d.geometry=h,[4,t.checkProjectionSupport(h.spatialReference,g)];case 2:return l.sent(),[4,c.normalizeCentralMeridian(n.fromJSON(h))];case 3:q=l.sent()[0];if(a.isNone(q))throw b.QUERY_ENGINE_EMPTY_RESULT;r=q.toJSON();return[4,t.project(r,r.spatialReference,g)];case 4:w=l.sent();if(!w)throw b.QUERY_ENGINE_EMPTY_RESULT;
w.spatialReference=g;d.geometry=w;return[2,d]}})})}function m(a){return f(this,void 0,void 0,function(){var b,c,f,h,k,m,n,p,q,r;return l(this,function(l){switch(l.label){case 0:b=a.geometry;c=a.distance;f=a.units;if(null==c)return[2,e.resolve(b)];h=b.spatialReference;k=f&&w.fromJSON(f)||d.getUnitString(h);m=h&&(g.isGeographic(h)||g.isWebMercator(h));if(!m)return[3,1];p=b;return[3,3];case 1:return[4,t.checkProjectionSupport(h,g.WGS84).then(function(){return t.project(b,g.WGS84)})];case 2:p=l.sent(),
l.label=3;case 3:return n=p,[4,x.getGeodesicBufferOperator()];case 4:return q=l.sent(),r=q(n,c,k),[2,r?r.toJSON():null]}})})}Object.defineProperty(b,"__esModule",{value:!0});var w=new h.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});b.QUERY_ENGINE_EMPTY_RESULT=Object.freeze({});var A=new u.default,B=new u.default,C=new u.default,E={esriGeometryPoint:p.convertToPoint,
esriGeometryPolyline:p.convertToPolyline,esriGeometryPolygon:p.convertToPolygon,esriGeometryMultipoint:p.convertToMultipoint};b.transformCentroid=v;b.getCentroid=function(a,b,c){if("esriGeometryPolygon"!==a.geometryType||!b||!b.centroid&&!b.geometry)return null;b.centroid||(b.centroid=r.getCentroidOptimizedGeometry(new u.default,b.geometry,a.hasZ,a.hasM));return v(a,b.centroid,c)};b.getGeometry=function(a,b,c,d,e,f){void 0===e&&(e=a.hasZ);void 0===f&&(f=a.hasM);var g=a.hasZ&&e,h=a.hasM&&f;b=b?"coords"in
b?b:b.geometry:null;if(!b)return null;if(c)return c=p.generalizeOptimizedGeometry(B,b,a.hasZ,a.hasM,a.geometryType,c,e,f),d&&(c=p.quantizeOptimizedGeometry(C,c,g,h,a.geometryType,d)),E[a.geometryType](c,g,h);if(d)return c=p.quantizeOptimizedGeometry(C,b,a.hasZ,a.hasM,a.geometryType,d,e,f),E[a.geometryType](c,g,h);p.removeZMValues(A,b,a.hasZ,a.hasM,e,f);return E[a.geometryType](A,g,h)};b.normalizeQuery=function(a,b,c){return f(this,void 0,void 0,function(){var d,e,f,g,h;return l(this,function(k){d=
a.outFields;e=a.orderByFields;f=a.groupByFieldsForStatistics;g=a.outStatistics;if(d)for(h=0;h<d.length;h++)d[h]=d[h].trim();if(e)for(h=0;h<e.length;h++)e[h]=e[h].trim();if(f)for(h=0;h<f.length;h++)f[h]=f[h].trim();if(g)for(h=0;h<g.length;h++)g[h].onStatisticField&&(g[h].onStatisticField=g[h].onStatisticField.trim());a.geometry&&!a.outSR&&(a.outSR=a.geometry.spatialReference);return[2,y(a,b,c)]})})};b.normalizeFilter=function(a,b,c){return f(this,void 0,void 0,function(){return l(this,function(d){return[2,
y(a,b,c)]})})};b.normalizeQueryLike=y;b.cleanFromGeometryEngine=function(a){return a&&G in a?JSON.parse(JSON.stringify(a,J)):a};var G="_geVersion",J=function(a,b){return a!==G?b:void 0}})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(){return a.create(function(a){return q(["../../../geometry/geometryEngine"],a)})}Object.defineProperty(b,"__esModule",{value:!0});var x={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",
esriSpatialRelRelation:null},v={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!1};b.importGeometryEngine=t;b.getGeodesicBufferOperator=function(){return t().then(function(a){return a.geodesicBuffer})};b.getSpatialQueryOperator=function(b,f,h){if(k.isPolygon(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b)){var l=g.convertFromPolygon(new r.default,f,!1,!1);return a.resolve(function(a){return c.polygonContainsPoint(l,!1,!1,a)})}if(k.isPolygon(f)&&"esriGeometryMultipoint"===h.geometryType){var m=
g.convertFromPolygon(new r.default,f,!1,!1);if("esriSpatialRelContains"===b)return a.resolve(function(a){return c.polygonContainsMultipoint(m,!1,!1,a,h.hasZ,h.hasM)})}if(k.isExtent(f)&&"esriGeometryPoint"===h.geometryType&&("esriSpatialRelIntersects"===b||"esriSpatialRelContains"===b))return a.resolve(function(a){return e.extentContainsPoint(f,u.getGeometry(h,a))});if(k.isExtent(f)&&"esriGeometryMultipoint"===h.geometryType&&"esriSpatialRelContains"===b)return a.resolve(function(a){return e.extentContainsMultipoint(f,
u.getGeometry(h,a))});if(k.isExtent(f)&&"esriSpatialRelIntersects"===b){var n=d.getExtentIntersector(h.geometryType);return a.resolve(function(a){return n(f,u.getGeometry(h,a))})}return t().then(function(a){var c=a[x[b]].bind(null,f);return function(a){return c(u.getGeometry(h,a))}})};b.checkSpatialQuerySupport=function(a,b,c){return f(this,void 0,void 0,function(){var d,e;return l(this,function(f){d=a.spatialRel;e=a.geometry;if(!e)return[2];if(!0!==v[d])throw new h("feature-store:unsupported-query",
"Unsupported query spatial relationship",{query:a});if(!n.isValid(e.spatialReference)||!n.isValid(c))return[2];if(!0!==y[k.getJsonType(e)])throw new h("feature-store:unsupported-query","Unsupported query geometry type",{query:a});if(!0!==m[b])throw new h("feature-store:unsupported-query","Unsupported layer geometry type",{query:a});return a.outSR?[2,p.checkProjectionSupport(a.geometry&&a.geometry.spatialReference,a.outSR)]:[2]})})};b.canQueryWithRBush=function(a){if(k.isExtent(a))return!0;if(k.isPolygon(a)){var b=
0;for(a=a.rings;b<a.length;b++){var c=a[b];if(5!==c.length||c[0][0]!==c[1][0]||c[0][0]!==c[4][0]||c[2][0]!==c[3][0]||c[0][1]!==c[3][1]||c[0][1]!==c[4][1]||c[1][1]!==c[2][1])return!1}return!0}return!1}})},"esri/layers/graphics/contains":function(){define(["require","exports"],function(q,b){function l(b,h,a,e,d){if(!b)return!1;h=h?a?4:3:a?3:2;a=b.coords;var f=!1,l=0,c=0;for(b=b.lengths;c<b.length;c++){for(var g=b[c],q=l,p=l,u=l+g*h;p<u;p+=h){q=p+h;q===u&&(q=l);var t=a[p],x=a[p+1],v=a[q],q=a[q+1];(x<
d&&q>=d||q<d&&x>=d)&&t+(d-x)/(q-x)*(v-t)<e&&(f=!f)}l+=g*h}return f}Object.defineProperty(b,"__esModule",{value:!0});b.polygonContainsPoint=function(b,h,a,e){return l(b,h,a,e.coords[0],e.coords[1])};b.polygonContainsMultipoint=function(b,h,a,e,d,k){d=d?k?4:3:k?3:2;k=e.coords;e=e.lengths;if(!e)return!1;for(var f=0,c=0;f<e.length;f++,c+=d)if(!l(b,h,a,k[c],k[c+1]))return!1;return!0};b.polygonContainsCoords=l})},"esri/layers/support/PromiseQueue":function(){define(["require","exports","../../core/promiseUtils"],
function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this._deferreds=[];this._values=[]}b.prototype.push=function(b){var a=this;return l.create(function(e,d){a._deferreds.push({resolve:e,reject:d});a._values.push(b)})};b.prototype.unshift=function(b){var a=this;return l.create(function(e,d){a._deferreds.unshift({resolve:e,reject:d});a._values.unshift(b)})};Object.defineProperty(b.prototype,"length",{get:function(){return this._deferreds.length},enumerable:!0,
configurable:!0});b.prototype.process=function(){if(0===this.length)return!1;this._deferreds.shift().resolve(this._values.shift());return!0};b.prototype.cancelAll=function(){for(var b=l.createAbortError(),a=0,e=this._deferreds;a<e.length;a++)e[a].reject(b);this._deferreds.length=0;this._values.length=0};return b}();b.PromiseQueue=q})},"esri/views/layers/support/FeatureFilter":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../TimeExtent ../../../core/iteratorUtils ../../../core/jsonMap ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../geometry/support/jsonUtils ../../../tasks/support/Query".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){var u=new k.default({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),t=new k.default({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});return function(b){function k(a){a=b.call(this,a)||this;a.where=null;a.geometry=null;a.spatialRelationship="intersects";a.hiddenIds=new Set;a.distance=void 0;a.objectIds=null;a.units=null;a.timeExtent=null;a.enabled=!1;return a}f(k,b);n=k;k.prototype.writeWhere=function(a,b){b.where=a||"1\x3d1"};k.prototype.enable=function(){this._set("enabled",!0)};k.prototype.createQuery=
function(a){void 0===a&&(a={});var b=this.where,d=this.spatialRelationship,e=this.timeExtent,f=this.objectIds,g=this.units,k=this.distance;return new p(h({geometry:c.clone(this.geometry),objectIds:c.clone(f),spatialRelationship:d,timeExtent:c.clone(e),where:b,units:g,distance:k},a))};k.prototype.clone=function(){var a=this.where,b=this.geometry,d=this.spatialRelationship,e=this.hiddenIds,f=this.timeExtent,g=this.objectIds,h=this.units,k=this.distance,l=new Set;e.forEach(function(a){return l.add(a)});
return new n({geometry:c.clone(b),hiddenIds:l,objectIds:c.clone(g),spatialRelationship:d,timeExtent:c.clone(f),where:a,units:h,distance:k})};var n;l([g.property({type:String})],k.prototype,"where",void 0);l([g.writer("where")],k.prototype,"writeWhere",null);l([g.property({types:a.geometryTypes,json:{read:r.fromJSON,write:!0}})],k.prototype,"geometry",void 0);l([g.property({type:String,json:{read:{source:"spatialRel",reader:u.read},write:{target:"spatialRel",writer:u.write}}})],k.prototype,"spatialRelationship",
void 0);l([g.property({json:{write:function(a,b,c){return b[c]=d.valuesOfSet(a)},read:function(a){return d.createSetFromValues(a)}}})],k.prototype,"hiddenIds",void 0);l([g.property({type:Number,json:{write:{overridePolicy:function(a){return{enabled:0<a}}}}})],k.prototype,"distance",void 0);l([g.property({type:[Number],json:{write:!0}})],k.prototype,"objectIds",void 0);l([g.property({type:String,json:{read:t.read,write:{writer:t.write,overridePolicy:function(a){return{enabled:a&&0<this.distance}}}}})],
k.prototype,"units",void 0);l([g.property({type:e,json:{write:!0}})],k.prototype,"timeExtent",void 0);l([g.property({readOnly:!0})],k.prototype,"enabled",void 0);return k=n=l([g.subclass("esri.views.layers.support.FeatureFilter")],k)}(g.declared(n.JSONSupport))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection ../../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){var g=-.3*k.earthRadius;return function(b){function h(){var c=null!==b&&b.apply(this,arguments)||this;c.suspended=!1;c.extent=null;c.extentIntersectionDirty=!0;c._isVisibleBelowSurface=!1;c.handles=new a;c.layerView=null;c.updating=!0;return c}l(h,b);h.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new n.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var d=a.basemapTerrain,f=a.resourceController.scheduler;
this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),f.registerTask(c.Task.FRUSTUM_VISIBILITY,function(){return b.update()},function(){return b.updating}),d.on("elevation-bounds-change",function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([e.init(d,["opacity","wireframe"],function(){return b.updateIsVisibleBelowSurface()}),e.init(a,"map.ground.navigationConstraint.type",
function(){return b.updateIsVisibleBelowSurface()})])};h.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};h.prototype._setDirty=function(){this.updating||this._set("updating",!0)};h.prototype.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};h.prototype.viewChange=function(){this._setDirty()};h.prototype.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=
!0};Object.defineProperty(h.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0});h.prototype.updateIsVisibleBelowSurface=function(){var a=this.layerView.view,b=a.basemapTerrain,c=a.map.ground&&a.map.ground.navigationConstraint&&"none"===a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!b.isOpaque()||c};h.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=
!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=g;else{b=a.basemapTerrain.elevationBounds;var c=b.min;b=c-Math.max(1,(b.max-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};h.prototype.update=function(){this._set("updating",!1);this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):this._set("suspended",!1)};f([d.property({readOnly:!0})],h.prototype,"suspended",void 0);
f([d.property({readOnly:!0})],h.prototype,"updating",void 0);return h=f([d.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],h)}(d.declared(h))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._graphicsCore=b;this._highlights=[]}b.prototype.destroy=function(){this._highlights&&this._highlights.forEach(function(b){return b.highlightSet.removeAll()});
this._highlights=null};b.prototype.acquireSet=function(b,a){var e=this,d=new l(b,a);this._highlights.push(d);return{set:d,handle:{remove:function(){return e.releaseSet(d)},pause:function(){d.highlightSet.removeAll();d.paused=!0},resume:function(){d.paused=!1;e.initializeSet(d)}}}};b.prototype.releaseSet=function(b){b.highlightSet.removeAll();b=this._highlights?this._highlights.indexOf(b):-1;-1!==b&&this._highlights.splice(b,1)};b.prototype.setUids=function(b,a){for(var e=this._graphicsCore.graphics3DGraphics,
d=0;d<a.length;d++){var f=a[d];b.ids.add(f);(f=e.get(f))&&f.addHighlight(b.highlightSet,b.options)}};b.prototype.setObjectIds=function(b,a){a.forEach(function(a){return b.ids.add(a)});this.initializeSet(b)};b.prototype.addGraphic=function(b){this._highlights.forEach(function(a){!a.paused&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)})};b.prototype.removeGraphic=function(b){this._highlights.forEach(function(a){a.hasGraphic(b)&&b.removeHighlight(a.highlightSet)})};b.prototype.allGraphicsDeleted=
function(){this._highlights&&this._highlights.forEach(function(b){return b.highlightSet.removeAll()})};b.prototype.initializeSet=function(b){var a=this._graphicsCore.graphics3DGraphics;b.objectIdField?a.forEach(function(a){a&&b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)}):b.ids.forEach(function(e){(e=a.get(e))&&e.addHighlight(b.highlightSet,b.options)})};Object.defineProperty(b.prototype,"test",{get:function(){return{highlights:this._highlights}},enumerable:!0,configurable:!0});return b}();
b.Graphics3DHighlights=q})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(q,b,l){return function(){function b(b,a){this.options=b;this.objectIdField=a;this.highlightSet=new l;this.ids=new Set;this.paused=!1}b.prototype.hasGraphic=function(b){return this.objectIdField?this.ids.has(b.graphic.attributes[this.objectIdField]):this.ids.has(b.graphic.uid)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require",
"exports"],function(q,b){return function(){function b(){this.items=[]}b.prototype.addObject=function(b,h){this.items.push({type:"object",highlightId:h,object:b})};b.prototype.addRenderGeometry=function(b,h,a){this.items.push({type:"renderGeometry",highlightId:h,renderGeometry:b,owner:a})};b.prototype.addExternal=function(b,h){this.items.push({type:"external",highlightId:h,remove:b})};b.prototype.remove=function(b){for(var f=this.items.length-1;0<=f;--f){var a=this.items[f];a.highlightId===b&&(this.removeHighlight(a),
this.items.splice(f,1))}};b.prototype.removeObject=function(b){for(var f=this.items.length-1;0<=f;--f){var a=this.items[f];"object"===a.type&&a.object===b&&(this.removeHighlight(a),this.items.splice(f,1))}};b.prototype.removeRenderGeometry=function(b){for(var f=this.items.length-1;0<=f;--f){var a=this.items[f];"renderGeometry"===a.type&&a.renderGeometry===b&&(this.removeHighlight(a),this.items.splice(f,1))}};b.prototype.removeAll=function(){var b=this;this.items.forEach(function(f){b.removeHighlight(f)});
this.items=[]};b.prototype.removeHighlight=function(b){switch(b.type){case "object":b.object.removeHighlights(b.highlightId);break;case "renderGeometry":b.owner.removeRenderGeometryHighlight(b.renderGeometry,b.highlightId);break;case "external":b.remove(b.highlightId)}};return b}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../support/index ../../../support/layerViewUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(){var c=null!==b&&b.apply(this,arguments)||this;c._scaleRangeActive=!1;c.layerScaleRangeVisibilityQuery=!1;c.scaleChangeEventHandle=null;c.handles=new a;c.layerView=null;c.layer=null;c.queryGraphicUIDsInExtent=null;c.extent=null;c.graphicsCore=null;c.basemapTerrain=null;c.suspended=!1;c.updating=!0;return c}l(c,b);c.prototype.setup=function(a,b,c,d,e){var f=this;this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=
d;this.basemapTerrain=e;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(k.Task.SCALE_VISIBILITY,function(){return f.update()},function(){return f.needsUpdate()}))};c.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};c.prototype.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||
!this.updating)};c.prototype._setDirty=function(){this.updating||this._set("updating",!0)};c.prototype.setExtent=function(a){this.extent=a;this._setDirty()};c.prototype.scaleRangeActive=function(){return this._scaleRangeActive};c.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=0<b.minScale||0<b.maxScale;b.labelingInfo&&!c&&(c=b.labelingInfo.some(function(a){return a&&(0<a.minScale||0<a.maxScale)}));b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&
this.basemapTerrain?this.scaleChangeEventHandle=this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};c.prototype.update=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&b.ready&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,
this.layer.maxScale,function(b){return a.finishUpdate(b)})):this.finishUpdate(!0)};c.prototype.finishUpdate=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a);this._set("updating",!1)};c.prototype.visibleAtLayerScale=function(a){return n.scaleBoundsPredicate(a,this.layer.minScale||0,this.layer.maxScale||0)};c.prototype.visibleAtLabelScale=function(a,b){return n.scaleBoundsPredicate(a,b.minScale||0,b.maxScale||0)};c.prototype.graphicScale=function(a){var b;e.isSome(a.centroid)?
b=a.centroid:e.isSome(a.graphic.geometry)&&"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};c.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};c.prototype.updateVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b,0)}return!1};c.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};c.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};c.prototype.scaleUpdateHandler=
function(a){var b=this;this._setDirty();if(!this.layerView.suspended){var c=a.extent,d=a.scale,f=this.visibleAtLayerScale(d),g=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var h=a.centroid;e.isSome(h)&&(c[0]>h.x||c[1]>h.y||c[2]<h.x||c[3]<h.y)||(a.setVisibilityFlag(1,f,0)&&(g=!0),b.updateLabelScaleVisibility(a,d)&&(g=!0))}});g&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};c.prototype.layerMinMaxScaleChangeHandler=
function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(function(a){return a.clearVisibilityFlag(1)}):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};f([d.property({readOnly:!0})],c.prototype,"suspended",void 0);f([d.property({readOnly:!0})],c.prototype,"updating",void 0);return c=f([d.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c)}(d.declared(h))})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.attributeLookup=function(b,f){f=f.toLowerCase();for(var h=0,a=Object.keys(b);h<a.length;h++){var e=a[h];if(e.toLowerCase()===f)return b[e]}return null}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",
{value:!0});b.toViewIfLocal=function(a){var b=a.view.spatialReference,d=a.layer.fullExtent,k=d&&d.spatialReference;return k?k.equals(b)?l.resolve(d.clone()):f.canProject(k,b)?l.resolve(f.project(d,b)):a.view.state.isLocal?h.projectGeometry(d,b,a.layer.portalItem).then(function(b){return!a.destroyed&&b?b:void 0}).catch(function(){return null}):l.resolve(null):l.resolve(null)}})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define("require exports ../../../../core/maybe ../graphics/Graphics3DVerticalScale ./FeatureTileFetcher3D ./featureTileQuery3D".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._capabilities=this.memoryCache=null;var d=b.layerView.layer;this.layerView=b.layerView;this.objectIdField=d.objectIdField;this.returnZ=b.returnZ;this.returnM=b.returnM;this.verticalScale=new f({sourceSpatialReference:d.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this.query=a.createFeatureTileQuery3D(d);b=this.layerView.view.resourceController;"hasService"in d&&d.hasService&&
b&&(this.memoryCache=b.memoryController.getMemCache(d.uid))}b.prototype.destroy=function(){l.isSome(this.memoryCache)&&this.memoryCache.destroy()};b.prototype.createQuery=function(){var a=this.layerView.layer.createQuery();a.outFields=this.layerView.availableFields;a.returnZ=this.returnZ;a.returnM=this.returnM;a.outSpatialReference=this.tilingScheme.spatialReference;return a};Object.defineProperty(b.prototype,"viewingMode",{get:function(){return this.layerView.view.viewingMode},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"tilingScheme",{get:function(){return this.layerView.view.featureTiles.tilingScheme},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scheduler",{get:function(){var a=this.layerView.view.resourceController;return a?a.scheduler:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"geometryType",{get:function(){return this.layerView.layer.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullExtent",
{get:function(){return this.layerView.layer.fullExtent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tileMaxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxRecordCount",{get:function(){return this.layerView.layer.capabilities.query.maxRecordCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capabilities",{get:function(){return l.isSome(this._capabilities)?
this._capabilities:this._capabilities=h.contextCapabilitiesFromLayer(this.layerView.layer)},enumerable:!0,configurable:!0});b.prototype.logFetchError=function(a,b){a.error("#fetchTile()",this.layerView.layer,b&&b.message?b.message:b)};b.prototype.adjustVerticalScale=function(a){return this.verticalScale.adjust(a)};return b}();b.FeatureTileFetcher3DLayerViewContext=q})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require","exports","../../../../core/maybe","../../../../core/unitUtils"],
function(q,b,l,f){return function(){function b(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}b.prototype.adjust=function(a){var b=this._getVerticalUnitScale();1!==b&&this._scaleVerticalUnits(a,b)};b.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=f.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),b=f.getMetersPerVerticalUnitForSR(this.destSpatialReference);
return a/b}return 1};b.prototype._vertexListsScaleZ=function(a,b){for(var d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.length;++f)e[f][2]*=b};b.prototype._scaleVerticalUnits=function(a,b){for(var d=0;d<a.length;++d){var e=a[d].geometry;!l.isNone(e)&&e.hasZ&&(this._geometryIsPoint(e)?null!==e.z&&(e.z*=b):this._geometryIsPolyline(e)?this._vertexListsScaleZ(e.paths,b):this._geometryIsPolygon(e)&&this._vertexListsScaleZ(e.rings,b))}};b.prototype._geometryIsPoint=function(a){return"point"===a.type};b.prototype._geometryIsPolygon=
function(a){return"polygon"===a.type};b.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return b}()})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query".split(" "),function(q,b,l,f,h,a,e,d){Object.defineProperty(b,
"__esModule",{value:!0});var k=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}l(c,b);Object.defineProperty(c.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){var c={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(b,e){return d.executeQueryPBF(a.layer.parsedUrl,b,c,e).then(function(a){return a.data})}}return function(b,c){return d.executeQuery(a.layer.parsedUrl,
b,c).then(function(a){return e.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};f([a.property({constructOnly:!0})],c.prototype,"layer",void 0);f([a.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],c.prototype,"queryFeaturesDehydrated",null);return c=f([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],c)}(a.declared(h)),n=function(b){function c(){return null!==
b&&b.apply(this,arguments)||this}l(c,b);c.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a,b).then(e.fromFeatureSetJSON,function(d){if(d&&"query-features-json:unsupported"===d.name)return c.source.queryFeatures(a,b);throw d;})};c.prototype.queryFeatureCount=function(a,b){return this.layer.queryFeatureCount(a,b)};f([a.property({constructOnly:!0})],c.prototype,"layer",void 0);f([a.aliasOf("layer.source")],c.prototype,"source",void 0);return c=f([a.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
c)}(a.declared(h));b.createFeatureTileQuery3D=function(a){switch(a.source.type){case "feature-layer":return new k({layer:a});case "memory":case "csv":case "geojson":return new n({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/3d/support/EventedSet":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented","../../../core/iteratorUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",
{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._set=new Set;return b}l(b,a);b.prototype.clear=function(){if(0<this._set.size){var a=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:a})}};Object.defineProperty(b.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0});b.prototype.addMany=function(a){if(0!==a.length){for(var b=0;b<a.length;b++)this._set.add(a[b]);this.emit("after-changes",
{type:1});this.emit("change",{added:a,removed:[]})}};b.prototype.removeMany=function(a){for(var b=[],d=0;d<a.length;d++){var c=a[d];this._set.delete(c)&&b.push(c)}0<b.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:b}))};b.prototype.toArray=function(){return h.valuesOfSet(this._set)};b.prototype.find=function(a){var b;h.someSet(this._set,function(d){return a(d)?(b=d,!0):!1});return b};b.prototype.forEach=function(a){this._set.forEach(function(b){return a(b)})};return b}(f);
b.EventedSet=q})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/iteratorUtils ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../layers/support/fieldUtils ../../layers/support/timeUtils ../../support/arcadeOnDemand ../../tasks/support/Query ./support/FeatureEffect ./support/FeatureFilter ./support/popupUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w){Object.defineProperty(b,"__esModule",{value:!0});var A=n.getLogger("esri.views.layers.FeatureLayerView");b.FeatureLayerView=function(b){return function(b){function h(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];a=b.apply(this,a)||this;a._updatingRequiredFieldsPromise=null;a.effect=null;a.filter=null;a.layer=null;a.requiredFields=null;a.view=null;return a}l(h,b);h.prototype.initialize=function(){var a=this;r.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo filter effect layer.timeInfo timeExtent".split(" "),
function(){return a._handleRequiredFieldsChange()},!0)};Object.defineProperty(h.prototype,"availableFields",{get:function(){var a=this.layer,b=this.layer.fields,c=this.requiredFields;return"outFields"in a&&a.outFields?u.fixFields(b,u.unpackFieldNames(b,a.outFields).concat(c)):u.fixFields(b,c)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){A.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype.highlight=function(a,b){void 0===b&&(b={});return this.inherited(arguments,[a,b])};h.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},a=c.isSome(this.filter)?this.filter.createQuery(a):new v(a);this.timeExtent&&(a.timeExtent=a.timeExtent?a.timeExtent.intersection(this.timeExtent):
this.timeExtent.clone());return a};h.prototype.queryFeatures=function(a,b){return this.inherited(arguments,[a,b])};h.prototype.queryObjectIds=function(a,b){return this.inherited(arguments,[a,b])};h.prototype.queryFeatureCount=function(a,b){return this.inherited(arguments,[a,b])};h.prototype.queryExtent=function(a,b){return this.inherited(arguments,[a,b])};h.prototype._loadArcadeModules=function(a){if(a.get("expressionInfos.length"))return x.loadArcade()};h.prototype._handleRequiredFieldsChange=function(){var a=
this,b=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",b);b.then(function(){a._updatingRequiredFieldsPromise===b&&a._set("_updatingRequiredFieldsPromise",null)})};h.prototype._updateRequiredFields=function(){return e(this,void 0,void 0,function(){var b,d,e,f,h,l,m,n,p,q,r,t,w;return a(this,function(a){switch(a.label){case 0:if(!this.layer||!this.view)return[2];b="3d"===this.view.type;d=this;f=e=d.layer;h=f.fields;l=f.objectIdField;m=f.renderer;n=new Set;return[4,g.eachAlways([m?
m.collectRequiredFields(n,h):null,u.collectLabelingFields(n,e),b?u.collectElevationFields(n,e):null,c.isSome(this.filter)?u.collectFilterFields(n,e,this.filter):null,this.effect?u.collectFilterFields(n,e,this.effect.filter):null])];case 1:p=a.sent();e.timeInfo&&this.timeExtent&&u.collectFields(n,e.fields,[e.timeInfo.startField,e.timeInfo.endField]);q=0;for(r=p;q<r.length;q++)t=r[q],t.error&&A.error(t.error);u.collectField(n,h,l);w=k.valuesOfSet(n).sort();this._set("requiredFields",w);return[2]}})})};
h.prototype.validateFetchPopupFeatures=function(a){var b=this.layer;if(!this.layer.popupEnabled)return new d("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:b});if(!w.getFetchPopupTemplate(this.layer,a))return new d("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};h.prototype.fetchClientPopupFeatures=function(b){return e(this,void 0,void 0,function(){var d,e,f,h,k,l,m,n,p,q,r,t;return a(this,function(a){switch(a.label){case 0:d=c.isSome(b)?
b.clientGraphics:null;if(!d||0===d.length)return[2,g.resolve([])];e=[];f=[];h=this.layer;k=w.getFetchPopupTemplate(h,b);return c.isSome(k)?[4,this._loadArcadeModules(k)]:[2,g.resolve([])];case 1:return m=(l=a.sent())&&l.arcadeUtils.hasGeometryOperations(k),[4,this.createPopupQuery(b)];case 2:n=a.sent();p=u.unpackFieldNames(h.fields,n.outFields);q=0;for(r=d;q<r.length;q++)t=r[q],m||!u.featureHasFields(p,t)?f.push(t):e.push(t);if(0===f.length)return[2,g.resolve(e)];n.objectIds=f.map(function(a){return a.attributes[h.objectIdField]});
return[2,h.queryFeatures(n).then(function(a){return e.concat(a.features)}).catch(function(){return f})]}})})};h.prototype.createPopupQuery=function(b){return e(this,void 0,void 0,function(){var c,d,e;return a(this,function(a){switch(a.label){case 0:return c=this.layer,d=c.createQuery(),d.returnGeometry=!0,d.returnZ=!0,d.returnM=!0,e=d,[4,w.getRequiredFields(this.layer,w.getFetchPopupTemplate(this.layer,b))];case 1:return e.outFields=a.sent(),d.outSpatialReference=this.view.spatialReference,[2,d]}})})};
f([p.property()],h.prototype,"_updatingRequiredFieldsPromise",void 0);f([p.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],h.prototype,"availableFields",null);f([p.property({type:y})],h.prototype,"effect",void 0);f([p.property({type:m})],h.prototype,"filter",void 0);f([p.property(t.combinedViewLayerTimeExtentProperty)],h.prototype,"timeExtent",void 0);f([p.property()],h.prototype,"layer",void 0);f([p.property({type:Number})],h.prototype,"maximumNumberOfFeatures",null);f([p.property({readOnly:!0,
type:Boolean})],h.prototype,"maximumNumberOfFeaturesExceeded",null);f([p.property({readOnly:!0})],h.prototype,"requiredFields",void 0);f([p.property()],h.prototype,"view",void 0);return h=f([p.subclass("esri.views.layers.FeatureLayerView")],h)}(p.declared(b))}})},"esri/views/layers/support/FeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ./FeatureFilter ./ParsedFeatureEffect ./Transition".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){var g=a.getLogger("esri.views.layers.support.FeatureEffect");return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.filter=null;b.includedEffect=null;b.excludedEffect=null;b.excludedLabelsVisible=!1;return b}f(b,a);h=b;Object.defineProperty(b.prototype,"insideEffect",{get:function(){g.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");return this.includedEffect},set:function(a){g.warn("insideEffect is a temporary interface that will be removed. Use includedEffect instead");
this.includedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"outsideEffect",{get:function(){g.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");return this.excludedEffect},set:function(a){g.warn("outsideEffect is a temporary interface that will be removed. Use excludedEffect instead");this.excludedEffect=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedIncludedEffect",{get:function(){return e.isSome(this.includedEffect)?
"string"===typeof this.includedEffect?n.fromString(this.includedEffect):new c({from:n.fromString(this.includedEffect.from),to:n.fromString(this.includedEffect.to),duration:this.includedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parsedExcludedEffect",{get:function(){return e.isSome(this.excludedEffect)?"string"===typeof this.excludedEffect?n.fromString(this.excludedEffect):new c({from:n.fromString(this.excludedEffect.from),to:n.fromString(this.excludedEffect.to),
duration:this.excludedEffect.duration}):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderingHash",{get:function(){return this.excludedLabelsVisible+"-"+this.includedEffect+"-"+this.excludedEffect},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"done",{get:function(){return(!e.isSome(this.parsedIncludedEffect)||this.parsedIncludedEffect.done)&&(!e.isSome(this.parsedExcludedEffect)||this.parsedExcludedEffect.done)},enumerable:!0,configurable:!0});b.prototype.clone=
function(){return new h({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};var h;l([d.property({type:k,json:{write:!0}})],b.prototype,"filter",void 0);l([d.property({type:String,json:{write:!0}})],b.prototype,"includedEffect",void 0);l([d.property({type:String,json:{write:!0}})],b.prototype,"excludedEffect",void 0);l([d.property({type:Boolean,json:{write:!0}})],b.prototype,"excludedLabelsVisible",
void 0);l([d.property({dependsOn:["includedEffect"]})],b.prototype,"parsedIncludedEffect",null);l([d.property({dependsOn:["excludedEffect"]})],b.prototype,"parsedExcludedEffect",null);l([d.property({dependsOn:["includedEffect","excludedEffect"]})],b.prototype,"renderingHash",null);return b=h=l([d.subclass("esri.views.layers.support.FeatureEffect")],b)}(d.declared(h.JSONSupport))})},"esri/views/layers/support/ParsedFeatureEffect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/assignHelper ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f32 ./cssFilterParser".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){var p=d.getLogger("esri.views.layers.support.ParsedFeatureEffect"),u={grayscale:function(a){a=1-a.amount;a=g.mat4f32.fromValues(.2126+.7874*a,.7152-.7152*a,.0722-.0722*a,0,.2126-.2126*a,.7152+.2848*a,.0722-.0722*a,0,.2126-.2126*a,.7152-.7152*a,.0722+.9278*a,0,0,0,0,1);return c.mat4.transpose(a,a)},sepia:function(a){a=1-a.amount;a=g.mat4f32.fromValues(.393+.607*a,.769-.769*a,.189-.189*a,0,.349-.349*a,.686+.314*a,.168-.168*a,0,.272-.272*a,.534-.534*a,.131+.869*a,
0,0,0,0,1);return c.mat4.transpose(a,a)},saturate:function(a){a=a.amount;a=g.mat4f32.fromValues(.213+.787*a,.715-.715*a,.072-.072*a,0,.213-.213*a,.715+.285*a,.072-.072*a,0,.213-.213*a,.715-.715*a,.072+.928*a,0,0,0,0,1);return c.mat4.transpose(a,a)},"hue-rotate":function(a){var b=Math.sin(a.angle*Math.PI/180);a=Math.cos(a.angle*Math.PI/180);b=g.mat4f32.fromValues(.213+.787*a-.213*b,.715-.715*a-.715*b,.072-.072*a+.928*b,0,.213-.213*a+.143*b,.715+.285*a+.14*b,.072-.072*a-.283*b,0,.213-.213*a-.787*b,
.715-.715*a+.715*b,.072+.928*a+.072*b,0,0,0,0,1);return c.mat4.transpose(b,b)},invert:function(a){var b=1-2*a.amount;a=a.amount;b=g.mat4f32.fromValues(b,0,0,a,0,b,0,a,0,0,b,a,0,0,0,1);return c.mat4.transpose(b,b)},brightness:function(a){a=a.amount;a=g.mat4f32.fromValues(a,0,0,0,0,a,0,0,0,0,a,0,0,0,0,1);return c.mat4.transpose(a,a)},contrast:function(a){a=a.amount;a=g.mat4f32.fromValues(a,0,0,.5-.5*a,0,a,0,.5-.5*a,0,0,a,.5-.5*a,0,0,0,1);return c.mat4.transpose(a,a)}};return function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.customTransforms=null;a.done=!0;return a}f(d,b);e=d;d.fromString=function(b){var c=[],d=null;try{for(var f=0,g=r.parse(b);f<g.length;f++){var h=g[f];"opacity"===h.type?d=h:c.push(h)}}catch(E){p.error(new a("invalid-type","Encountered an error when parsing css",E))}return new e({transforms:c,opacity:d})};d.prototype.getOpacity=function(){return k.isSome(this.opacity)?this.opacity.amount:1};d.prototype.getColorMatrix=function(){var a=this;return(this.transforms||
[]).map(function(a){return h({},a)}).reverse().reduce(function(b,d){return c.mat4.multiply(b,b,a._getFactory(d)(d))},g.mat4f32.create())};d.prototype.clone=function(){return new e({transforms:this.transforms&&this.transforms.map(function(a){return h({},a)}),customTransforms:this.customTransforms&&this.customTransforms.map(function(a){return h({},a)})})};d.prototype._getFactory=function(a){var b=u[a.type];if(b)return b;if(this.customTransforms)for(var b=function(b){if(b.type===a.type){b=g.mat4f32.fromValues.apply(g.mat4f32,
b.matrix);var d=c.mat4.transpose(b,b);return{value:function(){return d}}}},d=0,e=this.customTransforms;d<e.length;d++){var f=b(e[d]);if("object"===typeof f)return f.value}p.error("invalid-type","No effect "+a.type+" exists");return function(){return g.mat4f32.create()}};var e;l([n.property()],d.prototype,"opacity",void 0);l([n.property()],d.prototype,"transforms",void 0);l([n.property()],d.prototype,"customTransforms",void 0);return d=e=l([n.subclass("esri.views.layers.support.ParsedFeatureEffect")],
d)}(n.declared(e.JSONSupport))})},"esri/views/layers/support/cssFilterParser":function(){define([],function(){function q(b,l,f,h){this.message=b;this.expected=l;this.found=f;this.location=h;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,q)}(function(b,l){function f(){this.constructor=b}f.prototype=l.prototype;b.prototype=new f})(q,Error);q.buildMessage=function(b,l){function f(a){return a.charCodeAt(0).toString(16).toUpperCase()}function h(a){return a.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+f(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(a){return"\\x"+f(a)})}function a(a){return a.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(a){return"\\x0"+f(a)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(a){return"\\x"+f(a)})}var e={literal:function(a){return'"'+h(a.text)+'"'},"class":function(b){var d="",e;for(e=0;e<b.parts.length;e++)d+=b.parts[e]instanceof Array?a(b.parts[e][0])+"-"+a(b.parts[e][1]):a(b.parts[e]);return"["+(b.inverted?"^":"")+d+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),d;for(d=0;d<a.length;d++){var c=d,f;f=a[d];f=e[f.type](f);b[c]=f}b.sort();
if(0<b.length){for(a=d=1;d<b.length;d++)b[d-1]!==b[d]&&(b[a]=b[d],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(b)+" but "+(l?'"'+h(l)+'"':"end of input")+" found."};return{SyntaxError:q,parse:function(b,l){function f(a,b){return{type:"literal",text:a,ignoreCase:b}}function h(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function a(a){return{type:"other",description:a}}function e(a){var c=
Lb[a],d;if(!c){for(d=a-1;!Lb[d];)d--;c=Lb[d];for(c={line:c.line,column:c.column};d<a;)10===b.charCodeAt(d)?(c.line++,c.column=1):c.column++,d++;Lb[a]=c}return c}function d(a,b){var c=e(a),d=e(b);return{start:{offset:a,line:c.line,column:c.column},end:{offset:b,line:d.line,column:d.column}}}function k(a){M<db||(M>db&&(db=M,zb=[]),zb.push(a))}function n(){var a,d;ga++;a=M;d=y();d!==m?(b.substr(M,4)===C?(d=C,M+=4):(d=m,0===ga&&k(E)),d!==m?(d=y(),d!==m?(wa=a,a=null):(M=a,a=m)):(M=a,a=m)):(M=a,a=m);ga--;
a===m&&(d=m,0===ga&&k(B));if(a===m)if(a=[],d=c(),d!==m)for(;d!==m;)a.push(d),d=c();else a=m;return a}function c(){var a,c,e,f,h,l,n,w,x;ga++;c=M;e=y();e!==m?(b.substr(M,5)===J?(f=J,M+=5):(f=m,0===ga&&k(I)),f!==m?(h=y(),h!==m?(l=t(),l!==m?(n=y(),n!==m?(41===b.charCodeAt(M)?(w=K,M++):(w=m,0===ga&&k(H)),w!==m?(x=y(),x!==m?(wa=c,c=e={type:"blur",radius:l}):(M=c,c=m)):(M=c,c=m)):(M=c,c=m)):(M=c,c=m)):(M=c,c=m)):(M=c,c=m)):(M=c,c=m);ga--;c===m&&(e=m,0===ga&&k(G));a=c;if(a===m){var A,B,C,z,E,jb,sb,Rb;ga++;
A=M;B=y();B!==m?(b.substr(M,11)===P?(C=P,M+=11):(C=m,0===ga&&k(S)),C!==m?(z=y(),z!==m?(E=g(),E!==m?(jb=y(),jb!==m?(41===b.charCodeAt(M)?(sb=K,M++):(sb=m,0===ga&&k(H)),sb!==m?(Rb=y(),Rb!==m?(wa=A,A=B={type:"brightness",amount:E}):(M=A,A=m)):(M=A,A=m)):(M=A,A=m)):(M=A,A=m)):(M=A,A=m)):(M=A,A=m)):(M=A,A=m);ga--;A===m&&(B=m,0===ga&&k(L));a=A;if(a===m){var va,bb,ub,Na,Gb,lb,oa,Da;ga++;va=M;bb=y();bb!==m?(b.substr(M,9)===O?(ub=O,M+=9):(ub=m,0===ga&&k(Q)),ub!==m?(Na=y(),Na!==m?(Gb=g(),Gb!==m?(lb=y(),lb!==
m?(41===b.charCodeAt(M)?(oa=K,M++):(oa=m,0===ga&&k(H)),oa!==m?(Da=y(),Da!==m?(wa=va,va=bb={type:"contrast",amount:Gb}):(M=va,va=m)):(M=va,va=m)):(M=va,va=m)):(M=va,va=m)):(M=va,va=m)):(M=va,va=m)):(M=va,va=m);ga--;va===m&&(bb=m,0===ga&&k(R));a=va;if(a===m){var ia,xa,pa,Sa,ra,Ab,na,kb,Va,Xa,ya,Ia,Ma,lc;ga++;ia=M;xa=y();if(xa!==m)if(b.substr(M,12)===Y?(pa=Y,M+=12):(pa=m,0===ga&&k(N)),pa!==m)if(Sa=y(),Sa!==m)if(ra=t(),ra!==m)if(Ab=y(),Ab!==m)if(na=t(),na!==m)if(kb=y(),kb!==m)if(Va=t(),Va===m&&(Va=null),
Va!==m)if(Xa=y(),Xa!==m){var X,Ba,Ka,Aa,Fa,Ga,Pa,Ya,pb,ib,gb,La,qb,rb,cb,db,Nb,Ob;X=M;35===b.charCodeAt(M)?(Ba=fc,M++):(Ba=m,0===ga&&k(Cb));if(Ba!==m)if(Ka=M,Aa=v(),Aa!==m?(Fa=v(),Fa!==m?Ka=Aa=[Aa,Fa]:(M=Ka,Ka=m)):(M=Ka,Ka=m),Ka!==m)if(Aa=M,Fa=v(),Fa!==m?(Ga=v(),Ga!==m?Aa=Fa=[Fa,Ga]:(M=Aa,Aa=m)):(M=Aa,Aa=m),Aa!==m)if(Fa=M,Ga=v(),Ga!==m?(Pa=v(),Pa!==m?Fa=Ga=[Ga,Pa]:(M=Fa,Fa=m)):(M=Fa,Fa=m),Fa!==m){wa=X;var yb=Aa,Ib=Fa;X=Ba=[parseInt(Ka.join(""),16),parseInt(yb.join(""),16),parseInt(Ib.join(""),16)]}else M=
X,X=m;else M=X,X=m;else M=X,X=m;else M=X,X=m;if(X===m){X=M;35===b.charCodeAt(M)?(Ba=fc,M++):(Ba=m,0===ga&&k(Cb));if(Ba!==m)if(Ka=v(),Ka!==m)if(Aa=v(),Aa!==m)if(Fa=v(),Fa!==m){wa=X;var Kb=Aa,Lb=Fa;X=Ba=[parseInt([Ka,Ka].join(""),16),parseInt([Kb,Kb].join(""),16),parseInt([Lb,Lb].join(""),16)]}else M=X,X=m;else M=X,X=m;else M=X,X=m;else M=X,X=m;if(X===m&&(X=M,b.substr(M,5)===Qa?(Ba=Qa,M+=5):(Ba=m,0===ga&&k(xb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=p(),Aa!==m?(Fa=y(),Fa!==m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=
m,0===ga&&k(Ua)),Ga!==m?(Pa=y(),Pa!==m?(Ya=p(),Ya!==m?(pb=y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),ib!==m?(gb=y(),gb!==m?(La=p(),La!==m?(qb=y(),qb!==m?(44===b.charCodeAt(M)?(rb=ab,M++):(rb=m,0===ga&&k(Ua)),rb!==m?(cb=y(),cb!==m?(db=g(),db!==m?(Nb=y(),Nb!==m?(41===b.charCodeAt(M)?(Ob=K,M++):(Ob=m,0===ga&&k(H)),Ob!==m?(wa=X,X=Ba=[255*Aa,255*Ya,255*La,db]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):
(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m&&(X=M,b.substr(M,5)===Qa?(Ba=Qa,M+=5):(Ba=m,0===ga&&k(xb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=r(),Aa!==m?(Fa=y(),Fa!==m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=m,0===ga&&k(Ua)),Ga!==m?(Pa=y(),Pa!==m?(Ya=r(),Ya!==m?(pb=y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),ib!==m?(gb=y(),gb!==m?(La=r(),La!==m?(44===b.charCodeAt(M)?(qb=ab,M++):(qb=m,0===ga&&k(Ua)),qb!==m?(rb=y(),rb!==m?(cb=g(),cb!==m?(41===b.charCodeAt(M)?(db=K,
M++):(db=m,0===ga&&k(H)),db!==m?(wa=X,X=Ba=[Aa,Ya,La,cb]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m&&(X=M,b.substr(M,5)===Qa?(Ba=Qa,M+=5):(Ba=m,0===ga&&k(xb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=p(),Aa!==m?(Fa=y(),Fa!==m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=m,0===ga&&k(Ua)),Ga!==m?(Pa=y(),Pa!==m?(Ya=p(),Ya!==m?(pb=y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),
ib!==m?(gb=y(),gb!==m?(La=p(),La!==m?(qb=y(),qb!==m?(41===b.charCodeAt(M)?(rb=K,M++):(rb=m,0===ga&&k(H)),rb!==m?(wa=X,X=Ba=[255*Aa,255*Ya,255*La,1]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m&&(X=M,b.substr(M,5)===Qa?(Ba=Qa,M+=5):(Ba=m,0===ga&&k(xb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=r(),Aa!==m?(Fa=y(),Fa!==m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=m,0===ga&&k(Ua)),Ga!==m?(Pa=y(),Pa!==m?(Ya=r(),Ya!==m?(pb=
y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),ib!==m?(gb=y(),gb!==m?(La=r(),La!==m?(41===b.charCodeAt(M)?(qb=K,M++):(qb=m,0===ga&&k(H)),qb!==m?(wa=X,X=Ba=[Aa,Ya,La,1]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m&&(X=M,b.substr(M,4)===Sb?(Ba=Sb,M+=4):(Ba=m,0===ga&&k(Pb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=p(),Aa!==m?(Fa=y(),Fa!==m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=m,0===ga&&k(Ua)),Ga!==m?(Pa=
y(),Pa!==m?(Ya=p(),Ya!==m?(pb=y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),ib!==m?(gb=y(),gb!==m?(La=p(),La!==m?(qb=y(),qb!==m?(41===b.charCodeAt(M)?(rb=K,M++):(rb=m,0===ga&&k(H)),rb!==m?(wa=X,X=Ba=[255*Aa,255*Ya,255*La,1]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m&&(X=M,b.substr(M,4)===Sb?(Ba=Sb,M+=4):(Ba=m,0===ga&&k(Pb)),Ba!==m?(Ka=y(),Ka!==m?(Aa=r(),Aa!==m?(Fa=y(),Fa!==
m?(44===b.charCodeAt(M)?(Ga=ab,M++):(Ga=m,0===ga&&k(Ua)),Ga!==m?(Pa=y(),Pa!==m?(Ya=r(),Ya!==m?(pb=y(),pb!==m?(44===b.charCodeAt(M)?(ib=ab,M++):(ib=m,0===ga&&k(Ua)),ib!==m?(gb=y(),gb!==m?(La=r(),La!==m?(qb=y(),qb!==m?(41===b.charCodeAt(M)?(rb=K,M++):(rb=m,0===ga&&k(H)),rb!==m?(wa=X,X=Ba=[Aa,Ya,La,1]):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m)):(M=X,X=m),X===m))))))){var zb,Qb,Eb;ga++;zb=M;Qb=[];hc.test(b.charAt(M))?
(Eb=b.charAt(M),M++):(Eb=m,0===ga&&k(Yb));if(Eb!==m)for(;Eb!==m;)Qb.push(Eb),hc.test(b.charAt(M))?(Eb=b.charAt(M),M++):(Eb=m,0===ga&&k(Yb));else Qb=m;if(Qb!==m){wa=zb;var ac=b.substring(wa,M);if(!sc.has(ac)){var Wb='unknown color "'+ac+'"',bc=void 0,bc=void 0!==bc?bc:d(wa,M);throw new q(Wb,null,null,bc);}Qb=rc[ac].concat(1)}zb=Qb;ga--;zb===m&&(Qb=m,0===ga&&k(gc));X=zb}}ya=X;ya===m&&(ya=null);ya!==m?(Ia=y(),Ia!==m?(41===b.charCodeAt(M)?(Ma=K,M++):(Ma=m,0===ga&&k(H)),Ma!==m?(lc=y(),lc!==m?(wa=ia,ia=
xa={type:"drop-shadow",offsetX:ra,offsetY:na,blurRadius:Va,color:ya}):(M=ia,ia=m)):(M=ia,ia=m)):(M=ia,ia=m)):(M=ia,ia=m)}else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;else M=ia,ia=m;ga--;ia===m&&(xa=m,0===ga&&k(T));a=ia;if(a===m){var eb,Jb,Zb,yc,zc,Ub,jc,Xb;ga++;eb=M;Jb=y();Jb!==m?(b.substr(M,10)===W?(Zb=W,M+=10):(Zb=m,0===ga&&k(aa)),Zb!==m?(yc=y(),yc!==m?(zc=g(),zc!==m?(Ub=y(),Ub!==m?(41===b.charCodeAt(M)?(jc=K,M++):(jc=m,
0===ga&&k(H)),jc!==m?(Xb=y(),Xb!==m?(wa=eb,eb=Jb={type:"grayscale",amount:zc}):(M=eb,eb=m)):(M=eb,eb=m)):(M=eb,eb=m)):(M=eb,eb=m)):(M=eb,eb=m)):(M=eb,eb=m)):(M=eb,eb=m);ga--;eb===m&&(Jb=m,0===ga&&k(Z));a=eb;if(a===m){var Ra,cc,Hc,ad,Rc,bd,Sc,D;ga++;Ra=M;cc=y();if(cc!==m)if(b.substr(M,11)===F?(Hc=F,M+=11):(Hc=m,0===ga&&k(ca)),Hc!==m)if(ad=y(),ad!==m){var Za,fb,nb;ga++;Za=M;var fa,Fb,Bd;ga++;fa=M;Oa.test(b.charAt(M))?(Fb=b.charAt(M),M++):(Fb=m,0===ga&&k(Ja));Fb===m&&(Fb=null);Fb!==m?(Bd=r(),Bd!==m?
(wa=fa,fa=Fb=parseFloat(b.substring(wa,M))):(M=fa,fa=m)):(M=fa,fa=m);ga--;fa===m&&(Fb=m,0===ga&&k(da));fb=fa;fb!==m?(nb=u(),nb!==m?(wa=Za,Za=fb*=nb):(M=Za,Za=m)):(M=Za,Za=m);Za===m&&(Za=M,48===b.charCodeAt(M)?(fb=Ca,M++):(fb=m,0===ga&&k(Wa)),fb!==m?(nb=u(),nb===m&&(nb=null),nb!==m?(wa=Za,Za=fb=0):(M=Za,Za=m)):(M=Za,Za=m));ga--;Za===m&&(fb=m,0===ga&&k(tb));Rc=Za;Rc!==m?(bd=y(),bd!==m?(41===b.charCodeAt(M)?(Sc=K,M++):(Sc=m,0===ga&&k(H)),Sc!==m?(D=y(),D!==m?(wa=Ra,Ra=cc={type:"hue-rotate",angle:Rc}):
(M=Ra,Ra=m)):(M=Ra,Ra=m)):(M=Ra,Ra=m)):(M=Ra,Ra=m)}else M=Ra,Ra=m;else M=Ra,Ra=m;else M=Ra,Ra=m;ga--;Ra===m&&(cc=m,0===ga&&k(V));a=Ra;if(a===m){var mb,ed,sd,Cd,td,Dd,ud,Ea;ga++;mb=M;ed=y();ed!==m?(b.substr(M,7)===ea?(sd=ea,M+=7):(sd=m,0===ga&&k(ha)),sd!==m?(Cd=y(),Cd!==m?(td=g(),td!==m?(Dd=y(),Dd!==m?(41===b.charCodeAt(M)?(ud=K,M++):(ud=m,0===ga&&k(H)),ud!==m?(Ea=y(),Ea!==m?(wa=mb,mb=ed={type:"invert",amount:td}):(M=mb,mb=m)):(M=mb,mb=m)):(M=mb,mb=m)):(M=mb,mb=m)):(M=mb,mb=m)):(M=mb,mb=m)):(M=mb,
mb=m);ga--;mb===m&&(ed=m,0===ga&&k(U));a=mb;if(a===m){var ob,fd,vd,Qd,Id,Ed,Jd,Rd;ga++;ob=M;fd=y();fd!==m?(b.substr(M,8)===ba?(vd=ba,M+=8):(vd=m,0===ga&&k(qa)),vd!==m?(Qd=y(),Qd!==m?(Id=g(),Id!==m?(Ed=y(),Ed!==m?(41===b.charCodeAt(M)?(Jd=K,M++):(Jd=m,0===ga&&k(H)),Jd!==m?(Rd=y(),Rd!==m?(wa=ob,ob=fd={type:"opacity",amount:Id}):(M=ob,ob=m)):(M=ob,ob=m)):(M=ob,ob=m)):(M=ob,ob=m)):(M=ob,ob=m)):(M=ob,ob=m)):(M=ob,ob=m);ga--;ob===m&&(fd=m,0===ga&&k(ka));a=ob;if(a===m){var vb,Fd,Kd,Sd,Ld,Td,Md,Ud;ga++;vb=
M;Fd=y();Fd!==m?(b.substr(M,9)===la?(Kd=la,M+=9):(Kd=m,0===ga&&k(ma)),Kd!==m?(Sd=y(),Sd!==m?(Ld=g(),Ld!==m?(Td=y(),Td!==m?(41===b.charCodeAt(M)?(Md=K,M++):(Md=m,0===ga&&k(H)),Md!==m?(Ud=y(),Ud!==m?(wa=vb,vb=Fd={type:"saturate",amount:Ld}):(M=vb,vb=m)):(M=vb,vb=m)):(M=vb,vb=m)):(M=vb,vb=m)):(M=vb,vb=m)):(M=vb,vb=m)):(M=vb,vb=m);ga--;vb===m&&(Fd=m,0===ga&&k(ja));a=vb;if(a===m){var wb,Gd,Nd,Vd,Od,Wd,Pd,Xd;ga++;wb=M;Gd=y();Gd!==m?(b.substr(M,6)===ua?(Nd=ua,M+=6):(Nd=m,0===ga&&k(sa)),Nd!==m?(Vd=y(),Vd!==
m?(Od=g(),Od!==m?(Wd=y(),Wd!==m?(41===b.charCodeAt(M)?(Pd=K,M++):(Pd=m,0===ga&&k(H)),Pd!==m?(Xd=y(),Xd!==m?(wa=wb,wb=Gd={type:"sepia",amount:Od}):(M=wb,wb=m)):(M=wb,wb=m)):(M=wb,wb=m)):(M=wb,wb=m)):(M=wb,wb=m)):(M=wb,wb=m)):(M=wb,wb=m);ga--;wb===m&&(Gd=m,0===ga&&k(ta));a=wb}}}}}}}}}return a}function g(){var a;ga++;a=p();a===m&&(a=r());ga--;a===m&&0===ga&&k(xa);return a}function r(){var a,c,d;ga++;a=M;c=[];oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));if(d!==m)for(;d!==m;)c.push(d),
oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));else c=m;if(c!==m)if(46===b.charCodeAt(M)?(d=na,M++):(d=m,0===ga&&k(ya)),d!==m){c=[];oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));if(d!==m)for(;d!==m;)c.push(d),oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));else c=m;c!==m?(wa=a,a=c=parseFloat(b.substring(wa,M))):(M=a,a=m)}else M=a,a=m;else M=a,a=m;if(a===m){ga++;a=M;c=[];oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));if(d!==m)for(;d!==m;)c.push(d),
oa.test(b.charAt(M))?(d=b.charAt(M),M++):(d=m,0===ga&&k(pa));else c=m;c!==m&&(wa=a,c=parseInt(b.substring(wa,M),10));a=c;ga--;a===m&&(c=m,0===ga&&k(ra))}ga--;a===m&&(c=m,0===ga&&k(ia));return a}function p(){var a,c,d;a=M;c=r();c!==m?(37===b.charCodeAt(M)?(d=Ma,M++):(d=m,0===ga&&k(z)),d!==m?(wa=a,a=c/100):(M=a,a=m)):(M=a,a=m);return a}function u(){var a,c;ga++;a=M;b.substr(M,3)===va?(c=va,M+=3):(c=m,0===ga&&k(bb));c!==m&&(wa=a,c=1);a=c;a===m&&(a=M,b.substr(M,4)===Na?(c=Na,M+=4):(c=m,0===ga&&k(lb)),
c!==m&&(wa=a,c=.9),a=c,a===m&&(a=M,b.substr(M,3)===kb?(c=kb,M+=3):(c=m,0===ga&&k(Xa)),c!==m&&(wa=a,c=180/Math.PI),a=c,a===m&&(a=M,b.substr(M,4)===Sa?(c=Sa,M+=4):(c=m,0===ga&&k(Va)),c!==m&&(wa=a,c=1/360),a=c)));ga--;a===m&&(c=m,0===ga&&k(jb));return a}function t(){var a,c,d;ga++;a=M;c=r();c!==m?(d=x(),d!==m?(wa=a,a=c*d):(M=a,a=m)):(M=a,a=m);a===m&&(a=M,48===b.charCodeAt(M)?(c=Ca,M++):(c=m,0===ga&&k(Wa)),c!==m?(d=x(),d===m&&(d=null),d!==m?(wa=a,a=0):(M=a,a=m)):(M=a,a=m));ga--;a===m&&(c=m,0===ga&&k(ub));
return a}function x(){var a,c;a=M;b.substr(M,2)===sb?(c=sb,M+=2):(c=m,0===ga&&k(Rb));c!==m&&(wa=a,c=1);a=c;a===m&&(a=M,b.substr(M,2)===Gb?(c=Gb,M+=2):(c=m,0===ga&&k(Ab)),c!==m&&(wa=a,c=96/2.54),a=c,a===m&&(a=M,b.substr(M,2)===Da?(c=Da,M+=2):(c=m,0===ga&&k(lc)),c!==m&&(wa=a,c=96/2.54/10),a=c,a===m&&(a=M,81===b.charCodeAt(M)?(c=Ba,M++):(c=m,0===ga&&k(Ia)),c!==m&&(wa=a,c=96/2.54/40),a=c,a===m&&(a=M,b.substr(M,2)===gb?(c=gb,M+=2):(c=m,0===ga&&k(Pa)),c!==m&&(wa=a,c=96),a=c,a===m&&(a=M,b.substr(M,2)===
Nb?(c=Nb,M+=2):(c=m,0===ga&&k(Ob)),c!==m&&(wa=a,c=16),a=c,a===m&&(a=M,b.substr(M,2)===Ub?(c=Ub,M+=2):(c=m,0===ga&&k(Wb)),c!==m&&(wa=a,c=96/73),a=c))))));return a}function v(){var a;Xb.test(b.charAt(M))?(a=b.charAt(M),M++):(a=m,0===ga&&k(yb));return a}function y(){var a,c;ga++;a=[];Jb.test(b.charAt(M))?(c=b.charAt(M),M++):(c=m,0===ga&&k(Kb));for(;c!==m;)a.push(c),Jb.test(b.charAt(M))?(c=b.charAt(M),M++):(c=m,0===ga&&k(Kb));ga--;a===m&&(c=m,0===ga&&k(Ib));return a}l=void 0!==l?l:{};var m={},w={start:n},
A=n,B=a("none"),C="none",E=f("none",!1),G=a("blur()"),J="blur(",I=f("blur(",!1),K=")",H=f(")",!1),L=a("brightness()"),P="brightness(",S=f("brightness(",!1),R=a("contrast()"),O="contrast(",Q=f("contrast(",!1),T=a("drop-shadow()"),Y="drop-shadow(",N=f("drop-shadow(",!1),Z=a("grayscale()"),W="grayscale(",aa=f("grayscale(",!1),V=a("hue-rotate()"),F="hue-rotate(",ca=f("hue-rotate(",!1),U=a("invert()"),ea="invert(",ha=f("invert(",!1),ka=a("opacity()"),ba="opacity(",qa=f("opacity(",!1),ja=a("saturate()"),
la="saturate(",ma=f("saturate(",!1),ta=a("sepia()"),ua="sepia(",sa=f("sepia(",!1),xa=a("\x3cnumber-percentage\x3e"),ra=a("\x3cinteger\x3e"),oa=/^[0-9]/,pa=h([["0","9"]],!1,!1),ia=a("\x3cnumber\x3e"),na=".",ya=f(".",!1),da=a("\x3csignedNumber\x3e"),Oa=/^[+\-]/,Ja=h(["+","-"],!1,!1),Ma="%",z=f("%",!1),tb=a("\x3cangle\x3e"),Ca="0",Wa=f("0",!1),jb=a("\x3cunit\x3e"),va="deg",bb=f("deg",!1),Na="grad",lb=f("grad",!1),kb="rad",Xa=f("rad",!1),Sa="turn",Va=f("turn",!1),ub=a("\x3clength\x3e"),sb="px",Rb=f("px",
!1),Gb="cm",Ab=f("cm",!1),Da="mm",lc=f("mm",!1),Ba="Q",Ia=f("Q",!1),gb="in",Pa=f("in",!1),Nb="pc",Ob=f("pc",!1),Ub="pt",Wb=f("pt",!1),fc="#",Cb=f("#",!1),Qa="rgba(",xb=f("rgba(",!1),ab=",",Ua=f(",",!1),Sb="rgb(",Pb=f("rgb(",!1),Xb=/^[0-9a-fA-F]/,yb=h([["0","9"],["a","f"],["A","F"]],!1,!1),Ib=a("whitespace"),Jb=/^[ \t\n\r]/,Kb=h([" ","\t","\n","\r"],!1,!1),gc=a("\x3cnamed-color\x3e"),hc=/^[a-z]/,Yb=h([["a","z"]],!1,!1),M=0,wa=0,Lb=[{line:1,column:1}],db=0,zb=[],ga=0,cb;if("startRule"in l){if(!(l.startRule in
w))throw Error("Can't start parsing from rule \""+l.startRule+'".');A=w[l.startRule]}var rc={transparent:[0,0,0,0],black:[0,0,0],silver:[192,192,192],gray:[128,128,128],white:[255,255,255],maroon:[128,0,0],red:[255,0,0],purple:[128,0,128],fuchsia:[255,0,255],green:[0,128,0],lime:[0,255,0],olive:[128,128,0],yellow:[255,255,0],navy:[0,0,128],blue:[0,0,255],teal:[0,128,128],aqua:[0,255,255],aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,
220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,
47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,
165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,
122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,
25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rebeccapurple:[102,51,153],rosybrown:[188,143,143],royalblue:[65,
105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]},sc=new Set(Object.keys(rc));
cb=A();if(cb!==m&&M===b.length)return cb;cb!==m&&M<b.length&&k({type:"end"});throw function(a,b,c){return new q(q.buildMessage(a,b),a,b,c)}(zb,db<b.length?b.charAt(db):null,db<b.length?d(db,db+1):d(db,db));}}})},"esri/views/layers/support/Transition":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4".split(" "),function(q,b,l,f,h,
a,e){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.from=null;a.to=null;a.duration=4E3;a.repeat=!0;a.done=!1;return a}f(d,b);h=d;d.prototype.getColorMatrix=function(){this.done=!1;if(null==this._lastTime)this._currentStep=0,this._lastTime=Date.now();else{var a=this._lastTime,b=Date.now();this._currentStep+=b-a;2147483647<=this._currentStep&&(this._currentStep=0);this._lastTime=b}var a=this._currentStep%this.duration/(this.duration/2),a=1>=a?a:2-a,b=this.from.getColorMatrix(),
d=this.to.getColorMatrix();e.mat4.multiplyScalar(b,b,1-a);e.mat4.multiplyScalar(d,d,a);!this.repeat&&this._currentStep>=this.duration&&(this.done=!0);return e.mat4.add(b,b,d)};d.prototype.getOpacity=function(){throw Error("No getOpacity definition for Transition");};d.prototype.clone=function(){var a=new h({from:this.from.clone(),to:this.to.clone(),duration:this.duration});a._lastTime=this._lastTime;a._currentStep=this._currentStep;return a};var h;l([a.property()],d.prototype,"from",void 0);l([a.property()],
d.prototype,"to",void 0);l([a.property({type:Number})],d.prototype,"duration",void 0);l([a.property({type:Boolean})],d.prototype,"repeat",void 0);return d=h=l([a.subclass("esri.views.layers.support.Transition")],d)}(a.declared(h))})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),function(q,b,l,f,h,a,
e){Object.defineProperty(b,"__esModule",{value:!0});b.getRequiredFields=function(b,k){void 0===k&&(k=b.popupTemplate);return f(this,void 0,void 0,function(){var d,c,f,q,p,u,t,x,v,y,m;return l(this,function(g){switch(g.label){case 0:return a.isSome(k)?[4,k.getRequiredFields(b.fields)]:[2,[]];case 1:d=g.sent();c=k.lastEditInfoEnabled;f=b.objectIdField;q=b.typeIdField;p=b.globalIdField;if(h.includes(d,"*"))return[2,["*"]];t=e.fixFields;x=[b.fields];y=(v=d).concat;return(m=c)?[4,e.getFeatureEditFields(b)]:
[3,3];case 2:m=g.sent(),g.label=3;case 3:return u=t.apply(void 0,x.concat([y.apply(v,[m||null])])),q&&u.push(q),u&&f&&e.hasField(b.fields,f)&&-1===u.indexOf(f)&&u.push(f),u&&p&&e.hasField(b.fields,p)&&-1===u.indexOf(p)&&u.push(p),[2,u]}})})};b.getFetchPopupTemplate=function(b,e){return b.popupTemplate?b.popupTemplate:a.isSome(e)&&e.defaultPopupTemplateEnabled&&a.isSome(b.defaultPopupTemplate)?b.defaultPopupTemplate:null}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../support/index ../../support/layerViewUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca){var U=r.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ea=Z.plane.create();q=function(b){function q(){var a=null!==b&&b.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._nodeScales=new Map;a._updateViewNeeded=!0;a._lodFactor=1;a._worker=new L.PointCloudWorker;a._maxLoggedBoxWarnings=5;a._pageMultiplier=
1;a._nodeLoadEpoch=0;a._indexQueue=[];a._workQueue=[];a._idleQueue=new I.PromiseQueue;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._codedDomainPopulationPromise=null;a._codedDomainPopulationAbortController=null;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}l(q,b);Object.defineProperty(q.prototype,"pointScale",{get:function(){var a=O.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:
1},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"useRealWorldSymbolSizes",{get:function(){var a=O.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"pointSize",{get:function(){var a=O.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"inverseDensity",{get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"availableFields",{get:function(){var a=O.getRendererInfo(this.layer),b=new Set;a.primaryAttribute&&b.add(a.primaryAttribute.name);a.modulationAttribute&&b.add(a.primaryAttribute.name);if(a=O.getFilterInfo(this.layer))for(var c=0;c<a.length;c++)b.add(a[c].attributeInfo.name);if(this.layer.outFields)for(a=0,c=J.unpackFieldNames(this.layer.fields,
this.layer.outFields);a<c.length;a++)b.add(c[a]);return g.valuesOfSet(b)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_clippingBox",{get:function(){if(!this.view||!this.view.clippingArea)return null;var a=A.create();return aa.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"_elevationOffset",{get:function(){var a=this.layer&&this.layer.elevationInfo;if(a&&"absolute-height"===
a.mode){var b=v.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=K.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});q.prototype.initialize=function(){var a=this;this._tmpPoint=C.makeDehydratedPoint(0,0,0,this.layer.spatialReference);P.checkPointCloudLayerValid(this.layer);P.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._initRenderer();var b=this._initNodePages(),c=this.view.resourceController.memoryController;this._memCache=
c.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"_elevationOffset",function(){return a._elevationOffsetChanged()},2);this.updatingHandles.add(this.layer,"renderer",function(){return a._rendererChanged()},2);this.updatingHandles.add(this.layer,"filters",function(){return a._reload()},2);this.updatingHandles.add(this.layer,"outFields",function(){return a._reload()},2);this.updatingHandles.add(this.layer,
"scaleRangeId",function(){return a._setUpdateViewNeeded()});this.updatingHandles.add(this,"clippingArea",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view.state,"camera",function(){return a._setUpdateViewNeeded()});this.handles.add([this.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),c.events.on("quality-changed",function(){return a._setUpdateViewNeeded()})]);this.addResolvingPromise(b);var d=this.view.resourceController.scheduler;
this.when(function(){a.handles.add([d.registerTask(F.Task.POINT_CLOUD_LAYER,function(b){return a._process(b)},function(){return a._needsUpdate()}),d.registerIdleStateCallbacks(function(){return a._idleBegin()},function(){return a._idleEnd()}),a.updatingHandles.add(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()},2)])},function(){a.updatingHandles.removeAll();a.handles.removeAll()})};q.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};
q.prototype.destroy=function(){this.cancelLoading();this._worker.destroy();this._worker=null;this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=null};q.prototype._initRenderer=function(){var a=this;this._renderer=new T.PointRenderer({createGraphic:function(b,c,d){return a._createGraphic(b,c,d)}});this._renderer.layerUid=
this.layer.uid;this.updatingHandles.add(this,"_clippingBox",function(b){return a._renderer.clippingBox=b},2);this.updatingHandles.add(this,"suspended",function(b){return a._setPointsVisible(!b)},2);this.updatingHandles.add(this,"pointScale",function(b){return a._renderer.scaleFactor=b},2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",function(b){return a._renderer.useRealWorldSymbolSizes=b},2);this.updatingHandles.add(this,"pointSize",function(b){var c=
t.pt2px(b);a._renderer.size=b;a._renderer.sizePx=c},2);this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._renderer.slicePlane=b},2);this.updatingHandles.add(this,"inverseDensity",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this,"maximumPointCount",function(){return a._setUpdateViewNeeded()},2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()},2)};q.prototype._destroyRenderer=
function(){this._renderer.removeAll();this._setPointsVisible(!1)};q.prototype._createGraphic=function(a,b,c){var d=p.isSome(a.pointIdFilterMap)?a.pointIdFilterMap[b]:b;c=this.view.computeMapPointFromVec3d(c);var e=this._createGraphicAttributes(a,d);return new Q.PointGraphic({pointCloudMetadata:{nodeId:a.id,pointIndexInNode:b,attributePointIndexInNode:d,epoch:this._nodeLoadEpoch},geometry:c,attributes:e,layer:this.layer,sourceLayer:this.layer})};q.prototype._createGraphicAttributes=function(a,b){var c=
{},d=0;for(a=a.attributes;d<a.length;d++){var e=a[d];this._encodeGraphicAttribute(e.attributeInfo,e.values,b,c)}return c};q.prototype._encodeGraphicAttribute=function(a,b,c,d){var e=a.storageInfo&&a.storageInfo.attributeValues,f=e?e.valuesPerElement:1;if(1===f)d[a.name]=b[c];else if("UInt8"===e.valueType&&4>=f){for(var e=0,g=c*=f;g<c+f;g++)e=(e<<8)+b[g];d[a.name]=e}else d[a.name]=void 0};q.prototype._setPointsVisible=function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([5],this._renderer),
this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};q.prototype._rendererChanged=function(){this._renderer.useFixedSizes=O.rendererUsesFixedSizes(this.layer.renderer);this._reload()};q.prototype._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};q.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};q.prototype._scaleUpdateHandler=
function(a){var b=this;this.layer.minScale||this.layer.maxScale?aa.boundingRectToBoundingRect(a.extent,a.spatialReference,ha,this.layer.spatialReference)&&(this._nodeScales.forEach(function(c,d){b._renderedNodes.has(d)?(c=b._index.getNode(d),B.containsPoint(ha,c.obb.center)&&b._nodeScales.set(d,a.scale)):b._nodeScales.delete(d)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};q.prototype.displayNodes=function(a){this._workQueue=S.nodeDiff(d.keysOfSet(this._renderedNodes),a,this._index);S.sortFrontToBack(this._workQueue,
this.view.state.camera.viewForward,this._index);S.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};q.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};q.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b.abortController)});this._loadingNodes.clear();
for(var b=0;b<a.length;b++)a[b].abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};q.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].abortController.abort();this._workQueue=this._workQueue.filter(function(b){var c=
0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};q.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.abortController.abort()});this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};q.prototype._clearNodeState=function(){var a=this;this._nodeLoadEpoch++;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});
this._cancelNodeLoading()};q.prototype._idleBegin=function(){this._setUpdateViewNeeded()};q.prototype._idleEnd=function(){this._setUpdateViewNeeded()};q.prototype._needsUpdate=function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};q.prototype._process=function(a){var b=this;if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&
(this._layerIsVisible=a,this.notifyChange("suspended")),this._updateLoading());else{for(a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length&&a.run(function(){return b._idleQueue.process()}););}};q.prototype._processIndexQueue=function(){var a=this,b=this._indexQueue.shift(),c=this._loadNodePage(b);this._indexPagesLoading.set(b,c);c.promise.then(function(c){a._index.addPage(b,
c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)});return!0};q.prototype._processWorkQueue=function(a){for(;!a.done;){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b);a.madeProgress()}};q.prototype._scheduleWorkEntry=function(){var a=this;if(8<=this._loadingNodes.size)return null;for(var b=0;b<this._workQueue.length;++b){var c=this._workQueue[b];if(!k.find(c.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<
b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return c}}return null};q.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0;c<a.remove.length;c++)this._removeFromRenderer(a.remove[c]);else u.all(a.load.map(function(a){var c=u.createAbortController(),d=b._memCache.pop(a.toString());d?b._loadingNodes.set(a,{abortController:c,promise:u.resolve(d)}):b._loadingNodes.has(a)||b._loadingNodes.set(a,{abortController:c,promise:b.loadNode(a,c.signal)});
return b._loadingNodes.get(a).promise})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}for(d=0;d<a.remove.length;d++)b._removeFromRenderer(a.remove[d])}).catch(function(){}).then(function(){for(var c=0;c<a.load.length;c++)b._loadingNodes.delete(a.load[c]);b._updateLoading()}),this._updateLoading()};q.prototype.populateClassCodeCodedDomain=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f;return h(this,function(g){switch(g.label){case 0:return a=
this.layer.fieldsIndex.get("CLASS_CODE"),!a||a.domain||-1===b.indexOf(a.name)?[2]:[4,n.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:c}))];case 1:d=g.sent();if(!1===d.ok)return[2];f=(e=d.value)&&e.labels&&e.labels.labels;if(!f||!Array.isArray(f))return[2];a.domain=new G.CodedValueDomain({name:"CLASS_CODE",codedValues:f.map(function(a){return new E.default({code:a.value,name:a.label})})});return[2]}})})};q.prototype.prepareFetchPopupFeatures=function(b){return a(this,void 0,void 0,function(){var a=
this;return h(this,function(c){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=u.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(b,this._codedDomainPopulationAbortController.signal).then(function(){a._codedDomainPopulationAbortController=null}));return[2,this._codedDomainPopulationPromise]})})};q.prototype.whenGraphicAttributes=function(b,c){return a(this,void 0,void 0,function(){var d,e,f,g,k,l=this;return h(this,function(m){switch(m.label){case 0:return d=
this._splitGraphicsPerNode(b),e=this.layer.attributeStorageInfo,f=c.map(function(a){return O.getAttributeInfo(e,a)}),g=function(b,c){return a(l,void 0,void 0,function(){var d,e=this;return h(this,function(g){switch(g.label){case 0:return d=this._index.getNode(c),[4,n.forEach(f,function(c){return a(e,void 0,void 0,function(){var a,e,f,g,k,l;return h(this,function(h){switch(h.label){case 0:return c.useElevation?[4,this._loadElevationAttributeFromGeometry(d.resourceId)]:[3,2];case 1:return e=h.sent(),
[3,4];case 2:return[4,this._loadAndParseAttribute(d,c)];case 3:e=h.sent(),h.label=4;case 4:a=e;if(!a)return[2];f=0;for(g=b;f<g.length;f++)k=g[f],this._isValidPointGraphic(k)&&(l=k.pointCloudMetadata.attributePointIndexInNode,this._encodeGraphicAttribute(c,a,l,k.attributes));return[2]}})})})];case 1:return g.sent(),[2]}})})},k=[],d.forEach(function(a,b){k.push(g(a,b))}),[4,u.eachAlways(k)];case 1:return m.sent(),[2,b]}})})};q.prototype._isValidPointGraphic=function(a){return a instanceof Q.PointGraphic&&
a.pointCloudMetadata&&a.pointCloudMetadata.epoch===this._nodeLoadEpoch};q.prototype._splitGraphicsPerNode=function(a){for(var b=new Map,c=0;c<a.length;c++){var d=a[c];if(this._isValidPointGraphic(d)){var e=d.pointCloudMetadata,f=b.get(e.nodeId);f?f.push(d):b.set(e.nodeId,[d])}}return b};q.prototype._loadAndParseAttribute=function(b,c){return a(this,void 0,void 0,function(){var a;return h(this,function(d){switch(d.label){case 0:return[4,this.loadAttribute(b.resourceId,c,null)];case 1:return a=d.sent(),
[2,p.isSome(a)?O.getAttributeValues({attributeInfo:c,buffer:a},null,b.vertexCount):null]}})})};q.prototype._loadElevationAttributeFromGeometry=function(b){return a(this,void 0,void 0,function(){var a,c,d,e;return h(this,function(f){switch(f.label){case 0:return a=this.layer.store.defaultGeometrySchema,d=O.readGeometry,e=[a],[4,this.loadGeometry(b,null)];case 1:return c=d.apply(void 0,e.concat([f.sent()])),[2,O.elevationFromPositions(c,c.length/3)]}})})};q.prototype.highlight=function(a,b){var d=this;
void 0===b&&(b={});if(!a)return{remove:function(){},pause:function(){},resume:function(){}};a=c.isCollection(a)?a.toArray():Array.isArray(a)?a:[a];return this._renderer.highlight(a.map(function(a){return d._graphicToPointDefinition(a)}),b)};q.prototype._graphicToPointDefinition=function(a){if(!this._isValidPointGraphic(a))return null;var b=a.pointCloudMetadata;a=b.nodeId;b=b.pointIndexInNode;return null!=a&&null!=b?{nodeId:a,pointId:b}:null};q.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=
this._workQueue[b].load.length;a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(q.prototype,"updatingProgressValue",{get:function(){if(this.suspended)return this._updateViewNeeded?0:1;var a=this._computeWork();return 1-Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});q.prototype._updateLoading=function(){this.notifyChange("updating");
this.notifyChange("updatingProgressValue")};q.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible};q.prototype.isUpdating=function(){return 0<this._computeWork()};q.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new R(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=
this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).promise.then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};q.prototype._loadNodePage=function(a){var b=this,c=u.createAbortController();return{promise:this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier,c.signal).then(function(c){return c.data.nodes.map(function(c,
d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})}),abortController:c}};q.prototype._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=
this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading();return!0};q.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};q.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};
q.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(b,c,d){a=d;return!1},pageMiss:function(){}});return a};q.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,f=c.viewForward,g=m.vec3.dot(f,c.eye),h=Z.plane.fromNormalAndOffset(f,-g,ea),k=c.perScreenPixelRatio/2,l=a*a,n=this._nodeIdArray;n.length=0;a=ca.extractSafeScaleBounds(this.layer);
var p=a.minScale,q=a.maxScale,r=0===p&&0===q?function(a){return n.push(a)}:function(a){var c=b._getScale(a);ca.scaleBoundsPredicate(c,p,q)&&n.push(a)};this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return r(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(r(a),!1):!0},pageMiss:function(a,c){r(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return n};q.prototype._getScale=
function(a){var b=this._nodeScales.get(a);null==b&&(b=this._index.getNode(a).obb.center,this._tmpPoint.x=b[0],this._tmpPoint.y=b[1],this._tmpPoint.z=b[2],b=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(a,b));return b};q.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,W.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};q.prototype.loadNode=function(b,c){return a(this,void 0,void 0,function(){return h(this,function(a){try{return[2,this.loadNodeAsync(b,
c)]}catch(ta){throw u.isAbortError(ta)||U.error(ta),ta;}})})};q.prototype.loadAdditionalUserAttributes=function(b,c,d){return a(this,void 0,void 0,function(){var a,e,f,k,l,m,n,q,r,t;return h(this,function(h){switch(h.label){case 0:a=this.layer.outFields;if(!a)return[2,[]];e=J.unpackFieldNames(this.layer.fields,a);f=g.createSetFromValues(b.map(function(a){return p.isSome(a)?a.name:null}));k=this.layer.attributeStorageInfo;l=[];m=0;for(n=e;m<n.length;m++)q=n[m],f.has(q)||(r=O.getAttributeInfo(k,q))&&
l.push(c(r));return[4,u.eachAlwaysValues(l)];case 1:return t=h.sent(),u.throwIfAborted(d),[2,p.mapSome(t,function(a){return a})]}})})};q.prototype.loadNodeAsync=function(b,c){return a(this,void 0,void 0,function(){var d,e,f,g,k,l,m,n,q,r,t,w,v,x,y,A,B,C,E,G,N,F,J,I,H,K,P=this;return h(this,function(z){switch(z.label){case 0:return d=this._index.getNode(b),e=O.getRendererInfo(this.layer),f=O.getFilterInfo(this.layer),g=d.resourceId,k=function(b){return a(P,void 0,void 0,function(){var a;return h(this,
function(d){switch(d.label){case 0:return p.isNone(b)?[2,null]:b.useElevation?[2,{attributeInfo:b,buffer:null}]:[4,this.loadAttribute(g,b,c)];case 1:return a=d.sent(),[2,p.isSome(a)?{attributeInfo:b,buffer:a}:null]}})})},[4,this._idleQueue.push()];case 1:return z.sent(),l=this.loadGeometry(g,c),m=e.primaryAttribute,n=e.modulationAttribute,q=k(m),r=k(n),t=f.map(function(a){return a.attributeInfo}),w=t.map(function(a){return k(a)}),v=this.loadAdditionalUserAttributes([m,n].concat(t),k,c),[4,l];case 2:return x=
z.sent(),[4,q];case 3:return y=z.sent(),[4,r];case 4:return A=z.sent(),[4,u.all(w)];case 5:return B=z.sent(),[4,v];case 6:C=z.sent();u.throwIfAborted(c);E=[x];p.isSome(y)&&y.buffer&&E.push(y.buffer);p.isSome(A)&&A.buffer&&E.push(A.buffer);G=0;for(N=B;G<N.length;G++)F=N[G],p.isSome(F)&&F.buffer&&E.push(F.buffer);J=0;for(I=C;J<I.length;J++)F=I[J],F.buffer&&E.push(F.buffer);H={geometryBuffer:x,primaryAttributeData:y,modulationAttributeData:A,filterAttributesData:B,userAttributesData:C,schema:this.layer.store.defaultGeometrySchema,
rendererInfo:e,filterInfo:f,obb:this._index.getRenderObb(b),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return[4,this._worker.transform(H,E,c)];case 7:return K=z.sent(),[2,K]}})})};q.prototype.loadGeometry=function(b,c){return a(this,void 0,void 0,function(){var a,d;return h(this,function(e){switch(e.label){case 0:return a=this.baseUrl+"/nodes/"+b+"/geometries/0",[4,this._requestBinary(a,c)];case 1:return d=
e.sent(),[2,d.data]}})})};q.prototype.loadAttribute=function(b,c,d){return a(this,void 0,void 0,function(){var a,e,f;return h(this,function(g){switch(g.label){case 0:if(p.isNone(c)||!c.storageInfo)return[2,null];a=c.storageInfo.key;e=this.baseUrl+"/nodes/"+b+"/attributes/"+a;return[4,this._requestBinary(e,d)];case 1:return f=g.sent(),[2,f.data]}})})};q.prototype._requestJSON=function(a,b){return e(a,{query:{f:"json"},responseType:"json",signal:b})};q.prototype._requestBinary=function(a,b){return e(a,
{responseType:"array-buffer",signal:b})};q.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._nodeScales.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};q.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};q.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/
c.vertexCount),e=this._index.getRenderObb(a);if(T.PointRenderer.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=w.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>1.001*e.halfSize[0]||b.obb.halfSize[1]>1.001*e.halfSize[1]||b.obb.halfSize[2]>1.001*e.halfSize[2]){if(0<this._maxLoggedBoxWarnings){var f=function(a){return"["+a.halfSize[0]+", "+a.halfSize[1]+", "+a.halfSize[2]+"]"};U.warn("Node "+a+" reported bounding box too small. got "+f(e)+" but points cover "+f(b.obb));0===--this._maxLoggedBoxWarnings&&
U.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(a,b.obb)}return{id:a,coordinates:b.points,origin:w.vec3f32.clone(e.center),rgb:b.rgb,attributes:b.attributes,pointIdFilterMap:b.pointIdFilterMap,highlights:null,splatSize:d,obb:e,isLeaf:0===c.childCount}};q.prototype.getUsedMemory=function(){var a=0;this._renderer.forEachNode(function(b){a+=ka;a+=x.estimateSize(b.coordinates);var c=0;for(b=b.attributes;c<b.length;c++){var d=b[c].values;x.isArrayBuffer(d.buffer)&&
(a+=x.estimateSize(d))}});return a};q.prototype.getUnloadedMemory=function(){var a=this,b=this._renderedNodes.size;if(4>b)return 0;for(var c=d.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),e=this._loadingNodes.size,f=0;f<this._workQueue.length;f++)e+=this._workQueue[f].load.length,e-=this._workQueue[f].remove.length;if(0>e)return 0;f=e*c/b;b=(this.getUsedMemory()-b*ka)/c;return f*b+e*ka};q.prototype.ignoresMemoryFactor=function(){return!1};q.prototype.getStats=
function(){var a=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":d.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}};f([y.property()],q.prototype,"layer",void 0);f([y.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],q.prototype,"baseUrl",void 0);f([y.property({readOnly:!0,
dependsOn:["layer.renderer"]})],q.prototype,"pointScale",null);f([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],q.prototype,"useRealWorldSymbolSizes",null);f([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],q.prototype,"pointSize",null);f([y.property({readOnly:!0,dependsOn:["layer.renderer"]})],q.prototype,"inverseDensity",null);f([y.property()],q.prototype,"maximumPointCount",void 0);f([y.property({readOnly:!0,dependsOn:["layer.renderer","layer.filters","layer.outFields"]})],q.prototype,
"availableFields",null);f([y.property({readOnly:!0,dependsOn:["view.clippingArea"]})],q.prototype,"_clippingBox",null);f([y.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],q.prototype,"_elevationOffset",null);f([y.property({type:Boolean})],q.prototype,"slicePlaneEnabled",void 0);f([y.property()],q.prototype,"updating",void 0);f([y.property(Y.updatingProgress)],q.prototype,"updatingProgress",void 0);f([y.property({readOnly:!0,dependsOn:["suspended"]})],q.prototype,"updatingProgressValue",
null);return q=f([y.subclass("esri.views.3d.layers.PointCloudLayerView3D")],q)}(y.declared(N.PopupSceneLayerView(H.LayerView3D(V))));var ha=B.create(),ka=160;return q})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/typedArrayUtil ../../../core/workers ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f32 ../../../geometry/SpatialReference ./i3s/PointCloudRendererUtil ../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){Object.defineProperty(b,"__esModule",{value:!0});var u=function(){function b(){}b.prototype._process=function(b){b=this._transform(b);var c=[b.points.buffer,b.rgb.buffer];f.isSome(b.pointIdFilterMap)&&c.push(b.pointIdFilterMap.buffer);for(var d=0,e=b.attributes;d<e.length;d++){var g=e[d];"buffer"in g.values&&a.isArrayBuffer(g.values.buffer)&&g.values.buffer!==b.rgb.buffer&&c.push(g.values.buffer)}return h.resolve({result:b,transferList:c})};b.prototype._transform=
function(a){var b=r.readGeometry(a.schema,a.geometryBuffer),c=b.length/3,d=null,e=[],h=r.getAttributeValues(a.primaryAttributeData,b,c);f.isSome(a.primaryAttributeData)&&h&&e.push({attributeInfo:a.primaryAttributeData.attributeInfo,values:h});var k=r.getAttributeValues(a.modulationAttributeData,b,c);f.isSome(a.modulationAttributeData)&&k&&e.push({attributeInfo:a.modulationAttributeData.attributeInfo,values:k});h=r.evaluateRenderer(a.rendererInfo,h,k,c);a.filterInfo&&0<a.filterInfo.length&&f.isSome(a.filterAttributesData)&&
(k=a.filterAttributesData.map(function(a){var d=r.getAttributeValues(a,b,c);a={attributeInfo:a.attributeInfo,values:d};e.push(a);return a}),d=new Uint32Array(c),c=r.filterInPlace(b,h,d,a.filterInfo,k));for(var k=0,l=a.userAttributesData;k<l.length;k++){var n=l[k],p=r.getAttributeValues(n,b,c);e.push({attributeInfo:n.attributeInfo,values:p})}3*c<h.length&&(h=new Uint8Array(h.buffer.slice(0,3*c)));this._applyElevationOffsetInPlace(b,c,a.elevationOffset);k=this._transformCoordinates(b,c,a.obb,g.fromJSON(a.inSR),
g.fromJSON(a.outSR));return{obb:a.obb,points:k,rgb:h,attributes:e,pointIdFilterMap:d}};b.prototype._transformCoordinates=function(a,b,e,f,g){if(!p.bufferToBuffer(a,f,0,a,g,0,b))throw Error("Can't reproject");f=c.vec3f32.fromValues(e.center[0],e.center[1],e.center[2]);g=c.vec3f32.create();var h=c.vec3f32.create();d.quat.conjugate(t,e.quaternion);for(var k=new Float32Array(3*b),l=0;l<b;l++)g[0]=a[3*l]-f[0],g[1]=a[3*l+1]-f[1],g[2]=a[3*l+2]-f[2],n.vec3.transformQuat(h,g,t),e.halfSize[0]=Math.max(e.halfSize[0],
Math.abs(h[0])),e.halfSize[1]=Math.max(e.halfSize[1],Math.abs(h[1])),e.halfSize[2]=Math.max(e.halfSize[2],Math.abs(h[2])),k[3*l]=g[0],k[3*l+1]=g[1],k[3*l+2]=g[2];return k};b.prototype._applyElevationOffsetInPlace=function(a,b,c){if(0!==c)for(var d=0;d<b;d++)a[3*d+2]+=c};return b}(),t=k.quatf32.create();q=function(a){function b(){var b=a.call(this)||this;b._thread=void 0;e.open("PointCloudWorker").then(function(a){void 0===b._thread?b._thread=a:a.close()});return b}l(b,a);b.prototype.destroy=function(){this._thread&&
this._thread.close();this._thread=null};b.prototype.transform=function(a,b,c){return this._thread?this._thread.invoke("_process",a,{transferList:b,signal:c}):h.resolve(this._transform(a))};return b}(u);b.PointCloudWorker=q;b.default=function(){return new u}})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(q,b,l,f,h,a,e,d){function k(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=1<<a[c];return b}function n(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{name:b,storageInfo:d,useElevation:!1}}return null}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{name:b,storageInfo:a?null:d,useElevation:a}}return"elevation"===
b.toLowerCase()?{name:b,storageInfo:null,useElevation:!0}:null}function g(a,b){for(var c=new Float64Array(b),d=0;d<b;d++)c[d]=a[3*d+2];return c}function r(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(b,"__esModule",{value:!0});b.getRendererInfo=function(a){var b=a.renderer,d=b&&b.type,e=b&&a.renderer.toJSON()||
null,f=null,g=!1;"point-cloud-unique-value"===d?f=c(a.attributeStorageInfo,b.field):"point-cloud-stretch"===d?f=c(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===d?f=c(a.attributeStorageInfo,b.field):(f="point-cloud-rgb"===d?n(a.attributeStorageInfo,b.field):n(a.attributeStorageInfo,"RGB"),g=null!=f);d=null;b&&b.colorModulation&&(d=c(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:e,isRGBRenderer:g,primaryAttribute:f,modulationAttribute:d}};b.getFilterInfo=function(a){var b=
a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:c(a.attributeStorageInfo,b.field)}}):[]};b.evaluateRenderer=function(b,c,d,e){var g=b.rendererJSON,k=b.isRGBRenderer,l=b=null;if(c&&k)b=c;else if(c&&"pointCloudUniqueValueRenderer"===g.type){var l=a.fromJSON(g),n=l.colorUniqueValueInfos;b=new Uint8Array(3*e);k=r(l.fieldTransformType);for(g=0;g<e;g++)for(var p=k?k(c[g]):c[g],p=p+"",q=0;q<n.length;q++)if(0<=n[q].values.indexOf(p)){b[3*g]=n[q].color.r;b[3*g+1]=n[q].color.g;
b[3*g+2]=n[q].color.b;break}}else if(c&&"pointCloudStretchRenderer"===g.type)for(l=h.fromJSON(g),n=l.stops,b=new Uint8Array(3*e),k=r(l.fieldTransformType),g=0;g<e;g++)if(p=k?k(c[g]):c[g],q=n.length-1,p<n[0].value)b[3*g]=n[0].color.r,b[3*g+1]=n[0].color.g,b[3*g+2]=n[0].color.b;else if(p>=n[q].value)b[3*g]=n[q].color.r,b[3*g+1]=n[q].color.g,b[3*g+2]=n[q].color.b;else for(q=1;q<n.length;q++){if(p<n[q].value){p=(p-n[q-1].value)/(n[q].value-n[q-1].value);b[3*g]=n[q].color.r*p+n[q-1].color.r*(1-p);b[3*
g+1]=n[q].color.g*p+n[q-1].color.g*(1-p);b[3*g+2]=n[q].color.b*p+n[q-1].color.b*(1-p);break}}else if(c&&"pointCloudClassBreaksRenderer"===g.type)for(l=f.fromJSON(g),n=l.colorClassBreakInfos,b=new Uint8Array(3*e),k=r(l.fieldTransformType),g=0;g<e;g++)for(p=k?k(c[g]):c[g],q=0;q<n.length;q++){if(p>=n[q].minValue&&p<=n[q].maxValue){b[3*g]=n[q].color.r;b[3*g+1]=n[q].color.g;b[3*g+2]=n[q].color.b;break}}else for(b=new Uint8Array(3*e),g=0;g<b.length;g++)b[g]=255;if(d&&l&&l.colorModulation)for(c=l.colorModulation.minValue,
l=l.colorModulation.maxValue,g=0;g<e;g++)p=d[g],k=p>=l?1:p<=c?.3:.3+.7*(p-c)/(l-c),b[3*g]*=k,b[3*g+1]*=k,b[3*g+2]*=k;return b};b.filterInPlace=function(a,b,c,d,e){for(var f=a.length/3,g=0,h=0;h<f;h++){for(var l=!0,n=0;n<d.length&&l;n++){var p=d[n].filterJSON,q=e[n].values[h];switch(p.type){case "pointCloudValueFilter":var r="exclude"===p.mode;-1!==p.values.indexOf(q)===r&&(l=!1);break;case "pointCloudBitfieldFilter":r=k(p.requiredSetBits);p=k(p.requiredClearBits);if((q&r)!==r||0!==(q&p))l=!1;break;
case "pointCloudReturnFilter":for(var t=q&15,u=q>>>4&15,q=1<u,r=1===t,t=t===u,u=!1,v=0,p=p.includedReturns;v<p.length;v++){var x=p[v];if("last"===x&&t||"firstOfMany"===x&&r&&q||"lastOfMany"===x&&t&&q||"single"===x&&!q){u=!0;break}}u||(l=!1)}}l&&(c[g]=h,a[3*g]=a[3*h],a[3*g+1]=a[3*h+1],a[3*g+2]=a[3*h+2],b[3*g]=b[3*h],b[3*g+1]=b[3*h+1],b[3*g+2]=b[3*h+2],g++)}return g};b.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};b.getFixedSizeAlgorithm=function(a){return(a=
a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};b.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1};b.getAttributeInfo=c;b.elevationFromPositions=g;b.getAttributeValues=function(a,b,c){return l.isSome(a)&&a.attributeInfo.useElevation?g(b,c):l.isSome(a)?e.readBinaryAttribute(a.attributeInfo.storageInfo,a.buffer,c):null};b.readGeometry=function(a,b){if(null==a.encoding||""===a.encoding){a=e.createGeometryIndexFromSchema(b,a);b=e.createTypedView(b,
a.vertexAttributes.position);var c=a.header.fields;a=[c.offsetX,c.offsetY,c.offsetZ];for(var c=[c.scaleX,c.scaleY,c.scaleZ],f=b.length/3,g=new Float64Array(3*f),h=0;h<f;h++)g[3*h]=b[3*h]*c[0]+a[0],g[3*h+1]=b[3*h+1]*c[1]+a[1],g[3*h+2]=b[3*h+2]*c[2]+a[2];return g}if("lepcc-xyz"===a.encoding)return d.decodeXYZ(b).result}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(a){a=b.call(this,a)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}f(c,b);q=c;c.prototype.clone=function(){return new q(l({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:a.clone(this.colorClassBreakInfos),legendOptions:a.clone(this.legendOptions)}))};var q;h([e.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
c.prototype,"type",void 0);h([e.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([e.property({type:k.default,json:{write:!0}})],c.prototype,"legendOptions",void 0);h([e.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([e.property({type:[n.default],json:{write:!0}})],c.prototype,"colorClassBreakInfos",
void 0);return c=q=h([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],c)}(e.declared(d))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(q,b,l,f,h,a,e,
d,k,n,c){var g=h.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});q=function(a){function b(b){b=a.call(this,b)||this;b.type=void 0;b.pointSizeAlgorithm=null;b.colorModulation=null;b.pointsPerInch=10;return b}l(b,a);b.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};b.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:e.clone(this.pointSizeAlgorithm),colorModulation:e.clone(this.colorModulation),pointsPerInch:e.clone(this.pointsPerInch)}};f([d.property({type:g.apiValues,readOnly:!0,nonNullable:!0,json:{type:g.jsonValues,read:!1,write:g.write}})],b.prototype,"type",void 0);f([d.property({types:c.pointSizeAlgorithmTypes,json:{read:n.read,write:!0}})],b.prototype,"pointSizeAlgorithm",void 0);f([d.property({type:k.default,json:{write:!0}})],b.prototype,"colorModulation",void 0);
f([d.property({json:{write:!0},nonNullable:!0,type:Number})],b.prototype,"pointsPerInch",void 0);return b=f([d.subclass("esri.renderers.PointCloudRenderer")],b)}(d.declared(a.JSONSupport));(q||(q={})).fieldTransformTypeKebabDict=new h.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return q})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}l(d,b);e=d;d.prototype.clone=function(){return new e({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var e;f([a.property({type:String,json:{write:!0}})],d.prototype,"field",void 0);f([a.property({type:Number,nonNullable:!0,json:{write:!0}})],d.prototype,"minValue",void 0);f([a.property({type:Number,
nonNullable:!0,json:{write:!0}})],d.prototype,"maxValue",void 0);return d=e=f([a.subclass("esri.renderers.support.pointCloud.ColorModulation")],d)}(a.declared(h.JSONSupport));b.ColorModulation=q;b.default=q})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});var a={pointCloudFixedSizeAlgorithm:f.default,
pointCloudSplatAlgorithm:h.default};b.read=function(b,d,f){if(d=b?a[b.type]||null:null)return d=new d,d.read(b,f),d;f&&f.messages&&b&&f.messages.push(new l("pointsizealgorithm:unsupported","Point size algorithms of type '"+(b.type||"unknown")+"' are not supported",{definition:b,context:f}));return null};b.fromJSON=function(b){var d=b?a[b.type]||null:null;return d?d.fromJSON(b):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="fixed-size";b.size=0;b.useRealWorldSymbolSizes=null;return b}l(b,a);e=b;b.prototype.clone=function(){return new e({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var e;f([h.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],b.prototype,"type",void 0);f([h.property({type:Number,nonNullable:!0,json:{write:!0}})],
b.prototype,"size",void 0);f([h.property({type:Boolean,json:{write:!0}})],b.prototype,"useRealWorldSymbolSizes",void 0);return b=e=f([h.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],b)}(h.declared(a.default));b.PointSizeFixedSizeAlgorithm=q;b.default=q})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});b.typeKebabDictionary=new h.default({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});q=function(a){function d(){return null!==a&&a.apply(this,arguments)||this}l(d,a);f([e.property({type:b.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.typeKebabDictionary.jsonValues,read:!1,write:b.typeKebabDictionary.write}})],d.prototype,"type",void 0);return d=f([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
d)}(e.declared(a.JSONSupport));b.PointSizeAlgorithm=q;b.default=q})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.type="splat";b.scaleFactor=1;return b}
l(b,a);e=b;b.prototype.clone=function(){return new e({scaleFactor:this.scaleFactor})};var e;f([h.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],b.prototype,"type",void 0);f([h.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],b.prototype,"scaleFactor",void 0);return b=e=f([h.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],b)}(h.declared(a.default));b.PointSizeSplatAlgorithm=q;b.default=q})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});b.pointSizeAlgorithmTypes={key:"type",base:l.default,typeMap:{"fixed-size":f.default,splat:h.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.minValue=0;b.maxValue=0;b.color=null;return b}l(b,a);g=b;b.prototype.clone=function(){return new g({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:e.clone(this.color)})};var g;f([d.property({type:String,json:{write:!0}})],b.prototype,"description",void 0);f([d.property({type:String,
json:{write:!0}})],b.prototype,"label",void 0);f([d.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],b.prototype,"minValue",void 0);f([d.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],b.prototype,"maxValue",void 0);f([d.property({type:h,json:{type:[k.Integer],write:!0}})],b.prototype,"color",void 0);return b=g=f([d.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],b)}(d.declared(a.JSONSupport));
b.ColorClassBreakInfo=q;b.default=q})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(a){a=b.call(this,a)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;
a.fieldTransformType=null;a.stops=null;return a}f(c,b);q=c;c.prototype.clone=function(){return new q(l({},this.cloneProperties(),{field:a.clone(this.field),fieldTransformType:a.clone(this.fieldTransformType),stops:a.clone(this.stops),legendOptions:a.clone(this.legendOptions)}))};var q;h([e.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],c.prototype,"type",void 0);h([e.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([e.property({type:k.default,
json:{write:!0}})],c.prototype,"legendOptions",void 0);h([e.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([e.property({type:[n.default],json:{write:!0}})],c.prototype,"stops",void 0);return c=q=h([e.subclass("esri.renderers.PointCloudStretchRenderer")],c)}(e.declared(d))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.label=null;b.value=0;b.color=null;return b}l(b,a);g=b;b.prototype.clone=function(){return new g({label:this.label,value:this.value,color:e.clone(this.color)})};var g;f([d.property({type:String,json:{write:!0}})],b.prototype,"label",void 0);f([d.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"value",void 0);f([d.property({type:h,
json:{type:[k.Integer],write:!0}})],b.prototype,"color",void 0);return b=g=f([d.subclass("esri.renderers.support.pointCloud.StopInfo")],b)}(d.declared(a.JSONSupport));b.StopInfo=q;b.default=q})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(q,b,l,f,h,a,e,d,k,n){return function(b){function c(a){a=b.call(this,a)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}f(c,b);q=c;c.prototype.clone=function(){return new q(l({},this.cloneProperties(),{field:a.clone(this.field),fieldTransformType:a.clone(this.fieldTransformType),colorUniqueValueInfos:a.clone(this.colorUniqueValueInfos),legendOptions:a.clone(this.legendOptions)}))};var q;h([e.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
c.prototype,"type",void 0);h([e.property({json:{write:!0},type:String})],c.prototype,"field",void 0);h([e.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],c.prototype,"fieldTransformType",void 0);h([e.property({type:[n.default],json:{write:!0}})],c.prototype,"colorUniqueValueInfos",void 0);h([e.property({type:k.default,json:{write:!0}})],c.prototype,"legendOptions",
void 0);return c=q=h([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],c)}(e.declared(d))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(q,b,l,f,h,a,e,d,k){Object.defineProperty(b,"__esModule",{value:!0});
q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.description=null;b.label=null;b.values=null;b.color=null;return b}l(b,a);g=b;b.prototype.clone=function(){return new g({description:this.description,label:this.label,values:e.clone(this.values),color:e.clone(this.color)})};var g;f([d.property({type:String,json:{write:!0}})],b.prototype,"description",void 0);f([d.property({type:String,json:{write:!0}})],b.prototype,"label",void 0);f([d.property({type:[String],json:{write:!0}})],
b.prototype,"values",void 0);f([d.property({type:h,json:{type:[k.Integer],write:!0}})],b.prototype,"color",void 0);return b=g=f([d.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],b)}(d.declared(a.JSONSupport));b.ColorUniqueValueInfo=q;b.default=q})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/maybe ./LEPCC".split(" "),function(q,
b,l,f,h,a,e,d){function k(a,b,c){for(var d="",e=0;e<c;){var g=a[b+e];if(128>g)d+=String.fromCharCode(g),e++;else if(192<=g&&224>g){if(e+1>=c)throw new f("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var h=a[b+e+1],g=(g&31)<<6|h&63,d=d+String.fromCharCode(g),e=e+2}else if(224<=g&&240>g){if(e+2>=c)throw new f("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var h=a[b+e+1],k=a[b+e+2],g=(g&15)<<12|(h&63)<<6|k&63,d=d+String.fromCharCode(g),
e=e+3}else if(240<=g&&248>g){if(e+3>=c)throw new f("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");h=a[b+e+1];k=a[b+e+2];g=(g&7)<<18|(h&63)<<12|(k&63)<<6|a[b+e+3]&63;d=65536<=g?d+String.fromCharCode((g-65536>>10)+55296,(g&1023)+56320):d+String.fromCharCode(g);e+=4}else throw new f("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function n(a,c){for(var d={byteOffset:0,byteCount:0,fields:Object.create(null)},e=0,f=0;f<c.length;f++){var g=
c[f],h=g.valueType||g.type;d.fields[g.property]=(0,b.valueType2ArrayBufferReader[h])(a,e);e+=b.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}d.byteCount=e;return d}function c(a,b,c){var d=[],e,g=0,h;for(h=0;h<a;h+=1){e=b[h];if(0<e){if(d.push(k(c,g,e-1)),0!==c[g+e-1])throw new f("string-array-error","Invalid string array: missing null termination.");}else d.push(null);g+=e}return d}function g(a,c){return new b.valueType2TypedArrayClassMap[c.valueType](a,c.byteOffset,c.count*c.valuesPerElement)}
function r(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function p(a,b,c){a=null!=b.header?n(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};for(var d=a.byteCount,e=0;e<b.ordering.length;e++){var g=b.ordering[e],k=h.clone(b[g]);k.count=a.fields.count;if("String"===k.valueType){if(k.byteOffset=d,k.byteCount=a.fields[g+"ByteCount"],"UTF-8"!==k.encoding)throw new f("unsupported-encoding","Unsupported String encoding.",
{encoding:k.encoding});}else if(t(k.valueType)){var l=x(k.valueType),d=d+(0!==d%l?l-d%l:0);k.byteOffset=d;k.byteCount=l*k.valuesPerElement*k.count}else throw new f("unsupported-value-type","Unsupported binary valueType",{valueType:k.valueType});d+=k.byteCount;c.entries[g]=k}c.byteCount=d-c.byteOffset;return c}function u(a,b,c){b!==a&&v.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new f("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});
}function t(a){return b.valueType2TypedArrayClassMap.hasOwnProperty(a)}function x(a){return t(a)?b.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT:0}Object.defineProperty(b,"__esModule",{value:!0});var v=a.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");b.readHeader=n;b.readStringArray=c;b.createTypedView=g;b.createRawView=r;b.createAttributeDataIndex=p;b.createGeometryIndexFromDefinition=function(a,b,c){var d={header:{byteOffset:0,byteCount:a.offset,fields:{}},byteOffset:a.offset,byteCount:0,
vertexAttributes:{},featureAttributes:{}},f=a.offset,g=function(a,b,c,d){var e="UInt64"===b.type?8:x(b.type);b={byteOffset:f,byteCount:e*b.component*c,count:c,valueType:b.type,valuesPerElement:b.component};f+=b.byteCount;d[a]=b},h;for(h in y)a[h]&&g(y[h],a[h],b,d.vertexAttributes);if(e.isSome(c))for(var k in m)a[k]&&g(m[k],a[k],c,d.featureAttributes);return d};var y={position:"position",normal:"normal",uv0:"uv0",color:"color",uvRegion:"uvRegion"},m={featureId:"id",faceRange:"faceRange"};b.createGeometryIndexFromSchema=
function(a,b){for(var c=n(a,b&&b.header),d=c.byteCount,e={header:c,byteOffset:c.byteCount,byteCount:0,vertexAttributes:{}},f=c.fields,g=null!=f.vertexCount?f.vertexCount:f.count,h=0,k=b.ordering;h<k.length;h++){var m=k[h];b.vertexAttributes[m]&&(c=l({},b.vertexAttributes[m],{byteOffset:d,count:g}),e.vertexAttributes[A[m]?A[m]:"_"+m]=c,d+=x(c.valueType)*c.valuesPerElement*g)}g=f.faceCount;if(b.faces&&g)for(e.faces={},h=0,k=b.ordering;h<k.length;h++)m=k[h],b.faces[m]&&(c=l({},b.faces[m],{byteOffset:d,
count:g}),e.faces[m]=c,d+=x(c.valueType)*c.valuesPerElement*g);f=f.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&f)for(e.featureAttributes={},g=0,h=b.featureAttributeOrder;g<h.length;g++)k=h[g],b.featureAttributes[k]&&(c=l({},b.featureAttributes[k],{byteOffset:d,count:f}),e.featureAttributes[k]=c,k="UInt64"===c.valueType?8:x(c.valueType),d+=k*c.valuesPerElement*f);u(d,a.byteLength,"geometry");e.byteCount=d-e.byteOffset;return e};var w={position:"position",normal:"normal",uv0:"uv0",
color:"color","uv-region":"uvRegion"};b.createGeometryIndexFromAttributes=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];w[d]&&(b[w[d]]={valueType:null})}return{header:null,byteOffset:0,byteCount:0,vertexAttributes:b}};var A={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"};b.readBinaryAttribute=function(a,b,e){if("lepcc-rgb"===a.encoding)return d.decodeRGB(b);if("lepcc-intensity"===a.encoding)return d.decodeIntensity(b);if(null!=a.encoding&&""!==a.encoding)throw new f("unknown-attribute-storage-info-encoding",
"Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(v.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");e=p(b,a,e);u(e.byteOffset+e.byteCount,b.byteLength,"attribute");if(a=e.entries.attributeValues||e.entries.objectIds){if("String"===a.valueType){e=e.entries.attributeByteCounts;
var h=g(b,e);b=r(b,a);return c(e.count,h,b)}return g(b,a)}throw new f("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};b.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};b.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,
b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};b.isValueType=t;b.getBytesPerValue=x})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(q,
b,l){function f(a,b,f){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,f+e.identifierOffset,e.identifierLength)),version:b.getUint16(f+e.versionOffset,!0),checksum:b.getUint32(f+e.checksumOffset,!0)}}function h(b,e,f){var c=[];e=a(b,e,c);for(var d=[],h=0;h<c.length;h++){d.length=0;e=a(b,e,d);for(var k=0;k<d.length;k++)f.push(d[k]+c[h])}return e}function a(a,b,e){var c=new DataView(a,b),d=c.getUint8(0),f=d&31,h=!!(d&32),k=(d&192)>>6,d=0;if(0===k)d=c.getUint32(1,!0),b+=5;else if(1===
k)d=c.getUint16(1,!0),b+=3;else if(2===k)d=c.getUint8(1),b+=2;else throw new l("lepcc-decode-error","Bad count type");if(h)throw new l("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(d*f/8));for(var k=h=c=0,n=-1>>>32-f,q=0;q<d;q++){for(;h<f;)c|=a[k]<<h,h+=8,k+=1;e[q]=c&n;c>>>=f;h-=f;32<h+f&&(c|=a[k-1]>>8-h)}return b+k}Object.defineProperty(b,"__esModule",{value:!0});var e={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};b.decodeXYZ=
function(a){var b,d,c,g,q,p,u,t,x,v,y,m,w=new DataView(a,0),A=0;g=f(a,w,A);c=g.identifier;g=g.version;A+=e.byteCount;if("LEPCC     "!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<g)throw new l("lepcc-decode-error","Unknown version");var B=A;b=w.getUint32(B+0,!0);d=w.getUint32(B+4,!0);c=w.getFloat64(B+8,!0);g=w.getFloat64(B+16,!0);q=w.getFloat64(B+24,!0);p=w.getFloat64(B+32,!0);u=w.getFloat64(B+40,!0);t=w.getFloat64(B+48,!0);x=w.getFloat64(B+56,!0);v=w.getFloat64(B+64,!0);y=w.getFloat64(B+
72,!0);m=w.getUint32(B+80,!0);w.getUint32(B+84,!0);A+=88;if(d*Math.pow(2,32)+b!==a.byteLength)throw new l("lepcc-decode-error","Bad size");w=new Float64Array(3*m);b=[];d=[];m=[];B=[];A=h(a,A,b);A=h(a,A,d);A=h(a,A,m);A=h(a,A,B);if(A!==a.byteLength)throw new l("lepcc-decode-error","Bad length");for(var C=A=a=0;C<b.length;C++)for(var A=A+b[C],E=0,G=0;G<d[C];G++){var E=E+m[a],J=B[a];w[3*a]=Math.min(p,c+2*x*E);w[3*a+1]=Math.min(u,g+2*v*A);w[3*a+2]=Math.min(t,q+2*y*J);a++}return{errorX:x,errorY:v,errorZ:y,
result:w}};b.decodeRGB=function(a){var b,d,c,g,h,p,q=new DataView(a,0),t=0;g=f(a,q,t);c=g.identifier;g=g.version;t+=e.byteCount;if("ClusterRGB"!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<g)throw new l("lepcc-decode-error","Unknown version");p=t;b=q.getUint32(p+0,!0);d=q.getUint32(p+4,!0);c=q.getUint32(p+8,!0);g=q.getUint16(p+12,!0);h=q.getUint8(p+14);p=q.getUint8(p+15);t+=16;if(d*Math.pow(2,32)+b!==a.byteLength)throw new l("lepcc-decode-error","Bad size");if((2===h||1===h)&&0===p){if(3*
g+c+t!==a.byteLength||256<g)throw new l("lepcc-decode-error","Bad count");q=new Uint8Array(a,t,3*g);g=new Uint8Array(a,t+3*g,c);t=new Uint8Array(3*c);for(a=0;a<c;a++)b=g[a],t[3*a]=q[3*b],t[3*a+1]=q[3*b+1],t[3*a+2]=q[3*b+2];return t}if(0===h&&0===p){if(3*c+t!==a.byteLength||0!==g)throw new l("lepcc-decode-error","Bad count");return(new Uint8Array(a,t)).slice()}if(2>=h&&1===p){if(t+3!==a.byteLength||1!==g)throw new l("lepcc-decode-error","Bad count");g=q.getUint8(t);b=q.getUint8(t+1);q=q.getUint8(t+
2);t=new Uint8Array(3*c);for(a=0;a<c;a++)t[3*a]=g,t[3*a+1]=b,t[3*a+2]=q;return t}throw new l("lepcc-decode-error","Bad method "+h+","+p);};b.decodeIntensity=function(b){var d,h,c,g,q,p=new DataView(b,0),u=0;g=f(b,p,u);c=g.identifier;g=g.version;u+=e.byteCount;if("Intensity "!==c)throw new l("lepcc-decode-error","Bad identifier");if(1<g)throw new l("lepcc-decode-error","Unknown version");var t=u;d=p.getUint32(t+0,!0);h=p.getUint32(t+4,!0);c=p.getUint32(t+8,!0);g=p.getUint16(t+12,!0);q=p.getUint8(t+
14);p.getUint8(t+15);u+=16;if(h*Math.pow(2,32)+d!==b.byteLength)throw new l("lepcc-decode-error","Bad size");p=new Uint16Array(c);if(8===q){if(c+u!==b.byteLength)throw new l("lepcc-decode-error","Bad size");q=new Uint8Array(b,u,c)}else if(16===q){if(2*c+u!==b.byteLength)throw new l("lepcc-decode-error","Bad size");q=new Uint16Array(b,u,c)}else if(q=[],a(b,u,q)!==b.byteLength)throw new l("lepcc-decode-error","Bad size");for(b=0;b<c;b++)p[b]=q[b]*g;return p}})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w){function A(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function B(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=a[0]-c,c=c-a[3],g=a[1]-d,d=d-a[4],h=a[2]-e;a=e-a[5];var e=Math.max(f,c,0),k=Math.max(g,d,0),l=Math.max(h,a,0),e=e*e+k*k+l*l;return e>b*b?0:0<e?1:-Math.max(f,c,g,d,h,a)>b?3:2}function C(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=
b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function E(a,b){return a.filter(function(a){return a!==b}).concat([b])}function G(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=C(d,a.fields,{originalFields:f});return J(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c],h={};if(d.attributes)for(var k in d.attributes)h[k]=d.attributes[k];
for(var l=0;l<f.length;l++)h[f[l]]=e[g[l]];d.attributes=h}return b})}function J(a,b,c){var d=a.capabilities.query.maxRecordCount;if(null!=d&&b.length>d)return d=H(b,d),e.all(d.map(function(b){return J(a,b,c)})).then(L);d=new y({objectIds:b,outFields:c,orderByFields:[a.objectIdField]});return(new v(a.parsedUrl.path)).execute(d).then(function(a){if(a&&a.features&&a.features.length===b.length)return a.features.map(function(a){return a.attributes});throw new h("scenelayer:feature-not-in-associated-layer",
"Feature not found in associated feature layer");})}function I(a,b,c,d,f){for(var g=[],h=0;h<b.length;h++){var k=b[h];k&&-1!==f.indexOf(k.name)&&g.push({url:a+"/nodes/"+c.resources.attributes+"/attributes/"+k.key+"/0",storageInfo:k})}return e.eachAlways(g.map(function(a){return l(a.url,{responseType:"array-buffer"}).then(function(b){return m.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){for(var b=[],c=0;c<d.length;c++){for(var e=d[c],f={},h=0;h<a.length;h++)null!=a[h].value&&(f[g[h].storageInfo.name]=
K(a[h].value,e));b.push(f)}return b})}function K(a,b){if(!a)return null;b=a[b];return d.isInt16Array(a)?b===Y?null:b:d.isInt32Array(a)?b===N?null:b:b!==b?null:b}function H(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function L(a){for(var b=[],c=0;c<a.length;c++)b=b.concat(a[c]);return b}function P(a){var b=new u(A(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function S(a){var b=
new u(A(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function R(a,b,c){if(!x.canProject(a,b))throw new h("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===c&&a.isGeographic)throw new h("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{});}function O(a,b,c){var d=P(a);a=S(a);R(d,b,c);R(a,
b,c)}Object.defineProperty(b,"__esModule",{value:!0});b.DDS_ENCODING_STRING="image/vnd-ms.dds";b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];b.extractWkid=A;b.selectEncoding=function(a,c){if(c)for(c=0;c<a.length;c++)if(a[c].encoding===b.DDS_ENCODING_STRING)return a[c];for(c=0;c<a.length;c++)if(-1<b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[c].encoding))return a[c];return null};b.findIntersectingNodes=function(a,b,c,d,e,f){e.traverse(c,function(c){var e=c.mbs;b!==d&&
(e=T,w.mbsToMbs(c.mbs,d,e,b));e=B(a,e);if(0!==e)return f(c,e),!0})};b.filterInPlace=function(a,b,c){for(var d=0,e=0,f=0;f<b.length&&d<a.length;f++)a[d]===b[f]&&(c(f)&&(a[e]=a[d],e++),d++);a.length=e};var Q=t.create();b.getClipAABB=function(a,b){if(0===b.rotationScale[1]&&0===b.rotationScale[2]&&0===b.rotationScale[3]&&0===b.rotationScale[5]&&0===b.rotationScale[6]&&0===b.rotationScale[7])return Q[0]=(a[0]-b.position[0])/b.rotationScale[0],Q[1]=(a[1]-b.position[1])/b.rotationScale[4],Q[2]=(a[2]-b.position[2])/
b.rotationScale[8],Q[3]=(a[3]-b.position[0])/b.rotationScale[0],Q[4]=(a[4]-b.position[1])/b.rotationScale[4],Q[5]=(a[5]-b.position[2])/b.rotationScale[8],Q};var T=p.vec4f64.create();b.intersectBoundingBoxWithMbs=B;b.findFieldsCaseInsensitive=C;b.whenGraphicAttributes=function(a,b,c,d,g,k){!0===(k&&k.populateObjectId)&&(d=E(d,c));if(0===b.length)return e.resolve(b);k=a.associatedLayer;var l=a.attributeStorageInfo;if(k)return G(k,b,c,d);if(l){b=g(b);if(!b)return e.reject(new h("scenelayer:features-not-loaded",
"Tried to query attributes for unloaded features"));var m=a.parsedUrl.path;return e.all(b.map(function(a){return I(m,l,a.node,a.indices,d).then(function(b){for(var c=0;c<a.graphics.length;c++){var d=a.graphics[c],e=b[c];if(d.attributes)for(var f in d.attributes)f in e||(e[f]=d.attributes[f]);d.attributes=e}return a.graphics})})).then(f.flatten)}return e.reject(new h("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var Y=-Math.pow(2,15),N=-Math.pow(2,
31);b.getCachedAttributeValue=K;b.convertFlatRangesToOffsets=function(a,b,c){b=null!=b?b:a.length/c;for(var d=new Uint32Array(b+1),e=0;e<b;e++){var f=a[e*c];d[e]=3*f;var g=(e-1)*c+1;if(0<=g&&f-1!==a[g])throw new h("Face ranges are not continuous");}d[d.length-1]=3*(a[(b-1)*c+1]+1);return d};b.getIndexCrs=P;b.getVertexCrs=S;b.getCacheKeySuffix=function(a,b){return b===w.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};b.checkSpatialReference=R;b.checkSpatialReferences=
O;b.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null!=a.geometryType&&"triangles"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new h("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};b.checkSceneLayerCompatibleWithView=function(a,b){O(a,b.spatialReference,b.viewingMode)};
b.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new h("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};b.checkPointCloudLayerCompatibleWithView=
function(a,b){R(a.spatialReference,b.spatialReference,b.viewingMode)};b.rendererNeedsTextures=function(b){if(null==b||"simple"!==b.type&&"class-breaks"!==b.type&&"unique-value"!==b.type||("unique-value"===b.type||"class-breaks"===b.type)&&null==b.defaultSymbol)return!0;b=b.getSymbols();if(0===b.length)return!0;for(var c=0;c<b.length;c++){var d=b[c];if("mesh-3d"!==d.type||0===d.symbolLayers.length)return!0;for(var e=0,d=d.symbolLayers.items;e<d.length;e++){var f=d[e];if("fill"!==f.type||a.isNone(f.material)||
a.isNone(f.material.color)||"replace"!==f.material.colorMixMode)return!0}}return!1};var Z=function(){return function(){this.material=this.edges=null;this.castShadows=!0}}();b.SymbolInfo=Z;b.getSymbolInfo=function(b){var c=new Z,d=!1,e=!1,f=0;for(b=b.symbolLayers.items;f<b.length;f++){var g=b[f];if("fill"===g.type&&g.enabled){var h=g.material,k=g.edges;a.isSome(h)&&!d&&(d=h.color,h=h.colorMixMode,a.isSome(d)?c.material={color:[d.r/255,d.g/255,d.b/255],alpha:d.a,colorMixMode:h}:c.material={color:[1,
1,1],alpha:1,colorMixMode:"multiply"},c.castShadows=g.castShadows,d=!0);a.isSome(k)&&!e&&(c.edges=k,e=!0)}}c.material||(c.material={color:[1,1,1],alpha:1,colorMixMode:"multiply"});return c};b.addWraparound=function(a,b){return(a|0)+(b|0)|0};b.transformObb=function(a,b,c,d,e,f){void 0===f&&(f=0);g.vec3.set(c.center,a.center[0],a.center[1],a.center[2]+f);if(e&&d===w.SphericalECEFSpatialReference&&!b.isGeographic){for(e=0;8>e;e++)g.vec3.set(W,a.halfSize[0]*(1===(e&1)?-1:1),a.halfSize[1]*(2===(e&2)?-1:
1),a.halfSize[2]*(4===(e&4)?-1:1)),g.vec3.transformQuat(W,W,a.quaternion),g.vec3.add(W,W,c.center),F[3*e+0]=W[0],F[3*e+1]=W[1],F[3*e+2]=W[2];w.computeLinearTransformation(b,c.center,aa,d);e=2*Math.sqrt(1+aa[0]+aa[5]+aa[10]);V[0]=(aa[6]-aa[9])/e;V[1]=(aa[8]-aa[2])/e;V[2]=(aa[1]-aa[4])/e;V[3]=.25*e;n.quat.multiply(c.quaternion,V,a.quaternion);g.vec3.set(c.center,aa[12],aa[13],aa[14]);w.bufferToBuffer(F,b,0,F,d,0,8);n.quat.conjugate(V,c.quaternion);for(e=d=b=a=0;8>e;e++)g.vec3.set(W,F[3*e+0],F[3*e+1],
F[3*e+2]),g.vec3.sub(W,W,c.center),g.vec3.transformQuat(W,W,V),a=Math.max(a,Math.abs(W[0])),b=Math.max(b,Math.abs(W[1])),d=Math.max(d,Math.abs(W[2]));g.vec3.set(c.halfSize,a,b,d)}else w.bufferToBuffer(c.center,b,0,c.center,d,0,1),n.quat.copy(c.quaternion,a.quaternion),g.vec3.copy(c.halfSize,a.halfSize)};var W=r.vec3f64.create(),aa=k.mat4f64.create(),V=c.quatf32.create(),F=new Float64Array(24)})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3"],
function(q,b,l){function f(a,b,d){for(;0<a;){var c=b.indexOf(a);if(0<=c)return c;a=d.getParentId(a)}return b.indexOf(a)}function h(a,b){for(var c=[a.remove[0]],d=[];1===c.length;)for(var e=c.pop(),f=d.length=0;f<a.load.length;f++){for(var h=a.load[f],k=b.getParentId(h);k!==e;)h=k,k=b.getParentId(h);k=c.indexOf(h);0>k&&(k=c.length,c.push(h),d.push([]));d[k].push(a.load[f])}b=[];b.push({remove:a.remove,load:c});for(f=0;f<c.length;f++)1<d[f].length?b.push({remove:[c[f]],load:d[f]}):c[f]=d[f][0];return b}
Object.defineProperty(b,"__esModule",{value:!0});b.nodeDiff=function(b,c,g){for(var h=0;h<c.length;h++)d[h]=!1,k[h]=null;for(h=0;h<b.length;h++)a[h]=!1,e[h]=null;for(h=0;h<c.length;h++){var l=f(c[h],b,g);0<=l&&(d[h]=!0,null!=e[l]?e[l].push(c[h]):e[l]=[c[h]])}for(h=0;h<b.length;h++)l=f(b[h],c,g),0<=l&&(a[h]=!0,null!=k[l]?k[l].push(b[h]):k[l]=[b[h]]);g=[];for(h=0;h<b.length;h++)null!=e[h]||a[h]||g.push({load:[],remove:[b[h]]});for(h=0;h<c.length;h++)null!=k[h]||d[h]||g.push({load:[c[h]],remove:[]});
for(h=0;h<c.length;h++)null!=k[h]&&(1<k[h].length||k[h][0]!==c[h])&&g.push({load:[c[h]],remove:k[h]});for(h=0;h<b.length;h++)null!=e[h]&&(1<e[h].length||e[h][0]!==b[h])&&g.push({load:e[h],remove:[b[h]]});return g};var a=[!1],e=[null],d=[!1],k=[null];b.sortFrontToBack=function(a,b,d){return a.sort(function(a,c){if(0===a.load.length&&0===c.load.length)return 0;if(0===a.load.length)return-1;if(0===c.load.length)return 1;if(0===a.remove.length&&0===c.remove.length)return a=d.getRenderCenter(a.load[0]),
c=d.getRenderCenter(c.load[0]),l.vec3.dot(a,b)-l.vec3.dot(c,b);if(0===a.remove.length)return-1;if(0===c.remove.length)return 1;if(1===a.load.length&&1===c.load.length)return a=d.getRenderCenter(a.load[0]),c=d.getRenderCenter(c.load[0]),l.vec3.dot(a,b)-l.vec3.dot(c,b);if(1===a.load.length)return-1;if(1===c.load.length)return 1;a=d.getRenderCenter(a.remove[0]);c=d.getRenderCenter(c.remove[0]);return l.vec3.dot(a,b)-l.vec3.dot(c,b)})};b.splitWorkEntries=function(a,b,d){for(var c=0;c<a.length;++c){var e=
a[c];if(e.load.length>b&&1===e.remove.length){e=h(e,d);a[c]=e[0];for(var f=1;f<e.length;f++)a.push(e[f])}}};b.splitWorkEntry=h})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(q,b,l,f,h){return function(){function a(a,b,f){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=f}a.prototype.addPage=function(a,
b,k){for(void 0===k&&(k=0);this._pages.length<a;)this._pages.push(null);for(var d=this._nodeSR,c=this._renderSR,e=new h.ObbArray(b.length),l=0;l<b.length;l++)f.transformObb(b[l].obb,d,e.obbs[l],c,!0,k);this._pages[a]={nodes:b,renderObbs:e.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;b=this.pageSize;for(d=[0];d.length;)for(c=d.pop(),k=a[c/b|0].nodes[c%b],e=0;e<k.childCount;e++)l=k.firstChild+e,null!=a[l/b|0]&&(a[l/b|0].parents[l%b]=c,d.push(l))};a.prototype.hasPage=function(a){return!!this._pages[a]};
a.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};a.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};a.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};a.prototype.setRenderObb=function(a,b){var d=this.pageSize;h.set(b,this._pages[a/d|0].renderObbs[a%d])};a.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/b|0].parents[a%b]};a.prototype.hasNodes=function(a,b){b=
(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};a.prototype.createVisibilityTraverse=function(){var a=this,b=[],f=[],n=l.create();return function(c,d){if(a.hasNodes(0,1))for(b.length=0,b.push(0),f.length=0,f.push(0);0<b.length;){var e=b.pop(),g=f.pop(),k=a.getNode(e),q=a.getRenderObb(e),x=!0;if(null!=c.clippingBox){var v=1<<c.frustumPlanes.length;if(0===(g&v)){var y=h.toAaBoundingBox(q,n);l.contains(c.clippingBox,y)?g|=v:l.intersects(c.clippingBox,
y)||(x=!1)}}for(y=0;y<c.frustumPlanes.length&&x;y++)if(v=1<<y,0===(g&v)){var m=h.intersectPlane(q,c.frustumPlanes[y]);0<m?x=!1:0>m&&(g|=v)}if(d.predicate(e,k,x)){q=k.firstChild;k=k.childCount;y=!1;x=(q+k-1)/a.pageSize|0;for(v=q/a.pageSize|0;v<=x;v++)if(!a.hasPage(v)){d.pageMiss(e,v);y=!0;break}if(!y)for(y=0;y<k;y++)b.push(q+y),f.push(g)}}}};return a}()})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/assignHelper ../../../../Graphic ../../../../core/accessorSupport/decorators".split(" "),
function(q,b,l,f,h,a,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b){return a.call(this,b)||this}f(b,a);d=b;b.prototype.clone=function(){return new d(this.cloneProperties())};b.prototype.cloneProperties=function(){var a=this.pointCloudMetadata;return h({},this.inherited(arguments),{pointCloudMetadata:a})};var d;l([e.property({constructOnly:!0})],b.prototype,"pointCloudMetadata",void 0);return b=d=l([e.subclass("esri.views.3d.layers.i3s.PointGraphic")],b)}(e.declared(a));
b.PointGraphic=q})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ./PointHighlights ../../support/geometryUtils ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/ComponentUtils ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/shaders/PointRendererTechnique ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A){function B(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}Object.defineProperty(b,"__esModule",{value:!0});var C={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};q=function(){function b(a){var b=
this;this._params=a;this.type="Point";this._highlights=new g.PointHighlights({forEachNode:function(a){return b.forEachNode(a)},addHighlight:function(a,c,d,e){return b.addHighlight(a,c,d,e)},removeHighlight:function(a,c){return b.removeHighlight(a,c)}});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=c.create(c.POSITIVE_INFINITY);this._techniqueConfig=
new m.PointRendererTechniqueConfiguration;this.tempMatrix4=h.mat4f32.create();this.tempVec3=d.vec3f32.create();this.nodes=[]}Object.defineProperty(b.prototype,"needsHighlight",{get:function(){return this._highlights.hasHighlights},enumerable:!0,configurable:!0});b.prototype.initializeRenderContext=function(a){this._initContext=a;this._techniqueRep=this._initContext.shaderTechniqueRep;a.requestRender()};b.prototype.uninitializeRenderContext=function(){};b.prototype.intersect=function(b,d,f,g){var h=
this,l=k.vec3f64.create(),m=k.vec3f64.create(),q=k.vec3f64.create(),t=k.vec3f64.create(),w=p.plane.create(),x=b.camera.perScreenPixelRatio/2,y=b.camera.near,A=this._getSizeParams();e.vec3.subtract(m,g,f);var C=1/e.vec3.length(m);e.vec3.scale(m,m,C);e.vec3.negate(q,m);n.vec4.set(w,m[0],m[1],m[2],-e.vec3.dot(m,f));var E=function(){return function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""}}(),G=new E,J=new E,I=[],F=c.create(),K=c.create(this._clipBox);c.offset(K,
-f[0],-f[1],-f[2],K);for(var U=function(a){var n=a.splatSize*ea._scaleFactor,p=u.minimumDistancePlane(a.obb,w),r=u.maximumDistancePlane(a.obb,w),p=p-(A.drawScreenSpace?0:B(n,p+y,A,x,a.isLeaf)),r=r-(A.drawScreenSpace?0:B(n,r+y,A,x,a.isLeaf)),p=null!=G.dist&&null!=J.dist&&G.dist<p*C&&J.dist>r*C;if(0>r||p)return"continue";r=B(n,r+y,A,x,a.isLeaf);if(!u.intersectLine(a.obb,f,m,r))return"continue";var v=r*r;u.toAaBoundingBox(a.obb,F);c.offset(F,-f[0],-f[1],-f[2],F);var N=!c.contains(K,F);e.vec3.subtract(t,
a.origin,f);for(var r=a.coordinates.length/3,p=function(p){l[0]=t[0]+a.coordinates[3*p];l[1]=t[1]+a.coordinates[3*p+1];l[2]=t[2]+a.coordinates[3*p+2];if(N&&!c.containsPoint(K,l))return"continue";var r=e.vec3.dot(l,m),w=e.vec3.squaredLength(l)-r*r;if(w>v)return"continue";var u=r+y,F=A.drawScreenSpace?0:B(n,u,A,x,a.isLeaf);if(0>r-F)return"continue";u=B(n,u-F,A,x,a.isLeaf);if(w>u*u)return"continue";var H=(r-F)*C,r=function(b){var c=b.point;null==c&&(c=k.vec3f64.create());c[0]=a.origin[0]+a.coordinates[3*
p];c[1]=a.origin[1]+a.coordinates[3*p+1];c[2]=a.origin[2]+a.coordinates[3*p+2];b.point=c;b.dist=H;b.normal=q;b.node=a;b.pointId=p;b.layerUid=h.layerUid};(null==G.dist||H<G.dist)&&(null==d||d(f,g,H))&&r(G);0!==b.options.store&&(null==J.dist||H>J.dist)&&(null==d||d(f,g,H))&&r(J);2!==b.options.store||null!=d&&!d(f,g,H)||(w=new E,r(w),I.push(w))},H=0;H<r;H++)p(H)},ea=this,ha=0,ka=this.nodes;ha<ka.length;ha++)U(ka[ha]);var ba=function(a){var b=a.node,c=a.pointId;return{type:"external",point:a.point,metadata:{layerUid:a.layerUid,
createGraphic:function(){return h._params.createGraphic(b,c,a.point)}}}},U=function(b,c){var d=ba(c);b.set(d,c.layerUid+"/"+c.node.id+"/"+c.pointId,c.dist,c.normal,a.mat4f64.IDENTITY,void 0);b.intersector="PointRenderer"};null!=G.dist&&(ha=b.results.min,(null==ha.dist||G.dist<ha.dist)&&U(ha,G));null!=J.dist&&0!==b.options.store&&(ha=b.results.max,(null==ha.dist||J.dist>ha.dist)&&U(ha,J));if(2===b.options.store)for(ha=r.ray.fromPoints(f,g),ka=0;ka<I.length;ka++){var qa=I[ka],ja=new v.IntersectorResult(ha);
U(ja,qa);b.results.all.push(ja)}};b.prototype.render=function(a){if(0!==a.pass&&1!==a.pass&&4!==a.pass)return!1;for(var b=1===a.pass,d=a.rctx,g=0,h=this.nodes;g<h.length;g++){var k=h[g];null==k.vao&&this._initNode(a,k)}g=this._getSizeParams();k=this.selectTechnique(a.pass,g);h=k.program;if(null==h||0===this.nodes.length)return!0;var l=this._clipBox,m=!c.equals(l,c.POSITIVE_INFINITY,function(a,b){return a===b});m||(e.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),h.setUniform3fv("uClipMin",
this.tempVec3),e.vec3.set(this.tempVec3,Infinity,Infinity,Infinity),h.setUniform3fv("uClipMax",this.tempVec3));d.bindProgram(h);k.bindPipelineState(d);h.setUniformMatrix4fv("uProjectionMatrix",a.camera.projectionMatrix);b&&h.setUniform2f("nearFar",a.camera.near,a.camera.far);a.isHighlightPass&&y.bindHighlightRendering(d,{viewport:a.camera.fullViewport,highlightDepthTexture:a.highlightDepthTexture},h);b=a.camera.pixelRatio;g.drawFixedSize&&h.setUniform2f("uPointScale",g.fixedSize*b,a.camera.fullHeight);
for(var n=this._slicePlaneEnabled?a.sliceHelper&&a.sliceHelper.plane:null,p=0,q=this.nodes;p<q.length;p++)if(k=q[p],0!==k.coordinates.length&&(!a.isHighlightPass||k.highlights)){h.setUniform2f("uScreenMinMaxSize",g.screenMinSize*b,(k.isLeaf?256:64)*b);g.drawFixedSize||h.setUniform2f("uPointScale",k.splatSize*this._scaleFactor*b,a.camera.fullHeight/b);var r=k.origin;m&&(e.vec3.set(this.tempVec3,l[0]-r[0],l[1]-r[1],l[2]-r[2]),h.setUniform3fv("uClipMin",this.tempVec3),e.vec3.set(this.tempVec3,l[3]-r[0],
l[4]-r[1],l[5]-r[2]),h.setUniform3fv("uClipMax",this.tempVec3));f.mat4.identity(this.tempMatrix4);f.mat4.translate(this.tempMatrix4,this.tempMatrix4,r);f.mat4.multiply(this.tempMatrix4,a.camera.viewMatrix,this.tempMatrix4);h.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);n&&y.bindSlicePlane(r,n,h);d.bindVAO(k.vao);a.isHighlightPass?this._renderHighlightFragments(d,k):d.drawArrays(0,0,k.coordinates.length/3)}return!0};b.prototype._renderHighlightFragments=function(a,b){var c=b.highlights;
if(c){b=l.unwrap(c[0].component);for(var d=b+1,e=1;e<c.length;e++){var f=l.unwrap(c[e].component);f!==d&&(d-=b,0<d&&a.drawArrays(0,b,d),b=f);d=f+1}c=d-b;0<c&&a.drawArrays(0,b,c)}};Object.defineProperty(b.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==
a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"clippingBox",{set:function(a){c.set(this._clipBox,a||c.POSITIVE_INFINITY)},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"slicePlane",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"intersectionHandlerId",{get:function(){return this.layerUid},enumerable:!0,configurable:!0});b.prototype.addNode=function(a){this.nodes.push(a);this._highlights.nodeAdded(a);this._requestRender()};b.prototype.removeNode=function(a){var b=
this,c=null;this.nodes=this.nodes.filter(function(d){return d.id===a?(c=d,d.vao&&(d.vao.dispose(!0),d.vao=null),b._highlights.nodeRemoved(d),!1):!0});this._requestRender();return c};b.prototype.forEachNode=function(a){this.nodes.forEach(a)};b.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this._highlights.removeAll();this.nodes=[];this._requestRender()};b.prototype.highlight=function(a,b){return this._highlights.add(a,b)};b.prototype.addHighlight=
function(a,b,c,d){a.highlights=t.addHighlight(a.highlights,b,c,d);this._requestRender()};b.prototype.removeHighlight=function(a,b){a.highlights=t.removeHighlight(a.highlights,b);this._requestRender()};b.prototype._initNode=function(a,b){a=a.rctx;b.vao=new A(a,x.Default3D,C,{positions:w.createVertex(a,35044,b.coordinates),colors:w.createVertex(a,35044,b.rgb)})};b.prototype._requestRender=function(){this._initContext&&this._initContext.requestRender()};b.prototype._getSizeParams=function(){var a=this._useFixedSizes,
b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};b.prototype.selectTechnique=function(a,b){this._techniqueConfig.drawScreenSize=b.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;this._techniqueConfig.output=1===a?1:4===a?4:0;return this._techniqueRep.acquireAndReleaseExisting(m.PointRendererTechnique,this._techniqueConfig,this._technique)};return b}();b.PointRenderer=
q;(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(q=b.PointRenderer||(b.PointRenderer={}));b.PointRenderer=q})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["require","exports","../../../../core/iteratorUtils","../../../../core/maybe","../../webgl-engine/lib/HighlightUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.context=a;this.highlights=new Set}Object.defineProperty(b.prototype,"hasHighlights",
{get:function(){return 0<this.highlights.size},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this.highlights=null};b.prototype.add=function(b,e){var d=this,c=new a(b,e);this.highlights.add(c);this.enableSet(c);return{remove:function(){return d.removeSet(c)},pause:function(){d.disableSet(c)},resume:function(){d.enableSet(c)}}};b.prototype.removeSet=function(a){this.disableSet(a);this.highlights.delete(a)};b.prototype.enableSet=function(a){var b=this;a.enabled||(a.enabled=!0,this.context.forEachNode(function(d){return b.enableSetForNode(a,
d)}))};b.prototype.enableSetForNode=function(a,b){var d=this;if(a.enabled){var c=a.ids.get(b.id);c&&c.forEach(function(c){return d.context.addHighlight(b,c,a.options,a.id)})}};b.prototype.disableSet=function(a){var b=this;a.enabled&&(a.enabled=!1,this.context.forEachNode(function(d){return b.disableSetForNode(a,d)}))};b.prototype.disableSetForNode=function(a,b){a.enabled||this.context.removeHighlight(b,a.id)};b.prototype.nodeAdded=function(a){var b=this;this.highlights.forEach(function(d){return b.enableSetForNode(d,
a)})};b.prototype.nodeRemoved=function(a){var b=this;this.highlights.forEach(function(d){return b.disableSetForNode(d,a)})};b.prototype.removeAll=function(){var a=this;this.highlights.forEach(function(b){return a.disableSet(b)})};return b}();b.PointHighlights=q;var a=function(){function a(a,b){this.options=b;this.id=h.generateHighlightId();this.ids=new Map;this.enabled=!1;for(b=0;b<a.length;b++){var d=a[b];f.isSome(d)&&this.add(d.nodeId,d.pointId)}}a.prototype.add=function(a,b){var d=this.ids.get(a);
d?d.add(b):this.ids.set(a,l.createSetFromValues([b]))};return a}()})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ./PointRenderer.glsl ../../../webgl/Program ../../../webgl/renderState".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){Object.defineProperty(b,"__esModule",{value:!0});h=function(b){function d(a,c){return b.call(this,a,c)||this}l(d,b);d.prototype.initializeProgram=function(a){var b=d.shader.get(),e=this.configuration,b=b.build({output:e.output,slicePlaneEnabled:e.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:e.drawScreenSize});return new c(a.rctx,b.generateSource("vertex"),b.generateSource("fragment"),k.Default3D)};d.prototype.initializePipeline=
function(){return g.makePipelineState({depthTest:{func:513},depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})};d.prototype.bindPipelineState=function(a){a.setPipelineState(this.pipeline)};d.shader=new a.ReloadableShaderModule(n,"./PointRenderer.glsl",q);return d}(e.ShaderTechnique);b.PointRendererTechnique=h;h=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.output=0;b.slicePlaneEnabled=!1;b.drawScreenSize=!1;return b}l(b,a);f([d.parameter({count:7})],
b.prototype,"output",void 0);f([d.parameter()],b.prototype,"slicePlaneEnabled",void 0);f([d.parameter()],b.prototype,"drawScreenSize",void 0);return b}(d.ShaderTechniqueConfiguration);b.PointRendererTechniqueConfiguration=h})},"esri/views/3d/webgl-engine/shaders/PointRenderer.glsl":function(){define("require exports ../../../../core/tsSupport/makeTemplateObjectHelper ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});b.build=function(b){var q=new d.ShaderBuilder,m=0===b.output,w=1===b.output,v=4===b.output;q.extensions.add("GL_OES_standard_derivatives");q.include(f.Slice,b);q.attributes.add("position","vec3");q.attributes.add("color","vec3");q.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");w?(q.vertex.uniforms.add("nearFar",
"vec2"),q.varyings.add("depth","float")):4!==b.output&&q.varyings.add("vColor","vec3");q.vertex.code.add(e.glsl(r||(r=l(["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "],["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x \x3c uClipMin.x || position.y \x3c uClipMin.y || position.z \x3c uClipMin.z ||\n        position.x \x3e uClipMax.x || position.y \x3e uClipMax.y || position.z \x3e uClipMax.z) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize \x3d 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera \x3d uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize \x3d uPointScale.x;\n      vec4 position \x3d uProjectionMatrix * camera;\n     ",
"\n\n     gl_PointSize \x3d clampedScreenSize;\n     gl_Position \x3d position;\n\n     ","\n     ","\n    }\n  "])),b.drawScreenSize?e.glsl(k||(k=l(["\n      float clampedScreenSize \x3d pointSize;"],["\n      float clampedScreenSize \x3d pointSize;"]))):e.glsl(n||(n=l(["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"],
["\n      float pointRadius \x3d 0.5 * pointSize;\n      vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\n      float radius \x3d abs(positionOffset.y - position.y);\n      float viewHeight \x3d uPointScale.y;\n      // screen diameter \x3d (2 * r / w) * (h / 2)\n      float screenPointSize \x3d (radius / position.w) * viewHeight;\n      float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position \x3d uProjectionMatrix * camera;"]))),
w?e.glsl(c||(c=l(["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"],["depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);"]))):"",m?e.glsl(g||(g=l(["vColor \x3d color;"],["vColor \x3d color;"]))):""));q.include(a.RgbaFloatEncoding,b);v&&q.include(h.OutputHighlight);q.fragment.code.add(e.glsl(x||(x=l(["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ",
"\n      ","\n      ","\n    }\n  "],["\n    void main(void) {\n      vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\n      float r2 \x3d dot(vOffset, vOffset);\n\n      if (r2 \x3e 0.25) {\n        discard;\n      }\n      ","\n      ","\n      ","\n    }\n  "])),w?e.glsl(p||(p=l(["gl_FragColor \x3d float2rgba(depth);"],["gl_FragColor \x3d float2rgba(depth);"]))):"",v?e.glsl(u||(u=l(["outputHighlight();"],["outputHighlight();"]))):"",m?e.glsl(t||(t=l(["gl_FragColor \x3d vec4(vColor, 1.0);"],["gl_FragColor \x3d vec4(vColor, 1.0);"]))):
""));return q};var k,n,c,g,r,p,u,t,x})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Error ../../../../core/iteratorUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r){Object.defineProperty(b,"__esModule",{value:!0});b.PopupSceneLayerView=function(b){return function(b){function p(){return null!==b&&b.apply(this,arguments)||this}l(p,b);p.prototype._validateFetchPopupFeatures=function(a){var b=this.layer;if(!b.popupEnabled)return new e("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:b});if(!r.getFetchPopupTemplate(b,a))return new e("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",
{layer:b})};p.prototype.prepareFetchPopupFeatures=function(b){return a(this,void 0,void 0,function(){return h(this,function(a){return[2]})})};p.prototype.fetchPopupFeatures=function(b,c){return a(this,void 0,void 0,function(){var a,b,e,f,l,p,q,t,u,v,x;return h(this,function(h){switch(h.label){case 0:if(a=this._validateFetchPopupFeatures(c))return[2,n.reject(a)];b=k.isSome(c)?c.clientGraphics:null;if(!b||0===b.length)return[2,n.resolve([])];e=[];f=[];p=g.unpackFieldNames;q=[this.layer.fields];return[4,
r.getRequiredFields(this.layer,r.getFetchPopupTemplate(this.layer,c))];case 1:return l=p.apply(void 0,q.concat([h.sent()])),[4,this.prepareFetchPopupFeatures(l)];case 2:h.sent();t=new Set;u=0;for(v=b;u<v.length;u++)x=v[u],g.populateMissingFields(l,x,t)?f.push(x):e.push(x);return 0===f.length?[2,n.resolve(e)]:[2,this.whenGraphicAttributes(f,d.valuesOfSet(t)).catch(function(){return f}).then(function(a){return e.concat(a)})]}})})};return p=f([c.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],
p)}(c.declared(b))}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../geometry ../../../Graphic ../../../core/arrayUtils ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/webMercatorUtils ../../../layers/support/fieldUtils ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SGeometryUtil ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/index".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T){var Y=g.getLogger("esri.views.3d.layers.SceneLayerView3D"),N=L.defineFieldProperties(),Z=[0,0,0,0];return function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a._queryEngine=null;a.lodFactor=1;a.progressiveLoadFactor=1;a._elevationContext="scene";a._isIntegratedMesh=!1;a._supportsLabeling=!0;a._asyncModuleLoading=0;a._projectionEngineLoaded=!1;return a}f(g,b);Object.defineProperty(g.prototype,"filter",
{set:function(a){if(r.isNone(a))this._set("filter",null);else{var b=["contains","intersects","disjoint"];a.timeExtent?(Y.warn("Filters with a timeExtent are not supported for mesh scene layers"),a=null):a.spatialRelationship&&-1===b.indexOf(a.spatialRelationship)&&(Y.warn("Filters with spatialRelationship other than "+b.join(", ")+" are not supported for mesh scene layers"),a=null);this._set("filter",a)}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedFilterWhereClause",
{get:function(){var a=r.isSome(this.filter)?this.filter.where:null;if(!a)return null;try{return x.WhereClause.create(a,this.layer.fieldsIndex)}catch(F){Y.error("Failed to parse filter where clause: "+F)}return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterSpatialRelationship",{get:function(){return r.isSome(this.filter)?this.filter.spatialRelationship:"intersects"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedFilterGeometry",{get:function(){var a=
this;if(r.isNone(this.filter)||!this._geometryEngine)return null;var b=this.filter,c=b.geometry,e=b.distance,f=b.units,b=this.filterSpatialRelationship;if(!e)return E.processFilterGeometry(c,b);f=f||u.getUnitString(c.spatialReference);if(c.spatialReference.isWGS84)return c=this._geometryEngine.geodesicBuffer(c,e,f),E.processFilterGeometry(c,b);if(m.canProject(c,d.SpatialReference.WGS84))return c=m.project(this._geometryEngine.geodesicBuffer(m.project(c,d.SpatialReference.WGS84),e,f),c.spatialReference),
E.processFilterGeometry(c,b);if(!v.isSupported())return Y.error("Filter by geodesic buffer (distance) unsupported due to lack of projection support."),null;if(!this._projectionEngineLoaded&&(this._loadAsyncModule(v.load()).then(function(){a._set("_projectionEngineLoaded",!0)}),!this._projectionEngineLoaded))return null;var g=null;try{g=v.project(c,d.SpatialReference.WGS84)}catch(ka){}if(g)try{g=v.project(this._geometryEngine.geodesicBuffer(g,e,f),c.spatialReference)}catch(ka){g=null}g||Y.error("Filter by geodesic buffer (distance) unsupported, failed to project input geometry ("+
c.spatialReference.wkid+") to WGS84.");return E.processFilterGeometry(g,b)},enumerable:!0,configurable:!0});g.prototype.initialize=function(){for(var a=this,b=0,c=["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"];b<c.length;b++){var d=c[b];this.updatingHandles.add(this,d,function(){return a.updatingHandles.addPromise(a._updateRequiredFields())})}this._updateRequiredFields();this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},
2);this.updatingHandles.add(this.layer,"renderer",function(b){return a.updatingHandles.addPromise(a._rendererChange(b))},2);b=0;for(c=["parsedDefinitionExpression","layer.objectIdFilter","filter","parsedFilterWhereClause","parsedFilterGeometry"];b<c.length;b++)d=c[b],this.updatingHandles.add(this,d,function(){return a._filterChange()})};g.prototype.destroy=function(){};g.prototype._updateRequiredFields=function(){return e(this,void 0,void 0,function(){var b,d,e,f,g,h,k,l,m,n,q;return a(this,function(a){switch(a.label){case 0:return b=
this,e=d=b.layer,f=e.fields,g=e.renderer,h=b.definitionExpressionFields,k=new Set,[4,p.eachAlways([g?g.collectRequiredFields(k,f):null,w.collectLabelingFields(k,d),r.isSome(this.filter)?w.collectFilterFields(k,d,this.filter):null])];case 1:l=a.sent();m=0;for(n=l;m<n.length;m++)q=n[m],q.error&&Y.error(q.error);w.collectFields(k,f,h);this._set("requiredFields",c.valuesOfSet(k).sort());return[2]}})})};g.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&Y.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
g.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return r.isSome(this.filter)?this.filter.createQuery(a):new A(a)};g.prototype.queryExtent=function(a){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(a))};g.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(a))};g.prototype.queryFeatures=function(a){return this._ensureQueryEngine().executeQuery(this._ensureQuery(a))};
g.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(a))};g.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};g.prototype._createQueryEngine=function(){var a=this,b=this._createGetFeatureExtent();return new G.default({layerView:this,task:T.Task.FEATURE_QUERY_ENGINE,spatialIndex:new I.default({featureAdapter:new J.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,
attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:b}),forAllFeatures:function(b,c){return a._forAllFeatures(function(a,c,d){return b({id:a,index:c,meta:d})},c,2)},getFeatureExtent:b,sourceSpatialReference:K.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};g.prototype._createGetFeatureExtent=function(){var a=this,b=new Float64Array(24),c=this.view.renderSpatialReference,d=this.view.spatialReference;return function(e){if(!e.meta.featureExtents){var f=
new Float64Array(6*e.meta.featureIds.length);e.meta.featureExtents=f;for(var g=0;g<f.length;g+=6)f[g]=Number.POSITIVE_INFINITY}f=new Float64Array(e.meta.featureExtents.buffer,6*e.index*Float64Array.BYTES_PER_ELEMENT,6);return f[0]===Number.POSITIVE_INFINITY?(E.boundingBoxCornerPoints(e.index,a._collection,e.meta.objectHandle,b),R.bufferToBuffer(b,c,0,b,d,0,8)?y.expandWithBuffer(y.NEGATIVE_INFINITY,b,0,8,f):y.set(f,y.ZERO)):f}};g.prototype.highlight=function(a,b){void 0===b&&(b={});var c=this._highlights;
if(a instanceof A){var d=c.acquireSet(b),e=d.set,d=d.handle;this.queryObjectIds(a).then(function(a){return c.setFeatureIds(e,a)});return d}return this.inherited(arguments)};g.prototype._createLayerGraphic=function(a){a=new k(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};g.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};g.prototype.isUpdating=function(){return this.updatingMeshView3D||0<this._asyncModuleLoading};
g.prototype.getFilters=function(){var a=this,b=this.inherited(arguments);if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b){return a._objectIdFilter(c,d,b)})}this.addSqlFilter(b,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError);if(r.isSome(this.filter)){var e=this.parsedFilterGeometry;r.isSome(e)&&b.push(function(b,c){return a._geometryFilter(b,c,e,a.filterSpatialRelationship)});
if(this.filter.objectIds){var f=new Float64Array(this.filter.objectIds);f.sort();b.push(function(b){return a._objectIdFilter(f,!0,b)})}}r.isSome(this.parsedFilterWhereClause)&&this.addSqlFilter(b,this.parsedFilterWhereClause,this.parsedFilterWhereClause.fieldNames,this.logError);return b};g.prototype._geometryFilter=function(a,b,c,d){var e=c[0].spatialReference||this.view.spatialReference;R.mbsToMbs(b.node.mbs,this._controller.crsIndex,Z,e);for(var f=E.acquireMaskFilterContext(d,this.view,e,this._collection,
b.objectHandle),g=E.computeMaskNodeMBS(Z,f),e=function(c){if(0===a.length)return{value:void 0};switch(E.testMaskWithGeometry(c,g,d)){case 1:return a.length=0,{value:void 0};case 0:return"continue"}K.filterInPlace(a,b.featureIds,function(a){return E.filterWithMask(c,a,f)})},h=0;h<c.length;h++){var k=e(c[h]);if("object"===typeof k)return k.value}};g.prototype._filterChange=function(){var a=this;r.isSome(this.filter)&&this.filter.geometry&&!this._geometryEngine?this._loadAsyncModule(E.loadGeometryEngine()).then(function(b){a.destroyed||
(a._set("_geometryEngine",b),a._applyFilters(!0))}):this.inherited(arguments)};g.prototype._loadAsyncModule=function(a){var b=this;this._set("_asyncModuleLoading",this._asyncModuleLoading+1);var c=function(){return b._set("_asyncModuleLoading",b._asyncModuleLoading-1)};return a.then(function(a){c();return a},function(a){c();throw a;})};g.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=n.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};g.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(r.isNone(a)?
this.createQuery():A.from(a))};h([t.property()],g.prototype,"layer",void 0);h([t.property({dependsOn:["updatingMeshView3D","_asyncModuleLoading"]})],g.prototype,"updating",void 0);h([t.property({dependsOn:["_controller.rootNodeVisible"]})],g.prototype,"suspended",void 0);h([t.property(P.updatingProgress)],g.prototype,"updatingProgress",void 0);h([t.property({type:Q})],g.prototype,"filter",null);h([t.property({readOnly:!0,dependsOn:["filter.where"]})],g.prototype,"parsedFilterWhereClause",null);h([t.property({readOnly:!0,
dependsOn:["filter.spatialRelationship"]})],g.prototype,"filterSpatialRelationship",null);h([t.property({readOnly:!0,dependsOn:"filter.geometry filter.distance filter.units filterSpatialRelationship _geometryEngine _projectionEngineLoaded".split(" ")})],g.prototype,"parsedFilterGeometry",null);h([t.property(N.requiredFields)],g.prototype,"requiredFields",void 0);h([t.property(N.availableFields)],g.prototype,"availableFields",void 0);h([t.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],
g.prototype,"lodFactor",void 0);h([t.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],g.prototype,"updatingProgressValue",void 0);h([t.property({readOnly:!0})],g.prototype,"_asyncModuleLoading",void 0);h([t.property({readOnly:!0})],g.prototype,"_geometryEngine",void 0);h([t.property({readOnly:!0})],g.prototype,"_projectionEngineLoaded",void 0);return g=h([t.subclass("esri.views.3d.layers.SceneLayerView3D")],g)}(t.declared(B.I3SMeshView3D(H.DefinitionExpressionSceneLayerView(S.PopupSceneLayerView(C.LayerView3D(O))))))})},
"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Color ../../../Graphic ../../../core/Collection ../../../core/has ../../../core/iteratorUtils ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f32 ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/layerUtils ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../support/debugFlags ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/material/RenderTexture ../webgl-engine/lib/Texture ../webgl-engine/lib/TextureBackedBuffer/BufferManager @dojo/framework/shim/Promise".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca,U,ea,ha,ka,ba,qa,ja,la,ma,ta,ua){function sa(a){var b=a.metallicRoughness;return b&&0<=b.baseColorTextureId||b&&0<=b.metallicRoughnessTextureId||0<=a.normalTextureId||0<=a.emissiveTextureId||0<=a.occlusionTextureId}function xa(a){return u.isSome(a)&&v.isArrayBuffer(a.data)}function ra(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:
0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);if(u.isSome(b))for(a=0;a<b.length;a++)d=b[a],u.isSome(d)&&v.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}function oa(a,b){return 104857600<b.byteSize?(pa.warn("Node is too big to store in IndexedDB cache: "+a.id+" ("+b.byteSize+" bytes)"),!1):0<b.byteSize}Object.defineProperty(b,"__esModule",{value:!0});var pa=r.getLogger("esri.views.3d.layers.SceneLayerView3D"),ia=[1,1,1,1],na=function(){return function(){this.cachedSymbolInfos=
[];this.cachedSymbolColors=null}}();b.I3SMeshView3D=function(b){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._elevationProvider=null;a._intersectionHandler=null;a._worker=new T;a._workerThread=null;a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new F.IDBCache("esri-scenelayer-cache","geometries");a._labeler=null;a._hasColors=!1;a._hasTextures=
!1;a._hasData=!1;a.slicePlaneEnabled=!1;a._layerUrl="";a._cacheKeySuffix=null;a._arcade=null;a._tmpAttributeOnlyGraphic=new k(null,null,{});return a}f(d,b);Object.defineProperty(d.prototype,"layerUid",{get:function(){return this.layer&&this.layer.uid},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"sublayerUid",{get:function(){return null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updatingMeshView3D",{get:function(){return!(!this._controller||!this._controller.updating)||
!!this._visibleGeometryChangedSchedulerHandle||u.isSome(this._labeler)&&this._labeler.updating},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rendererTextureUsage",{get:function(){return V.rendererNeedsTextures(this._currentRenderer)?63:44},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=y.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=O.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!c("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.renderView.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;w.open("SceneLayerWorker").then(function(b){a.destroyed?
b.close():a._workerThread=b});V.checkSceneLayerValid(this.layer);V.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUrl=this.layer.parsedUrl.path;this._controller=new H({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new N({collection:this._collection,forAllFeatures:function(b){return a._forAllFeatures(b,null,1)},forAllFeaturesOfNode:function(b,
c){return a._forAllFeaturesOfNode(b,c)}});if(this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=
this.view.resourceController.memoryController.getMemCache(this.layer.uid,function(b){return a._deleteComponentObject(b)});this._intersectionHandler=new aa.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,forEach:function(b){return a._nodeId2Meta.forEach(function(a){return b(a.node,a.objectHandle)})}});this._elevationProvider=new Z({layerView:this,intersectionHandler:this._intersectionHandler});this.updatingHandles.add(this,
"view.clippingArea",function(){return a._clippingAreaChanged()},2);this.updatingHandles.add(this,"fullOpacity",function(b){return a._opacityChange(b)});this.updatingHandles.add(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)});this.updatingHandles.add(this,"elevationOffset",function(b,c){return a._reloadAll(c)});this.updatingHandles.add(this,"filter",function(){return a._filterChange()},2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",
function(){return a._updatePBR()});b=function(){a._reloadAll();a._memCache.clear()};this.updatingHandles.add(this,"rendererTextureUsage",b);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",b);this.updatingHandles.add(this,"suspended",function(b){return a._suspendedChange(b)},2);this.updatingHandles.add(this.layer,"labelsVisible",function(){return a._labelsVisibleChange()},2);this.updatingHandles.add(this.layer,"labelingInfo",function(){return a._labelsVisibleChange()},2);this.handles.add(m.init(ka,
"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){q(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&ka.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||ka.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._cacheKeySuffix=V.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(function(a){return pa.warn("Failed to initialize IndexedDB cache: "+
a)});this._componentColorManager=this._hasSymbolColors?new ua.BufferManager(this._stage.renderView.renderingContext):null};d.prototype.destroy=function(){this._clearAddTasks();this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);this._workerThread&&
(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._stage=this._collection=this._memCache=null;u.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&
(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};d.prototype.memEstimateTextureAdded=function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};d.prototype.memEstimateTextureRemoved=function(a){a=a.estimatedTexMemRequired;this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};d.prototype.memEstimateGeometryAdded=function(a){a=this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=
a;return a};d.prototype.memEstimateGeometryRemoved=function(a){a=this._collection.getObjectMemoryUsageGPU(a);this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};d.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a)};d.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};d.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0};d.prototype.ignoresMemoryFactor=function(){return!1};
d.prototype._labelsVisibleChange=function(){var a=this;u.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);if(L.areLabelsVisible(this.layer)&&this._supportsLabeling){var b=new Q.default({view:this.view,layer:this.layer,collection:this._collection});this._nodeId2Meta.forEach(function(c){a._addMetaToLabeler(b,c)});this._labeler=b}};d.prototype._addMetaToLabeler=function(a,b){var c=this;a.addNodeMeta(b,function(a,b){return c._createAttributes(a,b)})};d.prototype._suspendedChange=function(a){a?
(this._removeAllNodeDataFromStage(),this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};d.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),"Total GPU Memory Estimate":(this.gpuMemoryEstimate/
1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};d.prototype.getLoadedAttributes=function(a){if((a=this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};d.prototype.getAttributeData=function(a){if((a=
this._nodeId2Meta.get(a))&&a.attributeInfo)return a.attributeInfo.attributeData};d.prototype.setAttributeData=function(a,b){var c=this;if(a=this._nodeId2Meta.get(a))a.attributeInfo=b,a.cachedRendererVersion=this._getInvalidRendererVersion(),a.filteredIds=null,u.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(a,function(a,b){return c._createAttributes(a,b)}),this._updateEngineObject(a)};d.prototype.getLoadedNodeIds=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node.id)});
return a.sort()};d.prototype.getLoadedNodes=function(){var a=[];this._nodeId2Meta.forEach(function(b){return a.push(b.node)});return a};d.prototype.getLoadedNodeIndices=function(a){this._nodeId2Meta.forEach(function(b,c){return a.push(c)})};d.prototype._createTexture=function(a,b,c,d){if(u.isNone(c)||null==c.data)return null;var e=c.data,f=b.wrapTextures;b=c.usage&1?"opaque"===b.alphaMode?3:4:3;var g=!0,h;c.encoding===V.DDS_ENCODING_STRING?h=ta.DDS_ENCODING:g=p.isPowerOfTwo(e.width)&&p.isPowerOfTwo(e.height);
g=(d?this._enableAtlasMipMaps:this._enableMipMaps)&&g;c=new ta(e,a.id+"/"+c.id,{mipmap:g,wrap:d||!f?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:d&&g&&this._disableAtlasAnisotropy,encoding:h,noUnpackFlip:!0,components:b});this._stage.add(4,c);a.memory+=this.memEstimateTextureAdded(c);return c};d.prototype._getVertexBufferLayout=function(a,b){a={hasTexture:sa(a.params.material),hasNormals:null!=b.vertexAttributes.normal,hasRegions:null!=b.vertexAttributes.uvRegion};return ja.glLayout(la.createVertexBufferLayout(this._getGeometryParameters(a)))};
d.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};d.prototype._findGraphicNodeAndIndex=function(a){var b=ca.attributeLookup(a.attributes,this._getObjectIdField()),c=null;g.someMap(this._nodeId2Meta,function(a){var d=a.featureIds.indexOf(b);if(-1===d)return!1;c={node:a.node,index:d};return!0});return c};d.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.index);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=ca.attributeLookup(b[e].attributes,
d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};d.prototype.whenGraphicBounds=function(a){a=this._findGraphicNodeAndIndex(a);if(!a)return t.reject();var b=this._nodeId2Meta.get(a.node.index).objectHandle;a=W.boundingBoxCornerPoints(a.index,this._collection,b,new Float64Array(24));if(qa.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=K.empty(),K.expandWithBuffer(b,a,0,8),t.resolve({boundingBox:b,screenSpaceObjects:[]})};d.prototype.whenGraphicAttributes=
function(a,b){var c=this;return V.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);h.graphics.push(f)}return d},{populateObjectId:!0})};d.prototype.getGraphicFromIntersectorMetadata=function(a){if(null==a.nodeIndex||null==a.componentIndex)return null;var b=this._nodeId2Meta.get(a.nodeIndex);return null==
b||null==b.featureIds||a.componentIndex>=b.featureIds.length?null:this._createGraphic(a.componentIndex,b)};d.prototype._getCacheKey=function(a){return this._layerUrl+"/v10/"+a.id+this._cacheKeySuffix};d.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};d.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};d.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.index))};
d.prototype.loadMissingTextures=function(a,b,c,d){var e=this,f=a.filter(function(a,c){if(0===(a.usage&e.rendererTextureUsage))return!1;if(u.isNone(b))return!0;a=V.selectEncoding(a.encodings,e.useCompressedTextures);c=b[c];return u.isNone(c)||null==c.data||a&&c.encoding!==a.encoding?!0:!1});return 0===f.length?t.resolve(!1):c(f,d).then(function(c){for(var d=0,e=0;e<a.length;e++)d<c.length&&c[d].id===a[e].id&&(b[e]=c[d],d++);return!0})};d.prototype.loadCachedNodeData=function(a,b,c){var d=this;return this._cachingEnabled()?
this._idbCache.get(this._getCacheKey(a),b).then(function(e){if(null==e)return null;if(e.nodeVersion!==a.version)return d._idbCache.remove(d._getCacheKey(a)),null;a.obb||d._setComputedObb(a,e.nodeObb);return d.loadMissingTextures(e.requiredTextures,e.textureData,c,b).then(function(c){c&&d._idbCache.initialized&&u.isSome(e.textureData)&&(e.byteSize=ra(e.transformedGeometries,e.textureData),e.textureData.every(xa)&&oa(a,e)&&d._idbCache.put(d._getCacheKey(a),e).catch(function(b){return pa.warn("Failed to update node with textures in IndexedDB cache: "+
a.id+": "+b)}));t.throwIfAborted(b);return e})}):t.resolve(null)};d.prototype.addNodeData=function(a,b){var c=this;if(0===b.allGeometryData.length||0===b.allGeometryData[0].geometries.length)return t.resolve();1!==b.allGeometryData.length&&pa.warn("Node with",b.allGeometryData.length,"geometries is unsupported");return this._addData(a,b.attributeDataInfo,function(){return c._transformNode(a,b).then(function(b){return c._controller.reschedule(a.index,b)}).then(function(d){a.obb||c._setComputedObb(a,
d.obb);b.allGeometryData[0].componentOffsets=d.componentOffsets;d.featureIds&&(b.allGeometryData[0].featureIds=Array.prototype.slice.call(d.featureIds));d={geometryData:b.allGeometryData[0],transformedGeometries:d.transformedGeometries,requiredTextures:b.requiredTextures,textureData:b.textureData,nodeVersion:a.version,nodeObb:a.obb,byteSize:c._cachingEnabled()?ra(d.transformedGeometries,b.textureData):0};if(oa(a,d)&&c._idbCache.initialized){var e=u.isSome(d.textureData)?d.textureData.map(function(a){return xa(a)?
a:null}):null;c._idbCache.put(c._getCacheKey(a),l({},d,{textureData:e})).catch(function(b){return pa.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c._addCachedNodeData(a,d)})})};d.prototype._setComputedObb=function(a,b){a.obb=ba.clone(b);a.isComputedObb=!0;this._controller.updateVisibility(a.index)};d.prototype._transformNode=function(a,b){for(var c=this,d=b.allGeometryData[0].geometries,e=Array(d.length),f=0;f<d.length;++f)e[f]=this._getVertexBufferLayout(d[f],b.geometryIndex);
var g={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData[0],geometryIndex:b.geometryIndex,layouts:e,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",
g,{transferList:[b.geometryBuffer]}):T.ensureDracoDecoder(g).then(function(){return c._controller.reschedule(a.index,g).then(function(a){return c._worker.transform(a)})})};d.prototype.addCachedGPUData=function(a,b,c){this._controller.isGeometryVisible(a)?(u.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,b),this._addNodeMeta(a.index,b),this.updateNodeStatus(a.index,c),this._collection.setObjectVisibility(b.objectHandle,!0),this._updateMaterial(b),this._updateEngineObject(b),this._highlights.objectCreated(b),
this._treeDebugger&&this._treeDebugger.update()):(c=this._controller.indexDepth-a.level,this._memCache.put(this._getMemCacheKey(a.index),b,a.memory,c))};d.prototype.addCachedNodeData=function(a,b,c){var d=this;return this._addData(a,c,function(){return d._addCachedNodeData(a,b)})};d.prototype._addCachedNodeData=function(a,b){var c=this;if(this.suspended||!this._controller.isGeometryVisible(a))return t.resolve();var d=b.geometryData,e=b.transformedGeometries,f=u.isSome(b.textureData)?b.textureData.filter(function(a){return u.isSome(a)&&
0!==(a.usage&c.rendererTextureUsage)}):null;a.memory=0;var g=d.componentOffsets,h=d.geometries,d=d.featureIds,k=null,l=null;if(this._hasSymbolColors)for(var k=this._componentColorManager.getBuffer(d.length),l=new Uint16Array(d.length),m=0;m<d.length;m++)l[m]=k.acquireIndex();var n=this._collection,h=h[0],e=e[0],p=this._materialParameters(h,e.layout),g=g||new Uint16Array([0,e.indices?e.indices.length:e.interleavedVertexData.byteLength/e.layout[0].stride]),g={vertices:{data:e.interleavedVertexData,
count:e.interleavedVertexData.byteLength/e.layout[0].stride,layoutParameters:p.geometryParams},positionData:{positions:e.positionData.data,indices:e.positionData.indices},indices:e.indices,primitiveType:4,componentOffsets:g},l=h.transformation?G.mat4f64.clone(h.transformation):G.mat4f64.create();E.mat4.multiply(l,e.corMatrices.globalTrafo,l);var k=E.mat4.getTranslation(J.vec3f64.create(),l),l=B.mat3.fromMat4(C.mat3f32.create(),l),q=n.createObject({geometry:g,obb:a.renderObb,transform:{position:k,
rotationScale:l},visible:!1}),g=u.isSome(f)?f.map(function(b){return c._createTexture(a,p.material,b,2===p.geometryParams.textureCoordinates)}):[];this._configureMaterial(q,h.params.material,g,f);a.memory+=this.memEstimateGeometryAdded(q);var f=this._addTasks.get(a.index),r=new na;r.node=a;r.featureIds=d;r.objectHandle=q;r.cachedRendererVersion=this._getInvalidRendererVersion();r.attributeInfo=f.attributeInfo;r.material={alphaMode:h.params.material.alphaMode,isSchematic:h.params.material.isSchematic};
r.textures=g;f.meta=r;!this._hasTextures&&b.requiredTextures.some(function(a){return 0!==(a.usage&19)})&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||e.hasColors;this._hasTextures=this._hasTextures||!!a.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var w=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(r).then(function(b){var d=c._addTasks.get(a.index);if(d)if(u.isSome(c._labeler)&&c._addMetaToLabeler(c._labeler,r),c._addNodeMeta(a.index,
r),c.suspended)c._removeNodeStageData(a.index,c.elevationOffset);else{n.setObjectVisibility(q,!0);r.attributeInfo=d.attributeInfo;var d=r.cachedRendererVersion!==c._rendererVersion,e=w!==c.slicePlaneEnabled;c._setObjectSymbology(r);var f=c._applyFiltersToNode(r);(d||b&&(e||f))&&c._addOrUpdateEdgeRendering(r);c.visibleGeometryChanged(r);c._highlights.objectCreated(r);c._updateMaterial(r);c._markParentsAsHole(a.index);c._treeDebugger&&c._treeDebugger.update()}})};d.prototype._addNodeMeta=function(a,
b){this._nodeId2Meta.has(a)&&(pa.error("Removing duplicated node"),this._deleteComponentObject(this._nodeId2Meta.get(a)));this._nodeId2Meta.set(a,b)};d.prototype._materialParameters=function(a,b){a=a.params.material;var c=b.some(function(a){return"uvRegion"===a.name});b=b.some(function(a){return"normalCompressed"===a.name});var d=sa(a);return{geometryParams:this._getGeometryParameters({hasTexture:d,hasNormals:b,hasRegions:c}),material:a}};d.prototype._configureMaterial=function(a,b,c,d){var e=this,
f=this.rendererTextureUsage,g=function(a){a:{a&=f;if(!u.isNone(d)&&0!==a)for(var b=0;b<d.length;b++){var e=d[b];if(u.isSome(e)&&0!==(e.usage&a)){a=c[b].id;break a}}a=null}return a};this._collection.updateMaterial(a,function(a){var c=e._isIntegratedMesh,d=b.metallicRoughness.baseColorFactor,f=p.clamp(b.metallicRoughness.baseColorFactor[3],0,1);a.baseColor=[d[0],d[1],d[2],f];a.objectOpacity=e.fullOpacity;a.roughnessFactor=b.metallicRoughness.roughnessFactor;a.metallicFactor=b.metallicRoughness.metallicFactor;
a.emissiveFactor=b.emissiveFactor;a.reflectanceFactor=b.isSchematic?.2:.5;a.usePBR=e._usePBR(b.isSchematic);a.isIntegratedMesh=e._isIntegratedMesh;a.alphaCutoff=b.alphaCutoff;a.alphaDiscardMode="opaque"===b.alphaMode?1:"mask"===b.alphaMode?2:0===b.alphaCutoff?0:3;var d=e._stage.renderView.textureRepository,h=g(33);h&&(a.baseColorTexture=new ma.RenderTexture(d,h));if(h=g(2))a.metallicRoughnessTexture=new ma.RenderTexture(d,h);if(h=g(16))a.emissionTexture=new ma.RenderTexture(d,h);if(h=g(8))a.occlusionTexture=
new ma.RenderTexture(d,h);if(h=g(4))a.normalTexture=new ma.RenderTexture(d,h);a.commonMaterialParameters.slicePlaneEnabled=e.slicePlaneEnabled;a.commonMaterialParameters.doubleSided=b.doubleSided;a.commonMaterialParameters.cullFace=b.cullFace;a.transparencyHint=null;c?a.transparencyHint=!1:1===e.fullOpacity*f&&"blend"!==b.alphaMode?a.transparencyHint=!1:"blend"===b.alphaMode&&(a.transparencyHint=!0)})};d.prototype._getGeometryParameters=function(a){return{textureCoordinates:a.hasTexture?a.hasRegions?
2:1:0,colors:this._hasVertexColors,normals:a.hasNormals&&!this._isIntegratedMesh}};d.prototype._addData=function(a,b,c){var d=this,e=this._addTasks.get(a.index);e?e.attributeInfo=b:(e=l({},t.createResolver(),{attributeInfo:b,meta:null}),this._addTasks.set(a.index,e),c().then(e.resolve,e.reject).then(function(){return d._addTasks.delete(a.index)}).catch(function(b){d._addTasks.delete(a.index);throw b;}));return e.promise};d.prototype._clearAddTasks=function(){var a=this;this._addTasks.forEach(function(b){u.isSome(b.meta)&&
a._deleteComponentObject(b.meta)});this._addTasks.clear()};d.prototype._markParentsAsHole=function(a){if(this._isIntegratedMesh){var b=this._controller;for(a=b.getParentIndex(a);a;a=b.getParentIndex(a))this.updateNodeStatus(a,"hole")}};d.prototype._clippingAreaChanged=function(){var a=K.create();qa.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};
d.prototype._filterChange=function(){this._applyFilters(!1)};d.prototype._applyFilters=function(a){var b=this;this._filters=this.getFilters();a?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(function(a){b._applyFiltersToNode(a)&&(b._addOrUpdateEdgeRendering(a),b.visibleGeometryChanged(a))})};d.prototype.getFilters=function(){var a=this,b=[];this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};d.prototype.addSqlFilter=function(a,
b,c,d){var e=this;b&&c&&a.push(function(a,f){return e._sqlFilter(a,f,b,c,d)})};d.prototype._sqlFilter=function(a,b,c,d,e){var f={},g=this._createLayerGraphic(f),h=this.layer.objectIdField,k=b.featureIds,l=b.attributeInfo.attributeData;d.every(function(a){return null!=l[a]||a===h})&&V.filterInPlace(a,k,function(a){f[h]=k[a];for(var b=0;b<d.length;b++){var m=d[b];m!==h&&(f[m]=V.getCachedAttributeValue(l[m],a))}try{return c.testFeature(g)}catch(Ab){return e(Ab),!1}})};d.prototype._boundingboxNodeTest=
function(a,b){qa.mbsToMbs(a.node.mbs,this._controller.crsIndex,Ma,this.view.renderSpatialReference);return V.intersectBoundingBoxWithMbs(b,Ma)};d.prototype._boundingboxFeatureTest=function(a,b,c){return K.intersects(c,this._collection.getComponentAABB(a.objectHandle,b,ya))};d.prototype._boundingboxFilter=function(a,b,c){var d=this,e=this._collection,f=this._boundingboxNodeTest(b,c);if(3!==f)if(0===f)a.length=0;else if(e=e.getComponentCount(b.objectHandle),e.invisible+e.visible===b.featureIds.length){var g=
this._transformAABB(da,c,b.objectHandle);V.filterInPlace(a,b.featureIds,function(a){return d._boundingboxFeatureTest(b,a,g)})}};d.prototype._transformAABB=function(a,b,c){var d=this._collection.getObjectTransform(c);c=d.position;d=d.rotationScale;a[0]=(b[0]-c[0])/d[0];a[1]=(b[1]-c[1])/d[4];a[2]=(b[2]-c[2])/d[8];a[3]=(b[3]-c[0])/d[0];a[4]=(b[4]-c[1])/d[4];a[5]=(b[5]-c[2])/d[8];return a};d.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return t.resolve();var c=
a.objectHandle,d=this._edgeView.hasObject(c);a=this._extractObjectEdgeMaterials(a);var e=a.perFeatureEdgeMaterials,f={slicePlaneEnabled:this.slicePlaneEnabled};if(a.hasEdges)return d?(this._edgeView.updateAllComponentMaterials(c,e,f,b),this._edgeView.updateObjectVisibility(c,!0),t.resolve(!0)):this._collection.addEdges(c,this._edgeView,e,f).then(function(){return!0});d&&this._edgeView.removeObject(c);return t.resolve(!1)};d.prototype._removeEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&
this._edgeView.removeObject(a.objectHandle)};d.prototype._applyFiltersToNode=function(a){return this._applyFiltersToNodeComponents(a)?(u.isSome(this._labeler)&&this._labeler.applyFilterChange(a),!0):!1};d.prototype._applyFiltersToNodeComponents=function(a){var b=this._collection,c=0===b.getComponentCount(a.objectHandle).invisible;b.setAllComponentVisibilities(a.objectHandle,"all");if(0===this._filters.length)return a.filteredIds=null,!c;this._updateCachedFilteredIds(a);if(a.filteredIds===a.featureIds)return!c;
c=this._computeFilteredComponentIndices(a);b.setAllComponentVisibilities(a.objectHandle,c);return!0};d.prototype._updateCachedFilteredIds=function(a){if(null==a.filteredIds||a.appliedFilters!==this._filters)a.filteredIds=this._computeFilteredIds(a),a.appliedFilters=this._filters};d.prototype._computeFilteredIds=function(a){for(var b=a.featureIds.slice(),c=0,d=this._filters;c<d.length&&((0,d[c])(b,a),0!==b.length);c++);return b.length===a.featureIds.length?a.featureIds:b};d.prototype._computeFilteredComponentIndices=
function(a){var b=[];a.featureIds.forEach(function(c,d){a.filteredIds[b.length]===c&&b.push(d)});return b};d.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};d.prototype.removeNodeData=function(a,b){for(var c=this.elevationOffset;0<a.length&&!b.done;){var d=a.pop();this._removeNodeStageData(d,c);b.madeProgress()}};d.prototype._removeNodeStageData=function(a,b){var c=this._nodeId2Meta.get(a);
if(c){this._collection.setObjectVisibility(c.objectHandle,!1);this.visibleGeometryChanged(c);this._removeEdgeRendering(c);u.isSome(this._labeler)&&this._labeler.removeNodeMeta(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(c);var d=this._controller.indexDepth-c.node.level+1;this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory,d);this._treeDebugger&&this._treeDebugger.update()}};d.prototype._deleteComponentObject=function(a){this._edgeView&&this._edgeView.removeObject(a.objectHandle);
this.memEstimateGeometryRemoved(a.objectHandle);this._collection.destroyObject(a.objectHandle);if(a.textures){var b=0;for(a=a.textures;b<a.length;b++){var c=a[b];this.memEstimateTextureRemoved(c);this._stage.remove(4,c.id)}}};d.prototype.updateNodeStatus=function(a,b){(a=this._nodeId2Meta.get(a))&&this._collection.updateMaterial(a.objectHandle,function(a){a.polygonOffsetEnabled="hole"===b})};d.prototype._getInvalidRendererVersion=function(){return V.addWraparound(this._rendererVersion,-1)};d.prototype._rendererChange=
function(b){return e(this,void 0,void 0,function(){var c,d,e,f,g,h,k,l,m;return a(this,function(a){switch(a.label){case 0:this._currentRenderer=b;this.notifyChange("rendererTextureUsage");this._rendererVersion=V.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;if(!b)return[3,2];c=this;d=V.findFieldsCaseInsensitive;return[4,b.getRequiredFields(this.layer.fields)];case 1:c._rendererFields=d.apply(void 0,[a.sent(),this.layer.fields]),a.label=
2;case 2:if(!(!this._arcade&&b&&"arcadeRequired"in b&&b.arcadeRequired))return[3,4];e=this;return[4,S.loadArcade()];case 3:e._arcade=a.sent(),a.label=4;case 4:if(b&&"visualVariables"in b&&b.visualVariables)for(f=0,g=b.visualVariables;f<g.length;f++)h=g[f],"color"===h.type?this._colorVariable=h:"opacity"===h.type?this._opacityVariable=h:pa.warn("Unsupported visual variable type for 3D Object Scene Services: "+h.type);if(b)for(k=0,l=b.getSymbols();k<l.length;k++)m=l[k],"mesh-3d"!==m.type&&pa.error("Symbols of type '"+
m.type+"' are not supported for 3D Object Scene Services.");this._controller&&this._controller.requestUpdate();return[2]}})})};d.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};d.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return function(b,c){b*=5;I.vec4.set(c.externalColor,
a.cachedSymbolColors[b+0]/255,a.cachedSymbolColors[b+1]/255,a.cachedSymbolColors[b+2]/255,a.cachedSymbolColors[b+3]/255);c.externalColorMixMode=a.cachedSymbolColors[b+4]&3;c.castShadows=0!==(a.cachedSymbolColors[b+4]&16)}};d.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b={},c=this._currentRenderer,d=a.attributeInfo.attributeData,e=null!=a.featureIds?this.layer.objectIdField:null,f=null!=d?this._rendererFields:null;a.cachedSymbolColors||
(a.cachedSymbolColors=new Uint8Array(5*a.featureIds.length));for(var g=0,h=0;h<a.featureIds.length;h++){var k=this._tmpAttributeOnlyGraphic;k.attributes=b;null!=e&&(b[e]=a.featureIds[h]);if(null!=f)for(var l=0,m=f;l<m.length;l++){var n=m[l];d[n]&&(b[n]=V.getCachedAttributeValue(d[n],h))}m=c&&c.getSymbol(k,{arcade:this._arcade});l=null;m instanceof R&&(this._symbolInfos.has(m.id)||this._symbolInfos.set(m.id,V.getSymbolInfo(m)),l=this._symbolInfos.get(m.id));a.cachedSymbolInfos[h]=l;var n=m=null,p=
!0,q=1;c&&"visualVariables"in c&&(this._colorVariable&&(p=P.getColor(this._colorVariable,k,{color:Ja,arcade:this._arcade}))&&(m=Oa,m[0]=p.r/255,m[1]=p.g/255,m[2]=p.b/255,this._opacityVariable||null===p.a||(n=p.a)),this._opacityVariable&&(n=P.getOpacity(this._opacityVariable,k,{arcade:this._arcade})));l&&l.material&&(k=l.material,m=u.isNone(m)||u.isNone(n)?Y.overrideColor(m,n,k.color,k.alpha,ia,Oa):Y.overrideColor(m,n,null,null,ia,Oa),q=ha.parseColorMixMode(k.colorMixMode));p=l?l.castShadows:!0;a.cachedSymbolColors[g+
0]=u.isSome(m)?Math.round(255*m[0]):255;a.cachedSymbolColors[g+1]=u.isSome(m)?Math.round(255*m[1]):255;a.cachedSymbolColors[g+2]=u.isSome(m)?Math.round(255*m[2]):255;a.cachedSymbolColors[g+3]=u.isSome(m)?Math.round(255*m[3]):255;a.cachedSymbolColors[g+4]=q|+p<<4;g+=5}}};d.prototype._extractObjectEdgeMaterials=function(a){var b=a.objectHandle,c=a.featureIds?a.featureIds.length:1,d=Array(c),e=U.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),f={opacity:this.fullOpacity,objectTransparency:2};this._collection.updateMaterial(b,
function(a){f.objectTransparency=a.hasVisibleComponents?a.hasTransparency?1:2:0});var g=!1,h=null,k=null,l=this._getSymbolInfos(a);for(a=0;a<c;a++)d[a]=e;this._collection.forEachVisibleComponent(b,function(a){var b=l[a];if(!b)return!0;k!==b&&(k=b,(h=U.createMaterialFromEdges(b.edges,f))&&(g=!0));d[a]=u.isSome(h)?h:e;return!0});return{hasEdges:g,perFeatureEdgeMaterials:d}};d.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){var b=a.objectHandle,c=this._getSymbolColors(a);this._collection.setComponentData(b,
c);this._stage.renderView.setNeedsRender();this._updateEdgeRendering(a)}};d.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};d.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(c){b._collection.updateMaterial(c.objectHandle,function(d){return b._updateMaterialOpacity(d,c.material,a)});b._updateEdgeRendering(c)})};d.prototype._updateMaterial=function(a){var b=
this;this._collection.updateMaterial(a.objectHandle,function(c){c.commonMaterialParameters.slicePlaneEnabled=b.slicePlaneEnabled;c.usePBR=b._usePBR(a.material.isSchematic);b._updateMaterialOpacity(c,a.material,b.fullOpacity)})};d.prototype._updateMaterialOpacity=function(a,b,c){a.objectOpacity=c;this._isIntegratedMesh||"blend"===b.alphaMode||(a.transparencyHint=1===c*a.baseColor[3]?!1:null)};d.prototype._updateEngineObject=function(a){this._setObjectSymbology(a);this._applyFiltersToNode(a);this._addOrUpdateEdgeRendering(a);
this.visibleGeometryChanged(a)};d.prototype._slicePlaneEnabledChange=function(a){var b=this;this._intersectionHandler&&(this._intersectionHandler.slicePlane=a);u.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=a);this._nodeId2Meta.forEach(function(c){b._collection.updateMaterial(c.objectHandle,function(b){b.commonMaterialParameters.slicePlaneEnabled=a});b._updateEdgeRendering(c,!1)})};d.prototype._updatePBR=function(){var a=this;this._nodeId2Meta.forEach(function(b){a._collection.updateMaterial(b.objectHandle,
function(c){c.usePBR=a._usePBR(b.material.isSchematic)})})};d.prototype._usePBR=function(a){return!this._isIntegratedMesh&&(a?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)};d.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.objectHandle)&&this._addOrUpdateEdgeRendering(a,b)};d.prototype._forAllFeatures=function(a,b,c){var d=this;void 0===c&&(c=0);g.someMap(this._nodeId2Meta,function(e){if(u.isSome(b))switch(b(e)){case 0:return!0;
case 2:return!1}var f=1;switch(c){case 1:f=d._forAllFeaturesOfNode(e,a);break;case 0:f=d._forVisibleFeaturesOfNode(e,a);break;case 2:f=d._forAllFeaturesOfNodeInClippingArea(e,a)}return 0===f})};d.prototype._forAllFeaturesOfNode=function(a,b){for(var c=1,d=a.featureIds,e=0;e<d.length&&(c=b(d[e],e,a),0!==c);e++);return c};d.prototype._forVisibleFeaturesOfNode=function(a,b){var c=1,d=a.featureIds;this._collection.forEachVisibleComponent(a.objectHandle,function(e){c=b(d[e],e,a);return 1===c});return c};
d.prototype._forAllFeaturesOfNodeInClippingArea=function(a,b){if(null==this._clippingArea)return this._forAllFeaturesOfNode(a,b);var c=this._boundingboxNodeTest(a,this._clippingArea);if(0===c)return 1;if(3===c)return this._forAllFeaturesOfNode(a,b);for(var c=a.featureIds,d=V.getClipAABB(this._clippingArea,this._collection.getObjectTransform(a.objectHandle)),e=0;e<c.length;e++)if(this._boundingboxFeatureTest(a,e,d)){var f=b(c[e],e,a);if(0===f)return f}return 1};d.prototype._createAttributes=function(a,
b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo.attributeData;if(null!=b)for(var d=0,e=Object.keys(b);d<e.length;d++){var f=e[d];c[f]=V.getCachedAttributeValue(b[f],a)}return c};d.prototype._createGraphic=function(a,b){return this._createLayerGraphic(this._createAttributes(a,b))};d.prototype.highlight=function(a,b){var c=this;void 0===b&&(b={});var d=this._highlights;"number"===typeof a?a=[a]:a instanceof k?a=[a]:a instanceof n&&(a=a.toArray());if(Array.isArray(a)&&
0<a.length){if(a[0]instanceof k){a=a.map(function(a){return ca.attributeLookup(a.attributes,c._getObjectIdField())});var e=d.acquireSet(b);b=e.set;e=e.handle;d.setFeatureIds(b,a);return e}if("number"===typeof a[0])return e=d.acquireSet(b),b=e.set,e=e.handle,d.setFeatureIds(b,a),e}return z};d.prototype.visibleGeometryChanged=function(a){var b=this;this._elevationProvider&&(this._elevationProvider.objectChanged(a.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=
x.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null})))};d.prototype.test=function(){var a=this;return{controller:this._controller,get visibleObjectIds(){var b=[];a._forAllFeatures(function(a){b.push(a);return 1},null,0);b.sort(function(a,b){return a-b});return b},get numNodes(){return a._nodeId2Meta.size}}};h([A.property()],d.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);h([A.property()],d.prototype,"view",void 0);h([A.property()],d.prototype,
"layer",void 0);h([A.property()],d.prototype,"_controller",void 0);h([A.property()],d.prototype,"_labeler",void 0);h([A.property({dependsOn:["updatingMeshView3D"]})],d.prototype,"updating",void 0);h([A.property({dependsOn:["_controller.updating","_visibleGeometryChangedSchedulerHandle","_labeler.updating"]})],d.prototype,"updatingMeshView3D",null);h([A.property({dependsOn:["_controller.rootNodeVisible"]})],d.prototype,"suspended",void 0);h([A.property(ea.updatingProgress)],d.prototype,"updatingProgress",
void 0);h([A.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],d.prototype,"updatingProgressValue",void 0);h([A.property({readOnly:!0})],d.prototype,"hasTexturesOrVertexColors",null);h([A.property({readOnly:!0})],d.prototype,"rendererTextureUsage",null);h([A.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],d.prototype,"elevationOffset",null);h([A.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0);h([A.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled",
"useCompressedTextures"]})],d.prototype,"uncompressedTextureDownsamplingEnabled",null);h([A.property({dependsOn:["layer.version"]})],d.prototype,"useCompressedTextures",null);return d=h([A.subclass("esri.views.3d.layers.I3SMeshView3D")],d)}(A.declared(b))};var ya=K.create(),da=K.create(),Oa=[0,0,0,0],Ja=new d([0,0,0,0]),Ma=[0,0,0,0],z={remove:function(){},pause:function(){},resume:function(){}}})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/arrayUtils ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/support/projectionUtils ../../../views/support/layerViewUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K){function H(a,b){return a.length===b.length&&a.every(function(a){return 0<=L(b,a.name)})}function L(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function P(a){return null!=a&&null!=a.loadedAttributes&&null!=a.attributeData}var S=k.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");q=function(b){function c(a){a=b.call(this,a)||this;a.screenSizeFactor=0;a.featureTarget=
5E4;a.fixedFeatureTarget=!1;a.updating=!0;a.updatingProgress=1;a.leafsReached=!1;a.scaleVisibilityEnabled=!0;a.uncompressedTextureDownsamplingEnabled=!1;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._invisibleDirty=!1;a._newLoadingNodes=new n({deallocator:null});a._loadedNodeScales=new Map;a._abortController=g.createAbortController();a._downloadingNodes=new Set;a._loadingNodeRevisions=new Map;a._nextLoadingNodeRevision=0;a._updatingNodes=new Set;a._progressMaxNumNodes=1;
a._poi=t.vec3f64.create();a._requiredAttributes=[];a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableIDBCache=!1;a.disableMemCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new e;a._idleQueue=new m.PromiseQueue;a._errorCount=0;return a}l(c,b);Object.defineProperty(c.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"isGraphics3D",{get:function(){return"points"===this.layer.profile},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"streamDataController",{get:function(){var a=this.layerView.view.resourceController.createStreamDataRequester(2);return new E.default(a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsVertex",{get:function(){return G.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsIndex",{get:function(){return G.getIndexCrs(this.layer)},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rootNodeVisible",{get:function(){var a=this._index&&this._index.rootNode;return a?(this._updateViewData(),this._index.isNodeVisible(a.index)):!0},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;this._lodHandling=new B(this.layerView);var b=this.layerView.layer;this.layer=b;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this.disableIDBCache=d("disable-feature:idb-cache");"fields"in b&&(this._fields=
b.fields,this._attributeStorageInfo=b.attributeStorageInfo);var c=g.all([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var c=a.layerView.view;a._setClippingArea(c.clippingArea);a._centerOnSurface=c.pointsOfInterest.centerOnSurfaceFrequent;var d=a.layerView.view.resourceController;a._handles.add([a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}),d.memoryController.events.on("quality-changed",function(){return a._setCameraDirty()}),
r.init(a.layerView,"suspended",function(b){var c=b?function(){return a._updateViewData()}:function(){return a._updateIdleState(!0)},e=b?function(){}:function(){return a._updateIdleState(!1)};a._idleStateCallbacks?(b&&a.cancelNodeLoading(),a.restartNodeLoading(),a._idleStateCallbacks.idleBegin=c,a._idleStateCallbacks.idleEnd=e):a._idleStateCallbacks=d.scheduler.registerIdleStateCallbacks(c,e)}),w.addTask(a.layerView.view.resourceController.scheduler,{update:function(b,c){return a._frame(b,c)},needsUpdate:function(){return a.updating}}),
a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()}),a.watch(["featureTarget","fixedFeatureTarget"],function(){a._setCameraDirty();a._stableFeatureLOD=!1}),c.state.watch("camera",function(){return a._setCameraDirty()}),a.layer.watch("elevationInfo",function(){return a._elevationInfoChanged()}),a.layer.watch(["minScale","maxScale"],function(){return a._scaleBoundsChanged()}),a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),a.layerView.watch("availableFields?",
function(){return a._requiredFieldsChange()})]);a._updateScaleHandles();a._viewportQueries=new J(a.crsIndex,c.renderCoordsHelper,c.state.camera,a._clippingArea,c.elevationProvider,a.layer.elevationInfo,{progressiveLoadFactor:a._getProgressiveLoadFactor(),screenspaceErrorBias:a.lod,angleDependentLoD:.5>a.lod});a._index=new A.I3SIndex(b,a.streamDataController,a._viewportQueries,S,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b,
"leaf")},function(b){return a._needsUpdate(b)},function(){return!a.streamDataController.busy})}});this._tmpPoint=y.makeDehydratedPoint(0,0,0,this.crsIndex);this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};c.prototype.destroy=function(){this._abortController.abort();this._abortController=null;this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;R.prune()};c.prototype._getRequiredAttributes=
function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];var a=this._attributeStorageInfo,b=this._fields,c=this.layer.objectIdField;return this.layerView.availableFields.map(function(c){var d=L(a,c);c=L(b,c);return 0<=d&&0<=c?{index:d,name:b[c].name,field:b[c],attributeStorageInfo:a[d]}:null}).filter(function(a){return null!=a&&a.name!==c})};c.prototype._requiredFieldsChange=function(){H(this._requiredAttributes,this._getRequiredAttributes())||this.requestUpdate()};
c.prototype.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};c.prototype._setClippingArea=function(a){var b=x.create();I.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};c.prototype._pointOfInterestChanged=function(){this._poi&&this.camPos&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.setPointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=
O.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate())))};c.prototype._calculatePointOfInterest=function(a){var b=this._centerOnSurface.renderLocation,c=t.vec3f64.create();u.vec3.subtract(c,b,this.camPos);var d=this.layerView.view.renderCoordsHelper,e=t.vec3f64.create();d.worldUpAtPosition(b,e);c=u.vec3.angle(e,c)-.5*Math.PI;u.vec3.lerp(a,this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));return a};c.prototype.updateClippingArea=function(a){this._setClippingArea(a);
this._viewportQueries&&this._index&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};c.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};c.prototype.updateElevationChanged=function(a,b){if(null!=this._index){null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new n({deallocator:null}));var c=this._elevationUpdateNodes;
c.clear();var d=this._index.rootNode;null!=d&&G.findIntersectingNodes(a,b,d,this.crsIndex,this._index,function(a){return c.push(a.index)});for(a=0;a<c.length;a++)b=c.data[a],this._index.invalidateBoundingVolumeCache(b),b===d.index&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()}};c.prototype.getParentIndex=function(a){return this._index.getParentIndex(a)};c.prototype._elevationInfoChanged=function(){this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};
c.prototype._updateScaleHandles=function(){var a=this;this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",function(b){return a._scaleUpdateHandler(b)}),"scale-bounds")};c.prototype._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};c.prototype._scaleUpdateHandler=function(a){this._updateScaleInBoundingRect(a.scale,a.extent,a.spatialReference);
this._setCameraDirty()};c.prototype._updateScaleInBoundingRect=function(a,b,c){var d=this;null!=this._index.rootNode&&I.boundingRectToBoundingRect(b,c,Q,this.crsIndex)&&this._loadedNodeScales.forEach(function(b,c){b=d._index.getNode(c);v.containsPoint(Q,b.mbs)&&d._loadedNodeScales.set(c,a)})};c.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};c.prototype.schedule=function(a,b){var c=this;return this._idleQueue.push(b).then(function(b){if(!c._loadingNodeRevisions.has(a)&&
!c._updatingNodes.has(a))throw g.createAbortError();return b})};c.prototype.reschedule=function(a,b){var c=this;return this._idleQueue.unshift(b).then(function(b){if(!c._loadingNodeRevisions.has(a)&&!c._updatingNodes.has(a))throw g.createAbortError();return b})};Object.defineProperty(c.prototype,"isIntegratedMesh",{get:function(){return"integrated-mesh"===this.layer.type},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"areScaleBoundsActive",{get:function(){var a=K.extractSafeScaleBounds(this.layer),
b=a.minScale,a=a.maxScale;return this.scaleVisibilityEnabled&&(0<b||0<a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"indexDepth",{get:function(){return this._index?this._index.maxLevel:0},enumerable:!0,configurable:!0});c.prototype._frame=function(a,b){if(this.layerView.suspended)return this._updateViewData(),
this._evaluateUpdating(),-Infinity;if(!this.layerView.visible)return-Infinity;this._processLogError(a,b);return this._index.getPriority()};c.prototype._processLogError=function(a,b){try{this._process(a,b)}catch(W){50>this._errorCount?S.error("Error during processing: "+W):50===this._errorCount&&S.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};c.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&this._startNodeLoading();if(null!=
this._nodeLoader&&null!=this._index){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(a)&&(this._invisibleDirty=!1);this.isIntegratedMesh&&(a.enabled=!1);a.run(function(){return c._processIndex(a)});this._updateFeatureLOD();a.run(function(){return c._processCache(a)});this.isIntegratedMesh&&(a.enabled=!0);for(a.run(function(){return c._processNodes(a,b)});!a.done&&this._idleQueue.process();)a.madeProgress();a.run(function(){return c._prefetchIndex()});b.numIndexLoading+=this._index.getIndexLoading();
b.numNodesLoading+=this._downloadingNodes.size;a.run(function(){return c._lodHandling.lodGlobalHandling(a)});this._evaluateUpdating()}};c.prototype._processIndex=function(b){this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(a.keysOfMap(this._loadingNodeRevisions),b),!this.disableMemCache&&this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData&&(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,
this._index.updates.missing.length)),b=this._index.getFeatureEstimate().leafsReached,this._index.isLoading()||b===this._get("leafsReached")||this._set("leafsReached",b));return this._index.load()};c.prototype._prefetchIndex=function(){return 0<this._loadingNodeRevisions.size||0<this._index.updates.add.length?!1:this._index.prefetch()};c.prototype._updateFeatureLOD=function(){if(this.isGraphics3D){var a=!this._index.isLoading(),b=this.featureTarget*this.baseLOD,c=this._index.getFeatureEstimate();c.estimate=
c.estimate||b/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(a&&c.estimate<b){if(c.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(b/c.estimate,1.001));a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(c.estimate>1.2*b||a&&c.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=
1+.25*(c.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};c.prototype._processCache=function(a){for(;0<this._newLoadingNodes.length&&!a.done;)for(var b=this._newLoadingNodes.pop(),b=this._index.getParent(b);b&&!this.layerView.isNodeLoaded(b.index)&&this._isNodeInScaleBounds(b);b=this._index.getParent(b.index))if(this._enableFromGPUCache(b,"hole")){a.madeProgress();
break}return a.hasProgressed};c.prototype._processNodes=function(a,b){var c=(this._isIdle?100:2)-this._loadingNodeRevisions.size,d=this._index.updates;d.cancel.forEach(this._cancelNode,this);for(d.cancel=[];0<d.update.length&&!a.done;){var e=this._index.getNode(d.update.pop());this._updateLoadedNode(e);a.madeProgress()}for(;0<d.add.length&&!a.done&&0<c;){--c;e=this._index.getNode(d.add.back());if(2!==e.cacheState&&!this._hasNodeLoadToken(b))break;d.add.pop();this._loadNode(e);a.madeProgress()}return a.hasProgressed};
c.prototype._cancelAllNodes=function(){this._loadingNodeRevisions.clear();this._downloadingNodes.clear();this._updatingNodes.clear();this._abortController.abort();this._abortController=new AbortController};c.prototype._cancelNode=function(a){this._loadingNodeRevisions.delete(a);this._downloadingNodes.delete(a)};c.prototype._hasNodeLoadToken=function(a){return!this._isIdle&&2<=a.numNodesLoading+this._loadingNodeRevisions.size?!1:!this.streamDataController.busy};c.prototype._evaluateUpdating=function(){var a=
!1,b=0;this.layerView.suspended?b=(a=this._cameraDirty)?.5:1:(b=(this._index?this._index.getIndexMissing():0)+3*(this._index?this._index.updates.add.length:0)+2*this._loadingNodeRevisions.size,a=!!(0<b||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===b&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(b,this._progressMaxNumNodes),b=1-b/this._progressMaxNumNodes);a!==
this.updating&&this._set("updating",a);b!==this.updatingProgress&&this._set("updatingProgress",b)};c.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var a=this.layerView.view,b=a.state.camera;this.camPos=t.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/(b.perScreenPixelRatio/2);this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.setPointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=O.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};c.prototype._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};Object.defineProperty(c.prototype,"lod",{get:function(){return this._featureLOD*
this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"baseLOD",{get:function(){var a=this.layerView.lodFactor,b=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<a?a:1)*b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodDropFactor",{get:function(){if(this.fixedFeatureTarget)return 1;var a=this.layerView.view.resourceController.memoryController;return(Math.min(a.memoryFactor,.5)-a.minQuality)/(.5-
a.minQuality)},enumerable:!0,configurable:!0});c.prototype.isGeometryVisible=function(a){return this._index.isGeometryVisible(a.index)};c.prototype.updateVisibility=function(a){return this._index.invalidateVisibilityCache(a)};c.prototype._shouldLoadNode=function(a){return this._lodHandling.shouldLoadNode(a)&&!this._shouldDropNode(a)&&this._isNodeInScaleBounds(a)?a.obb?this._index.isGeometryVisible(a.index):!0:!1};c.prototype._shouldDropNode=function(a){var b=this.lodDropFactor;return 1<=b||!this._lodHandling.childrenEmpty(a)?
!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(a))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*b};c.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataController){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var b=C.TextureFormat.Normal;this.layerView.useCompressedTextures?
b=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(b=C.TextureFormat.Downsampled);this._nodeLoader=new C(this.layer,this.streamDataController,S,this._defaultGeometrySchema,this._requiredAttributes,{textureFormat:b,textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:!this.isMeshPyramid});this._index.requestUpdate();this._lodHandling.startNodeLoading(function(b){return a._index.isNodeVisible(b)},function(b){return a._index.isGeometryVisible(b)},function(b){return a._isNodeInScaleBounds(b)},
function(b){return a._index.nodeTraversalState(b)},function(b,c){return a._removeNodes(b,c)},this._index,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}};c.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};c.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this.streamDataController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};c.prototype._removeInvisibleNodes=
function(a){var b=this;R.clear();this.layerView.getLoadedNodeIndices(R);var c=0===this._viewportQueries.maxDistance,d=c?function(){return!1}:function(a){return b._shouldDropNode(a)};R.filterInPlace(function(a){var c=b._index.getNode(a);return!b._index.isGeometryVisible(a)||d(c)||!b._isNodeInScaleBounds(c)});0<R.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(R,a);if(c&&1>this.lodDropFactor)return!1;if(0===R.length)return!0;R.clear();return!1};c.prototype._removeNodes=function(a,b){0<
a.length&&this._index.requestUpdate();var c=a.length;this.layerView.removeNodeData(a,b);if(0<this._loadedNodeScales.size)for(b=a.length;b<c;b++)this._loadedNodeScales.delete(a.data[b])};c.prototype._needsUpdate=function(a){if(!a.resources.hasFeatureData||this._updatingNodes.has(a.index))return!1;a=this.layerView.getLoadedAttributes(a.index);return null!=a&&a!==this._requiredAttributes};c.prototype._updateLoadedNode=function(a){var b=this,c=this.layerView.getLoadedAttributes(a.index),c=H(c,this._requiredAttributes)?
g.resolve(this.layerView.getAttributeData(a.index)):this._nodeLoader.loadAttributes(a,this._requiredAttributes,this._abortController.signal);this._updatingNodes.add(a.index);c.then(function(c){return b.schedule(a.index).then(function(){return b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:c})})}).catch(function(c){g.isAbortError(c)||b.layerView.setAttributeData(a.index,{loadedAttributes:b._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.index);
b._evaluateUpdating()});this._evaluateUpdating()};c.prototype._loadNode=function(a){var b=this,c=this._nextLoadingNodeRevision++;this._loadingNodeRevisions.set(a.index,c);this._evaluateUpdating();this._loadAndAddNode(a).catch(function(a){return a}).then(function(){b._loadingNodeRevisions.get(a.index)===c&&b._loadingNodeRevisions.delete(a.index);b._evaluateUpdating()})};c.prototype._loadAndAddNode=function(a){var b=this;return 1===a.cacheState?this._loadUncached(a):this._loadCached(a).then(function(c){c||
(a.cacheState=1,b._index.updates.add.push(a.index))}).catch(function(b){g.isAbortError(b)||(a.cacheState=1)})};c.prototype._enableFromGPUCache=function(a,b){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var c=this._loadCachedGPUData(a);if(!c)return!1;this.layerView.addCachedGPUData(a,c,b);this._nodeAdded();return!0};c.prototype._loadCachedGPUData=function(a){return(a=this.layerView.loadCachedGPUData(a))&&P(a.attributeInfo)&&H(a.attributeInfo.loadedAttributes,
this._requiredAttributes)?a:null};c.prototype._nodeAdded=function(){this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};c.prototype._loadCached=function(a){var b=this;if(this._enableFromGPUCache(a,"leaf"))return g.resolve(!0);var c=this.layerView;return!this.disableIDBCache&&c.loadCachedNodeData&&c.addCachedNodeData?this.schedule(a.index).then(function(){return c.loadCachedNodeData(a,b._abortController.signal,function(c,d){return b._nodeLoader.loadTextures(a,
c,d)})}).then(function(d){if(null==d)return!1;var e=b._requiredAttributes;return P(d)&&H(d.loadedAttributes,e)?b.reschedule(a.index).then(function(){return c.addCachedNodeData(a,d,d)}).then(function(){b._nodeAdded();return!0}):b.reschedule(a.index).then(function(){return b._nodeLoader.loadAttributes(a,e,b._abortController.signal)}).then(function(c){return b.reschedule(a.index,{loadedAttributes:e,attributeData:c})}).then(function(b){return c.addCachedNodeData(a,d,b)}).then(function(){b._nodeAdded();
return!0})}):g.resolve(!1)};c.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.index);return this._nodeLoader.loadNodeData(a,this._abortController.signal).then(function(c){b._downloadingNodes.delete(a.index);return b.schedule(a.index,c)}).then(function(c){return b.layerView.addNodeData(a,c)}).then(function(){b._nodeAdded();a.cacheState=2}).catch(function(c){g.isAbortError(c)||(S.error("Failed to load node '"+a.id+"': "+c),a.failed=!0,b._index.requestUpdate())})};c.prototype._updateIdleState=
function(a){a!==this._isIdle&&(this._isIdle=a,this._evaluateUpdating(),a&&this._index&&this._index.resetFailedNodes())};c.prototype._getScale=function(a){if(this._loadedNodeScales.has(a.index))return this._loadedNodeScales.get(a.index);var b=a.mbs;this._tmpPoint.x=b[0];this._tmpPoint.y=b[1];this._tmpPoint.z=b[2];b=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(a.index)&&this._loadedNodeScales.set(a.index,b);return b};c.prototype._isNodeInScaleBounds=function(a){if(!this.areScaleBoundsActive)return!0;
a=this._getScale(a);var b=K.extractSafeScaleBounds(this.layer);return K.scaleBoundsPredicate(a,b.minScale,b.maxScale)};c.prototype.updateStats=function(a){a.index=this._index?this._index.size:0;this.isGraphics3D&&(a.detail=this._featureLOD,a.target=this.featureTarget*this.baseLOD);this._index&&this._index.updateStats(a)};Object.defineProperty(c.prototype,"test",{get:function(){var a=this;return{set disableIDBCache(b){a.disableIDBCache=b},set ignoreServiceOBB(b){a._index.ignoreServiceOBB=b}}},enumerable:!0,
configurable:!0});f([p.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);f([p.property({readOnly:!0})],c.prototype,"isGraphics3D",null);f([p.property({readOnly:!0})],c.prototype,"streamDataController",null);f([p.property({readOnly:!0})],c.prototype,"crsVertex",null);f([p.property({readOnly:!0})],c.prototype,"crsIndex",null);f([p.property()],c.prototype,"camPos",void 0);f([p.property()],c.prototype,"screenSizeFactor",void 0);f([p.property()],c.prototype,"featureTarget",void 0);f([p.property()],
c.prototype,"fixedFeatureTarget",void 0);f([p.property()],c.prototype,"layerView",void 0);f([p.property()],c.prototype,"layer",void 0);f([p.property({readOnly:!0})],c.prototype,"updating",void 0);f([p.property({readOnly:!0})],c.prototype,"updatingProgress",void 0);f([p.property({readOnly:!0})],c.prototype,"leafsReached",void 0);f([p.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",void 0);f([p.property({readOnly:!0})],c.prototype,"rootNodeVisible",null);f([p.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],
c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=f([p.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c)}(p.declared(c.EsriPromiseMixin(h)));var R=new n({deallocator:null}),O={factorIM:.2,factor3dObject:.05,distancePenalty:10},Q=v.create();return q})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["require","exports","../../../../core/arrayUtils","../../../support/index"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});var h=
function(){function a(a){var b=this;this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=a.registerTask(f.Task.I3S_CONTROLLER,function(a){return b.update(a)},function(){return b.needsUpdate()})}a.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};a.prototype.needsUpdate=function(){for(var a=0,b=this.callbacks;a<b.length;a++)if(b[a].needsUpdate())return!0;return!1};a.prototype.update=function(a){this.sort();for(var b=this.callbacks,d={numIndexLoading:0,
numNodesLoading:0},c=0;c<b.length&&!a.done;++c)b[c].priority=b[c].update(a,d),this.runIndex=c};a.prototype.sort=function(){for(var a=this.callbacks,b=a.length,e=this.runIndex;0<e;e--){for(var c=a[e-1],f=e;f<a.length&&c.priority<=a[f].priority&&(f!==b||c.priority<a[f].priority);)a[f-1]=a[f],f++;a[f-1]=c;b=f-1}this.runIndex=0};a.prototype.add=function(a){this.sort();a.priority=Infinity;this.callbacks.unshift(a)};a.prototype.remove=function(a){l.removeUnordered(this.callbacks,a);this.runIndex=this.callbacks.length;
this.sort()};return a}(),a=new Map;b.addTask=function(b,d){var e=a.get(b);null==e&&(e=new h(b),a.set(b,e));e.add(d);return{remove:function(){null!=e&&(e.remove(d),0<e.callbacks.length||(a.delete(b),e.destroy()),e=null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4f64 ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(q,b,l,f,h,a,e,d,k,n){function c(a){a.node?(a.node.renderMbs[3]=-1,a.node.renderObb.halfSize[0]=-1):a.ref&&(a.ref.renderMbs[3]=-1,a.ref.renderObb.halfSize[0]=-1)}function g(a,b){return 0===b?0:a/b|0}function r(a,b){return 0===b?a:a%b}function p(a){if(a)for(var b=0;b<a.length;b++)for(var c=0,d=v;c<d.length;c++){var e=d[c];if(e[0]===a[b].metricType)return{lodMetric:e[1],maxError:a[b].maxError}}return{lodMetric:0,maxError:0}}function u(a){return Math.sqrt(4/Math.PI*a)}Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(a,b,c,d,e,f,g,l,m){this.streamDataController=b;this.viewportQueries=c;this.logger=d;this._isLoaded=e;this._isSelected=f;this._enable=g;this._needsUpdate=l;this._canRequest=m;this._dirty=!0;this.nodePages=[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=function(a){return a};this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;
this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._visibilityCacheGeneration=k.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new h({deallocator:null});this._prefetch=new h({deallocator:null});this._updates=new x;this.ignoreServiceOBB=!1;this.progressiveLoadPenalty=0;this.layerUrl=a.parsedUrl.path;this.rootId=a.rootNode&&a.rootNode.split("/").pop();a.serviceUpdateTimeStamp&&
a.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=""+a.serviceUpdateTimeStamp.lastUpdate);this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;a.nodePages?this.initNodePages(a.nodePages):this.initNodeDocuments(this.rootId)}b.prototype.initNodePages=function(a){this.nodesPerPage=a.nodesPerPage;this.rootIndex=a.rootIndex;switch(a.lodSelectionMetricType){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=u}};b.prototype.initNodeDocuments=
function(a){this.rootIndex=this.nodesPerPage=0;this.nodePages.push({nodes:[],children:[],parents:[]});this.makeRefNode({id:a,mbs:null},-1)};b.prototype.loadPage=function(b){var c=this;this._loading.add(b);return this.streamDataController.request(this.layerUrl+"/nodepages/"+b,"json").then(function(a){c._loading.delete(b);c.addPage(b,a)}).catch(function(d){c._loading.delete(b);if(a.isAbortError(d))throw d;c._failedPages.add(b);0===c.nodePages.length&&c.initNodeDocuments(c.rootId);throw d;})};b.prototype.addPage=
function(a,b){for(var c=this,f=this.nodePages.length;f<a;f++)this.nodePages[f]=null;var g=[],h=[];b=b.nodes.map(function(b,f){var l=g.length,m=b.children?b.children.length:0;h.push(-1);for(var p=0;p<m;p++)g.push(b.children[p]);var p=""+b.index,q=n.clone(b.obb),r=d.vec4f64.fromArray([q.center[0],q.center[1],q.center[2],e.vec3.length(q.halfSize)]),t=b.mesh&&b.mesh.attribute,w=b.mesh&&b.mesh.geometry,u=b.mesh&&b.mesh.material;b={id:p,index:a*c.nodesPerPage+f,childCount:m,failed:!1,cacheState:0,obb:q,
mbs:r,level:0,resources:{hasSharedResource:!1,hasFeatureData:!!w,attributes:t&&null!=t.resource?""+t.resource:null,geometry:w&&null!=w.resource?""+w.resource:null,texture:u&&null!=u.resource?""+u.resource:null,geometryDefinition:w?w.definition:-1,materialDefinition:u?u.definition:-1},lodMetric:c.lodMetric,maxError:c.lodConversion(b.lodThreshold),renderMbs:d.vec4f64.fromArray([0,0,0,-1]),renderObb:n.create([0,0,0],[-1,-1,-1],[0,0,0,1]),numFeatures:w?w.featureCount:null,vertexCount:w?w.vertexCount:
null,version:c.lastUpdate};return{childOffset:l,childCount:m,visibilityCache:k.addWraparound(c._visibilityCacheGeneration,-2),ref:null,node:b}});this.nodePages[a]={nodes:b,children:g,parents:h};this.nodeCount+=b.length;this.updateParentsAndLevel()};b.prototype.updateParentsAndLevel=function(){var a=this,b=[],c=function(c,d,e){var g=a.getPage(c);if(f.isSome(g)){var h=r(c,a.nodesPerPage);g.parents[h]=d;if(d=g.nodes[h].node)d.level=e,b.push(c)}};for(c(this.rootIndex,-1,0);b.length;)for(var d=b.pop(),
e=this.getNode(d),g=0;g<e.childCount;g++){var h=this.getChildIndex(e,g);c(h,d,e.level+1)}};b.prototype.getPage=function(a){return this.nodePages[g(a,this.nodesPerPage)]};b.prototype.getNodeInternal=function(a){var b=this.getPage(a);return f.isNone(b)?null:b.nodes[r(a,this.nodesPerPage)]};b.prototype.addNode=function(a,b){null!=a.children&&this.populateChildren(b,a.children);var c=this.getParent(b),c=c?c.level+1:1;this._maxLevel=Math.max(this._maxLevel,c);var e=p(a.lodSelection),g=e.lodMetric,e=e.maxError,
h=f.expect(this.getNodeInternal(b));h.node={id:a.id,index:b,mbs:d.vec4f64.fromArray(a.mbs),obb:a.obb&&n.clone(a.obb),childCount:h.childCount,level:c,resources:a.resources,version:a.version,lodMetric:g,maxError:e,memory:null,numFeatures:a.numFeatures,failed:!1,cacheState:0};null==h.ref.mbs&&(h.ref.mbs=a.mbs);h.node.renderMbs=h.ref.renderMbs;h.node.renderObb=h.ref.renderObb;return h.node};b.prototype.makeRefNode=function(a,b){var c=this.nodePages[0],e=c.nodes.length;c.nodes.push({childOffset:0,childCount:0,
node:null,ref:a,visibilityCache:k.addWraparound(this._visibilityCacheGeneration,-2)});this.nodeCount++;c.parents.push(b);a.renderMbs=d.vec4f64.fromArray([0,0,0,-1]);a.renderObb=n.create([0,0,0],[-1,-1,-1],[0,0,0,1]);return e};b.prototype.populateChildren=function(a,b){var c=f.expect(this.getNodeInternal(a)),d=f.expect(this.getPage(a));c.childOffset=d.children.length;c.childCount=b.length;for(c=0;c<b.length;c++){var e=this.makeRefNode(b[c],a);d.children.push(e)}};b.prototype.getNode=function(a){a=
this.getNodeInternal(a);return f.isSome(a)&&a.node};b.prototype.getIndexById=function(a){var b;this.forAllNodes(function(c,d){(c.node?c.node.id:c.ref.id)===a&&(b=d)});return b};b.prototype.getNodeById=function(a){a=this.getIndexById(a);a=null!=a?this.getNodeInternal(a):null;return f.isSome(a)?a.node:null};b.prototype.getChildIndex=function(a,b){var c=this.getPage(a.index);if(f.isNone(c))return-1;a=c.nodes[r(a.index,this.nodesPerPage)];return c.children[a.childOffset+b]};b.prototype.getParentIndex=
function(a){var b=this.getPage(a);return f.isSome(b)?b.parents[r(a,this.nodesPerPage)]:-1};b.prototype.getParent=function(a){a=this.getParentIndex(a);return 0<=a?this.getNode(a):null};Object.defineProperty(b.prototype,"rootNode",{get:function(){var a=this.getNodeInternal(this.rootIndex);return f.isSome(a)?a.node:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this.nodeCount},enumerable:!0,configurable:!0});b.prototype.invalidateVisibilityCache=
function(a){null!=a?(a=this.getNodeInternal(a),f.isSome(a)&&(a.visibilityCache=k.addWraparound(this._visibilityCacheGeneration,-2))):this._visibilityCacheGeneration=k.addWraparound(this._visibilityCacheGeneration,2)};b.prototype.isNodeVisible=function(a){a=this.getNodeInternal(a);if(f.isNone(a)||a.ref&&!a.ref.mbs)return!0;if((a.visibilityCache&-2)!==this._visibilityCacheGeneration){var b=this.viewportQueries.isNodeVisible(a.ref||a.node);a.visibilityCache=this._visibilityCacheGeneration+(b?1:0);return b}return 1===
(a.visibilityCache&1)};b.prototype.isGeometryVisible=function(a){if(!this.isNodeVisible(a))return!1;a=this.getNodeInternal(a);return f.isNone(a)?!0:a.node&&a.ref&&!a.ref.obb?this.viewportQueries.isGeometryVisible(a.node):!0};Object.defineProperty(b.prototype,"maxLevel",{get:function(){return this._maxLevel},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dirty",{get:function(){return this._dirty},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._updates.add.prune();
this._updates.update.prune()};b.prototype.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;++this._version};b.prototype.update=function(a,b){var c=this;if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a,this._missing);t.clear();var d=!0,e=new y,h=new y;this.traverseVisible(function(k,l){if(l){var m=l.node;c._updateNodeFeatureEstimate(m,h);if(m){var n=f.expect(c.getPage(k));if(0===c._missing.length&&
0===c.nodesPerPage)for(var p=0;p<l.childCount;p++){var q=n.children[l.childOffset+p],r=c.getNodeInternal(q);!f.isSome(r)||r.node||c._loading.has(q)||c._failedNodes.has(q)||(t.set(q,c.entryPriority(q)),c._prefetch.push(q))}!m.failed&&m.resources.hasFeatureData&&(c._isLoaded(k)?(e.known+=m.memory,++e.knownNodes,c._isSelected(m)?0<l.childCount&&(d=!1):(e.unremoved+=m.memory,d=!1),c._needsUpdate(m)&&(l=c.entryPriority(k),t.set(k,l),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,l),c._updates.update.push(k))):
(m.memory&&(e.known+=m.memory,++e.knownNodes),c._isSelected(m)&&(0<l.childCount&&(d=!1),m.memory?(e.missing+=m.memory,e.known+=m.memory,++e.knownNodes):++e.missingNodes,0<=a.indexOf(m.index)?(c._maxProcessingPrio=Math.max(c._maxProcessingPrio,c.entryPriority(k)),c._updates.cancel=c._updates.cancel.filter(function(a){return a!==m.index})):!b.done&&c._enable(m)?b.madeProgress():(l=c.entryPriority(k),t.set(k,l),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,l),c._updates.add.push(k)))))}else l=c.entryPriority(k),
c._loading.has(k)||c._failedNodes.has(k)||(c._missing.push(k),t.set(k,l)),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,l)}else l=c.entryPriority(k),k=g(k,c.nodesPerPage),t.set(k,Math.max(l,t.get(k)||0)),c._loading.has(k)||c._failedPages.has(k)||c._missing.push(k),c._maxProcessingPrio=Math.max(c._maxProcessingPrio,l)});this._unloadedMemoryEstimate=e.missing-e.unremoved;3<e.knownNodes&&0<e.missingNodes&&(this._unloadedMemoryEstimate+=e.known/e.knownNodes*e.missingNodes);this._unloadedMemoryEstimate=
.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(h);this._featureEstimate.leafsReached=d;this._missing.sort(function(a,b){return a-b});this._missing.filterInPlace(function(a,b){return 1>b||c._missing.data[b-1]!==a});this._missing.sort(function(a,b){return t.get(a)-t.get(b)});0<this._missing.length?(this._maxUnloadedPrio=t.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort(function(a,b){return t.get(a)-t.get(b)});this._updates.add.filterInPlace(function(a){return t.get(a)>=
c._maxUnloadedPrio}).sort(function(a,b){return t.get(a)-t.get(b)});this._updates.update.sort(function(a,b){return t.get(a)-t.get(b)});this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;t.clear()}};b.prototype.checkFeatureTarget=function(a,b){for(var c=this.viewportQueries.updateScreenSpaceErrorBias(b),d=b,e=b,f=c,g=10;g--;){var h=new y;this._updateFeatureEstimate(d,h);if(this._computeFeatureEstimate(h)<=a){if(d>=b||0<h.missingNodes||0===g)break;f=d;d=.5*(d+
e)}else e=d,d=.5*(d+f)}++this._version;this.viewportQueries.updateScreenSpaceErrorBias(c);return Math.min(b,d)};b.prototype._updateFeatureEstimate=function(a,b){var c=this;++this._version;this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d&&d.node,b)})};b.prototype._updateNodeFeatureEstimate=function(a,b){a&&!a.failed&&null!=a.numFeatures&&(this._isLoaded(a.index)?(b.known+=a.numFeatures,++b.knownNodes,this._isSelected(a)||(b.unremoved+=
a.numFeatures)):this._isSelected(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):++b.missingNodes))};b.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};b.prototype.load=function(){return this._load(this._missing)};b.prototype.prefetch=function(){return this._load(this._prefetch)};b.prototype._load=function(a){if(0===a.length||!this._canRequest())return!1;
for(;0<a.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(a.pop()):this.loadPage(a.pop());return!0};b.prototype.isLoading=function(){return 0<this._indexMissing};b.prototype.getIndexLoading=function(){return this._loading.size};b.prototype.getIndexMissing=function(){return this._indexMissing};b.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};Object.defineProperty(b.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0});
b.prototype.getFeatureEstimate=function(){return this._featureEstimate};b.prototype.nodeTraversalState=function(a){if(!a)return null;var b=this._nodeTraversalState[a.index];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;d?(e=this.getParentIndex(a.index),e=0<=e?(e=this._nodeTraversalState[e])&&c>e.lodLevel:0<c):e=0===a.childCount;if(b)return b.lodLevel=c,b.isChosen=e,b.version=this._version,b;this._nodeTraversalState[a.index]=
{nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.index]};b.prototype._loadNode=function(b){var c=this;this._loading.add(b);var d=f.expect(this.getNodeInternal(b)).ref.id,e=this.layerUrl+"/nodes/"+d,g=function(){c._loading.delete(b);0===c._missing.length&&0===c._loading.size&&c.requestUpdate()};this.streamDataController.request(e,"json").then(function(a){a=c._validateNode(d,a);null!=a&&(a.obb&&c.invalidateVisibilityCache(b),a=c.addNode(a,b),c.nodeTraversalState(a));
g()},function(d){a.isAbortError(d)||(c.logger.error("Error loading node: "+e),c._failedNodes.add(b));g()})};b.prototype._validateNode=function(a,b){var c=this;if(null==b||"object"!==typeof b||b.id!==a)return this.logger.error('Invalid node. Wrong type or wrong id "'+a+'"'),null;b.sharedResource&&"./shared"!==b.sharedResource.href&&"./shared/"!==b.sharedResource.href&&this.logger.warn('Invalid shared resource href on node "'+a+'"');null==b.geometryData||Array.isArray(b.geometryData)&&1===b.geometryData.length&&
"./geometries/0"===b.geometryData[0].href||this.logger.warn('Invalid geometry data on node "'+a+'"');null==b.attributeData||Array.isArray(b.attributeData)&&!b.attributeData.some(function(a,b){return a.href!=="./attributes/f_"+b+"/0"})||this.logger.warn('Invalid attribute data on node "'+a+'"');b.featureData&&1<b.featureData.length&&this.logger.warn("Node "+a+" has "+b.featureData.length+" bundles. Only the first bundle will be loaded.");var d=b.hasOwnProperty("obb")&&!this.ignoreServiceOBB?b.obb:
null,e=b.featureData&&1===b.featureData.length&&b.featureData[0].featureRange?b.featureData[0].featureRange[1]-b.featureData[0].featureRange[0]+1:null,f=function(b){if(null==b)return null;var d=function(b){return c.logger.error("Invalid node reference on node "+a+": "+b)};if("number"===typeof b.id)d("id "+b.id+" is a number instead of a string.");else if("string"!==typeof b.id||!Array.isArray(b.mbs))return d("Missing or invalid id."),null;if(!Array.isArray(b.mbs))return d("Invalid bounding volume on reference "+
b.id+"."),null;b.href&&b.href!=="../"+b.id&&c.logger.error('Invalid node href on node "'+a+'"');d=b.hasOwnProperty("obb")&&!c.ignoreServiceOBB?b.obb:null;return{id:""+b.id,mbs:b.mbs,obb:d}},f=Array.isArray(b.children)?b.children.map(f).filter(function(a){return null!=a}):null;return{id:a,mbs:b.mbs,obb:d,children:f,resources:{hasFeatureData:b.featureData&&0<b.featureData.length,hasSharedResource:null!=b.sharedResource,attributes:b.attributeData?a:null,texture:b.textureData&&0<b.textureData.length?
a:null,geometry:null!=b.geometryData?a:null},version:"string"===typeof b.version?b.version:null,lodSelection:Array.isArray(b.lodSelection)?b.lodSelection:null,numFeatures:e}};b.prototype.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(function(a){a.node&&(a.node.failed=!1)})};b.prototype.entryPriority=function(a){var b=this.getNodeInternal(a),c=this.getParentIndex(a);if(f.isNone(b)||0>c&&null==b.node)return 0>c?Infinity:this.entryPriority(c);var d=
0;b.node&&0<=c&&(c=this._nodeTraversalState[c],null!=c&&(d=c.lodLevel));for(c=this.progressiveLoadPenalty;0<=a;a=this.getParentIndex(a))if(this._isLoaded(a)){c=0;break}b=this.viewportQueries.distToPOI(b.ref||b.node);return-b-d*(b+this.progressiveLoadPenalty)+c};b.prototype.traverseVisible=function(a){var b=this.getNodeInternal(this.rootIndex);f.isSome(b)?this._traverse(this.rootIndex,b,a):a(this.rootIndex,null)};b.prototype._traverse=function(a,b,c){if(b.node&&0===b.childCount)this.isGeometryVisible(a)&&
c(a,b);else if(this.isNodeVisible(a)&&(c(a,b),null!=b.node)){var d=this.nodeTraversalState(b.node);if(!d.nodeHasLOD||d.lodLevel!==this._maxLodLevel)for(a=f.expect(this.getPage(a)),d=0;d<b.childCount;d++){var e=a.children[b.childOffset+d],g=this.getNodeInternal(e);f.isSome(g)?this._traverse(e,g,c):c(e,null)}}};b.prototype.traverse=function(a,b){b(a)&&this.traverseChildren(a,b)};b.prototype.traverseChildren=function(a,b){a=a.index;var c=this.getNodeInternal(a);f.isSome(c)&&this._traverseChildren(a,
c,b)};b.prototype._traverseChildren=function(a,b,c){a=this.getPage(a);if(!f.isNone(a))for(var d=0;d<b.childCount;++d){var e=a.children[b.childOffset+d],g=this.getNodeInternal(e);f.isSome(g)&&g.node&&c(g.node)&&this._traverseChildren(e,g,c)}};b.prototype.updateStats=function(a){0<this._updates.add.length&&(a.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)a.index+=" + "+this._indexMissing||this._prefetch.length;a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=
this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};b.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};b.prototype.updateElevationInfo=function(a){this.forAllNodes(c);this.viewportQueries.updateElevationInfo(a)};b.prototype.invalidateBoundingVolumeCache=function(a){a=this.getNodeInternal(a);f.isSome(a)&&c(a)};b.prototype.forAllNodes=function(a){for(var b=0;b<this.nodePages.length;b++){var c=this.nodePages[b];
if(c)for(var d=b*this.nodesPerPage,e=0;e<c.nodes.length;e++)a(c.nodes[e],d+e)}};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{addNode:function(b,c){return a.addNode(b,c)}}},enumerable:!0,configurable:!0});return b}();b.I3SIndex=q;var t=new Map,x=function(){function a(){this.update=new h({deallocator:null});this.add=new h({deallocator:null});this.cancel=[]}a.prototype.reset=function(a,b){this.add.clear();this.update.clear();this.cancel=a;this.missing=b};return a}(),v=[["maxScreenThreshold",
1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];b.selectErrorMetric=p;var y=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}()})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(q,b,l){q=function(){function b(a){this.layerView=a;this._lodGlobalDirty=!1}b.prototype.startNodeLoading=function(a,b,d,f,h,c,g){this._maxLodLevel=
g.maxLodLevel;this._index=c;this._nodeTraversalState=f;this._isNodeVisible=a;this._isGeometryVisible=b;this._isNodeInScaleBounds=d;this._removeNodes=h};b.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);return this.isChosenMaxLOD(b)?!0:b.isChosen?this._childrenRequireLoading(a):!1};b.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};Object.defineProperty(b.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._index&&!0===this._lodGlobalDirty},
enumerable:!0,configurable:!0});b.prototype.lodGlobalHandling=function(a){if(!this.requiresLODGlobalHandling)return!1;var b=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));f.clear();this._lodGlobalHandlingRecursion(this._index.rootNode,b);b=f.length;this._removeNodes(f,a);a=f.length<b;0===f.length&&(this._lodGlobalDirty=!1);f.clear();return a};b.prototype._lodGlobalHandlingRecursion=function(a,b){if(null==a)return!1;var d=this._nodeTraversalState(a),
e=this.isChosenMaxLOD(d);(d=this.layerView.isNodeLoaded(a.index))&&null!=this.layerView.updateNodeStatus&&this.layerView.updateNodeStatus(a.index,e?"leaf":"hole");if(e&&d)return this._removeChildrenRecursive(a),!0;var h=!1;if(0<a.childCount)for(var h=!0,c=0;c<a.childCount;c++){var g=this._index.getChildIndex(a,c),l=this._index.getNode(g);l?this._isGeometryVisible(g)&&!this._lodGlobalHandlingRecursion(l,b)&&this._isNodeInScaleBounds(l)&&(h=!1):this._isNodeVisible(g)&&(h=!1)}d&&!e&&(h||f.length<b)&&
(f.push(a.index),d=!1);a=!a.resources.hasFeatureData;return h||d||a};b.prototype._removeChildrenRecursive=function(a){this._index.traverseChildren(a,function(a){f.push(a.index);return!0})};b.prototype.childrenEmpty=function(a){var b=this,d=!0;this._index.traverseChildren(a,function(a){return d&&b._isNodeVisible(a.index)?b.layerView.isNodeLoaded(a.index)?d=!1:!0:!1});return d};b.prototype._childrenRequireLoading=function(a){var b=this,d=!1,f=!0;this._index.traverseChildren(a,function(a){if(!f||!b._isNodeVisible(a.index))return!1;
var c=b._nodeTraversalState(a);b.isChosenMaxLOD(c)&&b._isGeometryVisible(a.index)&&(d=!0);return b.layerView.isNodeLoaded(a.index)?f=!1:!0});return f&&d};b.prototype.isChosenMaxLOD=function(a){return a.isChosen&&(!a.nodeHasLOD||a.lodLevel===this._maxLodLevel)};return b}();var f=new l({deallocator:null});return q})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../libs/draco/DracoDecoder ./I3SBinaryReader ./I3SMaterialUtil ./I3SUtil".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g){q=function(){function b(a,b,d,e,f,g){this.streamDataController=b;this.logger=d;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=g;this.layerUrl=a.parsedUrl.path;this.geometryDefinitions=a.geometryDefinitions;if(a.materialDefinitions){var h=a.textureSetDefinitions;this.materialAndTextures=a.materialDefinitions.map(function(a){return c.getMaterialAndTextures(h,a)})}}b.prototype.load=function(a,b,c){return this.streamDataController.request(a,b,{signal:c})};
b.prototype.loadAttribute=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.attributes+"/attributes/"+b.key+"/0","binary",c).then(function(a){return n.readBinaryAttribute(b,a)})};b.prototype.loadAttributes=function(a,b,c){var d=this;return e.eachAlways(b.map(function(b){return d.loadAttribute(a,b.attributeStorageInfo,c)})).then(function(c){for(var f={},g=0;g<b.length;++g)c[g].value?f[b[g].name]=c[g].value:e.isAbortError(c[g].error)||d.logger.error("Failed to load attributeData for '"+
b[g].name+"' on node '"+a.id+"'");return f})};b.prototype.loadNodeData=function(b,d){return f(this,void 0,void 0,function(){var f,g,p,q,m,r,u,B,C,E,G,J,I,K,H,L,P,S,R,O,Q;return l(this,function(l){switch(l.label){case 0:f=null!=this.requiredAttributes&&b.resources.attributes?this.loadAttributes(b,this.requiredAttributes,d):e.resolve({});var t=this.geometryDefinitions;l={bufferDefinition:null,bufferIndex:0};if(!(null==t||0>b.resources.geometryDefinition)&&(t=0<=b.resources.geometryDefinition?t[b.resources.geometryDefinition].geometryBuffers:
null,null!=t))for(var v=0;v<t.length;v++)if(null!=t[v].compressedAttributes){if("draco"===t[v].compressedAttributes.encoding&&k.isSupported()&&!h("disable-feature:i3s-draco")){l.bufferIndex=v;l.bufferDefinition=t[v];break}}else l.bufferIndex=v,l.bufferDefinition=t[v];g=l;p=g.bufferDefinition;q=g.bufferIndex;m=b.resources.geometry?this.loadGeometry(b,q,d):null;return b.resources.hasSharedResource?[4,this.loadShared(b,d)]:[3,2];case 1:return u=l.sent(),[3,3];case 2:u=null,l.label=3;case 3:return r=
u,C=(B=this.materialAndTextures&&0<=b.resources.materialDefinition?this.materialAndTextures[b.resources.materialDefinition]:null!=r?c.getMaterialAndTexturesFromShared(r):null)&&B.material,E=B&&B.textures,this.options.loadFeatureData?[4,this.loadFeatureData(b,d)]:[3,5];case 4:return J=l.sent(),[3,6];case 5:J=null,l.label=6;case 6:return G=J,I=this.options.loadFeatureData?this.collectGeometries(G):this.meshPyramidGeometryData(C),K=null!=E&&0<E.length?this.loadTextures(b,E,d):null,L=H=null,m?[4,m]:[3,
8];case 7:H=l.sent();t=this.defaultGeometrySchema;v=r;if(t&&v&&v.materialDefinitions){var w=Object.keys(v.materialDefinitions)[0];!v.materialDefinitions[w].params.vertexRegions&&t.vertexAttributes.region&&(t=a.clone(t),delete t.vertexAttributes.region)}P=t;L=(S=!(!p||!p.compressedAttributes||"draco"!==p.compressedAttributes.encoding))?n.createGeometryIndexFromAttributes(p.compressedAttributes.attributes):p?n.createGeometryIndexFromDefinition(p,b.vertexCount,b.numFeatures):n.createGeometryIndexFromSchema(H,
P);l.label=8;case 8:return[4,K];case 9:return R=l.sent(),[4,f];case 10:return Q=(O=l.sent())?{attributeData:O,loadedAttributes:this.requiredAttributes}:null,[2,{allGeometryData:I,attributeDataInfo:Q,geometryBuffer:H,geometryIndex:L,requiredTextures:E,textureData:R}]}})})};b.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,e=Object.keys(a);c<e.length;c++)for(var f=0,g=a[e[c]].images;f<g.length;f++){var h=g[f];Array.isArray(h.href)?h.hrefConcat=h.href.map(function(a){return d.makeAbsolute(a,
b)}):h.hrefConcat=d.makeAbsolute(h.href,b)}};b.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};b.prototype.loadShared=function(a,c){var d=this.layerUrl+"/nodes/"+a.resources.geometry+"/shared";return this.load(d,"json",c).then(function(a){b.fixTextureEncodings(a);
b.addAbsoluteHrefTexture(a,d);return a})};b.prototype.loadTexture=function(a,b,c,d,e,f){return e===g.DDS_ENCODING_STRING?this.load(a,"binary",f).then(function(a){return{id:b,usage:c,data:a,encoding:e}}):this.load(a,"image",f).then(function(a){var f=a;if(d&&4096<=a.width*a.height){var f=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{id:b,usage:c,data:f,encoding:e}})};b.prototype.loadTextures=function(a,
c,d){var f=this,h=this.options.textureFormat===b.TextureFormat.Compressed,k=this.options.textureFormat===b.TextureFormat.Downsampled,l=this.options.textureUsageMask;return e.all(c.map(function(b){if(0===(b.usage&l))return null;var c=g.selectEncoding(b.encodings,h);return null==c?(f.logger.error("No known encoding for texture found on node "+a.id),e.reject()):f.loadTexture(f.layerUrl+"/nodes/"+(a.resources.texture||a.id)+"/textures/"+c.name,b.id,b.usage,k,c.encoding,d)}))};b.prototype.meshPyramidGeometryData=
function(a){return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:a}}],featureDataPosition:[0,0,0]}]};b.prototype.collectGeometries=function(a){var b=[],c=0;for(a=a.featureData;c<a.length;c++){var d=a[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)b.push({featureIds:[d.id],featureDataPosition:d.position,geometries:[e[f]]});else null!=d.position&&b.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return b};b.prototype.loadFeatureData=function(a,
b){return this.load(this.layerUrl+"/nodes/"+a.id+"/features/0","json",b)};b.prototype.loadGeometry=function(a,b,c){return this.load(this.layerUrl+"/nodes/"+a.resources.geometry+"/geometries/"+b,"binary",c)};return b}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(q||(q={}));return q})},"esri/libs/draco/DracoDecoder":function(){define(["require","exports","../../core/has","../../core/promiseUtils","./draco_decoder"],
function(q,b,l,f,h){function a(){return!!l("esri-wasm")}function e(){return q.toUrl("./draco_decoder.wasm")}Object.defineProperty(b,"__esModule",{value:!0});(function(a){for(var c in a)b.hasOwnProperty(c)||(b[c]=a[c])})(h);b.isSupported=a;b.getDecoderModule=function(){if(!a())return f.reject(Error("Draco decompression not available, missing WebAssembly support"));d||(d=f.create(function(a){return q(["./draco_decoder"],function(b){k=b({locateFile:e});a(k)})}).catch(function(a){return f.reject(a)}));
return d};var d,k})},"esri/libs/draco/draco_decoder":function(){var q=function(){var b="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(l){function f(a){return F.locateFile?F.locateFile(a,la):la+a}function h(a,b){a||y("Assertion failed: "+b)}function a(a,b){var c;if(a){c=ya;var d=a+b;for(b=a;c[b]&&!(b>=d);)++b;if(16<b-a&&c.subarray&&pa)c=pa.decode(c.subarray(a,b));else{for(d="";a<b;){var e=c[a++];if(e&128){var f=c[a++]&63;if(192==(e&224))d+=String.fromCharCode((e&
31)<<6|f);else{var g=c[a++]&63,e=224==(e&240)?(e&15)<<12|f<<6|g:(e&7)<<18|f<<12|g<<6|c[a++]&63;65536>e?d+=String.fromCharCode(e):(e-=65536,d+=String.fromCharCode(55296|e>>10,56320|e&1023))}}else d+=String.fromCharCode(e)}c=d}}else c="";return c}function e(a,b){0<a%b&&(a+=b-a%b);return a}function d(){F.HEAP8=na=new Int8Array(ia);F.HEAP16=new Int16Array(ia);F.HEAP32=da=new Int32Array(ia);F.HEAPU8=ya=new Uint8Array(ia);F.HEAPU16=new Uint16Array(ia);F.HEAPU32=new Uint32Array(ia);F.HEAPF32=new Float32Array(ia);
F.HEAPF64=new Float64Array(ia)}function k(a){for(;0<a.length;){var b=a.shift();if("function"==typeof b)b();else{var c=b.func;"number"===typeof c?void 0===b.arg?F.dynCall_v(c):F.dynCall_vi(c,b.arg):c(void 0===b.arg?null:b.arg)}}}function n(a){return String.prototype.startsWith?a.startsWith("data:application/octet-stream;base64,"):0===a.indexOf("data:application/octet-stream;base64,")}function c(){try{if(F.wasmBinary)return new Uint8Array(F.wasmBinary);if(F.readBinary)return F.readBinary(bb);throw"both async and sync fetching of the wasm failed";
}catch(ob){y(ob)}}function g(){return F.wasmBinary||!ka&&!ba||"function"!==typeof fetch?new Promise(function(a,b){a(c())}):fetch(bb,{credentials:"same-origin"}).then(function(a){if(!a.ok)throw"failed to load wasm binary file at '"+bb+"'";return a.arrayBuffer()}).catch(function(){return c()})}function q(a){function b(a,b){F.asm=a.exports;Wa--;F.monitorRunDependencies&&F.monitorRunDependencies(Wa);0==Wa&&(null!==jb&&(clearInterval(jb),jb=null),va&&(a=va,va=null,a()))}function c(a){b(a.instance)}function d(a){g().then(function(a){return WebAssembly.instantiate(a,
e)}).then(a,function(a){sa("failed to asynchronously prepare wasm: "+a);y(a)})}var e={env:a,global:{NaN:NaN,Infinity:Infinity},"global.Math":Math,asm2wasm:xa};Wa++;F.monitorRunDependencies&&F.monitorRunDependencies(Wa);if(F.instantiateWasm)try{return F.instantiateWasm(e,b)}catch(Ed){return sa("Module.instantiateWasm callback failed with error: "+Ed),!1}F.wasmBinary||"function"!==typeof WebAssembly.instantiateStreaming||n(bb)||"function"!==typeof fetch?d(c):WebAssembly.instantiateStreaming(fetch(bb,
{credentials:"same-origin"}),e).then(c,function(a){sa("wasm streaming compile failed: "+a);sa("falling back to ArrayBuffer instantiation");d(c)});return{}}function p(){return!!p.uncaught_exception}function u(){return na.length}function t(a){a=e(a,65536);var b=ia.byteLength;try{return-1!==ra.grow((a-b)/65536)?(ia=ra.buffer,!0):!1}catch(vd){return!1}}function x(a){this.name="ExitStatus";this.message="Program terminated with exit("+a+")";this.status=a}function v(a){function b(){if(!F.calledRun&&(F.calledRun=
!0,!oa)){Ca||(Ca=!0,k(Ma));k(z);if(F.onRuntimeInitialized)F.onRuntimeInitialized();if(F.postRun)for("function"==typeof F.postRun&&(F.postRun=[F.postRun]);F.postRun.length;)tb.unshift(F.postRun.shift());k(tb)}}if(!(0<Wa)){if(F.preRun)for("function"==typeof F.preRun&&(F.preRun=[F.preRun]);F.preRun.length;)Ja.unshift(F.preRun.shift());k(Ja);0<Wa||F.calledRun||(F.setStatus?(F.setStatus("Running..."),setTimeout(function(){setTimeout(function(){F.setStatus("")},1);b()},1)):b())}}function y(a){if(F.onAbort)F.onAbort(a);
void 0!==a?(ua(a),sa(a),a=JSON.stringify(a)):a="";oa=!0;throw"abort("+a+"). Build with -s ASSERTIONS\x3d1 for more info.";}function m(){}function w(a){return(a||m).__cache__}function A(a,b){var c=w(b),d=c[a];if(d)return d;d=Object.create((b||m).prototype);d.ptr=a;return c[a]=d}function B(a){if("string"===typeof a){for(var b=0,c=0;c<a.length;++c){var d=a.charCodeAt(c);55296<=d&&57343>=d&&(d=65536+((d&1023)<<10)|a.charCodeAt(++c)&1023);127>=d?++b:b=2047>=d?b+2:65535>=d?b+3:b+4}b=Array(b+1);c=0;d=b.length;
if(0<d){for(var d=c+d-1,e=0;e<a.length;++e){var f=a.charCodeAt(e);if(55296<=f&&57343>=f)var g=a.charCodeAt(++e),f=65536+((f&1023)<<10)|g&1023;if(127>=f){if(c>=d)break;b[c++]=f}else{if(2047>=f){if(c+1>=d)break;b[c++]=192|f>>6}else{if(65535>=f){if(c+2>=d)break;b[c++]=224|f>>12}else{if(c+3>=d)break;b[c++]=240|f>>18;b[c++]=128|f>>12&63}b[c++]=128|f>>6&63}b[c++]=128|f&63}}b[c]=0}a=Ea.alloc(b,na);Ea.copy(b,na,a)}return a}function C(){throw"cannot construct a Status, no constructor in IDL";}function E(){this.ptr=
$b();w(E)[this.ptr]=this}function G(){this.ptr=bc();w(G)[this.ptr]=this}function J(){this.ptr=zd();w(J)[this.ptr]=this}function I(){this.ptr=ec();w(I)[this.ptr]=this}function K(){this.ptr=kb();w(K)[this.ptr]=this}function H(){this.ptr=Yc();w(H)[this.ptr]=this}function L(){this.ptr=lc();w(L)[this.ptr]=this}function P(){this.ptr=ub();w(P)[this.ptr]=this}function S(){this.ptr=vc();w(S)[this.ptr]=this}function R(){this.ptr=La();w(R)[this.ptr]=this}function O(){this.ptr=Kc();w(O)[this.ptr]=this}function Q(){this.ptr=
dc();w(Q)[this.ptr]=this}function T(){this.ptr=yd();w(T)[this.ptr]=this}function Y(){this.ptr=gb();w(Y)[this.ptr]=this}function N(){this.ptr=Wb();w(N)[this.ptr]=this}function Z(){this.ptr=X();w(Z)[this.ptr]=this}function W(){throw"cannot construct a VoidPtr, no constructor in IDL";}function aa(){this.ptr=kc();w(aa)[this.ptr]=this}function V(){this.ptr=Xc();w(V)[this.ptr]=this}l=l||{};var F="undefined"!==typeof l?l:{},ca=!1,U=!1;F.onRuntimeInitialized=function(){ca=!0;if(U&&"function"===typeof F.onModuleLoaded)F.onModuleLoaded(F)};
F.onModuleParsed=function(){U=!0;if(ca&&"function"===typeof F.onModuleLoaded)F.onModuleLoaded(F)};F.isVersionSupported=function(a){if("string"!==typeof a)return!1;a=a.split(".");return 2>a.length||3<a.length?!1:1==a[0]&&0<=a[1]&&3>=a[1]?!0:0!=a[0]||10<a[1]?!1:!0};var ea={},ha;for(ha in F)F.hasOwnProperty(ha)&&(ea[ha]=F[ha]);F.arguments=[];F.thisProgram="./this.program";F.quit=function(a,b){throw b;};F.preRun=[];F.postRun=[];var ka=!1,ba=!1,qa=!1,ja=!1,ka="object"===typeof window,ba="function"===typeof importScripts,
qa="object"===typeof process&&"function"===typeof require&&!ka&&!ba,ja=!ka&&!qa&&!ba,la="";if(qa){var la=__dirname+"/",ma,ta;F.read=function(a,b){ma||(ma=require("fs"));ta||(ta=require("path"));a=ta.normalize(a);a=ma.readFileSync(a);return b?a:a.toString()};F.readBinary=function(a){a=F.read(a,!0);a.buffer||(a=new Uint8Array(a));h(a.buffer);return a};1<process.argv.length&&(F.thisProgram=process.argv[1].replace(/\\/g,"/"));F.arguments=process.argv.slice(2);process.on("uncaughtException",function(a){if(!(a instanceof
x))throw a;});process.on("unhandledRejection",y);F.quit=function(a){process.exit(a)};F.inspect=function(){return"[Emscripten Module object]"}}else if(ja)"undefined"!=typeof read&&(F.read=function(a){return read(a)}),F.readBinary=function(a){if("function"===typeof readbuffer)return new Uint8Array(readbuffer(a));a=read(a,"binary");h("object"===typeof a);return a},"undefined"!=typeof scriptArgs?F.arguments=scriptArgs:"undefined"!=typeof arguments&&(F.arguments=arguments),"function"===typeof quit&&(F.quit=
function(a){quit(a)});else if(ka||ba)ba?la=self.location.href:document.currentScript&&(la=document.currentScript.src),b&&(la=b),la=0!==la.indexOf("blob:")?la.substr(0,la.lastIndexOf("/")+1):"",F.read=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send(null);return b.responseText},ba&&(F.readBinary=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.responseType="arraybuffer";b.send(null);return new Uint8Array(b.response)}),F.readAsync=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",
a,!0);d.responseType="arraybuffer";d.onload=function(){200==d.status||0==d.status&&d.response?b(d.response):c()};d.onerror=c;d.send(null)},F.setWindowTitle=function(a){document.title=a};var ua=F.print||("undefined"!==typeof console?console.log.bind(console):"undefined"!==typeof print?print:null),sa=F.printErr||("undefined"!==typeof printErr?printErr:"undefined"!==typeof console&&console.warn.bind(console)||ua);for(ha in ea)ea.hasOwnProperty(ha)&&(F[ha]=ea[ha]);var ea=void 0,xa={"f64-rem":function(a,
b){return a%b},"debugger":function(){debugger}};"object"!==typeof WebAssembly&&sa("no native wasm support detected");var ra,oa=!1,pa="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var ia,na,ya,da,Oa=F.TOTAL_MEMORY||16777216;5242880>Oa&&sa("TOTAL_MEMORY should be larger than TOTAL_STACK, was "+Oa+"! (TOTAL_STACK\x3d5242880)");F.buffer?ia=F.buffer:"object"===typeof WebAssembly&&"function"===typeof WebAssembly.Memory?(ra=
new WebAssembly.Memory({initial:Oa/65536}),ia=ra.buffer):ia=new ArrayBuffer(Oa);d();da[4088]=5259264;var Ja=[],Ma=[],z=[],tb=[],Ca=!1,Wa=0,jb=null,va=null;F.preloadedImages={};F.preloadedAudios={};var bb="draco_decoder.wasm";n(bb)||(bb=f(bb));F.asm=function(a,b,c){b.memory=ra;b.table=new WebAssembly.Table({initial:490,maximum:490,element:"anyfunc"});b.__memory_base=1024;b.__table_base=0;return q(b)};var Na={last:0,caught:[],infos:{},deAdjust:function(a){if(!a||Na.infos[a])return a;for(var b in Na.infos)for(var c=
+b,d=Na.infos[c].adjusted,e=d.length,f=0;f<e;f++)if(d[f]===a)return c;return a},addRef:function(a){a&&Na.infos[a].refcount++},decRef:function(a){if(a){var b=Na.infos[a];h(0<b.refcount);b.refcount--;if(0===b.refcount&&!b.rethrown){b.destructor&&F.dynCall_vi(b.destructor,a);delete Na.infos[a];try{Dd(a)}catch(vd){}}}},clearRef:function(a){a&&(Na.infos[a].refcount=0)}},lb=F.asm({},{e:y,d:function(a){return ud(a)},k:function(){oa=!0;throw"Pure virtual function called!";},c:function(a,b,c){Na.infos[a]=
{ptr:a,adjusted:[a],type:b,destructor:c,refcount:0,caught:!1,rethrown:!1};Na.last=a;"uncaught_exception"in p?p.uncaught_exception++:p.uncaught_exception=1;throw a;},f:function(a){F.___errno_location&&(da[F.___errno_location()>>2]=a);return a},b:function(){F.abort()},j:u,i:function(a,b,c){ya.set(ya.subarray(b,b+c),a)},h:function(a){var b=u();if(2147418112<a)return!1;for(b=Math.max(b,16777216);b<a;)b=536870912>=b?e(2*b,65536):Math.min(e((3*b+2147483648)/4,65536),2147418112);if(!t(b))return!1;d();return!0},
g:function(){y("trap!")},l:function(a){y("OOM")},a:16352},ia);F.asm=lb;var kb=F._emscripten_bind_AttributeOctahedronTransform_AttributeOctahedronTransform_0=function(){return F.asm.m.apply(null,arguments)},Xa=F._emscripten_bind_AttributeOctahedronTransform_InitFromAttribute_1=function(){return F.asm.n.apply(null,arguments)},Sa=F._emscripten_bind_AttributeOctahedronTransform___destroy___0=function(){return F.asm.o.apply(null,arguments)},Va=F._emscripten_bind_AttributeOctahedronTransform_quantization_bits_0=
function(){return F.asm.p.apply(null,arguments)},ub=F._emscripten_bind_AttributeQuantizationTransform_AttributeQuantizationTransform_0=function(){return F.asm.q.apply(null,arguments)},sb=F._emscripten_bind_AttributeQuantizationTransform_InitFromAttribute_1=function(){return F.asm.r.apply(null,arguments)},Rb=F._emscripten_bind_AttributeQuantizationTransform___destroy___0=function(){return F.asm.s.apply(null,arguments)},Gb=F._emscripten_bind_AttributeQuantizationTransform_min_value_1=function(){return F.asm.t.apply(null,
arguments)},Ab=F._emscripten_bind_AttributeQuantizationTransform_quantization_bits_0=function(){return F.asm.u.apply(null,arguments)},Da=F._emscripten_bind_AttributeQuantizationTransform_range_0=function(){return F.asm.v.apply(null,arguments)},lc=F._emscripten_bind_AttributeTransformData_AttributeTransformData_0=function(){return F.asm.w.apply(null,arguments)},Ba=F._emscripten_bind_AttributeTransformData___destroy___0=function(){return F.asm.x.apply(null,arguments)},Ia=F._emscripten_bind_AttributeTransformData_transform_type_0=
function(){return F.asm.y.apply(null,arguments)},gb=F._emscripten_bind_DecoderBuffer_DecoderBuffer_0=function(){return F.asm.z.apply(null,arguments)},Pa=F._emscripten_bind_DecoderBuffer_Init_2=function(){return F.asm.A.apply(null,arguments)},Nb=F._emscripten_bind_DecoderBuffer___destroy___0=function(){return F.asm.B.apply(null,arguments)},Ob=F._emscripten_bind_Decoder_DecodeBufferToMesh_2=function(){return F.asm.C.apply(null,arguments)},Ub=F._emscripten_bind_Decoder_DecodeBufferToPointCloud_2=function(){return F.asm.D.apply(null,
arguments)},Wb=F._emscripten_bind_Decoder_Decoder_0=function(){return F.asm.E.apply(null,arguments)},fc=F._emscripten_bind_Decoder_GetAttributeByUniqueId_2=function(){return F.asm.F.apply(null,arguments)},Cb=F._emscripten_bind_Decoder_GetAttributeFloatArrayForAllPoints_4=function(){return F.asm.G.apply(null,arguments)},Qa=F._emscripten_bind_Decoder_GetAttributeFloatForAllPoints_3=function(){return F.asm.H.apply(null,arguments)},xb=F._emscripten_bind_Decoder_GetAttributeFloat_3=function(){return F.asm.I.apply(null,
arguments)},ab=F._emscripten_bind_Decoder_GetAttributeIdByMetadataEntry_3=function(){return F.asm.J.apply(null,arguments)},Ua=F._emscripten_bind_Decoder_GetAttributeIdByName_2=function(){return F.asm.K.apply(null,arguments)},Sb=F._emscripten_bind_Decoder_GetAttributeId_2=function(){return F.asm.L.apply(null,arguments)},Pb=F._emscripten_bind_Decoder_GetAttributeInt16ForAllPoints_3=function(){return F.asm.M.apply(null,arguments)},Xb=F._emscripten_bind_Decoder_GetAttributeInt32ForAllPoints_3=function(){return F.asm.N.apply(null,
arguments)},yb=F._emscripten_bind_Decoder_GetAttributeInt8ForAllPoints_3=function(){return F.asm.O.apply(null,arguments)},Ib=F._emscripten_bind_Decoder_GetAttributeIntForAllPoints_3=function(){return F.asm.P.apply(null,arguments)},Jb=F._emscripten_bind_Decoder_GetAttributeMetadata_2=function(){return F.asm.Q.apply(null,arguments)},Kb=F._emscripten_bind_Decoder_GetAttributeUInt16ArrayForAllPoints_4=function(){return F.asm.R.apply(null,arguments)},gc=F._emscripten_bind_Decoder_GetAttributeUInt16ForAllPoints_3=
function(){return F.asm.S.apply(null,arguments)},hc=F._emscripten_bind_Decoder_GetAttributeUInt32ArrayForAllPoints_4=function(){return F.asm.T.apply(null,arguments)},Yb=F._emscripten_bind_Decoder_GetAttributeUInt32ForAllPoints_3=function(){return F.asm.U.apply(null,arguments)},M=F._emscripten_bind_Decoder_GetAttributeUInt8ArrayForAllPoints_4=function(){return F.asm.V.apply(null,arguments)},wa=F._emscripten_bind_Decoder_GetAttributeUInt8ForAllPoints_3=function(){return F.asm.W.apply(null,arguments)},
Lb=F._emscripten_bind_Decoder_GetAttribute_2=function(){return F.asm.X.apply(null,arguments)},db=F._emscripten_bind_Decoder_GetEncodedGeometryType_1=function(){return F.asm.Y.apply(null,arguments)},zb=F._emscripten_bind_Decoder_GetFaceFromMesh_3=function(){return F.asm.Z.apply(null,arguments)},ga=F._emscripten_bind_Decoder_GetMetadata_1=function(){return F.asm._.apply(null,arguments)},cb=F._emscripten_bind_Decoder_GetTriangleStripsFromMesh_2=function(){return F.asm.$.apply(null,arguments)},rc=F._emscripten_bind_Decoder_GetTrianglesUInt16Array_3=
function(){return F.asm.aa.apply(null,arguments)},sc=F._emscripten_bind_Decoder_GetTrianglesUInt32Array_3=function(){return F.asm.ba.apply(null,arguments)},Cc=F._emscripten_bind_Decoder_SkipAttributeTransform_1=function(){return F.asm.ca.apply(null,arguments)},wd=F._emscripten_bind_Decoder___destroy___0=function(){return F.asm.da.apply(null,arguments)},dc=F._emscripten_bind_DracoFloat32Array_DracoFloat32Array_0=function(){return F.asm.ea.apply(null,arguments)},Pc=F._emscripten_bind_DracoFloat32Array_GetArray_2=
function(){return F.asm.fa.apply(null,arguments)},gd=F._emscripten_bind_DracoFloat32Array_GetValue_1=function(){return F.asm.ga.apply(null,arguments)},hd=F._emscripten_bind_DracoFloat32Array___destroy___0=function(){return F.asm.ha.apply(null,arguments)},Tb=F._emscripten_bind_DracoFloat32Array_size_0=function(){return F.asm.ia.apply(null,arguments)},Kc=F._emscripten_bind_DracoInt16Array_DracoInt16Array_0=function(){return F.asm.ja.apply(null,arguments)},Mb=F._emscripten_bind_DracoInt16Array_GetArray_2=
function(){return F.asm.ka.apply(null,arguments)},tc=F._emscripten_bind_DracoInt16Array_GetValue_1=function(){return F.asm.la.apply(null,arguments)},Bc=F._emscripten_bind_DracoInt16Array___destroy___0=function(){return F.asm.ma.apply(null,arguments)},uc=F._emscripten_bind_DracoInt16Array_size_0=function(){return F.asm.na.apply(null,arguments)},kc=F._emscripten_bind_DracoInt32Array_DracoInt32Array_0=function(){return F.asm.oa.apply(null,arguments)},Ac=F._emscripten_bind_DracoInt32Array_GetArray_2=
function(){return F.asm.pa.apply(null,arguments)},Lc=F._emscripten_bind_DracoInt32Array_GetValue_1=function(){return F.asm.qa.apply(null,arguments)},Db=F._emscripten_bind_DracoInt32Array___destroy___0=function(){return F.asm.ra.apply(null,arguments)},Mc=F._emscripten_bind_DracoInt32Array_size_0=function(){return F.asm.sa.apply(null,arguments)},vc=F._emscripten_bind_DracoInt8Array_DracoInt8Array_0=function(){return F.asm.ta.apply(null,arguments)},ic=F._emscripten_bind_DracoInt8Array_GetArray_2=function(){return F.asm.ua.apply(null,
arguments)},wc=F._emscripten_bind_DracoInt8Array_GetValue_1=function(){return F.asm.va.apply(null,arguments)},Vc=F._emscripten_bind_DracoInt8Array___destroy___0=function(){return F.asm.wa.apply(null,arguments)},Nc=F._emscripten_bind_DracoInt8Array_size_0=function(){return F.asm.xa.apply(null,arguments)},$b=F._emscripten_bind_DracoUInt16Array_DracoUInt16Array_0=function(){return F.asm.ya.apply(null,arguments)},Fc=F._emscripten_bind_DracoUInt16Array_GetArray_2=function(){return F.asm.za.apply(null,
arguments)},jd=F._emscripten_bind_DracoUInt16Array_GetValue_1=function(){return F.asm.Aa.apply(null,arguments)},Bb=F._emscripten_bind_DracoUInt16Array___destroy___0=function(){return F.asm.Ba.apply(null,arguments)},Vb=F._emscripten_bind_DracoUInt16Array_size_0=function(){return F.asm.Ca.apply(null,arguments)},ec=F._emscripten_bind_DracoUInt32Array_DracoUInt32Array_0=function(){return F.asm.Da.apply(null,arguments)},mc=F._emscripten_bind_DracoUInt32Array_GetArray_2=function(){return F.asm.Ea.apply(null,
arguments)},Qc=F._emscripten_bind_DracoUInt32Array_GetValue_1=function(){return F.asm.Fa.apply(null,arguments)},xc=F._emscripten_bind_DracoUInt32Array___destroy___0=function(){return F.asm.Ga.apply(null,arguments)},Wc=F._emscripten_bind_DracoUInt32Array_size_0=function(){return F.asm.Ha.apply(null,arguments)},zd=F._emscripten_bind_DracoUInt8Array_DracoUInt8Array_0=function(){return F.asm.Ia.apply(null,arguments)},Ad=F._emscripten_bind_DracoUInt8Array_GetArray_2=function(){return F.asm.Ja.apply(null,
arguments)},Ic=F._emscripten_bind_DracoUInt8Array_GetValue_1=function(){return F.asm.Ka.apply(null,arguments)},id=F._emscripten_bind_DracoUInt8Array___destroy___0=function(){return F.asm.La.apply(null,arguments)},xd=F._emscripten_bind_DracoUInt8Array_size_0=function(){return F.asm.Ma.apply(null,arguments)},yd=F._emscripten_bind_GeometryAttribute_GeometryAttribute_0=function(){return F.asm.Na.apply(null,arguments)},Ec=F._emscripten_bind_GeometryAttribute___destroy___0=function(){return F.asm.Oa.apply(null,
arguments)},X=F._emscripten_bind_Mesh_Mesh_0=function(){return F.asm.Pa.apply(null,arguments)},Jc=F._emscripten_bind_Mesh___destroy___0=function(){return F.asm.Qa.apply(null,arguments)},Ka=F._emscripten_bind_Mesh_num_attributes_0=function(){return F.asm.Ra.apply(null,arguments)},Aa=F._emscripten_bind_Mesh_num_faces_0=function(){return F.asm.Sa.apply(null,arguments)},Fa=F._emscripten_bind_Mesh_num_points_0=function(){return F.asm.Ta.apply(null,arguments)},Ga=F._emscripten_bind_MetadataQuerier_GetDoubleEntry_2=
function(){return F.asm.Ua.apply(null,arguments)},kd=F._emscripten_bind_MetadataQuerier_GetEntryName_2=function(){return F.asm.Va.apply(null,arguments)},Ya=F._emscripten_bind_MetadataQuerier_GetIntEntryArray_3=function(){return F.asm.Wa.apply(null,arguments)},pb=F._emscripten_bind_MetadataQuerier_GetIntEntry_2=function(){return F.asm.Xa.apply(null,arguments)},ib=F._emscripten_bind_MetadataQuerier_GetStringEntry_2=function(){return F.asm.Ya.apply(null,arguments)},md=F._emscripten_bind_MetadataQuerier_HasEntry_2=
function(){return F.asm.Za.apply(null,arguments)},La=F._emscripten_bind_MetadataQuerier_MetadataQuerier_0=function(){return F.asm._a.apply(null,arguments)},qb=F._emscripten_bind_MetadataQuerier_NumEntries_1=function(){return F.asm.$a.apply(null,arguments)},rb=F._emscripten_bind_MetadataQuerier___destroy___0=function(){return F.asm.ab.apply(null,arguments)},Xc=F._emscripten_bind_Metadata_Metadata_0=function(){return F.asm.bb.apply(null,arguments)},nd=F._emscripten_bind_Metadata___destroy___0=function(){return F.asm.cb.apply(null,
arguments)},od=F._emscripten_bind_PointAttribute_GetAttributeTransformData_0=function(){return F.asm.db.apply(null,arguments)},Yc=F._emscripten_bind_PointAttribute_PointAttribute_0=function(){return F.asm.eb.apply(null,arguments)},Oc=F._emscripten_bind_PointAttribute___destroy___0=function(){return F.asm.fb.apply(null,arguments)},dd=F._emscripten_bind_PointAttribute_attribute_type_0=function(){return F.asm.gb.apply(null,arguments)},Gc=F._emscripten_bind_PointAttribute_byte_offset_0=function(){return F.asm.hb.apply(null,
arguments)},Zc=F._emscripten_bind_PointAttribute_byte_stride_0=function(){return F.asm.ib.apply(null,arguments)},pd=F._emscripten_bind_PointAttribute_data_type_0=function(){return F.asm.jb.apply(null,arguments)},Qb=F._emscripten_bind_PointAttribute_normalized_0=function(){return F.asm.kb.apply(null,arguments)},Eb=F._emscripten_bind_PointAttribute_num_components_0=function(){return F.asm.lb.apply(null,arguments)},ac=F._emscripten_bind_PointAttribute_size_0=function(){return F.asm.mb.apply(null,arguments)},
$c=F._emscripten_bind_PointAttribute_unique_id_0=function(){return F.asm.nb.apply(null,arguments)},bc=F._emscripten_bind_PointCloud_PointCloud_0=function(){return F.asm.ob.apply(null,arguments)},eb=F._emscripten_bind_PointCloud___destroy___0=function(){return F.asm.pb.apply(null,arguments)},ld=F._emscripten_bind_PointCloud_num_attributes_0=function(){return F.asm.qb.apply(null,arguments)},Zb=F._emscripten_bind_PointCloud_num_points_0=function(){return F.asm.rb.apply(null,arguments)},yc=F._emscripten_bind_Status___destroy___0=
function(){return F.asm.sb.apply(null,arguments)},zc=F._emscripten_bind_Status_code_0=function(){return F.asm.tb.apply(null,arguments)},qd=F._emscripten_bind_Status_error_msg_0=function(){return F.asm.ub.apply(null,arguments)},jc=F._emscripten_bind_Status_ok_0=function(){return F.asm.vb.apply(null,arguments)},rd=F._emscripten_bind_VoidPtr___destroy___0=function(){return F.asm.wb.apply(null,arguments)},Ra=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_INVALID_TRANSFORM=function(){return F.asm.xb.apply(null,
arguments)},cc=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_NO_TRANSFORM=function(){return F.asm.yb.apply(null,arguments)},Hc=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_OCTAHEDRON_TRANSFORM=function(){return F.asm.zb.apply(null,arguments)},ad=F._emscripten_enum_draco_AttributeTransformType_ATTRIBUTE_QUANTIZATION_TRANSFORM=function(){return F.asm.Ab.apply(null,arguments)},Rc=F._emscripten_enum_draco_EncodedGeometryType_INVALID_GEOMETRY_TYPE=function(){return F.asm.Bb.apply(null,
arguments)},bd=F._emscripten_enum_draco_EncodedGeometryType_POINT_CLOUD=function(){return F.asm.Cb.apply(null,arguments)},Sc=F._emscripten_enum_draco_EncodedGeometryType_TRIANGULAR_MESH=function(){return F.asm.Db.apply(null,arguments)},D=F._emscripten_enum_draco_GeometryAttribute_Type_COLOR=function(){return F.asm.Eb.apply(null,arguments)},Za=F._emscripten_enum_draco_GeometryAttribute_Type_GENERIC=function(){return F.asm.Fb.apply(null,arguments)},fb=F._emscripten_enum_draco_GeometryAttribute_Type_INVALID=
function(){return F.asm.Gb.apply(null,arguments)},nb=F._emscripten_enum_draco_GeometryAttribute_Type_NORMAL=function(){return F.asm.Hb.apply(null,arguments)},fa=F._emscripten_enum_draco_GeometryAttribute_Type_POSITION=function(){return F.asm.Ib.apply(null,arguments)},Fb=F._emscripten_enum_draco_GeometryAttribute_Type_TEX_COORD=function(){return F.asm.Jb.apply(null,arguments)},Bd=F._emscripten_enum_draco_StatusCode_ERROR=function(){return F.asm.Kb.apply(null,arguments)},mb=F._emscripten_enum_draco_StatusCode_INVALID_PARAMETER=
function(){return F.asm.Lb.apply(null,arguments)},ed=F._emscripten_enum_draco_StatusCode_IO_ERROR=function(){return F.asm.Mb.apply(null,arguments)},sd=F._emscripten_enum_draco_StatusCode_OK=function(){return F.asm.Nb.apply(null,arguments)},Cd=F._emscripten_enum_draco_StatusCode_UNKNOWN_VERSION=function(){return F.asm.Ob.apply(null,arguments)},td=F._emscripten_enum_draco_StatusCode_UNSUPPORTED_VERSION=function(){return F.asm.Pb.apply(null,arguments)},Dd=F._free=function(){return F.asm.Qb.apply(null,
arguments)},ud=F._malloc=function(){return F.asm.Rb.apply(null,arguments)};F.dynCall_v=function(){return F.asm.Sb.apply(null,arguments)};F.dynCall_vi=function(){return F.asm.Tb.apply(null,arguments)};F.asm=lb;F.then=function(a){if(F.calledRun)a(F);else{var b=F.onRuntimeInitialized;F.onRuntimeInitialized=function(){b&&b();a(F)}}return F};x.prototype=Error();x.prototype.constructor=x;va=function fd(){F.calledRun||v();F.calledRun||(va=fd)};F.run=v;F.abort=y;if(F.preInit)for("function"==typeof F.preInit&&
(F.preInit=[F.preInit]);0<F.preInit.length;)F.preInit.pop()();F.noExitRuntime=!0;v();m.prototype=Object.create(m.prototype);m.prototype.constructor=m;m.prototype.__class__=m;m.__cache__={};F.WrapperObject=m;F.getCache=w;F.wrapPointer=A;F.castObject=function(a,b){return A(a.ptr,b)};F.NULL=A(0);F.destroy=function(a){if(!a.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";a.__destroy__();delete w(a.__class__)[a.ptr]};F.compare=function(a,b){return a.ptr===b.ptr};F.getPointer=
function(a){return a.ptr};F.getClass=function(a){return a.__class__};var Ea={buffer:0,size:0,pos:0,temps:[],needed:0,prepare:function(){if(Ea.needed){for(var a=0;a<Ea.temps.length;a++)F._free(Ea.temps[a]);Ea.temps.length=0;F._free(Ea.buffer);Ea.buffer=0;Ea.size+=Ea.needed;Ea.needed=0}Ea.buffer||(Ea.size+=128,Ea.buffer=F._malloc(Ea.size),h(Ea.buffer));Ea.pos=0},alloc:function(a,b){h(Ea.buffer);a=a.length*b.BYTES_PER_ELEMENT;a=a+7&-8;Ea.pos+a>=Ea.size?(h(0<a),Ea.needed+=a,b=F._malloc(a),Ea.temps.push(b)):
(b=Ea.buffer+Ea.pos,Ea.pos+=a);return b},copy:function(a,b,c){switch(b.BYTES_PER_ELEMENT){case 2:c>>=1;break;case 4:c>>=2;break;case 8:c>>=3}for(var d=0;d<a.length;d++)b[c+d]=a[d]}};C.prototype=Object.create(m.prototype);C.prototype.constructor=C;C.prototype.__class__=C;C.__cache__={};F.Status=C;C.prototype.code=C.prototype.code=function(){return zc(this.ptr)};C.prototype.ok=C.prototype.ok=function(){return!!jc(this.ptr)};C.prototype.error_msg=C.prototype.error_msg=function(){return a(qd(this.ptr))};
C.prototype.__destroy__=C.prototype.__destroy__=function(){yc(this.ptr)};E.prototype=Object.create(m.prototype);E.prototype.constructor=E;E.prototype.__class__=E;E.__cache__={};F.DracoUInt16Array=E;E.prototype.GetValue=E.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return jd(b,a)};E.prototype.size=E.prototype.size=function(){return Vb(this.ptr)};E.prototype.GetArray=E.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===
typeof b&&(b=b.ptr);return!!Fc(c,a,b)};E.prototype.__destroy__=E.prototype.__destroy__=function(){Bb(this.ptr)};G.prototype=Object.create(m.prototype);G.prototype.constructor=G;G.prototype.__class__=G;G.__cache__={};F.PointCloud=G;G.prototype.num_attributes=G.prototype.num_attributes=function(){return ld(this.ptr)};G.prototype.num_points=G.prototype.num_points=function(){return Zb(this.ptr)};G.prototype.__destroy__=G.prototype.__destroy__=function(){eb(this.ptr)};J.prototype=Object.create(m.prototype);
J.prototype.constructor=J;J.prototype.__class__=J;J.__cache__={};F.DracoUInt8Array=J;J.prototype.GetValue=J.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Ic(b,a)};J.prototype.size=J.prototype.size=function(){return xd(this.ptr)};J.prototype.GetArray=J.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Ad(c,a,b)};J.prototype.__destroy__=J.prototype.__destroy__=function(){id(this.ptr)};
I.prototype=Object.create(m.prototype);I.prototype.constructor=I;I.prototype.__class__=I;I.__cache__={};F.DracoUInt32Array=I;I.prototype.GetValue=I.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Qc(b,a)};I.prototype.size=I.prototype.size=function(){return Wc(this.ptr)};I.prototype.GetArray=I.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!mc(c,a,b)};I.prototype.__destroy__=I.prototype.__destroy__=
function(){xc(this.ptr)};K.prototype=Object.create(m.prototype);K.prototype.constructor=K;K.prototype.__class__=K;K.__cache__={};F.AttributeOctahedronTransform=K;K.prototype.InitFromAttribute=K.prototype.InitFromAttribute=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return!!Xa(b,a)};K.prototype.quantization_bits=K.prototype.quantization_bits=function(){return Va(this.ptr)};K.prototype.__destroy__=K.prototype.__destroy__=function(){Sa(this.ptr)};H.prototype=Object.create(m.prototype);
H.prototype.constructor=H;H.prototype.__class__=H;H.__cache__={};F.PointAttribute=H;H.prototype.size=H.prototype.size=function(){return ac(this.ptr)};H.prototype.GetAttributeTransformData=H.prototype.GetAttributeTransformData=function(){return A(od(this.ptr),L)};H.prototype.attribute_type=H.prototype.attribute_type=function(){return dd(this.ptr)};H.prototype.data_type=H.prototype.data_type=function(){return pd(this.ptr)};H.prototype.num_components=H.prototype.num_components=function(){return Eb(this.ptr)};
H.prototype.normalized=H.prototype.normalized=function(){return!!Qb(this.ptr)};H.prototype.byte_stride=H.prototype.byte_stride=function(){return Zc(this.ptr)};H.prototype.byte_offset=H.prototype.byte_offset=function(){return Gc(this.ptr)};H.prototype.unique_id=H.prototype.unique_id=function(){return $c(this.ptr)};H.prototype.__destroy__=H.prototype.__destroy__=function(){Oc(this.ptr)};L.prototype=Object.create(m.prototype);L.prototype.constructor=L;L.prototype.__class__=L;L.__cache__={};F.AttributeTransformData=
L;L.prototype.transform_type=L.prototype.transform_type=function(){return Ia(this.ptr)};L.prototype.__destroy__=L.prototype.__destroy__=function(){Ba(this.ptr)};P.prototype=Object.create(m.prototype);P.prototype.constructor=P;P.prototype.__class__=P;P.__cache__={};F.AttributeQuantizationTransform=P;P.prototype.InitFromAttribute=P.prototype.InitFromAttribute=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return!!sb(b,a)};P.prototype.quantization_bits=P.prototype.quantization_bits=function(){return Ab(this.ptr)};
P.prototype.min_value=P.prototype.min_value=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Gb(b,a)};P.prototype.range=P.prototype.range=function(){return Da(this.ptr)};P.prototype.__destroy__=P.prototype.__destroy__=function(){Rb(this.ptr)};S.prototype=Object.create(m.prototype);S.prototype.constructor=S;S.prototype.__class__=S;S.__cache__={};F.DracoInt8Array=S;S.prototype.GetValue=S.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return wc(b,a)};
S.prototype.size=S.prototype.size=function(){return Nc(this.ptr)};S.prototype.GetArray=S.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!ic(c,a,b)};S.prototype.__destroy__=S.prototype.__destroy__=function(){Vc(this.ptr)};R.prototype=Object.create(m.prototype);R.prototype.constructor=R;R.prototype.__class__=R;R.__cache__={};F.MetadataQuerier=R;R.prototype.HasEntry=R.prototype.HasEntry=function(a,b){var c=this.ptr;Ea.prepare();
a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return!!md(c,a,b)};R.prototype.GetIntEntry=R.prototype.GetIntEntry=function(a,b){var c=this.ptr;Ea.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return pb(c,a,b)};R.prototype.GetIntEntryArray=R.prototype.GetIntEntryArray=function(a,b,c){var d=this.ptr;Ea.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);c&&"object"===typeof c&&(c=c.ptr);Ya(d,a,b,c)};R.prototype.GetDoubleEntry=
R.prototype.GetDoubleEntry=function(a,b){var c=this.ptr;Ea.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return Ga(c,a,b)};R.prototype.GetStringEntry=R.prototype.GetStringEntry=function(b,c){var d=this.ptr;Ea.prepare();b&&"object"===typeof b&&(b=b.ptr);c=c&&"object"===typeof c?c.ptr:B(c);return a(ib(d,b,c))};R.prototype.NumEntries=R.prototype.NumEntries=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return qb(b,a)};R.prototype.GetEntryName=R.prototype.GetEntryName=
function(b,c){var d=this.ptr;b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return a(kd(d,b,c))};R.prototype.__destroy__=R.prototype.__destroy__=function(){rb(this.ptr)};O.prototype=Object.create(m.prototype);O.prototype.constructor=O;O.prototype.__class__=O;O.__cache__={};F.DracoInt16Array=O;O.prototype.GetValue=O.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return tc(b,a)};O.prototype.size=O.prototype.size=function(){return uc(this.ptr)};O.prototype.GetArray=
O.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Mb(c,a,b)};O.prototype.__destroy__=O.prototype.__destroy__=function(){Bc(this.ptr)};Q.prototype=Object.create(m.prototype);Q.prototype.constructor=Q;Q.prototype.__class__=Q;Q.__cache__={};F.DracoFloat32Array=Q;Q.prototype.GetValue=Q.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return gd(b,a)};Q.prototype.size=Q.prototype.size=function(){return Tb(this.ptr)};
Q.prototype.GetArray=Q.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Pc(c,a,b)};Q.prototype.__destroy__=Q.prototype.__destroy__=function(){hd(this.ptr)};T.prototype=Object.create(m.prototype);T.prototype.constructor=T;T.prototype.__class__=T;T.__cache__={};F.GeometryAttribute=T;T.prototype.__destroy__=T.prototype.__destroy__=function(){Ec(this.ptr)};Y.prototype=Object.create(m.prototype);Y.prototype.constructor=Y;Y.prototype.__class__=
Y;Y.__cache__={};F.DecoderBuffer=Y;Y.prototype.Init=Y.prototype.Init=function(a,b){var c=this.ptr;Ea.prepare();if("object"==typeof a&&"object"===typeof a){var d=Ea.alloc(a,na);Ea.copy(a,na,d);a=d}b&&"object"===typeof b&&(b=b.ptr);Pa(c,a,b)};Y.prototype.__destroy__=Y.prototype.__destroy__=function(){Nb(this.ptr)};N.prototype=Object.create(m.prototype);N.prototype.constructor=N;N.prototype.__class__=N;N.__cache__={};F.Decoder=N;N.prototype.GetEncodedGeometryType=N.prototype.GetEncodedGeometryType=function(a){var b=
this.ptr;a&&"object"===typeof a&&(a=a.ptr);return db(b,a)};N.prototype.DecodeBufferToPointCloud=N.prototype.DecodeBufferToPointCloud=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return A(Ub(c,a,b),C)};N.prototype.DecodeBufferToMesh=N.prototype.DecodeBufferToMesh=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return A(Ob(c,a,b),C)};N.prototype.GetAttributeId=N.prototype.GetAttributeId=function(a,b){var c=
this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return Sb(c,a,b)};N.prototype.GetAttributeIdByName=N.prototype.GetAttributeIdByName=function(a,b){var c=this.ptr;Ea.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);return Ua(c,a,b)};N.prototype.GetAttributeIdByMetadataEntry=N.prototype.GetAttributeIdByMetadataEntry=function(a,b,c){var d=this.ptr;Ea.prepare();a&&"object"===typeof a&&(a=a.ptr);b=b&&"object"===typeof b?b.ptr:B(b);c=c&&"object"===
typeof c?c.ptr:B(c);return ab(d,a,b,c)};N.prototype.GetAttribute=N.prototype.GetAttribute=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return A(Lb(c,a,b),H)};N.prototype.GetAttributeByUniqueId=N.prototype.GetAttributeByUniqueId=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return A(fc(c,a,b),H)};N.prototype.GetMetadata=N.prototype.GetMetadata=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=
a.ptr);return A(ga(b,a),V)};N.prototype.GetAttributeMetadata=N.prototype.GetAttributeMetadata=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return A(Jb(c,a,b),V)};N.prototype.GetFaceFromMesh=N.prototype.GetFaceFromMesh=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!zb(d,a,b,c)};N.prototype.GetTriangleStripsFromMesh=N.prototype.GetTriangleStripsFromMesh=function(a,
b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return cb(c,a,b)};N.prototype.GetTrianglesUInt16Array=N.prototype.GetTrianglesUInt16Array=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!rc(d,a,b,c)};N.prototype.GetTrianglesUInt32Array=N.prototype.GetTrianglesUInt32Array=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);
c&&"object"===typeof c&&(c=c.ptr);return!!sc(d,a,b,c)};N.prototype.GetAttributeFloat=N.prototype.GetAttributeFloat=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!xb(d,a,b,c)};N.prototype.GetAttributeFloatForAllPoints=N.prototype.GetAttributeFloatForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Qa(d,a,
b,c)};N.prototype.GetAttributeFloatArrayForAllPoints=N.prototype.GetAttributeFloatArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!Cb(e,a,b,c,d)};N.prototype.GetAttributeIntForAllPoints=N.prototype.GetAttributeIntForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);
return!!Ib(d,a,b,c)};N.prototype.GetAttributeInt8ForAllPoints=N.prototype.GetAttributeInt8ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!yb(d,a,b,c)};N.prototype.GetAttributeUInt8ForAllPoints=N.prototype.GetAttributeUInt8ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!wa(d,a,b,c)};N.prototype.GetAttributeUInt8ArrayForAllPoints=
N.prototype.GetAttributeUInt8ArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!M(e,a,b,c,d)};N.prototype.GetAttributeInt16ForAllPoints=N.prototype.GetAttributeInt16ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Pb(d,a,b,c)};N.prototype.GetAttributeUInt16ForAllPoints=
N.prototype.GetAttributeUInt16ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!gc(d,a,b,c)};N.prototype.GetAttributeUInt16ArrayForAllPoints=N.prototype.GetAttributeUInt16ArrayForAllPoints=function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!Kb(e,a,b,c,d)};N.prototype.GetAttributeInt32ForAllPoints=
N.prototype.GetAttributeInt32ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Xb(d,a,b,c)};N.prototype.GetAttributeUInt32ForAllPoints=N.prototype.GetAttributeUInt32ForAllPoints=function(a,b,c){var d=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);return!!Yb(d,a,b,c)};N.prototype.GetAttributeUInt32ArrayForAllPoints=N.prototype.GetAttributeUInt32ArrayForAllPoints=
function(a,b,c,d){var e=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);c&&"object"===typeof c&&(c=c.ptr);d&&"object"===typeof d&&(d=d.ptr);return!!hc(e,a,b,c,d)};N.prototype.SkipAttributeTransform=N.prototype.SkipAttributeTransform=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);Cc(b,a)};N.prototype.__destroy__=N.prototype.__destroy__=function(){wd(this.ptr)};Z.prototype=Object.create(m.prototype);Z.prototype.constructor=Z;Z.prototype.__class__=Z;Z.__cache__=
{};F.Mesh=Z;Z.prototype.num_faces=Z.prototype.num_faces=function(){return Aa(this.ptr)};Z.prototype.num_attributes=Z.prototype.num_attributes=function(){return Ka(this.ptr)};Z.prototype.num_points=Z.prototype.num_points=function(){return Fa(this.ptr)};Z.prototype.__destroy__=Z.prototype.__destroy__=function(){Jc(this.ptr)};W.prototype=Object.create(m.prototype);W.prototype.constructor=W;W.prototype.__class__=W;W.__cache__={};F.VoidPtr=W;W.prototype.__destroy__=W.prototype.__destroy__=function(){rd(this.ptr)};
aa.prototype=Object.create(m.prototype);aa.prototype.constructor=aa;aa.prototype.__class__=aa;aa.__cache__={};F.DracoInt32Array=aa;aa.prototype.GetValue=aa.prototype.GetValue=function(a){var b=this.ptr;a&&"object"===typeof a&&(a=a.ptr);return Lc(b,a)};aa.prototype.size=aa.prototype.size=function(){return Mc(this.ptr)};aa.prototype.GetArray=aa.prototype.GetArray=function(a,b){var c=this.ptr;a&&"object"===typeof a&&(a=a.ptr);b&&"object"===typeof b&&(b=b.ptr);return!!Ac(c,a,b)};aa.prototype.__destroy__=
aa.prototype.__destroy__=function(){Db(this.ptr)};V.prototype=Object.create(m.prototype);V.prototype.constructor=V;V.prototype.__class__=V;V.__cache__={};F.Metadata=V;V.prototype.__destroy__=V.prototype.__destroy__=function(){nd(this.ptr)};(function(){function a(){F.OK=sd();F.ERROR=Bd();F.IO_ERROR=ed();F.INVALID_PARAMETER=mb();F.UNSUPPORTED_VERSION=td();F.UNKNOWN_VERSION=Cd();F.INVALID_GEOMETRY_TYPE=Rc();F.POINT_CLOUD=bd();F.TRIANGULAR_MESH=Sc();F.ATTRIBUTE_INVALID_TRANSFORM=Ra();F.ATTRIBUTE_NO_TRANSFORM=
cc();F.ATTRIBUTE_QUANTIZATION_TRANSFORM=ad();F.ATTRIBUTE_OCTAHEDRON_TRANSFORM=Hc();F.INVALID=fb();F.POSITION=fa();F.NORMAL=nb();F.COLOR=D();F.TEX_COORD=Fb();F.GENERIC=Za()}Ca?a():z.unshift(a)})();if("function"===typeof F.onModuleParsed)F.onModuleParsed();return l}}();"object"===typeof exports&&"object"===typeof module?module.exports=q:"function"===typeof define&&define.amd?define([],function(){return q}):"object"===typeof exports&&(exports.DracoDecoderModule=q)},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("require exports ../../../../core/mathUtils ../../../../core/maybe ../../webgl-engine/core/shaderLibrary/DiscardOrAdjustAlpha.glsl ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});b.getMaterialAndTextures=function(b,h){var d=new Map,c=function(a,b){if(f.isNone(a))return-1;if(d.has(a.id))return a=d.get(a.id),a.usage|=b,a.id;var c=d.size;d.set(a.id,{id:c,usage:b});return c},g=h.pbrMetallicRoughness,k=g&&g.baseColorFactor,l=h.emissiveFactor,q=null==h.normalTexture&&null==h.emissiveTexture&&null==h.occlusionTexture&&(g?null==g.metallicRoughnessTexture&&1===g.roughnessFactor&&(1===g.metallicFactor||0===g.metallicFactor):
!0),t=q?a.defaultPBRMaterialParameters.metallicFactor:g?g.metallicFactor:1,x=q?a.defaultPBRMaterialParameters.roughnessFactor:g?g.roughnessFactor:1,g={baseColorFactor:k?[k[0],k[1],k[2],k[3]]:[1,1,1,1],baseColorTextureId:c(g&&g.baseColorTexture,"opaque"===h.alphaMode||0===h.alphaCutoff?1:33),metallicRoughnessTextureId:c(g&&g.metallicRoughnessTexture,2),metallicFactor:t,roughnessFactor:x};h={alphaMode:h.alphaMode,alphaCutoff:h.alphaCutoff,doubleSided:h.doubleSided,cullFace:"none"===h.cullFace?0:"back"===
h.cullFace?2:"front"===h.cullFace?1:void 0,normalTextureId:c(h.normalTexture,4),emissiveTextureId:c(h.emissiveTexture,16),occlusionTextureId:c(h.occlusionTexture,8),emissiveFactor:l?[l[0],l[1],l[2]]:[0,0,0],metallicRoughness:g,wrapTextures:!1,isSchematic:q};var v=[];d.forEach(function(a,c){a=a.usage;var d=f.isSome(b)&&b[c]&&b[c].formats,d=d?d.map(function(a){return{name:a.name,encoding:e[a.format]}}):[];v.push({id:c,usage:a,encodings:d})});return{material:h,textures:v}};var e={jpg:"image/jpeg",png:"image/png",
dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};b.getMaterialAndTexturesFromShared=function(a){var b=a&&a.materialDefinitions?Object.keys(a.materialDefinitions)[0]:null,d=a&&a.textureDefinitions?Object.keys(a.textureDefinitions)[0]:null,b=b&&a.materialDefinitions[b],d=d&&a.textureDefinitions[d];a={alphaMode:"opaque",alphaCutoff:h.TEXTURE_ALPHA_CUTOFF_DEFAULT,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,
.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};if(null!=b){b=b.params;b.diffuse&&(a.metallicRoughness.baseColorFactor=[b.diffuse[0],b.diffuse[1],b.diffuse[2],1]);null!=b.doubleSided&&(a.doubleSided=b.doubleSided,a.cullFace=b.doubleSided?0:2);if("none"===b.cullFace||"front"===b.cullFace||"back"===b.cullFace)a.cullFace="none"===b.cullFace?0:"back"===b.cullFace?2:1;b.transparency&&(a.metallicRoughness.baseColorFactor[3]=
l.clamp(1-b.transparency,0,1));if(b.useVertexColorAlpha||1>a.metallicRoughness.baseColorFactor[3])a.alphaMode="blend"}b=[];if(null!=d){!d.wrap||"repeat"!==d.wrap[0]&&"repeat"!==d.wrap[1]||(a.wrapTextures=!0);var c=1;"rgba"===d.channels&&(a.alphaMode="blend",c|=32);var e=d.images[d.images.length-1],f=function(a){return a&&a.split("/").pop()},d=Array.isArray(d.encoding)?d.encoding.map(function(a,b){return{name:f(e.href[b]),encoding:a}}):[{name:f(e.href),encoding:d.encoding}];b.push({id:0,usage:c,encodings:d});
a.metallicRoughness.baseColorTextureId=0}return{material:a,textures:b}}})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/promiseUtils"],function(q,b,l,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.requester=a;this.activeRequests=new Set}Object.defineProperty(b.prototype,"busy",{get:function(){return this.requester.busy},enumerable:!0,configurable:!0});b.prototype.request=
function(a,b,d){var e=this,h=f.createAbortController();f.onAbortOrThrow(d,function(){return h.abort()});d=l({},d,{signal:h.signal});a=this.requester.request(a,b,d);var c={response:a,abortController:h};this.activeRequests.add(c);f.always(a,function(){return e.activeRequests.delete(c)});return a};b.prototype.cancelAll=function(){this.activeRequests.forEach(function(a){return a.abortController.abort()});this.activeRequests.clear()};return b}();b.I3SStreamDataController=q;b.default=q})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){return function(){function b(a,b,c,d,h,k,l){void 0===l&&(l={});this.indexSR=a;this._renderCoordsHelper=b;this.extent=d;this.elevationProvider=h;this.options=l;this.fp=g.frustum.create();this._poi=f.vec3f64.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=f.vec3f64.create();this._tmp2=f.vec3f64.create();this._tmp3=f.vec3f64.create();this._tmp0=f.vec3f64.create();this.screenspaceErrorBias=l.screenspaceErrorBias||1;this.progressiveLoadFactor=
l.progressiveLoadFactor||1;this.updateCamera(c);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(k);this.tmpPoint=e.makeDehydratedPoint(0,0,0,a)}b.prototype.updateElevationInfo=function(a){null==a?this._elevationContext=null:(this._elevationContext=new k,this._elevationContext.featureExpressionInfoContext=n.createContextWithoutExpressionSupport(n.extractExpressionInfo(a,!1)),this._elevationContext.mixinApi(a))};b.prototype.updateCamera=function(a){g.frustum.fromMatrix(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/(a.perScreenPixelRatio/2);this._camPos=a.eye;this.minDistance=Infinity;this.maxDistance=0};b.prototype.setPointOfInterest=function(a){l.vec3.copy(this._poi,a)};b.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};b.prototype.updateExtent=function(a){this.extent=a};b.prototype.getRenderMbs=function(b){var c=b.renderMbs;c||(c=a.vec4f64.fromValues(b.mbs[0],b.mbs[1],b.mbs[2],-1),b.renderMbs=
c);0>c[3]&&(h.vec4.copy(c,b.mbs),this._elevationContext&&1E5>c[3]&&(this.tmpPoint.x=c[0],this.tmpPoint.y=c[1],this.tmpPoint.z=c[2],c[2]=d.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),p.mbsToMbs(c,this.indexSR,c,this.engineSR));return c};b.prototype.getRenderObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])&&a.renderObb){var b=a.renderObb;if(0>b.halfSize[0]){var e=0;this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],
this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],e=d.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-a.obb.center[2]);c.transformObb(a.obb,this.indexSR,b,this.engineSR,!a.isComputedObb,e)}return b}};b.prototype.isNodeVisible=function(a){var b=this.getRenderMbs(a);return this.isMBSinExtent(b)?a.obb?(a=this.getRenderObb(a),r.isVisible(a,this.fp)):this.isMBSVisible(b):!1};b.prototype.isGeometryVisible=function(a){return(a=
this.getRenderObb(a))?r.isVisible(a,this.fp):!0};b.prototype.isMBSinExtent=function(a){return this.extent?0!==c.intersectBoundingBoxWithMbs(this.extent,a):!0};b.prototype.isMBSVisible=function(a){return g.frustum.intersectsSphere(this.fp.planes,g.sphere.wrap(a[3],a))};b.prototype.screenSpaceDiameterMbs=function(a,b){var c=this.getRenderMbs(a);a=Math.sqrt(l.vec3.squaredDistance(c,this._camPos));c=a-c[3];this._updateMinMaxDistance(a);return 0>c?.5*Number.MAX_VALUE:b/c*this._screenSizeFactor};b.prototype.calcCameraDistance=
function(a){return this.calcCameraDistanceToCenter(a)-this.getRenderMbs(a)[3]};b.prototype.calcCameraDistanceToCenter=function(a){a=this.getRenderMbs(a);a=l.vec3.distance(a,this._camPos);this._updateMinMaxDistance(a);return a};b.prototype.calcAngleDependentLoD=function(a){a=this.getRenderMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/l.vec3.length(a)+b)/l.vec3.distance(a,this._camPos);return Math.min(1,a)};b.prototype.hasLOD=function(a){return 0!==
a.lodMetric};b.prototype.getDistancePlanarMode=function(a,b){var c=a[0]-b[0],d=a[1]-b[1];a=a[2]-b[2];c=c*c+d*d;b=b[3];if(c<=b*b)return Math.abs(a);b=Math.sqrt(c)-b;return Math.sqrt(a*a+b*b)};b.prototype.getDistanceGlobeMode=function(a,b){var c=l.vec3.length(b),d=l.vec3.length(a)-c;l.vec3.scale(this._tmp0,a,l.vec3.dot(a,b)/l.vec3.squaredLength(a));var e=l.vec3.squaredDistance(b,this._tmp0),f=b[3];if(e<=f*f)return Math.abs(d);b=l.vec3.scale(this._tmp0,b,1/c);c=l.vec3.scale(this._tmp1,b,c-f*f/2/c);e=
l.vec3.subtract(this._tmp2,a,c);e=l.vec3.subtract(this._tmp2,e,l.vec3.scale(this._tmp3,b,l.vec3.dot(b,e)));c=l.vec3.add(this._tmp2,c,l.vec3.scale(this._tmp2,e,f/l.vec3.length(e)));f=l.vec3.distance(a,c);2E5<=d&&(a=l.vec3.subtract(this._tmp1,a,c),a=l.vec3.dot(a,b)/l.vec3.length(a),.08>a&&(a=1E-4),f/=a);return f};b.prototype.getDistance=function(a,b){return this.engineSR===p.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b):this.getDistancePlanarMode(a,b)};b.prototype._updateMinMaxDistance=
function(a){0<a?(this.minDistance=Math.min(this.minDistance,a),this.maxDistance=Math.max(this.maxDistance,a)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-a))};b.prototype.getLodLevel=function(a){if(0===a.lodMetric||!a.resources.hasFeatureData)return 0;if(0===a.childCount)return this.maxLodLevel;if(1>this.progressiveLoadFactor){var b=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(a,b)?2:1:0}return this.evaluateLODmetric(a,
this.screenspaceErrorBias)?this.maxLodLevel:0};b.prototype.evaluateLODmetric=function(a,b){switch(a.lodMetric){case 2:var c=this.getRenderMbs(a),d=this.getDistance(this._camPos,c),e=2*d/this._screenSizeFactor;this._updateMinMaxDistance(d+c[3]);return a.maxError*b<=e;case 1:return b=this.screenSpaceDiameterMbs(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<a.maxError;case 3:return 10>this.screenSpaceDiameterMbs(a,a.maxError)*b;case 4:return this.calcCameraDistance(a)>
a.maxError*b}return!1};b.prototype.distToPOI=function(a){a=this.getRenderMbs(a);return l.vec3.distance(a,this._poi)-a[3]};b.prototype.distCameraToPOI=function(){return l.vec3.distance(this._camPos,this._poi)};return b}()})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators ../../../core/accessorSupport/diffUtils ../../../core/libs/gl-matrix-2/vec3f64 ./graphics/Graphics3DCore ./i3s/I3SGeometryUtil ../support/GraphicsMap".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(c){c=b.call(this,c)||this;c.loadedGraphics=new u.GraphicsMap;c.slicePlaneEnabled=!1;c._renderingInfo={symbol:new a.PointSymbol3D};c._handles=new d;c._attachmentGraphicsByNode=new Map;return c}f(e,b);e.prototype.initialize=function(){var a=this;this._labelGraphicsCore=new r({owner:this,layer:this.layer,preferredUpdatePolicy:0,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,
getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var b=this.view.labeler.addGraphicsOwner(this._labelGraphicsCore,null,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),d=this.view.deconflictor.addGraphicsOwner(this._labelGraphicsCore);this._labelGraphicsCore.setup({labeler:b,deconflictor:d}).then(function(){a.destroyed||a._labelGraphicsCore.startCreateGraphics()});this._handles.add([this.layer.watch("labelingInfo",
function(b,d){c.diff(b,d)&&a._labelGraphicsCore.updateLabelingInfo()})])};e.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._labelGraphicsCore&&(this._labelGraphicsCore.destroy(),this._labelGraphicsCore=null);this.view=null};e.prototype.addNodeMeta=function(a,b){var c=this,d=0,e=a.filteredIds,f=a.featureIds.map(function(f,g){p.boundingBoxTop(g,c.collection,a.objectHandle,x);var l={type:"point",x:x[0],y:x[1],z:x[2],spatialReference:c.view.renderSpatialReference,
hasZ:!0,hasM:!1};g=b(g,a);var m=!1;k.isNone(e)?m=!0:d<e.length&&f===e[d]&&(m=!0,d++);return{objectId:f,uid:h.generateUID(),attributes:g,visible:m,geometry:l}});this.loadedGraphics.addManyAndDeduplicate(f);this._attachmentGraphicsByNode.set(a.node.index,f)};e.prototype.setNodeMetaAttributes=function(a,b){for(var c=this._attachmentGraphicsByNode.get(a.node.index),d=0;d<c.length;d++)c[d].attributes=b(d,a);this._labelGraphicsCore.updateLabelingInfo(a.featureIds)};e.prototype.applyFilterChange=function(a){var b=
this._attachmentGraphicsByNode.get(a.node.index);if(b)if(k.isNone(a.filteredIds))for(a=0;a<b.length;a++){var c=b[a];c.visible||(c.visible=!0,t.graphic=c,t.property="visible",t.oldValue=!1,t.newValue=!0,this._labelGraphicsCore.graphicUpdateHandler(t))}else for(var d=0,e=0;e<b.length;e++){var c=b[e],f=c.visible;d<a.filteredIds.length&&c.objectId===a.filteredIds[d]?(c.visible=!0,d++):c.visible=!1;f!==c.visible&&(t.graphic=c,t.property="visible",t.oldValue=f,t.newValue=c.visible,this._labelGraphicsCore.graphicUpdateHandler(t))}};
e.prototype.removeNodeMeta=function(a){this.loadedGraphics.removeManyObjectIds(a.featureIds)};e.prototype.getRenderingInfo=function(){return this._renderingInfo};l([n.property()],e.prototype,"view",void 0);l([n.property()],e.prototype,"layer",void 0);l([n.property()],e.prototype,"collection",void 0);l([n.property()],e.prototype,"loadedGraphics",void 0);l([n.property({aliasOf:"_labelGraphicsCore.updating"})],e.prototype,"updating",void 0);l([n.property()],e.prototype,"slicePlaneEnabled",void 0);l([n.property()],
e.prototype,"_labelGraphicsCore",void 0);return e=l([n.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],e)}(n.declared(e));var t={graphic:null,property:null,oldValue:null,newValue:null},x=g.vec3f64.create();b.default=q})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/meshUtils/deduplicate ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){function t(a,b,c,d,e,f,g){switch(c){case 1:for(c=0;c<g;c++)d[e]=a[b],b+=1,e+=f;break;case 2:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=f;break;case 3:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=f;break;case 4:for(c=0;c<g;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=f;break;default:throw w("Unhandled stride size "+c);}}function x(a,b,c,d,e,f){switch(b){case 1:for(b=0;b<f;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<f;b++)c[d]=
a,c[d+1]=a,d+=e;break;case 3:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=0;b<f;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw w("Unhandled stride size "+b);}}function v(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function y(a){switch(a){case 5120:return"Int8";
case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function m(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function w(a){return Error("I3SGeometryUtil processing failed: "+a)}function A(a){var b=a.normals,c=a.positions,f=a.normalInd,g=a.positionInd;u.assert(a.normalInd.length===a.positionInd.length);a=k.vec3f32.create();for(var h=k.vec3f32.create(),l=e.vec2f32.create(),
m=c.data,n=c.offsetIdx,c=c.strideIdx,p=b.data,q=b.offsetIdx,b=b.strideIdx,r=0;r<g.length;r+=3){var t=g[r],t=n+c*t,v=m[t],w=m[t+1],x=m[t+2],t=g[r+1],t=n+c*t;a[0]=m[t]-v;a[1]=m[t+1]-w;a[2]=m[t+2]-x;t=g[r+2];t=n+c*t;h[0]=m[t]-v;h[1]=m[t+1]-w;h[2]=m[t+2]-x;d.vec3.cross(a,a,h);u.encodeNormal(a,l);for(v=0;3>v;v++)w=q+b*f[r+v],p[w]=u.encodeInt16(l[0]),p[w+1]=u.encodeInt16(l[1])}}function B(a,b){return G.intersects(a,b)?G.contains(a,b)?0:2:1}function C(a,b){return G.intersects(a,b)?G.contains(a,b)?1:2:0}
Object.defineProperty(b,"__esModule",{value:!0});var E=new Uint8Array(64);b.interleaveGeometryBuffer=function(a,b,c,d,e){void 0===d&&(d=[]);void 0===e&&(e=[]);var f=a.params.vertexAttributes,g=f.position.count;if(!m(c[0].stride))throw w("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var h=new Uint32Array(c[0].stride/Uint32Array.BYTES_PER_ELEMENT*g);c=c.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==e.indexOf(a.name))return"continue";var c=f[a.name],
k=v(a.type),l=void 0,n=!1;if(null==c)if(n=d.filter(function(b){return b.name===a.name})[0]){c={valueType:y(a.type),byteOffset:0,count:g,valuesPerElement:a.count};for(l=0;l<E.length;l++)E[l]=n.byteValue;l=E.buffer;n=!0}else throw w("Geometry definition is missing attribute");else l=b;if(y(a.type)!==c.valueType)throw w("Geometry definition type must match attribute type");if(0!==c.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw w(a.name+" offset must use "+
Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!m(c.valuesPerElement*k.BYTES_PER_ELEMENT)||!m(a.count*k.BYTES_PER_ELEMENT))throw w(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var l=new Uint32Array(l),p=c.byteOffset/Uint32Array.BYTES_PER_ELEMENT,c=c.valuesPerElement*k.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,k=a.offset/Uint32Array.BYTES_PER_ELEMENT,q=a.stride/Uint32Array.BYTES_PER_ELEMENT;n?x(l[0],c,h,k,q,g):t(l,p,c,h,k,q,g)};for(var k=0;k<c.length;k++)a(c[k]);return h.buffer};
b.processAndInterleaveNormals=function(a,b,c,d){if("none"===a)A(d);else{var e=d.normals,f="earth-centered"===a?c:null;a=b.length/3;c=e.data;d=e.offsetIdx;e=e.strideIdx;if(null!=f)for(var g=f[0],h=f[1],k=f[2],l=f[4],m=f[5],n=f[6],p=f[8],q=f[9],f=f[10],r=0;r<a;r++){var t=b[3*r],v=b[3*r+1],w=b[3*r+2];K[0]=g*t+h*v+k*w;K[1]=l*t+m*v+n*w;K[2]=p*t+q*v+f*w;u.encodeNormal(K,H);c[d+r*e]=u.encodeInt16(H[0]);c[d+r*e+1]=u.encodeInt16(H[1])}else for(r=0;r<a;r++)K[0]=b[3*r],K[1]=b[3*r+1],K[2]=b[3*r+2],u.encodeNormal(K,
H),c[d+r*e]=u.encodeInt16(H[0]),c[d+r*e+1]=u.encodeInt16(H[1])}};b.computeCompressedNormals=A;b.extractPositionData=function(a,b,c){var d=b[0];if(null==d||"position"!==d.name||5126!==d.type)return null;a=new Float32Array(a);b=d.stride/4;for(var d=d.offset/4,e=3*a.length/b,f=new Float32Array(e),g=0;g<e/3;g++)f[3*g]=a[g*b+d],f[3*g+1]=a[g*b+d+1],f[3*g+2]=a[g*b+d+2];c=r.default(f.buffer,3,{originalIndices:c});return 65536>c.uniqueCount?{data:new Float32Array(c.buffer),indices:new Uint16Array(c.indices)}:
{data:new Float32Array(c.buffer),indices:c.indices}};var G;b.isGeometryEngineLoaded=function(){return!!G};b.loadGeometryEngine=function(){return f(this,void 0,void 0,function(){return l(this,function(b){switch(b.label){case 0:return G?[2,G]:[4,a.create(function(a){return q(["../../../../geometry/geometryEngine"],a)})];case 1:return G=b.sent(),[2,G]}})})};b.processFilterGeometry=function(a,b){if(!a)return null;if("disjoint"===b&&"polygon"===a.type){var c=Array(a.rings.length);for(b=0;b<a.rings.length;++b){var d=
g.fromValues(Infinity,Infinity,-Infinity,-Infinity);g.expandWithNestedArray(d,a.rings[b]);c[b]={type:"polygon",rings:[a.rings[b]],spatialReference:a.spatialReference,aabr:d}}c.sort(function(a,b){return a.aabr[0]-b.aabr[0]});var e=new Set,f=new h.PositionHint;a=function(a){var b=c[a];for(a+=1;a<c.length;++a){var d=c[a];if(d.aabr[0]>=b.aabr[2])break;e.add(d)}e.forEach(function(a){b!==a&&(a.aabr[2]<=b.aabr[0]?e.delete(a):G.intersects(b,a)&&(b.rings=b.rings.concat(a.rings),g.expand(b.aabr,a.aabr),delete b._geVersion,
e.delete(a),a=h.indexOf(c,a,c.length,f),c.splice(a,1)))});e.add(b)};for(b=0;b<c.length;++b)a(b);for(a=0;a<c.length;a++)delete c[a].aabr;return c}return[a]};b.acquireMaskFilterContext=function(a,b,c,d,e){b=b.renderSpatialReference;var f=new Map,g={rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:c};g.rings[0][3]=g.rings[0][0];var h,k;switch(a){case "intersects":h=function(a,b){return G.intersects(a,b)?0:2};k=B;break;case "contains":h=function(a,b){return G.contains(a,
b)?2:1};k=B;break;default:h=function(a,b){return G.disjoint(a,b)?2:1},k=C}return{collection:d,object:e,type:a,maskSR:c,renderSR:b,aabbCache:f,triangle:g,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:h,geometryTest:k}};b.computeMaskNodeMBS=function(a,b){var c={x:a[0],y:a[1],hasZ:!1,hasM:!1,type:"point",spatialReference:b.maskSR};return b.maskSR.isWGS84||b.maskSR.isWebMercator?G.geodesicBuffer(c,a[3],1,!0):G.buffer(c,a[3],1,!0)};b.testMaskWithGeometry=function(a,b,
c){switch(c){case "intersects":case "contains":return B(a,b);case "disjoint":return C(a,b)}};var J=Math.pow(2,-32);b.filterWithMask=function(a,b,c){var e=c.collection,f=c.object,g=c.renderSR,h=c.maskSR,k=c.geometryTest,l=c.aabbCache,m=l.get(b);if(!m){var n=e.getObjectTransform(f);e.getComponentAABB(f,b,I);for(var q=[[I[0],I[1],0],[I[0],I[4],0],[I[3],I[4],0],[I[3],I[1],0]],m=0;4>m;++m)d.vec3.transformMat3(q[m],q[m],n.rotationScale),d.vec3.add(q[m],q[m],n.position),p.vectorToVector(q[m],g,q[m],h);m=
{rings:[q],hasZ:!1,hasM:!1,type:"polygon",spatialReference:h};m.rings[0][4]=m.rings[0][0];l.set(b,m)}switch(k(a,m)){case 1:return!1;case 0:return!0}var k=c.triangle,l=c.triangleTest,m=c.positions,n=k.rings[0][0],q=k.rings[0][1],r=k.rings[0][2],t=e.getObjectTransform(f);e.getComponentPositions(f,b,m);b=m.indices;for(var e=m.data,f=m.stride,u=m.endIndex,m=m.startIndex;m<u;m+=3){var v=f*b[m+0],w=f*b[m+1],x=f*b[m+2];d.vec3.set(n,e[v+0],e[v+1],e[v+2]);d.vec3.set(q,e[w+0],e[w+1],e[w+2]);d.vec3.set(r,e[x+
0],e[x+1],e[x+2]);d.vec3.transformMat3(n,n,t.rotationScale);d.vec3.transformMat3(q,q,t.rotationScale);d.vec3.transformMat3(r,r,t.rotationScale);d.vec3.add(n,n,t.position);d.vec3.add(q,q,t.position);d.vec3.add(r,r,t.position);p.vectorToVector(n,g,n,h);p.vectorToVector(q,g,q,h);p.vectorToVector(r,g,r,h);if(!(Math.abs((q[0]-n[0])*(r[1]-n[1])-(q[1]-n[1])*(r[0]-n[0]))<J))switch(delete k._geVersion,l(a,k)){case 1:return!1;case 0:return!0}}switch(c.type){case "intersects":return!1;default:return!0}};b.boundingBoxCornerPoints=
function(a,b,c,e){a=b.getComponentAABB(c,a,I);b=b.getObjectTransform(c);for(c=0;8>c;++c)L[0]=c&1?a[0]:a[3],L[1]=c&2?a[1]:a[4],L[2]=c&4?a[2]:a[5],d.vec3.transformMat3(L,L,b.rotationScale),d.vec3.add(L,L,b.position),e[3*c]=L[0],e[3*c+1]=L[1],e[3*c+2]=L[2];return e};b.boundingBoxTop=function(a,b,c,e){a=b.getComponentAABB(c,a,I);b=b.getObjectTransform(c);e[0]=0;e[1]=0;for(c=e[2]=0;8>c;++c)L[0]=c&1?a[0]:a[3],L[1]=c&2?a[1]:a[4],L[2]=a[5],d.vec3.transformMat3(L,L,b.rotationScale),d.vec3.add(L,L,b.position),
e[0]+=L[0],e[1]+=L[1],e[2]+=L[2];e[0]/=8;e[1]/=8;e[2]/=8;return e};var I=c.create(),K=k.vec3f32.create(),H=e.vec2f32.create(),L=n.vec3f64.create()})},"esri/views/3d/support/GraphicsMap":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented","../../../core/iteratorUtils"],function(q,b,l,f,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._map=new Map;return b}l(b,a);b.prototype.clear=
function(){if(0<this._map.size){var a=this.toArray();this._map.clear();this.emit("change",{added:[],removed:a})}};Object.defineProperty(b.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0});b.prototype.get=function(a){return this._map.get(a)};b.prototype.addManyAndDeduplicate=function(a){if(0!==a.length){for(var b=new Set,d=0;d<a.length;d++){var c=a[d],e=c.objectId,f=this._map.get(e);f?(b.add(e),c!==f&&(a[d]=f),++f.refCount):(c.refCount=1,this._map.set(e,c))}a=
0<b.size?a.filter(function(a){return!b.has(a.objectId)}):a;this.emit("change",{added:a,removed:[]})}};b.prototype.removeMany=function(a){for(var b=[],d=0;d<a.length;d++){var c=a[d],e=c.objectId,f=this._map.get(e);null!=f&&0>=--f.refCount&&this._map.delete(e)&&b.push(c)}0<b.length&&this.emit("change",{added:[],removed:b})};b.prototype.removeManyObjectIds=function(a){for(var b=[],d=0;d<a.length;d++){var c=a[d],e=this._map.get(c);null!=e&&0>=--e.refCount&&this._map.delete(c)&&b.push(e)}0<b.length&&this.emit("change",
{added:[],removed:b})};b.prototype.toArray=function(){return h.valuesOfMap(this._map)};b.prototype.find=function(a){var b;h.someMap(this._map,function(d){return a(d)?(b=d,!0):!1});return b};b.prototype.forEach=function(a){this._map.forEach(function(b){return a(b)})};return b}(f);b.GraphicsMap=q})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf32 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/SpatialReference ../../../geometry/support/meshUtils/deduplicate ../../../libs/draco/DracoDecoder ./i3s/I3SBinaryReader ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ./i3s/I3SUtil ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B){function C(b,c,d,e){var f=H._malloc(4*b),g=c.GetAttribute(d,e);if(!c.GetAttributeFloatArrayForAllPoints(d,g,f,b))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:e});b=(new Float32Array(H.HEAPU8.buffer,f,b)).slice();H._free(f);return b}q=function(){function b(){}b.prototype.process=function(a){return f(this,void 0,void 0,function(){var c,d;return l(this,function(e){switch(e.label){case 0:return[4,b.ensureDracoDecoder(a)];
case 1:return e.sent(),c=[a.geometryBuffer],d=this.transform(a,c),[2,{result:d,transferList:c}]}})})};b.prototype.transform=function(b,c){var e,f,k;if(null==b.geometryIndex.header){var l=b.mbs,q=b.elevationOffset,r=p.fromJSON(b.indexSR),t=p.fromJSON(b.vertexSR),K=p.fromJSON(b.renderSR),L=y.computeGlobalTransformation(l,q,r,K),P=[],F=b.layouts[0],S=b.geometryBuffer,U=new H.DecoderBuffer;U.Init(new Int8Array(S),S.byteLength);var ea=new H.Decoder,ha=new H.Mesh,ka=ea.DecodeBufferToMesh(U,ha);if(!ka.ok())throw H.destroy(ha),
H.destroy(ea),H.destroy(U),new a("draco:decode_error","Error while decoding draco geometry",{message:ka.error_msg()});var ba=new H.DracoInt32Array,qa=new H.MetadataQuerier,ja=ea.GetAttributeIdByMetadataEntry(ha,"i3s-attribute-type","feature-index"),la=ea.GetAttributeMetadata(ha,ja);qa.GetIntEntryArray(la,"i3s-feature-ids",ba);var ma=ba.size(),ta=H._malloc(4*ma);if(!ba.GetArray(ta,ma))throw"GetArray failed";var ua=(new Uint32Array(H.HEAPU8.buffer,ta,ma)).slice();H._free(ta);var sa=ha.num_points(),
xa=3*ha.num_faces(),ra=65536>sa,ta=H._malloc(xa*(ra?2:4));if(ra?!ea.GetTrianglesUInt16Array(ha,ta,xa):!ea.GetTrianglesUInt32Array(ha,ta,xa))throw"GetTrianglesArray failed";var oa=ra?(new Uint16Array(H.HEAPU8.buffer,ta,xa)).slice():(new Uint32Array(H.HEAPU8.buffer,ta,xa)).slice();H._free(ta);var pa=H._malloc(4*sa),ia=ea.GetAttribute(ha,ja);if(!ea.GetAttributeUInt32ArrayForAllPoints(ha,ia,pa,sa))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:ja});var na=(new Uint32Array(H.HEAPU8.buffer,
pa,sa)).slice();H._free(pa);for(var ya=[],da=0;da<oa.length;++da){for(var Oa=oa[da],Ja=na[Oa];ya.length<=Ja;)ya.push([]);ya[Ja].push(Oa)}for(var Ma=0,z=new Uint32Array(ya.length+1),da=0;da<ya.length;++da){var tb=ya[da];z[da]=Ma;for(var Ca=0,Wa=tb;Ca<Wa.length;Ca++)Oa=Wa[Ca],oa[Ma++]=Oa}z[ya.length]=Ma;var jb=new Float32Array(F[0].stride/Float32Array.BYTES_PER_ELEMENT*sa),va=new B(jb,F,null,z,oa),bb=ea.GetAttributeId(ha,H.POSITION),Na=C(3*sa,ea,ha,bb),lb=va.getAttribute("position"),kb=ea.GetAttributeMetadata(ha,
bb),Xa=qa.GetDoubleEntry(kb,"i3s-scale_x"),Sa=qa.GetDoubleEntry(kb,"i3s-scale_y"),Xa=0>=Xa?1:Xa,Sa=0>=Sa?1:Sa,Va=va.getAttribute("color"),ub=ea.GetAttributeId(ha,H.COLOR),sb=-1!==ub,Rb;if(sb){var Gb=4*sa,Ab=H._malloc(Gb),Da=ea.GetAttribute(ha,ub);if(!ea.GetAttributeUInt8ArrayForAllPoints(ha,Da,Ab,Gb))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:ub});var lc=(new Uint8Array(H.HEAPU8.buffer,Ab,Gb)).slice();H._free(Ab);Rb=lc}else Rb=h.fill(Array(4*sa),255);for(var Ba=
Rb,Ia=0;Ia<sa;Ia++){var gb=Ia*lb.strideIdx+lb.offsetIdx;lb.data[gb]=Na[3*Ia]*Xa;lb.data[gb+1]=Na[3*Ia+1]*Sa;lb.data[gb+2]=Na[3*Ia+2];var Pa=Ia*Va.strideIdx+Va.offsetIdx;Va.data[Pa]=Ba[4*Ia];Va.data[Pa+1]=Ba[4*Ia+1];Va.data[Pa+2]=Ba[4*Ia+2];Va.data[Pa+3]=Ba[4*Ia+3]}var Nb=ea.GetAttributeId(ha,H.NORMAL);if(b.needNormals&&-1!==Nb){var Ob={normals:va.getAttribute("normalCompressed"),positions:va.getAttribute("position"),normalInd:va.getIndices("normalCompressed"),positionInd:va.getIndices("position")},
Ub=b.normalReferenceFrame,Wb=C(3*sa,ea,ha,Nb);v.processAndInterleaveNormals(Ub,Wb,L,Ob)}var fc=ea.GetAttributeId(ha,H.TEX_COORD),Cb=va.getAttribute("uv0");if(-1!==fc&&Cb)for(var Qa=C(2*sa,ea,ha,fc),Ia=0;Ia<sa;Ia++){var xb=Ia*Cb.strideIdx+Cb.offsetIdx;Cb.data[xb]=Qa[2*Ia];Cb.data[xb+1]=Qa[2*Ia+1]}var ab=ea.GetAttributeIdByMetadataEntry(ha,"i3s-attribute-type","uv-region"),Ua=va.getAttribute("uvRegion");if(-1!==ab&&Ua){var Sb=4*sa,Pb=H._malloc(2*Sb),Xb=ea.GetAttribute(ha,ab);if(!ea.GetAttributeUInt16ArrayForAllPoints(ha,
Xb,Pb,Sb))throw new a("draco:decode_error","Error while getting attribute values",{attributeId:ab});var yb=(new Uint16Array(H.HEAPU8.buffer,Pb,Sb)).slice();H._free(Pb);for(Ia=0;Ia<sa;Ia++)xb=Ia*Ua.strideIdx+Ua.offsetIdx,Ua.data[xb]=yb[4*Ia],Ua.data[xb+1]=yb[4*Ia+1],Ua.data[xb+2]=yb[4*Ia+2],Ua.data[xb+3]=yb[4*Ia+3]}H.destroy(qa);H.destroy(ba);H.destroy(ha);H.destroy(ea);H.destroy(U);d.mat4.invert(E,L);var Ib=va.getAttribute("position"),Jb={globalTrafo:L},Kb=jb.buffer;y.reprojectPoints(Ib,l,E,q,r,t,
K);var gc=v.extractPositionData(Kb,F,oa);P.push({layout:F,interleavedVertexData:Kb,indices:oa,corMatrices:Jb,hasColors:sb,positionData:gc});c&&(c.push(Kb),c.push(oa.buffer));k={geometryBuffer:S,componentOffsets:z,featureIds:ua,transformedGeometries:P,obb:null}}else{var hc=b.geometryData,Yb=b.geometryIndex,M=b.layouts,wa=b.mbs,Lb=b.elevationOffset,db=p.fromJSON(b.indexSR),zb=p.fromJSON(b.renderSR),ga=y.computeGlobalTransformation(wa,Lb,db,zb);d.mat4.invert(E,ga);var cb=b.geometryBuffer;hc.geometries[0].params.vertexAttributes=
Yb.vertexAttributes;var rc,sc,Cc=Yb.featureAttributes;if(Cc){if(Cc.faceRange){var wd=x.createTypedView(cb,Cc.faceRange);rc=m.convertFlatRangesToOffsets(wd,Cc.faceRange.count,Cc.faceRange.valuesPerElement)}var dc=Cc.id;if(dc){sc=new Uint32Array(dc.count);var Pc=1,gd=x.valueType2TypedArrayClassMap[dc.valueType];"UInt64"===dc.valueType&&(gd=Uint32Array,Pc=2);for(var hd=new gd(cb,dc.byteOffset,dc.count*dc.valuesPerElement*Pc),Tb=0;Tb<dc.count;Tb++){var Kc=Tb*dc.valuesPerElement*Pc;sc[Tb]=hd[Kc];if(2===
Pc&&0!==hd[Kc+1])throw Error("ID exceeded maximum range supported (2^32))");}}}e=rc;f=sc;c&&(f&&c.push(f.buffer),e&&c.push(e.buffer));var Mb=b.obb?null:w.create([0,0,0],[-1,-1,-1],[0,0,0,1]);g.vec3.copy(G,wa);G[2]+=Lb;g.vec3.copy(J,G);for(var tc=!1,Bc=0,uc=[],kc=0,Ac=hc.geometries;kc<Ac.length;kc++){var Lc=Ac[kc],Db=M[Bc];++Bc;var Mc=b.geometryBuffer,vc=v.interleaveGeometryBuffer(Lc,Mc,Db,[{name:"color",byteValue:255}],["normal","normalCompressed"]),ic=new B(new Float32Array(vc),Db),wc=ic.getAttribute("position"),
Vc=b.mbs,Nc=b.elevationOffset,$b=p.fromJSON(b.indexSR),Fc=p.fromJSON(b.vertexSR),jd=p.fromJSON(b.renderSR);y.reprojectPoints(wc,Vc,E,Nc,$b,Fc,jd);if(Mb){var Bb=Mb,Vb=wc,ec=ga;if(0<Bb.halfSize[0]){g.vec3.subtract(G,Bb.center,Bb.halfSize);g.vec3.add(J,Bb.center,Bb.halfSize);for(var mc=Vb.offsetIdx;mc<Vb.data.length;mc+=Vb.strideIdx)G[0]=Math.min(G[0],Vb.data[mc]),G[1]=Math.min(G[1],Vb.data[mc+1]),G[2]=Math.min(G[2],Vb.data[mc+2]),J[0]=Math.max(J[0],Vb.data[mc]),J[1]=Math.max(J[1],Vb.data[mc+1]),J[2]=
Math.max(J[2],Vb.data[mc+2]);g.vec3.subtract(Bb.halfSize,J,G);g.vec3.scale(Bb.halfSize,Bb.halfSize,.5);g.vec3.add(Bb.center,G,J);g.vec3.scale(Bb.center,Bb.center,.5)}else{w.compute(Vb,Bb);var Qc=2*Math.sqrt(1+ec[0]+ec[5]+ec[10]);I[0]=(ec[9]-ec[6])/Qc;I[1]=(ec[2]-ec[8])/Qc;I[2]=(ec[4]-ec[1])/Qc;I[3]=.25*Qc;n.quat.conjugate(I,I);n.quat.multiply(Bb.quaternion,I,Bb.quaternion)}}var xc=ic.getAttribute("normalCompressed");if(b.needNormals&&xc){var Wc={normals:xc,positions:wc,normalInd:ic.getIndices("normalCompressed"),
positionInd:ic.getIndices("position")},zd=b.normalReferenceFrame,Ad=x.createTypedView(Mc,Lc.params.vertexAttributes.normal);v.processAndInterleaveNormals(zd,Ad,ga,Wc)}var Ic=ic.getAttribute("color");if(Ic&&!tc)a:{for(var id=Ic.data,xd=Ic.size,yd=Ic.strideIdx,Ec=Ic.offsetIdx;Ec<id.length;Ec+=yd)for(var X=0;X<xd;X++)if(255!==id[Ec+X]){tc=!0;break a}tc=!1}var Jc={globalTrafo:ga},Ka=Db[0].stride,Aa=u.default(vc,Ka/4,{minReduction:1-.8*Ka/(Ka+4),componentOffsets:e});if(null!=Aa){var Fa=65536>Aa.uniqueCount?
new Uint16Array(Aa.indices):Aa.indices,Ga=v.extractPositionData(Aa.buffer,Db,Fa);uc.push({layout:Db,interleavedVertexData:Aa.buffer,indices:Fa,corMatrices:Jc,hasColors:tc,positionData:Ga});c&&(c.push(Aa.buffer),c.push(Fa.buffer),c.push(Ga.data.buffer),c.push(Ga.indices.buffer))}else Ga=v.extractPositionData(vc,Db),uc.push({layout:Db,interleavedVertexData:vc,corMatrices:Jc,hasColors:tc,positionData:Ga}),c&&(c.push(vc),c.push(Ga.data.buffer),c.push(Ga.indices.buffer));Mb&&(g.vec3.transformMat4(Mb.center,
Mb.center,ga),A.bufferToBuffer(Mb.center,jd,0,Mb.center,$b,0,1),Mb.center[2]-=Nc)}k={geometryBuffer:cb,componentOffsets:e,featureIds:f,transformedGeometries:uc,obb:Mb}}return k};return b}();(function(a){a.ensureDracoDecoder=function(a){if(H&&H.DecoderBuffer||a&&null!=a.geometryIndex.header)return e.resolve();K||(K=t.getDecoderModule().then(function(a){H=a;K=null;return H}));return K.then(function(){})}})(q||(q={}));var E=k.mat4f64.create(),G=r.vec3f64.create(),J=r.vec3f64.create(),I=c.quatf32.create(),
K,H;return q})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/projectionUtils ../../webgl-engine/lib/localOrigin".split(" "),function(q,b,l,f,h,a,e,d){function k(b,c,d){var e=h.vec3f64.create(),f=Math.ceil(Math.log(b[3])*Math.LOG2E/r),k=Math.pow(2,f*r+g),l;if(d.isGeographic){l=k/a.earthRadius*180/Math.PI;
d=Math.round(b[1]/l);var n=Math.max(-90,Math.min(90,d*l)),p=l/Math.cos((Math.abs(n)-l/2)/180*Math.PI);l=Math.round(b[0]/p);e[0]=l*p;e[1]=n}else l=Math.round(b[0]/k),d=Math.round(b[1]/k),e[0]=l*k,e[1]=d*k;b=Math.round((b[2]+c)/k);e[2]=b*k;return{center:e,id:f+"_"+l+"_"+d+"_"+b}}Object.defineProperty(b,"__esModule",{value:!0});var n=new Float64Array(3E3),c=h.vec3f64.create();b.computeGlobalTransformation=function(a,b,c,d){a=k(a,b,c).center;b=l.mat4f64.create();e.computeLinearTransformation(c,a,b,d);
return b};b.reprojectPoints=function(a,b,d,g,h,k,l){var m=a.data,p=a.offsetIdx;a=a.strideIdx;f.vec3.copy(c,b);c[2]+=g;b=[0,0,0];g=m.length/a;e.vectorToVector(c,h,b,k);for(h=0;h<g;h+=1E3){for(var q=Math.min(1E3,g-h),r=0;r<q;r++){var t=p+a*(h+r);n[3*r+0]=m[t+0]+b[0];n[3*r+1]=m[t+1]+b[1];n[3*r+2]=m[t+2]+b[2]}e.bufferToBuffer(n,k,0,n,l,0,q);for(r=0;r<q;r++){var t=n[3*r+0],u=n[3*r+1],v=n[3*r+2],x=p+a*(h+r);m[x+0]=d[0]*t+d[4]*u+d[8]*v+d[12];m[x+1]=d[1]*t+d[5]*u+d[9]*v+d[13];m[x+2]=d[2]*t+d[6]*u+d[10]*v+
d[14]}}};b.createOrigin=function(a,b,c,f){b=k(a,b,c);a=b.center;b=b.id;e.vectorToVector(a,c,a,f);return d.fromVector(a,b)};var g=1,r=5-g})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../../../core/arrayUtils"],function(q,b,l){var f=function(){return function(b){this.ids=new Set;this.paused=!1;this.options=b}}();return function(){function b(a){this.highlights=[];this.collection=a.collection;this.forAllFeatures=a.forAllFeatures;this.forAllFeaturesOfNode=a.forAllFeaturesOfNode}
b.prototype.destroy=function(){var a=this;this.highlights.forEach(function(b){return a.releaseSet(b)});this.highlights=null};b.prototype.acquireSet=function(a){var b=this,d=new f(a);this.highlights.push(d);return{set:d,handle:{remove:function(){b.releaseSet(d);l.removeUnordered(b.highlights,d)},pause:function(){b.releaseSet(d);d.paused=!0},resume:function(){d.paused=!1;b.initializeSet(d)}}}};b.prototype.setFeatureIds=function(a,b){b.forEach(function(b){return a.ids.add(b)});this.initializeSet(a)};
b.prototype.initializeSet=function(a){var b=this;this.forAllFeatures(function(d,e,f){a.ids.has(d)&&b.collection.addComponentHighlight(f.objectHandle,e);return 1})};b.prototype.releaseSet=function(a){var b=this;this.forAllFeatures(function(d,e,f){a.ids.has(d)&&b.collection.removeComponentHighlight(f.objectHandle,e);return 1})};b.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(d){d.paused||b.forAllFeaturesOfNode(a,function(e,f){d.ids.has(e)&&b.collection.addComponentHighlight(a.objectHandle,
f);return 1})})};b.prototype.objectDeleted=function(a){this.collection.clearHighlights(a.objectHandle)};return b}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p){var u=r.empty(),t=n.mat4f64.create(),x=g.vec3f64.create(),v=g.vec3f64.create(),y=g.vec3f64.create(),m={spatialReference:null,extent:u,context:"scene"},w=e.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(a){function b(b){return a.call(this,b)||this}l(b,a);b.prototype.initialize=function(){var a=this.layerView.view;this.view=a;this.renderCoordsHelper=a.renderCoordsHelper;this.intersector=new p(a.viewingMode);this.intersector.options.store=
0;a=this.layerView.layer.fullExtent;this.zmin=a.zmin;this.zmax=a.zmax};b.prototype.getElevation=function(a,b,d,e){x[0]=a;x[1]=b;x[2]=d;if(!this.renderCoordsHelper.toRenderCoords(x,e,x))return w.error("could not project point for elevation alignment"),null;b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;c.vec3.copy(v,x);c.vec3.copy(y,x);this.renderCoordsHelper.setAltitude(b,v);this.renderCoordsHelper.setAltitude(a,y);this.intersector.reset(v,y);this.intersectionHandler.intersect(this.intersector,
null,v,y);return this.intersector.results.min.getIntersectionPoint(x)?this.renderCoordsHelper.getAltitude(x):null};b.prototype.layerChanged=function(){this.spatialReference&&(m.extent=this.computeLayerExtent(),m.spatialReference=this.spatialReference,this.emit("elevation-change",m))};b.prototype.objectChanged=function(a){this.spatialReference&&(m.extent=this.computeObjectExtent(a),m.spatialReference=this.spatialReference,this.emit("elevation-change",m))};b.prototype.computeObjectExtent=function(a){r.empty(u);
this.expandExtent(a,u);return u};b.prototype.computeLayerExtent=function(){r.empty(u);for(var a=0,b=this.layerView.getLoadedNodes();a<b.length;a++)this.expandExtent(b[a],u);return u};b.prototype.expandExtent=function(a,b){var d=a.renderObb;if(d)for(k.mat4.fromQuat(t,d.quaternion),t[12]=d.center[0],t[13]=d.center[1],t[14]=d.center[2],a=0;8>a;++a)x[0]=a&1?d.halfSize[0]:-d.halfSize[0],x[1]=a&2?d.halfSize[1]:-d.halfSize[1],x[2]=a&4?d.halfSize[2]:-d.halfSize[2],c.vec3.transformMat4(x,x,t),this.renderCoordsHelper.fromRenderCoords(x,
x,this.spatialReference),r.expand(b,x);else if(a.renderMbs){var e=a.renderMbs[3],d=c.vec3.copy(v,a.renderMbs);d[0]-=e;d[1]-=e;d[2]-=e;var f=c.vec3.copy(y,a.renderMbs);f[0]+=e;f[1]+=e;f[2]+=e;for(a=0;8>a;++a)x[0]=a&1?d[0]:f[0],x[1]=a&2?d[1]:f[1],x[2]=a&4?d[2]:f[2],this.renderCoordsHelper.fromRenderCoords(x,x,this.spatialReference),r.expand(b,x)}return b};f([d.property({constructOnly:!0})],b.prototype,"layerView",void 0);f([d.property({constructOnly:!0})],b.prototype,"intersectionHandler",void 0);f([d.property()],
b.prototype,"view",void 0);f([d.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],b.prototype,"spatialReference",void 0);return b=f([d.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)}(d.declared(a.EventedMixin(h)))})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/vec3 ../../support/orientedBoundingBox ../../webgl-engine/lib/intersectorUtils".split(" "),function(q,
b,l,f,h,a){function e(a,b,e,c){void 0===c&&(c=0);c=a[3]+c;var d=b[0]-a[0],f=b[1]-a[1];a=b[2]-a[2];b=e[0];var h=e[1];e=e[2];var k=b*d+h*f+e*a;return 0<=k*k-(b*b+h*h+e*e)*(d*d+f*f+a*a-c*c)}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.type="I3S";this.layerUid=a.layerUid;this.sublayerUid=a.sublayerUid;this.collection=a.collection;this.forEach=a.forEach;this.slicePlane=a.slicePlaneEnabled;this.intersectionHandlerId=this.layerUid}b.prototype.intersect=function(b,d,c,
g){var k=this,n=b.results,q=2===b.options.store,t=b.ray.direction,x=b.tolerance,v=function(a){return a},y=function(a){return a},m=l.isSome(b.options.verticalOffset)?b.options.verticalOffset.i3s:null;l.isSome(m)&&(v=function(a){return m.applyToMbs(a)},y=function(a){return m.applyToObb(a)});this.forEach(function(l,p){l.renderMbs&&!e(v(l.renderMbs),c,t,x)||l.renderObb&&!h.intersectLine(y(l.renderObb),c,t,x)||k.collection.intersect(p,c,g,x,m,function(e,h,m,p){if(0<=h&&(null==d||d(c,g,h))){var r=function(a){a.intersector=
k.type;a.target={type:"external",metadata:{layerUid:k.layerUid,sublayerUid:k.sublayerUid,nodeIndex:l.index,componentIndex:e}};a.dist=h;f.vec3.copy(a.normal,m);a.triangleNr=p};(null==n.min.dist||h<n.min.dist)&&r(n.min);(null==n.max.dist||h>n.max.dist)&&r(n.max);if(q){var t=new a.IntersectorResult(b.ray);r(t);b.results.all.push(t)}}})})};return b}();b.I3SIntersectionHandler=q})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/maybe",
"../../../../core/promiseUtils"],function(q,b,l,f,h){function a(a){return h.create(function(b,d){a.oncomplete=function(){return b()};a.onerror=function(){return d(a.error)};a.onabort=function(){return d(a.error)}})}function e(a){return h.create(function(b,d){"done"===a.readyState?null!=a.error?d(a.error):b(a.result):(a.onsuccess=function(){return b(a.result)},a.onerror=function(){return d(a.error)})})}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,b,c){void 0===c&&(c=14);
this._version=c;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=b}b.prototype.init=function(){var a=this;return h.resolve().then(function(){var b=indexedDB.open(a._dbName,a._version);b.onupgradeneeded=function(c){var d=b.result,e=b.transaction,f=d.objectStoreNames.contains(a._storeName)?e.objectStore(a._storeName):d.createObjectStore(a._storeName),
d=d.objectStoreNames.contains("last_access")?e.objectStore("last_access"):d.createObjectStore("last_access");d.indexNames.contains("date")||d.createIndex("date","date",{unique:!1});d.indexNames.contains("byteSize")||d.createIndex("byteSize","byteSize",{unique:!1});c.oldVersion<a._version&&(f.clear(),d.clear())};return e(b)}).then(function(b){a._destroyed?b.close():a._db=b})};b.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};Object.defineProperty(b.prototype,
"initialized",{get:function(){return null!=this._db},enumerable:!0,configurable:!0});b.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};b.prototype.put=function(a,b){var c=this;return null==this._db?h.reject(new l("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:h.resolve()).then(function(){return c._put(a,b)}).catch(function(d){if(d&&"QuotaExceededError"===d.name)return null==c._quotaReductionPromise&&
(c._quotaReductionPromise=c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(b.byteSize+Math.ceil(a*c.quotaReductionFactor))}),c._quotaReductionPromise.then(function(){return c._quotaReductionPromise=null},function(){return c._quotaReductionPromise=null})),c._quotaReductionPromise.then(function(){return c._put(a,b)});throw d;}).then(function(){c._gcCounter--;0>c._gcCounter&&null!=c._db&&(c._gcCounter=c.gcFrequency,c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(a-
c.maxByteSize)}))})};b.prototype.get=function(a,b){var c=this;if(null==this._db)return h.resolve(null);var d=null;return h.resolve().then(function(){var f=c._db.transaction(c._storeName,"readonly");d=h.onAbort(b,function(){f.abort()});var g=f.objectStore(c._storeName).get(a);return e(g)}).then(function(b){null==b?++c._miss:c._db&&(++c._hit,c._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:b.byteSize},a));f.isSome(d)&&d.remove();return b}).catch(function(){++c._miss;
h.throwIfAborted(b);f.isSome(d)&&d.remove();return null})};b.prototype.remove=function(b){var d=this;return null==this._db?h.resolve():h.resolve().then(function(){var c=d._db.transaction([d._storeName,"last_access"],"readwrite"),f=c.objectStore(d._storeName),k=c.objectStore("last_access"),f=f.delete(b),k=k.delete(b);return h.all([e(f),e(k),a(c)])})};b.prototype._put=function(b,d){var c=this._db.transaction([this._storeName,"last_access"],"readwrite"),f=c.objectStore(this._storeName),k=c.objectStore("last_access"),
f=f.put(d,b);b=k.put({date:Date.now(),byteSize:d.byteSize},b);return h.all([e(f),e(b),a(c)])};b.prototype._removeLeastRecentlyAccessed=function(b){if(!(0>=b)){var d=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=d.objectStore(this._storeName),e=d.objectStore("last_access"),f=0,h=e.index("date").openCursor(null,"next");h.onsuccess=function(){var a=h.result;null!=a&&(null!=a.value.byteSize&&(f+=a.value.byteSize),c.delete(a.primaryKey),e.delete(a.primaryKey),f<b&&a.continue())};
return a(d)}};b.prototype._getCacheSize=function(){var b=this._db.transaction("last_access"),d=0,c=b.objectStore("last_access").index("byteSize").openKeyCursor();c.onsuccess=function(){var a=c.result;if(a){var b=a.key;null!=b&&(d+=b);a.continue()}};return a(b).then(function(){return d})};return b}();b.IDBCache=q;b.whenTransaction=a;b.whenRequest=e})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["require","exports","../../../../../core/maybe"],function(q,b,l){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(b,a){var e=this;this._textureRep=b;this._textureId=a;this._textureRef=l.applySome(this._textureId,function(a){return e._textureRep.acquire(a)})}b.prototype.dispose=function(){var b=this;this._textureRef=l.applySome(this._textureId,function(a){b._textureRep.release(a)})};b.prototype.bind=function(b,a,e,d,f){l.isSome(this._textureRef)&&(a.setUniform1i(e,d),b.bindTexture(this._textureRef.glTexture,d),f&&(b=this._textureRef.glTexture,a.setUniform2f(f,b.descriptor.width,
b.descriptor.height)))};return b}();b.RenderTexture=q})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u){Object.defineProperty(b,"__esModule",{value:!0});var t=r.default;q=function(b){function e(a){a=b.call(this,a)||this;a._dataQueryEngineInstance=null;a._handles=new k;return a}f(e,b);Object.defineProperty(e.prototype,"defaultQueryJSON",{get:function(){return(new u({outSpatialReference:this.spatialReference})).toJSON()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,
configurable:!0});e.prototype.initialize=function(){var a=this;this._handles.add(this.layerView.on("visible-geometry-changed",function(){return a.spatialIndex.events.emit("changed")}))};e.prototype.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&(this._handles.destroy(),this._handles=null);this._set("layerView",null)};e.prototype.executeQueryForCount=function(b,c){return a(this,void 0,void 0,function(){return h(this,
function(a){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(b),c)]})})};e.prototype.executeQueryForExtent=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f;return h(this,function(h){switch(h.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(b),c)];case 1:return a=h.sent(),d=a.count,e=a.extent,f=g.fromJSON(e),[2,{count:d,extent:f}]}})})};e.prototype.executeQueryForIds=function(b,c){return a(this,void 0,void 0,function(){return h(this,
function(a){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(b),c)]})})};e.prototype.executeQuery=function(b,c){return a(this,void 0,void 0,function(){var a,e,f,g=this;return h(this,function(h){switch(h.label){case 0:a=this._ensureQueryJSON(b);if(a.returnGeometry)throw new d("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(a.returnCentroid)throw new d("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");
return[4,this.dataQueryEngine.executeQuery(a,c)];case 1:return e=h.sent(),f=p.fromJSON(e),f.features.forEach(function(a){a.geometry=null;a.layer=g.layer;a.sourceLayer=g.layer}),[2,f]}})})};e.prototype._ensureQueryJSON=function(a){if(n.isNone(a))return this.defaultQueryJSON;var b=a.toJSON();b.outSpatialReference||(a.outSpatialReference=this.spatialReference);return b};e.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var a=this.layer.objectIdField||
"OBJECTID",b=this.layer.fields.map(function(a){return a.toJSON()}),c=this.layerView.view.resourceController.scheduler,d=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new t({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:d,objectIdField:a,featureStore:this.spatialIndex,scheduler:c,task:this.task})};l([c.property({constructOnly:!0})],e.prototype,"layerView",void 0);l([c.property({constructOnly:!0})],e.prototype,"task",void 0);l([c.property({constructOnly:!0})],
e.prototype,"spatialIndex",void 0);l([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],e.prototype,"spatialReference",void 0);l([c.property({readOnly:!0,aliasOf:"layerView.layer"})],e.prototype,"layer",void 0);l([c.property({readOnly:!0,dependsOn:["spatialReference"]})],e.prototype,"defaultQueryJSON",null);return e=l([c.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],e)}(c.declared(e));b.I3SQueryEngine=q;b.default=q})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("require exports ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(q,b,l,f,h,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.objectIdField=a.objectIdField;this.getFeatureExtent=a.getFeatureExtent}b.prototype.getObjectId=function(a){return a.id};b.prototype.getAttributes=function(b){var d=b.meta,c=b.index,e={};this.objectIdField&&(e[this.objectIdField]=b.id);b=d.attributeInfo.attributeData;if(null!=b)for(var d=0,f=Object.keys(b);d<f.length;d++){var h=f[d];e[h]=a.getCachedAttributeValue(b[h],c)}return e};b.prototype.getAttribute=
function(b,d){if(d===this.objectIdField)return b.id;var c=b.meta.attributeInfo.attributeData;return null==c?null:a.getCachedAttributeValue(c[d],b.index)};b.prototype.getGeometry=function(a){if(a.geometry)return a.geometry;var b=this.getFeatureExtent(a,e);a=b[0];var c=b[1],d=b[2],f=b[3],b=b[4];return new h.default([5],[a,c,d,f,c,d,f,b,d,a,b,d,a,c,d])};b.prototype.getCentroid=function(a,b){if(a.geometry)return f.getCentroidOptimizedGeometry(new h.default,a.geometry,b.hasZ,b.hasM);a=this.getFeatureExtent(a,
e);return new h.default([0],[(a[0]+a[3])/2,(a[1]+a[4])/2,(a[2]+a[5])/2])};b.prototype.cloneWithGeometry=function(a,b){return{id:a.id,index:a.index,meta:a.meta,geometry:b}};return b}();b.I3SQueryFeatureAdapter=q;var e=l.create()})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../support/projectionUtils".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(c){c=b.call(this,c)||this;c.events=new a;return c}l(d,b);d.prototype.destroy=function(){};d.prototype.forEach=function(a){this.forAllFeatures(function(b){a(b);return 1})};d.prototype.forEachBounds=function(a,b,c){for(var d=this.getFeatureExtent,e=0;e<a.length;e++)b(d(a[e],c))};d.prototype.forEachInBounds=function(a,b){var d=this;this.forAllFeatures(function(c){var e=d.getFeatureExtent(c,r);n.intersects(a,
k.toRect(e,p))&&b(c);return 1},function(b){c.mbsToMbs(b.node.mbs,d.sourceSpatialReference,g,d.viewSpatialReference);if(g[0]>=a[0]&&g[2]<=a[2]&&g[1]>=a[1]&&g[3]<=a[3])return 1;b=g[0]-Math.max(a[0],Math.min(g[0],a[2]));var e=g[1]-Math.max(a[1],Math.min(g[1],a[3]));return b*b+e*e<=g[3]*g[3]?1:2})};f([e.property({constructOnly:!0})],d.prototype,"featureAdapter",void 0);f([e.property({constructOnly:!0})],d.prototype,"forAllFeatures",void 0);f([e.property({constructOnly:!0})],d.prototype,"getFeatureExtent",
void 0);f([e.property({constructOnly:!0})],d.prototype,"sourceSpatialReference",void 0);f([e.property({constructOnly:!0})],d.prototype,"viewSpatialReference",void 0);return d=f([e.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],d)}(e.declared(h));b.I3SQueryFeatureStore=q;var g=d.vec4f64.create(),r=k.create(),p=n.create();b.default=q})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(q,b,l,f,h,a,e,d){Object.defineProperty(b,"__esModule",{value:!0});var k=h.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");b.DefinitionExpressionSceneLayerView=function(b){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;a.logError=function(b){a._definitionExpressionErrors<a._maxDefinitionExpressionErrors&&k.error("Error while evaluating definitionExpression: "+b);
a._definitionExpressionErrors++;a._definitionExpressionErrors===a._maxDefinitionExpressionErrors&&k.error("Further errors are ignored")};return a}l(c,b);Object.defineProperty(c.prototype,"parsedDefinitionExpression",{get:function(){if(!this.layer||!this.layer.definitionExpression)return null;try{var a=e.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!a.isStandardized)return k.error("definitionExpression is using non standard function"),null;var b=[];d.findFieldsCaseInsensitive(a.fieldNames,
this.layer.fields,{missingFields:b});if(0<b.length)return k.error("definitionExpression references unknown fields: "+b.join(", ")),null;this._definitionExpressionErrors=0;return a}catch(u){return k.error("Failed to parse definitionExpression: "+u),null}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0});c.prototype._evaluateClause=
function(a,b){try{return a.testFeature(b)}catch(u){return this.logError(u),!1}};c.prototype._addDefinitionExpressionToQuery=function(a){if(!this.parsedDefinitionExpression)return a;var b=this.layer.definitionExpression;a=a.clone();a.where=a.where?"("+b+") AND ("+a.where+")":b;return a};f([a.property()],c.prototype,"layer",void 0);f([a.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],c.prototype,"parsedDefinitionExpression",null);f([a.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],
c.prototype,"definitionExpressionFields",null);return c=f([a.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],c)}(a.declared(b))}})},"esri/views/3d/layers/support/fieldProperties":function(){define(["require","exports","../../../../layers/support/fieldUtils"],function(q,b,l){Object.defineProperty(b,"__esModule",{value:!0});b.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields",
"layer.outFields","requiredFields"],get:function(){var b=this.layer,h=this.layer.fields,a=this.requiredFields;return b.outFields?l.fixFields(h,l.unpackFieldNames(h,b.outFields).concat(a)):l.fixFields(h,a)}}}}})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/assignHelper ../../../Graphic ../../../core/arrayUtils ../../../core/iteratorUtils ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../renderers/support/renderingInfoUtils ../../../tasks/support/Query ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./graphics/QueryEngine ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../../3d/support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/projectionUtils ../../layers/LayerView ../../layers/support/FeatureFilter ../../support/Scheduler @dojo/framework/shim/Promise".split(" "),
function(q,b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z){function W(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].graphics;d<e.length;d++){var f=e[d];f.attributes||(f.attributes={});if(b&&b.loadedAttributes)for(var g=0,h=b.loadedAttributes;g<h.length;g++){var k=h[g].name;b.attributeData[k]&&(f.attributes[k]=K.getCachedAttributeValue(b.attributeData[k],c))}}}var aa=c.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),V=L.defineFieldProperties();b=function(b){function c(a){a=
b.call(this,a)||this;a._nodesAddedToStage=new Map;a.supportsDraping=!0;a._queryEngine=null;a._memCache=null;a.loadedGraphics=new O.GraphicsMap;a.progressiveLoadFactor=1;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;return a}l(c,b);c.prototype.initialize=function(){var a=this;K.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);for(var b=0,c=["layer.renderer","layer.labelingInfo","layer.labelsVisible",
"definitionExpressionFields","filter"];b<c.length;b++)this.updatingHandles.add(this,c[b],function(){return a._updateRequiredFields()});this.updatingHandles.add(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)},2);this.updatingHandles.add(this.layer,"renderer",function(b,c){return a._rendererChange(b,c)});this.updatingHandles.add(this,"layer.objectIdFilter",function(){return a._filterChange()});this.updatingHandles.add(this,"parsedDefinitionExpression",function(){return a._filterChange()});
this.handles.add(p.init(R,"I3S_TREE_SHOW_TILES",function(b){if(b&&!a._treeDebugger){var c=a._controller.crsIndex;(new Promise(function(a,b){q(["./support/I3STreeDebugger"],a,b)})).then(function(b){b=b.I3STreeDebugger;!a._treeDebugger&&R.I3S_TREE_SHOW_TILES&&(a._treeDebugger=new b({lv:a,view:a.view,nodeSR:c}))})}else b||!a._treeDebugger||R.I3S_TREE_SHOW_TILES||(a._treeDebugger.destroy(),a._treeDebugger=null)}));this._updateRequiredFields();this._set("graphics3d",new G({owner:this,layer:this.layer,
preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)}}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(b){return a._invalidateElevation(b.extent,b.spatialReference)});
this.supportsHeightUnitConversion&&(this._verticalScale=new J({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid);this._controller=new w({layerView:this,scaleVisibilityEnabled:!1});this.when(function(){a._queryEngine=new I.default({layerView:a,task:Z.Task.FEATURE_QUERY_ENGINE});a.updatingHandles.add(a,"maximumNumberOfFeatures",
function(b){return a._controller.featureTarget=b},2);a.updatingHandles.add(a,"suspended",function(b){b&&a._removeAllNodeData()})})};c.prototype.destroy=function(){this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null);this._memCache.destroy();this._nodesAddedToStage=
this._memCache=null};Object.defineProperty(c.prototype,"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasM",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasZ",{get:function(){return!0},enumerable:!0,configurable:!0});c.prototype.whenGraphicAttributes=function(b,c){return a(this,void 0,void 0,function(){var a,d=this;return h(this,function(e){a=function(a){for(var b=
new Map,c=[],e=0;e<a.length;e++){var f=a[e],g=d._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},c.push(h));h.indices.push(g.index);h.graphics.push(f)}return c};return[2,K.whenGraphicAttributes(this.layer,b,this._getObjectIdField(),c,a,{populateObjectId:!0})]})})};c.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return null;var b=m.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),this.layer),c=this._getObjectIdField();
if(!b||!b.attributes||!b.attributes[c])return null;b.layer=this.layer;b.sourceLayer=this.layer;return b};c.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};c.prototype.computeAttachmentOrigin=function(a,b){return this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b)};c.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};c.prototype.isUpdating=function(){return!!(this._controller&&
this._controller.updating||this.graphics3d&&this.graphics3d.updating)};c.prototype.getRenderingInfo=function(a,b,c){(a=B.getRenderingInfo(a,{renderer:b,arcade:c}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};c.prototype.getRenderingInfoAsync=function(b,c,d,f){return a(this,void 0,void 0,function(){return h(this,function(a){return[2,B.getRenderingInfoAsync(b,e({renderer:c,arcade:d},f))]})})};Object.defineProperty(c.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},
enumerable:!0,configurable:!0});c.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=k.keysOfMap(this._nodesAddedToStage);b<c.length;b++){var d=this._nodesAddedToStage.get(c[b]),e=this._findGraphicIndex(d.bundle,a);if(0<=e)return{node:d.node,index:e}}return null};c.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};c.prototype.highlight=function(a,b){void 0===
b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};c.prototype.addNodeData=function(a,b){if(this._nodesAddedToStage.has(a.index))aa.error("I3S node "+a.id+" already added");else{var c=b.allGeometryData,e=b.attributeDataInfo;b=this._controller.crsIndex;var f=this._controller.crsVertex,h=this.view.spatialReference,k=[0,0,0],l=this._getObjectIdField(),n=[],p;if(p=this.layer.fullExtent)p=this.layer.fullExtent.clone(),p.xmin-=.5,p.ymin-=.5,p.xmax+=.5,p.ymax+=.5,p.hasZ&&(p.zmin-=
.5,p.zmax+=.5),p.hasM&&(p.mmin-=.5,p.mmax+=.5);var q=p;p=[];for(var t=[],u=0;u<c.length;u++){var v=c[u],w=v.featureDataPosition,x=w.length,A=v.geometries||[F[x]],B=v.featureIds;q&&!y.extentContainsCoords3D(q,w)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&aa.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&aa.error("Maximum number of errors reached. Further errors are ignored."),
this._coordinatesOutsideExtentErrors++);for(var z=0;z<A.length;z++){var C=A[z];if("points"===C.params.type){var E=[],G=B[z<B.length?z:0],H={};null!=G&&(H[l]=G);var G=null==G?d.generateUID():G,I=void 0;"Embedded"===C.type&&(I=C.params.vertexAttributes.position);for(C=0;C<I.length;C+=x){for(var J=0;J<x;J++)k[J]=w[J]+I[C+J];J=3===x;a.obb||t.push(k[0],k[1],J?k[2]:0);T.bufferToBuffer(k,f,0,ca,h,0,1);var J=m.makeDehydratedPoint(ca[0],ca[1],J?ca[2]:void 0,h),K=this.loadedGraphics.get(G);g.isSome(K)?E.push(K):
E.push({objectId:G,uid:d.generateUID(),geometry:J,attributes:H,visible:!0})}p.push.apply(p,E);n.push({featureIds:v.featureIds,graphics:E})}}}a.numFeatures=p.length;this._updateNodeMemory(a);c={bundle:n,attributeInfo:e,node:a};W(c.bundle,c.attributeInfo);0<t.length&&(e=b.isGeographic?this.view.renderSpatialReference:b,T.bufferToBuffer(t,f,0,t,e,0,t.length/3),a.obb=Q.compute({data:t,size:3,offsetIdx:0,strideIdx:3}),b.isGeographic&&T.vectorToVector(a.obb.center,e,a.obb.center,b),this._controller.updateVisibility(a.index));
if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(c),r.resolve();this._verticalScale&&this._verticalScale.adjust(p);this._nodesAddedToStage.set(a.index,c);this.loadedGraphics.addManyAndDeduplicate(p);this._filterNode(c);this._treeDebugger&&this._treeDebugger.update();return r.resolve()}};c.prototype.isNodeLoaded=function(a){return this._nodesAddedToStage.has(a)};c.prototype._updateNodeMemory=function(a){a.memory=4096+a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic};
c.prototype._cacheNodeData=function(a){var b=a.bundle.reduce(function(a,b){return b.graphics.reduce(function(a,b){return m.estimateSize(b)+a},512+8*b.featureIds.length+a)},1024);this._memCache.put(this._getMemCacheKey(a.node),a,b)};c.prototype._getMemCacheKey=function(a){return""+a.index};c.prototype._removeAllNodeData=function(){var a=this;this._nodesAddedToStage.forEach(function(b){b&&(a._updateNodeMemory(b.node),a._cacheNodeData(b))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();
this.loadedGraphics.clear()};c.prototype.removeNodeData=function(a,b){for(;0<a.length&&!b.done;){var c=a.pop();if(c=this._removeNodeStageData(c))this._updateNodeMemory(c.node),this._cacheNodeData(c);b.madeProgress()}};c.prototype._removeNodeStageData=function(a){var b=this._nodesAddedToStage.get(a);if(!b)return null;for(var c=0,d=b.bundle;c<d.length;c++)this.loadedGraphics.removeMany(d[c].graphics);this._nodesAddedToStage.delete(a);this._treeDebugger&&this._treeDebugger.update();return b};c.prototype.loadCachedNodeData=
function(a){return r.resolve(this._memCache.pop(this._getMemCacheKey(a)))};c.prototype.addCachedNodeData=function(a,b,c){if(this._nodesAddedToStage.has(a.index))aa.error("I3S node "+a.id+" already added");else{for(var d=0,e=b.bundle;d<e.length;d++)this.loadedGraphics.addManyAndDeduplicate(e[d].graphics);this._nodesAddedToStage.set(a.index,b);this._updateNodeMemory(a);this.setAttributeData(a.index,c);this._filterNode(b);this._treeDebugger&&this._treeDebugger.update();return r.resolve()}};c.prototype.getLoadedNodeIds=
function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node.id)});return a.sort()};c.prototype.getLoadedNodes=function(){var a=[];this._nodesAddedToStage.forEach(function(b){return a.push(b.node)});return a};c.prototype.getLoadedNodeIndices=function(a){this._nodesAddedToStage.forEach(function(b,c){return a.push(c)})};c.prototype.getLoadedAttributes=function(a){if((a=this._nodesAddedToStage.get(a))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};c.prototype.getAttributeData=
function(a){if((a=this._nodesAddedToStage.get(a))&&a.attributeInfo)return a.attributeInfo.attributeData};c.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage.get(a))a.attributeInfo=b,W(a.bundle,b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};c.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);
return!1};c.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};c.prototype._rendererChange=function(b,c){return a(this,void 0,void 0,function(){var a,d,e,f;return h(this,function(g){switch(g.label){case 0:return a=this.layer.fields,d=new Set,b?[4,b.collectRequiredFields(d,a)]:[3,2];case 1:return g.sent(),e=n.valuesOfSet(d).sort(),[3,3];case 2:e=[],g.label=3;case 3:return d.clear(),c?[4,c.collectRequiredFields(d,a)]:[3,5];case 4:return g.sent(),f=n.valuesOfSet(d).sort(),
[3,6];case 5:f=[],g.label=6;case 6:if(e.length===f.length&&e.every(function(a,b){return e[b]===f[b]}))return[2];this._reloadAllNodes();return[2]}})})};c.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&aa.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};c.prototype._filterChange=function(){var a=this;this._nodesAddedToStage.forEach(function(b){return a._filterNode(b)})};c.prototype._reloadAllNodes=function(){this._removeAllNodeData();
this._controller&&this._controller.restartNodeLoading()};c.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;
m!==l.visible&&(U.graphic=l,U.property="visible",U.oldValue=m,U.newValue=l.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(U))}};c.prototype._updateRequiredFields=function(){return a(this,void 0,void 0,function(){var a,b,c,d,e,f,k,l,m;return h(this,function(h){switch(h.label){case 0:return a=this,c=b=a.layer,d=c.fields,e=c.renderer,f=c.labelsVisible,k=a.filter,l=a.definitionExpressionFields,m=new Set,e?[4,e.collectRequiredFields(m,d)]:[3,2];case 1:h.sent(),h.label=2;case 2:return f?[4,A.collectLabelingFields(m,
b)]:[3,4];case 3:h.sent(),h.label=4;case 4:return g.isSome(k)?[4,A.collectFilterFields(m,b,k)]:[3,6];case 5:h.sent(),h.label=6;case 6:return A.collectFields(m,d,l),this._set("requiredFields",n.valuesOfSet(m).sort()),[2]}})})};c.prototype._invalidateElevation=function(a,b){var c=this._controller.crsIndex;T.boundingRectToBoundingRect(a,b,ha,c);a=ea;x.fromRect(a,ha);a[2]=-Infinity;a[5]=Infinity;this._controller.updateElevationChanged(a,c)};c.prototype.createQuery=function(){var a={outFields:["*"],returnGeometry:!0,
outSpatialReference:this.view.spatialReference};return g.isSome(this.filter)?this.filter.createQuery(a):new C(a)};c.prototype.queryFeatures=function(a,b){return this._queryEngine.executeQuery(this._ensureQuery(a),b&&b.signal)};c.prototype.queryObjectIds=function(a,b){return this._queryEngine.executeQueryForIds(this._ensureQuery(a),b&&b.signal)};c.prototype.queryFeatureCount=function(a,b){return this._queryEngine.executeQueryForCount(this._ensureQuery(a),b&&b.signal)};c.prototype.queryExtent=function(a,
b){return this._queryEngine.executeQueryForExtent(this._ensureQuery(a),b&&b.signal)};c.prototype._ensureQuery=function(a){return this._addDefinitionExpressionToQuery(g.isNone(a)?this.createQuery():C.from(a))};c.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?a.usedMemory:0};c.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:
0))};c.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};c.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size};c.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length};c.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.nodes=this.getNumberOfNodes();a.features=this.loadedGraphics.length;this._controller&&this._controller.updateStats(a);return a};f([u.property()],c.prototype,
"graphics3d",void 0);f([u.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],c.prototype,"hasDraped",void 0);f([u.property({type:Boolean})],c.prototype,"supportsDraping",void 0);f([u.property({type:N})],c.prototype,"filter",void 0);f([u.property()],c.prototype,"loadedGraphics",void 0);f([u.property()],c.prototype,"layer",void 0);f([u.property()],c.prototype,"_controller",void 0);f([u.property({dependsOn:["_controller.updating","graphics3d.updating"]})],c.prototype,"updating",void 0);f([u.property({dependsOn:["_controller.rootNodeVisible"]})],
c.prototype,"suspended",void 0);f([u.property(P.updatingProgress)],c.prototype,"updatingProgress",void 0);f([u.property({aliasOf:"_controller.updatingProgress"})],c.prototype,"updatingProgressValue",void 0);f([u.property(V.requiredFields)],c.prototype,"requiredFields",void 0);f([u.property(V.availableFields)],c.prototype,"availableFields",void 0);f([u.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],c.prototype,"maximumNumberOfFeatures",null);f([u.property({readOnly:!0,
dependsOn:["suspended","_controller.leafsReached"]})],c.prototype,"maximumNumberOfFeaturesExceeded",null);f([u.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],c.prototype,"lodFactor",void 0);f([u.property({readOnly:!0})],c.prototype,"hasM",null);f([u.property({readOnly:!0})],c.prototype,"hasZ",null);return c=f([u.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],c)}(u.declared(H.DefinitionExpressionSceneLayerView(S.PopupSceneLayerView(E.LayerView3D(Y)))));
var F={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ca=t.vec3f64.create(),U={graphic:null,property:null,oldValue:null,newValue:null},ea=x.create(),ha=v.create();return b})},"*now":function(q){q(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","bs","ca","cs","da","de","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../layers/support/layerUtils ../support/arcadeOnDemand ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/MemoryManagedLayerView ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/screenshotUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment @dojo/framework/shim/Promise".split(" "),function(q,
b,l,f,h,a,e,d,k,n,c,g,r,p,u,t,x,v,y,m,w,A,B,C,E,G,J,I,K,H,L,P,S,R,O,Q,T,Y,N,Z,W,aa,V,F,ca,U,ea,ha,ka,ba,qa,ja,la,ma,ta,ua,sa,xa,ra,oa,pa,ia,na,ya,da,Oa,Ja,Ma,z,tb,Ca,Wa,jb,va,bb){function Na(a,b){a.layerUids||(a.layerUids=new Set);a.layerUids.add(b)}function lb(a,b){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(b)}function kb(a){return 1099511627776<=a?Math.round(a/1099511627776)+"TB":1073741824<=a?Math.round(a/1073741824)+"GB":1048576<=a?Math.round(a/1048576)+"MB":1024<=a?Math.round(a/
1024)+"KB":a.toFixed(0)+"B"}var Xa=v.getLogger("esri.views.SceneView");b=function(b){function e(c){var d=b.call(this,c)||this;d._clippingArea=null;d._userClippingArea=null;d._initialDefaultSpatialReference=null;d._defaults={};d._externallySet={environment:!1};d._createGraphicsViewController=null;d._resolveWhenReady=[];d.propertiesPool=new oa.default({slicePlane:ya.BoundedPlaneClass},d);d._resourceController=sa.newResourceController(d);d._defaultToMapOptions={include:new Set};d._defaultHitTestOptions=
{exclude:new Set};d.deconflictor=new F.Deconflictor({view:d});d.labeler=new ca.Labeler({view:d});d.sharedSymbolResources=null;d.basemapTerrain=null;d.elevationProvider=null;d.camera=null;d.canvas=null;d.center=null;d.constraints=new Z.default;d.environmentManager=new aa.default;d.extent=null;d.windowDevicePixelRatio=1;d.fullOpacity=1;d.graphicsView=null;d.groundView=null;d.map=null;d.screenSizePerspectiveEnabled=!0;d.state=null;d.scale=null;d.spatialReference=null;d.isHeightModelInfoRequired=!0;d.alphaCompositingEnabled=
!1;d.supersampleScreenhotsEnabled=!0;d.type="3d";d.ui=new va;d._numUpdating=0;d._lastUpdateTime=0;d.updatingProgress=.5;d.viewpoint=null;d.zoom=null;d.highlightOptions=new ua;c&&c.environment||(d._defaults.environment=new W,d.environment=d._defaults.environment);c=function(){d.notifyChange("dataExtent");d.updatingChanged();d.map&&d.map.allLayers.forEach(function(b){return a(d,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,b.when()];case 1:return a.sent(),
[3,3];case 2:return a.sent(),[3,3];case 3:return this.updatingChanged(),[2]}})})})};d.handles.add([A.on(d,"map.allLayers","after-changes",c,c,c,!0),d.allLayerViews.on("after-changes",function(){return d._updateUpdatingMonitors()}),d.watch("map",function(a){a&&a.load&&a.load()})]);d.inputManager=new V({view:d});d.stateManager=new ka.ViewStateManager({view:d,updateDevicePixelRatio:function(){var a=window.devicePixelRatio;a!==d.windowDevicePixelRatio&&(d.windowDevicePixelRatio=a,d.notifyChange("pixelRatio"))}});
return d}l(e,b);e.prototype.initialize=function(){var a=this;this.groundView=new O({view:this});this._updateUpdatingMonitors();var b=function(){return a._updateDefaultToMapOptions()};this.handles.add([A.on(this,"map.allLayers","after-changes",b,b,b)]);this.updatingHandles.add(this.qualitySettings,"memoryLimit",function(b){a.resourceController&&(a.resourceController.memoryController.maxMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&
(a.resourceController.memoryController.additionalCacheMemory=b)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",function(a){return w.setFrameDuration(0<a?1E3/Math.ceil(a):0)},2);this.updatingHandles.add(ja,"SCENEVIEW_LOCKING_LOG",function(b){return a.defaultsFromMap.logDebugInformation=b},2);this.updatingHandles.add(this,"map.ground",b,3);this.updatingHandles.add(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},3)};e.prototype.destroy=function(){this.invalidate();
this.activeTool=null;this.layerViewManager.clear();this._exitSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null);this.labeler.destroy();this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this._resourceController.destroy();this._resourceController=null;this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this.propertiesPool.destroy();
this.handles.remove("updatingMonitors");this.environmentManager.destroy();this._set("environmentManager",null);this.groundView.destroy();this.groundView=null};Object.defineProperty(e.prototype,"renderSpatialReference",{get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.spatialReference:null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;
var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof k.Extent))return Xa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(!H.canProject(b.spatialReference,this.spatialReference))return Xa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;b=H.project(b,this.spatialReference);return this._clippingArea&&b&&this._clippingArea.equals(b)?
this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?Xa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||k.SpatialReference.WGS84,c=this.clippingArea;c&&(c=H.project(c,b));var d=function(d){if(d&&(d=H.project(d,b))){if(c&&(d=d.intersection(c),
!d))return;a.push(d)}},e=this._get("basemapTerrain");e&&e.spatialReference&&d(new k.Extent({xmin:e.extent[0],ymin:e.extent[1],zmin:0,xmax:e.extent[2],ymax:e.extent[3],zmax:0,spatialReference:e.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){return d(a.fullExtent)});if(0===a.length)return new k.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b});e=a.reduce(function(a,b){return a.union(b)});e.hasZ?(e.zmin=Math.min(0,e.zmin),e.zmax=Math.max(0,e.zmax)):(e.zmin=
0,e.zmax=0);return e},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});e.prototype.castEnvironment=function(a){return a?a instanceof W?a:a instanceof bb?W.fromWebsceneEnvironment(a):E.ensureType(W,a):new W};Object.defineProperty(e.prototype,"pixelRatio",{get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},
set:function(a){y.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,b=this.qualitySettings,c=b.maximumPixelRatio,b=b.maximumRenderResolution;null!=c&&(a=Math.min(a,c));null!=b&&(a=Math.min(a,b/Math.max(this.width,this.height)));return a},set:function(a){y.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new k.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new k.Extent({spatialReference:this.spatialReference||k.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"interacting",{get:function(){return this.navigating||y.isSome(this.activeTool)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"navigating",{get:function(){return!(!this.state||!this.state.navigating)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||la.getDefaultProfile()},set:function(a){la.isValidProfile(a)&&(la.apply(a,this.qualitySettings),
this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"slicePlane",{set:function(a){this._stage.renderView.setRenderParameters({slicePlane:a});if(a){var b=this.propertiesPool.get("slicePlane");ta.boundedPlane.copy(a,b);this._set("slicePlane",b)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"resolution",{get:function(){return null!=this.spatialReference?K.getResolutionForScale(this.scale,this.spatialReference):
0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?J.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.isFulfilled()?d.updating&&(c=!0,d.suspended||(++b,a="updatingProgress"in d?a+d.updatingProgress:a+.5)):++b});for(var d=0,e=[this.graphicsView,this.basemapView,
this.basemapTerrain,this.layerViewManager,this._resourceController,this._stage&&this._stage.renderView,this.featureTiles,this.pointsOfInterest,this.labeler,this.environmentManager,this.overlay,this.updatingHandles,this.featureTreeDebugger];d<e.length;d++){var f=e[d];y.isSome(f)&&f.updating&&(b+=.1,a+=.05)}d=0;for(e=[this.deconflictor];d<e.length;d++)f=e[d],y.isSome(f)&&f.updating&&(++b,a+=f.updatingProgress);(c=!!(c||0<b||!this.ready||!this.stationary||this._createGraphicsViewController||this.inputManager&&
this.inputManager.hasPendingInputs||this.map&&this.map.allLayers&&this.map.allLayers.some(function(a){return!a.isFulfilled()})))?(this._numUpdating=Math.max(b,this._numUpdating),a+=this._numUpdating-b):this._numUpdating=0;a=0<this._numUpdating?a/this._numUpdating:c?.5:1;this._get("updatingProgress")!==a&&(f=this._resourceController.scheduler.now,1>a&&(d=Math.min((f-this._lastUpdateTime)/2E3,1),a=this.updatingProgress*(1-d)+a*d),this._set("updatingProgress",a),this._lastUpdateTime=c&&1>a?f:0);return c},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||Wa.isSpatialReferenceSupported(b,"global")?"global":"local");return a},set:function(a){this.ready?Xa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});e.prototype.on=function(a,b,c,d){var e=this.viewEvents.on(a,b,c,d);return e?e:this.inherited(arguments)};e.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.viewEvents.hasHandler(a)};e.prototype.toMap=function(a,b){if(!this.ready)return Xa.error("#toMap()","Scene view cannot be used before it is ready"),null;b=b?this._externalToInternalIntersectOptions(b):
this._defaultToMapOptions;var c=y.isSome(b.graphics)&&(y.isSome(b.graphics.include)||y.isSome(b.graphics.exclude));a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;var d=B.screenPointObjectToArray(a);b.enableDraped=b.include&&!b.include.has(tb.TERRAIN_ID)||b.exclude&&b.exclude.has(tb.TERRAIN_ID);var e=this.sceneIntersectionHelper;a=new z(this.viewingMode);a.options.selectionMode=!0;a.options.store=c?2:0;e.intersectIntersectorScreen(d,a,b);if(c){c=0;for(a=a.results.all;c<
a.length;c++)if(d=a[c],e=d.toGraphic(this),y.isNone(e)||this._testGraphicUidFilter(b.graphics,e))return this._intersectResultToMapPoint(d);return null}return this._intersectResultToMapPoint(a.results.min)};e.prototype.toScreen=function(a){if(!this.ready)return Xa.error("#toScreen()","Scene view cannot be used before it is ready"),null;var b=null==a.z&&ma.getElevationAtPoint(this.basemapTerrain,a)||0;ra.pointToVector(a,Sa,this.renderSpatialReference,b);return this.engineToScreen(Sa)};e.prototype.pixelSizeAt=
function(a,b){if(!this.ready)return Xa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(!this.sceneIntersectionHelper.intersectScreen(B.createScreenPointArray(a,b),Sa))return 0}else if(a instanceof k.Point)ra.pointToVector(a,Sa,this.renderSpatialReference);else if(!this.sceneIntersectionHelper.intersectScreen(B.createScreenPointArray(a.x,a.y),Sa))return 0;return this.state.camera.computeScreenPixelSizeAt(Sa)};e.prototype.hitTest=function(a,b){if(!this.ready)return Xa.error("#hitTest()",
"Scene view cannot be used before it is ready"),null;a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;var c=B.createScreenPointArray(a.x,a.y),d=b?this._externalToInternalIntersectOptions(b):this._defaultHitTestOptions;d.terrainLocationFeedbackEnabled=!0;d.enableDraped=!0;b=new z(this.viewingMode);b.options.selectionMode=!0;b.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen(c,b,d);c=this._intersectResultsToHits(b.results.all,d.graphics);d=b.results.terrain;
a={screenPoint:a,results:c.hits,ground:y.isSome(c.integratedMeshHit)?{mapPoint:c.integratedMeshHit.mapPoint,distance:c.integratedMeshHit.distance}:{mapPoint:this._intersectResultToMapPoint(d),distance:d.hasIntersectionPoint?d.distanceInRenderSpace:0}};ja.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=b);return m.resolve(a)};e.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(b){for(var c=[],d=b.results.length?b.results[0].distance:0,e=0,f=b.results;e<f.length;e++){var g=
f[e];if(g.distance!==d)break;c.push(g)}e=null;if(0===c.length||1E-5>Math.abs(d-b.ground.distance))e=b.ground.mapPoint;return{results:c,screenPoint:a,mapPoint:e}})};e.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};e.prototype.whenLayerView=function(a){return this.inherited(arguments)};e.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){var c=Ca.toRenderSettings(a,b);c.pixelRatio/=b.pixelRatio;return b._stage.renderView.takeScreenshot(Ca.screenshotSuperSampleSettings(c,
b.supersampleScreenhotsEnabled,b.padding))})};e.prototype.importLayerView=function(a){return N.layerView3DImporter.importLayerView(a)};e.prototype.hasLayerViewModule=function(a){return N.layerView3DImporter.hasLayerViewModule(a)};e.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};e.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};e.prototype.validate=function(){var a=jb.check();x("safari")&&9>x("safari")&&(a=new u("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:x("safari")}));return a?(Xa.warn("#validate()",a.message),m.reject(a)):P.loadArcade().then(function(){},function(){})};e.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,f=Wa.isSpatialReferenceSupported(a,
"global"),g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but unsupported"),!1;if(b)if(L.isTiledLayer(b)){if(d=
void 0,h?h=Ja.getTiledLayerInfo(b,a,this.viewingMode):(h=Ja.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=Ja.getTiledLayerInfo(b,a,"local"),null!=h.tileInfo&&e&&!this.ready&&(this.viewingMode="local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((a.isWGS84||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),
h||this.ready||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};e.prototype.whenReady=function(){var a=this;return m.create(function(b){a.ready?b(a):a._resolveWhenReady.push(b)})};e.prototype.computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||k.SpatialReference.WGS84;ra.vectorToVector(a,this.renderSpatialReference,a,c)||(c=k.SpatialReference.WGS84,
ra.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new k.Point(a,c);return b};e.prototype.engineToScreen=function(a,b){var c=B.createRenderScreenPointArray3();this.state.camera.projectPoint(a,c);a=B.screenPointArrayToObject(c);return B.renderToScreen(this,a,b)};e.prototype.flushDisplayModifications=function(){this._stage.processDirty()};e.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(b){return b.layer===
a.layer}):null};e.prototype.graphicChanged=function(a){y.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};e.prototype.whenViewForGraphic=function(a){var b=this;return a.layer===this?A.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):a.layer?this.whenLayerView(a.layer):m.reject()};e.prototype.getStats=function(){var a=this.resourceController.memoryController,b=this.resourceController.scheduler,c={Memory:(a.usedMemory*a.maxMemory).toFixed(0)+"/"+a.maxMemory.toFixed(0)+
"MB"};c.Quality=Math.round(100*a.memoryFactor)+"%";c.Load=b.load.toFixed(1);this.basemapTerrain&&(c.Terrain=kb(this.basemapTerrain.getUsedMemory()));this.allLayerViews.items.forEach(function(a){ea.isMemoryManagedLayerView(a)&&(c[a.layer.title]=kb(a.getUsedMemory()))});if(a=this._stage&&this._stage.renderView&&this._stage.renderView.edgeView)a=a.getUsedMemory(),1024<a&&(c.Edges=kb(a));return c};e.prototype._intersectResultToMapPoint=function(a,b){if(a.getIntersectionPoint(Sa)){b=this.computeMapPointFromVec3d(Sa,
b);var c=this.basemapTerrain;"TerrainRenderer"===a.intersector&&c&&(b.z=ma.getElevationAtPoint(c,b)||0);return b}return null};e.prototype._intersectResultsToHits=function(a,b){var c=this,d=[],e=null,f=a.some(function(a){a=a.toOwner(c);return y.isSome(a)&&"type"in a&&"integrated-mesh"===a.type}),g=0;for(;g<a.length;g++){var h=a[g],k=h.toOwner(this);if(!f&&y.isSome(k)&&k===this.map.ground)break;var l=h.toGraphic(this);if(y.isSome(l)){y.isNone(e)&&g!==a.length-1&&(e=new Set);if(y.isSome(e)){var m=this._getGraphicFilterUid(l);
if(e.has(m))continue;e.add(m)}if(this._testGraphicUidFilter(b,l)&&(m=this._intersectResultToMapPoint(h),d.push({graphic:l,mapPoint:m,distance:h.distanceInRenderSpace}),y.isSome(k)&&"type"in k&&"integrated-mesh"===k.type))return{hits:d,integratedMeshHit:d[d.length-1]}}}return{hits:d,integratedMeshHit:null}};e.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var b=a.attributes[a.layer.objectIdField];if(b)return"o-"+a.layer.id+"-"+b}return"u-"+a.uid};e.prototype._testGraphicUidFilter=
function(a,b){b=this._getGraphicFilterUid(b);return y.isNone(a)||(y.isNone(a.include)||a.include.has(b))&&(y.isNone(a.exclude)||!a.exclude.has(b))};e.prototype._externalToInternalRenderItems=function(a,b,d){var e=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!a)return d;a instanceof n?(lb(d,this._getGraphicFilterUid(a)),0===b&&(y.isSome(this.graphicsView)&&a.layer===this?Na(d,this.graphicsView.mockLayerId):a.layer&&Na(d,a.layer.uid))):"forEach"in a?a.forEach(function(a){Array.isArray(a)?
e._externalToInternalRenderItems(a,b,d):r.isCollection(a)?a===e.graphics&&y.isSome(e.graphicsView)?Na(d,e.graphicsView.mockLayerId):e._externalToInternalRenderItems(a,b,d):a instanceof c?a===e.map.ground&&Na(d,tb.TERRAIN_ID):e._externalToInternalRenderItems(a,b,d)}):Na(d,a.uid);return d};e.prototype._externalToInternalIntersectOptions=function(a){var b=this._externalToInternalRenderItems(a.include,0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:b.layerUids,exclude:a.layerUids,
graphics:{include:b.graphicUids,exclude:a.graphicUids}}};e.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};e.prototype._initBasemapTerrain=function(a){var b=this;this._set("basemapTerrain",new Oa({view:this,manifold:this._viewingModeToManifold(a)}));this._set("elevationProvider",new qa({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this.handles.add([this.updatingHandles.add(this,"map.ground.opacity",
function(a){return b.basemapTerrain.baseOpacity=null==a?1:a},3),this.updatingHandles.add(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a},2)],"basemapTerrain")};e.prototype._exitBasemapTerrain=function(){this.basemapTerrain&&(this.handles.remove("basemapTerrain"),this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};e.prototype._initGlobe=
function(a){var b=this;this._initCoordinateSystem();this._set("state",new ha.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}));this._initBasemapTerrain(a);this._set("pointsOfInterest",new da.default({view:this}));this._set("featureTiles",new U.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));
a=function(){var a=b.basemapTerrain&&b.basemapTerrain.extent;b.clippingArea||a?a&&b.basemapTerrain.spatialReference?(a=I.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference),b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a):b.featureTiles.filterExtent=b.clippingArea:b.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(ja,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTreeDebugger?(new Promise(function(a,b){q(["./3d/layers/support/FeatureTileTree3DDebugger"],
a,b)})).then(function(a){a=a.FeatureTileTree3DDebugger;!b.featureTreeDebugger&&ja.FEATURE_TILE_TREE_SHOW_TILES&&(b.featureTreeDebugger=new a({view:b}))}):a||!b.featureTreeDebugger||ja.FEATURE_TILE_TREE_SHOW_TILES||(b.featureTreeDebugger.destroy(),b.featureTreeDebugger=null)},2),this.updatingHandles.add(this,"clippingArea",a,3),this.updatingHandles.add(this,"basemapTerrain.extent",a,3)],"feature-tiles");this.stateManager.init()};e.prototype._exitGlobe=function(){this.state&&(this.stateManager.deinit(),
this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.destroy(),this._set("state",null),this._exitCoordinateSystem())};e.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||this._set("mapCoordsHelper",
new xa.default(this.map,b));var c="global"===this.viewingMode,b=c?ra.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ia.RenderCoordsHelper.createMode(this.viewingMode,b)),c||this.handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(z.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",
null),this._set("renderCoordsHelper",null)};e.prototype._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};e.prototype.updatingChanged=function(){this.notifyChange("updating")};e.prototype._updateUpdatingMonitors=function(){var a=this;this.handles.remove("updatingMonitors");this.allLayerViews.forEach(function(b){b.destroyed||(a.handles.add([b.watch(["updating","updatingProgress"],
function(){return a.updatingChanged()},!0)],"updatingMonitors"),b.when(function(){return a.updatingChanged()},function(){return a.updatingChanged()}))});this.updatingChanged()};e.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=a.data[c]}};e.prototype._initStage=function(){var a=this,b={renderContext:this.renderContext,
deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,viewingMode:this.viewingMode,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:function(b,c){return a._renderScreenshotOverlay(b,c)}}},c=new ba.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(b){a._stage.getLayers().forEach(b)}},this);this._set("sceneIntersectionHelper",c);var d=p.byId(this.surface);this._stage=new Ma.Stage({viewingMode:this.viewingMode,
container:d,options:b,sceneIntersectionHelper:c});this._lostWebGLContextHandle=t.on(this._stage.renderView.getCanvas(),"webglcontextlost",function(){return a.fatalError=new u("webgl-context-lost")});this.handles.add(this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",function(){a._stage.renderView.setRenderParameters({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})},2),"stage");b=function(){a._stage.renderView.setRenderParameters({defaultHighlightOptions:ua.toEngineOptions(a.highlightOptions)})};
c=0;for(d=["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity"];c<d.length;c++)this.handles.add(this.updatingHandles.add(this,d[c],b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(z.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};e.prototype._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();
this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};e.prototype._initSurface=function(){this._exitSurface();this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new na.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};e.prototype._exitSurface=function(){this.sharedSymbolResources&&
(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};e.prototype._createGraphicsViewIfNeeded=function(){var a=this;if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=m.createAbortController();var b=function(){a._createGraphicsViewController=null;a.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(b,
b);this.updatingChanged()}};e.prototype._createGraphicsViewAsync=function(b){return a(this,void 0,void 0,function(){var a;return h(this,function(c){switch(c.label){case 0:return[4,m.create(function(a){return q(["./3d/layers/GraphicsView3D"],a)})];case 1:return a=c.sent(),m.throwIfAborted(b),[4,A.whenTrueOnce(this.basemapTerrain,"ready",b)];case 2:return c.sent(),this._set("graphicsView",new a({view:this})),[2]}})})};e.prototype._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),
this._createGraphicsViewController=null);this.handles.remove("graphics-view");y.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};e.prototype._startup=function(){var a=this;"global"===this.viewingMode&&(this._clippingArea=null);this._set("ready",!0);this._initSurface();this.handles.add(A.on(this,"graphics","after-changes",function(){return a._createGraphicsViewIfNeeded()}),"graphics-view");this._createGraphicsViewIfNeeded();
if(!this._externallySet.environment){var b=this.get("map.initialViewProperties.environment");b&&(this.environment=b)}this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();b=this._resolveWhenReady;this._resolveWhenReady=[];b.forEach(function(b){return b(a)})};e.prototype._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");
this._exitSurface();this._set("ready",!1)};e.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(tb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&this._defaultToMapOptions.include.add(c.uid)}}};e.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&
this._defaultHitTestOptions.exclude.add(tb.TERRAIN_ID);for(var a=0,b=this.map.allLayers.items;a<b.length;a++){var c=b[a];"integrated-mesh"===c.type&&1>c.opacity&&this._defaultToMapOptions.exclude.add(c.uid)}}};f([C.property()],e.prototype,"_resourceController",void 0);f([C.property()],e.prototype,"_stage",void 0);f([C.property()],e.prototype,"deconflictor",void 0);f([C.property()],e.prototype,"labeler",void 0);f([C.property({type:Y,readOnly:!0,aliasOf:"state.animation"})],e.prototype,"animation",
void 0);f([C.property({readOnly:!0})],e.prototype,"basemapTerrain",void 0);f([C.property({readOnly:!0})],e.prototype,"elevationProvider",void 0);f([C.property({type:d,aliasOf:"stateManager.camera"})],e.prototype,"camera",void 0);f([C.property({readOnly:!0})],e.prototype,"canvas",void 0);f([C.property({type:k.Point,aliasOf:"stateManager.center"})],e.prototype,"center",void 0);f([C.property({type:k.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],e.prototype,"clippingArea",
null);f([C.property({type:Z.default})],e.prototype,"constraints",void 0);f([C.property({type:k.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],e.prototype,"dataExtent",null);f([C.property({value:null,type:W})],e.prototype,"environment",null);f([C.cast("environment")],e.prototype,"castEnvironment",null);f([C.property({readOnly:!0})],e.prototype,"environmentManager",void 0);f([C.property({type:k.Extent,aliasOf:"stateManager.extent"})],e.prototype,"extent",void 0);f([C.property({readOnly:!0,
aliasOf:"stateManager.screenCenter"})],e.prototype,"screenCenter",void 0);f([C.property({type:Number,dependsOn:["maximumPixelRatio"]})],e.prototype,"pixelRatio",null);f([C.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],e.prototype,"maximumPixelRatio",null);f([C.property({aliasOf:"stateManager.frustum"})],e.prototype,"frustum",void 0);f([C.property({type:Number,readOnly:!0})],e.prototype,"fullOpacity",void 0);f([C.property({readOnly:!0})],
e.prototype,"graphicsView",void 0);f([C.property({type:k.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],e.prototype,"groundExtent",null);f([C.property()],e.prototype,"groundView",void 0);f([C.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],e.prototype,"initialExtentRequired",null);f([C.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],e.prototype,"interacting",null);f([C.property({type:Boolean,dependsOn:["state.navigating"],readOnly:!0})],e.prototype,
"navigating",null);f([C.property()],e.prototype,"map",void 0);f([C.property({readOnly:!0})],e.prototype,"mapCoordsHelper",void 0);f([C.property({aliasOf:"stateManager.padding"})],e.prototype,"padding",void 0);f([C.property({type:da.default,readOnly:!0})],e.prototype,"pointsOfInterest",void 0);f([C.property({type:U.default,readOnly:!0})],e.prototype,"featureTiles",void 0);f([C.property()],e.prototype,"featureTreeDebugger",void 0);f([C.property({type:Boolean})],e.prototype,"screenSizePerspectiveEnabled",
void 0);f([C.property({constructOnly:!0})],e.prototype,"deactivatedWebGLExtensions",void 0);f([C.property({constructOnly:!0})],e.prototype,"debugWebGLExtensions",void 0);f([C.property({constructOnly:!0})],e.prototype,"renderCanvas",void 0);f([C.property({readOnly:!0})],e.prototype,"state",void 0);f([C.property({readOnly:!0})],e.prototype,"inputManager",void 0);f([C.property({readOnly:!0})],e.prototype,"stateManager",void 0);f([C.property({type:["low","medium","high"]})],e.prototype,"qualityProfile",
null);f([C.property({type:pa,get:function(){var a=this._get("qualitySettings");a||(a=new pa,la.apply(this.qualityProfile,a));return a}})],e.prototype,"qualitySettings",void 0);f([C.property()],e.prototype,"slicePlane",null);f([C.property({dependsOn:["viewingMode"]})],e.prototype,"preconditionsReady",void 0);f([C.property({readOnly:!0})],e.prototype,"renderCoordsHelper",void 0);f([C.property({readOnly:!0})],e.prototype,"sceneIntersectionHelper",void 0);f([C.property({type:Number,dependsOn:["scale",
"spatialReference"],readOnly:!0})],e.prototype,"resolution",null);f([C.property({type:Number,aliasOf:"stateManager.scale"})],e.prototype,"scale",void 0);f([C.property()],e.prototype,"heightModelInfo",null);f([C.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],e.prototype,"spatialReference",void 0);f([C.property({type:Boolean,constructOnly:!0})],e.prototype,"alphaCompositingEnabled",void 0);f([C.property({type:Boolean})],e.prototype,"supersampleScreenhotsEnabled",
void 0);f([C.property({readOnly:!0})],e.prototype,"type",void 0);f([C.property({type:va})],e.prototype,"ui",void 0);f([C.property({type:Boolean,readOnly:!0,dependsOn:"_resourceController.updating labeler.updating layerViewManager.updating deconflictor.updating environmentManager.updating inputManager.hasPendingInputs basemapView.updating basemapTerrain.updating featureTiles.updating pointsOfInterest.updating graphicsView.updating _stage.renderView.updating ready stationary overlay.updating updatingHandles.updating featureTreeDebugger.updating".split(" ")})],
e.prototype,"updating",null);f([C.property({type:Number,readOnly:!0,dependsOn:["updating"]})],e.prototype,"updatingProgress",void 0);f([C.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],e.prototype,"viewingMode",null);f([C.property({type:g,aliasOf:"stateManager.viewpoint"})],e.prototype,"viewpoint",void 0);f([C.property({type:Number,aliasOf:"stateManager.zoom"})],e.prototype,"zoom",void 0);f([C.property({type:ua})],e.prototype,"highlightOptions",
void 0);return e=f([C.subclass("esri.views.SceneView")],e)}(C.declared(S.BreakpointsOwner(R.DOMContainer(Q.PopupView(T)))));var Sa=G.vec3f64.create();return b});