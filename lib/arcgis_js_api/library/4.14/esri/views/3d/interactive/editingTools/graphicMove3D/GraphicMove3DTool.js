// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/assignHelper ../../../../../core/Collection ../../../../../core/Evented ../../../../../core/Handles ../../../../../core/maybe ../../../../../core/watchUtils ../../../../../core/accessorSupport/decorators ../../Manipulator3D ../../manipulatorUtils ../manipulatorDragUtils ../manipulatorUtils ./isSupportedGraphic ../../../../interactive/InteractiveToolBase".split(" "),
function(r,k,l,w,x,y,z,A,t,u,g,B,C,m,v,D,E){Object.defineProperty(k,"__esModule",{value:!0});var n=function(){return function(b){this.allGraphics=b;this.type="graphic-move-start"}}();k.GraphicMoveStartEvent=n;var p=function(){return function(b,a,c,F){this.dx=b;this.dy=a;this.dz=c;this.allGraphics=F;this.type="graphic-move"}}();k.GraphicMoveEvent=p;var q=function(){return function(b){this.allGraphics=b;this.type="graphic-move-stop"}}();k.GraphicMoveStopEvent=q;r=function(b){function a(c){c=b.call(this,
c)||this;c.graphics=new y;c.enableZ=!0;c.type="move-3d";c._handles=new A;return c}w(a,b);a.prototype.initialize=function(){var c=this;this._handles.add(this.graphics.on("change",function(){c._refreshManipulators()}));this._refreshManipulators()};a.prototype.destroy=function(){this._handles.destroy();this._handles=null;this.graphics.removeAll();this._set("view",null)};a.prototype.reset=function(){};a.prototype._refreshManipulators=function(){var c=this;this._handles.remove("graphics");this.manipulators.removeAll();
for(var a=this.graphics.toArray(),e=[],h=function(d){if(0!==D.isSupportedGraphic(d))return"continue";var a=v.createGraphicMoveXYManipulator(f.view,d);f._handles.add(a.events.on("immediate-click",function(a){c.emit("immediate-click",x({},a,{graphic:d}));a.stopPropagation()}),"graphics");f.manipulators.add(a);e.push(a);var b=f.enableZ?v.createGraphicMoveZManipulator({view:f.view,graphic:d}):null;if(t.isNone(b))return"continue";f._handles.add([u.init(d,"geometry",function(){return C.placeManipulatorAtGraphic(b,
d)}),u.init(d,["visible","layer.visible"],function(){return b.visible=d.visible&&d.layer.visible})],"graphics");f.manipulators.add(b);e.push(b)},f=this,b=0;b<a.length;b++)h(a[b]);h=m.createManipulatorDragEventPipelineManyOneOf(e,function(d,f,b){d instanceof B.Manipulator3D?c.buildZManipulatorEventPipeline(d,f,a):c.buildGraphicManipulatorEventPipeline(d,b,f,a)});this._handles.add(h,"graphics")};a.prototype.buildZManipulatorEventPipeline=function(a,b,e){var c=this;b.next(m.screenToZConstrained(this.view,
a.renderLocation,a.location.spatialReference)).next(function(a){"start"===a.action&&c.emit("graphic-move-start",new n(e));return a}).next(m.dragGraphicMany(e)).next(function(a){switch(a.action){case "start":case "update":(a.translationX||a.translationY||a.translationZ)&&c.emit("graphic-move",new p(a.translationX,a.translationY,a.translationZ,e));break;case "end":c.emit("graphic-move-stop",new q(e))}})};a.prototype.buildGraphicManipulatorEventPipeline=function(a,b,e,h){var c=this,g=t.isSome(a.graphic.geometry)?
a.graphic.geometry.spatialReference:null;e.next(m.screenToMapXYForGraphic(b,this.view,a.graphic,g)).next(function(a){"start"===a.action&&c.emit("graphic-move-start",new n(h));return a}).next(m.dragGraphicMany(h)).next(function(a){switch(a.action){case "start":case "update":(a.translationX||a.translationY||a.translationZ)&&c.emit("graphic-move",new p(a.translationX,a.translationY,a.translationZ,h));break;case "end":c.emit("graphic-move-stop",new q(h))}})};l([g.property({constructOnly:!0,nonNullable:!0})],
a.prototype,"view",void 0);l([g.property({readOnly:!0})],a.prototype,"graphics",void 0);l([g.property({constructOnly:!0,nonNullable:!0})],a.prototype,"enableZ",void 0);l([g.property({readOnly:!0})],a.prototype,"type",void 0);return a=l([g.subclass("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMove3DTool")],a)}(g.declared(z.EventedMixin(E.InteractiveToolBase)));k.GraphicMove3DTool=r});