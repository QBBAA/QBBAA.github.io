// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./ElevationProvider".split(" "),function(w,x,q,l,y,z,r,t,n,f,m,u,v){return function(p){function c(a){a=p.call(this,a)||this;
a.providers={im:[],ground:[],scene:[]};a.handles=new Map;return a}q(c,p);c.prototype.getElevation=function(a,b,g,h,d){var e=null,k=!0;"scene"===d&&(e=this._updateElevation(e,this.providers.im,a,b,g,h,d),null!=e&&(k=!1));k&&(e=this._updateElevation(e,this.providers.ground,a,b,g,h,d));"scene"===d&&(e=this._updateElevation(e,this.providers.scene,a,b,g,h,d));return e};c.prototype._updateElevation=function(a,b,g,h,d,e,k){for(var c=0;c<b.length;c++){var f=b[c].getElevation(g,h,d,e,k);null!=f&&(a=null!=
a?Math.max(f,a):f)}return a};c.prototype.queryElevation=function(a,b,g,c){var d=this;void 0===g&&(g=0);this._elevationService||(this._elevationService=new u.ElevationQuery(this.view.spatialReference,function(){return d.view.map&&d.view.map.ground},{maximumAutoTileRequests:4}));var e=n.createResolver();(m.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b,g):this._elevationService.queryElevation(a[0],a[1],b,g)).then(function(b){"scene"===c&&(b=m.isPoint(a)?d._updateElevation(b,d.providers.scene,
a.x,a.y,a.z,a.spatialReference,c):d._updateElevation(b,d.providers.scene,a[0],a[1],a[2],d.spatialReference,c));e.resolve(b)}).catch(function(b){n.isAbortError(b)?e.reject(b):e.resolve(m.isPoint(a)?v.getElevationAtPoint(d,a):d.getElevation(a[0],a[1],a[2],d.spatialReference))});return e.promise};c.prototype.register=function(a,b){var c=this;this.handles.set(b,b.on("elevation-change",function(a){return c.emit("elevation-change",a)}));this.providers[a].push(b)};c.prototype.unregister=function(a){this.handles.has(a)&&
(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var f=c[b],d=this.providers[f].indexOf(a);-1<d&&this.providers[f].splice(d,1)}};l([f.property({constructOnly:!0})],c.prototype,"view",void 0);l([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",void 0);return c=l([f.subclass("esri.views.3d.support.CombinedElevationProvider")],c)}(f.declared(t.EventedMixin(r)))});