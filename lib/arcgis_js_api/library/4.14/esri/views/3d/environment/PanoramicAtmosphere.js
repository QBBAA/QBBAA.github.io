// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(h,F,q,r,k,t,u,l,v,w,x,y,z,A,m,B,C,D,E){h=function(){function e(d,a){this.slot=12;this._readyResolver=k.createResolver();this._readyController=k.createAbortController();this.view=d;this._techniqueRepository=a;this._atmosphereTechniqueConfig=new l.SimpleAtmosphereTechniqueConfiguration}Object.defineProperty(e.prototype,"canRender",{get:function(){return null!=this._texture},enumerable:!0,configurable:!0});e.prototype.destroy=function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),
this._texture=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};e.prototype.when=function(d){return r(this,void 0,void 0,function(){return q(this,function(a){switch(a.label){case 0:return[4,this._readyResolver.promise];case 1:return a.sent(),d(),[2]}})})};e.prototype.initializeRenderContext=function(d){var a=this,c=d.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(l.SimpleAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(c);this._vaoCount=D.vertexCount(this._vao,"geometry");w.requestImage(v,{signal:this._readyController.signal}).then(function(b){a._texture=new C(d.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},b);d.requestRender();a._readyController=null;a._readyResolver.resolve()})};e.prototype.uninitializeRenderContext=function(){this.destroy()};e.prototype.render=function(d){if(d.slot!==
this.slot||0!==d.pass)return!1;var a=d.rctx,c=this._atmosphereTechnique.program;a.bindProgram(c);this._atmosphereTechnique.bindPipelineState(a);a.bindTexture(this._texture);c.setUniform1i("tex",0);c.setUniformMatrix4fv("proj",d.camera.projectionMatrix);var b=n;t.mat4.copy(b,d.camera.viewMatrix);b[12]=0;b[13]=0;b[14]=0;b[15]=1;c.setUniformMatrix4fv("view",n);c.setUniform4f("color",1,1,1,1);d.scenelightingData.setLightDirectionUniform(c);a.bindVAO(this._vao);c.assertCompatibleVertexAttributeLocations(this._vao);
a.drawArrays(4,0,this._vaoCount);return!0};e.prototype._createVertexArrayObject=function(d){for(var a=A.createPolySphereGeometry(1,2,!1),c=a.indices[m.VertexAttrConstants.POSITION],b=0;b<c.length;b+=3){var e=c[b];c[b]=c[b+2];c[b+2]=e}for(var a=a.vertexAttributes[m.VertexAttrConstants.POSITION].data,e=p.createBuffer(c.length),f=e.position,b=0;b<c.length;++b){var g=3*c[b];f.set(b,0,a[g]);f.set(b,1,a[g+1]);f.set(b,2,a[g+2])}return new E(d,z.Default3D,{geometry:x.glLayout(p)},{geometry:B.createVertex(d,
35044,e.buffer)})};return e}();var n=u.mat4f64.create(),p=y.newLayout().vec3f("position");return h});