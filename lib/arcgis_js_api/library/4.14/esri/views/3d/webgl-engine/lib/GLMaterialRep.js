// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define(["require","exports","../core/shaderLibrary/ShaderOutputOptions","./Util"],function(h,k,e,f){var g=function(){function a(c){this.refCnt=0;this.glMaterial=c}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function a(c,b,a){this._textureRep=c;this._techniqueRep=b;this.onMaterialChanged=
a;this._id2glMaterialRef=new Map}a.prototype.acquire=function(c,b){var a=e.getShaderOutputID(c.id,b),d=this._id2glMaterialRef.get(a);null==d?(b=c.getGLMaterial({material:c,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:b}),d=new g(b),this._id2glMaterialRef.set(a,d),this.ownMaterial(c)):b=d.getGLMaterial();d.incRefCnt();return b};a.prototype.release=function(c,b){c=e.getShaderOutputID(c.id,b);b=this._id2glMaterialRef.get(c);b.decRefCnt();0===b.getRefCnt()&&((b=b.getGLMaterial())&&
b.dispose(),this._id2glMaterialRef.delete(c))};a.prototype.materialChanged=function(c){for(var b=0,a=e.ShaderOutputTypes;b<a.length;b++){var d=a[b];5!==d.output&&6!==d.output&&(d=this._id2glMaterialRef.get(e.getShaderOutputID(c.id,d.output)))&&d.getGLMaterial()&&(d=d.getGLMaterial(),d.updateParameters&&d.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(c)};a.prototype.ownMaterial=function(a){-1===a.materialRepositories.indexOf(this)&&a.materialRepositories.push(this)};return a}()});