// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../core/arrayUtils ../../../core/maybe ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat2d ../../../core/libs/gl-matrix-2/mat2df64 ../../../core/libs/gl-matrix-2/quat ../../../core/libs/gl-matrix-2/quatf64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Circle ../../../geometry/geometryEngine ../../../geometry/support/coordsUtils ../../../geometry/support/spatialReferenceUtils".split(" "),
function(t,g,w,H,k,C,p,D,E,u,x,y,n,m,F,z,v,G){function f(a,c,d){void 0===d&&(d=null);return p.isSome(d)?{x:a,y:c,z:d}:{x:a,y:c}}function q(a,c,d,h){void 0===h&&(h=!0);a=a.map(function(b){return Array.apply([],b)});a.forEach(function(b){C.equals(b[0],b[b.length-1])||b.push(b[0])});var b=new k.Polygon({rings:a,spatialReference:c});b.rings.forEach(function(a){b.isClockwise(a)||a.reverse()});d&&v.unnormalizeGeometryOnDatelineCrossing(b);h&&b.isSelfIntersecting&&G.isValid(c)&&(b=z.simplify(b));return b}
Object.defineProperty(g,"__esModule",{value:!0});g.makeMapPoint=function(a,c){return[a,c]};g.makeSurfacePoint=f;t=function(){function a(a){this.spatialReference=a}a.prototype.mapToLocalMultiple=function(a){var d=this;return a.map(function(a){return d.mapToLocal(a)})};Object.defineProperty(a.prototype,"doUnnormalization",{get:function(){return!1},enumerable:!0,configurable:!0});return a}();var A=function(a){function c(d,c){c=a.call(this,c)||this;c.transform=u.mat2df64.create();c.transformInv=u.mat2df64.create();
c.transform=u.mat2df64.clone(d);E.mat2d.invert(c.transformInv,c.transform);return c}w(c,a);c.prototype.mapToLocal=function(a){return f(this.transform[0]*a[0]+this.transform[2]*a[1]+this.transform[4],this.transform[1]*a[0]+this.transform[3]*a[1]+this.transform[5])};c.prototype.localToMap=function(a){return[this.transformInv[0]*a.x+this.transformInv[2]*a.y+this.transformInv[4],this.transformInv[1]*a.x+this.transformInv[3]*a.y+this.transformInv[5]]};return c}(t);g.AffineCoordinateSystem=A;var B=function(a){function c(d,
c){var b=a.call(this,d.spatialReference)||this;b.view=d;b.pWS=m.vec3f64.create();b.tangentFrameUpWS=m.vec3f64.create();b.tangentFrameRightWS=m.vec3f64.create();b.tangentFrameForwardWS=m.vec3f64.create();b.localFrameRightWS=m.vec3f64.create();b.localFrameUpWS=m.vec3f64.create();b.worldToLocalTransform=y.quatf64.create();b.localToWorldTransform=y.quatf64.create();b.scale=1;b.scale=d.resolution;b.pMS=c;d=d.state.camera.viewRight;b.view.renderCoordsHelper.toRenderCoords(b.pMS,b.pWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,
0,b.tangentFrameRightWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,1,b.tangentFrameUpWS);b.view.renderCoordsHelper.worldBasisAtPosition(b.pWS,2,b.tangentFrameForwardWS);c=m.vec3f64.create();n.vec3.scale(c,b.tangentFrameForwardWS,n.vec3.dot(d,b.tangentFrameForwardWS));n.vec3.subtract(b.localFrameRightWS,d,c);n.vec3.normalize(b.localFrameRightWS,b.localFrameRightWS);n.vec3.cross(b.localFrameUpWS,b.tangentFrameForwardWS,b.localFrameRightWS);x.quat.rotationTo(b.worldToLocalTransform,b.localFrameRightWS,
b.tangentFrameRightWS);x.quat.invert(b.localToWorldTransform,b.worldToLocalTransform);return b}w(c,a);Object.defineProperty(c.prototype,"doUnnormalization",{get:function(){return"global"===this.view.viewingMode},enumerable:!0,configurable:!0});c.prototype.mapToLocal=function(a){var c=m.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new k.Point({x:a[0],y:a[1],spatialReference:this.spatialReference}),c);n.vec3.transformQuat(c,c,this.worldToLocalTransform);a=this.view.renderCoordsHelper.fromRenderCoords(c,
this.view.spatialReference);return f(a.x/this.scale,a.y/this.scale)};c.prototype.localToMap=function(a){var c=m.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(new k.Point({x:a.x*this.scale,y:a.y*this.scale,spatialReference:this.spatialReference}),c);n.vec3.transformQuat(c,c,this.localToWorldTransform);a=this.view.renderCoordsHelper.fromRenderCoords(c,this.view.spatialReference);return[a.x,a.y]};return c}(t);g.SceneViewCoordinateSystem=B;g.createViewAlignedCoordinateSystem=function(a,
c){return"2d"===a.type?new A(a.state.transform,a.spatialReference):"3d"===a.type?new B(a,new k.Point({x:c[0],y:c[1],spatialReference:a.spatialReference})):null};g.createPoint=function(a,c){return new k.Point({x:a[0],y:a[1],spatialReference:c})};g.createMultipoint=function(a,c){return new k.Multipoint({points:a,spatialReference:c})};g.createPolyline=function(a,c,d){a=new k.Polyline({paths:a,spatialReference:c});d&&v.unnormalizeGeometryOnDatelineCrossing(a);return a};g.createPolygon=q;g.createSquare=
function(a,c,d,h){void 0===h&&(h=null);var b=c.mapToLocalMultiple(a);a=[];var e=b[0].x,l=b[0].y,r=Math.round(b[1].x-e),g=Math.round(b[1].y-l),b=Math.max(Math.abs(r),Math.abs(g));d?(d=e+b,r=l+b,e-=b,l-=b,a.push(f(d,l),f(e,l),f(e,r),f(d,r))):(d=0<r?e+b:e-b,b=0<g?l+b:l-b,a.push(f(e,l),f(d,l),f(d,b),f(e,b)));return q([a.map(function(a){a=c.localToMap(a);return p.isSome(h)?[a[0],a[1],h]:a})],c.spatialReference,c.doUnnormalization,!0)};g.createRectangle=function(a,c,d,h){void 0===h&&(h=null);var b=c.mapToLocalMultiple(a);
1===b.length&&(a=b[0],b=[f(a.x-48,a.y+48),f(a.x+48,a.y-48),f(a.x+48,a.y-48),f(a.x-48,a.y+48)]);a=[];var e=b[0].x,l=b[0].y,g=b[1].x,b=b[1].y;if(d){d=Math.round(g-e);var k=Math.round(b-l);a.push(f(e-d,l-k),f(g,l-k),f(g,b),f(e-d,b))}else a.push(f(e,l),f(g,l),f(g,b),f(e,b));return q([a.map(function(a){a=c.localToMap(a);return p.isSome(h)?[a[0],a[1],h]:a})],c.spatialReference,c.doUnnormalization,!0)};g.createCircle=function(a,c,d,h){void 0===h&&(h=null);var b=c.mapToLocalMultiple(a),e=a=null;d?(a=b[0],
e=b[1]):(a=b[0],b=b[1],d=Math.round(b.x-a.x),b=Math.round(b.y-a.y),e=Math.max(Math.abs(d),Math.abs(b)),a=f(0<d?a.x+e/2:a.x-e/2,0<b?a.y+e/2:a.y-e/2),e=f(Math.abs(d)>Math.abs(b)?a.x-e/2:a.x,Math.abs(d)>Math.abs(b)?a.y:a.y-e/2));a=c.localToMap(a);d=c.localToMap(e);c.doUnnormalization&&v.unnormalizeVerticesOnDatelineCrossing([[a,d]],c.spatialReference);a=new k.Point({x:a[0],y:a[1],spatialReference:c.spatialReference});d=new k.Point({x:d[0],y:d[1],spatialReference:c.spatialReference});p.isSome(h)&&(a.z=
h,d.z=h);h=D.getMetersPerUnitForSR(c.spatialReference)*z.distance(a,d,null);c=new F({center:a,radius:h,radiusUnit:"meters",spatialReference:c.spatialReference});return q(c.rings,c.spatialReference,!1)};g.createEllipse=function(a,c,d,h){void 0===h&&(h=null);var b=c.mapToLocalMultiple(a);a=b[0];var e=b[1],b=Math.round(e.x-a.x),e=Math.round(e.y-a.y);a=f(d?a.x:a.x+b/2,d?a.y:a.y+e/2);b=d?b:b/2;d=d?e:e/2;for(var e=[],g=2*Math.PI/60,k=0;60>k;k++){var m=f(b*Math.cos(k*g)+a.x,d*Math.sin(k*g)+a.y);e.push(m)}e.push(e[0]);
return q([e.map(function(a){a=c.localToMap(a);return p.isSome(h)?[a[0],a[1],h]:a})],c.spatialReference,c.doUnnormalization,!1)}});