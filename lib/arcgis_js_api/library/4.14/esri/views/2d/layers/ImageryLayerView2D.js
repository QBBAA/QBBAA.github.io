// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.15/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapLayerView2D":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ../engine/BitmapContainer".split(" "),function(t,e,h,f,d,g){Object.defineProperty(e,"__esModule",{value:!0});e.BitmapLayerView2D=function(c){return function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.container=new g.BitmapContainer(c.clips);return c}f(c,a);c.prototype.initialize=
function(){var a=this;this.handles.add(this.clips.on("change",function(){return a.container.setClips(a.clips)}))};return c=h([d.subclass("esri.views.2d.layers.BitmapLayerView2D")],c)}(d.declared(c))}})},"esri/views/2d/layers/LayerView2D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Collection ../../../core/collectionUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(t,e,h,f,d,g,c,a,l,b,y,r){Object.defineProperty(e,"__esModule",{value:!0});var u=d.ofType({key:"type",base:l,typeMap:{rect:b,path:r,geometry:y}});e.LayerView2D=function(d){return function(d){function b(){var a=null!==d&&d.apply(this,arguments)||this;a.clips=new u;a.moving=!1;a.attached=!1;a.lastUpdateId=-1;a.updateRequested=!1;return a}h(b,d);b.prototype.initialize=function(){var a=this;this.when(function(){a.requestUpdate()},function(){});var b=function(){return a.notifyChange("rendering")};
this.handles.add([c.init(this,"suspended",function(c){a.container&&(a.container.visible=!c);a.view&&!c&&a.updateRequested&&a.view.requestLayerViewUpdate(a)},!0),c.init(this,["fullOpacity","container"],function(){a.container&&(a.container.opacity=a.fullOpacity)},!0),c.on(this,"container","post-render",b),c.on(this,"container","will-render",b)])};b.prototype.destroy=function(){this.attached&&(this.attached=!1,this.detach());this.handles.remove("initialize");this.updateRequested=!1;this.view=this.layer=
null};Object.defineProperty(b.prototype,"rendering",{get:function(){return this.attached&&!this.suspended&&(this.moving||this.container.renderRequested||this.isRendering())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return!this.suspended&&(!this.attached||this.updateRequested||this.isUpdating())},enumerable:!0,configurable:!0});b.prototype.isVisibleAtScale=function(a){var c=!0,b=this.layer,d=b.minScale,b=b.maxScale;if(null!=d&&null!=b){var c=!d,f=
!b;!c&&a<=d&&(c=!0);!f&&a>=b&&(f=!0);c=c&&f}return c};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestLayerViewUpdate(this))};b.prototype.processUpdate=function(a){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",a),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(a)))};b.prototype.isUpdating=function(){return!1};b.prototype.isRendering=function(){return!1};b.prototype.canResume=
function(){var a=this.inherited(arguments);a&&(a=this.isVisibleAtScale(this.view.scale));return a};f([a.property({type:u,set:function(a){a=g.referenceSetter(a,this._get("clips"),u);this._set("clips",a)}})],b.prototype,"clips",void 0);f([a.property()],b.prototype,"moving",void 0);f([a.property({dependsOn:["attached","suspended","moving"]})],b.prototype,"rendering",null);f([a.property()],b.prototype,"attached",void 0);f([a.property()],b.prototype,"container",void 0);f([a.property({dependsOn:["view.scale",
"layer.minScale","layer.maxScale"]})],b.prototype,"suspended",void 0);f([a.property({readOnly:!0})],b.prototype,"updateParameters",void 0);f([a.property()],b.prototype,"updateRequested",void 0);f([a.property({dependsOn:["updateRequested","attached","suspended"]})],b.prototype,"updating",null);f([a.property()],b.prototype,"view",void 0);return b=f([a.subclass("esri.views.2d.layers.LayerView2D")],b)}(a.declared(d))}})},"esri/views/layers/support/ClipArea":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(t,e,h,f,d,g){return function(c){function a(){return null!==c&&c.apply(this,arguments)||this}f(a,c);return a=h([g.subclass("esri.views.layers.support.ClipArea")],a)}(g.declared(d.JSONSupport))})},"esri/views/layers/support/ClipRect":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(t,e,h,f,d,g){return function(c){function a(){var a=null!==c&&c.apply(this,
arguments)||this;a.type="rect";a.left=null;a.right=null;a.top=null;a.bottom=null;return a}f(a,c);g=a;a.prototype.clone=function(){return new g({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});var g;h([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"left",void 0);h([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"right",
void 0);h([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"top",void 0);h([d.property({type:[Number,String],json:{write:!0}})],a.prototype,"bottom",void 0);h([d.property({readOnly:!0,dependsOn:["left","right","top","bottom"]})],a.prototype,"version",null);return a=g=h([d.subclass("esri.views.layers.support.ClipRect")],a)}(d.declared(g))})},"esri/views/layers/support/Geometry":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../geometry ../../../core/accessorSupport/decorators ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea".split(" "),
function(t,e,h,f,d,g,c,a,l){var b={base:c,key:"type",typeMap:{extent:d.Extent,polygon:d.Polygon}};return function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.type="geometry";a.geometry=null;return a}f(d,c);l=d;Object.defineProperty(d.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new l({geometry:this.geometry.clone()})};var l;h([g.property({types:b,json:{read:a.fromJSON,write:!0}})],d.prototype,
"geometry",void 0);h([g.property({readOnly:!0,dependsOn:["geometry"]})],d.prototype,"version",null);return d=l=h([g.subclass("esri.views.layers.support.Geometry")],d)}(g.declared(l))})},"esri/views/layers/support/Path":function(){define("require exports ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/accessorSupport/decorators ./ClipArea".split(" "),function(t,e,h,f,d,g){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;
a.type="path";a.path=[];return a}f(a,c);Object.defineProperty(a.prototype,"version",{get:function(){return(this._get("version")||0)+1},enumerable:!0,configurable:!0});h([d.property({type:[[[Number]]],json:{write:!0}})],a.prototype,"path",void 0);h([d.property({readOnly:!0,dependsOn:["path"]})],a.prototype,"version",null);return a=h([d.subclass("esri.views.layers.support.Path")],a)}(d.declared(g))})},"esri/views/2d/layers/support/ExportStrategy":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Extent ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../engine ../../viewStateUtils ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(t,e,h,f,d,g,c,a,l,b,y,r,u,w,q,B,p,A){var n=r.create(),v=[0,0],C=new A(0,0,0,0);return function(a){function k(c){var b=a.call(this,c)||this;b._imagePromise=null;b.hidpi=!1;b.imageMaxWidth=2048;b.imageMaxHeight=2048;b.imageRotationSupported=!1;b.imageNormalizationSupported=!1;b.update=l.debounce(function(a,c){return d(b,void 0,void 0,function(){var b,d,m,g,k,x,l,h,z,e=this;return f(this,function(f){b=a.state;d=u.getInfo(b.spatialReference);m=this.hidpi?a.pixelRatio:1;if(!a.stationary||this.destroyed)return[2];
this.imageRotationSupported?(v[0]=b.size[0],v[1]=b.size[1]):B.getOuterSize(v,b);g=Math.floor(v[0]*m)>this.imageMaxWidth||Math.floor(v[1]*m)>this.imageMaxHeight;k=d&&(b.extent.xmin<d.valid[0]||b.extent.xmax>d.valid[1]);x=!this.imageNormalizationSupported&&k;l=!g&&!x;h=this.imageRotationSupported?b.rotation:0;l?this._imagePromise=this._singleExport(b,v,h,m,c):(z=Math.min(this.imageMaxWidth,this.imageMaxHeight),x&&(z=Math.min(b.worldScreenWidth,z)),this._imagePromise=this._tiledExport(b,z,h,m,c));return[2,
this._imagePromise.then(function(a){e._imagePromise=null;var c=e.container.children.slice();e.container.removeAllChildren();a.forEach(e.container.addChild,e.container);e.disposeSource&&c.forEach(function(a){e.disposeSource(a.source)},e)}).catch(function(a){e._imagePromise=null;throw a;})]})})},5E3);return b}g(k,a);k.prototype.destroy=function(){};Object.defineProperty(k.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0});k.prototype.updateExports=
function(a){for(var c=0,b=this.container.children;c<b.length;c++){var d=b[c];if(!d.visible||!d.attached)break;a(d)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(d.invalidateTexture(),d.requestRender())}};k.prototype._export=function(a,c,b,d,f,g){var m=this;return l.resolve().then(function(){return m.fetchSource(a,Math.floor(c*f),Math.floor(b*f),{rotation:d,pixelRatio:f,signal:g})}).then(function(b){b=new q.Bitmap(b);b.x=a.xmin;b.y=a.ymax;b.resolution=a.width/c;b.rotation=
d;b.pixelRatio=f;return b})};k.prototype._singleExport=function(a,b,c,d,f){B.getBBox(n,a.center,a.resolution,b);a=new y(n[0],n[1],n[2],n[3],a.spatialReference);return this._export(a,b[0],b[1],c,d,f).then(function(a){return[a]})};k.prototype._tiledExport=function(a,b,c,d,f){var g=this,m=w.create({size:b,spatialReference:a.spatialReference,scales:[a.scale]}),k=new p(m),m=k.getTileCoverage(a);if(!m)return null;var e=[];m.forEach(function(m,l,h,x){C.set(m,l,h,x);k.getTileBounds(n,C);m=new y(n[0],n[1],
n[2],n[3],a.spatialReference);e.push(g._export(m,b,b,c,d,f))});return l.all(e)};c([b.property()],k.prototype,"_imagePromise",void 0);c([b.property()],k.prototype,"container",void 0);c([b.property()],k.prototype,"disposeSource",void 0);c([b.property()],k.prototype,"fetchSource",void 0);c([b.property()],k.prototype,"hidpi",void 0);c([b.property()],k.prototype,"imageMaxWidth",void 0);c([b.property()],k.prototype,"imageMaxHeight",void 0);c([b.property()],k.prototype,"imageRotationSupported",void 0);c([b.property()],
k.prototype,"imageNormalizationSupported",void 0);c([b.property()],k.prototype,"requestUpdate",void 0);c([b.property({dependsOn:["_imagePromise"]})],k.prototype,"updating",null);return k=c([b.subclass("esri.views.2d.layers.support.ExportStrategy")],k)}(b.declared(a))})},"esri/views/2d/viewStateUtils":function(){define(["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var h=Math.PI/180;e.snapToPixel=function(f,d,g){var c=g.resolution;g=g.size;f[0]=c*(Math.round(d[0]/
c)+g[0]%2*.5);f[1]=c*(Math.round(d[1]/c)+g[1]%2*.5);return f};e.getOuterSize=function(f,d){var g=d.rotation*h,c=Math.abs(Math.cos(g)),g=Math.abs(Math.sin(g)),a=d.size;d=a[0];a=a[1];f[0]=Math.round(a*g+d*c);f[1]=Math.round(a*c+d*g);return f};e.getBBox=function(f,d,g,c){var a=d[0];d=d[1];var e=c[0];c=c[1];g*=.5;f[0]=a-g*e;f[1]=d-g*c;f[2]=a+g*e;f[3]=d+g*c;return f};e.bboxIntersects=function(f,d){var g=f[1],c=f[2],a=f[3],e=d[0],b=d[1],h=d[3];return!(f[0]>d[2]||c<e||g>h||a<b)}})},"esri/views/layers/ImageryLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../layers/support/timeUtils ../../tasks/support/Query ./support/popupUtils".split(" "),
function(t,e,h,f,d,g,c,a,l,b,y,r,u,w){Object.defineProperty(e,"__esModule",{value:!0});e.ImageryLayerView=function(e){return function(e){function p(){var a=null!==e&&e.apply(this,arguments)||this;a.view=null;return a}h(p,e);p.prototype.fetchPopupFeatures=function(b,f){return g(this,void 0,void 0,function(){var g,e,h,k,m,x,r,z,n,p,q;return d(this,function(d){switch(d.label){case 0:g=this.layer;if(!b)return[2,l.reject(new c("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:g}))];
e=g.popupEnabled;h=w.getFetchPopupTemplate(g,f);if(!e||!a.isSome(h))throw new c("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:e,popupTemplate:h});return[4,h.getRequiredFields()];case 1:return k=d.sent(),m=new u,m.geometry=b,m.outFields=k,m.outSpatialReference=b.spatialReference,x=this.view.resolution,r="2d"===this.view.type?new y(x,x,this.view.spatialReference):new y(.5*x,.5*x,this.view.spatialReference),z=h.layerOptions||{returnTopmostRaster:!0,
showNoDataRecords:!1},n=z.returnTopmostRaster,p=z.showNoDataRecords,q={returnDomainValues:!0,returnTopmostRaster:n,pixelSize:r,showNoDataRecords:p},[2,g.queryVisibleRasters(m,q).then(function(a){return a})]}})})};f([b.property()],p.prototype,"layer",void 0);f([b.property()],p.prototype,"view",void 0);f([b.property(r.combinedViewLayerTimeExtentProperty)],p.prototype,"timeExtent",void 0);return p=f([b.subclass("esri.views.layers.ImageryLayerView")],p)}(b.declared(e))}})},"esri/views/layers/support/popupUtils":function(){define("require exports ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper @dojo/framework/shim/array ../../../core/maybe ../../../layers/support/fieldUtils".split(" "),
function(t,e,h,f,d,g,c){Object.defineProperty(e,"__esModule",{value:!0});e.getRequiredFields=function(a,e){void 0===e&&(e=a.popupTemplate);return f(this,void 0,void 0,function(){var b,f,l,u,w,q,t,p,A,n,v;return h(this,function(h){switch(h.label){case 0:return g.isSome(e)?[4,e.getRequiredFields(a.fields)]:[2,[]];case 1:b=h.sent();f=e.lastEditInfoEnabled;l=a.objectIdField;u=a.typeIdField;w=a.globalIdField;if(d.includes(b,"*"))return[2,["*"]];t=c.fixFields;p=[a.fields];n=(A=b).concat;return(v=f)?[4,
c.getFeatureEditFields(a)]:[3,3];case 2:v=h.sent(),h.label=3;case 3:return q=t.apply(void 0,p.concat([n.apply(A,[v||null])])),u&&q.push(u),q&&l&&c.hasField(a.fields,l)&&-1===q.indexOf(l)&&q.push(l),q&&w&&c.hasField(a.fields,w)&&-1===q.indexOf(w)&&q.push(w),[2,q]}})})};e.getFetchPopupTemplate=function(a,c){return a.popupTemplate?a.popupTemplate:g.isSome(c)&&c.defaultPopupTemplateEnabled&&g.isSome(a.defaultPopupTemplate)?a.defaultPopupTemplate:null}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Logger ../../../core/promiseUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/rasterFunctions/pixelUtils ../engine/ImageryBitmapSource ./BitmapLayerView2D ./LayerView2D ./support/ExportStrategy ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(t,
e,h,f,d,g,c,a,l,b,y,r,u,w,q,B,p,A,n,v){var C=a.getLogger("esri.views.2d.layers.ImageryLayerView2D");return function(a){function e(){var b=null!==a&&a.apply(this,arguments)||this;b._exportImageVersion=-1;return b}h(e,a);Object.defineProperty(e.prototype,"pixelData",{get:function(){if(this.updating)return null;var a=this.strategy.container.children;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){var b=this.view.extent,a=a.map(function(a){return a.source}).filter(function(a){return a.extent&&
a.extent.intersects(b)}).map(function(a){return{extent:a.extent,pixelBlock:a.originalPixelBlock}});return(a=u.mosaicPixelData(a,b))?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null},enumerable:!0,configurable:!0});e.prototype.hitTest=function(a,d){if(this.suspended)return l.resolve(null);a=this.view.toMap(b.createScreenPoint(a,d));return l.resolve(new c({attributes:{},geometry:a}))};e.prototype.update=function(a){this.strategy.update(a).catch(function(a){l.isAbortError(a)||C.error(a)})};
e.prototype.attach=function(){var a=this;this.layer.increaseRasterJobHandlerUsage();this.strategy=new p({container:this.container,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this.fetchImage.bind(this),requestUpdate:function(){return a.requestUpdate()}});this.handles.add([y.init(this,"layer.exportImageServiceParameters.version",function(b){a._exportImageVersion!==
b&&(a._exportImageVersion=b,a.requestUpdate())}),this.watch("timeExtent",function(){return a.requestUpdate()}),this.layer.on("redraw",function(){a.strategy.updateExports(function(b){b.source instanceof HTMLImageElement?b.requestRender():a.layer.applyRenderer({pixelBlock:b.source.pixelBlock}).then(function(c){var d=b.source;d.pixelBlock=c.pixelBlock;d.filter=function(b){return a.layer.applyFilter(b)};a.container.requestRender()})})})],"imagerylayerview-update")};e.prototype.detach=function(){this.layer.decreaseRasterJobHandlerUsage();
this.strategy.destroy();this.container.removeAllChildren();this.handles.remove("imagerylayerview-update");this._exportImageVersion=-1};e.prototype.moveStart=function(){};e.prototype.viewChange=function(){};e.prototype.moveEnd=function(){this.requestUpdate()};e.prototype.doRefresh=function(){return g(this,void 0,void 0,function(){return d(this,function(a){this.requestUpdate();return[2]})})};e.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)};e.prototype.fetchImage=
function(a,b,c,d){var e=this;this._exportImageVersion=this.get("layer.exportImageServiceParameters.version");d=d||{};d.timeExtent=this.timeExtent;d.requestAsImageElement=!0;return this.layer.fetchImage(a,b,c,d).then(function(a){return a.imageElement?a.imageElement:e.layer.applyRenderer(a.pixelData,{signal:d.signal}).then(function(b){b=new w.default(b.pixelBlock,b.extent.clone(),a.pixelData.pixelBlock);b.filter=function(a){return e.layer.applyFilter(a)};return b})})};f([r.property({dependsOn:["updating"]})],
e.prototype,"pixelData",null);f([r.property()],e.prototype,"strategy",void 0);f([r.property({dependsOn:["strategy.updating"]})],e.prototype,"updating",void 0);return e=f([r.subclass("esri.views.2d.layers.ImageryLayerView2D")],e)}(r.declared(A.ImageryLayerView(v.RefreshableLayerView(q.BitmapLayerView2D(B.LayerView2D(n))))))});